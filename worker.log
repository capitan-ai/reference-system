‚ÑπÔ∏è Twilio SMS sending not fully configured. Set TWILIO_* env vars and SMS_ENABLED.
{"ts":"2025-11-27T03:20:29.421Z","level":"info","event":"giftcard.worker.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","pollIntervalMs":2000,"circuitCooldownMs":60000}
{"ts":"2025-11-27T03:21:27.432Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"404e9417-f69b-471b-a0f8-2e28ed7518ad","stage":"booking","correlationId":"booking-created:32b1ea6c206b8d53347b1f0b","attempts":5}
üìÖ Processing booking created for customer: TMM4E9TT9TBH9KEQ32M92QBBQC
Full booking data: {
  "id": "2xprqxxggzryuq",
  "allDay": false,
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "startAt": "2025-11-26T21:00:00Z",
  "version": 2,
  "createdAt": "2025-11-25T20:02:12Z",
  "updatedAt": "2025-11-26T23:02:42Z",
  "customerId": "TMM4E9TT9TBH9KEQ32M92QBBQC",
  "locationId": "LT4ZHFBQQYB2N",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "creatorType": "TEAM_MEMBER",
    "teamMemberId": "TMQPbDVvvOCLwqsy"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMe-bT5XxKxmk0nw",
      "anyTeamMember": false,
      "durationMinutes": 140,
      "serviceVariationId": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1763586786564"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Ksenija Mikulicic
‚ÑπÔ∏è Customer TMM4E9TT9TBH9KEQ32M92QBBQC already received signup bonus, not first booking
{"ts":"2025-11-27T03:21:27.935Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"404e9417-f69b-471b-a0f8-2e28ed7518ad","stage":"booking","correlationId":"booking-created:32b1ea6c206b8d53347b1f0b"}
{"ts":"2025-11-27T03:21:28.097Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"161f1874-dbb9-4077-b202-423d33c11005","stage":"booking","correlationId":"booking-created:87bc407d310f1462eea45bdd","attempts":5}
üìÖ Processing booking created for customer: DRFXAJ6GZFBTE8YXSJCXX66YWC
Full booking data: {
  "id": "8q800f5neh0utj",
  "allDay": false,
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "startAt": "2025-11-26T21:00:00Z",
  "version": 3,
  "createdAt": "2025-11-26T19:38:16Z",
  "updatedAt": "2025-11-26T22:33:47Z",
  "customerId": "DRFXAJ6GZFBTE8YXSJCXX66YWC",
  "locationId": "LT4ZHFBQQYB2N",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "creatorType": "TEAM_MEMBER",
    "teamMemberId": "TMQPbDVvvOCLwqsy"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMkdrQsxG5tlf-c_",
      "anyTeamMember": false,
      "durationMinutes": 60,
      "serviceVariationId": "Y555I3UQZHD4TQTISQDIWPZG",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1762374620368"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Alex Wagner
üéâ First booking detected for customer: DRFXAJ6GZFBTE8YXSJCXX66YWC
   Name: Alex Wagner
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer DRFXAJ6GZFBTE8YXSJCXX66YWC...
Error getting custom attributes for customer DRFXAJ6GZFBTE8YXSJCXX66YWC: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: DRFXAJ6GZFBTE8YXSJCXX66YWC
{"ts":"2025-11-27T03:21:28.446Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"161f1874-dbb9-4077-b202-423d33c11005","stage":"booking","correlationId":"booking-created:87bc407d310f1462eea45bdd"}
{"ts":"2025-11-27T03:21:28.597Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"ad899790-9817-46cd-9cfe-8021b7d43ba7","stage":"booking","correlationId":"booking-created:02a10f5b32f769f51fccc011","attempts":5}
üìÖ Processing booking created for customer: 8E2C24BCCZR2WFG2HG5FC8XA3G
Full booking data: {
  "id": "c6cy8lk6yk5g67",
  "allDay": false,
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "startAt": "2025-11-26T21:00:00Z",
  "version": 0,
  "createdAt": "2025-11-25T01:19:45Z",
  "updatedAt": "2025-11-25T20:42:06Z",
  "customerId": "8E2C24BCCZR2WFG2HG5FC8XA3G",
  "locationId": "LNQKVBTQZN3EZ",
  "sellerNote": "1 nail",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "creatorType": "TEAM_MEMBER",
    "teamMemberId": "TMWAtQTYmZpwwxii"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TM-zXe9fXe4axYWn",
      "anyTeamMember": false,
      "durationMinutes": 30,
      "serviceVariationId": "SGSLS3INMK5YV637KUITCILL",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1760895536505"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Zoya Mobhani
üéâ First booking detected for customer: 8E2C24BCCZR2WFG2HG5FC8XA3G
   Name: Zoya Mobhani
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 8E2C24BCCZR2WFG2HG5FC8XA3G...
Error getting custom attributes for customer 8E2C24BCCZR2WFG2HG5FC8XA3G: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 8E2C24BCCZR2WFG2HG5FC8XA3G
{"ts":"2025-11-27T03:21:28.912Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"ad899790-9817-46cd-9cfe-8021b7d43ba7","stage":"booking","correlationId":"booking-created:02a10f5b32f769f51fccc011"}
{"ts":"2025-11-27T03:21:29.069Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"6367621b-22d7-4f6e-bdbb-29db8e983a9e","stage":"booking","correlationId":"booking-created:33bdd52580aa11228a4533f1","attempts":5}
üìÖ Processing booking created for customer: YWCBDR0AG95D90PRDFXT0EFRGC
Full booking data: {
  "id": "xv506c0rnrhhre",
  "allDay": false,
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "startAt": "2025-11-26T21:20:00Z",
  "version": 6,
  "createdAt": "2025-11-25T17:24:33Z",
  "updatedAt": "2025-11-26T22:36:12Z",
  "customerId": "YWCBDR0AG95D90PRDFXT0EFRGC",
  "locationId": "LT4ZHFBQQYB2N",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "creatorType": "TEAM_MEMBER",
    "teamMemberId": "TMQPbDVvvOCLwqsy"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMMHlgFBIFbMTRap",
      "anyTeamMember": false,
      "durationMinutes": 100,
      "serviceVariationId": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1763586786564"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Patricia Santana
üéâ First booking detected for customer: YWCBDR0AG95D90PRDFXT0EFRGC
   Name: Patricia Santana
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer YWCBDR0AG95D90PRDFXT0EFRGC...
Error getting custom attributes for customer YWCBDR0AG95D90PRDFXT0EFRGC: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: YWCBDR0AG95D90PRDFXT0EFRGC
{"ts":"2025-11-27T03:21:29.375Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"6367621b-22d7-4f6e-bdbb-29db8e983a9e","stage":"booking","correlationId":"booking-created:33bdd52580aa11228a4533f1"}
{"ts":"2025-11-27T03:21:29.528Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"3b421e2c-76b5-483d-886b-eb9f7524d1c2","stage":"booking","correlationId":"booking-created:13a8b86bffd0a95dc9dc090d","attempts":5}
üìÖ Processing booking created for customer: 1X3HWY42F9YV5PQFZFP6EWATF4
Full booking data: {
  "id": "h7rl6gcv18pung",
  "allDay": false,
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94133-4608",
    "addressLine1": "550 Pacific Ave",
    "addressLine2": "",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-11-26T21:40:00Z",
  "version": 3,
  "createdAt": "2025-11-06T00:55:08Z",
  "updatedAt": "2025-11-27T00:22:02Z",
  "customerId": "1X3HWY42F9YV5PQFZFP6EWATF4",
  "locationId": "LNQKVBTQZN3EZ",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "1X3HWY42F9YV5PQFZFP6EWATF4",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TM-zXe9fXe4axYWn",
      "anyTeamMember": false,
      "durationMinutes": 90,
      "serviceVariationId": "M4MB45QONRA5NMLH7DSITV35",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1762374620368"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Jacqueline Mayer
üéâ First booking detected for customer: 1X3HWY42F9YV5PQFZFP6EWATF4
   Name: Jacqueline Mayer
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 1X3HWY42F9YV5PQFZFP6EWATF4...
Error getting custom attributes for customer 1X3HWY42F9YV5PQFZFP6EWATF4: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 1X3HWY42F9YV5PQFZFP6EWATF4
{"ts":"2025-11-27T03:21:29.861Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"3b421e2c-76b5-483d-886b-eb9f7524d1c2","stage":"booking","correlationId":"booking-created:13a8b86bffd0a95dc9dc090d"}
{"ts":"2025-11-27T03:21:30.013Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"7df04b66-e9be-4d5b-a625-22a75e54e6b3","stage":"booking","correlationId":"booking-created:7744804ef619270c4783ee82","attempts":5}
üìÖ Processing booking created for customer: 4VZ6N8F8ZV6MP9ZRJPEDJX95CW
Full booking data: {
  "id": "qwvjctf995e0cw",
  "allDay": false,
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "startAt": "2025-11-26T21:40:00Z",
  "version": 4,
  "createdAt": "2025-11-12T23:52:37Z",
  "updatedAt": "2025-11-26T22:45:52Z",
  "customerId": "4VZ6N8F8ZV6MP9ZRJPEDJX95CW",
  "locationId": "LNQKVBTQZN3EZ",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "creatorType": "TEAM_MEMBER",
    "teamMemberId": "TMWAtQTYmZpwwxii"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMVwAQUdLz6no-cB",
      "anyTeamMember": false,
      "durationMinutes": 90,
      "serviceVariationId": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1758921239397"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Lauren Kehrt
üéâ First booking detected for customer: 4VZ6N8F8ZV6MP9ZRJPEDJX95CW
   Name: Lauren Kehrt
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 4VZ6N8F8ZV6MP9ZRJPEDJX95CW...
Error getting custom attributes for customer 4VZ6N8F8ZV6MP9ZRJPEDJX95CW: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 4VZ6N8F8ZV6MP9ZRJPEDJX95CW
{"ts":"2025-11-27T03:21:30.319Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"7df04b66-e9be-4d5b-a625-22a75e54e6b3","stage":"booking","correlationId":"booking-created:7744804ef619270c4783ee82"}
{"ts":"2025-11-27T03:21:30.470Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"31d2dcc2-001f-4e61-bea7-a8f28bd0e28a","stage":"booking","correlationId":"booking-created:c835785beaf285ba175d8b29","attempts":5}
üìÖ Processing booking created for customer: 3SRPVX1CXRGXHEZF1CFPEPKXXR
Full booking data: {
  "id": "2jfayu2eud1swb",
  "allDay": false,
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94123-3940",
    "addressLine1": "2266 Union St",
    "addressLine2": "",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-11-26T22:00:00Z",
  "version": 3,
  "createdAt": "2025-11-25T21:52:36Z",
  "updatedAt": "2025-11-27T00:35:01Z",
  "customerId": "3SRPVX1CXRGXHEZF1CFPEPKXXR",
  "locationId": "LT4ZHFBQQYB2N",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "3SRPVX1CXRGXHEZF1CFPEPKXXR",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMOscywuGXO2VURY",
      "anyTeamMember": false,
      "durationMinutes": 140,
      "serviceVariationId": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1763586786564"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Viivi Reinikainen
üéâ First booking detected for customer: 3SRPVX1CXRGXHEZF1CFPEPKXXR
   Name: Viivi Reinikainen
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 3SRPVX1CXRGXHEZF1CFPEPKXXR...
Error getting custom attributes for customer 3SRPVX1CXRGXHEZF1CFPEPKXXR: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 3SRPVX1CXRGXHEZF1CFPEPKXXR
{"ts":"2025-11-27T03:21:30.766Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"31d2dcc2-001f-4e61-bea7-a8f28bd0e28a","stage":"booking","correlationId":"booking-created:c835785beaf285ba175d8b29"}
{"ts":"2025-11-27T03:21:30.919Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"44973c14-22de-4e4e-8899-b1cc362c1360","stage":"booking","correlationId":"booking-created:19d8e0398497993735805746","attempts":5}
üìÖ Processing booking created for customer: B0TFED2MZQF2ZBTWN3Z90W5T0M
Full booking data: {
  "id": "pcw42rtdig9feg",
  "allDay": false,
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94133-4608",
    "addressLine1": "550 Pacific Ave",
    "addressLine2": "",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-11-26T22:00:00Z",
  "version": 2,
  "createdAt": "2025-11-26T03:10:07Z",
  "updatedAt": "2025-11-26T23:05:12Z",
  "customerId": "B0TFED2MZQF2ZBTWN3Z90W5T0M",
  "locationId": "LNQKVBTQZN3EZ",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "B0TFED2MZQF2ZBTWN3Z90W5T0M",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "resourceIds": [
        "5OVIQ6GSSUXORACP6T7WBAQ7"
      ],
      "teamMemberId": "TMXiw38Bbb7XQUWI",
      "anyTeamMember": false,
      "durationMinutes": 90,
      "serviceVariationId": "ZEAKNB35I37RMXNUBGWDZQIM",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1760895536505"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Yuyu Zhu
üéâ First booking detected for customer: B0TFED2MZQF2ZBTWN3Z90W5T0M
   Name: Yuyu Zhu
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer B0TFED2MZQF2ZBTWN3Z90W5T0M...
Error getting custom attributes for customer B0TFED2MZQF2ZBTWN3Z90W5T0M: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: B0TFED2MZQF2ZBTWN3Z90W5T0M
{"ts":"2025-11-27T03:21:31.218Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"44973c14-22de-4e4e-8899-b1cc362c1360","stage":"booking","correlationId":"booking-created:19d8e0398497993735805746"}
{"ts":"2025-11-27T03:21:31.369Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"92b16bc5-6b01-45ad-bd5e-281a88451696","stage":"booking","correlationId":"booking-created:00b84497197175bf1931dad2","attempts":5}
üìÖ Processing booking created for customer: KJQXREZVBXEZX3BCR3FB4RFCPC
Full booking data: {
  "id": "0eqq4jufz96257",
  "allDay": false,
  "source": "THIRD_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94123-3940",
    "addressLine1": "2266 Union St",
    "addressLine2": "",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-11-26T22:20:00Z",
  "version": 3,
  "createdAt": "2025-11-18T01:13:11Z",
  "updatedAt": "2025-11-27T00:11:57Z",
  "customerId": "KJQXREZVBXEZX3BCR3FB4RFCPC",
  "locationId": "LT4ZHFBQQYB2N",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "KJQXREZVBXEZX3BCR3FB4RFCPC",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMkdrQsxG5tlf-c_",
      "anyTeamMember": false,
      "durationMinutes": 180,
      "serviceVariationId": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1758927251718"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Mikaela Farhart
üéâ First booking detected for customer: KJQXREZVBXEZX3BCR3FB4RFCPC
   Name: Mikaela Farhart
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer KJQXREZVBXEZX3BCR3FB4RFCPC...
Error getting custom attributes for customer KJQXREZVBXEZX3BCR3FB4RFCPC: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: KJQXREZVBXEZX3BCR3FB4RFCPC
{"ts":"2025-11-27T03:21:31.677Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"92b16bc5-6b01-45ad-bd5e-281a88451696","stage":"booking","correlationId":"booking-created:00b84497197175bf1931dad2"}
{"ts":"2025-11-27T03:21:31.826Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"b8b06be1-9ab6-4648-83bc-dec8f0f205f9","stage":"booking","correlationId":"booking-created:0e52a41f06dfbcc6cb46907b","attempts":5}
üìÖ Processing booking created for customer: 7H49SZHTYE9SKVTF7P60938FQM
Full booking data: {
  "id": "cpid1k1scxdn8w",
  "allDay": false,
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "startAt": "2025-11-26T23:00:00Z",
  "version": 2,
  "createdAt": "2025-11-23T19:14:19Z",
  "updatedAt": "2025-11-27T01:03:16Z",
  "customerId": "7H49SZHTYE9SKVTF7P60938FQM",
  "locationId": "LT4ZHFBQQYB2N",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "creatorType": "TEAM_MEMBER",
    "teamMemberId": "TMQPbDVvvOCLwqsy"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TM9jDlRr_Hl4rdBB",
      "anyTeamMember": false,
      "durationMinutes": 90,
      "serviceVariationId": "XBUDIMNKOPC2XVG5YLIQ4RYS",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1762893947284"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Elisabeth Kirkwood
üéâ First booking detected for customer: 7H49SZHTYE9SKVTF7P60938FQM
   Name: Elisabeth Kirkwood
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 7H49SZHTYE9SKVTF7P60938FQM...
Error getting custom attributes for customer 7H49SZHTYE9SKVTF7P60938FQM: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 7H49SZHTYE9SKVTF7P60938FQM
{"ts":"2025-11-27T03:21:32.131Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"b8b06be1-9ab6-4648-83bc-dec8f0f205f9","stage":"booking","correlationId":"booking-created:0e52a41f06dfbcc6cb46907b"}
{"ts":"2025-11-27T03:21:32.282Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"036d80c8-4bca-43de-bf3c-ec9064b234d5","stage":"booking","correlationId":"booking-created:d40336d8bd920c82cee0f54e","attempts":5}
üìÖ Processing booking created for customer: 5XPR0DXFYVRXR2RVADAC7QAAXM
Full booking data: {
  "id": "ulg7j0r3xm07w0",
  "allDay": false,
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "startAt": "2025-11-26T23:00:00Z",
  "version": 5,
  "createdAt": "2025-11-25T17:49:44Z",
  "updatedAt": "2025-11-27T00:26:37Z",
  "customerId": "5XPR0DXFYVRXR2RVADAC7QAAXM",
  "locationId": "LNQKVBTQZN3EZ",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "creatorType": "TEAM_MEMBER",
    "teamMemberId": "TMWAtQTYmZpwwxii"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMVwAQUdLz6no-cB",
      "anyTeamMember": false,
      "durationMinutes": 90,
      "serviceVariationId": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1763586786564"
    },
    {
      "teamMemberId": "TMVwAQUdLz6no-cB",
      "anyTeamMember": false,
      "durationMinutes": 20,
      "serviceVariationId": "HAJX45W3U2WUCCXM5MI24UEE",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1763586786564"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Mohini P
üéâ First booking detected for customer: 5XPR0DXFYVRXR2RVADAC7QAAXM
   Name: Mohini P
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 5XPR0DXFYVRXR2RVADAC7QAAXM...
Error getting custom attributes for customer 5XPR0DXFYVRXR2RVADAC7QAAXM: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 5XPR0DXFYVRXR2RVADAC7QAAXM
{"ts":"2025-11-27T03:21:32.582Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"036d80c8-4bca-43de-bf3c-ec9064b234d5","stage":"booking","correlationId":"booking-created:d40336d8bd920c82cee0f54e"}
{"ts":"2025-11-27T03:21:32.734Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"90131415-0b40-413e-9073-f3d076668381","stage":"booking","correlationId":"booking-created:feb6f4e272836841371f0544","attempts":5}
üìÖ Processing booking created for customer: YDJY525GK5JNWTFA9AGQ4GXNTG
Full booking data: {
  "id": "v0rh381gsbr6wq",
  "allDay": false,
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "startAt": "2025-11-26T23:00:00Z",
  "version": 3,
  "createdAt": "2025-11-26T18:12:12Z",
  "updatedAt": "2025-11-27T01:06:42Z",
  "customerId": "YDJY525GK5JNWTFA9AGQ4GXNTG",
  "locationId": "LT4ZHFBQQYB2N",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "creatorType": "TEAM_MEMBER",
    "teamMemberId": "TMQPbDVvvOCLwqsy"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMMHlgFBIFbMTRap",
      "anyTeamMember": false,
      "durationMinutes": 120,
      "serviceVariationId": "HXLBKQC3DRE57DB7IK5RBYOB",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1758654327496"
    },
    {
      "teamMemberId": "TMMHlgFBIFbMTRap",
      "anyTeamMember": false,
      "durationMinutes": 20,
      "serviceVariationId": "HAJX45W3U2WUCCXM5MI24UEE",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1763586786564"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Mariana Tepi
üéâ First booking detected for customer: YDJY525GK5JNWTFA9AGQ4GXNTG
   Name: Mariana Tepi
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer YDJY525GK5JNWTFA9AGQ4GXNTG...
Error getting custom attributes for customer YDJY525GK5JNWTFA9AGQ4GXNTG: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: YDJY525GK5JNWTFA9AGQ4GXNTG
{"ts":"2025-11-27T03:21:33.031Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"90131415-0b40-413e-9073-f3d076668381","stage":"booking","correlationId":"booking-created:feb6f4e272836841371f0544"}
{"ts":"2025-11-27T03:21:33.184Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"47c5d7ad-c7ce-47c6-8afd-930dd6295b9d","stage":"booking","correlationId":"booking-created:544612a0cc400777003d99a9","attempts":5}
üìÖ Processing booking created for customer: 2AXPGQXKFWVMJTJ7GBRZQNPS68
Full booking data: {
  "id": "hv7d9p7nipeh6o",
  "allDay": false,
  "source": "FIRST_PARTY_MERCHANT",
  "status": "CANCELLED_BY_SELLER",
  "startAt": "2025-11-26T23:20:00Z",
  "version": 1,
  "createdAt": "2025-11-26T21:10:33Z",
  "updatedAt": "2025-11-26T23:34:20Z",
  "customerId": "2AXPGQXKFWVMJTJ7GBRZQNPS68",
  "locationId": "LT4ZHFBQQYB2N",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "creatorType": "TEAM_MEMBER",
    "teamMemberId": "TMQPbDVvvOCLwqsy"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMe-bT5XxKxmk0nw",
      "anyTeamMember": false,
      "durationMinutes": 30,
      "serviceVariationId": "SGSLS3INMK5YV637KUITCILL",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1760895536505"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Consuelo Reyes Lopez
üéâ First booking detected for customer: 2AXPGQXKFWVMJTJ7GBRZQNPS68
   Name: Consuelo Reyes Lopez
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 2AXPGQXKFWVMJTJ7GBRZQNPS68...
Error getting custom attributes for customer 2AXPGQXKFWVMJTJ7GBRZQNPS68: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 2AXPGQXKFWVMJTJ7GBRZQNPS68
{"ts":"2025-11-27T03:21:33.482Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"47c5d7ad-c7ce-47c6-8afd-930dd6295b9d","stage":"booking","correlationId":"booking-created:544612a0cc400777003d99a9"}
{"ts":"2025-11-27T03:21:33.635Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"7069dcfa-1813-46a2-906f-a9c4d3d2930a","stage":"booking","correlationId":"booking-created:7c589228630a56eff0153563","attempts":5}
üìÖ Processing booking created for customer: 96VR772N3HB2XYC515RY8SGNC0
Full booking data: {
  "id": "fxa7hrmb92j840",
  "allDay": false,
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94133-4608",
    "addressLine1": "550 Pacific Ave",
    "addressLine2": "",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-11-26T23:30:00Z",
  "version": 3,
  "createdAt": "2025-11-25T02:44:49Z",
  "updatedAt": "2025-11-27T00:31:06Z",
  "customerId": "96VR772N3HB2XYC515RY8SGNC0",
  "locationId": "LNQKVBTQZN3EZ",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "96VR772N3HB2XYC515RY8SGNC0",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "resourceIds": [
        "5OVIQ6GSSUXORACP6T7WBAQ7"
      ],
      "teamMemberId": "TMXiw38Bbb7XQUWI",
      "anyTeamMember": false,
      "durationMinutes": 60,
      "serviceVariationId": "SBE5XUATXRM76CBTT25HL2NZ",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1760895536505"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Fati Zahra
üéâ First booking detected for customer: 96VR772N3HB2XYC515RY8SGNC0
   Name: Fati Zahra
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 96VR772N3HB2XYC515RY8SGNC0...
Error getting custom attributes for customer 96VR772N3HB2XYC515RY8SGNC0: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 96VR772N3HB2XYC515RY8SGNC0
{"ts":"2025-11-27T03:21:33.971Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"7069dcfa-1813-46a2-906f-a9c4d3d2930a","stage":"booking","correlationId":"booking-created:7c589228630a56eff0153563"}
{"ts":"2025-11-27T03:21:34.125Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"a531c97f-cdf1-4077-9799-3ef02a06cb9b","stage":"booking","correlationId":"booking-created:730bebda5825fafb8d4c2201","attempts":5}
üìÖ Processing booking created for customer: 96VR772N3HB2XYC515RY8SGNC0
Full booking data: {
  "id": "qf995cblt015de",
  "allDay": false,
  "source": "FIRST_PARTY_BUYER",
  "status": "CANCELLED_BY_CUSTOMER",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94133-4608",
    "addressLine1": "550 Pacific Ave",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-11-26T23:40:00Z",
  "version": 1,
  "createdAt": "2025-11-23T04:15:43Z",
  "updatedAt": "2025-11-25T02:43:14Z",
  "customerId": "96VR772N3HB2XYC515RY8SGNC0",
  "locationId": "LNQKVBTQZN3EZ",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "96VR772N3HB2XYC515RY8SGNC0",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "resourceIds": [
        "5OVIQ6GSSUXORACP6T7WBAQ7"
      ],
      "teamMemberId": "TMXiw38Bbb7XQUWI",
      "anyTeamMember": false,
      "durationMinutes": 90,
      "serviceVariationId": "ZEAKNB35I37RMXNUBGWDZQIM",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1760895536505"
    },
    {
      "teamMemberId": "TMXiw38Bbb7XQUWI",
      "anyTeamMember": false,
      "durationMinutes": 20,
      "serviceVariationId": "HAJX45W3U2WUCCXM5MI24UEE",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1763586786564"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Fati Zahra
üéâ First booking detected for customer: 96VR772N3HB2XYC515RY8SGNC0
   Name: Fati Zahra
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 96VR772N3HB2XYC515RY8SGNC0...
Error getting custom attributes for customer 96VR772N3HB2XYC515RY8SGNC0: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 96VR772N3HB2XYC515RY8SGNC0
{"ts":"2025-11-27T03:21:34.426Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"a531c97f-cdf1-4077-9799-3ef02a06cb9b","stage":"booking","correlationId":"booking-created:730bebda5825fafb8d4c2201"}
{"ts":"2025-11-27T03:21:34.583Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"4bc5c9b1-500c-408d-a03f-971defadc14c","stage":"booking","correlationId":"booking-created:676f3578ef5b875dcc443f77","attempts":5}
üìÖ Processing booking created for customer: HMV279V4SQ6K17R0ZFF8W2VJ2G
Full booking data: {
  "id": "i3buqij4jm1tjo",
  "allDay": false,
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94133-4608",
    "addressLine1": "550 Pacific Ave",
    "addressLine2": "",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-11-27T00:00:00Z",
  "version": 2,
  "createdAt": "2025-11-18T00:39:02Z",
  "updatedAt": "2025-11-27T02:37:57Z",
  "customerId": "HMV279V4SQ6K17R0ZFF8W2VJ2G",
  "locationId": "LNQKVBTQZN3EZ",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "HMV279V4SQ6K17R0ZFF8W2VJ2G",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMSt73bSp59caRzt",
      "anyTeamMember": false,
      "durationMinutes": 140,
      "serviceVariationId": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1758927251718"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Kathleen Zhen
üéâ First booking detected for customer: HMV279V4SQ6K17R0ZFF8W2VJ2G
   Name: Kathleen Zhen
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer HMV279V4SQ6K17R0ZFF8W2VJ2G...
Error getting custom attributes for customer HMV279V4SQ6K17R0ZFF8W2VJ2G: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: HMV279V4SQ6K17R0ZFF8W2VJ2G
{"ts":"2025-11-27T03:21:34.882Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"4bc5c9b1-500c-408d-a03f-971defadc14c","stage":"booking","correlationId":"booking-created:676f3578ef5b875dcc443f77"}
{"ts":"2025-11-27T03:21:35.039Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"e8a1f291-647c-40bf-b0a2-dbfb4dd6b246","stage":"booking","correlationId":"booking-created:c686e8811b7eb31ba083515c","attempts":5}
üìÖ Processing booking created for customer: G2G9B9AAYNJ6PFPKRTGQGKAMVW
Full booking data: {
  "id": "op1auc66dqu7t1",
  "allDay": false,
  "source": "THIRD_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94133-4608",
    "addressLine1": "550 Pacific Ave",
    "addressLine2": "",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-11-27T00:00:00Z",
  "version": 2,
  "createdAt": "2025-11-18T00:45:28Z",
  "updatedAt": "2025-11-27T02:37:22Z",
  "customerId": "G2G9B9AAYNJ6PFPKRTGQGKAMVW",
  "locationId": "LNQKVBTQZN3EZ",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "G2G9B9AAYNJ6PFPKRTGQGKAMVW",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TM-zXe9fXe4axYWn",
      "anyTeamMember": false,
      "durationMinutes": 140,
      "serviceVariationId": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1758927251718"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Anna Lee
üéâ First booking detected for customer: G2G9B9AAYNJ6PFPKRTGQGKAMVW
   Name: Anna Lee
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer G2G9B9AAYNJ6PFPKRTGQGKAMVW...
Error getting custom attributes for customer G2G9B9AAYNJ6PFPKRTGQGKAMVW: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: G2G9B9AAYNJ6PFPKRTGQGKAMVW
{"ts":"2025-11-27T03:21:35.346Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"e8a1f291-647c-40bf-b0a2-dbfb4dd6b246","stage":"booking","correlationId":"booking-created:c686e8811b7eb31ba083515c"}
{"ts":"2025-11-27T03:21:35.497Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"e850a795-d287-4368-9d55-9dac5b8d3089","stage":"booking","correlationId":"booking-created:78a35a114d2d84a96ba6fcc1","attempts":5}
üìÖ Processing booking created for customer: G4HVDH60ZECH3HNAEEA9HEY4C4
Full booking data: {
  "id": "zb2776a0hz7x59",
  "allDay": false,
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94133-4608",
    "addressLine1": "550 Pacific Ave",
    "addressLine2": "",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-11-27T00:00:00Z",
  "version": 2,
  "createdAt": "2025-11-25T05:18:21Z",
  "updatedAt": "2025-11-27T01:45:42Z",
  "customerId": "G4HVDH60ZECH3HNAEEA9HEY4C4",
  "locationId": "LNQKVBTQZN3EZ",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "G4HVDH60ZECH3HNAEEA9HEY4C4",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMMBgVwykMnOlumA",
      "anyTeamMember": false,
      "durationMinutes": 140,
      "serviceVariationId": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1763586786564"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Lindsey Broderick
üéâ First booking detected for customer: G4HVDH60ZECH3HNAEEA9HEY4C4
   Name: Lindsey Broderick
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer G4HVDH60ZECH3HNAEEA9HEY4C4...
Error getting custom attributes for customer G4HVDH60ZECH3HNAEEA9HEY4C4: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: G4HVDH60ZECH3HNAEEA9HEY4C4
{"ts":"2025-11-27T03:21:35.801Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"e850a795-d287-4368-9d55-9dac5b8d3089","stage":"booking","correlationId":"booking-created:78a35a114d2d84a96ba6fcc1"}
{"ts":"2025-11-27T03:21:35.956Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"7744c5b9-00bf-4e1f-b708-4f25a44f4009","stage":"payment","correlationId":"payment-updated:014a5fd451f2a2b7386bf0e4","attempts":5}
üí∞ Processing payment completion for customer: G8QADD30N7BTWC5XHA67ZHMWQR
   Payment source_type: unknown
   Payment tender_types: []
Customer G8QADD30N7BTWC5XHA67ZHMWQR already completed first payment
{"ts":"2025-11-27T03:21:36.106Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"7744c5b9-00bf-4e1f-b708-4f25a44f4009","stage":"payment","correlationId":"payment-updated:014a5fd451f2a2b7386bf0e4"}
{"ts":"2025-11-27T03:21:36.258Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"2e0eb346-8267-4d2d-a28a-52e1280d1518","stage":"payment","correlationId":"payment-updated:231c14d285303bc7d5b47a10","attempts":5}
üí∞ Processing payment completion for customer: 4WJGDZ5WTJF5Z9D8DYE0FNH1NM
   Payment source_type: unknown
   Payment tender_types: []
Customer 4WJGDZ5WTJF5Z9D8DYE0FNH1NM already completed first payment
{"ts":"2025-11-27T03:21:36.396Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"2e0eb346-8267-4d2d-a28a-52e1280d1518","stage":"payment","correlationId":"payment-updated:231c14d285303bc7d5b47a10"}
{"ts":"2025-11-27T03:21:36.548Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"f03255d6-da65-4cb7-b31d-24787d680c6e","stage":"payment","correlationId":"payment-updated:871c69599190c117d68edaa6","attempts":5}
üí∞ Processing payment completion for customer: DRFXAJ6GZFBTE8YXSJCXX66YWC
   Payment source_type: unknown
   Payment tender_types: []
Customer DRFXAJ6GZFBTE8YXSJCXX66YWC already completed first payment
{"ts":"2025-11-27T03:21:36.677Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"f03255d6-da65-4cb7-b31d-24787d680c6e","stage":"payment","correlationId":"payment-updated:871c69599190c117d68edaa6"}
{"ts":"2025-11-27T03:21:36.828Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"ff8456e0-a59f-47ae-9123-368f927976b3","stage":"payment","correlationId":"payment-updated:96257c287ee8a21da9826c28","attempts":5}
üí∞ Processing payment completion for customer: YWCBDR0AG95D90PRDFXT0EFRGC
   Payment source_type: unknown
   Payment tender_types: []
Customer YWCBDR0AG95D90PRDFXT0EFRGC already completed first payment
{"ts":"2025-11-27T03:21:36.956Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"ff8456e0-a59f-47ae-9123-368f927976b3","stage":"payment","correlationId":"payment-updated:96257c287ee8a21da9826c28"}
{"ts":"2025-11-27T03:21:37.108Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"79daa47d-3ca0-42bc-8377-1e8b72f8a377","stage":"payment","correlationId":"payment-updated:8f00cb48a9a30f37d8e87f5d","attempts":5}
üí∞ Processing payment completion for customer: W56S712KAJK7A6QNBQ5A03ETGC
   Payment source_type: unknown
   Payment tender_types: []
Customer W56S712KAJK7A6QNBQ5A03ETGC already completed first payment
{"ts":"2025-11-27T03:21:37.239Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"79daa47d-3ca0-42bc-8377-1e8b72f8a377","stage":"payment","correlationId":"payment-updated:8f00cb48a9a30f37d8e87f5d"}
{"ts":"2025-11-27T03:21:37.403Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"49af8431-b1da-4d56-afad-ad3b1b834513","stage":"payment","correlationId":"payment-updated:4ef19a48b751e2c0088a1c80","attempts":5}
üí∞ Processing payment completion for customer: TMM4E9TT9TBH9KEQ32M92QBBQC
   Payment source_type: unknown
   Payment tender_types: []
Customer TMM4E9TT9TBH9KEQ32M92QBBQC already completed first payment
{"ts":"2025-11-27T03:21:37.547Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"49af8431-b1da-4d56-afad-ad3b1b834513","stage":"payment","correlationId":"payment-updated:4ef19a48b751e2c0088a1c80"}
{"ts":"2025-11-27T03:21:37.701Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"749afdf6-0900-4b58-b87f-797379b581ed","stage":"payment","correlationId":"payment-updated:207a2363049208bd9d9d9697","attempts":5}
üí∞ Processing payment completion for customer: KJQXREZVBXEZX3BCR3FB4RFCPC
   Payment source_type: unknown
   Payment tender_types: []
Customer KJQXREZVBXEZX3BCR3FB4RFCPC already completed first payment
{"ts":"2025-11-27T03:21:37.831Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"749afdf6-0900-4b58-b87f-797379b581ed","stage":"payment","correlationId":"payment-updated:207a2363049208bd9d9d9697"}
{"ts":"2025-11-27T04:02:40.646Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"f297d4f3-af02-4737-80f7-42e870050cfb","stage":"payment","correlationId":"payment-updated:337f19f697c8f740dd1e3dc3","attempts":1}
üí∞ Processing payment completion for customer: FYDZMN6RDQ1K2MGP6KK66KG20W
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Kate Vynogradna
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Kate Vynogradna, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Kate Vynogradna
   - Email: me.sasha.fierce@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: FYDZMN6RDQ1K2MGP6KK66KG20W
{"ts":"2025-11-27T04:02:41.211Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"f297d4f3-af02-4737-80f7-42e870050cfb","stage":"payment","correlationId":"payment-updated:337f19f697c8f740dd1e3dc3"}
{"ts":"2025-11-27T04:02:47.755Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"88d98328-b726-41f0-8f68-bf0d290a75a0","stage":"payment","correlationId":"payment-updated:bff41e6b63a777f685b89386","attempts":1}
üí∞ Processing payment completion for customer: FYDZMN6RDQ1K2MGP6KK66KG20W
   Payment source_type: CARD
   Payment tender_types: []
Customer FYDZMN6RDQ1K2MGP6KK66KG20W already completed first payment
{"ts":"2025-11-27T04:02:47.891Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"88d98328-b726-41f0-8f68-bf0d290a75a0","stage":"payment","correlationId":"payment-updated:bff41e6b63a777f685b89386"}
{"ts":"2025-11-27T04:03:28.605Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"b91e72af-cbab-47a9-9e4b-14a02d6bbbc0","stage":"payment","correlationId":"payment-updated:2e06c0456f7129f5651491ba","attempts":1}
üí∞ Processing payment completion for customer: FYDZMN6RDQ1K2MGP6KK66KG20W
   Payment source_type: CARD
   Payment tender_types: []
Customer FYDZMN6RDQ1K2MGP6KK66KG20W already completed first payment
{"ts":"2025-11-27T04:03:28.860Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"b91e72af-cbab-47a9-9e4b-14a02d6bbbc0","stage":"payment","correlationId":"payment-updated:2e06c0456f7129f5651491ba"}
{"ts":"2025-11-27T04:03:33.321Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"0c26b140-6560-4c49-882b-8bd30a496c74","stage":"payment","correlationId":"payment-updated:df825b33bbc687e683e03345","attempts":1}
üí∞ Processing payment completion for customer: FYDZMN6RDQ1K2MGP6KK66KG20W
   Payment source_type: CARD
   Payment tender_types: []
Customer FYDZMN6RDQ1K2MGP6KK66KG20W already completed first payment
{"ts":"2025-11-27T04:03:33.458Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"0c26b140-6560-4c49-882b-8bd30a496c74","stage":"payment","correlationId":"payment-updated:df825b33bbc687e683e03345"}
{"ts":"2025-11-27T04:11:55.472Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"e852da93-a7e1-45fb-8298-c6da423fa78e","stage":"payment","correlationId":"payment-updated:f7a085ddaa0e0f2dade2b35d","attempts":1}
üí∞ Processing payment completion for customer: 3D7DHB14SV52ZJ5NXY7D77FTKW
   Payment source_type: CASH
   Payment tender_types: []
üéâ First payment completed for customer: Duda Hardt
‚ùå Referrer not found for code: null
‚úÖ First payment processing completed for customer: 3D7DHB14SV52ZJ5NXY7D77FTKW
{"ts":"2025-11-27T04:11:55.977Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"e852da93-a7e1-45fb-8298-c6da423fa78e","stage":"payment","correlationId":"payment-updated:f7a085ddaa0e0f2dade2b35d"}
{"ts":"2025-11-27T04:12:17.411Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"0a4f3dca-504b-4027-953b-588dba5a0345","stage":"payment","correlationId":"payment-updated:825f99a225d7a3a787df6766","attempts":1}
üí∞ Processing payment completion for customer: 3D7DHB14SV52ZJ5NXY7D77FTKW
   Payment source_type: CARD
   Payment tender_types: []
Customer 3D7DHB14SV52ZJ5NXY7D77FTKW already completed first payment
{"ts":"2025-11-27T04:12:17.748Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"0a4f3dca-504b-4027-953b-588dba5a0345","stage":"payment","correlationId":"payment-updated:825f99a225d7a3a787df6766"}
{"ts":"2025-11-27T04:12:22.164Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"6d7d02b6-ff58-4175-b243-c0bc7a26e26c","stage":"payment","correlationId":"payment-updated:e8142602bfba87f2b89f6186","attempts":1}
üí∞ Processing payment completion for customer: 3D7DHB14SV52ZJ5NXY7D77FTKW
   Payment source_type: CARD
   Payment tender_types: []
Customer 3D7DHB14SV52ZJ5NXY7D77FTKW already completed first payment
{"ts":"2025-11-27T04:12:22.300Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"6d7d02b6-ff58-4175-b243-c0bc7a26e26c","stage":"payment","correlationId":"payment-updated:e8142602bfba87f2b89f6186"}
{"ts":"2025-11-27T05:04:10.771Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"701f8124-cdf0-4047-8f6c-2a8779242e04","stage":"booking","correlationId":"booking-created:981acb5ce8349075c0d4d8ee","attempts":1}
üìÖ Processing booking created for customer: A0B97PWEBS6HHR9WC214NYAN70
Full booking data: {
  "id": "9ah6yk5ooidv4s",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-16T00:00:00Z",
  "created_at": "2025-11-27T05:04:08Z",
  "updated_at": "2025-11-27T05:04:08Z",
  "customer_id": "A0B97PWEBS6HHR9WC214NYAN70",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "A0B97PWEBS6HHR9WC214NYAN70",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMXiw38Bbb7XQUWI",
      "any_team_member": true,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Lindsay Hart
üéâ First booking detected for customer: A0B97PWEBS6HHR9WC214NYAN70
   Name: Lindsay Hart
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer A0B97PWEBS6HHR9WC214NYAN70...
Error getting custom attributes for customer A0B97PWEBS6HHR9WC214NYAN70: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: A0B97PWEBS6HHR9WC214NYAN70
{"ts":"2025-11-27T05:04:11.404Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"701f8124-cdf0-4047-8f6c-2a8779242e04","stage":"booking","correlationId":"booking-created:981acb5ce8349075c0d4d8ee"}
{"ts":"2025-11-27T05:15:05.020Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"6c3e05a3-02c8-473c-8c23-431f5d3a5d22","stage":"booking","correlationId":"booking-created:3efe4ae8cdec4920adf51715","attempts":1}
üìÖ Processing booking created for customer: VGFGY7SFHJ6VEJGJ2F0HB15KMM
Full booking data: {
  "id": "6knv2k4jmlnev1",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-22T20:00:00Z",
  "created_at": "2025-11-27T05:15:00Z",
  "updated_at": "2025-11-27T05:15:00Z",
  "customer_id": "VGFGY7SFHJ6VEJGJ2F0HB15KMM",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "VGFGY7SFHJ6VEJGJ2F0HB15KMM",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "resource_ids": [
        "KAOXILA4CV7A23VRAACC4R66"
      ],
      "team_member_id": "TMNW4SIF7tjp4oM_",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "ZEAKNB35I37RMXNUBGWDZQIM",
      "service_variation_version": 1760895536505,
      "service_variation_client_id": "ZEAKNB35I37RMXNUBGWDZQIM"
    },
    {
      "team_member_id": "TMNW4SIF7tjp4oM_",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "BRSIGZFOWC6F4ERPKX3CODLU",
      "service_variation_version": 1764191999049,
      "service_variation_client_id": "BRSIGZFOWC6F4ERPKX3CODLU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: alyson rose
üéâ First booking detected for customer: VGFGY7SFHJ6VEJGJ2F0HB15KMM
   Name: alyson rose
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer VGFGY7SFHJ6VEJGJ2F0HB15KMM...
Error getting custom attributes for customer VGFGY7SFHJ6VEJGJ2F0HB15KMM: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: VGFGY7SFHJ6VEJGJ2F0HB15KMM
{"ts":"2025-11-27T05:15:05.670Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"6c3e05a3-02c8-473c-8c23-431f5d3a5d22","stage":"booking","correlationId":"booking-created:3efe4ae8cdec4920adf51715"}
{"ts":"2025-11-27T05:16:18.681Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"66d2ff99-be18-46ec-89d9-3a7a2cc02deb","stage":"booking","correlationId":"booking-created:f531ff6063af7b7076752c7f","attempts":1}
üìÖ Processing booking created for customer: CTV3ZPHCQX063YDFKWQQPMQ4J8
Full booking data: {
  "id": "r259qnrkvj7u98",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-22T21:00:00Z",
  "created_at": "2025-11-27T05:16:13Z",
  "updated_at": "2025-11-27T05:16:13Z",
  "customer_id": "CTV3ZPHCQX063YDFKWQQPMQ4J8",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "CTV3ZPHCQX063YDFKWQQPMQ4J8",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TM1L5yPC-yKx6CyO",
      "any_team_member": false,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "NCOIL6ZGDTCC7SO3IJHENCQ2",
      "service_variation_version": 1764191999049,
      "service_variation_client_id": "NCOIL6ZGDTCC7SO3IJHENCQ2"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: jennifer j
üéâ First booking detected for customer: CTV3ZPHCQX063YDFKWQQPMQ4J8
   Name: jennifer j
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer CTV3ZPHCQX063YDFKWQQPMQ4J8...
Error getting custom attributes for customer CTV3ZPHCQX063YDFKWQQPMQ4J8: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: CTV3ZPHCQX063YDFKWQQPMQ4J8
{"ts":"2025-11-27T05:16:19.252Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"66d2ff99-be18-46ec-89d9-3a7a2cc02deb","stage":"booking","correlationId":"booking-created:f531ff6063af7b7076752c7f"}
{"ts":"2025-11-27T06:05:50.155Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"c7d84c53-48d3-46a3-a21b-79ee85a6fb6d","stage":"booking","correlationId":"booking-created:fa7fadc25867796d2c125b2b","attempts":1}
üìÖ Processing booking created for customer: D8JTZHGZ6Z5JAX3HJCHWBCPRVW
Full booking data: {
  "id": "dlapy8h1fiiup6",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-10T18:00:00Z",
  "created_at": "2025-11-27T06:05:47Z",
  "updated_at": "2025-11-27T06:05:47Z",
  "customer_id": "D8JTZHGZ6Z5JAX3HJCHWBCPRVW",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "D8JTZHGZ6Z5JAX3HJCHWBCPRVW",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMMCVDJoKh3ZkfFo",
      "any_team_member": true,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Rabun Jones
üéâ First booking detected for customer: D8JTZHGZ6Z5JAX3HJCHWBCPRVW
   Name: Rabun Jones
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer D8JTZHGZ6Z5JAX3HJCHWBCPRVW...
Error getting custom attributes for customer D8JTZHGZ6Z5JAX3HJCHWBCPRVW: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: D8JTZHGZ6Z5JAX3HJCHWBCPRVW
{"ts":"2025-11-27T06:05:50.936Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"c7d84c53-48d3-46a3-a21b-79ee85a6fb6d","stage":"booking","correlationId":"booking-created:fa7fadc25867796d2c125b2b"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Timed out fetching a new connection from the connection pool. More info: http://pris.ly/d/connection-pool (Current connection pool timeout: 10, connection limit: 21)
{"ts":"2025-11-27T09:11:27.525Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"50dfa8fe-ece5-41c8-9518-f59799c92e5a","stage":"payment","correlationId":"payment-updated:30013036ee53dafbd18823a4","attempts":1}
No customer ID in payment data, skipping...
Payment data received: {
  "id": "73N2tFfiecH6jcxnqPK6qkss8cRZY",
  "status": "COMPLETED",
  "version": 3,
  "order_id": "HX3n7JJG0l5fdtBijEkwy2DPjOJZY",
  "created_at": "2025-11-27T09:11:19.777Z",
  "updated_at": "2025-11-27T09:11:23.107Z",
  "location_id": "LT4ZHFBQQYB2N",
  "receipt_url": "https://squareup.com/receipt/preview/73N2tFfiecH6jcxnqPK6qkss8cRZY",
  "source_type": "CARD",
  "total_money": {
    "amount": 10000,
    "currency": "USD"
  },
  "amount_money": {
    "amount": 10000,
    "currency": "USD"
  },
  "card_details": {
    "card": {
      "bin": "454638",
      "last_4": "2922",
      "exp_year": 2026,
      "card_type": "CREDIT",
      "exp_month": 9,
      "card_brand": "VISA",
      "fingerprint": "sq-1-iVgtlVjnPlIg61AZoVneWBR03iMIXkLQqWn0hPLiX9i_6nmfeKjuUxhqGO01rNad_w",
      "prepaid_type": "NOT_PREPAID",
      "payment_account_reference": "V0010014618285395942263775097"
    },
    "status": "CAPTURED",
    "avs_status": "AVS_ACCEPTED",
    "cvv_status": "CVV_ACCEPTED",
    "entry_method": "KEYED",
    "auth_result_code": "000517",
    "card_payment_timeline": {
      "captured_at": "2025-11-27T09:11:21.140Z",
      "authorized_at": "2025-11-27T09:11:20.505Z"
    },
    "statement_description": "SQ *ZORINA NAIL STUDIO 2"
  },
  "delay_action": "CANCEL",
  "delayed_until": "2025-12-04T09:11:19.777Z",
  "approved_money": {
    "amount": 10000,
    "currency": "USD"
  },
  "delay_duration": "PT168H",
  "receipt_number": "73N2",
  "risk_evaluation": {
    "created_at": "2025-11-27T09:11:21.031Z",
    "risk_level": "NORMAL"
  },
  "application_details": {
    "application_id": "sq0idp-LnQlDEBJrriD2F3rrhnmtg",
    "square_product": "OTHER"
  },
  "buyer_email_address": "robertahowett7@gmail.com"
}
{"ts":"2025-11-27T09:11:27.730Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"50dfa8fe-ece5-41c8-9518-f59799c92e5a","stage":"payment","correlationId":"payment-updated:30013036ee53dafbd18823a4"}
{"ts":"2025-11-27T09:11:27.899Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"98511dbf-bef0-4528-a542-2e845f078a8b","stage":"payment","correlationId":"payment-updated:57c22eb3f43b80752a8faea4","attempts":1}
üí∞ Processing payment completion for customer: QAQPFCD6E28NPXV17DP00ZQ7AW
   Payment source_type: CARD
   Payment tender_types: []
Customer QAQPFCD6E28NPXV17DP00ZQ7AW not found in database
{"ts":"2025-11-27T09:11:28.178Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"98511dbf-bef0-4528-a542-2e845f078a8b","stage":"payment","correlationId":"payment-updated:57c22eb3f43b80752a8faea4"}
{"ts":"2025-11-27T09:11:28.341Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"246da476-945b-44c7-9731-ca77360e94e0","stage":"payment","correlationId":"payment-updated:dd49831b487ffb3c625c9e93","attempts":1}
üí∞ Processing payment completion for customer: QAQPFCD6E28NPXV17DP00ZQ7AW
   Payment source_type: CARD
   Payment tender_types: []
Customer QAQPFCD6E28NPXV17DP00ZQ7AW not found in database
{"ts":"2025-11-27T09:11:28.476Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"246da476-945b-44c7-9731-ca77360e94e0","stage":"payment","correlationId":"payment-updated:dd49831b487ffb3c625c9e93"}
{"ts":"2025-11-27T09:11:28.640Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"3fa4b2d8-5dbd-416f-8ee0-199bf0c8d2cc","stage":"customer_ingest","correlationId":"customer-created:329124b102d6ce23a3c604f8","attempts":1}
üì• Received customer data: {
  "id": "QAQPFCD6E28NPXV17DP00ZQ7AW",
  "version": 0,
  "created_at": "2025-11-27T09:11:23.275Z",
  "given_name": "Roberta",
  "updated_at": "2025-11-27T09:11:23Z",
  "family_name": "Howett",
  "preferences": {
    "email_unsubscribed": false
  },
  "email_address": "robertahowett7@gmail.com",
  "creation_source": "EGIFTING"
}
üë§ Processing customer creation: QAQPFCD6E28NPXV17DP00ZQ7AW
üìç IP Address: unknown
Error retrieving Square customer QAQPFCD6E28NPXV17DP00ZQ7AW: Response status code was not ok: 401.
Square API errors: [
  {
    "category": "AUTHENTICATION_ERROR",
    "code": "UNAUTHORIZED",
    "detail": "This request could not be authorized."
  }
]
üìß Email: robertahowett7@gmail.com
üìû Phone: None
üë§ Name: Roberta Howett
‚ö†Ô∏è Suspicious IP activity detected: unknown used by 94 customers
‚ö†Ô∏è Suspicious activity detected for customer QAQPFCD6E28NPXV17DP00ZQ7AW, flagging for review
üéâ New customer detected: QAQPFCD6E28NPXV17DP00ZQ7AW
‚úÖ Customer added to database as NEW (temporary mark)
   - Will check for referral code when they book
   - Will give gift card on first booking if code found
‚úÖ Verification: Customer found in DB: true
{"ts":"2025-11-27T09:11:29.085Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"3fa4b2d8-5dbd-416f-8ee0-199bf0c8d2cc","stage":"customer_ingest","correlationId":"customer-created:329124b102d6ce23a3c604f8"}
{"ts":"2025-11-27T09:11:29.244Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"b12c4b45-4fae-47f3-a0ec-235d8e69d953","stage":"customer_ingest","correlationId":"customer-created:bc8189bfdc665f596e8cc5ba","attempts":1}
üì• Received customer data: {
  "id": "44CDY5T8CF1AT82BB0DYKBNECW",
  "version": 0,
  "created_at": "2025-11-27T09:11:25.377Z",
  "updated_at": "2025-11-27T09:11:25Z",
  "preferences": {
    "email_unsubscribed": false
  },
  "email_address": "nevejoyce@gmail.com",
  "creation_source": "EGIFTING"
}
üë§ Processing customer creation: 44CDY5T8CF1AT82BB0DYKBNECW
üìç IP Address: unknown
Error retrieving Square customer 44CDY5T8CF1AT82BB0DYKBNECW: Response status code was not ok: 401.
Square API errors: [
  {
    "category": "AUTHENTICATION_ERROR",
    "code": "UNAUTHORIZED",
    "detail": "This request could not be authorized."
  }
]
üìß Email: nevejoyce@gmail.com
üìû Phone: None
üë§ Name:  
‚ö†Ô∏è Suspicious IP activity detected: unknown used by 95 customers
‚ö†Ô∏è Suspicious activity detected for customer 44CDY5T8CF1AT82BB0DYKBNECW, flagging for review
üéâ New customer detected: 44CDY5T8CF1AT82BB0DYKBNECW
‚úÖ Customer added to database as NEW (temporary mark)
   - Will check for referral code when they book
   - Will give gift card on first booking if code found
‚úÖ Verification: Customer found in DB: true
{"ts":"2025-11-27T09:11:29.652Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"b12c4b45-4fae-47f3-a0ec-235d8e69d953","stage":"customer_ingest","correlationId":"customer-created:bc8189bfdc665f596e8cc5ba"}
{"ts":"2025-11-27T09:13:27.362Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"be8d4ebe-21fb-4c44-a670-77570e376249","stage":"payment","correlationId":"payment-updated:7ea42d0927ffb22c9bdb1a4c","attempts":1}
üí∞ Processing payment completion for customer: QAQPFCD6E28NPXV17DP00ZQ7AW
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Roberta Howett
‚ùå Referrer not found for code: null
‚úÖ Generated new personal_code in name+ID format: ROBERTA7007
‚ùå Error creating/loading gift card for Roberta Howett: Response status code was not ok: 401.
Square API errors: [
  {
    "category": "AUTHENTICATION_ERROR",
    "code": "UNAUTHORIZED",
    "detail": "This request could not be authorized."
  }
]
‚ùå Failed to create referrer gift card
Error upserting custom attribute "square:a3dde506-f69e-48e4-a98a-004c1822d3ad" for customer QAQPFCD6E28NPXV17DP00ZQ7AW: Response status code was not ok: 401.
Square API errors: [
  {
    "category": "AUTHENTICATION_ERROR",
    "code": "UNAUTHORIZED",
    "detail": "This request could not be authorized."
  }
]
Error appending referral note for customer QAQPFCD6E28NPXV17DP00ZQ7AW: Response status code was not ok: 401.
Square API errors: [
  {
    "category": "AUTHENTICATION_ERROR",
    "code": "UNAUTHORIZED",
    "detail": "This request could not be authorized."
  }
]
‚ùå Error sending referral email to robertahowett7@gmail.com: Unauthorized
SendGrid error details: {
  errors: [
    {
      message: 'The provided authorization grant is invalid, expired, or revoked',
      field: null,
      help: null
    }
  ]
}
‚ö†Ô∏è Analytics operation "notification_event" failed: 
Invalid `prisma.notificationEvent.create()` invocation in
/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/analytics-service.js:164:39

  161 return runAnalyticsOperation(
  162   'notification_event',
  163   async () => {
‚Üí 164     return prisma.notificationEvent.create({
            data: {
              channel: "EMAIL",
              templateType: "REFERRAL_INVITE",
              status: "failed",
              createdAt: new Date("2025-11-27T09:13:28.790Z"),
              errorCode: 401,
                         ~~~
              errorMessage: "Unauthorized",
              metadata: {
                email: "robertahowett7@gmail.com",
                referralCode: "ROBERTA7007",
                referralUrl: "https://referral-system-salon-fbbq6x1wt-umis-projects-e802f152.vercel.app/ref/ROBERTA7007",
                suppressionGroupId: 28008
              }
            }
          })

Argument `errorCode`: Invalid value provided. Expected String or Null, provided Int.
‚ùå Failed to send email: Unauthorized
‚ÑπÔ∏è Referral SMS not sent ‚Äî missing phone number
üìß Referral code generated and sent:
   - Customer: Roberta Howett
   - Email: robertahowett7@gmail.com
   - Referral Code: ROBERTA7007
   - Referral URL: https://referral-system-salon-fbbq6x1wt-umis-projects-e802f152.vercel.app/ref/ROBERTA7007
   - Gift Card ID: null
   - Status: Customer is now a referrer
‚úÖ Referral code sent to new client:
   - Customer: Roberta Howett
   - Email: robertahowett7@gmail.com
   - Referral Code: ROBERTA7007
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: QAQPFCD6E28NPXV17DP00ZQ7AW
{"ts":"2025-11-27T09:13:28.978Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"be8d4ebe-21fb-4c44-a670-77570e376249","stage":"payment","correlationId":"payment-updated:7ea42d0927ffb22c9bdb1a4c"}
{"ts":"2025-11-27T10:48:37.973Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Server has closed the connection.","stack":"PrismaClientKnownRequestError: Server has closed the connection.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-11-27T11:05:20.172Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-11-28T22:42:22.867Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"545c7fe8-c00a-4df9-80ef-466c90fd37fb","stage":"booking","correlationId":"booking-created:a590cc45e108a5f987d09def","attempts":1}
üìÖ Processing booking created for customer: Z4RBCQ7KPAJ4YE0C85EYGDNXA0
Full booking data: {
  "id": "t6rogdiwbusrl0",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-03T21:50:00Z",
  "created_at": "2025-11-27T15:20:17Z",
  "updated_at": "2025-11-27T15:20:17Z",
  "customer_id": "Z4RBCQ7KPAJ4YE0C85EYGDNXA0",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "Z4RBCQ7KPAJ4YE0C85EYGDNXA0",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMOscywuGXO2VURY",
      "any_team_member": true,
      "duration_minutes": 140,
      "intermission_minutes": 0,
      "service_variation_id": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "CJI5WHOAKSFTASYPJ4MSYZLS"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Sarah Engers
üéâ First booking detected for customer: Z4RBCQ7KPAJ4YE0C85EYGDNXA0
   Name: Sarah Engers
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer Z4RBCQ7KPAJ4YE0C85EYGDNXA0...
Error getting custom attributes for customer Z4RBCQ7KPAJ4YE0C85EYGDNXA0: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: Z4RBCQ7KPAJ4YE0C85EYGDNXA0
{"ts":"2025-11-28T22:42:23.731Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"545c7fe8-c00a-4df9-80ef-466c90fd37fb","stage":"booking","correlationId":"booking-created:a590cc45e108a5f987d09def"}
{"ts":"2025-11-28T22:42:23.893Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"bcf932b9-b024-4dda-a7b1-1c88b8827c87","stage":"booking","correlationId":"booking-created:952014eda35d18edf783f9d3","attempts":1}
üìÖ Processing booking created for customer: BKZN5JS399T1525J26XN94F2W0
Full booking data: {
  "id": "9yzds0hygjqjbf",
  "source": "THIRD_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-06T23:50:00Z",
  "created_at": "2025-11-27T15:32:32Z",
  "updated_at": "2025-11-27T15:32:32Z",
  "customer_id": "BKZN5JS399T1525J26XN94F2W0",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "BKZN5JS399T1525J26XN94F2W0",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMVwAQUdLz6no-cB",
      "any_team_member": false,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Stephanie Toh
üéâ First booking detected for customer: BKZN5JS399T1525J26XN94F2W0
   Name: Stephanie Toh
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer BKZN5JS399T1525J26XN94F2W0...
Error getting custom attributes for customer BKZN5JS399T1525J26XN94F2W0: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: BKZN5JS399T1525J26XN94F2W0
{"ts":"2025-11-28T22:42:24.297Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"bcf932b9-b024-4dda-a7b1-1c88b8827c87","stage":"booking","correlationId":"booking-created:952014eda35d18edf783f9d3"}
{"ts":"2025-11-28T22:42:24.491Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"fe9438ef-4484-4976-a50d-405ea5e8ba54","stage":"booking","correlationId":"booking-created:3f5791f4fb528520bfab7196","attempts":1}
üìÖ Processing booking created for customer: ZR8X2857DHMQA6WRKQ0JT804Q8
Full booking data: {
  "id": "ua0y99qp32y7je",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-13T22:40:00Z",
  "created_at": "2025-11-27T16:43:31Z",
  "updated_at": "2025-11-27T16:43:31Z",
  "customer_id": "ZR8X2857DHMQA6WRKQ0JT804Q8",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "ZR8X2857DHMQA6WRKQ0JT804Q8",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMoZGdZlg-iKWTDu",
      "any_team_member": true,
      "duration_minutes": 20,
      "intermission_minutes": 0,
      "service_variation_id": "HAJX45W3U2WUCCXM5MI24UEE",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "HAJX45W3U2WUCCXM5MI24UEE"
    },
    {
      "team_member_id": "TMoZGdZlg-iKWTDu",
      "any_team_member": true,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Shantel Buford
üéâ First booking detected for customer: ZR8X2857DHMQA6WRKQ0JT804Q8
   Name: Shantel Buford
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer ZR8X2857DHMQA6WRKQ0JT804Q8...
Error getting custom attributes for customer ZR8X2857DHMQA6WRKQ0JT804Q8: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: ZR8X2857DHMQA6WRKQ0JT804Q8
{"ts":"2025-11-28T22:42:24.823Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"fe9438ef-4484-4976-a50d-405ea5e8ba54","stage":"booking","correlationId":"booking-created:3f5791f4fb528520bfab7196"}
{"ts":"2025-11-28T22:42:24.984Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"ee9e9402-0deb-42b5-81b1-27a6b7a466c8","stage":"booking","correlationId":"booking-created:f29f707863d733ef06452149","attempts":1}
üìÖ Processing booking created for customer: QTADT64D12939DMDDAH5ZG1HAM
Full booking data: {
  "id": "7zib4x5y18xtv5",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-05T01:00:00Z",
  "created_at": "2025-11-27T17:01:20Z",
  "updated_at": "2025-11-27T17:01:20Z",
  "customer_id": "QTADT64D12939DMDDAH5ZG1HAM",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "QTADT64D12939DMDDAH5ZG1HAM",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TM1L5yPC-yKx6CyO",
      "any_team_member": false,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "NCOIL6ZGDTCC7SO3IJHENCQ2",
      "service_variation_version": 1764191999049,
      "service_variation_client_id": "NCOIL6ZGDTCC7SO3IJHENCQ2"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Becca Endres
‚ÑπÔ∏è Customer QTADT64D12939DMDDAH5ZG1HAM already received signup bonus, not first booking
{"ts":"2025-11-28T22:42:25.122Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"ee9e9402-0deb-42b5-81b1-27a6b7a466c8","stage":"booking","correlationId":"booking-created:f29f707863d733ef06452149"}
{"ts":"2025-11-28T22:42:25.282Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"d0ef4d01-697c-4043-bade-cc0e3dba94b4","stage":"booking","correlationId":"booking-created:046dc89bf19595b06ef6a06e","attempts":1}
üìÖ Processing booking created for customer: 98YY9BQCZV5R4S12V930FJDK9M
Full booking data: {
  "id": "z4dlp22ewy89d1",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-11T21:30:00Z",
  "created_at": "2025-11-27T17:04:30Z",
  "updated_at": "2025-11-27T17:04:30Z",
  "customer_id": "98YY9BQCZV5R4S12V930FJDK9M",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "98YY9BQCZV5R4S12V930FJDK9M",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMILsQUVwLkLzbVo",
      "any_team_member": false,
      "duration_minutes": 100,
      "intermission_minutes": 0,
      "service_variation_id": "BM556FTNFOTEHYVG4GPXAXFM",
      "service_variation_version": 1764191999049,
      "service_variation_client_id": "BM556FTNFOTEHYVG4GPXAXFM"
    },
    {
      "team_member_id": "TMILsQUVwLkLzbVo",
      "any_team_member": false,
      "duration_minutes": 20,
      "intermission_minutes": 0,
      "service_variation_id": "HAJX45W3U2WUCCXM5MI24UEE",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "HAJX45W3U2WUCCXM5MI24UEE"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Amelia Meyerhoff
üéâ First booking detected for customer: 98YY9BQCZV5R4S12V930FJDK9M
   Name: Amelia Meyerhoff
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 98YY9BQCZV5R4S12V930FJDK9M...
Error getting custom attributes for customer 98YY9BQCZV5R4S12V930FJDK9M: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 98YY9BQCZV5R4S12V930FJDK9M
{"ts":"2025-11-28T22:42:25.593Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"d0ef4d01-697c-4043-bade-cc0e3dba94b4","stage":"booking","correlationId":"booking-created:046dc89bf19595b06ef6a06e"}
{"ts":"2025-11-28T22:42:25.754Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"6601180d-aaad-4cc5-bf36-e3007625394f","stage":"booking","correlationId":"booking-created:895a0eda70456a8af4f63f8e","attempts":1}
üìÖ Processing booking created for customer: BYH6XBPGXBDJ6JS7P4GNBJS7M0
Full booking data: {
  "id": "q5gt3zwwafjvhl",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-11-28T18:30:00Z",
  "created_at": "2025-11-27T17:13:44Z",
  "updated_at": "2025-11-27T17:13:44Z",
  "customer_id": "BYH6XBPGXBDJ6JS7P4GNBJS7M0",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "BYH6XBPGXBDJ6JS7P4GNBJS7M0",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMNW4SIF7tjp4oM_",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "BRSIGZFOWC6F4ERPKX3CODLU",
      "service_variation_version": 1764191999049,
      "service_variation_client_id": "BRSIGZFOWC6F4ERPKX3CODLU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Krista Letz
üéâ First booking detected for customer: BYH6XBPGXBDJ6JS7P4GNBJS7M0
   Name: Krista Letz
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer BYH6XBPGXBDJ6JS7P4GNBJS7M0...
Error getting custom attributes for customer BYH6XBPGXBDJ6JS7P4GNBJS7M0: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: BYH6XBPGXBDJ6JS7P4GNBJS7M0
{"ts":"2025-11-28T22:42:26.074Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"6601180d-aaad-4cc5-bf36-e3007625394f","stage":"booking","correlationId":"booking-created:895a0eda70456a8af4f63f8e"}
{"ts":"2025-11-28T22:42:26.237Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"23d3a77a-1d24-4cd8-94b6-2f5a8ae45ae4","stage":"booking","correlationId":"booking-created:634156d724b430674b93457f","attempts":1}
üìÖ Processing booking created for customer: BYH6XBPGXBDJ6JS7P4GNBJS7M0
Full booking data: {
  "id": "8zyujuhf6itevg",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-11-28T22:40:00Z",
  "created_at": "2025-11-27T17:15:57Z",
  "updated_at": "2025-11-27T17:15:57Z",
  "customer_id": "BYH6XBPGXBDJ6JS7P4GNBJS7M0",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "BYH6XBPGXBDJ6JS7P4GNBJS7M0",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMkdrQsxG5tlf-c_",
      "any_team_member": true,
      "duration_minutes": 140,
      "intermission_minutes": 0,
      "service_variation_id": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "CJI5WHOAKSFTASYPJ4MSYZLS"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Krista Letz
üéâ First booking detected for customer: BYH6XBPGXBDJ6JS7P4GNBJS7M0
   Name: Krista Letz
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer BYH6XBPGXBDJ6JS7P4GNBJS7M0...
Error getting custom attributes for customer BYH6XBPGXBDJ6JS7P4GNBJS7M0: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: BYH6XBPGXBDJ6JS7P4GNBJS7M0
{"ts":"2025-11-28T22:42:26.558Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"23d3a77a-1d24-4cd8-94b6-2f5a8ae45ae4","stage":"booking","correlationId":"booking-created:634156d724b430674b93457f"}
{"ts":"2025-11-28T22:42:26.719Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"f0efbed1-6c3a-4944-b966-cd770cdc3250","stage":"booking","correlationId":"booking-created:59000b2df5d771535d539fc8","attempts":1}
üìÖ Processing booking created for customer: M76DEH89VH3J5GGJNG5TPFTAYM
Full booking data: {
  "id": "kt1x8dqhz2h1st",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-11-30T22:40:00Z",
  "created_at": "2025-11-27T17:39:24Z",
  "updated_at": "2025-11-27T17:39:24Z",
  "customer_id": "M76DEH89VH3J5GGJNG5TPFTAYM",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "M76DEH89VH3J5GGJNG5TPFTAYM",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMMBgVwykMnOlumA",
      "any_team_member": true,
      "duration_minutes": 140,
      "intermission_minutes": 0,
      "service_variation_id": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "CJI5WHOAKSFTASYPJ4MSYZLS"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Emma Driscoll
üéâ First booking detected for customer: M76DEH89VH3J5GGJNG5TPFTAYM
   Name: Emma Driscoll
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer M76DEH89VH3J5GGJNG5TPFTAYM...
Error getting custom attributes for customer M76DEH89VH3J5GGJNG5TPFTAYM: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: M76DEH89VH3J5GGJNG5TPFTAYM
{"ts":"2025-11-28T22:42:27.027Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"f0efbed1-6c3a-4944-b966-cd770cdc3250","stage":"booking","correlationId":"booking-created:59000b2df5d771535d539fc8"}
{"ts":"2025-11-28T22:42:27.189Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"4147f8bc-79f7-487a-800e-8b059df997c7","stage":"booking","correlationId":"booking-created:80f4ff2845cd937761acdf41","attempts":1}
üìÖ Processing booking created for customer: BKZN5JS399T1525J26XN94F2W0
Full booking data: {
  "id": "2cejnhiqvp31ou",
  "source": "THIRD_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-06T20:00:00Z",
  "created_at": "2025-11-27T17:50:30Z",
  "updated_at": "2025-11-27T17:50:30Z",
  "customer_id": "BKZN5JS399T1525J26XN94F2W0",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "BKZN5JS399T1525J26XN94F2W0",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMoZGdZlg-iKWTDu",
      "any_team_member": false,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Stephanie Toh
üéâ First booking detected for customer: BKZN5JS399T1525J26XN94F2W0
   Name: Stephanie Toh
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer BKZN5JS399T1525J26XN94F2W0...
Error getting custom attributes for customer BKZN5JS399T1525J26XN94F2W0: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: BKZN5JS399T1525J26XN94F2W0
{"ts":"2025-11-28T22:42:27.499Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"4147f8bc-79f7-487a-800e-8b059df997c7","stage":"booking","correlationId":"booking-created:80f4ff2845cd937761acdf41"}
{"ts":"2025-11-28T22:42:27.658Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"cd9674d9-bf95-4074-bb66-090a9dbe728b","stage":"booking","correlationId":"booking-created:42f94d3db5de61c81b749285","attempts":1}
üìÖ Processing booking created for customer: C5PN9MTWSARSYXQWHAMM3PNGK8
Full booking data: {
  "id": "v9ps1i7yfl973z",
  "source": "THIRD_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-05T21:15:00Z",
  "created_at": "2025-11-27T18:37:56Z",
  "updated_at": "2025-11-27T18:37:56Z",
  "customer_id": "C5PN9MTWSARSYXQWHAMM3PNGK8",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "C5PN9MTWSARSYXQWHAMM3PNGK8",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMILsQUVwLkLzbVo",
      "any_team_member": false,
      "duration_minutes": 100,
      "intermission_minutes": 0,
      "service_variation_id": "BM556FTNFOTEHYVG4GPXAXFM",
      "service_variation_version": 1764191999049,
      "service_variation_client_id": "BM556FTNFOTEHYVG4GPXAXFM"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Kimberly Berlin
üéâ First booking detected for customer: C5PN9MTWSARSYXQWHAMM3PNGK8
   Name: Kimberly Berlin
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer C5PN9MTWSARSYXQWHAMM3PNGK8...
Error getting custom attributes for customer C5PN9MTWSARSYXQWHAMM3PNGK8: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: C5PN9MTWSARSYXQWHAMM3PNGK8
{"ts":"2025-11-28T22:42:27.973Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"cd9674d9-bf95-4074-bb66-090a9dbe728b","stage":"booking","correlationId":"booking-created:42f94d3db5de61c81b749285"}
{"ts":"2025-11-28T22:42:28.137Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"6a2ce1db-2149-487b-bd9e-7f161900dd7f","stage":"payment","correlationId":"payment-updated:bba9c2025d6936e91279a524","attempts":1}
üí∞ Processing payment completion for customer: FR7F2ZCF7HK608WY82RKRNFDTM
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Monica Chernoguz
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Monica Chernoguz, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Monica Chernoguz
   - Email: mjchernoguz@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: FR7F2ZCF7HK608WY82RKRNFDTM
{"ts":"2025-11-28T22:42:28.471Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"6a2ce1db-2149-487b-bd9e-7f161900dd7f","stage":"payment","correlationId":"payment-updated:bba9c2025d6936e91279a524"}
{"ts":"2025-11-28T22:42:28.636Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"423c0d18-1a82-4bb1-92fd-87485fd2c235","stage":"payment","correlationId":"payment-updated:199bd854947f00876d68beb7","attempts":1}
üí∞ Processing payment completion for customer: FR7F2ZCF7HK608WY82RKRNFDTM
   Payment source_type: CARD
   Payment tender_types: []
Customer FR7F2ZCF7HK608WY82RKRNFDTM already completed first payment
{"ts":"2025-11-28T22:42:28.772Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"423c0d18-1a82-4bb1-92fd-87485fd2c235","stage":"payment","correlationId":"payment-updated:199bd854947f00876d68beb7"}
{"ts":"2025-11-28T22:42:28.930Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"cb06bbe9-c68f-4e66-9ad1-f0e38e4c31bc","stage":"booking","correlationId":"booking-created:d0418501c161732ff9f47950","attempts":1}
üìÖ Processing booking created for customer: CHZWA7K9N6HB9NZAG5CB1A2A08
Full booking data: {
  "id": "erfftmpt2a3cb8",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-01T19:00:00Z",
  "created_at": "2025-11-27T19:12:10Z",
  "updated_at": "2025-11-27T19:12:10Z",
  "customer_id": "CHZWA7K9N6HB9NZAG5CB1A2A08",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "CHZWA7K9N6HB9NZAG5CB1A2A08",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMoZGdZlg-iKWTDu",
      "any_team_member": true,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Mariko Dennis
üéâ First booking detected for customer: CHZWA7K9N6HB9NZAG5CB1A2A08
   Name: Mariko Dennis
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer CHZWA7K9N6HB9NZAG5CB1A2A08...
Error getting custom attributes for customer CHZWA7K9N6HB9NZAG5CB1A2A08: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: CHZWA7K9N6HB9NZAG5CB1A2A08
{"ts":"2025-11-28T22:42:29.242Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"cb06bbe9-c68f-4e66-9ad1-f0e38e4c31bc","stage":"booking","correlationId":"booking-created:d0418501c161732ff9f47950"}
{"ts":"2025-11-28T22:42:29.400Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"923f7364-3511-4bc2-9aef-72d378bf4798","stage":"booking","correlationId":"booking-created:c0efc1a19509309db4e9a7c5","attempts":1}
üìÖ Processing booking created for customer: PE3PSTSXWTN1Q4JKJN6ENZ38Y8
Full booking data: {
  "id": "kq7wbfixxdroa5",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-21T18:00:00Z",
  "created_at": "2025-11-27T19:21:18Z",
  "updated_at": "2025-11-27T19:21:18Z",
  "customer_id": "PE3PSTSXWTN1Q4JKJN6ENZ38Y8",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "PE3PSTSXWTN1Q4JKJN6ENZ38Y8",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMXiw38Bbb7XQUWI",
      "any_team_member": true,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Elizabeth Solomon
üéâ First booking detected for customer: PE3PSTSXWTN1Q4JKJN6ENZ38Y8
   Name: Elizabeth Solomon
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer PE3PSTSXWTN1Q4JKJN6ENZ38Y8...
Error getting custom attributes for customer PE3PSTSXWTN1Q4JKJN6ENZ38Y8: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: PE3PSTSXWTN1Q4JKJN6ENZ38Y8
{"ts":"2025-11-28T22:42:29.712Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"923f7364-3511-4bc2-9aef-72d378bf4798","stage":"booking","correlationId":"booking-created:c0efc1a19509309db4e9a7c5"}
{"ts":"2025-11-28T22:42:29.875Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"06778428-9b4b-4551-9b33-960ec33b310e","stage":"payment","correlationId":"payment-updated:24357a0d7761f01423ce2476","attempts":1}
üí∞ Processing payment completion for customer: 0SGEVF277DSY48W0JGXRPX8CPC
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Mathilde Guillaume
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Mathilde Guillaume, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Mathilde Guillaume
   - Email: mathildeguillaume15@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: 0SGEVF277DSY48W0JGXRPX8CPC
{"ts":"2025-11-28T22:42:30.184Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"06778428-9b4b-4551-9b33-960ec33b310e","stage":"payment","correlationId":"payment-updated:24357a0d7761f01423ce2476"}
{"ts":"2025-11-28T22:42:30.345Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"cc5e2fb2-dec7-4924-b253-993864a9a9b2","stage":"payment","correlationId":"payment-updated:12f41aefe020372771525a93","attempts":1}
üí∞ Processing payment completion for customer: 0SGEVF277DSY48W0JGXRPX8CPC
   Payment source_type: CARD
   Payment tender_types: []
Customer 0SGEVF277DSY48W0JGXRPX8CPC already completed first payment
{"ts":"2025-11-28T22:42:30.520Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"cc5e2fb2-dec7-4924-b253-993864a9a9b2","stage":"payment","correlationId":"payment-updated:12f41aefe020372771525a93"}
{"ts":"2025-11-28T22:42:30.683Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"56a7702c-7b89-48b8-8e37-5cf80c7da8e8","stage":"payment","correlationId":"payment-updated:f4cf87a72cabedace83632a2","attempts":1}
üí∞ Processing payment completion for customer: YWCV6F05G3GB8QT4WG83HA8HEG
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Olga Vox
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Olga Vox, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Olga Vox
   - Email: Intra_She@yahoo.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: YWCV6F05G3GB8QT4WG83HA8HEG
{"ts":"2025-11-28T22:42:30.994Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"56a7702c-7b89-48b8-8e37-5cf80c7da8e8","stage":"payment","correlationId":"payment-updated:f4cf87a72cabedace83632a2"}
{"ts":"2025-11-28T22:42:31.154Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"00e0a33c-e938-4b00-a15d-ca81618dafd1","stage":"payment","correlationId":"payment-updated:116e26519752a347eacbb9bb","attempts":1}
üí∞ Processing payment completion for customer: YWCV6F05G3GB8QT4WG83HA8HEG
   Payment source_type: CARD
   Payment tender_types: []
Customer YWCV6F05G3GB8QT4WG83HA8HEG already completed first payment
{"ts":"2025-11-28T22:42:31.290Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"00e0a33c-e938-4b00-a15d-ca81618dafd1","stage":"payment","correlationId":"payment-updated:116e26519752a347eacbb9bb"}
{"ts":"2025-11-28T22:42:31.449Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"1877269b-fad7-463a-a5c8-52592deaf1e0","stage":"booking","correlationId":"booking-created:100b966b7d2fa6699580ffeb","attempts":1}
üìÖ Processing booking created for customer: C7MX9AVCFA37SKB6D8XHB2S3SC
Full booking data: {
  "id": "5ojucdjlrefq7m",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-03T17:00:00Z",
  "created_at": "2025-11-28T00:24:00Z",
  "updated_at": "2025-11-28T00:24:00Z",
  "customer_id": "C7MX9AVCFA37SKB6D8XHB2S3SC",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "C7MX9AVCFA37SKB6D8XHB2S3SC",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMOscywuGXO2VURY",
      "any_team_member": false,
      "duration_minutes": 140,
      "intermission_minutes": 0,
      "service_variation_id": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "CJI5WHOAKSFTASYPJ4MSYZLS"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Angelica Molina
üéâ First booking detected for customer: C7MX9AVCFA37SKB6D8XHB2S3SC
   Name: Angelica Molina
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer C7MX9AVCFA37SKB6D8XHB2S3SC...
Error getting custom attributes for customer C7MX9AVCFA37SKB6D8XHB2S3SC: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: C7MX9AVCFA37SKB6D8XHB2S3SC
{"ts":"2025-11-28T22:42:31.764Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"1877269b-fad7-463a-a5c8-52592deaf1e0","stage":"booking","correlationId":"booking-created:100b966b7d2fa6699580ffeb"}
{"ts":"2025-11-28T22:42:31.923Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"1f2b5170-e713-4725-80c8-f5c89f716bb6","stage":"booking","correlationId":"booking-created:e509ee6ff7f40dce025269da","attempts":1}
üìÖ Processing booking created for customer: 4FHCGEFMW90VH05BPEKBRHPQ9G
Full booking data: {
  "id": "wi9nvcxowmkiz9",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-11-30T18:00:00Z",
  "created_at": "2025-11-28T01:19:25Z",
  "updated_at": "2025-11-28T01:19:25Z",
  "customer_id": "4FHCGEFMW90VH05BPEKBRHPQ9G",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "4FHCGEFMW90VH05BPEKBRHPQ9G",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMSt73bSp59caRzt",
      "any_team_member": true,
      "duration_minutes": 140,
      "intermission_minutes": 0,
      "service_variation_id": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "CJI5WHOAKSFTASYPJ4MSYZLS"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Kirti Shenoy
üéâ First booking detected for customer: 4FHCGEFMW90VH05BPEKBRHPQ9G
   Name: Kirti Shenoy
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 4FHCGEFMW90VH05BPEKBRHPQ9G...
Error getting custom attributes for customer 4FHCGEFMW90VH05BPEKBRHPQ9G: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 4FHCGEFMW90VH05BPEKBRHPQ9G
{"ts":"2025-11-28T22:42:32.232Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"1f2b5170-e713-4725-80c8-f5c89f716bb6","stage":"booking","correlationId":"booking-created:e509ee6ff7f40dce025269da"}
{"ts":"2025-11-28T22:42:32.393Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"308b8b21-63fb-43fd-9b03-be1149c76849","stage":"booking","correlationId":"booking-created:71397815c1bae28626ea6488","attempts":1}
üìÖ Processing booking created for customer: ZRKFNEJ0C02CBWWHVJWPYH1T6R
Full booking data: {
  "id": "8ejp25g9duxw8x",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-11-30T00:00:00Z",
  "created_at": "2025-11-28T02:21:19Z",
  "updated_at": "2025-11-28T02:21:19Z",
  "customer_id": "ZRKFNEJ0C02CBWWHVJWPYH1T6R",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "ZRKFNEJ0C02CBWWHVJWPYH1T6R",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TM1L5yPC-yKx6CyO",
      "any_team_member": false,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "NCOIL6ZGDTCC7SO3IJHENCQ2",
      "service_variation_version": 1764191999049,
      "service_variation_client_id": "NCOIL6ZGDTCC7SO3IJHENCQ2"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Erika Dela Marta
üéâ First booking detected for customer: ZRKFNEJ0C02CBWWHVJWPYH1T6R
   Name: Erika Dela Marta
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer ZRKFNEJ0C02CBWWHVJWPYH1T6R...
Error getting custom attributes for customer ZRKFNEJ0C02CBWWHVJWPYH1T6R: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: ZRKFNEJ0C02CBWWHVJWPYH1T6R
{"ts":"2025-11-28T22:42:32.713Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"308b8b21-63fb-43fd-9b03-be1149c76849","stage":"booking","correlationId":"booking-created:71397815c1bae28626ea6488"}
{"ts":"2025-11-28T22:42:32.872Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"1919822c-17d8-4b01-85ef-d024cdac636f","stage":"booking","correlationId":"booking-created:06dd0649c4ec7f6a9ab529fc","attempts":1}
üìÖ Processing booking created for customer: 9VT9PGM9VAEAVJ2B0QCYHJC8R0
Full booking data: {
  "id": "j1jj2snmy945ex",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-01T23:50:00Z",
  "created_at": "2025-11-28T02:42:36Z",
  "updated_at": "2025-11-28T02:42:36Z",
  "customer_id": "9VT9PGM9VAEAVJ2B0QCYHJC8R0",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "9VT9PGM9VAEAVJ2B0QCYHJC8R0",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMgsjtuk5cfKnstq",
      "any_team_member": false,
      "duration_minutes": 110,
      "intermission_minutes": 0,
      "service_variation_id": "6TYOE67IDYTKHW2ZG6HKVZER",
      "service_variation_version": 1764191999049,
      "service_variation_client_id": "6TYOE67IDYTKHW2ZG6HKVZER"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Ellie Anvar
‚ÑπÔ∏è Customer 9VT9PGM9VAEAVJ2B0QCYHJC8R0 already received signup bonus, not first booking
{"ts":"2025-11-28T22:42:33.008Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"1919822c-17d8-4b01-85ef-d024cdac636f","stage":"booking","correlationId":"booking-created:06dd0649c4ec7f6a9ab529fc"}
{"ts":"2025-11-28T22:42:33.167Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"8b71c8f1-d055-44b7-86b0-e026d01e270b","stage":"booking","correlationId":"booking-created:0a461c07a6be8715d295ab2b","attempts":1}
üìÖ Processing booking created for customer: BZ9XWDQKWAYT1GNVS09QDQ0ASC
Full booking data: {
  "id": "g243peqn6bw333",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-03T00:50:00Z",
  "created_at": "2025-11-28T02:51:47Z",
  "updated_at": "2025-11-28T02:51:47Z",
  "customer_id": "BZ9XWDQKWAYT1GNVS09QDQ0ASC",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "BZ9XWDQKWAYT1GNVS09QDQ0ASC",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMdagA6g0F03A7_w",
      "any_team_member": true,
      "duration_minutes": 140,
      "intermission_minutes": 0,
      "service_variation_id": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "CJI5WHOAKSFTASYPJ4MSYZLS"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Hillary Bates
üéâ First booking detected for customer: BZ9XWDQKWAYT1GNVS09QDQ0ASC
   Name: Hillary Bates
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer BZ9XWDQKWAYT1GNVS09QDQ0ASC...
Error getting custom attributes for customer BZ9XWDQKWAYT1GNVS09QDQ0ASC: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: BZ9XWDQKWAYT1GNVS09QDQ0ASC
{"ts":"2025-11-28T22:42:33.483Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"8b71c8f1-d055-44b7-86b0-e026d01e270b","stage":"booking","correlationId":"booking-created:0a461c07a6be8715d295ab2b"}
{"ts":"2025-11-28T22:42:33.654Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"f280ae37-1df6-4034-88e9-e983a09eb921","stage":"customer_ingest","correlationId":"customer-created:04adbda9da199c2aee35696b","attempts":1}
üì• Received customer data: {
  "id": "J3F8Z4VQPY70DDXFHFDB98CCZ4",
  "address": {
    "country": "US"
  },
  "version": 1,
  "group_ids": [
    "LT4ZHFBQQYB2N.APPOINTMENTS"
  ],
  "created_at": "2025-11-28T03:24:51.43Z",
  "given_name": "Sheena",
  "updated_at": "2025-11-28T03:24:54Z",
  "family_name": "Ferrari",
  "preferences": {
    "email_unsubscribed": false
  },
  "phone_number": "(669) 233-9273",
  "email_address": "sheenaloren@gmail.com",
  "creation_source": "APPOINTMENTS"
}
üë§ Processing customer creation: J3F8Z4VQPY70DDXFHFDB98CCZ4
üìç IP Address: unknown
üìß Email: sheenaloren@gmail.com
üìû Phone: (669) 233-9273
üë§ Name: Sheena Ferrari
‚ö†Ô∏è Suspicious IP activity detected: unknown used by 96 customers
‚ö†Ô∏è Suspicious activity detected for customer J3F8Z4VQPY70DDXFHFDB98CCZ4, flagging for review
üéâ New customer detected: J3F8Z4VQPY70DDXFHFDB98CCZ4
‚úÖ Customer added to database as NEW (temporary mark)
   - Will check for referral code when they book
   - Will give gift card on first booking if code found
‚úÖ Verification: Customer found in DB: true
{"ts":"2025-11-28T22:42:34.002Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"f280ae37-1df6-4034-88e9-e983a09eb921","stage":"customer_ingest","correlationId":"customer-created:04adbda9da199c2aee35696b"}
{"ts":"2025-11-28T22:42:34.161Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"ccf798a1-c552-4a33-ae70-e517025870f2","stage":"booking","correlationId":"booking-created:5986afe74a6987cd89b88ab6","attempts":1}
üìÖ Processing booking created for customer: J3F8Z4VQPY70DDXFHFDB98CCZ4
Full booking data: {
  "id": "zcjv0l99utscpy",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-02T17:00:00Z",
  "created_at": "2025-11-28T03:24:54Z",
  "updated_at": "2025-11-28T03:24:54Z",
  "customer_id": "J3F8Z4VQPY70DDXFHFDB98CCZ4",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "J3F8Z4VQPY70DDXFHFDB98CCZ4",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TM9jDlRr_Hl4rdBB",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "XBUDIMNKOPC2XVG5YLIQ4RYS",
      "service_variation_version": 1764191999049,
      "service_variation_client_id": "XBUDIMNKOPC2XVG5YLIQ4RYS"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Sheena Ferrari
üéâ First booking detected for customer: J3F8Z4VQPY70DDXFHFDB98CCZ4
   Name: Sheena Ferrari
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer J3F8Z4VQPY70DDXFHFDB98CCZ4...
Error getting custom attributes for customer J3F8Z4VQPY70DDXFHFDB98CCZ4: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: J3F8Z4VQPY70DDXFHFDB98CCZ4
{"ts":"2025-11-28T22:42:34.475Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"ccf798a1-c552-4a33-ae70-e517025870f2","stage":"booking","correlationId":"booking-created:5986afe74a6987cd89b88ab6"}
{"ts":"2025-11-28T22:42:34.636Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"1ed8c843-fc0b-4e05-83f5-13679ab0d1c4","stage":"booking","correlationId":"booking-created:84a20fa58c4d416e898324ab","attempts":1}
üìÖ Processing booking created for customer: J3F8Z4VQPY70DDXFHFDB98CCZ4
Full booking data: {
  "id": "w8pj1jfvsclgxr",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-08T20:00:00Z",
  "created_at": "2025-11-28T03:26:39Z",
  "updated_at": "2025-11-28T03:26:39Z",
  "customer_id": "J3F8Z4VQPY70DDXFHFDB98CCZ4",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "J3F8Z4VQPY70DDXFHFDB98CCZ4",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "resource_ids": [
        "KAOXILA4CV7A23VRAACC4R66"
      ],
      "team_member_id": "TMNW4SIF7tjp4oM_",
      "any_team_member": true,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "ZEAKNB35I37RMXNUBGWDZQIM",
      "service_variation_version": 1760895536505,
      "service_variation_client_id": "ZEAKNB35I37RMXNUBGWDZQIM"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Sheena Ferrari
üéâ First booking detected for customer: J3F8Z4VQPY70DDXFHFDB98CCZ4
   Name: Sheena Ferrari
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer J3F8Z4VQPY70DDXFHFDB98CCZ4...
Error getting custom attributes for customer J3F8Z4VQPY70DDXFHFDB98CCZ4: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: J3F8Z4VQPY70DDXFHFDB98CCZ4
{"ts":"2025-11-28T22:42:34.948Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"1ed8c843-fc0b-4e05-83f5-13679ab0d1c4","stage":"booking","correlationId":"booking-created:84a20fa58c4d416e898324ab"}
{"ts":"2025-11-28T22:42:35.112Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"be2c07d5-d635-4c2c-91d7-7343087579fa","stage":"customer_ingest","correlationId":"customer-created:861103c5508ecee4d48cdc59","attempts":1}
üì• Received customer data: {
  "id": "D64SF6SGTAZKDT2CWC9BCQ5RD8",
  "address": {
    "country": "US"
  },
  "version": 0,
  "group_ids": [
    "LT4ZHFBQQYB2N.APPOINTMENTS"
  ],
  "created_at": "2025-11-28T03:32:40.955Z",
  "given_name": "Paulina",
  "updated_at": "2025-11-28T03:32:40Z",
  "family_name": "Kaminski",
  "preferences": {
    "email_unsubscribed": false
  },
  "phone_number": "+17087128887",
  "email_address": "paulina.kaminski13@gmail.com",
  "creation_source": "APPOINTMENTS"
}
üë§ Processing customer creation: D64SF6SGTAZKDT2CWC9BCQ5RD8
üìç IP Address: unknown
üìß Email: paulina.kaminski13@gmail.com
üìû Phone: +17087128887
üë§ Name: Paulina Kaminski
‚ö†Ô∏è Suspicious IP activity detected: unknown used by 97 customers
‚ö†Ô∏è Suspicious activity detected for customer D64SF6SGTAZKDT2CWC9BCQ5RD8, flagging for review
üéâ New customer detected: D64SF6SGTAZKDT2CWC9BCQ5RD8
‚úÖ Customer added to database as NEW (temporary mark)
   - Will check for referral code when they book
   - Will give gift card on first booking if code found
‚úÖ Verification: Customer found in DB: true
{"ts":"2025-11-28T22:42:35.391Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"be2c07d5-d635-4c2c-91d7-7343087579fa","stage":"customer_ingest","correlationId":"customer-created:861103c5508ecee4d48cdc59"}
{"ts":"2025-11-28T22:42:35.550Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"5986b434-a9aa-4dfb-90fb-0fcd30a10cc8","stage":"booking","correlationId":"booking-created:f6fcae2eff6be8e3c5c350d2","attempts":1}
üìÖ Processing booking created for customer: D64SF6SGTAZKDT2CWC9BCQ5RD8
Full booking data: {
  "id": "cey0h1p2leluqj",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-06T21:00:00Z",
  "created_at": "2025-11-28T03:32:44Z",
  "updated_at": "2025-11-28T03:32:44Z",
  "customer_id": "D64SF6SGTAZKDT2CWC9BCQ5RD8",
  "location_id": "LT4ZHFBQQYB2N",
  "customer_note": "Will add friend referral code later! Want to make sure I get this appointment time",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "D64SF6SGTAZKDT2CWC9BCQ5RD8",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMkdrQsxG5tlf-c_",
      "any_team_member": true,
      "duration_minutes": 140,
      "intermission_minutes": 0,
      "service_variation_id": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "CJI5WHOAKSFTASYPJ4MSYZLS"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Paulina Kaminski
üéâ First booking detected for customer: D64SF6SGTAZKDT2CWC9BCQ5RD8
   Name: Paulina Kaminski
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer D64SF6SGTAZKDT2CWC9BCQ5RD8...
Error getting custom attributes for customer D64SF6SGTAZKDT2CWC9BCQ5RD8: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: D64SF6SGTAZKDT2CWC9BCQ5RD8
{"ts":"2025-11-28T22:42:35.855Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"5986b434-a9aa-4dfb-90fb-0fcd30a10cc8","stage":"booking","correlationId":"booking-created:f6fcae2eff6be8e3c5c350d2"}
{"ts":"2025-11-28T22:42:36.013Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"cdd400a8-83c6-4a08-a9e9-72b48f964b30","stage":"booking","correlationId":"booking-created:f665421eeed361d4ce5a63d8","attempts":1}
üìÖ Processing booking created for customer: CHZWA7K9N6HB9NZAG5CB1A2A08
Full booking data: {
  "id": "09pomdevakprnz",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-01T19:00:00Z",
  "created_at": "2025-11-28T04:47:47Z",
  "updated_at": "2025-11-28T04:47:47Z",
  "customer_id": "CHZWA7K9N6HB9NZAG5CB1A2A08",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "CHZWA7K9N6HB9NZAG5CB1A2A08",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMoZGdZlg-iKWTDu",
      "any_team_member": true,
      "duration_minutes": 150,
      "intermission_minutes": 0,
      "service_variation_id": "FKVQUFGSG7BFA55SUPGKTCWF",
      "service_variation_version": 1760141204155,
      "service_variation_client_id": "FKVQUFGSG7BFA55SUPGKTCWF"
    },
    {
      "team_member_id": "TMoZGdZlg-iKWTDu",
      "any_team_member": true,
      "duration_minutes": 20,
      "intermission_minutes": 0,
      "service_variation_id": "HAJX45W3U2WUCCXM5MI24UEE",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "HAJX45W3U2WUCCXM5MI24UEE"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Mariko Dennis
üéâ First booking detected for customer: CHZWA7K9N6HB9NZAG5CB1A2A08
   Name: Mariko Dennis
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer CHZWA7K9N6HB9NZAG5CB1A2A08...
Error getting custom attributes for customer CHZWA7K9N6HB9NZAG5CB1A2A08: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: CHZWA7K9N6HB9NZAG5CB1A2A08
{"ts":"2025-11-28T22:42:36.318Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"cdd400a8-83c6-4a08-a9e9-72b48f964b30","stage":"booking","correlationId":"booking-created:f665421eeed361d4ce5a63d8"}
{"ts":"2025-11-28T22:42:36.488Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"ab53e240-eee8-4537-b334-a8b791cc541a","stage":"booking","correlationId":"booking-created:486ea47ef77e216a572bb28f","attempts":1}
üìÖ Processing booking created for customer: ZFPNM61E5VG9BZ2E8KRAHGYPN8
Full booking data: {
  "id": "2f4kzwpbzy3lzo",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-21T18:00:00Z",
  "created_at": "2025-11-28T05:33:35Z",
  "updated_at": "2025-11-28T05:33:35Z",
  "customer_id": "ZFPNM61E5VG9BZ2E8KRAHGYPN8",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "ZFPNM61E5VG9BZ2E8KRAHGYPN8",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMEWAZHdtaiRR_Zs",
      "any_team_member": true,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Elizabeth Bowman
üéâ First booking detected for customer: ZFPNM61E5VG9BZ2E8KRAHGYPN8
   Name: Elizabeth Bowman
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer ZFPNM61E5VG9BZ2E8KRAHGYPN8...
Error getting custom attributes for customer ZFPNM61E5VG9BZ2E8KRAHGYPN8: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: ZFPNM61E5VG9BZ2E8KRAHGYPN8
{"ts":"2025-11-28T22:42:36.798Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"ab53e240-eee8-4537-b334-a8b791cc541a","stage":"booking","correlationId":"booking-created:486ea47ef77e216a572bb28f"}
{"ts":"2025-11-28T22:42:36.959Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"ec6e12f6-61fa-4559-8418-338e75d8e1ec","stage":"booking","correlationId":"booking-created:2730c158ff4a588d292abb38","attempts":1}
üìÖ Processing booking created for customer: Q93D31465VRQST3BKPDC93YRCW
Full booking data: {
  "id": "mlz8ohr4jldxuj",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-14T00:00:00Z",
  "created_at": "2025-11-28T05:56:20Z",
  "updated_at": "2025-11-28T05:56:20Z",
  "customer_id": "Q93D31465VRQST3BKPDC93YRCW",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "Q93D31465VRQST3BKPDC93YRCW",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMNW4SIF7tjp4oM_",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "BRSIGZFOWC6F4ERPKX3CODLU",
      "service_variation_version": 1759193842205,
      "service_variation_client_id": "BRSIGZFOWC6F4ERPKX3CODLU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Isidora Conic
üéâ First booking detected for customer: Q93D31465VRQST3BKPDC93YRCW
   Name: Isidora Conic
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer Q93D31465VRQST3BKPDC93YRCW...
Error getting custom attributes for customer Q93D31465VRQST3BKPDC93YRCW: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: Q93D31465VRQST3BKPDC93YRCW
{"ts":"2025-11-28T22:42:37.296Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"ec6e12f6-61fa-4559-8418-338e75d8e1ec","stage":"booking","correlationId":"booking-created:2730c158ff4a588d292abb38"}
{"ts":"2025-11-28T22:42:37.455Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"c34671e9-b10a-40a4-8611-7bd4890a733d","stage":"customer_ingest","correlationId":"customer-created:e79fd41518ca52c5447c9afc","attempts":1}
üì• Received customer data: {
  "id": "87D21GV129KTGEXZY3J7AZC1RC",
  "address": {
    "country": "US"
  },
  "version": 0,
  "group_ids": [
    "LT4ZHFBQQYB2N.APPOINTMENTS"
  ],
  "created_at": "2025-11-28T06:17:32.506Z",
  "given_name": "Jennifer",
  "updated_at": "2025-11-28T06:17:32Z",
  "family_name": "Lau",
  "preferences": {
    "email_unsubscribed": false
  },
  "phone_number": "+16465120429",
  "email_address": "jlau82694@gmail.com",
  "creation_source": "APPOINTMENTS"
}
üë§ Processing customer creation: 87D21GV129KTGEXZY3J7AZC1RC
üìç IP Address: unknown
üìß Email: jlau82694@gmail.com
üìû Phone: +16465120429
üë§ Name: Jennifer Lau
‚ö†Ô∏è Suspicious IP activity detected: unknown used by 98 customers
‚ö†Ô∏è Suspicious activity detected for customer 87D21GV129KTGEXZY3J7AZC1RC, flagging for review
üéâ New customer detected: 87D21GV129KTGEXZY3J7AZC1RC
‚úÖ Customer added to database as NEW (temporary mark)
   - Will check for referral code when they book
   - Will give gift card on first booking if code found
‚úÖ Verification: Customer found in DB: true
{"ts":"2025-11-28T22:42:37.761Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"c34671e9-b10a-40a4-8611-7bd4890a733d","stage":"customer_ingest","correlationId":"customer-created:e79fd41518ca52c5447c9afc"}
{"ts":"2025-11-28T22:42:37.919Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"1d95edcc-0d08-4309-91ae-7f385fc9b0d2","stage":"booking","correlationId":"booking-created:d44d4b79d1d66458673eb6ca","attempts":1}
üìÖ Processing booking created for customer: 87D21GV129KTGEXZY3J7AZC1RC
Full booking data: {
  "id": "xybzscemeei4nm",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-11-30T20:00:00Z",
  "created_at": "2025-11-28T06:17:35Z",
  "updated_at": "2025-11-28T06:17:35Z",
  "customer_id": "87D21GV129KTGEXZY3J7AZC1RC",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "87D21GV129KTGEXZY3J7AZC1RC",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMEWAZHdtaiRR_Zs",
      "any_team_member": true,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Jennifer Lau
üéâ First booking detected for customer: 87D21GV129KTGEXZY3J7AZC1RC
   Name: Jennifer Lau
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 87D21GV129KTGEXZY3J7AZC1RC...
Error getting custom attributes for customer 87D21GV129KTGEXZY3J7AZC1RC: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 87D21GV129KTGEXZY3J7AZC1RC
{"ts":"2025-11-28T22:42:38.225Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"1d95edcc-0d08-4309-91ae-7f385fc9b0d2","stage":"booking","correlationId":"booking-created:d44d4b79d1d66458673eb6ca"}
{"ts":"2025-11-28T22:42:38.384Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"a3080054-c07e-4e9b-b90b-ccacb4e8388b","stage":"booking","correlationId":"booking-created:6342c7d736fc6ec68da579c7","attempts":1}
üìÖ Processing booking created for customer: 557YD1QQQEET3TD2F5FBW9RWDW
Full booking data: {
  "id": "ppkz5l119ljfov",
  "source": "THIRD_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-11-30T01:15:00Z",
  "created_at": "2025-11-28T07:28:37Z",
  "updated_at": "2025-11-28T07:28:37Z",
  "customer_id": "557YD1QQQEET3TD2F5FBW9RWDW",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "557YD1QQQEET3TD2F5FBW9RWDW",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMXiw38Bbb7XQUWI",
      "any_team_member": false,
      "duration_minutes": 45,
      "intermission_minutes": 0,
      "service_variation_id": "VVA7G2UN7N2HUFMCW5LQOVHB",
      "service_variation_version": 1763579781183,
      "service_variation_client_id": "VVA7G2UN7N2HUFMCW5LQOVHB"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Sonya Sukmanskaia
üéâ First booking detected for customer: 557YD1QQQEET3TD2F5FBW9RWDW
   Name: Sonya Sukmanskaia
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 557YD1QQQEET3TD2F5FBW9RWDW...
Error getting custom attributes for customer 557YD1QQQEET3TD2F5FBW9RWDW: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 557YD1QQQEET3TD2F5FBW9RWDW
{"ts":"2025-11-28T22:42:38.692Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"a3080054-c07e-4e9b-b90b-ccacb4e8388b","stage":"booking","correlationId":"booking-created:6342c7d736fc6ec68da579c7"}
{"ts":"2025-11-28T22:42:38.854Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"2db0c043-94fb-45a0-becd-3e62bd9094fb","stage":"booking","correlationId":"booking-created:e12bd156d02b3715cd3db70b","attempts":1}
üìÖ Processing booking created for customer: 7HMK01BQANF87QJZSGDBKSV0Q0
Full booking data: {
  "id": "7f7w4bfgnxm35w",
  "source": "THIRD_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-11-28T23:30:00Z",
  "created_at": "2025-11-28T07:47:51Z",
  "updated_at": "2025-11-28T07:47:51Z",
  "customer_id": "7HMK01BQANF87QJZSGDBKSV0Q0",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "7HMK01BQANF87QJZSGDBKSV0Q0",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMEWAZHdtaiRR_Zs",
      "any_team_member": true,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Svetlana Afanaseva
üéâ First booking detected for customer: 7HMK01BQANF87QJZSGDBKSV0Q0
   Name: Svetlana Afanaseva
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 7HMK01BQANF87QJZSGDBKSV0Q0...
Error getting custom attributes for customer 7HMK01BQANF87QJZSGDBKSV0Q0: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 7HMK01BQANF87QJZSGDBKSV0Q0
{"ts":"2025-11-28T22:42:39.154Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"2db0c043-94fb-45a0-becd-3e62bd9094fb","stage":"booking","correlationId":"booking-created:e12bd156d02b3715cd3db70b"}
{"ts":"2025-11-28T22:42:39.314Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"b2d2a233-6985-477d-9c2f-ccfdeb4b6fc1","stage":"booking","correlationId":"booking-created:00b84423f1b07395fc7ea523","attempts":1}
üìÖ Processing booking created for customer: VX4W3SJ6RTFDRQNK1TZJC1T19G
Full booking data: {
  "id": "44dvtaa4jvh2il",
  "source": "THIRD_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-11-30T01:30:00Z",
  "created_at": "2025-11-28T09:07:10Z",
  "updated_at": "2025-11-28T09:07:10Z",
  "customer_id": "VX4W3SJ6RTFDRQNK1TZJC1T19G",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "VX4W3SJ6RTFDRQNK1TZJC1T19G",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TM9jDlRr_Hl4rdBB",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "XBUDIMNKOPC2XVG5YLIQ4RYS",
      "service_variation_version": 1764191999049,
      "service_variation_client_id": "XBUDIMNKOPC2XVG5YLIQ4RYS"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Monica Everett
üéâ First booking detected for customer: VX4W3SJ6RTFDRQNK1TZJC1T19G
   Name: Monica Everett
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer VX4W3SJ6RTFDRQNK1TZJC1T19G...
Error getting custom attributes for customer VX4W3SJ6RTFDRQNK1TZJC1T19G: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: VX4W3SJ6RTFDRQNK1TZJC1T19G
{"ts":"2025-11-28T22:42:39.628Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"b2d2a233-6985-477d-9c2f-ccfdeb4b6fc1","stage":"booking","correlationId":"booking-created:00b84423f1b07395fc7ea523"}
{"ts":"2025-11-28T22:42:39.789Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"5d63aafe-600b-4271-a256-443243c96b61","stage":"booking","correlationId":"booking-created:d4e246e8f9aab40fd82d9912","attempts":1}
üìÖ Processing booking created for customer: 0YEN2CXEE575X51F6TE1REYQG4
Full booking data: {
  "id": "n6qekldgqz7soy",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-19T23:00:00Z",
  "created_at": "2025-11-28T15:20:50Z",
  "updated_at": "2025-11-28T15:20:50Z",
  "customer_id": "0YEN2CXEE575X51F6TE1REYQG4",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "0YEN2CXEE575X51F6TE1REYQG4",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "resource_ids": [
        "F2MBRCC42VNNDWXNA3PAMHEU"
      ],
      "team_member_id": "TMMCVDJoKh3ZkfFo",
      "any_team_member": true,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "ZEAKNB35I37RMXNUBGWDZQIM",
      "service_variation_version": 1760895536505,
      "service_variation_client_id": "ZEAKNB35I37RMXNUBGWDZQIM"
    },
    {
      "team_member_id": "TMMCVDJoKh3ZkfFo",
      "any_team_member": true,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Katerina Chinnappan
üéâ First booking detected for customer: 0YEN2CXEE575X51F6TE1REYQG4
   Name: Katerina Chinnappan
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 0YEN2CXEE575X51F6TE1REYQG4...
Error getting custom attributes for customer 0YEN2CXEE575X51F6TE1REYQG4: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 0YEN2CXEE575X51F6TE1REYQG4
{"ts":"2025-11-28T22:42:40.097Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"5d63aafe-600b-4271-a256-443243c96b61","stage":"booking","correlationId":"booking-created:d4e246e8f9aab40fd82d9912"}
{"ts":"2025-11-28T22:42:40.258Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"1c1aea23-557a-4042-8d52-e49e6164661e","stage":"booking","correlationId":"booking-created:06ca3c62d250d01ff07be225","attempts":1}
üìÖ Processing booking created for customer: 4QV9HBRD6SY5F3ESB848T3W9HC
Full booking data: {
  "id": "xsu0o9bf0bgguz",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-11-29T21:00:00Z",
  "created_at": "2025-11-28T15:36:28Z",
  "updated_at": "2025-11-28T15:36:28Z",
  "customer_id": "4QV9HBRD6SY5F3ESB848T3W9HC",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "4QV9HBRD6SY5F3ESB848T3W9HC",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "resource_ids": [
        "KAOXILA4CV7A23VRAACC4R66"
      ],
      "team_member_id": "TM9jDlRr_Hl4rdBB",
      "any_team_member": true,
      "duration_minutes": 60,
      "intermission_minutes": 0,
      "service_variation_id": "SBE5XUATXRM76CBTT25HL2NZ",
      "service_variation_version": 1760895536505,
      "service_variation_client_id": "SBE5XUATXRM76CBTT25HL2NZ"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 0 customer(s) in database
‚ÑπÔ∏è Customer 4QV9HBRD6SY5F3ESB848T3W9HC not in database yet - need to add them first
‚ùå Error fetching/adding customer from Square: Response status code was not ok: 401.
{"ts":"2025-11-28T22:42:40.533Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"1c1aea23-557a-4042-8d52-e49e6164661e","stage":"booking","correlationId":"booking-created:06ca3c62d250d01ff07be225"}
{"ts":"2025-11-28T22:42:40.691Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"e5e10511-45dd-48b7-8225-ad48dea6f0b5","stage":"customer_ingest","correlationId":"customer-created:b917c9e537337b81509d9c69","attempts":1}
üì• Received customer data: {
  "id": "4QV9HBRD6SY5F3ESB848T3W9HC",
  "address": {
    "country": "US"
  },
  "version": 0,
  "group_ids": [
    "LT4ZHFBQQYB2N.APPOINTMENTS"
  ],
  "created_at": "2025-11-28T15:36:25.553Z",
  "given_name": "Sophie",
  "updated_at": "2025-11-28T15:36:25Z",
  "family_name": "Viaud",
  "preferences": {
    "email_unsubscribed": false
  },
  "phone_number": "+16194511948",
  "email_address": "sofy_vi@yahoo.fr",
  "creation_source": "APPOINTMENTS"
}
üë§ Processing customer creation: 4QV9HBRD6SY5F3ESB848T3W9HC
üìç IP Address: unknown
üìß Email: sofy_vi@yahoo.fr
üìû Phone: +16194511948
üë§ Name: Sophie Viaud
‚ö†Ô∏è Suspicious IP activity detected: unknown used by 99 customers
‚ö†Ô∏è Suspicious activity detected for customer 4QV9HBRD6SY5F3ESB848T3W9HC, flagging for review
üéâ New customer detected: 4QV9HBRD6SY5F3ESB848T3W9HC
‚úÖ Customer added to database as NEW (temporary mark)
   - Will check for referral code when they book
   - Will give gift card on first booking if code found
‚úÖ Verification: Customer found in DB: true
{"ts":"2025-11-28T22:42:40.968Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"e5e10511-45dd-48b7-8225-ad48dea6f0b5","stage":"customer_ingest","correlationId":"customer-created:b917c9e537337b81509d9c69"}
{"ts":"2025-11-28T22:42:41.128Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"c4283014-5f2a-4b0a-aae7-e1d5763bb827","stage":"booking","correlationId":"booking-created:ae777100b6f1fbc498ae4610","attempts":1}
üìÖ Processing booking created for customer: N5285Y2QAH1H4RNPA2T4WY99ZC
Full booking data: {
  "id": "nf2ilx5vbvd5jj",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-08T17:00:00Z",
  "created_at": "2025-11-28T16:01:11Z",
  "updated_at": "2025-11-28T16:01:11Z",
  "customer_id": "N5285Y2QAH1H4RNPA2T4WY99ZC",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "N5285Y2QAH1H4RNPA2T4WY99ZC",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TM1L5yPC-yKx6CyO",
      "any_team_member": false,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "NCOIL6ZGDTCC7SO3IJHENCQ2",
      "service_variation_version": 1764191999049,
      "service_variation_client_id": "NCOIL6ZGDTCC7SO3IJHENCQ2"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Sarah Gehrki
üéâ First booking detected for customer: N5285Y2QAH1H4RNPA2T4WY99ZC
   Name: Sarah Gehrki
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer N5285Y2QAH1H4RNPA2T4WY99ZC...
Error getting custom attributes for customer N5285Y2QAH1H4RNPA2T4WY99ZC: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: N5285Y2QAH1H4RNPA2T4WY99ZC
{"ts":"2025-11-28T22:42:41.439Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"c4283014-5f2a-4b0a-aae7-e1d5763bb827","stage":"booking","correlationId":"booking-created:ae777100b6f1fbc498ae4610"}
{"ts":"2025-11-28T22:42:41.599Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"339bb22c-2e79-40fa-a6f9-904692a70e7f","stage":"booking","correlationId":"booking-created:b7cf59fb1d206aeb7da0e704","attempts":1}
üìÖ Processing booking created for customer: AAMRRB8R8E1FWV04DNRAYCBKE4
Full booking data: {
  "id": "2ke3hwcughipnb",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-05T22:20:00Z",
  "created_at": "2025-11-28T17:03:00Z",
  "updated_at": "2025-11-28T17:03:00Z",
  "customer_id": "AAMRRB8R8E1FWV04DNRAYCBKE4",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "AAMRRB8R8E1FWV04DNRAYCBKE4",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMEWAZHdtaiRR_Zs",
      "any_team_member": true,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Irma Acosta
üéâ First booking detected for customer: AAMRRB8R8E1FWV04DNRAYCBKE4
   Name: Irma Acosta
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer AAMRRB8R8E1FWV04DNRAYCBKE4...
Error getting custom attributes for customer AAMRRB8R8E1FWV04DNRAYCBKE4: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: AAMRRB8R8E1FWV04DNRAYCBKE4
{"ts":"2025-11-28T22:42:41.915Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"339bb22c-2e79-40fa-a6f9-904692a70e7f","stage":"booking","correlationId":"booking-created:b7cf59fb1d206aeb7da0e704"}
{"ts":"2025-11-28T22:42:42.076Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"a340bd0d-0f49-4924-9260-791fd62292f2","stage":"booking","correlationId":"booking-created:0f87e82896e60ce2ab12e859","attempts":1}
üìÖ Processing booking created for customer: AAMRRB8R8E1FWV04DNRAYCBKE4
Full booking data: {
  "id": "kei72cua1n7ble",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-21T20:00:00Z",
  "created_at": "2025-11-28T17:06:08Z",
  "updated_at": "2025-11-28T17:06:08Z",
  "customer_id": "AAMRRB8R8E1FWV04DNRAYCBKE4",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "AAMRRB8R8E1FWV04DNRAYCBKE4",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMEWAZHdtaiRR_Zs",
      "any_team_member": true,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Irma Acosta
üéâ First booking detected for customer: AAMRRB8R8E1FWV04DNRAYCBKE4
   Name: Irma Acosta
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer AAMRRB8R8E1FWV04DNRAYCBKE4...
Error getting custom attributes for customer AAMRRB8R8E1FWV04DNRAYCBKE4: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: AAMRRB8R8E1FWV04DNRAYCBKE4
{"ts":"2025-11-28T22:42:42.403Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"a340bd0d-0f49-4924-9260-791fd62292f2","stage":"booking","correlationId":"booking-created:0f87e82896e60ce2ab12e859"}
{"ts":"2025-11-28T22:42:42.565Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"7c6b86f4-9594-49eb-8b80-2fa7b6820fb7","stage":"payment","correlationId":"payment-updated:52452da848dd31a767ffc654","attempts":1}
üí∞ Processing payment completion for customer: 6NX857RCQJH90TW3ZQYSY1NDCR
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Hannah Mace
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Hannah Mace, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Hannah Mace
   - Email: hannah.mace93@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: 6NX857RCQJH90TW3ZQYSY1NDCR
{"ts":"2025-11-28T22:42:42.873Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"7c6b86f4-9594-49eb-8b80-2fa7b6820fb7","stage":"payment","correlationId":"payment-updated:52452da848dd31a767ffc654"}
{"ts":"2025-11-28T22:42:43.038Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"2d7f8479-7be8-46dd-b9c1-3e159c49d0a2","stage":"payment","correlationId":"payment-updated:6e686d134d636c3830560fdf","attempts":1}
üí∞ Processing payment completion for customer: 6NX857RCQJH90TW3ZQYSY1NDCR
   Payment source_type: CARD
   Payment tender_types: []
Customer 6NX857RCQJH90TW3ZQYSY1NDCR already completed first payment
{"ts":"2025-11-28T22:42:43.173Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"2d7f8479-7be8-46dd-b9c1-3e159c49d0a2","stage":"payment","correlationId":"payment-updated:6e686d134d636c3830560fdf"}
{"ts":"2025-11-28T22:42:43.337Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"295ff5f5-a827-4487-ac74-875189122b16","stage":"booking","correlationId":"booking-created:7e55392bf156d3745c1c5b11","attempts":1}
üìÖ Processing booking created for customer: ERBZFAB2EN8965F1NF03E7G9YG
Full booking data: {
  "id": "bqdgymsyrrqjd3",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-06T23:50:00Z",
  "created_at": "2025-11-28T18:18:14Z",
  "updated_at": "2025-11-28T18:18:14Z",
  "customer_id": "ERBZFAB2EN8965F1NF03E7G9YG",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "ERBZFAB2EN8965F1NF03E7G9YG",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMVwAQUdLz6no-cB",
      "any_team_member": false,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Victoria Gruber
üéâ First booking detected for customer: ERBZFAB2EN8965F1NF03E7G9YG
   Name: Victoria Gruber
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer ERBZFAB2EN8965F1NF03E7G9YG...
Error getting custom attributes for customer ERBZFAB2EN8965F1NF03E7G9YG: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: ERBZFAB2EN8965F1NF03E7G9YG
{"ts":"2025-11-28T22:42:43.659Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"295ff5f5-a827-4487-ac74-875189122b16","stage":"booking","correlationId":"booking-created:7e55392bf156d3745c1c5b11"}
{"ts":"2025-11-28T22:42:43.820Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"b9c164fc-205a-4f5c-8fdc-0c8a2f19128c","stage":"customer_ingest","correlationId":"customer-created:37b140e7e2e739dd22b1b5b3","attempts":1}
üì• Received customer data: {
  "id": "6Q5F0DQF07AJ6EB9CBFV6NW6B4",
  "address": {
    "country": "US"
  },
  "version": 0,
  "group_ids": [
    "LT4ZHFBQQYB2N.APPOINTMENTS"
  ],
  "created_at": "2025-11-28T18:38:33.961Z",
  "given_name": "Olya",
  "updated_at": "2025-11-28T18:38:33Z",
  "family_name": "Surits",
  "preferences": {
    "email_unsubscribed": false
  },
  "phone_number": "+15034767527",
  "email_address": "olyasurits@gmail.com",
  "creation_source": "APPOINTMENTS"
}
üë§ Processing customer creation: 6Q5F0DQF07AJ6EB9CBFV6NW6B4
üìç IP Address: unknown
üìß Email: olyasurits@gmail.com
üìû Phone: +15034767527
üë§ Name: Olya Surits
‚ö†Ô∏è Suspicious IP activity detected: unknown used by 100 customers
‚ö†Ô∏è Suspicious activity detected for customer 6Q5F0DQF07AJ6EB9CBFV6NW6B4, flagging for review
üéâ New customer detected: 6Q5F0DQF07AJ6EB9CBFV6NW6B4
‚úÖ Customer added to database as NEW (temporary mark)
   - Will check for referral code when they book
   - Will give gift card on first booking if code found
‚úÖ Verification: Customer found in DB: true
{"ts":"2025-11-28T22:42:44.096Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"b9c164fc-205a-4f5c-8fdc-0c8a2f19128c","stage":"customer_ingest","correlationId":"customer-created:37b140e7e2e739dd22b1b5b3"}
{"ts":"2025-11-28T22:42:44.257Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"fe85dff4-1d93-4752-9ed3-dd21cedf83dd","stage":"booking","correlationId":"booking-created:576bb19a2d7c3d1464158dcb","attempts":1}
üìÖ Processing booking created for customer: 6Q5F0DQF07AJ6EB9CBFV6NW6B4
Full booking data: {
  "id": "48nxpsfqqpg90s",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-11-30T01:30:00Z",
  "created_at": "2025-11-28T18:38:36Z",
  "updated_at": "2025-11-28T18:38:36Z",
  "customer_id": "6Q5F0DQF07AJ6EB9CBFV6NW6B4",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "6Q5F0DQF07AJ6EB9CBFV6NW6B4",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "resource_ids": [
        "5OVIQ6GSSUXORACP6T7WBAQ7"
      ],
      "team_member_id": "TM-zXe9fXe4axYWn",
      "any_team_member": true,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "ZEAKNB35I37RMXNUBGWDZQIM",
      "service_variation_version": 1760895536505,
      "service_variation_client_id": "ZEAKNB35I37RMXNUBGWDZQIM"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Olya Surits
üéâ First booking detected for customer: 6Q5F0DQF07AJ6EB9CBFV6NW6B4
   Name: Olya Surits
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 6Q5F0DQF07AJ6EB9CBFV6NW6B4...
Error getting custom attributes for customer 6Q5F0DQF07AJ6EB9CBFV6NW6B4: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 6Q5F0DQF07AJ6EB9CBFV6NW6B4
{"ts":"2025-11-28T22:42:44.566Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"fe85dff4-1d93-4752-9ed3-dd21cedf83dd","stage":"booking","correlationId":"booking-created:576bb19a2d7c3d1464158dcb"}
{"ts":"2025-11-28T22:42:44.727Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"5d9ba23d-8649-4fb9-ad2d-4d8b9f5f89ef","stage":"payment","correlationId":"payment-updated:a67935b85e088c1c1a0ef42d","attempts":1}
üí∞ Processing payment completion for customer: 914TTY3NC0NWXPRS78H86E56RR
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Anastasia Bloise
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Anastasia Bloise, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Anastasia Bloise
   - Email: anastasiabloise@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: 914TTY3NC0NWXPRS78H86E56RR
{"ts":"2025-11-28T22:42:45.034Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"5d9ba23d-8649-4fb9-ad2d-4d8b9f5f89ef","stage":"payment","correlationId":"payment-updated:a67935b85e088c1c1a0ef42d"}
{"ts":"2025-11-28T22:42:45.194Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"af3dd3d8-4445-4ed5-9933-6ce4cfacd4e8","stage":"payment","correlationId":"payment-updated:e4be4697a9c8ce65faab89b4","attempts":1}
üí∞ Processing payment completion for customer: 914TTY3NC0NWXPRS78H86E56RR
   Payment source_type: CARD
   Payment tender_types: []
Customer 914TTY3NC0NWXPRS78H86E56RR already completed first payment
{"ts":"2025-11-28T22:42:45.331Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"af3dd3d8-4445-4ed5-9933-6ce4cfacd4e8","stage":"payment","correlationId":"payment-updated:e4be4697a9c8ce65faab89b4"}
{"ts":"2025-11-28T22:42:45.490Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"df687779-680a-46c1-987d-ad701b12fe39","stage":"payment","correlationId":"payment-updated:7957f0a60c28f44189a4ec6b","attempts":1}
üí∞ Processing payment completion for customer: Q0Z1WXEJS56Z4TJPMEE4SDTDG4
   Payment source_type: CASH
   Payment tender_types: []
üéâ First payment completed for customer: Ariana Stevens
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Ariana Stevens, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Ariana Stevens
   - Email: arianastevens6@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: Q0Z1WXEJS56Z4TJPMEE4SDTDG4
{"ts":"2025-11-28T22:42:45.795Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"df687779-680a-46c1-987d-ad701b12fe39","stage":"payment","correlationId":"payment-updated:7957f0a60c28f44189a4ec6b"}
{"ts":"2025-11-28T22:42:45.954Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"163dfca4-a0a0-4dc3-a9fb-5572ee447f32","stage":"booking","correlationId":"booking-created:dd1be896a9efd77e227397e4","attempts":1}
üìÖ Processing booking created for customer: X9V7VBD7TKWHX75HY3J70PR5M0
Full booking data: {
  "id": "l4ftqq4fusgiy8",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-11-29T18:00:00Z",
  "created_at": "2025-11-28T19:06:52Z",
  "updated_at": "2025-11-28T19:06:52Z",
  "customer_id": "X9V7VBD7TKWHX75HY3J70PR5M0",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "X9V7VBD7TKWHX75HY3J70PR5M0",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMNW4SIF7tjp4oM_",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "BRSIGZFOWC6F4ERPKX3CODLU",
      "service_variation_version": 1764191999049,
      "service_variation_client_id": "BRSIGZFOWC6F4ERPKX3CODLU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Riya Jagetia
üéâ First booking detected for customer: X9V7VBD7TKWHX75HY3J70PR5M0
   Name: Riya Jagetia
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer X9V7VBD7TKWHX75HY3J70PR5M0...
Error getting custom attributes for customer X9V7VBD7TKWHX75HY3J70PR5M0: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: X9V7VBD7TKWHX75HY3J70PR5M0
{"ts":"2025-11-28T22:42:46.271Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"163dfca4-a0a0-4dc3-a9fb-5572ee447f32","stage":"booking","correlationId":"booking-created:dd1be896a9efd77e227397e4"}
{"ts":"2025-11-28T22:42:46.432Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"11b013fe-10b4-4628-89cf-1e5242043d7f","stage":"booking","correlationId":"booking-created:56ea998e1cd8364cda1ec0a4","attempts":1}
üìÖ Processing booking created for customer: 992FQZKFJWK2SH6P04Q1DK8Q0G
Full booking data: {
  "id": "kskmvkoc3z6g65",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-03T19:50:00Z",
  "created_at": "2025-11-28T19:23:28Z",
  "updated_at": "2025-11-28T19:23:28Z",
  "customer_id": "992FQZKFJWK2SH6P04Q1DK8Q0G",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "992FQZKFJWK2SH6P04Q1DK8Q0G",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMgsjtuk5cfKnstq",
      "any_team_member": false,
      "duration_minutes": 110,
      "intermission_minutes": 0,
      "service_variation_id": "6TYOE67IDYTKHW2ZG6HKVZER",
      "service_variation_version": 1764191999049,
      "service_variation_client_id": "6TYOE67IDYTKHW2ZG6HKVZER"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Jacki Jones
üéâ First booking detected for customer: 992FQZKFJWK2SH6P04Q1DK8Q0G
   Name: Jacki Jones
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 992FQZKFJWK2SH6P04Q1DK8Q0G...
Error getting custom attributes for customer 992FQZKFJWK2SH6P04Q1DK8Q0G: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 992FQZKFJWK2SH6P04Q1DK8Q0G
{"ts":"2025-11-28T22:42:46.743Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"11b013fe-10b4-4628-89cf-1e5242043d7f","stage":"booking","correlationId":"booking-created:56ea998e1cd8364cda1ec0a4"}
{"ts":"2025-11-28T22:42:46.903Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"baf3a3c7-970e-4383-b4ea-43b0f4211021","stage":"booking","correlationId":"booking-created:27faff185028349156fea8d4","attempts":1}
üìÖ Processing booking created for customer: 2C1VE5PYG1ZD8291E2P299G1XG
Full booking data: {
  "id": "7szjrtrdy5hqcq",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-11-30T21:25:00Z",
  "created_at": "2025-11-28T19:24:28Z",
  "updated_at": "2025-11-28T19:24:28Z",
  "customer_id": "2C1VE5PYG1ZD8291E2P299G1XG",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMQPbDVvvOCLwqsy"
  },
  "appointment_segments": [
    {
      "team_member_id": "TM7_r-KmvY9xjnEU",
      "any_team_member": false,
      "duration_minutes": 110,
      "intermission_minutes": 0,
      "service_variation_id": "GJ5SRTYFV6ZCDI62TMSZP2OP",
      "service_variation_version": 1757963765505,
      "service_variation_client_id": "GJ5SRTYFV6ZCDI62TMSZP2OP"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Molly Surbridge
üéâ First booking detected for customer: 2C1VE5PYG1ZD8291E2P299G1XG
   Name: Molly Surbridge
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 2C1VE5PYG1ZD8291E2P299G1XG...
Error getting custom attributes for customer 2C1VE5PYG1ZD8291E2P299G1XG: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 2C1VE5PYG1ZD8291E2P299G1XG
{"ts":"2025-11-28T22:42:47.201Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"baf3a3c7-970e-4383-b4ea-43b0f4211021","stage":"booking","correlationId":"booking-created:27faff185028349156fea8d4"}
{"ts":"2025-11-28T22:42:47.361Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"cc7a8457-6cd7-41cf-93d8-80e68ba0a4f7","stage":"payment","correlationId":"payment-updated:d7c3a0d7a6b869c279689fd1","attempts":1}
üí∞ Processing payment completion for customer: 7C5DG7FXV1F470XV0EX4EHJE1W
   Payment source_type: CARD
   Payment tender_types: []
Customer 7C5DG7FXV1F470XV0EX4EHJE1W already completed first payment
{"ts":"2025-11-28T22:42:47.496Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"cc7a8457-6cd7-41cf-93d8-80e68ba0a4f7","stage":"payment","correlationId":"payment-updated:d7c3a0d7a6b869c279689fd1"}
{"ts":"2025-11-28T22:42:47.655Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"1b08136b-f182-4247-acb7-d9d0f6ab29f1","stage":"payment","correlationId":"payment-updated:090876464cb2d2893e16b4bc","attempts":1}
üí∞ Processing payment completion for customer: 7C5DG7FXV1F470XV0EX4EHJE1W
   Payment source_type: CARD
   Payment tender_types: []
Customer 7C5DG7FXV1F470XV0EX4EHJE1W already completed first payment
{"ts":"2025-11-28T22:42:47.790Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"1b08136b-f182-4247-acb7-d9d0f6ab29f1","stage":"payment","correlationId":"payment-updated:090876464cb2d2893e16b4bc"}
{"ts":"2025-11-28T22:42:47.951Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"c5fb3a5f-66e0-42d1-bc8b-c63da34e2682","stage":"payment","correlationId":"payment-updated:37c260d541b43c553015e755","attempts":1}
üí∞ Processing payment completion for customer: RA6MENEMWJKA1TJS115E0M418G
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Stephanie See
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Stephanie See, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Stephanie See
   - Email: stephanieksee@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: RA6MENEMWJKA1TJS115E0M418G
{"ts":"2025-11-28T22:42:48.260Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"c5fb3a5f-66e0-42d1-bc8b-c63da34e2682","stage":"payment","correlationId":"payment-updated:37c260d541b43c553015e755"}
{"ts":"2025-11-28T22:42:48.423Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"849d1d10-0bf3-45c4-ad90-fabd7f1733c3","stage":"payment","correlationId":"payment-updated:0cb6485b82a5f24cebd523c2","attempts":1}
üí∞ Processing payment completion for customer: RA6MENEMWJKA1TJS115E0M418G
   Payment source_type: CARD
   Payment tender_types: []
Customer RA6MENEMWJKA1TJS115E0M418G already completed first payment
{"ts":"2025-11-28T22:42:48.558Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"849d1d10-0bf3-45c4-ad90-fabd7f1733c3","stage":"payment","correlationId":"payment-updated:0cb6485b82a5f24cebd523c2"}
{"ts":"2025-11-28T22:42:48.716Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"60479415-65eb-438a-b9f0-1df65d824b9c","stage":"booking","correlationId":"booking-created:d235d68a82dd2aa4c638f937","attempts":1}
üìÖ Processing booking created for customer: CMNCWJKJ9FF1W8G6N8XHA7935M
Full booking data: {
  "id": "bn203r5e9nxk11",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-03T17:00:00Z",
  "created_at": "2025-11-28T20:01:32Z",
  "updated_at": "2025-11-28T20:01:32Z",
  "customer_id": "CMNCWJKJ9FF1W8G6N8XHA7935M",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "CMNCWJKJ9FF1W8G6N8XHA7935M",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TM9jDlRr_Hl4rdBB",
      "any_team_member": false,
      "duration_minutes": 150,
      "intermission_minutes": 0,
      "service_variation_id": "QSVIF7ZTUIVIDPQWUMOPYETM",
      "service_variation_version": 1760141204155,
      "service_variation_client_id": "OQPDF4VFFJIPBS5L53UAGIG5"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Hannah Strobel
‚ÑπÔ∏è Customer CMNCWJKJ9FF1W8G6N8XHA7935M already received signup bonus, not first booking
{"ts":"2025-11-28T22:42:48.857Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"60479415-65eb-438a-b9f0-1df65d824b9c","stage":"booking","correlationId":"booking-created:d235d68a82dd2aa4c638f937"}
{"ts":"2025-11-28T22:42:49.018Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"f8774809-3d12-4e46-b801-589d4084ebad","stage":"payment","correlationId":"payment-updated:6b8bd6132d65ec1dbb369d79","attempts":1}
üí∞ Processing payment completion for customer: 09NWVGNMXN29FEN9GNN7CTA02R
   Payment source_type: CARD
   Payment tender_types: []
Customer 09NWVGNMXN29FEN9GNN7CTA02R already completed first payment
{"ts":"2025-11-28T22:42:49.153Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"f8774809-3d12-4e46-b801-589d4084ebad","stage":"payment","correlationId":"payment-updated:6b8bd6132d65ec1dbb369d79"}
{"ts":"2025-11-28T22:42:49.314Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"a59f4288-3dc6-48cb-93ee-ad2d0676e084","stage":"payment","correlationId":"payment-updated:de0ee7fd6fad511782230725","attempts":1}
üí∞ Processing payment completion for customer: 09NWVGNMXN29FEN9GNN7CTA02R
   Payment source_type: CARD
   Payment tender_types: []
Customer 09NWVGNMXN29FEN9GNN7CTA02R already completed first payment
{"ts":"2025-11-28T22:42:49.452Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"a59f4288-3dc6-48cb-93ee-ad2d0676e084","stage":"payment","correlationId":"payment-updated:de0ee7fd6fad511782230725"}
{"ts":"2025-11-28T22:42:49.614Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"39e9f60f-9ae1-403a-b837-9984be9cbd10","stage":"booking","correlationId":"booking-created:afedce62f1866988955c1534","attempts":1}
üìÖ Processing booking created for customer: 7HPY37YYPCWZBB15S28S35D914
Full booking data: {
  "id": "hgg5u1mv0a621a",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-11-28T23:00:00Z",
  "created_at": "2025-11-28T20:20:41Z",
  "updated_at": "2025-11-28T20:20:41Z",
  "customer_id": "7HPY37YYPCWZBB15S28S35D914",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMWAtQTYmZpwwxii"
  },
  "appointment_segments": [
    {
      "team_member_id": "TM-zXe9fXe4axYWn",
      "any_team_member": false,
      "duration_minutes": 15,
      "intermission_minutes": 0,
      "service_variation_id": "KBHPHVKLJNAF223GMYIRUUH3",
      "service_variation_version": 1760895536505,
      "service_variation_client_id": "KBHPHVKLJNAF223GMYIRUUH3"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Kiana Afshar
üéâ First booking detected for customer: 7HPY37YYPCWZBB15S28S35D914
   Name: Kiana Afshar
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 7HPY37YYPCWZBB15S28S35D914...
Error getting custom attributes for customer 7HPY37YYPCWZBB15S28S35D914: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 7HPY37YYPCWZBB15S28S35D914
{"ts":"2025-11-28T22:42:49.914Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"39e9f60f-9ae1-403a-b837-9984be9cbd10","stage":"booking","correlationId":"booking-created:afedce62f1866988955c1534"}
{"ts":"2025-11-28T22:42:50.074Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"c1c8076e-deb1-4ca9-a41a-55eac35776ad","stage":"payment","correlationId":"payment-updated:a51208e3f26d786cc3507951","attempts":1}
üí∞ Processing payment completion for customer: 15V7XEYDNJGYSZY45WDQYB4QA0
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Rebecca Deubler
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Rebecca Deubler, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Rebecca Deubler
   - Email: deublerr@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: 15V7XEYDNJGYSZY45WDQYB4QA0
{"ts":"2025-11-28T22:42:50.378Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"c1c8076e-deb1-4ca9-a41a-55eac35776ad","stage":"payment","correlationId":"payment-updated:a51208e3f26d786cc3507951"}
{"ts":"2025-11-28T22:42:50.537Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"f139e694-e9ef-4070-884a-48371b9ebee9","stage":"payment","correlationId":"payment-updated:1e0339790641379e69deffb9","attempts":1}
üí∞ Processing payment completion for customer: 15V7XEYDNJGYSZY45WDQYB4QA0
   Payment source_type: CARD
   Payment tender_types: []
Customer 15V7XEYDNJGYSZY45WDQYB4QA0 already completed first payment
{"ts":"2025-11-28T22:42:50.676Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"f139e694-e9ef-4070-884a-48371b9ebee9","stage":"payment","correlationId":"payment-updated:1e0339790641379e69deffb9"}
{"ts":"2025-11-28T22:42:50.836Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"7d616780-6d1a-4170-a098-5f72741ff424","stage":"booking","correlationId":"booking-created:6a6cab5aca719f3ecac0aca9","attempts":1}
üìÖ Processing booking created for customer: N4RA16EQ8W8S4HK31M7FP10Y4W
Full booking data: {
  "id": "5yuqvdmmb7nphn",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-08T19:40:00Z",
  "created_at": "2025-11-28T20:42:42Z",
  "updated_at": "2025-11-28T20:42:42Z",
  "customer_id": "N4RA16EQ8W8S4HK31M7FP10Y4W",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "N4RA16EQ8W8S4HK31M7FP10Y4W",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMILsQUVwLkLzbVo",
      "any_team_member": false,
      "duration_minutes": 100,
      "intermission_minutes": 0,
      "service_variation_id": "BM556FTNFOTEHYVG4GPXAXFM",
      "service_variation_version": 1764191999049,
      "service_variation_client_id": "BM556FTNFOTEHYVG4GPXAXFM"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Michele Collier
üéâ First booking detected for customer: N4RA16EQ8W8S4HK31M7FP10Y4W
   Name: Michele Collier
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer N4RA16EQ8W8S4HK31M7FP10Y4W...
Error getting custom attributes for customer N4RA16EQ8W8S4HK31M7FP10Y4W: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: N4RA16EQ8W8S4HK31M7FP10Y4W
{"ts":"2025-11-28T22:42:51.139Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"7d616780-6d1a-4170-a098-5f72741ff424","stage":"booking","correlationId":"booking-created:6a6cab5aca719f3ecac0aca9"}
{"ts":"2025-11-28T22:42:51.298Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"24db6c02-badd-4b83-8984-d30ed59a96f2","stage":"booking","correlationId":"booking-created:b162e598591bdb29f96caeb0","attempts":1}
üìÖ Processing booking created for customer: Y7FV3D94JAGMBR4WP3SNE82ZKC
Full booking data: {
  "id": "5movx134jw4kk5",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-08T23:00:00Z",
  "created_at": "2025-11-28T21:01:15Z",
  "updated_at": "2025-11-28T21:01:15Z",
  "customer_id": "Y7FV3D94JAGMBR4WP3SNE82ZKC",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "Y7FV3D94JAGMBR4WP3SNE82ZKC",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMNW4SIF7tjp4oM_",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "BRSIGZFOWC6F4ERPKX3CODLU",
      "service_variation_version": 1764191999049,
      "service_variation_client_id": "BRSIGZFOWC6F4ERPKX3CODLU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: katie Coutermarsh
üéâ First booking detected for customer: Y7FV3D94JAGMBR4WP3SNE82ZKC
   Name: katie Coutermarsh
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer Y7FV3D94JAGMBR4WP3SNE82ZKC...
Error getting custom attributes for customer Y7FV3D94JAGMBR4WP3SNE82ZKC: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: Y7FV3D94JAGMBR4WP3SNE82ZKC
{"ts":"2025-11-28T22:42:51.604Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"24db6c02-badd-4b83-8984-d30ed59a96f2","stage":"booking","correlationId":"booking-created:b162e598591bdb29f96caeb0"}
{"ts":"2025-11-28T22:42:51.765Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"5eb6cd81-2539-43bd-b0ea-013ab6a432c0","stage":"booking","correlationId":"booking-created:28cfc06fc3a939417c0185ec","attempts":1}
üìÖ Processing booking created for customer: GAQYPGFH1S596HTSQQQKKZDKV0
Full booking data: {
  "id": "6gnpvuwcb5099k",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-11-29T01:40:00Z",
  "created_at": "2025-11-28T21:10:20Z",
  "updated_at": "2025-11-28T21:10:20Z",
  "customer_id": "GAQYPGFH1S596HTSQQQKKZDKV0",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "GAQYPGFH1S596HTSQQQKKZDKV0",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMkdrQsxG5tlf-c_",
      "any_team_member": true,
      "duration_minutes": 140,
      "intermission_minutes": 0,
      "service_variation_id": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "CJI5WHOAKSFTASYPJ4MSYZLS"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 0 customer(s) in database
‚ÑπÔ∏è Customer GAQYPGFH1S596HTSQQQKKZDKV0 not in database yet - need to add them first
‚ùå Error fetching/adding customer from Square: Response status code was not ok: 401.
{"ts":"2025-11-28T22:42:52.039Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"5eb6cd81-2539-43bd-b0ea-013ab6a432c0","stage":"booking","correlationId":"booking-created:28cfc06fc3a939417c0185ec"}
{"ts":"2025-11-28T22:42:52.199Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"f669b977-a902-4357-9154-fb7d5b001f32","stage":"customer_ingest","correlationId":"customer-created:a9ce2f6961d7560adb0002c0","attempts":1}
üì• Received customer data: {
  "id": "GAQYPGFH1S596HTSQQQKKZDKV0",
  "address": {
    "country": "US"
  },
  "version": 0,
  "group_ids": [
    "LT4ZHFBQQYB2N.APPOINTMENTS"
  ],
  "created_at": "2025-11-28T21:10:17.98Z",
  "given_name": "Campbell",
  "updated_at": "2025-11-28T21:10:17Z",
  "family_name": "Wilson",
  "preferences": {
    "email_unsubscribed": false
  },
  "phone_number": "+17036789501",
  "email_address": "Campbellwilson1@gmail.com",
  "creation_source": "APPOINTMENTS"
}
üë§ Processing customer creation: GAQYPGFH1S596HTSQQQKKZDKV0
üìç IP Address: unknown
üìß Email: Campbellwilson1@gmail.com
üìû Phone: +17036789501
üë§ Name: Campbell Wilson
‚ö†Ô∏è Suspicious IP activity detected: unknown used by 101 customers
‚ö†Ô∏è Suspicious activity detected for customer GAQYPGFH1S596HTSQQQKKZDKV0, flagging for review
üéâ New customer detected: GAQYPGFH1S596HTSQQQKKZDKV0
‚úÖ Customer added to database as NEW (temporary mark)
   - Will check for referral code when they book
   - Will give gift card on first booking if code found
‚úÖ Verification: Customer found in DB: true
{"ts":"2025-11-28T22:42:52.473Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"f669b977-a902-4357-9154-fb7d5b001f32","stage":"customer_ingest","correlationId":"customer-created:a9ce2f6961d7560adb0002c0"}
{"ts":"2025-11-28T22:42:52.633Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"41bd79da-bef0-4bb2-bd74-5b34289d7558","stage":"payment","correlationId":"payment-updated:34028b62e4e76c81e0c24a1f","attempts":1}
üí∞ Processing payment completion for customer: 273X4Q5M7SE3Z15S9339Z2R1DG
   Payment source_type: CASH
   Payment tender_types: []
üéâ First payment completed for customer: Lauren Stoll
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Lauren Stoll, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Lauren Stoll
   - Email: lauren.stoll429@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: 273X4Q5M7SE3Z15S9339Z2R1DG
{"ts":"2025-11-28T22:42:52.971Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"41bd79da-bef0-4bb2-bd74-5b34289d7558","stage":"payment","correlationId":"payment-updated:34028b62e4e76c81e0c24a1f"}
{"ts":"2025-11-28T22:42:53.135Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"8be28c3b-64bc-4eb6-926c-a5ba496514ba","stage":"payment","correlationId":"payment-updated:29be4e2903020d51df2972d6","attempts":1}
üí∞ Processing payment completion for customer: EGNE9GYEA996T5R45JN8E8T910
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Kelly Maloney
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Kelly Maloney, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Kelly Maloney
   - Email: kelly.maloney35@icloud.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: EGNE9GYEA996T5R45JN8E8T910
{"ts":"2025-11-28T22:42:53.447Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"8be28c3b-64bc-4eb6-926c-a5ba496514ba","stage":"payment","correlationId":"payment-updated:29be4e2903020d51df2972d6"}
{"ts":"2025-11-28T22:42:53.610Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"703b30a7-79ad-42ea-870a-e797e9537942","stage":"payment","correlationId":"payment-updated:e11cb522174504fa2eb73325","attempts":1}
üí∞ Processing payment completion for customer: EGNE9GYEA996T5R45JN8E8T910
   Payment source_type: CARD
   Payment tender_types: []
Customer EGNE9GYEA996T5R45JN8E8T910 already completed first payment
{"ts":"2025-11-28T22:42:53.745Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"703b30a7-79ad-42ea-870a-e797e9537942","stage":"payment","correlationId":"payment-updated:e11cb522174504fa2eb73325"}
{"ts":"2025-11-28T22:42:53.907Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"1bdbfb9d-2deb-4522-9137-cfd7a9d73fc8","stage":"booking","correlationId":"booking-created:bdb3d1c4a284ae5468b81785","attempts":1}
üìÖ Processing booking created for customer: EGNE9GYEA996T5R45JN8E8T910
Full booking data: {
  "id": "dpnjz8al9kyjk7",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-10T17:00:00Z",
  "created_at": "2025-11-28T21:23:33Z",
  "updated_at": "2025-11-28T21:23:33Z",
  "customer_id": "EGNE9GYEA996T5R45JN8E8T910",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMWAtQTYmZpwwxii"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMVwAQUdLz6no-cB",
      "any_team_member": false,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Kelly Maloney
üéâ First booking detected for customer: EGNE9GYEA996T5R45JN8E8T910
   Name: Kelly Maloney
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer EGNE9GYEA996T5R45JN8E8T910...
Error getting custom attributes for customer EGNE9GYEA996T5R45JN8E8T910: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: EGNE9GYEA996T5R45JN8E8T910
{"ts":"2025-11-28T22:42:54.212Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"1bdbfb9d-2deb-4522-9137-cfd7a9d73fc8","stage":"booking","correlationId":"booking-created:bdb3d1c4a284ae5468b81785"}
{"ts":"2025-11-28T22:42:54.373Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"14fee3f6-3fae-4b5f-9e78-4f544cd30bc7","stage":"booking","correlationId":"booking-created:79307ab6e9022d39eb3da3cd","attempts":1}
üìÖ Processing booking created for customer: EGNE9GYEA996T5R45JN8E8T910
Full booking data: {
  "id": "l1xxldsynh4ino",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-10T17:00:00Z",
  "created_at": "2025-11-28T21:24:01Z",
  "updated_at": "2025-11-28T21:24:01Z",
  "customer_id": "EGNE9GYEA996T5R45JN8E8T910",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMWAtQTYmZpwwxii"
  },
  "appointment_segments": [
    {
      "resource_ids": [
        "5OVIQ6GSSUXORACP6T7WBAQ7"
      ],
      "team_member_id": "TM-zXe9fXe4axYWn",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "ZEAKNB35I37RMXNUBGWDZQIM",
      "service_variation_version": 1760895536505,
      "service_variation_client_id": "ZEAKNB35I37RMXNUBGWDZQIM"
    },
    {
      "team_member_id": "TM-zXe9fXe4axYWn",
      "any_team_member": false,
      "duration_minutes": 5,
      "intermission_minutes": 0,
      "service_variation_id": "DBRXEHQPCF7V4APTHDQTZW62",
      "service_variation_version": 1762374620368,
      "service_variation_client_id": "DBRXEHQPCF7V4APTHDQTZW62"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Kelly Maloney
üéâ First booking detected for customer: EGNE9GYEA996T5R45JN8E8T910
   Name: Kelly Maloney
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer EGNE9GYEA996T5R45JN8E8T910...
Error getting custom attributes for customer EGNE9GYEA996T5R45JN8E8T910: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: EGNE9GYEA996T5R45JN8E8T910
{"ts":"2025-11-28T22:42:54.678Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"14fee3f6-3fae-4b5f-9e78-4f544cd30bc7","stage":"booking","correlationId":"booking-created:79307ab6e9022d39eb3da3cd"}
{"ts":"2025-11-28T22:42:54.838Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"cf17acd7-30bb-44ff-96f6-02a53ed54888","stage":"payment","correlationId":"payment-updated:9a2de47e3211899d76501452","attempts":1}
üí∞ Processing payment completion for customer: DVEK203BNBCAJ9PTSE0GA1HGG4
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Emily Scharenbrock
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Emily Scharenbrock, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Emily Scharenbrock
   - Email: escharenbrock@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: DVEK203BNBCAJ9PTSE0GA1HGG4
{"ts":"2025-11-28T22:42:55.155Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"cf17acd7-30bb-44ff-96f6-02a53ed54888","stage":"payment","correlationId":"payment-updated:9a2de47e3211899d76501452"}
{"ts":"2025-11-28T22:42:55.318Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"6a5e83cd-7aad-4274-a01c-fab8fee74342","stage":"payment","correlationId":"payment-updated:a8ff154107e2c47a36157008","attempts":1}
üí∞ Processing payment completion for customer: DVEK203BNBCAJ9PTSE0GA1HGG4
   Payment source_type: CARD
   Payment tender_types: []
Customer DVEK203BNBCAJ9PTSE0GA1HGG4 already completed first payment
{"ts":"2025-11-28T22:42:55.457Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"6a5e83cd-7aad-4274-a01c-fab8fee74342","stage":"payment","correlationId":"payment-updated:a8ff154107e2c47a36157008"}
{"ts":"2025-11-28T22:42:55.621Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"03952737-9ea2-46ea-9579-868154f01ee6","stage":"payment","correlationId":"payment-updated:ea97e8ef30ff3f743f9ae128","attempts":1}
üí∞ Processing payment completion for customer: 7QEECQDAJ7K1W0BM9HHFQ1NVCR
   Payment source_type: CARD
   Payment tender_types: []
Customer 7QEECQDAJ7K1W0BM9HHFQ1NVCR already completed first payment
{"ts":"2025-11-28T22:42:55.756Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"03952737-9ea2-46ea-9579-868154f01ee6","stage":"payment","correlationId":"payment-updated:ea97e8ef30ff3f743f9ae128"}
{"ts":"2025-11-28T22:42:55.917Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"21e91014-87f0-4a22-8b0c-0bbd7a874063","stage":"payment","correlationId":"payment-updated:a75c09f8123200ce4deabbc3","attempts":1}
üí∞ Processing payment completion for customer: 7QEECQDAJ7K1W0BM9HHFQ1NVCR
   Payment source_type: CARD
   Payment tender_types: []
Customer 7QEECQDAJ7K1W0BM9HHFQ1NVCR already completed first payment
{"ts":"2025-11-28T22:42:56.055Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"21e91014-87f0-4a22-8b0c-0bbd7a874063","stage":"payment","correlationId":"payment-updated:a75c09f8123200ce4deabbc3"}
{"ts":"2025-11-28T22:42:56.217Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"e3dde4bc-60e1-4a46-ab99-2c2e280fffb2","stage":"payment","correlationId":"payment-updated:9bcab426230ba8f16da8a474","attempts":1}
üí∞ Processing payment completion for customer: 446Q3R1YQ956K58XW9SW2W151C
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Luciana Corral
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Luciana Corral, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Luciana Corral
   - Email: corralluciana@yahoo.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: 446Q3R1YQ956K58XW9SW2W151C
{"ts":"2025-11-28T22:42:56.532Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"e3dde4bc-60e1-4a46-ab99-2c2e280fffb2","stage":"payment","correlationId":"payment-updated:9bcab426230ba8f16da8a474"}
{"ts":"2025-11-28T22:42:56.691Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"c79e6927-988b-44df-a1dd-09d0bce0894f","stage":"payment","correlationId":"payment-updated:e124a208a7a18b9e67ec33ee","attempts":1}
üí∞ Processing payment completion for customer: 446Q3R1YQ956K58XW9SW2W151C
   Payment source_type: CARD
   Payment tender_types: []
Customer 446Q3R1YQ956K58XW9SW2W151C already completed first payment
{"ts":"2025-11-28T22:42:56.826Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"c79e6927-988b-44df-a1dd-09d0bce0894f","stage":"payment","correlationId":"payment-updated:e124a208a7a18b9e67ec33ee"}
{"ts":"2025-11-28T22:42:56.986Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"7f271975-11de-4611-915c-721afe6647c4","stage":"booking","correlationId":"booking-created:fcfabf97661ece4905a4f1cb","attempts":1}
üìÖ Processing booking created for customer: EDAP6Z012DMZHGTSXQMT56MKPM
Full booking data: {
  "id": "ojl4kuo3lrgk97",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-22T17:00:00Z",
  "created_at": "2025-11-28T22:36:14Z",
  "updated_at": "2025-11-28T22:36:14Z",
  "customer_id": "EDAP6Z012DMZHGTSXQMT56MKPM",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "EDAP6Z012DMZHGTSXQMT56MKPM",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMNW4SIF7tjp4oM_",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "BRSIGZFOWC6F4ERPKX3CODLU",
      "service_variation_version": 1764191999049,
      "service_variation_client_id": "BRSIGZFOWC6F4ERPKX3CODLU"
    },
    {
      "team_member_id": "TMNW4SIF7tjp4oM_",
      "any_team_member": false,
      "duration_minutes": 20,
      "intermission_minutes": 0,
      "service_variation_id": "HAJX45W3U2WUCCXM5MI24UEE",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "HAJX45W3U2WUCCXM5MI24UEE"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Kristine Blukis
üéâ First booking detected for customer: EDAP6Z012DMZHGTSXQMT56MKPM
   Name: Kristine Blukis
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer EDAP6Z012DMZHGTSXQMT56MKPM...
Error getting custom attributes for customer EDAP6Z012DMZHGTSXQMT56MKPM: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: EDAP6Z012DMZHGTSXQMT56MKPM
{"ts":"2025-11-28T22:42:57.476Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"7f271975-11de-4611-915c-721afe6647c4","stage":"booking","correlationId":"booking-created:fcfabf97661ece4905a4f1cb"}
{"ts":"2025-11-28T22:58:51.176Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"50480471-e754-408a-9ff8-80450dac190e","stage":"booking","correlationId":"booking-created:7a0daa545fc862f72b37109b","attempts":1}
üìÖ Processing booking created for customer: BJ6W16Y68C8N9KJXW121EB6VN0
Full booking data: {
  "id": "gkofajgt4idynd",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-11-30T21:00:00Z",
  "created_at": "2025-11-28T22:58:47Z",
  "updated_at": "2025-11-28T22:58:47Z",
  "customer_id": "BJ6W16Y68C8N9KJXW121EB6VN0",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMWAtQTYmZpwwxii"
  },
  "appointment_segments": [
    {
      "team_member_id": "TM-zXe9fXe4axYWn",
      "any_team_member": false,
      "duration_minutes": 140,
      "intermission_minutes": 0,
      "service_variation_id": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "CJI5WHOAKSFTASYPJ4MSYZLS"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Caroline Kelly
‚ÑπÔ∏è Customer BJ6W16Y68C8N9KJXW121EB6VN0 already received signup bonus, not first booking
{"ts":"2025-11-28T22:58:51.558Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"50480471-e754-408a-9ff8-80450dac190e","stage":"booking","correlationId":"booking-created:7a0daa545fc862f72b37109b"}
{"ts":"2025-11-28T23:01:59.839Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"5a638916-34c6-4829-98ae-4ae66af5c648","stage":"booking","correlationId":"booking-created:7928c9155f4ab48b9d79bad4","attempts":1}
üìÖ Processing booking created for customer: ZM1QRE5T76E9EH26E31135V8G0
Full booking data: {
  "id": "j0phx3d3jjm7nq",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-06T20:20:00Z",
  "created_at": "2025-11-28T23:01:57Z",
  "updated_at": "2025-11-28T23:01:57Z",
  "customer_id": "ZM1QRE5T76E9EH26E31135V8G0",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "ZM1QRE5T76E9EH26E31135V8G0",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMOscywuGXO2VURY",
      "any_team_member": true,
      "duration_minutes": 140,
      "intermission_minutes": 0,
      "service_variation_id": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "CJI5WHOAKSFTASYPJ4MSYZLS"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Ariana Nurisso
üéâ First booking detected for customer: ZM1QRE5T76E9EH26E31135V8G0
   Name: Ariana Nurisso
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer ZM1QRE5T76E9EH26E31135V8G0...
Error getting custom attributes for customer ZM1QRE5T76E9EH26E31135V8G0: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: ZM1QRE5T76E9EH26E31135V8G0
{"ts":"2025-11-28T23:02:00.402Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"5a638916-34c6-4829-98ae-4ae66af5c648","stage":"booking","correlationId":"booking-created:7928c9155f4ab48b9d79bad4"}
{"ts":"2025-11-28T23:02:52.302Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"a5862f93-7aee-4e9e-88f0-f8117c2a7098","stage":"payment","correlationId":"payment-updated:20be6b5c34425e527b98ad9d","attempts":1}
üí∞ Processing payment completion for customer: N9PXK9D2TT4RR5GHPX5WTHCBE0
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Sarah Paulhus
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Sarah Paulhus, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Sarah Paulhus
   - Email: sarah.jess.paulhus@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: N9PXK9D2TT4RR5GHPX5WTHCBE0
{"ts":"2025-11-28T23:02:52.787Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"a5862f93-7aee-4e9e-88f0-f8117c2a7098","stage":"payment","correlationId":"payment-updated:20be6b5c34425e527b98ad9d"}
{"ts":"2025-11-28T23:02:55.082Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"959bb4d8-bfab-4a50-a3f4-86eb3fe9d40f","stage":"payment","correlationId":"payment-updated:d52395b9515b521492503cba","attempts":1}
üí∞ Processing payment completion for customer: N9PXK9D2TT4RR5GHPX5WTHCBE0
   Payment source_type: CARD
   Payment tender_types: []
Customer N9PXK9D2TT4RR5GHPX5WTHCBE0 already completed first payment
{"ts":"2025-11-28T23:02:55.218Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"959bb4d8-bfab-4a50-a3f4-86eb3fe9d40f","stage":"payment","correlationId":"payment-updated:d52395b9515b521492503cba"}
{"ts":"2025-11-28T23:06:16.285Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"f96fe43f-4fe4-4ad5-9a02-fe6bb819b3f8","stage":"booking","correlationId":"booking-created:4b4d9bb7720268b3e069bfb9","attempts":1}
üìÖ Processing booking created for customer: NRMZQZFG5FQF4T6QAPDD1GD0T0
Full booking data: {
  "id": "1c2kfjr5bog5cz",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-04T20:00:00Z",
  "created_at": "2025-11-28T23:06:14Z",
  "updated_at": "2025-11-28T23:06:14Z",
  "customer_id": "NRMZQZFG5FQF4T6QAPDD1GD0T0",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "NRMZQZFG5FQF4T6QAPDD1GD0T0",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMMCVDJoKh3ZkfFo",
      "any_team_member": true,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: SEDEF CEYLAN
üéâ First booking detected for customer: NRMZQZFG5FQF4T6QAPDD1GD0T0
   Name: SEDEF CEYLAN
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer NRMZQZFG5FQF4T6QAPDD1GD0T0...
Error getting custom attributes for customer NRMZQZFG5FQF4T6QAPDD1GD0T0: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: NRMZQZFG5FQF4T6QAPDD1GD0T0
{"ts":"2025-11-28T23:06:16.819Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"f96fe43f-4fe4-4ad5-9a02-fe6bb819b3f8","stage":"booking","correlationId":"booking-created:4b4d9bb7720268b3e069bfb9"}
{"ts":"2025-11-28T23:07:10.396Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"67539921-bc04-46ef-93aa-7da06466bb86","stage":"payment","correlationId":"payment-updated:037f2d3b9b47300dfd4a8e1d","attempts":1}
üí∞ Processing payment completion for customer: CAGT4K6TVVA0CA83T6DYE2GVCM
   Payment source_type: CARD
   Payment tender_types: []
Customer CAGT4K6TVVA0CA83T6DYE2GVCM already completed first payment
{"ts":"2025-11-28T23:07:10.675Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"67539921-bc04-46ef-93aa-7da06466bb86","stage":"payment","correlationId":"payment-updated:037f2d3b9b47300dfd4a8e1d"}
{"ts":"2025-11-28T23:07:15.099Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"1d2c6f8f-fd68-4a0d-9465-2822559c277d","stage":"payment","correlationId":"payment-updated:fa03cba638ff584cba97a162","attempts":1}
üí∞ Processing payment completion for customer: CAGT4K6TVVA0CA83T6DYE2GVCM
   Payment source_type: CARD
   Payment tender_types: []
Customer CAGT4K6TVVA0CA83T6DYE2GVCM already completed first payment
{"ts":"2025-11-28T23:07:15.234Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"1d2c6f8f-fd68-4a0d-9465-2822559c277d","stage":"payment","correlationId":"payment-updated:fa03cba638ff584cba97a162"}
{"ts":"2025-11-28T23:18:42.165Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"e3ad8ecf-ef6f-4f32-a1ed-ad2f64acec8b","stage":"booking","correlationId":"booking-created:29a4d6485c1a4518c69927e8","attempts":1}
üìÖ Processing booking created for customer: 96FWAQ72E0EMCPMRAF25FBHX78
Full booking data: {
  "id": "nnh16vitnb0j8k",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-05T17:00:00Z",
  "created_at": "2025-11-28T23:18:38Z",
  "updated_at": "2025-11-28T23:18:38Z",
  "customer_id": "96FWAQ72E0EMCPMRAF25FBHX78",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "96FWAQ72E0EMCPMRAF25FBHX78",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TM9jDlRr_Hl4rdBB",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "XBUDIMNKOPC2XVG5YLIQ4RYS",
      "service_variation_version": 1764191999049,
      "service_variation_client_id": "XBUDIMNKOPC2XVG5YLIQ4RYS"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: LouAnn Micucci
üéâ First booking detected for customer: 96FWAQ72E0EMCPMRAF25FBHX78
   Name: LouAnn Micucci
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 96FWAQ72E0EMCPMRAF25FBHX78...
Error getting custom attributes for customer 96FWAQ72E0EMCPMRAF25FBHX78: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 96FWAQ72E0EMCPMRAF25FBHX78
{"ts":"2025-11-28T23:18:42.745Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"e3ad8ecf-ef6f-4f32-a1ed-ad2f64acec8b","stage":"booking","correlationId":"booking-created:29a4d6485c1a4518c69927e8"}
{"ts":"2025-11-28T23:31:00.465Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"7dcdd372-9d71-4919-ba48-43a800122f0d","stage":"payment","correlationId":"payment-updated:4c93eb898169853bb6041a6c","attempts":1}
üí∞ Processing payment completion for customer: R3SWZDVMPHDCRMBTP1Z8WVAXP0
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Maria Menezes
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Maria Menezes, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Maria Menezes
   - Email: eduarda.tavares.menezes@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: R3SWZDVMPHDCRMBTP1Z8WVAXP0
{"ts":"2025-11-28T23:31:01.053Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"7dcdd372-9d71-4919-ba48-43a800122f0d","stage":"payment","correlationId":"payment-updated:4c93eb898169853bb6041a6c"}
{"ts":"2025-11-28T23:31:03.347Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"eecd76eb-3fd1-49ff-935b-2181aa3eb97b","stage":"payment","correlationId":"payment-updated:e1dfacd43b4330d4de4765be","attempts":1}
üí∞ Processing payment completion for customer: R3SWZDVMPHDCRMBTP1Z8WVAXP0
   Payment source_type: CARD
   Payment tender_types: []
Customer R3SWZDVMPHDCRMBTP1Z8WVAXP0 already completed first payment
{"ts":"2025-11-28T23:31:03.483Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"eecd76eb-3fd1-49ff-935b-2181aa3eb97b","stage":"payment","correlationId":"payment-updated:e1dfacd43b4330d4de4765be"}
{"ts":"2025-11-28T23:36:02.778Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"22601cad-278a-4a62-aefd-da8cac25edb0","stage":"payment","correlationId":"payment-updated:fd1b6620e3fcab4ef487d3c2","attempts":1}
üí∞ Processing payment completion for customer: ZRCDXYKX325WFF247E2DMQ48T0
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Maral Amir
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Maral Amir, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Maral Amir
   - Email: maral.amiir@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: ZRCDXYKX325WFF247E2DMQ48T0
{"ts":"2025-11-28T23:36:03.307Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"22601cad-278a-4a62-aefd-da8cac25edb0","stage":"payment","correlationId":"payment-updated:fd1b6620e3fcab4ef487d3c2"}
{"ts":"2025-11-28T23:36:09.849Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"99b14216-770f-49c6-b0d0-06e01c188678","stage":"payment","correlationId":"payment-updated:65a04fcb1745bfcf18d3ee22","attempts":1}
üí∞ Processing payment completion for customer: ZRCDXYKX325WFF247E2DMQ48T0
   Payment source_type: CARD
   Payment tender_types: []
Customer ZRCDXYKX325WFF247E2DMQ48T0 already completed first payment
{"ts":"2025-11-28T23:36:09.997Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"99b14216-770f-49c6-b0d0-06e01c188678","stage":"payment","correlationId":"payment-updated:65a04fcb1745bfcf18d3ee22"}
{"ts":"2025-11-28T23:55:03.882Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"cdc18d2d-878b-4eed-a0d7-6bbb71a06780","stage":"payment","correlationId":"payment-updated:755f069748b36c6ef12f82ff","attempts":1}
üí∞ Processing payment completion for customer: 0YEN2CXEE575X51F6TE1REYQG4
   Payment source_type: CARD
   Payment tender_types: []
Customer 0YEN2CXEE575X51F6TE1REYQG4 already completed first payment
{"ts":"2025-11-28T23:55:04.269Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"cdc18d2d-878b-4eed-a0d7-6bbb71a06780","stage":"payment","correlationId":"payment-updated:755f069748b36c6ef12f82ff"}
{"ts":"2025-11-28T23:55:06.589Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"992871c5-d32b-4938-b00c-4dd2549c9c18","stage":"payment","correlationId":"payment-updated:a76c909efde882cec9c4a49a","attempts":1}
üí∞ Processing payment completion for customer: 0YEN2CXEE575X51F6TE1REYQG4
   Payment source_type: CARD
   Payment tender_types: []
Customer 0YEN2CXEE575X51F6TE1REYQG4 already completed first payment
{"ts":"2025-11-28T23:55:06.729Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"992871c5-d32b-4938-b00c-4dd2549c9c18","stage":"payment","correlationId":"payment-updated:a76c909efde882cec9c4a49a"}
{"ts":"2025-11-28T23:55:28.247Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"44b392e0-1f83-4bf1-bfde-b1edcd93ca63","stage":"payment","correlationId":"payment-updated:1a26a50636e9e01535b34e75","attempts":1}
üí∞ Processing payment completion for customer: 0YEN2CXEE575X51F6TE1REYQG4
   Payment source_type: CARD
   Payment tender_types: []
Customer 0YEN2CXEE575X51F6TE1REYQG4 already completed first payment
{"ts":"2025-11-28T23:55:28.504Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"44b392e0-1f83-4bf1-bfde-b1edcd93ca63","stage":"payment","correlationId":"payment-updated:1a26a50636e9e01535b34e75"}
{"ts":"2025-11-28T23:55:32.941Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"fb26e5d7-00be-4773-a6bc-5913eb0b2f1c","stage":"payment","correlationId":"payment-updated:6747d49ecbab54776e8abfb4","attempts":1}
üí∞ Processing payment completion for customer: 0YEN2CXEE575X51F6TE1REYQG4
   Payment source_type: CARD
   Payment tender_types: []
Customer 0YEN2CXEE575X51F6TE1REYQG4 already completed first payment
{"ts":"2025-11-28T23:55:33.077Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"fb26e5d7-00be-4773-a6bc-5913eb0b2f1c","stage":"payment","correlationId":"payment-updated:6747d49ecbab54776e8abfb4"}
{"ts":"2025-11-28T23:59:09.873Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"650b1442-3395-48b3-8ec4-ee587aede9bd","stage":"payment","correlationId":"payment-updated:5affd635c10d5a47794d101b","attempts":1}
üí∞ Processing payment completion for customer: 7HPY37YYPCWZBB15S28S35D914
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Kiana Afshar
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Kiana Afshar, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Kiana Afshar
   - Email: kianaafshar27@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: 7HPY37YYPCWZBB15S28S35D914
{"ts":"2025-11-28T23:59:10.411Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"650b1442-3395-48b3-8ec4-ee587aede9bd","stage":"payment","correlationId":"payment-updated:5affd635c10d5a47794d101b"}
{"ts":"2025-11-28T23:59:16.954Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"8825404e-41f4-413c-bad5-3dc0818c5a39","stage":"payment","correlationId":"payment-updated:4ba7b7d79608cdf5ff28e2d7","attempts":1}
üí∞ Processing payment completion for customer: 7HPY37YYPCWZBB15S28S35D914
   Payment source_type: CARD
   Payment tender_types: []
Customer 7HPY37YYPCWZBB15S28S35D914 already completed first payment
{"ts":"2025-11-28T23:59:17.093Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"8825404e-41f4-413c-bad5-3dc0818c5a39","stage":"payment","correlationId":"payment-updated:4ba7b7d79608cdf5ff28e2d7"}
{"ts":"2025-11-29T00:21:28.429Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"c9d0abe3-c883-46ab-ab92-e10b3e92fd09","stage":"payment","correlationId":"payment-updated:8c1da7b5460224cd263a506d","attempts":1}
üí∞ Processing payment completion for customer: 96FWAQ72E0EMCPMRAF25FBHX78
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: LouAnn Micucci
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to LouAnn Micucci, skipping...
‚úÖ Referral code sent to new client:
   - Customer: LouAnn Micucci
   - Email: louann@micucci.org
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: 96FWAQ72E0EMCPMRAF25FBHX78
{"ts":"2025-11-29T00:21:29.059Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"c9d0abe3-c883-46ab-ab92-e10b3e92fd09","stage":"payment","correlationId":"payment-updated:8c1da7b5460224cd263a506d"}
{"ts":"2025-11-29T00:21:33.470Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"a01358cd-9508-4ccf-ae2e-36cbc8a9e2b7","stage":"payment","correlationId":"payment-updated:3e57276f04e6560521fc48df","attempts":1}
üí∞ Processing payment completion for customer: 96FWAQ72E0EMCPMRAF25FBHX78
   Payment source_type: CARD
   Payment tender_types: []
Customer 96FWAQ72E0EMCPMRAF25FBHX78 already completed first payment
{"ts":"2025-11-29T00:21:33.604Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"a01358cd-9508-4ccf-ae2e-36cbc8a9e2b7","stage":"payment","correlationId":"payment-updated:3e57276f04e6560521fc48df"}
{"ts":"2025-11-29T00:33:00.990Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"bbe22d9c-4374-4f71-9c19-80bdb18038a2","stage":"payment","correlationId":"payment-updated:6a6dfa81fff3b6b302e400eb","attempts":1}
üí∞ Processing payment completion for customer: GN4MCT7J7ZW2RFPF6NZYEE0AEC
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Ali Andersen
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Ali Andersen, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Ali Andersen
   - Email: Alexandra.c.andersen@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: GN4MCT7J7ZW2RFPF6NZYEE0AEC
{"ts":"2025-11-29T00:33:01.524Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"bbe22d9c-4374-4f71-9c19-80bdb18038a2","stage":"payment","correlationId":"payment-updated:6a6dfa81fff3b6b302e400eb"}
{"ts":"2025-11-29T00:33:05.984Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"ad3cd195-c471-48be-b3b0-c979ad96bc6c","stage":"payment","correlationId":"payment-updated:db7db9d0ef138b2b25e0a54b","attempts":1}
üí∞ Processing payment completion for customer: GN4MCT7J7ZW2RFPF6NZYEE0AEC
   Payment source_type: CARD
   Payment tender_types: []
Customer GN4MCT7J7ZW2RFPF6NZYEE0AEC already completed first payment
{"ts":"2025-11-29T00:33:06.125Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"ad3cd195-c471-48be-b3b0-c979ad96bc6c","stage":"payment","correlationId":"payment-updated:db7db9d0ef138b2b25e0a54b"}
{"ts":"2025-11-29T00:39:33.619Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"0c7f2e35-4635-4724-bed4-bb2c853f43c1","stage":"booking","correlationId":"booking-created:01079532eb32ae064eaad2ce","attempts":1}
üìÖ Processing booking created for customer: GN4MCT7J7ZW2RFPF6NZYEE0AEC
Full booking data: {
  "id": "atueihbz2uj2cx",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-22T23:00:00Z",
  "created_at": "2025-11-29T00:39:30Z",
  "updated_at": "2025-11-29T00:39:30Z",
  "customer_id": "GN4MCT7J7ZW2RFPF6NZYEE0AEC",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "GN4MCT7J7ZW2RFPF6NZYEE0AEC",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMNW4SIF7tjp4oM_",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "BRSIGZFOWC6F4ERPKX3CODLU",
      "service_variation_version": 1764191999049,
      "service_variation_client_id": "BRSIGZFOWC6F4ERPKX3CODLU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Ali Andersen
üéâ First booking detected for customer: GN4MCT7J7ZW2RFPF6NZYEE0AEC
   Name: Ali Andersen
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer GN4MCT7J7ZW2RFPF6NZYEE0AEC...
Error getting custom attributes for customer GN4MCT7J7ZW2RFPF6NZYEE0AEC: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: GN4MCT7J7ZW2RFPF6NZYEE0AEC
{"ts":"2025-11-29T00:39:34.226Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"0c7f2e35-4635-4724-bed4-bb2c853f43c1","stage":"booking","correlationId":"booking-created:01079532eb32ae064eaad2ce"}
{"ts":"2025-11-29T00:44:31.782Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"cd365865-b9ad-44e5-ae4b-a9e7ef2e36fb","stage":"booking","correlationId":"booking-created:d22ae231605d284b7daabba0","attempts":1}
üìÖ Processing booking created for customer: GN2VNDAW4AWKRKAARXHXBM0Z4C
Full booking data: {
  "id": "r8n6xfhguallro",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-02T21:00:00Z",
  "created_at": "2025-11-29T00:44:29Z",
  "updated_at": "2025-11-29T00:44:29Z",
  "customer_id": "GN2VNDAW4AWKRKAARXHXBM0Z4C",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMQPbDVvvOCLwqsy"
  },
  "appointment_segments": [
    {
      "team_member_id": "TM9jDlRr_Hl4rdBB",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "XBUDIMNKOPC2XVG5YLIQ4RYS",
      "service_variation_version": 1764191999049,
      "service_variation_client_id": "XBUDIMNKOPC2XVG5YLIQ4RYS"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Shefali Razdan
üéâ First booking detected for customer: GN2VNDAW4AWKRKAARXHXBM0Z4C
   Name: Shefali Razdan
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer GN2VNDAW4AWKRKAARXHXBM0Z4C...
Error getting custom attributes for customer GN2VNDAW4AWKRKAARXHXBM0Z4C: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: GN2VNDAW4AWKRKAARXHXBM0Z4C
{"ts":"2025-11-29T00:44:32.415Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"cd365865-b9ad-44e5-ae4b-a9e7ef2e36fb","stage":"booking","correlationId":"booking-created:d22ae231605d284b7daabba0"}
{"ts":"2025-11-29T00:54:07.528Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"87f2a34a-8613-4476-afa0-2ca3007ee4bd","stage":"payment","correlationId":"payment-updated:7e5d207abfa75c19fa3e6d6a","attempts":1}
üí∞ Processing payment completion for customer: BYH6XBPGXBDJ6JS7P4GNBJS7M0
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Krista Letz
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Krista Letz, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Krista Letz
   - Email: kristaletz@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: BYH6XBPGXBDJ6JS7P4GNBJS7M0
{"ts":"2025-11-29T00:54:08.087Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"87f2a34a-8613-4476-afa0-2ca3007ee4bd","stage":"payment","correlationId":"payment-updated:7e5d207abfa75c19fa3e6d6a"}
{"ts":"2025-11-29T00:54:12.513Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"9b84f7f8-c42b-4ed2-851c-a6a2fc580508","stage":"payment","correlationId":"payment-updated:c789863b11940d49692ce122","attempts":1}
üí∞ Processing payment completion for customer: BYH6XBPGXBDJ6JS7P4GNBJS7M0
   Payment source_type: CARD
   Payment tender_types: []
Customer BYH6XBPGXBDJ6JS7P4GNBJS7M0 already completed first payment
{"ts":"2025-11-29T00:54:12.658Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"9b84f7f8-c42b-4ed2-851c-a6a2fc580508","stage":"payment","correlationId":"payment-updated:c789863b11940d49692ce122"}
{"ts":"2025-11-29T01:23:42.709Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"c03ff080-329e-4323-ba81-02d47af34086","stage":"payment","correlationId":"payment-updated:05cc593ba97d59ce94f2b365","attempts":1}
üí∞ Processing payment completion for customer: Q66R9ZR8SRJ8YV7DTY9J52CMEC
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Rosanna Mucetti
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Rosanna Mucetti, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Rosanna Mucetti
   - Email: mucetti1@comcast.net
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: Q66R9ZR8SRJ8YV7DTY9J52CMEC
{"ts":"2025-11-29T01:23:43.286Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"c03ff080-329e-4323-ba81-02d47af34086","stage":"payment","correlationId":"payment-updated:05cc593ba97d59ce94f2b365"}
{"ts":"2025-11-29T01:23:47.723Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"4b32a0d2-dc0a-4c96-b5da-b7ec35261383","stage":"payment","correlationId":"payment-updated:b23b7f22e510e31bbb513e0e","attempts":1}
üí∞ Processing payment completion for customer: Q66R9ZR8SRJ8YV7DTY9J52CMEC
   Payment source_type: CARD
   Payment tender_types: []
Customer Q66R9ZR8SRJ8YV7DTY9J52CMEC already completed first payment
{"ts":"2025-11-29T01:23:47.858Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"4b32a0d2-dc0a-4c96-b5da-b7ec35261383","stage":"payment","correlationId":"payment-updated:b23b7f22e510e31bbb513e0e"}
{"ts":"2025-11-29T01:24:17.929Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"da66e96e-5b07-416e-bf89-a6a02224faf2","stage":"payment","correlationId":"payment-updated:fad3e719ef8a036e49ba846e","attempts":1}
üí∞ Processing payment completion for customer: Q66R9ZR8SRJ8YV7DTY9J52CMEC
   Payment source_type: CARD
   Payment tender_types: []
Customer Q66R9ZR8SRJ8YV7DTY9J52CMEC already completed first payment
{"ts":"2025-11-29T01:24:18.179Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"da66e96e-5b07-416e-bf89-a6a02224faf2","stage":"payment","correlationId":"payment-updated:fad3e719ef8a036e49ba846e"}
{"ts":"2025-11-29T01:24:22.617Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"e9c8d008-f9a8-49e1-9926-65bf92e2e740","stage":"payment","correlationId":"payment-updated:0f01d4a69b5a8e51a6a2a518","attempts":1}
üí∞ Processing payment completion for customer: Q66R9ZR8SRJ8YV7DTY9J52CMEC
   Payment source_type: CARD
   Payment tender_types: []
Customer Q66R9ZR8SRJ8YV7DTY9J52CMEC already completed first payment
{"ts":"2025-11-29T01:24:22.752Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"e9c8d008-f9a8-49e1-9926-65bf92e2e740","stage":"payment","correlationId":"payment-updated:0f01d4a69b5a8e51a6a2a518"}
{"ts":"2025-11-29T01:26:50.246Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"4945d9ca-defb-4cba-a2e2-bdaef5d5169b","stage":"payment","correlationId":"payment-updated:ed66987d53810f9495c7c384","attempts":1}
üí∞ Processing payment completion for customer: 7HMK01BQANF87QJZSGDBKSV0Q0
   Payment source_type: CASH
   Payment tender_types: []
Customer 7HMK01BQANF87QJZSGDBKSV0Q0 already completed first payment
{"ts":"2025-11-29T01:26:50.584Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"4945d9ca-defb-4cba-a2e2-bdaef5d5169b","stage":"payment","correlationId":"payment-updated:ed66987d53810f9495c7c384"}
{"ts":"2025-11-29T01:41:48.795Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"557363c0-8aaa-4492-ac82-f989e9a87468","stage":"payment","correlationId":"payment-updated:9cb0194cbf3900ecb82e455d","attempts":1}
üí∞ Processing payment completion for customer: ZMWFF70XE65P73J4ZHKW6862K4
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Lizz Niemeyer
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Lizz Niemeyer, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Lizz Niemeyer
   - Email: Lizzniemeyer@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: ZMWFF70XE65P73J4ZHKW6862K4
{"ts":"2025-11-29T01:41:49.415Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"557363c0-8aaa-4492-ac82-f989e9a87468","stage":"payment","correlationId":"payment-updated:9cb0194cbf3900ecb82e455d"}
{"ts":"2025-11-29T01:41:55.963Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"7e77c8e5-aa13-4f50-9e39-9f636c1f6475","stage":"payment","correlationId":"payment-updated:d9c0fb1155b94c7946aa0af5","attempts":1}
üí∞ Processing payment completion for customer: ZMWFF70XE65P73J4ZHKW6862K4
   Payment source_type: CARD
   Payment tender_types: []
Customer ZMWFF70XE65P73J4ZHKW6862K4 already completed first payment
{"ts":"2025-11-29T01:41:56.098Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"7e77c8e5-aa13-4f50-9e39-9f636c1f6475","stage":"payment","correlationId":"payment-updated:d9c0fb1155b94c7946aa0af5"}
{"ts":"2025-11-29T02:46:40.564Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"2056e3a3-97ee-4cc9-9c9f-9b0b29992998","stage":"booking","correlationId":"booking-created:fd202c74b98482bab30a59c5","attempts":1}
üìÖ Processing booking created for customer: 4WB9Q19C8VYKFXRK7G9VVXB10C
Full booking data: {
  "id": "qd4v5oaz5o8v8g",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-11-29T22:40:00Z",
  "created_at": "2025-11-29T02:46:37Z",
  "updated_at": "2025-11-29T02:46:37Z",
  "customer_id": "4WB9Q19C8VYKFXRK7G9VVXB10C",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "4WB9Q19C8VYKFXRK7G9VVXB10C",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMOscywuGXO2VURY",
      "any_team_member": false,
      "duration_minutes": 140,
      "intermission_minutes": 0,
      "service_variation_id": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "CJI5WHOAKSFTASYPJ4MSYZLS"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 0 customer(s) in database
‚ÑπÔ∏è Customer 4WB9Q19C8VYKFXRK7G9VVXB10C not in database yet - need to add them first
‚ùå Error fetching/adding customer from Square: Response status code was not ok: 401.
{"ts":"2025-11-29T02:46:41.142Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"2056e3a3-97ee-4cc9-9c9f-9b0b29992998","stage":"booking","correlationId":"booking-created:fd202c74b98482bab30a59c5"}
{"ts":"2025-11-29T02:46:41.297Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"da2b9649-361c-4c40-a5a1-18f153a86028","stage":"customer_ingest","correlationId":"customer-created:e2438e8c048fe6d678517064","attempts":1}
üì• Received customer data: {
  "id": "4WB9Q19C8VYKFXRK7G9VVXB10C",
  "address": {
    "country": "US"
  },
  "version": 0,
  "group_ids": [
    "LT4ZHFBQQYB2N.APPOINTMENTS"
  ],
  "created_at": "2025-11-29T02:46:35.195Z",
  "given_name": "Sarah",
  "updated_at": "2025-11-29T02:46:35Z",
  "family_name": "Bright",
  "preferences": {
    "email_unsubscribed": false
  },
  "phone_number": "+17153708356",
  "email_address": "sabright97@gmail.com",
  "creation_source": "APPOINTMENTS"
}
üë§ Processing customer creation: 4WB9Q19C8VYKFXRK7G9VVXB10C
üìç IP Address: unknown
üìß Email: sabright97@gmail.com
üìû Phone: +17153708356
üë§ Name: Sarah Bright
‚ö†Ô∏è Suspicious IP activity detected: unknown used by 102 customers
‚ö†Ô∏è Suspicious activity detected for customer 4WB9Q19C8VYKFXRK7G9VVXB10C, flagging for review
üéâ New customer detected: 4WB9Q19C8VYKFXRK7G9VVXB10C
‚úÖ Customer added to database as NEW (temporary mark)
   - Will check for referral code when they book
   - Will give gift card on first booking if code found
‚úÖ Verification: Customer found in DB: true
{"ts":"2025-11-29T02:46:41.590Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"da2b9649-361c-4c40-a5a1-18f153a86028","stage":"customer_ingest","correlationId":"customer-created:e2438e8c048fe6d678517064"}
{"ts":"2025-11-29T02:52:53.344Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"c94fb754-4cab-4df4-b2b6-4d527da317f7","stage":"booking","correlationId":"booking-created:e91923bc4d12b6ac324c4fe1","attempts":1}
üìÖ Processing booking created for customer: D64SF6SGTAZKDT2CWC9BCQ5RD8
Full booking data: {
  "id": "w04thqtgdfxg6r",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-04T00:00:00Z",
  "created_at": "2025-11-29T02:52:50Z",
  "updated_at": "2025-11-29T02:52:50Z",
  "customer_id": "D64SF6SGTAZKDT2CWC9BCQ5RD8",
  "location_id": "LNQKVBTQZN3EZ",
  "customer_note": "Will add friend referral soon",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "D64SF6SGTAZKDT2CWC9BCQ5RD8",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMSt73bSp59caRzt",
      "any_team_member": true,
      "duration_minutes": 140,
      "intermission_minutes": 0,
      "service_variation_id": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "CJI5WHOAKSFTASYPJ4MSYZLS"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Paulina Kaminski
üéâ First booking detected for customer: D64SF6SGTAZKDT2CWC9BCQ5RD8
   Name: Paulina Kaminski
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer D64SF6SGTAZKDT2CWC9BCQ5RD8...
Error getting custom attributes for customer D64SF6SGTAZKDT2CWC9BCQ5RD8: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: D64SF6SGTAZKDT2CWC9BCQ5RD8
{"ts":"2025-11-29T02:52:53.952Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"c94fb754-4cab-4df4-b2b6-4d527da317f7","stage":"booking","correlationId":"booking-created:e91923bc4d12b6ac324c4fe1"}
{"ts":"2025-11-29T03:16:15.364Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"170ba291-3ee3-4941-a2d3-fdf5d91605f3","stage":"payment","correlationId":"payment-updated:85e23bf5d48af9ae87ed32e7","attempts":1}
üí∞ Processing payment completion for customer: GAQYPGFH1S596HTSQQQKKZDKV0
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Campbell Wilson
‚ùå Referrer not found for code: null
‚úÖ Generated new personal_code in name+ID format: CAMPBELL5960
‚ùå Error creating/loading gift card for Campbell Wilson: Response status code was not ok: 401.
Square API errors: [
  {
    "category": "AUTHENTICATION_ERROR",
    "code": "UNAUTHORIZED",
    "detail": "This request could not be authorized."
  }
]
‚ùå Failed to create referrer gift card
Error upserting custom attribute "square:a3dde506-f69e-48e4-a98a-004c1822d3ad" for customer GAQYPGFH1S596HTSQQQKKZDKV0: Response status code was not ok: 401.
Square API errors: [
  {
    "category": "AUTHENTICATION_ERROR",
    "code": "UNAUTHORIZED",
    "detail": "This request could not be authorized."
  }
]
Error appending referral note for customer GAQYPGFH1S596HTSQQQKKZDKV0: Response status code was not ok: 401.
Square API errors: [
  {
    "category": "AUTHENTICATION_ERROR",
    "code": "UNAUTHORIZED",
    "detail": "This request could not be authorized."
  }
]
‚ùå Error sending referral email to Campbellwilson1@gmail.com: Unauthorized
SendGrid error details: {
  errors: [
    {
      message: 'The provided authorization grant is invalid, expired, or revoked',
      field: null,
      help: null
    }
  ]
}
‚ö†Ô∏è Analytics operation "notification_event" failed: 
Invalid `prisma.notificationEvent.create()` invocation in
/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/analytics-service.js:164:39

  161 return runAnalyticsOperation(
  162   'notification_event',
  163   async () => {
‚Üí 164     return prisma.notificationEvent.create({
            data: {
              channel: "EMAIL",
              templateType: "REFERRAL_INVITE",
              status: "failed",
              createdAt: new Date("2025-11-29T03:16:16.900Z"),
              errorCode: 401,
                         ~~~
              errorMessage: "Unauthorized",
              metadata: {
                email: "Campbellwilson1@gmail.com",
                referralCode: "CAMPBELL5960",
                referralUrl: "https://referral-system-salon-fbbq6x1wt-umis-projects-e802f152.vercel.app/ref/CAMPBELL5960",
                suppressionGroupId: 28008
              }
            }
          })

Argument `errorCode`: Invalid value provided. Expected String or Null, provided Int.
‚ùå Failed to send email: Unauthorized
‚ÑπÔ∏è SMS sending disabled. Would send referral link to +17036789501
‚è∏Ô∏è SMS sending disabled (skipped sending to +17036789501)
üìß Referral code generated and sent:
   - Customer: Campbell Wilson
   - Email: Campbellwilson1@gmail.com
   - Referral Code: CAMPBELL5960
   - Referral URL: https://referral-system-salon-fbbq6x1wt-umis-projects-e802f152.vercel.app/ref/CAMPBELL5960
   - Gift Card ID: null
   - Status: Customer is now a referrer
‚úÖ Referral code sent to new client:
   - Customer: Campbell Wilson
   - Email: Campbellwilson1@gmail.com
   - Referral Code: CAMPBELL5960
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: GAQYPGFH1S596HTSQQQKKZDKV0
{"ts":"2025-11-29T03:16:17.186Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"170ba291-3ee3-4941-a2d3-fdf5d91605f3","stage":"payment","correlationId":"payment-updated:85e23bf5d48af9ae87ed32e7"}
{"ts":"2025-11-29T03:16:19.476Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"10186dd3-3300-44cd-bbf5-a737945f3a0b","stage":"payment","correlationId":"payment-updated:081ba20b34c881f408636534","attempts":1}
üí∞ Processing payment completion for customer: GAQYPGFH1S596HTSQQQKKZDKV0
   Payment source_type: CARD
   Payment tender_types: []
Customer GAQYPGFH1S596HTSQQQKKZDKV0 already completed first payment
{"ts":"2025-11-29T03:16:19.611Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"10186dd3-3300-44cd-bbf5-a737945f3a0b","stage":"payment","correlationId":"payment-updated:081ba20b34c881f408636534"}
{"ts":"2025-11-29T03:19:49.638Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"f2bb270d-e190-43b7-be1d-fef3ae679438","stage":"booking","correlationId":"booking-created:9a1ea8d82e5fda5340692be5","attempts":1}
üìÖ Processing booking created for customer: BN9RP7K5AP1EXGQE3BVHSZ05BR
Full booking data: {
  "id": "t4mggky4yd0gmz",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-13T21:15:00Z",
  "created_at": "2025-11-29T03:19:46Z",
  "updated_at": "2025-11-29T03:19:46Z",
  "customer_id": "BN9RP7K5AP1EXGQE3BVHSZ05BR",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "BN9RP7K5AP1EXGQE3BVHSZ05BR",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMVwAQUdLz6no-cB",
      "any_team_member": false,
      "duration_minutes": 45,
      "intermission_minutes": 0,
      "service_variation_id": "VVA7G2UN7N2HUFMCW5LQOVHB",
      "service_variation_version": 1763579781183,
      "service_variation_client_id": "VVA7G2UN7N2HUFMCW5LQOVHB"
    },
    {
      "resource_ids": [
        "5OVIQ6GSSUXORACP6T7WBAQ7"
      ],
      "team_member_id": "TMVwAQUdLz6no-cB",
      "any_team_member": false,
      "duration_minutes": 60,
      "intermission_minutes": 0,
      "service_variation_id": "SBE5XUATXRM76CBTT25HL2NZ",
      "service_variation_version": 1760895536505,
      "service_variation_client_id": "SBE5XUATXRM76CBTT25HL2NZ"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Liza Evans
üéâ First booking detected for customer: BN9RP7K5AP1EXGQE3BVHSZ05BR
   Name: Liza Evans
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer BN9RP7K5AP1EXGQE3BVHSZ05BR...
Error getting custom attributes for customer BN9RP7K5AP1EXGQE3BVHSZ05BR: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: BN9RP7K5AP1EXGQE3BVHSZ05BR
{"ts":"2025-11-29T03:19:50.225Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"f2bb270d-e190-43b7-be1d-fef3ae679438","stage":"booking","correlationId":"booking-created:9a1ea8d82e5fda5340692be5"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-11-29T03:38:26.191Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"e7a04640-a1a9-46ef-bddd-65cadf3be3fb","stage":"payment","correlationId":"payment-updated:158999fb539f855efa27720b","attempts":1}
üí∞ Processing payment completion for customer: JSA4QDQQ86HNQFNMB3J7ECPB9G
   Payment source_type: CARD
   Payment tender_types: []
Customer JSA4QDQQ86HNQFNMB3J7ECPB9G already completed first payment
{"ts":"2025-11-29T03:38:26.669Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"e7a04640-a1a9-46ef-bddd-65cadf3be3fb","stage":"payment","correlationId":"payment-updated:158999fb539f855efa27720b"}
{"ts":"2025-11-29T03:38:26.827Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"a090fd81-fa4e-4522-a946-3b1d8ee5b9f4","stage":"payment","correlationId":"payment-updated:8d200a08ed1a867ad2d56823","attempts":1}
üí∞ Processing payment completion for customer: JSA4QDQQ86HNQFNMB3J7ECPB9G
   Payment source_type: CARD
   Payment tender_types: []
Customer JSA4QDQQ86HNQFNMB3J7ECPB9G already completed first payment
{"ts":"2025-11-29T03:38:26.971Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"a090fd81-fa4e-4522-a946-3b1d8ee5b9f4","stage":"payment","correlationId":"payment-updated:8d200a08ed1a867ad2d56823"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-11-29T04:10:17.452Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"5ae7cca0-635f-49a3-9722-e7b8f9f03a42","stage":"payment","correlationId":"payment-updated:6ca20b92e4be1779a8f039ba","attempts":1}
üí∞ Processing payment completion for customer: X9Y48GBW0BMHSGJPSV6XVFTTWW
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Rana Kashfi
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Rana Kashfi, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Rana Kashfi
   - Email: rananuss@yahoo.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: X9Y48GBW0BMHSGJPSV6XVFTTWW
{"ts":"2025-11-29T04:10:18.038Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"5ae7cca0-635f-49a3-9722-e7b8f9f03a42","stage":"payment","correlationId":"payment-updated:6ca20b92e4be1779a8f039ba"}
{"ts":"2025-11-29T04:10:18.197Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"97aa0fbf-5dcf-48b4-b72e-0e243ce905f8","stage":"payment","correlationId":"payment-updated:b8c05960ecb0e859fe7c5dac","attempts":1}
üí∞ Processing payment completion for customer: X9Y48GBW0BMHSGJPSV6XVFTTWW
   Payment source_type: CARD
   Payment tender_types: []
Customer X9Y48GBW0BMHSGJPSV6XVFTTWW already completed first payment
{"ts":"2025-11-29T04:10:18.330Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"97aa0fbf-5dcf-48b4-b72e-0e243ce905f8","stage":"payment","correlationId":"payment-updated:b8c05960ecb0e859fe7c5dac"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-11-29T04:28:06.271Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"a13d5be9-96fd-43f5-a8ad-efa5dbe3dfa2","stage":"booking","correlationId":"booking-created:5264e006a77b96b139df1b7e","attempts":1}
üìÖ Processing booking created for customer: 3J2GT9G70SC5TNK1E0RX03TEY8
Full booking data: {
  "id": "vuezrez0fcjcpi",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-28T22:00:00Z",
  "created_at": "2025-11-29T04:14:03Z",
  "updated_at": "2025-11-29T04:14:03Z",
  "customer_id": "3J2GT9G70SC5TNK1E0RX03TEY8",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "3J2GT9G70SC5TNK1E0RX03TEY8",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMMHlgFBIFbMTRap",
      "any_team_member": false,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Bella Giusti
üéâ First booking detected for customer: 3J2GT9G70SC5TNK1E0RX03TEY8
   Name: Bella Giusti
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 3J2GT9G70SC5TNK1E0RX03TEY8...
Error getting custom attributes for customer 3J2GT9G70SC5TNK1E0RX03TEY8: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 3J2GT9G70SC5TNK1E0RX03TEY8
{"ts":"2025-11-29T04:28:06.906Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"a13d5be9-96fd-43f5-a8ad-efa5dbe3dfa2","stage":"booking","correlationId":"booking-created:5264e006a77b96b139df1b7e"}
{"ts":"2025-11-29T04:28:07.071Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"685b4fb9-fc26-47ec-a09f-f34787ab1ab1","stage":"booking","correlationId":"booking-created:b7ddf51211e3dc4c5f286b67","attempts":1}
üìÖ Processing booking created for customer: 80JA32DGXHAP7W0H4464026CA0
Full booking data: {
  "id": "bon9ru26hlzobc",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-15T21:20:00Z",
  "created_at": "2025-11-29T04:14:57Z",
  "updated_at": "2025-11-29T04:14:57Z",
  "customer_id": "80JA32DGXHAP7W0H4464026CA0",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "80JA32DGXHAP7W0H4464026CA0",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMgsjtuk5cfKnstq",
      "any_team_member": false,
      "duration_minutes": 110,
      "intermission_minutes": 0,
      "service_variation_id": "6TYOE67IDYTKHW2ZG6HKVZER",
      "service_variation_version": 1764191999049,
      "service_variation_client_id": "6TYOE67IDYTKHW2ZG6HKVZER"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Gigi Cheng
üéâ First booking detected for customer: 80JA32DGXHAP7W0H4464026CA0
   Name: Gigi Cheng
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 80JA32DGXHAP7W0H4464026CA0...
Error getting custom attributes for customer 80JA32DGXHAP7W0H4464026CA0: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 80JA32DGXHAP7W0H4464026CA0
{"ts":"2025-11-29T04:28:07.393Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"685b4fb9-fc26-47ec-a09f-f34787ab1ab1","stage":"booking","correlationId":"booking-created:b7ddf51211e3dc4c5f286b67"}
{"ts":"2025-11-29T04:28:07.556Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"26e23b08-c89d-4bc6-b8e0-08a7fee5c878","stage":"booking","correlationId":"booking-created:73f9f6a5019cab2c944e2629","attempts":1}
üìÖ Processing booking created for customer: 80JA32DGXHAP7W0H4464026CA0
Full booking data: {
  "id": "djcw2rz4bq22sa",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-17T17:00:00Z",
  "created_at": "2025-11-29T04:16:48Z",
  "updated_at": "2025-11-29T04:16:48Z",
  "customer_id": "80JA32DGXHAP7W0H4464026CA0",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "80JA32DGXHAP7W0H4464026CA0",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "resource_ids": [
        "5OVIQ6GSSUXORACP6T7WBAQ7"
      ],
      "team_member_id": "TMVwAQUdLz6no-cB",
      "any_team_member": true,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "ZEAKNB35I37RMXNUBGWDZQIM",
      "service_variation_version": 1760895536505,
      "service_variation_client_id": "ZEAKNB35I37RMXNUBGWDZQIM"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Gigi Cheng
üéâ First booking detected for customer: 80JA32DGXHAP7W0H4464026CA0
   Name: Gigi Cheng
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 80JA32DGXHAP7W0H4464026CA0...
Error getting custom attributes for customer 80JA32DGXHAP7W0H4464026CA0: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 80JA32DGXHAP7W0H4464026CA0
{"ts":"2025-11-29T04:28:07.871Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"26e23b08-c89d-4bc6-b8e0-08a7fee5c878","stage":"booking","correlationId":"booking-created:73f9f6a5019cab2c944e2629"}
{"ts":"2025-11-29T04:28:08.034Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"97f66e5e-5954-472d-9bad-f9d0be5ba30c","stage":"booking","correlationId":"booking-created:ee0206eed0c6fe5d74e92ca9","attempts":1}
üìÖ Processing booking created for customer: MD7G9GAYVE4B8FZEJ3NNNAH4XR
Full booking data: {
  "id": "kaztaww268peuv",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-03T00:00:00Z",
  "created_at": "2025-11-29T04:22:25Z",
  "updated_at": "2025-11-29T04:22:25Z",
  "customer_id": "MD7G9GAYVE4B8FZEJ3NNNAH4XR",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "MD7G9GAYVE4B8FZEJ3NNNAH4XR",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMMBgVwykMnOlumA",
      "any_team_member": true,
      "duration_minutes": 140,
      "intermission_minutes": 0,
      "service_variation_id": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "CJI5WHOAKSFTASYPJ4MSYZLS"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Alana Joyce
üéâ First booking detected for customer: MD7G9GAYVE4B8FZEJ3NNNAH4XR
   Name: Alana Joyce
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer MD7G9GAYVE4B8FZEJ3NNNAH4XR...
Error getting custom attributes for customer MD7G9GAYVE4B8FZEJ3NNNAH4XR: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: MD7G9GAYVE4B8FZEJ3NNNAH4XR
{"ts":"2025-11-29T04:28:08.375Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"97f66e5e-5954-472d-9bad-f9d0be5ba30c","stage":"booking","correlationId":"booking-created:ee0206eed0c6fe5d74e92ca9"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-11-29T05:02:16.296Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Server has closed the connection.","stack":"PrismaClientKnownRequestError: Server has closed the connection.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-11-29T05:02:19.397Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"4b598b11-e3f1-484a-b53a-1fa294e31fee","stage":"booking","correlationId":"booking-created:ebd95e9ad46aac709282a7e1","attempts":1}
üìÖ Processing booking created for customer: YXH24K97E4WPHZMN0B7BF8FS20
Full booking data: {
  "id": "kxspz51p8wtwda",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-09T00:30:00Z",
  "created_at": "2025-11-29T04:50:05Z",
  "updated_at": "2025-11-29T04:50:05Z",
  "customer_id": "YXH24K97E4WPHZMN0B7BF8FS20",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "YXH24K97E4WPHZMN0B7BF8FS20",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMyUMvTJIj2HrHSg",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "JMTK5M2CY2W7WEXSTAJKAJ35",
      "service_variation_version": 1764191999049,
      "service_variation_client_id": "JMTK5M2CY2W7WEXSTAJKAJ35"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Emma Fladeboe
üéâ First booking detected for customer: YXH24K97E4WPHZMN0B7BF8FS20
   Name: Emma Fladeboe
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer YXH24K97E4WPHZMN0B7BF8FS20...
Error getting custom attributes for customer YXH24K97E4WPHZMN0B7BF8FS20: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: YXH24K97E4WPHZMN0B7BF8FS20
{"ts":"2025-11-29T05:02:20.023Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"4b598b11-e3f1-484a-b53a-1fa294e31fee","stage":"booking","correlationId":"booking-created:ebd95e9ad46aac709282a7e1"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-11-29T05:20:05.359Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"2e47e568-2f35-4c20-98e8-148fbedefa2f","stage":"booking","correlationId":"booking-created:fad01e365870e69c497fe68c","attempts":1}
üìÖ Processing booking created for customer: E3PVSTRKJ0V4SR6WSR2AGR8W80
Full booking data: {
  "id": "n4ub0gwo3v6w80",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-13T18:00:00Z",
  "created_at": "2025-11-29T05:05:20Z",
  "updated_at": "2025-11-29T05:05:20Z",
  "customer_id": "E3PVSTRKJ0V4SR6WSR2AGR8W80",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "E3PVSTRKJ0V4SR6WSR2AGR8W80",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMXiw38Bbb7XQUWI",
      "any_team_member": true,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Sophia Lewandrowski
üéâ First booking detected for customer: E3PVSTRKJ0V4SR6WSR2AGR8W80
   Name: Sophia Lewandrowski
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer E3PVSTRKJ0V4SR6WSR2AGR8W80...
Error getting custom attributes for customer E3PVSTRKJ0V4SR6WSR2AGR8W80: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: E3PVSTRKJ0V4SR6WSR2AGR8W80
{"ts":"2025-11-29T05:20:06.012Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"2e47e568-2f35-4c20-98e8-148fbedefa2f","stage":"booking","correlationId":"booking-created:fad01e365870e69c497fe68c"}
{"ts":"2025-11-29T05:21:32.156Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"d62d84b2-6336-45a6-9087-215312a6c70a","stage":"booking","correlationId":"booking-created:deb5f92bf2672c2d859a8e57","attempts":1}
üìÖ Processing booking created for customer: WZ6ZPCN1WDWHD5WWPPB96M8810
Full booking data: {
  "id": "4pde5ma0g1ksw7",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-17T01:40:00Z",
  "created_at": "2025-11-29T05:21:30Z",
  "updated_at": "2025-11-29T05:21:30Z",
  "customer_id": "WZ6ZPCN1WDWHD5WWPPB96M8810",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "WZ6ZPCN1WDWHD5WWPPB96M8810",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMgsjtuk5cfKnstq",
      "any_team_member": false,
      "duration_minutes": 110,
      "intermission_minutes": 0,
      "service_variation_id": "6TYOE67IDYTKHW2ZG6HKVZER",
      "service_variation_version": 1764191999049,
      "service_variation_client_id": "6TYOE67IDYTKHW2ZG6HKVZER"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Madison Clark
üéâ First booking detected for customer: WZ6ZPCN1WDWHD5WWPPB96M8810
   Name: Madison Clark
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer WZ6ZPCN1WDWHD5WWPPB96M8810...
Error getting custom attributes for customer WZ6ZPCN1WDWHD5WWPPB96M8810: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: WZ6ZPCN1WDWHD5WWPPB96M8810
{"ts":"2025-11-29T05:21:32.765Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"d62d84b2-6336-45a6-9087-215312a6c70a","stage":"booking","correlationId":"booking-created:deb5f92bf2672c2d859a8e57"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-11-29T05:36:57.297Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"66278b29-7aec-47ff-8de7-26b0c5d16cde","stage":"booking","correlationId":"booking-created:c28d106390c0aa42bddef8e3","attempts":1}
üìÖ Processing booking created for customer: KX775VJY13BF0BNA9G81MA8PYM
Full booking data: {
  "id": "fja78pui7bbtfv",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-11-30T18:00:00Z",
  "created_at": "2025-11-29T05:23:28Z",
  "updated_at": "2025-11-29T05:23:28Z",
  "customer_id": "KX775VJY13BF0BNA9G81MA8PYM",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "KX775VJY13BF0BNA9G81MA8PYM",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMMBgVwykMnOlumA",
      "any_team_member": false,
      "duration_minutes": 140,
      "intermission_minutes": 0,
      "service_variation_id": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "CJI5WHOAKSFTASYPJ4MSYZLS"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Hannah Kwong
Error retrieving Square customer KX775VJY13BF0BNA9G81MA8PYM: Response status code was not ok: 401.
Square API errors: [
  {
    "category": "AUTHENTICATION_ERROR",
    "code": "UNAUTHORIZED",
    "detail": "This request could not be authorized."
  }
]
üéâ First booking detected for customer: KX775VJY13BF0BNA9G81MA8PYM
   Name: Hannah Kwong
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer KX775VJY13BF0BNA9G81MA8PYM...
Error getting custom attributes for customer KX775VJY13BF0BNA9G81MA8PYM: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: KX775VJY13BF0BNA9G81MA8PYM
{"ts":"2025-11-29T05:36:58.116Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"66278b29-7aec-47ff-8de7-26b0c5d16cde","stage":"booking","correlationId":"booking-created:c28d106390c0aa42bddef8e3"}
{"ts":"2025-11-29T05:36:58.379Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"5e76af63-f999-4b05-a202-ef10c4827a67","stage":"booking","correlationId":"booking-created:f663cf2afc332fa345500771","attempts":1}
üìÖ Processing booking created for customer: BCR3FX49B8S0CR4VEM4Y5WCPTW
Full booking data: {
  "id": "bbokucbyoqxxfc",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-22T21:15:00Z",
  "created_at": "2025-11-29T05:30:50Z",
  "updated_at": "2025-11-29T05:30:50Z",
  "customer_id": "BCR3FX49B8S0CR4VEM4Y5WCPTW",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "BCR3FX49B8S0CR4VEM4Y5WCPTW",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "resource_ids": [
        "5OVIQ6GSSUXORACP6T7WBAQ7"
      ],
      "team_member_id": "TMILsQUVwLkLzbVo",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "ZEAKNB35I37RMXNUBGWDZQIM",
      "service_variation_version": 1760895536505,
      "service_variation_client_id": "ZEAKNB35I37RMXNUBGWDZQIM"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Claudia Laurie
üéâ First booking detected for customer: BCR3FX49B8S0CR4VEM4Y5WCPTW
   Name: Claudia Laurie
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer BCR3FX49B8S0CR4VEM4Y5WCPTW...
Error getting custom attributes for customer BCR3FX49B8S0CR4VEM4Y5WCPTW: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: BCR3FX49B8S0CR4VEM4Y5WCPTW
{"ts":"2025-11-29T05:36:58.721Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"5e76af63-f999-4b05-a202-ef10c4827a67","stage":"booking","correlationId":"booking-created:f663cf2afc332fa345500771"}
{"ts":"2025-11-29T05:53:24.279Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Server has closed the connection.","stack":"PrismaClientKnownRequestError: Server has closed the connection.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-11-29T06:10:48.341Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"0ee7eaf0-6522-4b3b-8e19-e9984bd85040","stage":"booking","correlationId":"booking-created:8104d619d20ddc16fbd25291","attempts":1}
üìÖ Processing booking created for customer: QY21PYNRYD2GFBGA4J7XCKZV8C
Full booking data: {
  "id": "6q9gvs4h3f8kw8",
  "source": "THIRD_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-07T00:20:00Z",
  "created_at": "2025-11-29T05:55:56Z",
  "updated_at": "2025-11-29T05:55:56Z",
  "customer_id": "QY21PYNRYD2GFBGA4J7XCKZV8C",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "QY21PYNRYD2GFBGA4J7XCKZV8C",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TM1L5yPC-yKx6CyO",
      "any_team_member": false,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "NCOIL6ZGDTCC7SO3IJHENCQ2",
      "service_variation_version": 1764191999049,
      "service_variation_client_id": "NCOIL6ZGDTCC7SO3IJHENCQ2"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Aruzhan Tustikbayeva
üéâ First booking detected for customer: QY21PYNRYD2GFBGA4J7XCKZV8C
   Name: Aruzhan Tustikbayeva
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer QY21PYNRYD2GFBGA4J7XCKZV8C...
Error getting custom attributes for customer QY21PYNRYD2GFBGA4J7XCKZV8C: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: QY21PYNRYD2GFBGA4J7XCKZV8C
{"ts":"2025-11-29T06:10:48.957Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"0ee7eaf0-6522-4b3b-8e19-e9984bd85040","stage":"booking","correlationId":"booking-created:8104d619d20ddc16fbd25291"}
{"ts":"2025-11-29T06:10:49.112Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"ed4f0c19-a900-4b59-8775-42e24e401eb8","stage":"booking","correlationId":"booking-created:3f354a5e396858d69007f35a","attempts":1}
üìÖ Processing booking created for customer: QY21PYNRYD2GFBGA4J7XCKZV8C
Full booking data: {
  "id": "zimxwxqvnvehff",
  "source": "THIRD_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-28T00:00:00Z",
  "created_at": "2025-11-29T05:57:59Z",
  "updated_at": "2025-11-29T05:57:59Z",
  "customer_id": "QY21PYNRYD2GFBGA4J7XCKZV8C",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "QY21PYNRYD2GFBGA4J7XCKZV8C",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TM1L5yPC-yKx6CyO",
      "any_team_member": false,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "NCOIL6ZGDTCC7SO3IJHENCQ2",
      "service_variation_version": 1764191999049,
      "service_variation_client_id": "NCOIL6ZGDTCC7SO3IJHENCQ2"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Aruzhan Tustikbayeva
üéâ First booking detected for customer: QY21PYNRYD2GFBGA4J7XCKZV8C
   Name: Aruzhan Tustikbayeva
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer QY21PYNRYD2GFBGA4J7XCKZV8C...
Error getting custom attributes for customer QY21PYNRYD2GFBGA4J7XCKZV8C: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: QY21PYNRYD2GFBGA4J7XCKZV8C
{"ts":"2025-11-29T06:10:49.416Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"ed4f0c19-a900-4b59-8775-42e24e401eb8","stage":"booking","correlationId":"booking-created:3f354a5e396858d69007f35a"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-11-29T07:14:08.226Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"\nInvalid `prisma.$queryRaw()` invocation:\n\n\nServer has closed the connection.","stack":"PrismaClientKnownRequestError: \nInvalid `prisma.$queryRaw()` invocation:\n\n\nServer has closed the connection.\n    at $n.handleRequestError (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:121:7315)\n    at $n.handleAndLogRequestError (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:121:6623)\n    at $n.request (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:121:6307)\n    at async l (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:9633)\n    at async prisma.$transaction.isolationLevel (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:239:26)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:8000)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-11-29T07:14:11.408Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"8c85b2d6-b62f-4f2d-83c0-c4d214ccec21","stage":"booking","correlationId":"booking-created:396fcf5ad9e7e84a0534b67e","attempts":1}
üìÖ Processing booking created for customer: JSA4QDQQ86HNQFNMB3J7ECPB9G
Full booking data: {
  "id": "61168u5tkzp68w",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-23T19:50:00Z",
  "created_at": "2025-11-29T07:05:42Z",
  "updated_at": "2025-11-29T07:05:42Z",
  "customer_id": "JSA4QDQQ86HNQFNMB3J7ECPB9G",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "JSA4QDQQ86HNQFNMB3J7ECPB9G",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMgsjtuk5cfKnstq",
      "any_team_member": false,
      "duration_minutes": 110,
      "intermission_minutes": 0,
      "service_variation_id": "6TYOE67IDYTKHW2ZG6HKVZER",
      "service_variation_version": 1764191999049,
      "service_variation_client_id": "6TYOE67IDYTKHW2ZG6HKVZER"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Angela Sainvilus
üéâ First booking detected for customer: JSA4QDQQ86HNQFNMB3J7ECPB9G
   Name: Angela Sainvilus
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer JSA4QDQQ86HNQFNMB3J7ECPB9G...
Error getting custom attributes for customer JSA4QDQQ86HNQFNMB3J7ECPB9G: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: JSA4QDQQ86HNQFNMB3J7ECPB9G
{"ts":"2025-11-29T07:14:12.032Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"8c85b2d6-b62f-4f2d-83c0-c4d214ccec21","stage":"booking","correlationId":"booking-created:396fcf5ad9e7e84a0534b67e"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-11-29T08:24:31.329Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Server has closed the connection.","stack":"PrismaClientKnownRequestError: Server has closed the connection.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-11-29T08:40:51.374Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Server has closed the connection.","stack":"PrismaClientKnownRequestError: Server has closed the connection.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-11-29T09:25:32.303Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Server has closed the connection.","stack":"PrismaClientKnownRequestError: Server has closed the connection.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-11-29T12:06:20.439Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-11-29T12:22:11.347Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Server has closed the connection.","stack":"PrismaClientKnownRequestError: Server has closed the connection.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-11-29T12:47:58.684Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"063f58a0-6189-4728-a421-bbd8647ec7ed","stage":"booking","correlationId":"booking-created:08e64a037109d8b604e302cc","attempts":1}
üìÖ Processing booking created for customer: 06WSVCE31KD6K0VKWHS1X9N858
Full booking data: {
  "id": "p24gwnbhkocbh8",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-11-30T00:15:00Z",
  "created_at": "2025-11-29T12:46:19Z",
  "updated_at": "2025-11-29T12:46:19Z",
  "customer_id": "06WSVCE31KD6K0VKWHS1X9N858",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "06WSVCE31KD6K0VKWHS1X9N858",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMNW4SIF7tjp4oM_",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "BRSIGZFOWC6F4ERPKX3CODLU",
      "service_variation_version": 1764191999049,
      "service_variation_client_id": "BRSIGZFOWC6F4ERPKX3CODLU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Lauren Kelly
üéâ First booking detected for customer: 06WSVCE31KD6K0VKWHS1X9N858
   Name: Lauren Kelly
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 06WSVCE31KD6K0VKWHS1X9N858...
Error getting custom attributes for customer 06WSVCE31KD6K0VKWHS1X9N858: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 06WSVCE31KD6K0VKWHS1X9N858
{"ts":"2025-11-29T12:47:59.306Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"063f58a0-6189-4728-a421-bbd8647ec7ed","stage":"booking","correlationId":"booking-created:08e64a037109d8b604e302cc"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-11-29T14:47:36.281Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Server has closed the connection.","stack":"PrismaClientKnownRequestError: Server has closed the connection.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:8034)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-11-29T15:21:03.377Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"1377b472-4a21-4c59-853d-41864b9c304a","stage":"booking","correlationId":"booking-created:2f43e568ec47b14022b6dccd","attempts":1}
üìÖ Processing booking created for customer: 20T3NEX3996H7A53RB7XV4AHAW
Full booking data: {
  "id": "of6ogb183hopak",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-11-29T22:05:00Z",
  "created_at": "2025-11-29T15:09:29Z",
  "updated_at": "2025-11-29T15:09:29Z",
  "customer_id": "20T3NEX3996H7A53RB7XV4AHAW",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "20T3NEX3996H7A53RB7XV4AHAW",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMoZGdZlg-iKWTDu",
      "any_team_member": true,
      "duration_minutes": 45,
      "intermission_minutes": 0,
      "service_variation_id": "VVA7G2UN7N2HUFMCW5LQOVHB",
      "service_variation_version": 1763579781183,
      "service_variation_client_id": "VVA7G2UN7N2HUFMCW5LQOVHB"
    },
    {
      "team_member_id": "TMoZGdZlg-iKWTDu",
      "any_team_member": true,
      "duration_minutes": 30,
      "intermission_minutes": 0,
      "service_variation_id": "JNRUKPGA2ZZUFCEB6YPNDC2Y",
      "service_variation_version": 1760895536505,
      "service_variation_client_id": "JNRUKPGA2ZZUFCEB6YPNDC2Y"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Valerie Usmanova
üéâ First booking detected for customer: 20T3NEX3996H7A53RB7XV4AHAW
   Name: Valerie Usmanova
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 20T3NEX3996H7A53RB7XV4AHAW...
Error getting custom attributes for customer 20T3NEX3996H7A53RB7XV4AHAW: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 20T3NEX3996H7A53RB7XV4AHAW
{"ts":"2025-11-29T15:21:04.043Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"1377b472-4a21-4c59-853d-41864b9c304a","stage":"booking","correlationId":"booking-created:2f43e568ec47b14022b6dccd"}
{"ts":"2025-11-29T15:21:04.222Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"797e4236-fe91-4a01-817c-0a4507b199dd","stage":"booking","correlationId":"booking-created:7fb3b90e139220c5d9863bbf","attempts":1}
üìÖ Processing booking created for customer: ZWN24VMRT9WW22J7Y2QZ1DJGSR
Full booking data: {
  "id": "uqovjp7qmxm1wo",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-28T22:30:00Z",
  "created_at": "2025-11-29T15:17:57Z",
  "updated_at": "2025-11-29T15:17:57Z",
  "customer_id": "ZWN24VMRT9WW22J7Y2QZ1DJGSR",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "ZWN24VMRT9WW22J7Y2QZ1DJGSR",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMNW4SIF7tjp4oM_",
      "any_team_member": true,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "BRSIGZFOWC6F4ERPKX3CODLU",
      "service_variation_version": 1764191999049,
      "service_variation_client_id": "BRSIGZFOWC6F4ERPKX3CODLU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Emma Randall
üéâ First booking detected for customer: ZWN24VMRT9WW22J7Y2QZ1DJGSR
   Name: Emma Randall
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer ZWN24VMRT9WW22J7Y2QZ1DJGSR...
Error getting custom attributes for customer ZWN24VMRT9WW22J7Y2QZ1DJGSR: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: ZWN24VMRT9WW22J7Y2QZ1DJGSR
{"ts":"2025-11-29T15:21:04.549Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"797e4236-fe91-4a01-817c-0a4507b199dd","stage":"booking","correlationId":"booking-created:7fb3b90e139220c5d9863bbf"}
{"ts":"2025-11-29T15:36:48.254Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Server has closed the connection.","stack":"PrismaClientKnownRequestError: Server has closed the connection.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:8034)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-11-29T16:09:52.426Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"c84d1891-2f12-4051-bf4e-e0a7ab8d5b9b","stage":"booking","correlationId":"booking-created:6b2f7ce28496231700553530","attempts":1}
üìÖ Processing booking created for customer: 3J2GT9G70SC5TNK1E0RX03TEY8
Full booking data: {
  "id": "7zlaph4dn4myzl",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-11-29T19:30:00Z",
  "created_at": "2025-11-29T16:03:32Z",
  "updated_at": "2025-11-29T16:03:32Z",
  "customer_id": "3J2GT9G70SC5TNK1E0RX03TEY8",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "3J2GT9G70SC5TNK1E0RX03TEY8",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "resource_ids": [
        "KAOXILA4CV7A23VRAACC4R66"
      ],
      "team_member_id": "TM9jDlRr_Hl4rdBB",
      "any_team_member": true,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "ZEAKNB35I37RMXNUBGWDZQIM",
      "service_variation_version": 1760895536505,
      "service_variation_client_id": "ZEAKNB35I37RMXNUBGWDZQIM"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Bella Giusti
üéâ First booking detected for customer: 3J2GT9G70SC5TNK1E0RX03TEY8
   Name: Bella Giusti
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 3J2GT9G70SC5TNK1E0RX03TEY8...
Error getting custom attributes for customer 3J2GT9G70SC5TNK1E0RX03TEY8: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 3J2GT9G70SC5TNK1E0RX03TEY8
{"ts":"2025-11-29T16:09:53.047Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"c84d1891-2f12-4051-bf4e-e0a7ab8d5b9b","stage":"booking","correlationId":"booking-created:6b2f7ce28496231700553530"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-11-29T16:28:11.060Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"921b92b1-9ca0-4b84-9b74-cf29fd692b35","stage":"customer_ingest","correlationId":"customer-created:78688a3beeeddfc16835a189","attempts":1}
üì• Received customer data: {
  "id": "X99GDABH2XM81KD6HWQ39VWQD0",
  "address": {
    "country": "US"
  },
  "version": 0,
  "group_ids": [
    "LT4ZHFBQQYB2N.APPOINTMENTS"
  ],
  "created_at": "2025-11-29T16:21:16.366Z",
  "given_name": "Claire",
  "updated_at": "2025-11-29T16:21:16Z",
  "family_name": "Dodd",
  "preferences": {
    "email_unsubscribed": false
  },
  "phone_number": "+19255289158",
  "email_address": "clairedodd@sbcglobal.net",
  "creation_source": "APPOINTMENTS"
}
üë§ Processing customer creation: X99GDABH2XM81KD6HWQ39VWQD0
üìç IP Address: unknown
üìß Email: clairedodd@sbcglobal.net
üìû Phone: +19255289158
üë§ Name: Claire Dodd
‚ö†Ô∏è Suspicious IP activity detected: unknown used by 103 customers
‚ö†Ô∏è Suspicious activity detected for customer X99GDABH2XM81KD6HWQ39VWQD0, flagging for review
üéâ New customer detected: X99GDABH2XM81KD6HWQ39VWQD0
‚úÖ Customer added to database as NEW (temporary mark)
   - Will check for referral code when they book
   - Will give gift card on first booking if code found
‚úÖ Verification: Customer found in DB: true
{"ts":"2025-11-29T16:28:11.673Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"921b92b1-9ca0-4b84-9b74-cf29fd692b35","stage":"customer_ingest","correlationId":"customer-created:78688a3beeeddfc16835a189"}
{"ts":"2025-11-29T16:28:11.826Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"e2269721-405e-4e79-a73c-c2233cb47de6","stage":"booking","correlationId":"booking-created:c5f941c90f584f753af22272","attempts":1}
üìÖ Processing booking created for customer: X99GDABH2XM81KD6HWQ39VWQD0
Full booking data: {
  "id": "u3tavguje08nwt",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-14T20:20:00Z",
  "created_at": "2025-11-29T16:21:18Z",
  "updated_at": "2025-11-29T16:21:18Z",
  "customer_id": "X99GDABH2XM81KD6HWQ39VWQD0",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "X99GDABH2XM81KD6HWQ39VWQD0",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMe-bT5XxKxmk0nw",
      "any_team_member": true,
      "duration_minutes": 140,
      "intermission_minutes": 0,
      "service_variation_id": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "CJI5WHOAKSFTASYPJ4MSYZLS"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Claire Dodd
üéâ First booking detected for customer: X99GDABH2XM81KD6HWQ39VWQD0
   Name: Claire Dodd
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer X99GDABH2XM81KD6HWQ39VWQD0...
Error getting custom attributes for customer X99GDABH2XM81KD6HWQ39VWQD0: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: X99GDABH2XM81KD6HWQ39VWQD0
{"ts":"2025-11-29T16:28:12.192Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"e2269721-405e-4e79-a73c-c2233cb47de6","stage":"booking","correlationId":"booking-created:c5f941c90f584f753af22272"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-11-29T17:02:44.950Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"68f29c71-720a-436f-97d4-7754c6467337","stage":"customer_ingest","correlationId":"customer-created:cfd9c181fd88ea63ae7ddc24","attempts":1}
üì• Received customer data: {
  "id": "XKD35CM054N904NJNJ4R9FFYFR",
  "address": {
    "country": "US"
  },
  "version": 0,
  "group_ids": [
    "LT4ZHFBQQYB2N.APPOINTMENTS"
  ],
  "created_at": "2025-11-29T17:00:46.508Z",
  "given_name": "Serafima",
  "updated_at": "2025-11-29T17:00:46Z",
  "family_name": "Kobzeva",
  "preferences": {
    "email_unsubscribed": false
  },
  "phone_number": "+14155426341",
  "email_address": "sera.kobzeva@gmail.com",
  "creation_source": "APPOINTMENTS"
}
üë§ Processing customer creation: XKD35CM054N904NJNJ4R9FFYFR
üìç IP Address: unknown
üìß Email: sera.kobzeva@gmail.com
üìû Phone: +14155426341
üë§ Name: Serafima Kobzeva
‚ö†Ô∏è Suspicious IP activity detected: unknown used by 104 customers
‚ö†Ô∏è Suspicious activity detected for customer XKD35CM054N904NJNJ4R9FFYFR, flagging for review
üéâ New customer detected: XKD35CM054N904NJNJ4R9FFYFR
‚úÖ Customer added to database as NEW (temporary mark)
   - Will check for referral code when they book
   - Will give gift card on first booking if code found
‚úÖ Verification: Customer found in DB: true
{"ts":"2025-11-29T17:02:45.613Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"68f29c71-720a-436f-97d4-7754c6467337","stage":"customer_ingest","correlationId":"customer-created:cfd9c181fd88ea63ae7ddc24"}
{"ts":"2025-11-29T17:02:45.826Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"a7a10b37-38cf-4fed-b27b-28ffb41d043f","stage":"booking","correlationId":"booking-created:693db218f93f57e3b7db2490","attempts":1}
üìÖ Processing booking created for customer: XKD35CM054N904NJNJ4R9FFYFR
Full booking data: {
  "id": "4en315e3w1mz9d",
  "source": "THIRD_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-05T18:00:00Z",
  "created_at": "2025-11-29T17:00:49Z",
  "updated_at": "2025-11-29T17:00:49Z",
  "customer_id": "XKD35CM054N904NJNJ4R9FFYFR",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "XKD35CM054N904NJNJ4R9FFYFR",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMkdrQsxG5tlf-c_",
      "any_team_member": true,
      "duration_minutes": 140,
      "intermission_minutes": 0,
      "service_variation_id": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "CJI5WHOAKSFTASYPJ4MSYZLS"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Serafima Kobzeva
üéâ First booking detected for customer: XKD35CM054N904NJNJ4R9FFYFR
   Name: Serafima Kobzeva
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer XKD35CM054N904NJNJ4R9FFYFR...
Error getting custom attributes for customer XKD35CM054N904NJNJ4R9FFYFR: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: XKD35CM054N904NJNJ4R9FFYFR
{"ts":"2025-11-29T17:02:46.321Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"a7a10b37-38cf-4fed-b27b-28ffb41d043f","stage":"booking","correlationId":"booking-created:693db218f93f57e3b7db2490"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-11-29T17:12:42.170Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"12411a5f-2589-4cdf-a8bc-f3c95bb9cce8","stage":"booking","correlationId":"booking-created:9b46e4a84f6ae30793df2494","attempts":1}
üìÖ Processing booking created for customer: 5T9XNDW68D7XSDMYRQAMVNXZCR
Full booking data: {
  "id": "ew9plxcrbriafy",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-11-29T20:30:00Z",
  "created_at": "2025-11-29T17:11:46Z",
  "updated_at": "2025-11-29T17:11:46Z",
  "customer_id": "5T9XNDW68D7XSDMYRQAMVNXZCR",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "5T9XNDW68D7XSDMYRQAMVNXZCR",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMOscywuGXO2VURY",
      "any_team_member": true,
      "duration_minutes": 45,
      "intermission_minutes": 0,
      "service_variation_id": "VVA7G2UN7N2HUFMCW5LQOVHB",
      "service_variation_version": 1763579781183,
      "service_variation_client_id": "VVA7G2UN7N2HUFMCW5LQOVHB"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Alexandra O'Brien
üéâ First booking detected for customer: 5T9XNDW68D7XSDMYRQAMVNXZCR
   Name: Alexandra O'Brien
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 5T9XNDW68D7XSDMYRQAMVNXZCR...
Error getting custom attributes for customer 5T9XNDW68D7XSDMYRQAMVNXZCR: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 5T9XNDW68D7XSDMYRQAMVNXZCR
{"ts":"2025-11-29T17:12:42.841Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"12411a5f-2589-4cdf-a8bc-f3c95bb9cce8","stage":"booking","correlationId":"booking-created:9b46e4a84f6ae30793df2494"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-11-29T17:46:01.527Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"265fb576-3d4c-49d9-ba38-725911ad87d3","stage":"booking","correlationId":"booking-created:af93040462389e29afeadc62","attempts":1}
üìÖ Processing booking created for customer: SZS53MPZD0VVCG86TY8YRFKVVM
Full booking data: {
  "id": "3z0xcu3tzsodvp",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-11-30T01:00:00Z",
  "created_at": "2025-11-29T17:30:52Z",
  "updated_at": "2025-11-29T17:30:52Z",
  "customer_id": "SZS53MPZD0VVCG86TY8YRFKVVM",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "SZS53MPZD0VVCG86TY8YRFKVVM",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMdagA6g0F03A7_w",
      "any_team_member": true,
      "duration_minutes": 45,
      "intermission_minutes": 0,
      "service_variation_id": "VVA7G2UN7N2HUFMCW5LQOVHB",
      "service_variation_version": 1763579781183,
      "service_variation_client_id": "VVA7G2UN7N2HUFMCW5LQOVHB"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Jodi Choplin
üéâ First booking detected for customer: SZS53MPZD0VVCG86TY8YRFKVVM
   Name: Jodi Choplin
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer SZS53MPZD0VVCG86TY8YRFKVVM...
Error getting custom attributes for customer SZS53MPZD0VVCG86TY8YRFKVVM: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: SZS53MPZD0VVCG86TY8YRFKVVM
{"ts":"2025-11-29T17:46:02.218Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"265fb576-3d4c-49d9-ba38-725911ad87d3","stage":"booking","correlationId":"booking-created:af93040462389e29afeadc62"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-11-29T18:13:42.998Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"8681306f-12a9-45de-9d82-0b46a9a4f886","stage":"booking","correlationId":"booking-created:9e7bde06ca5f9a2e19584aab","attempts":1}
üìÖ Processing booking created for customer: BYH6XBPGXBDJ6JS7P4GNBJS7M0
Full booking data: {
  "id": "jklb1owyowsab3",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-20T22:30:00Z",
  "created_at": "2025-11-29T18:10:00Z",
  "updated_at": "2025-11-29T18:10:00Z",
  "customer_id": "BYH6XBPGXBDJ6JS7P4GNBJS7M0",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "BYH6XBPGXBDJ6JS7P4GNBJS7M0",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TM9jDlRr_Hl4rdBB",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "XBUDIMNKOPC2XVG5YLIQ4RYS",
      "service_variation_version": 1764191999049,
      "service_variation_client_id": "XBUDIMNKOPC2XVG5YLIQ4RYS"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Krista Letz
üéâ First booking detected for customer: BYH6XBPGXBDJ6JS7P4GNBJS7M0
   Name: Krista Letz
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer BYH6XBPGXBDJ6JS7P4GNBJS7M0...
Error getting custom attributes for customer BYH6XBPGXBDJ6JS7P4GNBJS7M0: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: BYH6XBPGXBDJ6JS7P4GNBJS7M0
{"ts":"2025-11-29T18:13:43.752Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"8681306f-12a9-45de-9d82-0b46a9a4f886","stage":"booking","correlationId":"booking-created:9e7bde06ca5f9a2e19584aab"}
{"ts":"2025-11-29T18:13:43.910Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"14dd254a-2634-486c-91bc-3ddcd660d3e8","stage":"booking","correlationId":"booking-created:eb836549285f744ffd46cee6","attempts":1}
üìÖ Processing booking created for customer: HKPGXGA7Z8XEHS2NMC84YVH0SC
Full booking data: {
  "id": "jsxbrxxpxymxa2",
  "source": "THIRD_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-07T22:05:00Z",
  "created_at": "2025-11-29T18:11:17Z",
  "updated_at": "2025-11-29T18:11:17Z",
  "customer_id": "HKPGXGA7Z8XEHS2NMC84YVH0SC",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "HKPGXGA7Z8XEHS2NMC84YVH0SC",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMoZGdZlg-iKWTDu",
      "any_team_member": false,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Andie Rodriguez
üéâ First booking detected for customer: HKPGXGA7Z8XEHS2NMC84YVH0SC
   Name: Andie Rodriguez
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer HKPGXGA7Z8XEHS2NMC84YVH0SC...
Error getting custom attributes for customer HKPGXGA7Z8XEHS2NMC84YVH0SC: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: HKPGXGA7Z8XEHS2NMC84YVH0SC
{"ts":"2025-11-29T18:13:44.504Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"14dd254a-2634-486c-91bc-3ddcd660d3e8","stage":"booking","correlationId":"booking-created:eb836549285f744ffd46cee6"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-11-29T18:23:01.996Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-11-29T18:23:05.169Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"111efc02-0a94-4cec-b566-97959e0f8fbc","stage":"payment","correlationId":"payment-updated:aa17a4155088895821be88e4","attempts":1}
üí∞ Processing payment completion for customer: V4FF20PPF3NPXJZ5RB8614JCJC
   Payment source_type: CASH
   Payment tender_types: []
üéâ First payment completed for customer: Noa Neria
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Noa Neria, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Noa Neria
   - Email: noaneria@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: V4FF20PPF3NPXJZ5RB8614JCJC
{"ts":"2025-11-29T18:23:05.799Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"111efc02-0a94-4cec-b566-97959e0f8fbc","stage":"payment","correlationId":"payment-updated:aa17a4155088895821be88e4"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-11-29T18:43:00.947Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`

Please make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.
{"ts":"2025-11-29T18:43:02.954Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-11-29T18:43:04.957Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-11-29T18:43:53.657Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-11-29T18:43:55.661Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-11-29T19:01:58.026Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"992d8c54-164a-447e-8ed1-2c7dfe0064cf","stage":"payment","correlationId":"payment-updated:ad0201ed41c66d6a53f879ff","attempts":1}
üí∞ Processing payment completion for customer: XZH93NCTP50AQBQ79Q3FAE6RZM
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Manon Gourdelier
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Manon Gourdelier, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Manon Gourdelier
   - Email: gourdelier.manon@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: XZH93NCTP50AQBQ79Q3FAE6RZM
{"ts":"2025-11-29T19:01:58.699Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"992d8c54-164a-447e-8ed1-2c7dfe0064cf","stage":"payment","correlationId":"payment-updated:ad0201ed41c66d6a53f879ff"}
{"ts":"2025-11-29T19:01:58.857Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"daf0e86e-2ec9-4d68-8ca4-a60e5fda5e3e","stage":"payment","correlationId":"payment-updated:3b3b9e3ef0ace7b2450fd9ca","attempts":1}
üí∞ Processing payment completion for customer: XZH93NCTP50AQBQ79Q3FAE6RZM
   Payment source_type: CARD
   Payment tender_types: []
Customer XZH93NCTP50AQBQ79Q3FAE6RZM already completed first payment
{"ts":"2025-11-29T19:01:58.989Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"daf0e86e-2ec9-4d68-8ca4-a60e5fda5e3e","stage":"payment","correlationId":"payment-updated:3b3b9e3ef0ace7b2450fd9ca"}
{"ts":"2025-11-29T19:14:41.958Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"0141980c-14b7-4cba-bed3-9a7f078e3b86","stage":"payment","correlationId":"payment-updated:53d2a0f64506d54a7ef77517","attempts":1}
üí∞ Processing payment completion for customer: X9V7VBD7TKWHX75HY3J70PR5M0
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Riya Jagetia
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Riya Jagetia, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Riya Jagetia
   - Email: riyajagetia@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: X9V7VBD7TKWHX75HY3J70PR5M0
{"ts":"2025-11-29T19:14:42.564Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"0141980c-14b7-4cba-bed3-9a7f078e3b86","stage":"payment","correlationId":"payment-updated:53d2a0f64506d54a7ef77517"}
{"ts":"2025-11-29T19:14:42.723Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"39833a2a-19ca-4cb9-ac66-3e5781765b38","stage":"payment","correlationId":"payment-updated:c6ff1f4ec2fe885ab3f42b0c","attempts":1}
üí∞ Processing payment completion for customer: X9V7VBD7TKWHX75HY3J70PR5M0
   Payment source_type: CARD
   Payment tender_types: []
Customer X9V7VBD7TKWHX75HY3J70PR5M0 already completed first payment
{"ts":"2025-11-29T19:14:42.868Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"39833a2a-19ca-4cb9-ac66-3e5781765b38","stage":"payment","correlationId":"payment-updated:c6ff1f4ec2fe885ab3f42b0c"}
{"ts":"2025-11-29T19:14:43.025Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"0cdc0da2-bcdd-44ad-b65f-7a6f888dd9c4","stage":"booking","correlationId":"booking-created:0c3ae7338c6cd2d261fe7d0e","attempts":1}
üìÖ Processing booking created for customer: EH4YGAQT1A52RA6FFV9MZS8MGM
Full booking data: {
  "id": "jxxq32jrbcxfk4",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-11-30T18:00:00Z",
  "created_at": "2025-11-29T19:14:19Z",
  "updated_at": "2025-11-29T19:14:19Z",
  "customer_id": "EH4YGAQT1A52RA6FFV9MZS8MGM",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "EH4YGAQT1A52RA6FFV9MZS8MGM",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMoZGdZlg-iKWTDu",
      "any_team_member": false,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Arnie Mijos
üéâ First booking detected for customer: EH4YGAQT1A52RA6FFV9MZS8MGM
   Name: Arnie Mijos
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer EH4YGAQT1A52RA6FFV9MZS8MGM...
Error getting custom attributes for customer EH4YGAQT1A52RA6FFV9MZS8MGM: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: EH4YGAQT1A52RA6FFV9MZS8MGM
{"ts":"2025-11-29T19:14:43.456Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"0cdc0da2-bcdd-44ad-b65f-7a6f888dd9c4","stage":"booking","correlationId":"booking-created:0c3ae7338c6cd2d261fe7d0e"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-11-29T19:46:35.925Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"c95ca778-8995-47e7-b25f-c503c82c8002","stage":"booking","correlationId":"booking-created:cc5fd2147c3e91dd4d654354","attempts":1}
üìÖ Processing booking created for customer: 9VP66R83HHMTZWDT7S9ZF4KDA4
Full booking data: {
  "id": "lyigdvgszd8ikz",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-24T22:15:00Z",
  "created_at": "2025-11-29T19:40:21Z",
  "updated_at": "2025-11-29T19:40:21Z",
  "customer_id": "9VP66R83HHMTZWDT7S9ZF4KDA4",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "9VP66R83HHMTZWDT7S9ZF4KDA4",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMyUMvTJIj2HrHSg",
      "any_team_member": true,
      "duration_minutes": 45,
      "intermission_minutes": 0,
      "service_variation_id": "VVA7G2UN7N2HUFMCW5LQOVHB",
      "service_variation_version": 1763579781183,
      "service_variation_client_id": "VVA7G2UN7N2HUFMCW5LQOVHB"
    },
    {
      "resource_ids": [
        "KAOXILA4CV7A23VRAACC4R66"
      ],
      "team_member_id": "TMyUMvTJIj2HrHSg",
      "any_team_member": true,
      "duration_minutes": 60,
      "intermission_minutes": 0,
      "service_variation_id": "SBE5XUATXRM76CBTT25HL2NZ",
      "service_variation_version": 1760895536505,
      "service_variation_client_id": "SBE5XUATXRM76CBTT25HL2NZ"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Larisa Bondarenko
üéâ First booking detected for customer: 9VP66R83HHMTZWDT7S9ZF4KDA4
   Name: Larisa Bondarenko
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 9VP66R83HHMTZWDT7S9ZF4KDA4...
Error getting custom attributes for customer 9VP66R83HHMTZWDT7S9ZF4KDA4: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 9VP66R83HHMTZWDT7S9ZF4KDA4
{"ts":"2025-11-29T19:46:36.591Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"c95ca778-8995-47e7-b25f-c503c82c8002","stage":"booking","correlationId":"booking-created:cc5fd2147c3e91dd4d654354"}
{"ts":"2025-11-29T19:46:36.755Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"e1d187d3-f687-4911-8a2c-6e4e9b3750f6","stage":"booking","correlationId":"booking-created:e254ec82884d296159b674fa","attempts":1}
üìÖ Processing booking created for customer: 1Y9PRWCK5P7P7VFB549ARTEZMC
Full booking data: {
  "id": "fpdhrweu158dqd",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-14T18:00:00Z",
  "created_at": "2025-11-29T19:40:33Z",
  "updated_at": "2025-11-29T19:40:33Z",
  "customer_id": "1Y9PRWCK5P7P7VFB549ARTEZMC",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "1Y9PRWCK5P7P7VFB549ARTEZMC",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "resource_ids": [
        "KAOXILA4CV7A23VRAACC4R66"
      ],
      "team_member_id": "TM7_r-KmvY9xjnEU",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "ZEAKNB35I37RMXNUBGWDZQIM",
      "service_variation_version": 1760895536505,
      "service_variation_client_id": "ZEAKNB35I37RMXNUBGWDZQIM"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Gabriella Navarra
üéâ First booking detected for customer: 1Y9PRWCK5P7P7VFB549ARTEZMC
   Name: Gabriella Navarra
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 1Y9PRWCK5P7P7VFB549ARTEZMC...
Error getting custom attributes for customer 1Y9PRWCK5P7P7VFB549ARTEZMC: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 1Y9PRWCK5P7P7VFB549ARTEZMC
{"ts":"2025-11-29T19:46:37.155Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"e1d187d3-f687-4911-8a2c-6e4e9b3750f6","stage":"booking","correlationId":"booking-created:e254ec82884d296159b674fa"}
{"ts":"2025-11-29T19:46:37.316Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"dfe3ea63-b799-44a2-bfe0-e63471573db4","stage":"booking","correlationId":"booking-created:01757fe2f1aa70d654dc07c9","attempts":1}
üìÖ Processing booking created for customer: 014KK22T9TFW88FTAG8EMKNJM0
Full booking data: {
  "id": "fls36y2iblevp3",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-23T17:00:00Z",
  "created_at": "2025-11-29T19:44:21Z",
  "updated_at": "2025-11-29T19:44:21Z",
  "customer_id": "014KK22T9TFW88FTAG8EMKNJM0",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMWAtQTYmZpwwxii"
  },
  "appointment_segments": [
    {
      "team_member_id": "TM-zXe9fXe4axYWn",
      "any_team_member": false,
      "duration_minutes": 140,
      "intermission_minutes": 0,
      "service_variation_id": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "CJI5WHOAKSFTASYPJ4MSYZLS"
    },
    {
      "team_member_id": "TM-zXe9fXe4axYWn",
      "any_team_member": false,
      "duration_minutes": 5,
      "intermission_minutes": 0,
      "service_variation_id": "DBRXEHQPCF7V4APTHDQTZW62",
      "service_variation_version": 1762374620368,
      "service_variation_client_id": "DBRXEHQPCF7V4APTHDQTZW62"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Joana fontoura
üéâ First booking detected for customer: 014KK22T9TFW88FTAG8EMKNJM0
   Name: Joana fontoura
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 014KK22T9TFW88FTAG8EMKNJM0...
Error getting custom attributes for customer 014KK22T9TFW88FTAG8EMKNJM0: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 014KK22T9TFW88FTAG8EMKNJM0
{"ts":"2025-11-29T19:46:37.699Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"dfe3ea63-b799-44a2-bfe0-e63471573db4","stage":"booking","correlationId":"booking-created:01757fe2f1aa70d654dc07c9"}
{"ts":"2025-11-29T19:46:37.861Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"84fb5ffc-8b58-46b2-b548-47dbee4f8711","stage":"booking","correlationId":"booking-created:a4be01ddd7606f6d099217d5","attempts":1}
üìÖ Processing booking created for customer: 014KK22T9TFW88FTAG8EMKNJM0
Full booking data: {
  "id": "dk6zytu9l93wmo",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-23T17:00:00Z",
  "created_at": "2025-11-29T19:44:39Z",
  "updated_at": "2025-11-29T19:44:39Z",
  "customer_id": "014KK22T9TFW88FTAG8EMKNJM0",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMWAtQTYmZpwwxii"
  },
  "appointment_segments": [
    {
      "resource_ids": [
        "5OVIQ6GSSUXORACP6T7WBAQ7"
      ],
      "team_member_id": "TMVwAQUdLz6no-cB",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "ZEAKNB35I37RMXNUBGWDZQIM",
      "service_variation_version": 1760895536505,
      "service_variation_client_id": "ZEAKNB35I37RMXNUBGWDZQIM"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Joana fontoura
üéâ First booking detected for customer: 014KK22T9TFW88FTAG8EMKNJM0
   Name: Joana fontoura
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 014KK22T9TFW88FTAG8EMKNJM0...
Error getting custom attributes for customer 014KK22T9TFW88FTAG8EMKNJM0: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 014KK22T9TFW88FTAG8EMKNJM0
{"ts":"2025-11-29T19:46:38.231Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"84fb5ffc-8b58-46b2-b548-47dbee4f8711","stage":"booking","correlationId":"booking-created:a4be01ddd7606f6d099217d5"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-11-29T20:02:58.813Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"770606cd-dcca-40ec-82d6-416545a68dc9","stage":"booking","correlationId":"booking-created:da485a435985cd0fe8539324","attempts":1}
üìÖ Processing booking created for customer: 1Y9PRWCK5P7P7VFB549ARTEZMC
Full booking data: {
  "id": "ycjfxq2ekapo51",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-14T20:00:00Z",
  "created_at": "2025-11-29T19:47:05Z",
  "updated_at": "2025-11-29T19:47:05Z",
  "customer_id": "1Y9PRWCK5P7P7VFB549ARTEZMC",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "1Y9PRWCK5P7P7VFB549ARTEZMC",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMoZGdZlg-iKWTDu",
      "any_team_member": true,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Gabriella Navarra
üéâ First booking detected for customer: 1Y9PRWCK5P7P7VFB549ARTEZMC
   Name: Gabriella Navarra
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 1Y9PRWCK5P7P7VFB549ARTEZMC...
Error getting custom attributes for customer 1Y9PRWCK5P7P7VFB549ARTEZMC: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 1Y9PRWCK5P7P7VFB549ARTEZMC
{"ts":"2025-11-29T20:02:59.449Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"770606cd-dcca-40ec-82d6-416545a68dc9","stage":"booking","correlationId":"booking-created:da485a435985cd0fe8539324"}
{"ts":"2025-11-29T20:02:59.604Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"fda64183-d50a-420c-85a1-05cf75a6bbc7","stage":"booking","correlationId":"booking-created:cc8d45d6fd0166215a961a8c","attempts":1}
üìÖ Processing booking created for customer: HYZVWGZQCGRQTFNMAM46WZS7S4
Full booking data: {
  "id": "kvatdjs3o2xi3p",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-05T00:00:00Z",
  "created_at": "2025-11-29T19:51:09Z",
  "updated_at": "2025-11-29T19:51:09Z",
  "customer_id": "HYZVWGZQCGRQTFNMAM46WZS7S4",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "HYZVWGZQCGRQTFNMAM46WZS7S4",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMSt73bSp59caRzt",
      "any_team_member": false,
      "duration_minutes": 140,
      "intermission_minutes": 0,
      "service_variation_id": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "CJI5WHOAKSFTASYPJ4MSYZLS"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Claire Shorall
üéâ First booking detected for customer: HYZVWGZQCGRQTFNMAM46WZS7S4
   Name: Claire Shorall
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer HYZVWGZQCGRQTFNMAM46WZS7S4...
Error getting custom attributes for customer HYZVWGZQCGRQTFNMAM46WZS7S4: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: HYZVWGZQCGRQTFNMAM46WZS7S4
{"ts":"2025-11-29T20:02:59.999Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"fda64183-d50a-420c-85a1-05cf75a6bbc7","stage":"booking","correlationId":"booking-created:cc8d45d6fd0166215a961a8c"}
{"ts":"2025-11-29T20:03:00.155Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"ccef82a8-ed87-46ae-a14c-7c95e1aae809","stage":"payment","correlationId":"payment-updated:2cc9f0d01bce704356fcc006","attempts":1}
üí∞ Processing payment completion for customer: G6R9ZJ4JZ48QKCB9JRD8AM81VC
   Payment source_type: CARD
   Payment tender_types: []
Customer G6R9ZJ4JZ48QKCB9JRD8AM81VC already completed first payment
{"ts":"2025-11-29T20:03:00.302Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"ccef82a8-ed87-46ae-a14c-7c95e1aae809","stage":"payment","correlationId":"payment-updated:2cc9f0d01bce704356fcc006"}
{"ts":"2025-11-29T20:03:00.457Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"35677092-098c-4c19-8371-76d45b5f87e1","stage":"payment","correlationId":"payment-updated:9ee071e6fd127dd9779fab29","attempts":1}
üí∞ Processing payment completion for customer: G6R9ZJ4JZ48QKCB9JRD8AM81VC
   Payment source_type: CARD
   Payment tender_types: []
Customer G6R9ZJ4JZ48QKCB9JRD8AM81VC already completed first payment
{"ts":"2025-11-29T20:03:00.589Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"35677092-098c-4c19-8371-76d45b5f87e1","stage":"payment","correlationId":"payment-updated:9ee071e6fd127dd9779fab29"}
{"ts":"2025-11-29T20:03:00.748Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"3683b298-f856-4266-8898-83ff7d3044a3","stage":"booking","correlationId":"booking-created:cd860c06c2234862fcdb8f62","attempts":1}
üìÖ Processing booking created for customer: BTXY2YP8NRZQNCVWSC9ZWJ8264
Full booking data: {
  "id": "ur4ysfrqhgn0t7",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-12T18:00:00Z",
  "created_at": "2025-11-29T20:01:00Z",
  "updated_at": "2025-11-29T20:01:00Z",
  "customer_id": "BTXY2YP8NRZQNCVWSC9ZWJ8264",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "BTXY2YP8NRZQNCVWSC9ZWJ8264",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMgsjtuk5cfKnstq",
      "any_team_member": false,
      "duration_minutes": 110,
      "intermission_minutes": 0,
      "service_variation_id": "6TYOE67IDYTKHW2ZG6HKVZER",
      "service_variation_version": 1764191999049,
      "service_variation_client_id": "6TYOE67IDYTKHW2ZG6HKVZER"
    },
    {
      "resource_ids": [
        "5OVIQ6GSSUXORACP6T7WBAQ7"
      ],
      "team_member_id": "TMgsjtuk5cfKnstq",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "ZEAKNB35I37RMXNUBGWDZQIM",
      "service_variation_version": 1760895536505,
      "service_variation_client_id": "ZEAKNB35I37RMXNUBGWDZQIM"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Michelle Richards
üéâ First booking detected for customer: BTXY2YP8NRZQNCVWSC9ZWJ8264
   Name: Michelle Richards
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer BTXY2YP8NRZQNCVWSC9ZWJ8264...
Error getting custom attributes for customer BTXY2YP8NRZQNCVWSC9ZWJ8264: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: BTXY2YP8NRZQNCVWSC9ZWJ8264
{"ts":"2025-11-29T20:03:01.188Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"3683b298-f856-4266-8898-83ff7d3044a3","stage":"booking","correlationId":"booking-created:cd860c06c2234862fcdb8f62"}
{"ts":"2025-11-29T20:15:41.879Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"26f46656-273e-4e02-b503-e9b526c8982a","stage":"payment","correlationId":"payment-updated:8e1d615b879d62607a9e9bcc","attempts":1}
üí∞ Processing payment completion for customer: A4J89BXRFQ5G7N18K2Y6J597S0
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Meghan Banks
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Meghan Banks, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Meghan Banks
   - Email: meghanchristine13@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: A4J89BXRFQ5G7N18K2Y6J597S0
{"ts":"2025-11-29T20:15:42.493Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"26f46656-273e-4e02-b503-e9b526c8982a","stage":"payment","correlationId":"payment-updated:8e1d615b879d62607a9e9bcc"}
{"ts":"2025-11-29T20:15:42.703Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"58b76b99-cda1-4174-8564-68d609a5d0f8","stage":"payment","correlationId":"payment-updated:6cd21cbdd3a2fc2d654b40d1","attempts":1}
üí∞ Processing payment completion for customer: A4J89BXRFQ5G7N18K2Y6J597S0
   Payment source_type: CARD
   Payment tender_types: []
Customer A4J89BXRFQ5G7N18K2Y6J597S0 already completed first payment
{"ts":"2025-11-29T20:15:42.841Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"58b76b99-cda1-4174-8564-68d609a5d0f8","stage":"payment","correlationId":"payment-updated:6cd21cbdd3a2fc2d654b40d1"}
{"ts":"2025-11-29T20:15:43.001Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"568da6d6-c45c-45a5-ae57-f60baaa5b310","stage":"booking","correlationId":"booking-created:20e793d329d8213af970aff5","attempts":1}
üìÖ Processing booking created for customer: ZG36MF6864P0HJJ7AH0BSPS1MM
Full booking data: {
  "id": "uhnkk9zz1x7lw2",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-01T00:00:00Z",
  "created_at": "2025-11-29T20:11:22Z",
  "updated_at": "2025-11-29T20:11:22Z",
  "customer_id": "ZG36MF6864P0HJJ7AH0BSPS1MM",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "ZG36MF6864P0HJJ7AH0BSPS1MM",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMEWAZHdtaiRR_Zs",
      "any_team_member": true,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Janel Hodo
üéâ First booking detected for customer: ZG36MF6864P0HJJ7AH0BSPS1MM
   Name: Janel Hodo
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer ZG36MF6864P0HJJ7AH0BSPS1MM...
Error getting custom attributes for customer ZG36MF6864P0HJJ7AH0BSPS1MM: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: ZG36MF6864P0HJJ7AH0BSPS1MM
{"ts":"2025-11-29T20:15:43.434Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"568da6d6-c45c-45a5-ae57-f60baaa5b310","stage":"booking","correlationId":"booking-created:20e793d329d8213af970aff5"}
{"ts":"2025-11-29T20:32:36.366Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"36b11f17-8a46-4f1b-914e-956d4f4f3c35","stage":"booking","correlationId":"booking-created:ef2d1dfaf46e3167386c66a2","attempts":1}
üìÖ Processing booking created for customer: 0YBF29AQMY62N5H5FS0VYZYPPW
Full booking data: {
  "id": "f4ih904yqd3ivs",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-06T22:40:00Z",
  "created_at": "2025-11-29T20:24:48Z",
  "updated_at": "2025-11-29T20:24:48Z",
  "customer_id": "0YBF29AQMY62N5H5FS0VYZYPPW",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "0YBF29AQMY62N5H5FS0VYZYPPW",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TM-zXe9fXe4axYWn",
      "any_team_member": true,
      "duration_minutes": 140,
      "intermission_minutes": 0,
      "service_variation_id": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "CJI5WHOAKSFTASYPJ4MSYZLS"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Inga Zhuravleva
üéâ First booking detected for customer: 0YBF29AQMY62N5H5FS0VYZYPPW
   Name: Inga Zhuravleva
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 0YBF29AQMY62N5H5FS0VYZYPPW...
Error getting custom attributes for customer 0YBF29AQMY62N5H5FS0VYZYPPW: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 0YBF29AQMY62N5H5FS0VYZYPPW
{"ts":"2025-11-29T20:32:37.074Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"36b11f17-8a46-4f1b-914e-956d4f4f3c35","stage":"booking","correlationId":"booking-created:ef2d1dfaf46e3167386c66a2"}
{"ts":"2025-11-29T20:32:37.232Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"77212d05-070d-4a48-b727-4966ebc1f2de","stage":"booking","correlationId":"booking-created:1294b4dd52a8bd1e14f970e5","attempts":1}
üìÖ Processing booking created for customer: RKZS4995CP2AJ06E87VS36RY6M
Full booking data: {
  "id": "rzny9t4g6icjvm",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-11-30T22:00:00Z",
  "created_at": "2025-11-29T20:32:20Z",
  "updated_at": "2025-11-29T20:32:20Z",
  "customer_id": "RKZS4995CP2AJ06E87VS36RY6M",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "RKZS4995CP2AJ06E87VS36RY6M",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMEWAZHdtaiRR_Zs",
      "any_team_member": true,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Stephany Echevarria
üéâ First booking detected for customer: RKZS4995CP2AJ06E87VS36RY6M
   Name: Stephany Echevarria
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer RKZS4995CP2AJ06E87VS36RY6M...
Error getting custom attributes for customer RKZS4995CP2AJ06E87VS36RY6M: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: RKZS4995CP2AJ06E87VS36RY6M
{"ts":"2025-11-29T20:32:37.694Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"77212d05-070d-4a48-b727-4966ebc1f2de","stage":"booking","correlationId":"booking-created:1294b4dd52a8bd1e14f970e5"}
{"ts":"2025-11-29T20:48:26.165Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Server has closed the connection.","stack":"PrismaClientKnownRequestError: Server has closed the connection.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-11-29T20:48:28.836Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"f78b828f-57ef-405a-8cf6-c6a2cca92dc9","stage":"payment","correlationId":"payment-updated:fe2a3e3c4807307ed4781afb","attempts":1}
üí∞ Processing payment completion for customer: 3J2GT9G70SC5TNK1E0RX03TEY8
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Bella Giusti
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Bella Giusti, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Bella Giusti
   - Email: thebellagiusti@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: 3J2GT9G70SC5TNK1E0RX03TEY8
{"ts":"2025-11-29T20:48:29.421Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"f78b828f-57ef-405a-8cf6-c6a2cca92dc9","stage":"payment","correlationId":"payment-updated:fe2a3e3c4807307ed4781afb"}
{"ts":"2025-11-29T20:48:29.582Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"182449b2-fcc7-405a-83e3-570ec0965e63","stage":"payment","correlationId":"payment-updated:c4923f454a04702285979750","attempts":1}
üí∞ Processing payment completion for customer: 3J2GT9G70SC5TNK1E0RX03TEY8
   Payment source_type: CARD
   Payment tender_types: []
Customer 3J2GT9G70SC5TNK1E0RX03TEY8 already completed first payment
{"ts":"2025-11-29T20:48:29.722Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"182449b2-fcc7-405a-83e3-570ec0965e63","stage":"payment","correlationId":"payment-updated:c4923f454a04702285979750"}
{"ts":"2025-11-29T20:48:29.878Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"6d376408-ce4a-42b4-af15-65843b6d9d3d","stage":"booking","correlationId":"booking-created:a85718560a0d63f5845fe029","attempts":1}
üìÖ Processing booking created for customer: 273X4Q5M7SE3Z15S9339Z2R1DG
Full booking data: {
  "id": "rbux258gw5djfv",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-29T18:00:00Z",
  "created_at": "2025-11-29T20:48:23Z",
  "updated_at": "2025-11-29T20:48:23Z",
  "customer_id": "273X4Q5M7SE3Z15S9339Z2R1DG",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "273X4Q5M7SE3Z15S9339Z2R1DG",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMgsjtuk5cfKnstq",
      "any_team_member": false,
      "duration_minutes": 110,
      "intermission_minutes": 0,
      "service_variation_id": "6TYOE67IDYTKHW2ZG6HKVZER",
      "service_variation_version": 1764191999049,
      "service_variation_client_id": "6TYOE67IDYTKHW2ZG6HKVZER"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Lauren Stoll
üéâ First booking detected for customer: 273X4Q5M7SE3Z15S9339Z2R1DG
   Name: Lauren Stoll
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 273X4Q5M7SE3Z15S9339Z2R1DG...
Error getting custom attributes for customer 273X4Q5M7SE3Z15S9339Z2R1DG: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 273X4Q5M7SE3Z15S9339Z2R1DG
{"ts":"2025-11-29T20:48:30.284Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"6d376408-ce4a-42b4-af15-65843b6d9d3d","stage":"booking","correlationId":"booking-created:a85718560a0d63f5845fe029"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-11-29T21:06:01.041Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"ffe9a69d-d90a-421e-83fb-6eff82f80d2a","stage":"payment","correlationId":"payment-updated:58f3d7d26a397df8226078a1","attempts":1}
üí∞ Processing payment completion for customer: H5WY5JZGN5YA92ENW2WJ60F830
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Julia Guenther
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Julia Guenther, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Julia Guenther
   - Email: jaguenther14@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: H5WY5JZGN5YA92ENW2WJ60F830
{"ts":"2025-11-29T21:06:01.621Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"ffe9a69d-d90a-421e-83fb-6eff82f80d2a","stage":"payment","correlationId":"payment-updated:58f3d7d26a397df8226078a1"}
{"ts":"2025-11-29T21:06:01.785Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"b033be6e-a5c9-4311-9a14-f97311a8e4a0","stage":"payment","correlationId":"payment-updated:1622ac7d7478471c2c2ab830","attempts":1}
üí∞ Processing payment completion for customer: H5WY5JZGN5YA92ENW2WJ60F830
   Payment source_type: CARD
   Payment tender_types: []
Customer H5WY5JZGN5YA92ENW2WJ60F830 already completed first payment
{"ts":"2025-11-29T21:06:01.924Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"b033be6e-a5c9-4311-9a14-f97311a8e4a0","stage":"payment","correlationId":"payment-updated:1622ac7d7478471c2c2ab830"}
{"ts":"2025-11-29T21:06:02.087Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"0ca10dc5-9bbc-48e6-b57d-230eecb8712b","stage":"booking","correlationId":"booking-created:8427a44b3db965f813212c38","attempts":1}
üìÖ Processing booking created for customer: WW7ZMK9PFG7QG0VDYF6Y4BBAHR
Full booking data: {
  "id": "fhq3ru7fvk7yzy",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-11-30T20:20:00Z",
  "created_at": "2025-11-29T20:51:20Z",
  "updated_at": "2025-11-29T20:51:20Z",
  "customer_id": "WW7ZMK9PFG7QG0VDYF6Y4BBAHR",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMWAtQTYmZpwwxii"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMSt73bSp59caRzt",
      "any_team_member": false,
      "duration_minutes": 140,
      "intermission_minutes": 0,
      "service_variation_id": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "CJI5WHOAKSFTASYPJ4MSYZLS"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Carla Souza
üéâ First booking detected for customer: WW7ZMK9PFG7QG0VDYF6Y4BBAHR
   Name: Carla Souza
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer WW7ZMK9PFG7QG0VDYF6Y4BBAHR...
Error getting custom attributes for customer WW7ZMK9PFG7QG0VDYF6Y4BBAHR: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: WW7ZMK9PFG7QG0VDYF6Y4BBAHR
{"ts":"2025-11-29T21:06:02.502Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"0ca10dc5-9bbc-48e6-b57d-230eecb8712b","stage":"booking","correlationId":"booking-created:8427a44b3db965f813212c38"}
{"ts":"2025-11-29T21:06:02.660Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"078fae01-8721-4c5b-8391-6b891b31d190","stage":"booking","correlationId":"booking-created:fb129cdb84da4a7040cdb149","attempts":1}
üìÖ Processing booking created for customer: ZQYMGH6ZSSJ8VF7YB6J2TPBPK0
Full booking data: {
  "id": "kt5979swuw5557",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-11-30T19:50:00Z",
  "created_at": "2025-11-29T21:05:45Z",
  "updated_at": "2025-11-29T21:05:45Z",
  "customer_id": "ZQYMGH6ZSSJ8VF7YB6J2TPBPK0",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMQPbDVvvOCLwqsy"
  },
  "appointment_segments": [
    {
      "team_member_id": "TM9jDlRr_Hl4rdBB",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "XBUDIMNKOPC2XVG5YLIQ4RYS",
      "service_variation_version": 1764191999049,
      "service_variation_client_id": "XBUDIMNKOPC2XVG5YLIQ4RYS"
    },
    {
      "team_member_id": "TM9jDlRr_Hl4rdBB",
      "any_team_member": false,
      "duration_minutes": 20,
      "intermission_minutes": 0,
      "service_variation_id": "HAJX45W3U2WUCCXM5MI24UEE",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "HAJX45W3U2WUCCXM5MI24UEE"
    },
    {
      "resource_ids": [
        "KAOXILA4CV7A23VRAACC4R66"
      ],
      "team_member_id": "TM9jDlRr_Hl4rdBB",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "63PG6RLS2NHWRD5JRXEC74HN",
      "service_variation_version": 1760895536505,
      "service_variation_client_id": "VZLZVOWNIEIWAQ47FX67GQS4"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Noha Nayeri
üéâ First booking detected for customer: ZQYMGH6ZSSJ8VF7YB6J2TPBPK0
   Name: Noha Nayeri
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer ZQYMGH6ZSSJ8VF7YB6J2TPBPK0...
Error getting custom attributes for customer ZQYMGH6ZSSJ8VF7YB6J2TPBPK0: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: ZQYMGH6ZSSJ8VF7YB6J2TPBPK0
{"ts":"2025-11-29T21:06:03.062Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"078fae01-8721-4c5b-8391-6b891b31d190","stage":"booking","correlationId":"booking-created:fb129cdb84da4a7040cdb149"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-11-29T21:16:42.340Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"91ff1b0d-eac6-4a74-8e5c-50d463bad08b","stage":"booking","correlationId":"booking-created:ef18e93069b72693a36972b5","attempts":1}
üìÖ Processing booking created for customer: 3F1N1S9020CHCTVMY4H5GJRR7G
Full booking data: {
  "id": "o7y6yh9bo16atp",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-08T21:20:00Z",
  "created_at": "2025-11-29T21:08:18Z",
  "updated_at": "2025-11-29T21:08:18Z",
  "customer_id": "3F1N1S9020CHCTVMY4H5GJRR7G",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "3F1N1S9020CHCTVMY4H5GJRR7G",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMILsQUVwLkLzbVo",
      "any_team_member": true,
      "duration_minutes": 100,
      "intermission_minutes": 0,
      "service_variation_id": "BM556FTNFOTEHYVG4GPXAXFM",
      "service_variation_version": 1764191999049,
      "service_variation_client_id": "BM556FTNFOTEHYVG4GPXAXFM"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Tara Soudant
üéâ First booking detected for customer: 3F1N1S9020CHCTVMY4H5GJRR7G
   Name: Tara Soudant
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 3F1N1S9020CHCTVMY4H5GJRR7G...
Error getting custom attributes for customer 3F1N1S9020CHCTVMY4H5GJRR7G: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 3F1N1S9020CHCTVMY4H5GJRR7G
{"ts":"2025-11-29T21:16:43.020Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"91ff1b0d-eac6-4a74-8e5c-50d463bad08b","stage":"booking","correlationId":"booking-created:ef18e93069b72693a36972b5"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-11-29T21:36:12.559Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"05cc6237-67ac-48ea-97c7-fd0559be876b","stage":"booking","correlationId":"booking-created:0469622d4db162ec9f6ca655","attempts":1}
üìÖ Processing booking created for customer: 77GVJSBB7089Y8XRDG2EFS6GXR
Full booking data: {
  "id": "ecezzaqcxdvtx2",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-08T21:00:00Z",
  "created_at": "2025-11-29T21:19:14Z",
  "updated_at": "2025-11-29T21:19:14Z",
  "customer_id": "77GVJSBB7089Y8XRDG2EFS6GXR",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "77GVJSBB7089Y8XRDG2EFS6GXR",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMVwAQUdLz6no-cB",
      "any_team_member": true,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "HXLBKQC3DRE57DB7IK5RBYOB",
      "service_variation_version": 1758654327496,
      "service_variation_client_id": "HXLBKQC3DRE57DB7IK5RBYOB"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Chelsea Briggs
üéâ First booking detected for customer: 77GVJSBB7089Y8XRDG2EFS6GXR
   Name: Chelsea Briggs
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 77GVJSBB7089Y8XRDG2EFS6GXR...
Error getting custom attributes for customer 77GVJSBB7089Y8XRDG2EFS6GXR: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 77GVJSBB7089Y8XRDG2EFS6GXR
{"ts":"2025-11-29T21:36:13.737Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"05cc6237-67ac-48ea-97c7-fd0559be876b","stage":"booking","correlationId":"booking-created:0469622d4db162ec9f6ca655"}
{"ts":"2025-11-29T21:36:13.894Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"fecf4155-e173-4a70-9a4b-04b7437294e6","stage":"booking","correlationId":"booking-created:6797d8216039c86be1821175","attempts":1}
üìÖ Processing booking created for customer: 1CS3MY35Y6G59MFHGY5V7W5C88
Full booking data: {
  "id": "bxtrw6tyypk57m",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-01T20:00:00Z",
  "created_at": "2025-11-29T21:25:30Z",
  "updated_at": "2025-11-29T21:25:30Z",
  "customer_id": "1CS3MY35Y6G59MFHGY5V7W5C88",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMQPbDVvvOCLwqsy"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMyUMvTJIj2HrHSg",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "JMTK5M2CY2W7WEXSTAJKAJ35",
      "service_variation_version": 1762893947284,
      "service_variation_client_id": "JMTK5M2CY2W7WEXSTAJKAJ35"
    },
    {
      "resource_ids": [
        "KAOXILA4CV7A23VRAACC4R66"
      ],
      "team_member_id": "TMyUMvTJIj2HrHSg",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "63PG6RLS2NHWRD5JRXEC74HN",
      "service_variation_version": 1760895536505,
      "service_variation_client_id": "VZLZVOWNIEIWAQ47FX67GQS4"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Kristen Juntunen
üéâ First booking detected for customer: 1CS3MY35Y6G59MFHGY5V7W5C88
   Name: Kristen Juntunen
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 1CS3MY35Y6G59MFHGY5V7W5C88...
Error getting custom attributes for customer 1CS3MY35Y6G59MFHGY5V7W5C88: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 1CS3MY35Y6G59MFHGY5V7W5C88
{"ts":"2025-11-29T21:36:14.287Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"fecf4155-e173-4a70-9a4b-04b7437294e6","stage":"booking","correlationId":"booking-created:6797d8216039c86be1821175"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-11-29T21:54:09.847Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"2eda5b00-e629-4511-8320-8943aa039da8","stage":"payment","correlationId":"payment-updated:f32d42293e79ec30289bb2c4","attempts":1}
üí∞ Processing payment completion for customer: JHMTMS2Q6CCQGNGKF6DBHGYDWR
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Kamila Flores
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Kamila Flores, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Kamila Flores
   - Email: kamilafloresbarragan@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: JHMTMS2Q6CCQGNGKF6DBHGYDWR
{"ts":"2025-11-29T21:54:10.426Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"2eda5b00-e629-4511-8320-8943aa039da8","stage":"payment","correlationId":"payment-updated:f32d42293e79ec30289bb2c4"}
{"ts":"2025-11-29T21:54:10.589Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"17621451-70b6-4345-9e7c-d29723331afc","stage":"payment","correlationId":"payment-updated:de6bed4f602c5c402df528f6","attempts":1}
üí∞ Processing payment completion for customer: JHMTMS2Q6CCQGNGKF6DBHGYDWR
   Payment source_type: CARD
   Payment tender_types: []
Customer JHMTMS2Q6CCQGNGKF6DBHGYDWR already completed first payment
{"ts":"2025-11-29T21:54:10.782Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"17621451-70b6-4345-9e7c-d29723331afc","stage":"payment","correlationId":"payment-updated:de6bed4f602c5c402df528f6"}
{"ts":"2025-11-29T21:54:10.941Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"7a6899d3-44d0-4053-98d6-d842527f95e9","stage":"payment","correlationId":"payment-updated:53ce35c39ec1c736b271e815","attempts":1}
üí∞ Processing payment completion for customer: 4QV9HBRD6SY5F3ESB848T3W9HC
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Sophie Viaud
‚ùå Referrer not found for code: null
‚úÖ Generated new personal_code in name+ID format: SOPHIE4839
‚ùå Error creating/loading gift card for Sophie Viaud: Response status code was not ok: 401.
Square API errors: [
  {
    "category": "AUTHENTICATION_ERROR",
    "code": "UNAUTHORIZED",
    "detail": "This request could not be authorized."
  }
]
‚ùå Failed to create referrer gift card
Error upserting custom attribute "square:a3dde506-f69e-48e4-a98a-004c1822d3ad" for customer 4QV9HBRD6SY5F3ESB848T3W9HC: Response status code was not ok: 401.
Square API errors: [
  {
    "category": "AUTHENTICATION_ERROR",
    "code": "UNAUTHORIZED",
    "detail": "This request could not be authorized."
  }
]
Error appending referral note for customer 4QV9HBRD6SY5F3ESB848T3W9HC: Response status code was not ok: 401.
Square API errors: [
  {
    "category": "AUTHENTICATION_ERROR",
    "code": "UNAUTHORIZED",
    "detail": "This request could not be authorized."
  }
]
‚ùå Error sending referral email to sofy_vi@yahoo.fr: Unauthorized
SendGrid error details: {
  errors: [
    {
      message: 'The provided authorization grant is invalid, expired, or revoked',
      field: null,
      help: null
    }
  ]
}
‚ö†Ô∏è Analytics operation "notification_event" failed: 
Invalid `prisma.notificationEvent.create()` invocation in
/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/analytics-service.js:164:39

  161 return runAnalyticsOperation(
  162   'notification_event',
  163   async () => {
‚Üí 164     return prisma.notificationEvent.create({
            data: {
              channel: "EMAIL",
              templateType: "REFERRAL_INVITE",
              status: "failed",
              createdAt: new Date("2025-11-29T21:54:12.545Z"),
              errorCode: 401,
                         ~~~
              errorMessage: "Unauthorized",
              metadata: {
                email: "sofy_vi@yahoo.fr",
                referralCode: "SOPHIE4839",
                referralUrl: "https://referral-system-salon-fbbq6x1wt-umis-projects-e802f152.vercel.app/ref/SOPHIE4839",
                suppressionGroupId: 28008
              }
            }
          })

Argument `errorCode`: Invalid value provided. Expected String or Null, provided Int.
‚ùå Failed to send email: Unauthorized
‚ÑπÔ∏è SMS sending disabled. Would send referral link to +16194511948
‚è∏Ô∏è SMS sending disabled (skipped sending to +16194511948)
üìß Referral code generated and sent:
   - Customer: Sophie Viaud
   - Email: sofy_vi@yahoo.fr
   - Referral Code: SOPHIE4839
   - Referral URL: https://referral-system-salon-fbbq6x1wt-umis-projects-e802f152.vercel.app/ref/SOPHIE4839
   - Gift Card ID: null
   - Status: Customer is now a referrer
‚úÖ Referral code sent to new client:
   - Customer: Sophie Viaud
   - Email: sofy_vi@yahoo.fr
   - Referral Code: SOPHIE4839
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: 4QV9HBRD6SY5F3ESB848T3W9HC
{"ts":"2025-11-29T21:54:12.792Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"7a6899d3-44d0-4053-98d6-d842527f95e9","stage":"payment","correlationId":"payment-updated:53ce35c39ec1c736b271e815"}
{"ts":"2025-11-29T21:54:12.950Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"04a618fb-6691-40fa-b8e6-527ea24f377d","stage":"payment","correlationId":"payment-updated:dd8b9c1b4940b6bec6ffb4c2","attempts":1}
üí∞ Processing payment completion for customer: 4QV9HBRD6SY5F3ESB848T3W9HC
   Payment source_type: CARD
   Payment tender_types: []
Customer 4QV9HBRD6SY5F3ESB848T3W9HC already completed first payment
{"ts":"2025-11-29T21:54:13.085Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"04a618fb-6691-40fa-b8e6-527ea24f377d","stage":"payment","correlationId":"payment-updated:dd8b9c1b4940b6bec6ffb4c2"}
{"ts":"2025-11-29T21:54:13.246Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"4ea57282-ec9c-47e8-ba67-2fccbbec2537","stage":"payment","correlationId":"payment-updated:9eca1f1f92c2a76050a92905","attempts":1}
üí∞ Processing payment completion for customer: 5T9XNDW68D7XSDMYRQAMVNXZCR
   Payment source_type: CARD
   Payment tender_types: []
Customer 5T9XNDW68D7XSDMYRQAMVNXZCR already completed first payment
{"ts":"2025-11-29T21:54:13.386Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"4ea57282-ec9c-47e8-ba67-2fccbbec2537","stage":"payment","correlationId":"payment-updated:9eca1f1f92c2a76050a92905"}
{"ts":"2025-11-29T21:54:13.544Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"8ad7aa60-09ec-41be-84f2-100ef58adc40","stage":"payment","correlationId":"payment-updated:cb9303d3fc57eac836189cf4","attempts":1}
üí∞ Processing payment completion for customer: 5T9XNDW68D7XSDMYRQAMVNXZCR
   Payment source_type: CARD
   Payment tender_types: []
Customer 5T9XNDW68D7XSDMYRQAMVNXZCR already completed first payment
{"ts":"2025-11-29T21:54:13.683Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"8ad7aa60-09ec-41be-84f2-100ef58adc40","stage":"payment","correlationId":"payment-updated:cb9303d3fc57eac836189cf4"}
{"ts":"2025-11-29T22:09:21.384Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Server has closed the connection.","stack":"PrismaClientKnownRequestError: Server has closed the connection.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-11-29T22:09:24.510Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"cc2dd1f7-f959-45e9-a1c2-bbb1dd76e6d3","stage":"booking","correlationId":"booking-created:d87d18770e23ed6444eced74","attempts":1}
üìÖ Processing booking created for customer: 5QQ686H5A1K0KTXTYDSPCBAEY8
Full booking data: {
  "id": "7vaug7rojnb9pp",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-15T17:00:00Z",
  "created_at": "2025-11-29T21:44:55Z",
  "updated_at": "2025-11-29T21:44:55Z",
  "customer_id": "5QQ686H5A1K0KTXTYDSPCBAEY8",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "5QQ686H5A1K0KTXTYDSPCBAEY8",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMMHlgFBIFbMTRap",
      "any_team_member": false,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    },
    {
      "team_member_id": "TMMHlgFBIFbMTRap",
      "any_team_member": false,
      "duration_minutes": 20,
      "intermission_minutes": 0,
      "service_variation_id": "HAJX45W3U2WUCCXM5MI24UEE",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "HAJX45W3U2WUCCXM5MI24UEE"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Aisha Saeed
üéâ First booking detected for customer: 5QQ686H5A1K0KTXTYDSPCBAEY8
   Name: Aisha Saeed
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 5QQ686H5A1K0KTXTYDSPCBAEY8...
Error getting custom attributes for customer 5QQ686H5A1K0KTXTYDSPCBAEY8: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 5QQ686H5A1K0KTXTYDSPCBAEY8
{"ts":"2025-11-29T22:09:25.215Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"cc2dd1f7-f959-45e9-a1c2-bbb1dd76e6d3","stage":"booking","correlationId":"booking-created:d87d18770e23ed6444eced74"}
{"ts":"2025-11-29T22:09:25.378Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"6d9a36a9-e660-4068-8165-e49a18127079","stage":"payment","correlationId":"payment-updated:f3826b83cdf1d6c1bbd0af26","attempts":1}
üí∞ Processing payment completion for customer: BXW6VGGTGMBRBKRDDPNZFGFSRR
   Payment source_type: CARD
   Payment tender_types: []
Customer BXW6VGGTGMBRBKRDDPNZFGFSRR already completed first payment
{"ts":"2025-11-29T22:09:25.531Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"6d9a36a9-e660-4068-8165-e49a18127079","stage":"payment","correlationId":"payment-updated:f3826b83cdf1d6c1bbd0af26"}
{"ts":"2025-11-29T22:09:25.693Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"3dbe3e19-e9ec-495d-9770-944b86e00ec0","stage":"payment","correlationId":"payment-updated:a736065d8fe9c1340353f763","attempts":1}
Error processing payment completion: Error: Connection terminated unexpectedly
    at /Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@neondatabase/serverless/index.js:1345:74
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async PrismaNeon.performIO (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/adapter-neon/dist/index.js:427:22)
    at async PrismaNeon.queryRaw (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/adapter-neon/dist/index.js:384:17)
    at async /Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:29:14083 {
  clientVersion: '5.22.0'
}
{"ts":"2025-11-29T22:17:41.969Z","level":"error","event":"giftcard.worker.job.failed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"3dbe3e19-e9ec-495d-9770-944b86e00ec0","stage":"payment","correlationId":"payment-updated:a736065d8fe9c1340353f763","attempts":1,"error":"Connection terminated unexpectedly"}
{"ts":"2025-11-29T22:17:42.000Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"\nInvalid `prisma.$queryRaw()` invocation:\n\n\nServer has closed the connection.","stack":"PrismaClientKnownRequestError: \nInvalid `prisma.$queryRaw()` invocation:\n\n\nServer has closed the connection.\n    at $n.handleRequestError (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:121:7315)\n    at $n.handleAndLogRequestError (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:121:6623)\n    at $n.request (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:121:6307)\n    at async l (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:9633)\n    at async updateGiftCardRunStage (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/runs/giftcard-run-tracker.js:330:18)\n    at async markGiftCardRunError (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/runs/giftcard-run-tracker.js:364:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:133:9)"}
{"ts":"2025-11-29T22:17:44.707Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"5620be58-da83-43a7-ba89-e703af5d8c6d","stage":"payment","correlationId":"payment-updated:5838dda59c29c77fdacb61b7","attempts":1}
üí∞ Processing payment completion for customer: BXW6VGGTGMBRBKRDDPNZFGFSRR
   Payment source_type: CARD
   Payment tender_types: []
Customer BXW6VGGTGMBRBKRDDPNZFGFSRR already completed first payment
{"ts":"2025-11-29T22:17:44.935Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"5620be58-da83-43a7-ba89-e703af5d8c6d","stage":"payment","correlationId":"payment-updated:5838dda59c29c77fdacb61b7"}
{"ts":"2025-11-29T22:17:45.090Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"dc731788-f5ee-4f37-bd12-b812120d0a7a","stage":"payment","correlationId":"payment-updated:a68fde531aa563767746764a","attempts":1}
üí∞ Processing payment completion for customer: BXW6VGGTGMBRBKRDDPNZFGFSRR
   Payment source_type: CARD
   Payment tender_types: []
Customer BXW6VGGTGMBRBKRDDPNZFGFSRR already completed first payment
{"ts":"2025-11-29T22:17:45.227Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"dc731788-f5ee-4f37-bd12-b812120d0a7a","stage":"payment","correlationId":"payment-updated:a68fde531aa563767746764a"}
{"ts":"2025-11-29T22:17:45.387Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"9e0765cb-a890-4dd0-bec5-f3507255fd0c","stage":"booking","correlationId":"booking-created:8a6cc9541fe31f3da01fd61f","attempts":1}
üìÖ Processing booking created for customer: SMR44PGNQGG3VZ831QS25TP17M
Full booking data: {
  "id": "c62g9pb73c50fq",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-11-30T20:20:00Z",
  "created_at": "2025-11-29T21:54:00Z",
  "updated_at": "2025-11-29T21:54:00Z",
  "customer_id": "SMR44PGNQGG3VZ831QS25TP17M",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "SMR44PGNQGG3VZ831QS25TP17M",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMe-bT5XxKxmk0nw",
      "any_team_member": true,
      "duration_minutes": 140,
      "intermission_minutes": 0,
      "service_variation_id": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "CJI5WHOAKSFTASYPJ4MSYZLS"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 0 customer(s) in database
‚ÑπÔ∏è Customer SMR44PGNQGG3VZ831QS25TP17M not in database yet - need to add them first
‚ùå Error fetching/adding customer from Square: Response status code was not ok: 401.
{"ts":"2025-11-29T22:17:45.760Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"9e0765cb-a890-4dd0-bec5-f3507255fd0c","stage":"booking","correlationId":"booking-created:8a6cc9541fe31f3da01fd61f"}
{"ts":"2025-11-29T22:17:45.919Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"17b501b6-5265-4e05-88f9-c5441602e881","stage":"customer_ingest","correlationId":"customer-created:139c2624051e543f9d5d0e19","attempts":1}
üì• Received customer data: {
  "id": "SMR44PGNQGG3VZ831QS25TP17M",
  "address": {
    "country": "US"
  },
  "version": 1,
  "group_ids": [
    "LT4ZHFBQQYB2N.APPOINTMENTS"
  ],
  "created_at": "2025-11-29T21:53:58.255Z",
  "given_name": "Megan",
  "updated_at": "2025-11-29T21:54:00Z",
  "family_name": "Mathews",
  "preferences": {
    "email_unsubscribed": false
  },
  "phone_number": "(925) 640-4873",
  "email_address": "meganrmathews1@gmail.com",
  "creation_source": "APPOINTMENTS"
}
üë§ Processing customer creation: SMR44PGNQGG3VZ831QS25TP17M
üìç IP Address: unknown
üìß Email: meganrmathews1@gmail.com
üìû Phone: (925) 640-4873
üë§ Name: Megan Mathews
‚ö†Ô∏è Suspicious IP activity detected: unknown used by 105 customers
‚ö†Ô∏è Suspicious activity detected for customer SMR44PGNQGG3VZ831QS25TP17M, flagging for review
üéâ New customer detected: SMR44PGNQGG3VZ831QS25TP17M
‚úÖ Customer added to database as NEW (temporary mark)
   - Will check for referral code when they book
   - Will give gift card on first booking if code found
‚úÖ Verification: Customer found in DB: true
{"ts":"2025-11-29T22:17:46.274Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"17b501b6-5265-4e05-88f9-c5441602e881","stage":"customer_ingest","correlationId":"customer-created:139c2624051e543f9d5d0e19"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-11-29T22:34:17.145Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"63be935c-a206-4f40-a4b7-df6369f4c4ad","stage":"booking","correlationId":"booking-created:d9cc83cb2d9d151e1a3f33a7","attempts":1}
üìÖ Processing booking created for customer: HN6QJCDYGEXWQ6FJTTF1TDMTKR
Full booking data: {
  "id": "12n8wkh34x9mk5",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-13T20:00:00Z",
  "created_at": "2025-11-29T22:18:51Z",
  "updated_at": "2025-11-29T22:18:51Z",
  "customer_id": "HN6QJCDYGEXWQ6FJTTF1TDMTKR",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "HN6QJCDYGEXWQ6FJTTF1TDMTKR",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMXiw38Bbb7XQUWI",
      "any_team_member": true,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Amy Carter
üéâ First booking detected for customer: HN6QJCDYGEXWQ6FJTTF1TDMTKR
   Name: Amy Carter
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer HN6QJCDYGEXWQ6FJTTF1TDMTKR...
Error getting custom attributes for customer HN6QJCDYGEXWQ6FJTTF1TDMTKR: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: HN6QJCDYGEXWQ6FJTTF1TDMTKR
{"ts":"2025-11-29T22:34:17.885Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"63be935c-a206-4f40-a4b7-df6369f4c4ad","stage":"booking","correlationId":"booking-created:d9cc83cb2d9d151e1a3f33a7"}
{"ts":"2025-11-29T22:34:18.046Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"ab5d27fe-1b40-4c50-85a2-502b16be3bb7","stage":"booking","correlationId":"booking-created:14c9f003984464768298b2fe","attempts":1}
üìÖ Processing booking created for customer: HN6QJCDYGEXWQ6FJTTF1TDMTKR
Full booking data: {
  "id": "48sb2jy511yr75",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-12T21:30:00Z",
  "created_at": "2025-11-29T22:22:20Z",
  "updated_at": "2025-11-29T22:22:20Z",
  "customer_id": "HN6QJCDYGEXWQ6FJTTF1TDMTKR",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "HN6QJCDYGEXWQ6FJTTF1TDMTKR",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMNW4SIF7tjp4oM_",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "BRSIGZFOWC6F4ERPKX3CODLU",
      "service_variation_version": 1764191999049,
      "service_variation_client_id": "BRSIGZFOWC6F4ERPKX3CODLU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Amy Carter
üéâ First booking detected for customer: HN6QJCDYGEXWQ6FJTTF1TDMTKR
   Name: Amy Carter
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer HN6QJCDYGEXWQ6FJTTF1TDMTKR...
Error getting custom attributes for customer HN6QJCDYGEXWQ6FJTTF1TDMTKR: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: HN6QJCDYGEXWQ6FJTTF1TDMTKR
{"ts":"2025-11-29T22:34:18.432Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"ab5d27fe-1b40-4c50-85a2-502b16be3bb7","stage":"booking","correlationId":"booking-created:14c9f003984464768298b2fe"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-11-29T23:07:29.936Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"f51d1492-df35-4c0d-9dcc-59588eeb124f","stage":"payment","correlationId":"payment-updated:7d197854443f603a5fd6891b","attempts":1}
üí∞ Processing payment completion for customer: G6YKBJHY961703VT5ZWKFHGX80
   Payment source_type: CARD
   Payment tender_types: []
Customer G6YKBJHY961703VT5ZWKFHGX80 already completed first payment
{"ts":"2025-11-29T23:07:30.351Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"f51d1492-df35-4c0d-9dcc-59588eeb124f","stage":"payment","correlationId":"payment-updated:7d197854443f603a5fd6891b"}
{"ts":"2025-11-29T23:07:30.514Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"89c13e42-b358-483d-96e8-d4a9e3d7acc2","stage":"payment","correlationId":"payment-updated:419610852af5825bef5e3850","attempts":1}
üí∞ Processing payment completion for customer: G6YKBJHY961703VT5ZWKFHGX80
   Payment source_type: CARD
   Payment tender_types: []
Customer G6YKBJHY961703VT5ZWKFHGX80 already completed first payment
{"ts":"2025-11-29T23:07:30.647Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"89c13e42-b358-483d-96e8-d4a9e3d7acc2","stage":"payment","correlationId":"payment-updated:419610852af5825bef5e3850"}
{"ts":"2025-11-29T23:07:30.807Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"0d05bb2a-308d-4b4d-baec-1e20875834b2","stage":"booking","correlationId":"booking-created:f2ddb33b4a7123367b3b80e1","attempts":1}
üìÖ Processing booking created for customer: 1GEWF9RDX15317SDX1QEPKGPCM
Full booking data: {
  "id": "ksyzs94acb9c3k",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-11-29T19:00:00Z",
  "created_at": "2025-11-29T22:56:27Z",
  "updated_at": "2025-11-29T22:56:27Z",
  "customer_id": "1GEWF9RDX15317SDX1QEPKGPCM",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMWAtQTYmZpwwxii"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMdagA6g0F03A7_w",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "M4MB45QONRA5NMLH7DSITV35",
      "service_variation_version": 1762374620368,
      "service_variation_client_id": "M4MB45QONRA5NMLH7DSITV35"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Rebecca McCormack
üéâ First booking detected for customer: 1GEWF9RDX15317SDX1QEPKGPCM
   Name: Rebecca McCormack
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 1GEWF9RDX15317SDX1QEPKGPCM...
Error getting custom attributes for customer 1GEWF9RDX15317SDX1QEPKGPCM: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 1GEWF9RDX15317SDX1QEPKGPCM
{"ts":"2025-11-29T23:07:31.216Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"0d05bb2a-308d-4b4d-baec-1e20875834b2","stage":"booking","correlationId":"booking-created:f2ddb33b4a7123367b3b80e1"}
{"ts":"2025-11-29T23:07:31.373Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"d29099ff-7ca2-426d-9c51-36070b793502","stage":"payment","correlationId":"payment-updated:3a17d7080f65095223dfee33","attempts":1}
üí∞ Processing payment completion for customer: 1GEWF9RDX15317SDX1QEPKGPCM
   Payment source_type: CASH
   Payment tender_types: []
Customer 1GEWF9RDX15317SDX1QEPKGPCM already completed first payment
{"ts":"2025-11-29T23:07:31.506Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"d29099ff-7ca2-426d-9c51-36070b793502","stage":"payment","correlationId":"payment-updated:3a17d7080f65095223dfee33"}
{"ts":"2025-11-29T23:07:31.663Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"799d9956-40fe-4483-8111-f163e85ebaf2","stage":"payment","correlationId":"payment-updated:270ca30f60259928ffe43cd4","attempts":1}
üí∞ Processing payment completion for customer: 1GEWF9RDX15317SDX1QEPKGPCM
   Payment source_type: CASH
   Payment tender_types: []
Customer 1GEWF9RDX15317SDX1QEPKGPCM already completed first payment
{"ts":"2025-11-29T23:07:31.795Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"799d9956-40fe-4483-8111-f163e85ebaf2","stage":"payment","correlationId":"payment-updated:270ca30f60259928ffe43cd4"}
{"ts":"2025-11-29T23:07:31.957Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"03d89a11-0ee3-422d-a6eb-40aa935cec8c","stage":"payment","correlationId":"payment-updated:c011bbe240a8075a336d638d","attempts":1}
üí∞ Processing payment completion for customer: XAVABFB0ESQ7ATBN08FAQDPYAM
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Alyssa Chionglo
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Alyssa Chionglo, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Alyssa Chionglo
   - Email: alyssa.chionglo.uh@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: XAVABFB0ESQ7ATBN08FAQDPYAM
{"ts":"2025-11-29T23:07:32.308Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"03d89a11-0ee3-422d-a6eb-40aa935cec8c","stage":"payment","correlationId":"payment-updated:c011bbe240a8075a336d638d"}
{"ts":"2025-11-29T23:07:32.511Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"40b7bc80-1133-4414-9e81-5dd878d84940","stage":"payment","correlationId":"payment-updated:c15e67fa39c7f046d8562ecb","attempts":1}
üí∞ Processing payment completion for customer: XAVABFB0ESQ7ATBN08FAQDPYAM
   Payment source_type: CARD
   Payment tender_types: []
Customer XAVABFB0ESQ7ATBN08FAQDPYAM already completed first payment
{"ts":"2025-11-29T23:07:32.647Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"40b7bc80-1133-4414-9e81-5dd878d84940","stage":"payment","correlationId":"payment-updated:c15e67fa39c7f046d8562ecb"}
{"ts":"2025-11-29T23:07:32.815Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"cb7b792a-c1a1-4af6-acfe-ad2c4bb17dfe","stage":"payment","correlationId":"payment-updated:155e03e6198001c49f76102a","attempts":1}
üí∞ Processing payment completion for customer: 20T3NEX3996H7A53RB7XV4AHAW
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Valerie Usmanova
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Valerie Usmanova, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Valerie Usmanova
   - Email: vnurieva@nes.ru
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: 20T3NEX3996H7A53RB7XV4AHAW
{"ts":"2025-11-29T23:07:33.128Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"cb7b792a-c1a1-4af6-acfe-ad2c4bb17dfe","stage":"payment","correlationId":"payment-updated:155e03e6198001c49f76102a"}
{"ts":"2025-11-29T23:07:33.293Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"984bee58-5563-403a-9df1-b1baf80e1ad6","stage":"payment","correlationId":"payment-updated:6d1f7384034bbd81e169ad70","attempts":1}
üí∞ Processing payment completion for customer: 20T3NEX3996H7A53RB7XV4AHAW
   Payment source_type: CARD
   Payment tender_types: []
Customer 20T3NEX3996H7A53RB7XV4AHAW already completed first payment
{"ts":"2025-11-29T23:07:33.435Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"984bee58-5563-403a-9df1-b1baf80e1ad6","stage":"payment","correlationId":"payment-updated:6d1f7384034bbd81e169ad70"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-11-29T23:18:41.928Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"9fd291ea-85df-4baf-bdc1-eb8dcc2f605a","stage":"booking","correlationId":"booking-created:47cf838e1514e20851395a53","attempts":1}
üìÖ Processing booking created for customer: TW2JEF01FA528FW9B11ZV58YF8
Full booking data: {
  "id": "iaujlkd3166g29",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-11-30T22:00:00Z",
  "created_at": "2025-11-29T23:08:27Z",
  "updated_at": "2025-11-29T23:08:27Z",
  "customer_id": "TW2JEF01FA528FW9B11ZV58YF8",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMWAtQTYmZpwwxii"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMEWAZHdtaiRR_Zs",
      "any_team_member": false,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Brittany Helm
üéâ First booking detected for customer: TW2JEF01FA528FW9B11ZV58YF8
   Name: Brittany Helm
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer TW2JEF01FA528FW9B11ZV58YF8...
Error getting custom attributes for customer TW2JEF01FA528FW9B11ZV58YF8: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: TW2JEF01FA528FW9B11ZV58YF8
{"ts":"2025-11-29T23:18:42.598Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"9fd291ea-85df-4baf-bdc1-eb8dcc2f605a","stage":"booking","correlationId":"booking-created:47cf838e1514e20851395a53"}
{"ts":"2025-11-29T23:18:42.754Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"9a378ef4-83ff-4c48-9628-e8f233c68957","stage":"booking","correlationId":"booking-created:b0208b2fdc1dd9239d6cde8d","attempts":1}
üìÖ Processing booking created for customer: 9346KFBJCMQM6441TJYVJK18H0
Full booking data: {
  "id": "cx9d8u1z32ah5l",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-04T00:00:00Z",
  "created_at": "2025-11-29T23:09:53Z",
  "updated_at": "2025-11-29T23:09:53Z",
  "customer_id": "9346KFBJCMQM6441TJYVJK18H0",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "9346KFBJCMQM6441TJYVJK18H0",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMMCVDJoKh3ZkfFo",
      "any_team_member": true,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "HXLBKQC3DRE57DB7IK5RBYOB",
      "service_variation_version": 1758654327496,
      "service_variation_client_id": "HXLBKQC3DRE57DB7IK5RBYOB"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Adlon Adams
üéâ First booking detected for customer: 9346KFBJCMQM6441TJYVJK18H0
   Name: Adlon Adams
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 9346KFBJCMQM6441TJYVJK18H0...
Error getting custom attributes for customer 9346KFBJCMQM6441TJYVJK18H0: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 9346KFBJCMQM6441TJYVJK18H0
{"ts":"2025-11-29T23:18:43.153Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"9a378ef4-83ff-4c48-9628-e8f233c68957","stage":"booking","correlationId":"booking-created:b0208b2fdc1dd9239d6cde8d"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-11-29T23:37:05.335Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"1ac1806e-a252-4334-9465-bf0fbe3c9816","stage":"booking","correlationId":"booking-created:060b3a56ccb2dcdece4477a9","attempts":1}
üìÖ Processing booking created for customer: ZRCDXYKX325WFF247E2DMQ48T0
Full booking data: {
  "id": "zquknyyrw3g3gf",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-23T22:00:00Z",
  "created_at": "2025-11-29T23:22:13Z",
  "updated_at": "2025-11-29T23:22:13Z",
  "customer_id": "ZRCDXYKX325WFF247E2DMQ48T0",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "ZRCDXYKX325WFF247E2DMQ48T0",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMILsQUVwLkLzbVo",
      "any_team_member": false,
      "duration_minutes": 100,
      "intermission_minutes": 0,
      "service_variation_id": "BM556FTNFOTEHYVG4GPXAXFM",
      "service_variation_version": 1764191999049,
      "service_variation_client_id": "BM556FTNFOTEHYVG4GPXAXFM"
    },
    {
      "team_member_id": "TMILsQUVwLkLzbVo",
      "any_team_member": false,
      "duration_minutes": 20,
      "intermission_minutes": 0,
      "service_variation_id": "HAJX45W3U2WUCCXM5MI24UEE",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "HAJX45W3U2WUCCXM5MI24UEE"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Maral Amir
üéâ First booking detected for customer: ZRCDXYKX325WFF247E2DMQ48T0
   Name: Maral Amir
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer ZRCDXYKX325WFF247E2DMQ48T0...
Error getting custom attributes for customer ZRCDXYKX325WFF247E2DMQ48T0: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: ZRCDXYKX325WFF247E2DMQ48T0
{"ts":"2025-11-29T23:37:06.086Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"1ac1806e-a252-4334-9465-bf0fbe3c9816","stage":"booking","correlationId":"booking-created:060b3a56ccb2dcdece4477a9"}
{"ts":"2025-11-29T23:37:06.244Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"c154e433-7272-40d5-b16d-130d18fda2db","stage":"booking","correlationId":"booking-created:af7474c56f84063d97ef7bb5","attempts":1}
üìÖ Processing booking created for customer: YCVAFVPN1W5YDYW9T4AE3P2MHR
Full booking data: {
  "id": "l37221mcxv22ad",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-11-30T21:40:00Z",
  "created_at": "2025-11-29T23:23:48Z",
  "updated_at": "2025-11-29T23:23:48Z",
  "customer_id": "YCVAFVPN1W5YDYW9T4AE3P2MHR",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "YCVAFVPN1W5YDYW9T4AE3P2MHR",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMNW4SIF7tjp4oM_",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "BRSIGZFOWC6F4ERPKX3CODLU",
      "service_variation_version": 1764191999049,
      "service_variation_client_id": "BRSIGZFOWC6F4ERPKX3CODLU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Catherine Ladd
üéâ First booking detected for customer: YCVAFVPN1W5YDYW9T4AE3P2MHR
   Name: Catherine Ladd
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer YCVAFVPN1W5YDYW9T4AE3P2MHR...
Error getting custom attributes for customer YCVAFVPN1W5YDYW9T4AE3P2MHR: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: YCVAFVPN1W5YDYW9T4AE3P2MHR
{"ts":"2025-11-29T23:37:06.628Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"c154e433-7272-40d5-b16d-130d18fda2db","stage":"booking","correlationId":"booking-created:af7474c56f84063d97ef7bb5"}
{"ts":"2025-11-29T23:37:06.785Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"2a0fd3a2-da99-4a2b-8824-b13be5d3b008","stage":"payment","correlationId":"payment-updated:2b32484fa2a296b7d65d50b9","attempts":1}
üí∞ Processing payment completion for customer: HNF0R9FVTTW27X2N2QT30YFQ9M
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Corinne Shields
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Corinne Shields, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Corinne Shields
   - Email: corinnegshields@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: HNF0R9FVTTW27X2N2QT30YFQ9M
{"ts":"2025-11-29T23:37:07.111Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"2a0fd3a2-da99-4a2b-8824-b13be5d3b008","stage":"payment","correlationId":"payment-updated:2b32484fa2a296b7d65d50b9"}
{"ts":"2025-11-29T23:37:07.270Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"f51a262a-fa5c-44a1-9e27-1904f1bbaba9","stage":"payment","correlationId":"payment-updated:8b0efbc1efb9e029a6070ad6","attempts":1}
üí∞ Processing payment completion for customer: HNF0R9FVTTW27X2N2QT30YFQ9M
   Payment source_type: CARD
   Payment tender_types: []
Customer HNF0R9FVTTW27X2N2QT30YFQ9M already completed first payment
{"ts":"2025-11-29T23:37:07.406Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"f51a262a-fa5c-44a1-9e27-1904f1bbaba9","stage":"payment","correlationId":"payment-updated:8b0efbc1efb9e029a6070ad6"}
{"ts":"2025-11-29T23:50:23.336Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"dd42d86d-ad4c-46b6-9e09-76fb5b4f6bb5","stage":"booking","correlationId":"booking-created:7ce279d91f945542d439436e","attempts":1}
üìÖ Processing booking created for customer: D2EP8H5C7CNZ90KJPFMDKKG8GR
Full booking data: {
  "id": "60t44oj1vedt15",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-12T17:00:00Z",
  "created_at": "2025-11-29T23:38:54Z",
  "updated_at": "2025-11-29T23:38:54Z",
  "customer_id": "D2EP8H5C7CNZ90KJPFMDKKG8GR",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "D2EP8H5C7CNZ90KJPFMDKKG8GR",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMyUMvTJIj2HrHSg",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "JMTK5M2CY2W7WEXSTAJKAJ35",
      "service_variation_version": 1764191999049,
      "service_variation_client_id": "JMTK5M2CY2W7WEXSTAJKAJ35"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Jennifer Wright
üéâ First booking detected for customer: D2EP8H5C7CNZ90KJPFMDKKG8GR
   Name: Jennifer Wright
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer D2EP8H5C7CNZ90KJPFMDKKG8GR...
Error getting custom attributes for customer D2EP8H5C7CNZ90KJPFMDKKG8GR: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: D2EP8H5C7CNZ90KJPFMDKKG8GR
{"ts":"2025-11-29T23:50:24.113Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"dd42d86d-ad4c-46b6-9e09-76fb5b4f6bb5","stage":"booking","correlationId":"booking-created:7ce279d91f945542d439436e"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-11-30T00:36:15.401Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"7c294455-645e-4494-b207-1efaa0dd935a","stage":"payment","correlationId":"payment-updated:9c5ae000c27f4679aa5584d5","attempts":1}
üí∞ Processing payment completion for customer: VX4W3SJ6RTFDRQNK1TZJC1T19G
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Monica Everett
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Monica Everett, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Monica Everett
   - Email: Monicaa.everettt@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: VX4W3SJ6RTFDRQNK1TZJC1T19G
{"ts":"2025-11-30T00:36:16.002Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"7c294455-645e-4494-b207-1efaa0dd935a","stage":"payment","correlationId":"payment-updated:9c5ae000c27f4679aa5584d5"}
{"ts":"2025-11-30T00:36:16.166Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"bdd3a2db-82a5-4269-aeb2-835bb99fa28c","stage":"payment","correlationId":"payment-updated:6017b0d87148bfe58cbbe2de","attempts":1}
üí∞ Processing payment completion for customer: VX4W3SJ6RTFDRQNK1TZJC1T19G
   Payment source_type: CARD
   Payment tender_types: []
Customer VX4W3SJ6RTFDRQNK1TZJC1T19G already completed first payment
{"ts":"2025-11-30T00:36:16.304Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"bdd3a2db-82a5-4269-aeb2-835bb99fa28c","stage":"payment","correlationId":"payment-updated:6017b0d87148bfe58cbbe2de"}
{"ts":"2025-11-30T00:36:16.470Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"840e9283-1ed6-436a-b317-8a7aaa842787","stage":"payment","correlationId":"payment-updated:d1648655715c9cc78c8ce467","attempts":1}
üí∞ Processing payment completion for customer: 018GF1W55VG4BSBZKZXBSED3NR
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Devon Acosta
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Devon Acosta, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Devon Acosta
   - Email: dlacosta703@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: 018GF1W55VG4BSBZKZXBSED3NR
{"ts":"2025-11-30T00:36:16.796Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"840e9283-1ed6-436a-b317-8a7aaa842787","stage":"payment","correlationId":"payment-updated:d1648655715c9cc78c8ce467"}
{"ts":"2025-11-30T00:36:17.209Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"d190af21-8bfb-4b71-8ebf-486e0c832d6d","stage":"payment","correlationId":"payment-updated:20dcc88d9d3153034569c03a","attempts":1}
üí∞ Processing payment completion for customer: 018GF1W55VG4BSBZKZXBSED3NR
   Payment source_type: CARD
   Payment tender_types: []
Customer 018GF1W55VG4BSBZKZXBSED3NR already completed first payment
{"ts":"2025-11-30T00:36:17.346Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"d190af21-8bfb-4b71-8ebf-486e0c832d6d","stage":"payment","correlationId":"payment-updated:20dcc88d9d3153034569c03a"}
{"ts":"2025-11-30T00:36:17.506Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"e79be22d-fe4e-4c3d-84fc-322d81b7281c","stage":"booking","correlationId":"booking-created:2d78acf4812b6593acb32904","attempts":1}
üìÖ Processing booking created for customer: TE85QP9QYNHGGQ19T137CMP9CG
Full booking data: {
  "id": "yfvma0befqp099",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-14T19:30:00Z",
  "created_at": "2025-11-30T00:26:56Z",
  "updated_at": "2025-11-30T00:26:56Z",
  "customer_id": "TE85QP9QYNHGGQ19T137CMP9CG",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "TE85QP9QYNHGGQ19T137CMP9CG",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TM7_r-KmvY9xjnEU",
      "any_team_member": false,
      "duration_minutes": 110,
      "intermission_minutes": 0,
      "service_variation_id": "GJ5SRTYFV6ZCDI62TMSZP2OP",
      "service_variation_version": 1764191999049,
      "service_variation_client_id": "GJ5SRTYFV6ZCDI62TMSZP2OP"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Niki Kalergis
üéâ First booking detected for customer: TE85QP9QYNHGGQ19T137CMP9CG
   Name: Niki Kalergis
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer TE85QP9QYNHGGQ19T137CMP9CG...
Error getting custom attributes for customer TE85QP9QYNHGGQ19T137CMP9CG: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: TE85QP9QYNHGGQ19T137CMP9CG
{"ts":"2025-11-30T00:36:17.959Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"e79be22d-fe4e-4c3d-84fc-322d81b7281c","stage":"booking","correlationId":"booking-created:2d78acf4812b6593acb32904"}
{"ts":"2025-11-30T00:36:18.122Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"8cccee6a-481c-4dbc-9306-1c7ae6a55cc9","stage":"payment","correlationId":"payment-updated:18745f2d1aeb59edb5113749","attempts":1}
üí∞ Processing payment completion for customer: 8591EDHVQ1DAZNRPFPZ74KCNKW
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Sophia Duong
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Sophia Duong, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Sophia Duong
   - Email: sophiaduongg@yahoo.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: 8591EDHVQ1DAZNRPFPZ74KCNKW
{"ts":"2025-11-30T00:36:18.437Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"8cccee6a-481c-4dbc-9306-1c7ae6a55cc9","stage":"payment","correlationId":"payment-updated:18745f2d1aeb59edb5113749"}
{"ts":"2025-11-30T00:36:18.603Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"72902e49-cee0-45cd-9560-df64e8b16177","stage":"payment","correlationId":"payment-updated:ce94481b2e8cba2b24497a37","attempts":1}
üí∞ Processing payment completion for customer: 8591EDHVQ1DAZNRPFPZ74KCNKW
   Payment source_type: CARD
   Payment tender_types: []
Customer 8591EDHVQ1DAZNRPFPZ74KCNKW already completed first payment
{"ts":"2025-11-30T00:36:18.756Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"72902e49-cee0-45cd-9560-df64e8b16177","stage":"payment","correlationId":"payment-updated:ce94481b2e8cba2b24497a37"}
{"ts":"2025-11-30T00:53:41.283Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Server has closed the connection.","stack":"PrismaClientKnownRequestError: Server has closed the connection.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-11-30T00:53:44.605Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"0a25f2a9-e209-4fab-966a-8a8dce325f94","stage":"payment","correlationId":"payment-updated:c42247808b16d632f21487a7","attempts":1}
üí∞ Processing payment completion for customer: 8591EDHVQ1DAZNRPFPZ74KCNKW
   Payment source_type: CARD
   Payment tender_types: []
Customer 8591EDHVQ1DAZNRPFPZ74KCNKW already completed first payment
{"ts":"2025-11-30T00:53:45.026Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"0a25f2a9-e209-4fab-966a-8a8dce325f94","stage":"payment","correlationId":"payment-updated:c42247808b16d632f21487a7"}
{"ts":"2025-11-30T00:53:45.186Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"03055787-7463-4168-9aed-59b80d34f8bb","stage":"payment","correlationId":"payment-updated:00982a87dd9a1da293e13cba","attempts":1}
üí∞ Processing payment completion for customer: 8591EDHVQ1DAZNRPFPZ74KCNKW
   Payment source_type: CARD
   Payment tender_types: []
Customer 8591EDHVQ1DAZNRPFPZ74KCNKW already completed first payment
{"ts":"2025-11-30T00:53:45.329Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"03055787-7463-4168-9aed-59b80d34f8bb","stage":"payment","correlationId":"payment-updated:00982a87dd9a1da293e13cba"}
{"ts":"2025-11-30T00:53:45.486Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"246beaa7-b3c4-4052-9562-3b43fe973366","stage":"customer_ingest","correlationId":"customer-created:445a33e1f4209e6df8e74182","attempts":1}
üì• Received customer data: {
  "id": "70C7YJKVWF94CBYB1XBB0KGQPC",
  "address": {
    "country": "US"
  },
  "version": 0,
  "group_ids": [
    "LT4ZHFBQQYB2N.APPOINTMENTS"
  ],
  "created_at": "2025-11-30T00:41:25.236Z",
  "given_name": "Katelyn",
  "updated_at": "2025-11-30T00:41:25Z",
  "family_name": "McLaughlin",
  "preferences": {
    "email_unsubscribed": false
  },
  "phone_number": "+15095911725",
  "email_address": "katelyn.mclaughlin24@gmail.com",
  "creation_source": "APPOINTMENTS"
}
üë§ Processing customer creation: 70C7YJKVWF94CBYB1XBB0KGQPC
üìç IP Address: unknown
üìß Email: katelyn.mclaughlin24@gmail.com
üìû Phone: +15095911725
üë§ Name: Katelyn McLaughlin
‚ö†Ô∏è Suspicious IP activity detected: unknown used by 106 customers
‚ö†Ô∏è Suspicious activity detected for customer 70C7YJKVWF94CBYB1XBB0KGQPC, flagging for review
üéâ New customer detected: 70C7YJKVWF94CBYB1XBB0KGQPC
‚úÖ Customer added to database as NEW (temporary mark)
   - Will check for referral code when they book
   - Will give gift card on first booking if code found
‚úÖ Verification: Customer found in DB: true
{"ts":"2025-11-30T00:53:43.843Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"246beaa7-b3c4-4052-9562-3b43fe973366","stage":"customer_ingest","correlationId":"customer-created:445a33e1f4209e6df8e74182"}
{"ts":"2025-11-30T00:53:43.998Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"13f9b26b-2e03-4709-b961-01e53e2acfdd","stage":"booking","correlationId":"booking-created:b4f8cc9453e0d373d86fd704","attempts":1}
üìÖ Processing booking created for customer: 70C7YJKVWF94CBYB1XBB0KGQPC
Full booking data: {
  "id": "yoal68iqbtq26m",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-11T00:10:00Z",
  "created_at": "2025-11-30T00:41:27Z",
  "updated_at": "2025-11-30T00:41:27Z",
  "customer_id": "70C7YJKVWF94CBYB1XBB0KGQPC",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "70C7YJKVWF94CBYB1XBB0KGQPC",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMOscywuGXO2VURY",
      "any_team_member": true,
      "duration_minutes": 140,
      "intermission_minutes": 0,
      "service_variation_id": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "CJI5WHOAKSFTASYPJ4MSYZLS"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Katelyn McLaughlin
üéâ First booking detected for customer: 70C7YJKVWF94CBYB1XBB0KGQPC
   Name: Katelyn McLaughlin
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 70C7YJKVWF94CBYB1XBB0KGQPC...
Error getting custom attributes for customer 70C7YJKVWF94CBYB1XBB0KGQPC: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 70C7YJKVWF94CBYB1XBB0KGQPC
{"ts":"2025-11-30T00:53:44.408Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"13f9b26b-2e03-4709-b961-01e53e2acfdd","stage":"booking","correlationId":"booking-created:b4f8cc9453e0d373d86fd704"}
{"ts":"2025-11-30T01:11:59.125Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"62965e67-e728-49b5-875f-5b6e1b86e172","stage":"payment","correlationId":"payment-updated:18dab57740040a1e45acabaf","attempts":1}
üí∞ Processing payment completion for customer: 4WB9Q19C8VYKFXRK7G9VVXB10C
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Sarah Bright
‚ùå Referrer not found for code: null
‚úÖ Generated new personal_code in name+ID format: SARAH7910
‚ùå Error creating/loading gift card for Sarah Bright: Response status code was not ok: 401.
Square API errors: [
  {
    "category": "AUTHENTICATION_ERROR",
    "code": "UNAUTHORIZED",
    "detail": "This request could not be authorized."
  }
]
‚ùå Failed to create referrer gift card
Error upserting custom attribute "square:a3dde506-f69e-48e4-a98a-004c1822d3ad" for customer 4WB9Q19C8VYKFXRK7G9VVXB10C: Response status code was not ok: 401.
Square API errors: [
  {
    "category": "AUTHENTICATION_ERROR",
    "code": "UNAUTHORIZED",
    "detail": "This request could not be authorized."
  }
]
Error appending referral note for customer 4WB9Q19C8VYKFXRK7G9VVXB10C: Response status code was not ok: 401.
Square API errors: [
  {
    "category": "AUTHENTICATION_ERROR",
    "code": "UNAUTHORIZED",
    "detail": "This request could not be authorized."
  }
]
‚ùå Error sending referral email to sabright97@gmail.com: Unauthorized
SendGrid error details: {
  errors: [
    {
      message: 'The provided authorization grant is invalid, expired, or revoked',
      field: null,
      help: null
    }
  ]
}
‚ö†Ô∏è Analytics operation "notification_event" failed: 
Invalid `prisma.notificationEvent.create()` invocation in
/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/analytics-service.js:164:39

  161 return runAnalyticsOperation(
  162   'notification_event',
  163   async () => {
‚Üí 164     return prisma.notificationEvent.create({
            data: {
              channel: "EMAIL",
              templateType: "REFERRAL_INVITE",
              status: "failed",
              createdAt: new Date("2025-11-30T01:12:00.812Z"),
              errorCode: 401,
                         ~~~
              errorMessage: "Unauthorized",
              metadata: {
                email: "sabright97@gmail.com",
                referralCode: "SARAH7910",
                referralUrl: "https://referral-system-salon-fbbq6x1wt-umis-projects-e802f152.vercel.app/ref/SARAH7910",
                suppressionGroupId: 28008
              }
            }
          })

Argument `errorCode`: Invalid value provided. Expected String or Null, provided Int.
‚ùå Failed to send email: Unauthorized
‚ÑπÔ∏è SMS sending disabled. Would send referral link to +17153708356
‚è∏Ô∏è SMS sending disabled (skipped sending to +17153708356)
üìß Referral code generated and sent:
   - Customer: Sarah Bright
   - Email: sabright97@gmail.com
   - Referral Code: SARAH7910
   - Referral URL: https://referral-system-salon-fbbq6x1wt-umis-projects-e802f152.vercel.app/ref/SARAH7910
   - Gift Card ID: null
   - Status: Customer is now a referrer
‚úÖ Referral code sent to new client:
   - Customer: Sarah Bright
   - Email: sabright97@gmail.com
   - Referral Code: SARAH7910
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: 4WB9Q19C8VYKFXRK7G9VVXB10C
{"ts":"2025-11-30T01:12:01.226Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"62965e67-e728-49b5-875f-5b6e1b86e172","stage":"payment","correlationId":"payment-updated:18dab57740040a1e45acabaf"}
{"ts":"2025-11-30T01:12:01.463Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"d46ffdb8-4f3c-44c4-9dfd-c14dcb87fd89","stage":"payment","correlationId":"payment-updated:3c7cd664c933a46f6a3d3dd3","attempts":1}
üí∞ Processing payment completion for customer: 4WB9Q19C8VYKFXRK7G9VVXB10C
   Payment source_type: CARD
   Payment tender_types: []
Customer 4WB9Q19C8VYKFXRK7G9VVXB10C already completed first payment
{"ts":"2025-11-30T01:12:01.655Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"d46ffdb8-4f3c-44c4-9dfd-c14dcb87fd89","stage":"payment","correlationId":"payment-updated:3c7cd664c933a46f6a3d3dd3"}
{"ts":"2025-11-30T01:20:41.196Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"\nInvalid `prisma.$queryRaw()` invocation:\n\n\nServer has closed the connection.","stack":"PrismaClientKnownRequestError: \nInvalid `prisma.$queryRaw()` invocation:\n\n\nServer has closed the connection.\n    at $n.handleRequestError (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:121:7315)\n    at $n.handleAndLogRequestError (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:121:6623)\n    at $n.request (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:121:6307)\n    at async l (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:9633)\n    at async prisma.$transaction.isolationLevel (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:239:26)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:8000)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-11-30T01:20:43.865Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"0966e998-ca7c-4bb0-a7a9-fc8e37a87174","stage":"booking","correlationId":"booking-created:a1d7dabdb14d68920c5b5a0b","attempts":1}
üìÖ Processing booking created for customer: 4VD858XQEVHTJN3E5W41MY5TZM
Full booking data: {
  "id": "bkr2jbkwoh745s",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-08T21:30:00Z",
  "created_at": "2025-11-30T01:02:43Z",
  "updated_at": "2025-11-30T01:02:43Z",
  "customer_id": "4VD858XQEVHTJN3E5W41MY5TZM",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "4VD858XQEVHTJN3E5W41MY5TZM",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMNW4SIF7tjp4oM_",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "BRSIGZFOWC6F4ERPKX3CODLU",
      "service_variation_version": 1764191999049,
      "service_variation_client_id": "BRSIGZFOWC6F4ERPKX3CODLU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Melaney Gonzalez
üéâ First booking detected for customer: 4VD858XQEVHTJN3E5W41MY5TZM
   Name: Melaney Gonzalez
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 4VD858XQEVHTJN3E5W41MY5TZM...
Error getting custom attributes for customer 4VD858XQEVHTJN3E5W41MY5TZM: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 4VD858XQEVHTJN3E5W41MY5TZM
{"ts":"2025-11-30T01:20:44.580Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"0966e998-ca7c-4bb0-a7a9-fc8e37a87174","stage":"booking","correlationId":"booking-created:a1d7dabdb14d68920c5b5a0b"}
{"ts":"2025-11-30T01:20:44.766Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"e5afa9ef-dd9f-48ea-a35f-3f9040694425","stage":"payment","correlationId":"payment-updated:813337cfb21bdddba46d0d99","attempts":1}
üí∞ Processing payment completion for customer: 0WC703SDTFW8MKYBD9QRHWYYXC
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Cienna Patmont
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Cienna Patmont, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Cienna Patmont
   - Email: ckpatmont@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: 0WC703SDTFW8MKYBD9QRHWYYXC
{"ts":"2025-11-30T01:20:45.217Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"e5afa9ef-dd9f-48ea-a35f-3f9040694425","stage":"payment","correlationId":"payment-updated:813337cfb21bdddba46d0d99"}
{"ts":"2025-11-30T01:20:45.420Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"8646825a-098a-43db-8960-69d18d777e8b","stage":"payment","correlationId":"payment-updated:fa7069fa92128762b715a16e","attempts":1}
üí∞ Processing payment completion for customer: 0WC703SDTFW8MKYBD9QRHWYYXC
   Payment source_type: CARD
   Payment tender_types: []
Customer 0WC703SDTFW8MKYBD9QRHWYYXC already completed first payment
{"ts":"2025-11-30T01:20:45.811Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"8646825a-098a-43db-8960-69d18d777e8b","stage":"payment","correlationId":"payment-updated:fa7069fa92128762b715a16e"}
{"ts":"2025-11-30T01:20:46.023Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"86ca4dcc-6b69-42ee-8f69-0f0a4cd0752c","stage":"booking","correlationId":"booking-created:5e79f9dc7904c1c5cc590dab","attempts":1}
üìÖ Processing booking created for customer: W79MRAGVDX3E53BXPCEB9MQ0EM
Full booking data: {
  "id": "z0gt9z5s6o3y7j",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-27T22:00:00Z",
  "created_at": "2025-11-30T01:07:27Z",
  "updated_at": "2025-11-30T01:07:27Z",
  "customer_id": "W79MRAGVDX3E53BXPCEB9MQ0EM",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMQPbDVvvOCLwqsy"
  },
  "appointment_segments": [
    {
      "resource_ids": [
        "KAOXILA4CV7A23VRAACC4R66"
      ],
      "team_member_id": "TM1L5yPC-yKx6CyO",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "ZEAKNB35I37RMXNUBGWDZQIM",
      "service_variation_version": 1760895536505,
      "service_variation_client_id": "ZEAKNB35I37RMXNUBGWDZQIM"
    },
    {
      "team_member_id": "TM1L5yPC-yKx6CyO",
      "any_team_member": false,
      "duration_minutes": 20,
      "intermission_minutes": 0,
      "service_variation_id": "HAJX45W3U2WUCCXM5MI24UEE",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "HAJX45W3U2WUCCXM5MI24UEE"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Nichole Rosten
üéâ First booking detected for customer: W79MRAGVDX3E53BXPCEB9MQ0EM
   Name: Nichole Rosten
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer W79MRAGVDX3E53BXPCEB9MQ0EM...
Error getting custom attributes for customer W79MRAGVDX3E53BXPCEB9MQ0EM: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: W79MRAGVDX3E53BXPCEB9MQ0EM
{"ts":"2025-11-30T01:20:46.454Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"86ca4dcc-6b69-42ee-8f69-0f0a4cd0752c","stage":"booking","correlationId":"booking-created:5e79f9dc7904c1c5cc590dab"}
{"ts":"2025-11-30T01:20:46.628Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"d8638cda-629f-4800-a317-c5acec39cb0a","stage":"payment","correlationId":"payment-updated:8ced04cc77c961723f17cd5d","attempts":1}
üí∞ Processing payment completion for customer: 686DE28KCH3PX0X2EH9KN5XDWR
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Sheena Coenen
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Sheena Coenen, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Sheena Coenen
   - Email: coenensheena@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: 686DE28KCH3PX0X2EH9KN5XDWR
{"ts":"2025-11-30T01:20:46.971Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"d8638cda-629f-4800-a317-c5acec39cb0a","stage":"payment","correlationId":"payment-updated:8ced04cc77c961723f17cd5d"}
{"ts":"2025-11-30T01:20:47.139Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"c5431521-aae1-42e2-b221-058ab8641e56","stage":"payment","correlationId":"payment-updated:fe3a9a0c02b599f26219ec80","attempts":1}
üí∞ Processing payment completion for customer: 686DE28KCH3PX0X2EH9KN5XDWR
   Payment source_type: CARD
   Payment tender_types: []
Customer 686DE28KCH3PX0X2EH9KN5XDWR already completed first payment
{"ts":"2025-11-30T01:20:47.282Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"c5431521-aae1-42e2-b221-058ab8641e56","stage":"payment","correlationId":"payment-updated:fe3a9a0c02b599f26219ec80"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-11-30T01:36:47.550Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"4dc8d91f-684f-4ab0-a340-596448af978f","stage":"booking","correlationId":"booking-created:edb8ee394b4a8e8a5edb755d","attempts":1}
üìÖ Processing booking created for customer: 0TG5WNATPE362NC416TC4YQ14C
Full booking data: {
  "id": "yi3czqs3gxb8rf",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-01T23:00:00Z",
  "created_at": "2025-11-30T01:32:16Z",
  "updated_at": "2025-11-30T01:32:16Z",
  "customer_id": "0TG5WNATPE362NC416TC4YQ14C",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "0TG5WNATPE362NC416TC4YQ14C",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMEWAZHdtaiRR_Zs",
      "any_team_member": true,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Tiffany Williams
üéâ First booking detected for customer: 0TG5WNATPE362NC416TC4YQ14C
   Name: Tiffany Williams
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 0TG5WNATPE362NC416TC4YQ14C...
Error getting custom attributes for customer 0TG5WNATPE362NC416TC4YQ14C: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 0TG5WNATPE362NC416TC4YQ14C
{"ts":"2025-11-30T01:36:48.223Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"4dc8d91f-684f-4ab0-a340-596448af978f","stage":"booking","correlationId":"booking-created:edb8ee394b4a8e8a5edb755d"}
{"ts":"2025-11-30T01:36:48.386Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"c7d376d0-e136-4e02-b8d3-c4de5f49b748","stage":"booking","correlationId":"booking-created:bd700612713072ed036674e1","attempts":1}
üìÖ Processing booking created for customer: PA2Z6TH702Q055HFNZ44XXAHS8
Full booking data: {
  "id": "c6ox9vbkld2tg1",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-10T22:00:00Z",
  "created_at": "2025-11-30T01:33:57Z",
  "updated_at": "2025-11-30T01:33:57Z",
  "customer_id": "PA2Z6TH702Q055HFNZ44XXAHS8",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "PA2Z6TH702Q055HFNZ44XXAHS8",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMXiw38Bbb7XQUWI",
      "any_team_member": true,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    },
    {
      "resource_ids": [
        "5OVIQ6GSSUXORACP6T7WBAQ7"
      ],
      "team_member_id": "TMXiw38Bbb7XQUWI",
      "any_team_member": true,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "ZEAKNB35I37RMXNUBGWDZQIM",
      "service_variation_version": 1760895536505,
      "service_variation_client_id": "ZEAKNB35I37RMXNUBGWDZQIM"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Evgeniya Kuzmina
üéâ First booking detected for customer: PA2Z6TH702Q055HFNZ44XXAHS8
   Name: Evgeniya Kuzmina
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer PA2Z6TH702Q055HFNZ44XXAHS8...
Error getting custom attributes for customer PA2Z6TH702Q055HFNZ44XXAHS8: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: PA2Z6TH702Q055HFNZ44XXAHS8
{"ts":"2025-11-30T01:36:48.781Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"c7d376d0-e136-4e02-b8d3-c4de5f49b748","stage":"booking","correlationId":"booking-created:bd700612713072ed036674e1"}
{"ts":"2025-11-30T01:36:48.934Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"33a37644-b8bd-474e-9684-fa392ecdb09b","stage":"payment","correlationId":"payment-updated:e81f1124760442fb384099e9","attempts":1}
üí∞ Processing payment completion for customer: 06WSVCE31KD6K0VKWHS1X9N858
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Lauren Kelly
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Lauren Kelly, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Lauren Kelly
   - Email: laurenclaire312@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: 06WSVCE31KD6K0VKWHS1X9N858
{"ts":"2025-11-30T01:36:49.256Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"33a37644-b8bd-474e-9684-fa392ecdb09b","stage":"payment","correlationId":"payment-updated:e81f1124760442fb384099e9"}
{"ts":"2025-11-30T01:36:49.411Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"aacde06c-9137-4824-8d18-7b5acbd97913","stage":"payment","correlationId":"payment-updated:b8784190109a2f971f78f5cd","attempts":1}
üí∞ Processing payment completion for customer: 06WSVCE31KD6K0VKWHS1X9N858
   Payment source_type: CARD
   Payment tender_types: []
Customer 06WSVCE31KD6K0VKWHS1X9N858 already completed first payment
{"ts":"2025-11-30T01:36:49.555Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"aacde06c-9137-4824-8d18-7b5acbd97913","stage":"payment","correlationId":"payment-updated:b8784190109a2f971f78f5cd"}
{"ts":"2025-11-30T01:36:49.711Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"0f21782f-f824-4bfc-b04c-a9446307bb22","stage":"payment","correlationId":"payment-updated:c6ea6a12acc2d51364a88ddf","attempts":1}
üí∞ Processing payment completion for customer: ZRKFNEJ0C02CBWWHVJWPYH1T6R
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Erika Dela Marta
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Erika Dela Marta, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Erika Dela Marta
   - Email: crows_ribose.0v@icloud.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: ZRKFNEJ0C02CBWWHVJWPYH1T6R
{"ts":"2025-11-30T01:36:50.021Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"0f21782f-f824-4bfc-b04c-a9446307bb22","stage":"payment","correlationId":"payment-updated:c6ea6a12acc2d51364a88ddf"}
{"ts":"2025-11-30T01:36:50.178Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"469647f3-e130-4920-9ad7-df77c31c65a0","stage":"payment","correlationId":"payment-updated:b7b3d3d9108fe1b5ce88d731","attempts":1}
üí∞ Processing payment completion for customer: ZRKFNEJ0C02CBWWHVJWPYH1T6R
   Payment source_type: CARD
   Payment tender_types: []
Customer ZRKFNEJ0C02CBWWHVJWPYH1T6R already completed first payment
{"ts":"2025-11-30T01:36:50.314Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"469647f3-e130-4920-9ad7-df77c31c65a0","stage":"payment","correlationId":"payment-updated:b7b3d3d9108fe1b5ce88d731"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-11-30T01:52:45.451Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"6372a740-a5de-413c-b1fa-43a6ca3416ed","stage":"payment","correlationId":"payment-updated:b0ef91ef13abf2de07aa655b","attempts":1}
üí∞ Processing payment completion for customer: SZS53MPZD0VVCG86TY8YRFKVVM
   Payment source_type: CARD
   Payment tender_types: []
Customer SZS53MPZD0VVCG86TY8YRFKVVM already completed first payment
{"ts":"2025-11-30T01:52:46.182Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"6372a740-a5de-413c-b1fa-43a6ca3416ed","stage":"payment","correlationId":"payment-updated:b0ef91ef13abf2de07aa655b"}
{"ts":"2025-11-30T01:52:46.337Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"3c6a5e08-4a9d-4210-9904-8bdf0fa9c854","stage":"payment","correlationId":"payment-updated:329315167f09a51e27259397","attempts":1}
üí∞ Processing payment completion for customer: SZS53MPZD0VVCG86TY8YRFKVVM
   Payment source_type: CARD
   Payment tender_types: []
Customer SZS53MPZD0VVCG86TY8YRFKVVM already completed first payment
{"ts":"2025-11-30T01:52:46.471Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"3c6a5e08-4a9d-4210-9904-8bdf0fa9c854","stage":"payment","correlationId":"payment-updated:329315167f09a51e27259397"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-11-30T02:09:27.507Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"62cdbeba-ec10-4bc0-9c45-82d037e16fe4","stage":"booking","correlationId":"booking-created:761317ac2a789b56c2f59d45","attempts":1}
üìÖ Processing booking created for customer: 5TM9MHHNPWPHTPCYARPE38W32G
Full booking data: {
  "id": "jcvpw09y5q03s3",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-27T01:00:00Z",
  "created_at": "2025-11-30T01:57:49Z",
  "updated_at": "2025-11-30T01:57:49Z",
  "customer_id": "5TM9MHHNPWPHTPCYARPE38W32G",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "5TM9MHHNPWPHTPCYARPE38W32G",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMMCVDJoKh3ZkfFo",
      "any_team_member": true,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 0 customer(s) in database
‚ÑπÔ∏è Customer 5TM9MHHNPWPHTPCYARPE38W32G not in database yet - need to add them first
‚ùå Error fetching/adding customer from Square: Response status code was not ok: 401.
{"ts":"2025-11-30T02:09:28.164Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"62cdbeba-ec10-4bc0-9c45-82d037e16fe4","stage":"booking","correlationId":"booking-created:761317ac2a789b56c2f59d45"}
{"ts":"2025-11-30T02:09:28.318Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"ef31c917-238a-46cd-956d-6dfd7526ce9c","stage":"customer_ingest","correlationId":"customer-created:9fa7f1a240f4d4f619e19d24","attempts":1}
üì• Received customer data: {
  "id": "5TM9MHHNPWPHTPCYARPE38W32G",
  "address": {
    "country": "US"
  },
  "version": 1,
  "group_ids": [
    "LT4ZHFBQQYB2N.APPOINTMENTS"
  ],
  "created_at": "2025-11-30T01:57:46.636Z",
  "given_name": "Sarina",
  "updated_at": "2025-11-30T01:57:49Z",
  "family_name": "Hothi",
  "preferences": {
    "email_unsubscribed": false
  },
  "phone_number": "+12095855221",
  "email_address": "shothi1@gmail.com",
  "creation_source": "APPOINTMENTS"
}
üë§ Processing customer creation: 5TM9MHHNPWPHTPCYARPE38W32G
üìç IP Address: unknown
üìß Email: shothi1@gmail.com
üìû Phone: +12095855221
üë§ Name: Sarina Hothi
‚ö†Ô∏è Suspicious IP activity detected: unknown used by 107 customers
‚ö†Ô∏è Suspicious activity detected for customer 5TM9MHHNPWPHTPCYARPE38W32G, flagging for review
üéâ New customer detected: 5TM9MHHNPWPHTPCYARPE38W32G
‚úÖ Customer added to database as NEW (temporary mark)
   - Will check for referral code when they book
   - Will give gift card on first booking if code found
‚úÖ Verification: Customer found in DB: true
{"ts":"2025-11-30T02:09:28.700Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"ef31c917-238a-46cd-956d-6dfd7526ce9c","stage":"customer_ingest","correlationId":"customer-created:9fa7f1a240f4d4f619e19d24"}
{"ts":"2025-11-30T02:20:13.638Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Server has closed the connection.","stack":"PrismaClientKnownRequestError: Server has closed the connection.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-11-30T02:53:49.185Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"35ca744e-cb17-4efc-90cc-05f13bf4a534","stage":"payment","correlationId":"payment-updated:3aec066c48f941403d00aff7","attempts":1}
üí∞ Processing payment completion for customer: 24J57NNN2Q2MZTFW5FZ28SGMFM
   Payment source_type: CARD
   Payment tender_types: []
Customer 24J57NNN2Q2MZTFW5FZ28SGMFM already completed first payment
{"ts":"2025-11-30T02:53:49.609Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"35ca744e-cb17-4efc-90cc-05f13bf4a534","stage":"payment","correlationId":"payment-updated:3aec066c48f941403d00aff7"}
{"ts":"2025-11-30T02:53:49.766Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"1cd246aa-b50a-43c5-bd6c-a41c02561b8e","stage":"payment","correlationId":"payment-updated:3802493370d6b6f122c7b32c","attempts":1}
üí∞ Processing payment completion for customer: 24J57NNN2Q2MZTFW5FZ28SGMFM
   Payment source_type: CARD
   Payment tender_types: []
Customer 24J57NNN2Q2MZTFW5FZ28SGMFM already completed first payment
{"ts":"2025-11-30T02:53:49.904Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"1cd246aa-b50a-43c5-bd6c-a41c02561b8e","stage":"payment","correlationId":"payment-updated:3802493370d6b6f122c7b32c"}
{"ts":"2025-11-30T02:53:50.060Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"177463c4-a887-418d-aeab-010d8ccc49ba","stage":"booking","correlationId":"booking-created:1ffd104224f45c518a2ba46b","attempts":1}
üìÖ Processing booking created for customer: 0WC703SDTFW8MKYBD9QRHWYYXC
Full booking data: {
  "id": "1gik6462apl8ae",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-20T23:20:00Z",
  "created_at": "2025-11-30T02:43:38Z",
  "updated_at": "2025-11-30T02:43:38Z",
  "customer_id": "0WC703SDTFW8MKYBD9QRHWYYXC",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "0WC703SDTFW8MKYBD9QRHWYYXC",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TM-zXe9fXe4axYWn",
      "any_team_member": false,
      "duration_minutes": 140,
      "intermission_minutes": 0,
      "service_variation_id": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "CJI5WHOAKSFTASYPJ4MSYZLS"
    },
    {
      "team_member_id": "TM-zXe9fXe4axYWn",
      "any_team_member": false,
      "duration_minutes": 20,
      "intermission_minutes": 0,
      "service_variation_id": "HAJX45W3U2WUCCXM5MI24UEE",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "HAJX45W3U2WUCCXM5MI24UEE"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Cienna Patmont
üéâ First booking detected for customer: 0WC703SDTFW8MKYBD9QRHWYYXC
   Name: Cienna Patmont
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 0WC703SDTFW8MKYBD9QRHWYYXC...
Error getting custom attributes for customer 0WC703SDTFW8MKYBD9QRHWYYXC: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 0WC703SDTFW8MKYBD9QRHWYYXC
{"ts":"2025-11-30T02:53:50.466Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"177463c4-a887-418d-aeab-010d8ccc49ba","stage":"booking","correlationId":"booking-created:1ffd104224f45c518a2ba46b"}
{"ts":"2025-11-30T02:53:50.620Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"4a5e39ee-3b0f-4f2e-a62f-b31507c62765","stage":"payment","correlationId":"payment-updated:89967c9bc92b8cd2558cf2b2","attempts":1}
üí∞ Processing payment completion for customer: 6Q5F0DQF07AJ6EB9CBFV6NW6B4
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Olya Surits
‚ùå Referrer not found for code: null
‚úÖ Generated new personal_code in name+ID format: OLYA9664
‚ùå Error creating/loading gift card for Olya Surits: Response status code was not ok: 401.
Square API errors: [
  {
    "category": "AUTHENTICATION_ERROR",
    "code": "UNAUTHORIZED",
    "detail": "This request could not be authorized."
  }
]
‚ùå Failed to create referrer gift card
Error upserting custom attribute "square:a3dde506-f69e-48e4-a98a-004c1822d3ad" for customer 6Q5F0DQF07AJ6EB9CBFV6NW6B4: Response status code was not ok: 401.
Square API errors: [
  {
    "category": "AUTHENTICATION_ERROR",
    "code": "UNAUTHORIZED",
    "detail": "This request could not be authorized."
  }
]
Error appending referral note for customer 6Q5F0DQF07AJ6EB9CBFV6NW6B4: Response status code was not ok: 401.
Square API errors: [
  {
    "category": "AUTHENTICATION_ERROR",
    "code": "UNAUTHORIZED",
    "detail": "This request could not be authorized."
  }
]
‚ùå Error sending referral email to olyasurits@gmail.com: Unauthorized
SendGrid error details: {
  errors: [
    {
      message: 'The provided authorization grant is invalid, expired, or revoked',
      field: null,
      help: null
    }
  ]
}
‚ö†Ô∏è Analytics operation "notification_event" failed: 
Invalid `prisma.notificationEvent.create()` invocation in
/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/analytics-service.js:164:39

  161 return runAnalyticsOperation(
  162   'notification_event',
  163   async () => {
‚Üí 164     return prisma.notificationEvent.create({
            data: {
              channel: "EMAIL",
              templateType: "REFERRAL_INVITE",
              status: "failed",
              createdAt: new Date("2025-11-30T02:53:52.022Z"),
              errorCode: 401,
                         ~~~
              errorMessage: "Unauthorized",
              metadata: {
                email: "olyasurits@gmail.com",
                referralCode: "OLYA9664",
                referralUrl: "https://referral-system-salon-fbbq6x1wt-umis-projects-e802f152.vercel.app/ref/OLYA9664",
                suppressionGroupId: 28008
              }
            }
          })

Argument `errorCode`: Invalid value provided. Expected String or Null, provided Int.
‚ùå Failed to send email: Unauthorized
‚ÑπÔ∏è SMS sending disabled. Would send referral link to +15034767527
‚è∏Ô∏è SMS sending disabled (skipped sending to +15034767527)
üìß Referral code generated and sent:
   - Customer: Olya Surits
   - Email: olyasurits@gmail.com
   - Referral Code: OLYA9664
   - Referral URL: https://referral-system-salon-fbbq6x1wt-umis-projects-e802f152.vercel.app/ref/OLYA9664
   - Gift Card ID: null
   - Status: Customer is now a referrer
‚úÖ Referral code sent to new client:
   - Customer: Olya Surits
   - Email: olyasurits@gmail.com
   - Referral Code: OLYA9664
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: 6Q5F0DQF07AJ6EB9CBFV6NW6B4
{"ts":"2025-11-30T02:53:52.271Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"4a5e39ee-3b0f-4f2e-a62f-b31507c62765","stage":"payment","correlationId":"payment-updated:89967c9bc92b8cd2558cf2b2"}
{"ts":"2025-11-30T02:53:52.428Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"d4df194e-efc2-49c9-90bc-3409fb26876e","stage":"payment","correlationId":"payment-updated:8329edb33bbb31c6bff476ae","attempts":1}
üí∞ Processing payment completion for customer: 6Q5F0DQF07AJ6EB9CBFV6NW6B4
   Payment source_type: CARD
   Payment tender_types: []
Customer 6Q5F0DQF07AJ6EB9CBFV6NW6B4 already completed first payment
{"ts":"2025-11-30T02:53:52.561Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"d4df194e-efc2-49c9-90bc-3409fb26876e","stage":"payment","correlationId":"payment-updated:8329edb33bbb31c6bff476ae"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-11-30T03:00:02.408Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"3b2f954a-c483-4731-ad77-44e4d2f5334b","stage":"booking","correlationId":"booking-created:e69b011ed3e2f66dae09780b","attempts":1}
üìÖ Processing booking created for customer: 0GAY4EGMBY8J1N3V6BTV5RTKNR
Full booking data: {
  "id": "95foya0ap08tcy",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-18T23:30:00Z",
  "created_at": "2025-11-30T02:54:36Z",
  "updated_at": "2025-11-30T02:54:36Z",
  "customer_id": "0GAY4EGMBY8J1N3V6BTV5RTKNR",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "0GAY4EGMBY8J1N3V6BTV5RTKNR",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "resource_ids": [
        "5OVIQ6GSSUXORACP6T7WBAQ7"
      ],
      "team_member_id": "TMMCVDJoKh3ZkfFo",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "63PG6RLS2NHWRD5JRXEC74HN",
      "service_variation_version": 1760895536505,
      "service_variation_client_id": "63PG6RLS2NHWRD5JRXEC74HN"
    },
    {
      "team_member_id": "TMMCVDJoKh3ZkfFo",
      "any_team_member": false,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Anne-Marie Morrell
üéâ First booking detected for customer: 0GAY4EGMBY8J1N3V6BTV5RTKNR
   Name: Anne-Marie Morrell
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 0GAY4EGMBY8J1N3V6BTV5RTKNR...
Error getting custom attributes for customer 0GAY4EGMBY8J1N3V6BTV5RTKNR: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 0GAY4EGMBY8J1N3V6BTV5RTKNR
{"ts":"2025-11-30T03:00:04.265Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"3b2f954a-c483-4731-ad77-44e4d2f5334b","stage":"booking","correlationId":"booking-created:e69b011ed3e2f66dae09780b"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-11-30T03:13:33.791Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"57d6017d-ea1a-4eff-904e-c90c6ddf5b85","stage":"booking","correlationId":"booking-created:9bf225aadeb915dc37fb28ca","attempts":1}
üìÖ Processing booking created for customer: 3MEDJPJ8PGFZKHC5RCB0NXMHMC
Full booking data: {
  "id": "edqytppp3bzybh",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-06T18:00:00Z",
  "created_at": "2025-11-30T03:13:30Z",
  "updated_at": "2025-11-30T03:13:30Z",
  "customer_id": "3MEDJPJ8PGFZKHC5RCB0NXMHMC",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "3MEDJPJ8PGFZKHC5RCB0NXMHMC",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMOscywuGXO2VURY",
      "any_team_member": true,
      "duration_minutes": 140,
      "intermission_minutes": 0,
      "service_variation_id": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "CJI5WHOAKSFTASYPJ4MSYZLS"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Tal Reback
üéâ First booking detected for customer: 3MEDJPJ8PGFZKHC5RCB0NXMHMC
   Name: Tal Reback
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 3MEDJPJ8PGFZKHC5RCB0NXMHMC...
Error getting custom attributes for customer 3MEDJPJ8PGFZKHC5RCB0NXMHMC: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 3MEDJPJ8PGFZKHC5RCB0NXMHMC
{"ts":"2025-11-30T03:13:35.076Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"57d6017d-ea1a-4eff-904e-c90c6ddf5b85","stage":"booking","correlationId":"booking-created:9bf225aadeb915dc37fb28ca"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-11-30T04:39:53.131Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"ead1d79f-4ea5-4293-8333-c15f7b5298cb","stage":"booking","correlationId":"booking-created:4a9889d7dc2dfdf3886d18c3","attempts":1}
üìÖ Processing booking created for customer: B1SD31A26YCWNJT9V2B4HGJCB0
Full booking data: {
  "id": "j5fz82tl2wuhyx",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-06T18:00:00Z",
  "created_at": "2025-11-30T04:24:32Z",
  "updated_at": "2025-11-30T04:24:32Z",
  "customer_id": "B1SD31A26YCWNJT9V2B4HGJCB0",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "B1SD31A26YCWNJT9V2B4HGJCB0",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TM9jDlRr_Hl4rdBB",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "XBUDIMNKOPC2XVG5YLIQ4RYS",
      "service_variation_version": 1764191999049,
      "service_variation_client_id": "XBUDIMNKOPC2XVG5YLIQ4RYS"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Emily Machado
üéâ First booking detected for customer: B1SD31A26YCWNJT9V2B4HGJCB0
   Name: Emily Machado
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer B1SD31A26YCWNJT9V2B4HGJCB0...
Error getting custom attributes for customer B1SD31A26YCWNJT9V2B4HGJCB0: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: B1SD31A26YCWNJT9V2B4HGJCB0
{"ts":"2025-11-30T04:39:53.838Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"ead1d79f-4ea5-4293-8333-c15f7b5298cb","stage":"booking","correlationId":"booking-created:4a9889d7dc2dfdf3886d18c3"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-11-30T04:57:07.335Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"d75cca10-0145-4807-bb55-6b3b6d082560","stage":"booking","correlationId":"booking-created:c1340ec86b0ef2549fd696a0","attempts":1}
üìÖ Processing booking created for customer: 4FHCGEFMW90VH05BPEKBRHPQ9G
Full booking data: {
  "id": "jdgbduqgs6hkkd",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-11-30T18:00:00Z",
  "created_at": "2025-11-30T04:42:10Z",
  "updated_at": "2025-11-30T04:42:10Z",
  "customer_id": "4FHCGEFMW90VH05BPEKBRHPQ9G",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMWAtQTYmZpwwxii"
  },
  "appointment_segments": [
    {
      "resource_ids": [
        "F2MBRCC42VNNDWXNA3PAMHEU"
      ],
      "team_member_id": "TM-zXe9fXe4axYWn",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "ZEAKNB35I37RMXNUBGWDZQIM",
      "service_variation_version": 1760895536505,
      "service_variation_client_id": "ZEAKNB35I37RMXNUBGWDZQIM"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Kirti Shenoy
üéâ First booking detected for customer: 4FHCGEFMW90VH05BPEKBRHPQ9G
   Name: Kirti Shenoy
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 4FHCGEFMW90VH05BPEKBRHPQ9G...
Error getting custom attributes for customer 4FHCGEFMW90VH05BPEKBRHPQ9G: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 4FHCGEFMW90VH05BPEKBRHPQ9G
{"ts":"2025-11-30T04:57:08.018Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"d75cca10-0145-4807-bb55-6b3b6d082560","stage":"booking","correlationId":"booking-created:c1340ec86b0ef2549fd696a0"}
{"ts":"2025-11-30T04:57:08.174Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"c9d9c771-4aad-4e20-a2e8-9fcd8aebe27d","stage":"booking","correlationId":"booking-created:29db9ae470883835715b4468","attempts":1}
üìÖ Processing booking created for customer: ET5W3RZZ5RKFX9G93C7CQB7HV0
Full booking data: {
  "id": "4nwzw9nzxa68zm",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-02T23:40:00Z",
  "created_at": "2025-11-30T04:47:09Z",
  "updated_at": "2025-11-30T04:47:09Z",
  "customer_id": "ET5W3RZZ5RKFX9G93C7CQB7HV0",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "ET5W3RZZ5RKFX9G93C7CQB7HV0",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TM7_r-KmvY9xjnEU",
      "any_team_member": false,
      "duration_minutes": 110,
      "intermission_minutes": 0,
      "service_variation_id": "GJ5SRTYFV6ZCDI62TMSZP2OP",
      "service_variation_version": 1764191999049,
      "service_variation_client_id": "GJ5SRTYFV6ZCDI62TMSZP2OP"
    },
    {
      "team_member_id": "TM7_r-KmvY9xjnEU",
      "any_team_member": false,
      "duration_minutes": 30,
      "intermission_minutes": 0,
      "service_variation_id": "LFLFEZO7L46URIM2OVZOJADI",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "LFLFEZO7L46URIM2OVZOJADI"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Julianna Qvistgaard
üéâ First booking detected for customer: ET5W3RZZ5RKFX9G93C7CQB7HV0
   Name: Julianna Qvistgaard
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer ET5W3RZZ5RKFX9G93C7CQB7HV0...
Error getting custom attributes for customer ET5W3RZZ5RKFX9G93C7CQB7HV0: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: ET5W3RZZ5RKFX9G93C7CQB7HV0
{"ts":"2025-11-30T04:57:08.547Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"c9d9c771-4aad-4e20-a2e8-9fcd8aebe27d","stage":"booking","correlationId":"booking-created:29db9ae470883835715b4468"}
{"ts":"2025-11-30T05:12:31.180Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"\nInvalid `prisma.$queryRaw()` invocation:\n\n\nServer has closed the connection.","stack":"PrismaClientKnownRequestError: \nInvalid `prisma.$queryRaw()` invocation:\n\n\nServer has closed the connection.\n    at $n.handleRequestError (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:121:7315)\n    at $n.handleAndLogRequestError (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:121:6623)\n    at $n.request (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:121:6307)\n    at async l (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:9633)\n    at async prisma.$transaction.isolationLevel (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:239:26)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:8000)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-11-30T05:24:42.122Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Server has closed the connection.","stack":"PrismaClientKnownRequestError: Server has closed the connection.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-11-30T05:24:44.795Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"5646de06-c6bc-43ad-8dd3-fb7e91acbba1","stage":"booking","correlationId":"booking-created:d3bbd8242854277758acff27","attempts":1}
üìÖ Processing booking created for customer: 2Y3AZQ317567S6FVTFVWNG29TM
Full booking data: {
  "id": "jmsk464khv8hlb",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-15T22:30:00Z",
  "created_at": "2025-11-30T05:22:07Z",
  "updated_at": "2025-11-30T05:22:07Z",
  "customer_id": "2Y3AZQ317567S6FVTFVWNG29TM",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "2Y3AZQ317567S6FVTFVWNG29TM",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TM7_r-KmvY9xjnEU",
      "any_team_member": false,
      "duration_minutes": 110,
      "intermission_minutes": 0,
      "service_variation_id": "GJ5SRTYFV6ZCDI62TMSZP2OP",
      "service_variation_version": 1764191999049,
      "service_variation_client_id": "GJ5SRTYFV6ZCDI62TMSZP2OP"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Ann Parden
‚ÑπÔ∏è Customer 2Y3AZQ317567S6FVTFVWNG29TM already received signup bonus, not first booking
{"ts":"2025-11-30T05:24:45.207Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"5646de06-c6bc-43ad-8dd3-fb7e91acbba1","stage":"booking","correlationId":"booking-created:d3bbd8242854277758acff27"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-11-30T06:41:19.379Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Server has closed the connection.","stack":"PrismaClientKnownRequestError: Server has closed the connection.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:8034)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-11-30T07:26:42.909Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"b62e67cb-48ad-4f87-a803-dd91a7375139","stage":"booking","correlationId":"booking-created:ebb2f48895d60a10fc147c40","attempts":1}
üìÖ Processing booking created for customer: DT4KCX9R0SQTM4WV76Z0Y6M4P4
Full booking data: {
  "id": "sdvpnf87qa799k",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-24T18:00:00Z",
  "created_at": "2025-11-30T07:26:02Z",
  "updated_at": "2025-11-30T07:26:02Z",
  "customer_id": "DT4KCX9R0SQTM4WV76Z0Y6M4P4",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "DT4KCX9R0SQTM4WV76Z0Y6M4P4",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMMCVDJoKh3ZkfFo",
      "any_team_member": false,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Catherine Batang
üéâ First booking detected for customer: DT4KCX9R0SQTM4WV76Z0Y6M4P4
   Name: Catherine Batang
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer DT4KCX9R0SQTM4WV76Z0Y6M4P4...
Error getting custom attributes for customer DT4KCX9R0SQTM4WV76Z0Y6M4P4: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: DT4KCX9R0SQTM4WV76Z0Y6M4P4
{"ts":"2025-11-30T07:26:43.589Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"b62e67cb-48ad-4f87-a803-dd91a7375139","stage":"booking","correlationId":"booking-created:ebb2f48895d60a10fc147c40"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-11-30T09:53:08.539Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"807f63bb-9581-4367-bdee-c881441384ee","stage":"booking","correlationId":"booking-created:b8ec29539eae5b03606fc3a9","attempts":1}
üìÖ Processing booking created for customer: Z8WQ0D379GAGBS621BEF9SYQN8
Full booking data: {
  "id": "myx875uel5m5la",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-22T18:00:00Z",
  "created_at": "2025-11-30T09:37:51Z",
  "updated_at": "2025-11-30T09:37:51Z",
  "customer_id": "Z8WQ0D379GAGBS621BEF9SYQN8",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "Z8WQ0D379GAGBS621BEF9SYQN8",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMgsjtuk5cfKnstq",
      "any_team_member": false,
      "duration_minutes": 110,
      "intermission_minutes": 0,
      "service_variation_id": "6TYOE67IDYTKHW2ZG6HKVZER",
      "service_variation_version": 1764191999049,
      "service_variation_client_id": "6TYOE67IDYTKHW2ZG6HKVZER"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Nicole Chernev
üéâ First booking detected for customer: Z8WQ0D379GAGBS621BEF9SYQN8
   Name: Nicole Chernev
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer Z8WQ0D379GAGBS621BEF9SYQN8...
Error getting custom attributes for customer Z8WQ0D379GAGBS621BEF9SYQN8: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: Z8WQ0D379GAGBS621BEF9SYQN8
{"ts":"2025-11-30T09:53:09.275Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"807f63bb-9581-4367-bdee-c881441384ee","stage":"booking","correlationId":"booking-created:b8ec29539eae5b03606fc3a9"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-11-30T11:38:36.488Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Server has closed the connection.","stack":"PrismaClientKnownRequestError: Server has closed the connection.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-11-30T12:06:16.849Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"8a2b84d9-2e9f-4f2c-8af5-41bb2e7b24e3","stage":"booking","correlationId":"booking-created:79850a7f7d18de52c44c9cb4","attempts":1}
üìÖ Processing booking created for customer: 2SQMPF3HNPGAFRME15T2FPCW5C
Full booking data: {
  "id": "pg8ctfmyewr1ej",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-20T20:30:00Z",
  "created_at": "2025-11-30T11:57:24Z",
  "updated_at": "2025-11-30T11:57:24Z",
  "customer_id": "2SQMPF3HNPGAFRME15T2FPCW5C",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "2SQMPF3HNPGAFRME15T2FPCW5C",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMoZGdZlg-iKWTDu",
      "any_team_member": false,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    },
    {
      "team_member_id": "TMoZGdZlg-iKWTDu",
      "any_team_member": false,
      "duration_minutes": 30,
      "intermission_minutes": 0,
      "service_variation_id": "LFLFEZO7L46URIM2OVZOJADI",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "LFLFEZO7L46URIM2OVZOJADI"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Lauren Haron
üéâ First booking detected for customer: 2SQMPF3HNPGAFRME15T2FPCW5C
   Name: Lauren Haron
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 2SQMPF3HNPGAFRME15T2FPCW5C...
Error getting custom attributes for customer 2SQMPF3HNPGAFRME15T2FPCW5C: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 2SQMPF3HNPGAFRME15T2FPCW5C
{"ts":"2025-11-30T12:06:17.561Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"8a2b84d9-2e9f-4f2c-8af5-41bb2e7b24e3","stage":"booking","correlationId":"booking-created:79850a7f7d18de52c44c9cb4"}
{"ts":"2025-11-30T12:12:35.323Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Server has closed the connection.","stack":"PrismaClientKnownRequestError: Server has closed the connection.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-11-30T12:59:32.998Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"3369d581-fd44-4cb8-9e8b-ffa9e5b36334","stage":"booking","correlationId":"booking-created:f3bf5d674208479845411e2f","attempts":1}
üìÖ Processing booking created for customer: 6PQ82YBVJ5G1WRQ46A1KR3KWBM
Full booking data: {
  "id": "u4v3f98ya3ta7q",
  "source": "THIRD_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-11-30T22:40:00Z",
  "created_at": "2025-11-30T12:55:43Z",
  "updated_at": "2025-11-30T12:55:43Z",
  "customer_id": "6PQ82YBVJ5G1WRQ46A1KR3KWBM",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "6PQ82YBVJ5G1WRQ46A1KR3KWBM",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMSt73bSp59caRzt",
      "any_team_member": true,
      "duration_minutes": 140,
      "intermission_minutes": 0,
      "service_variation_id": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "CJI5WHOAKSFTASYPJ4MSYZLS"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Candice Adden
üéâ First booking detected for customer: 6PQ82YBVJ5G1WRQ46A1KR3KWBM
   Name: Candice Adden
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 6PQ82YBVJ5G1WRQ46A1KR3KWBM...
Error getting custom attributes for customer 6PQ82YBVJ5G1WRQ46A1KR3KWBM: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 6PQ82YBVJ5G1WRQ46A1KR3KWBM
{"ts":"2025-11-30T12:59:33.665Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"3369d581-fd44-4cb8-9e8b-ffa9e5b36334","stage":"booking","correlationId":"booking-created:f3bf5d674208479845411e2f"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-11-30T14:48:47.408Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"a6518797-31e7-48d9-b99c-55fe473e1c2e","stage":"booking","correlationId":"booking-created:6e2f4741ac2e6a6f26b12cba","attempts":1}
üìÖ Processing booking created for customer: H5C2YKW65FS9MQCMP3H02SK970
Full booking data: {
  "id": "a60vy0epl47025",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-06T21:00:00Z",
  "created_at": "2025-11-30T14:43:50Z",
  "updated_at": "2025-11-30T14:43:50Z",
  "customer_id": "H5C2YKW65FS9MQCMP3H02SK970",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "H5C2YKW65FS9MQCMP3H02SK970",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMkdrQsxG5tlf-c_",
      "any_team_member": true,
      "duration_minutes": 140,
      "intermission_minutes": 0,
      "service_variation_id": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "CJI5WHOAKSFTASYPJ4MSYZLS"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Elena Rusanovschi
üéâ First booking detected for customer: H5C2YKW65FS9MQCMP3H02SK970
   Name: Elena Rusanovschi
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer H5C2YKW65FS9MQCMP3H02SK970...
Error getting custom attributes for customer H5C2YKW65FS9MQCMP3H02SK970: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: H5C2YKW65FS9MQCMP3H02SK970
{"ts":"2025-11-30T14:48:48.241Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"a6518797-31e7-48d9-b99c-55fe473e1c2e","stage":"booking","correlationId":"booking-created:6e2f4741ac2e6a6f26b12cba"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-11-30T15:18:33.123Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"8417b92a-9e4a-40c4-ab34-fd57755a9aa6","stage":"booking","correlationId":"booking-created:70855d1c952de1366a42a2c5","attempts":1}
üìÖ Processing booking created for customer: 1X3HWY42F9YV5PQFZFP6EWATF4
Full booking data: {
  "id": "aeb68rgzpuqht6",
  "source": "THIRD_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-18T20:35:00Z",
  "created_at": "2025-11-30T15:15:45Z",
  "updated_at": "2025-11-30T15:15:45Z",
  "customer_id": "1X3HWY42F9YV5PQFZFP6EWATF4",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "1X3HWY42F9YV5PQFZFP6EWATF4",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TM-zXe9fXe4axYWn",
      "any_team_member": false,
      "duration_minutes": 140,
      "intermission_minutes": 0,
      "service_variation_id": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "CJI5WHOAKSFTASYPJ4MSYZLS"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Jacqueline Mayer
üéâ First booking detected for customer: 1X3HWY42F9YV5PQFZFP6EWATF4
   Name: Jacqueline Mayer
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 1X3HWY42F9YV5PQFZFP6EWATF4...
Error getting custom attributes for customer 1X3HWY42F9YV5PQFZFP6EWATF4: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 1X3HWY42F9YV5PQFZFP6EWATF4
{"ts":"2025-11-30T15:18:33.790Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"8417b92a-9e4a-40c4-ab34-fd57755a9aa6","stage":"booking","correlationId":"booking-created:70855d1c952de1366a42a2c5"}
{"ts":"2025-11-30T15:18:33.942Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"f6daf831-69ee-4e50-ab81-239fea9e4931","stage":"booking","correlationId":"booking-created:39d27cfb2744ae3df5f57e6d","attempts":1}
üìÖ Processing booking created for customer: 1X3HWY42F9YV5PQFZFP6EWATF4
Full booking data: {
  "id": "8xgn9t3maehaeq",
  "source": "THIRD_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-23T19:25:00Z",
  "created_at": "2025-11-30T15:17:19Z",
  "updated_at": "2025-11-30T15:17:19Z",
  "customer_id": "1X3HWY42F9YV5PQFZFP6EWATF4",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "1X3HWY42F9YV5PQFZFP6EWATF4",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TM-zXe9fXe4axYWn",
      "any_team_member": false,
      "duration_minutes": 140,
      "intermission_minutes": 0,
      "service_variation_id": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "CJI5WHOAKSFTASYPJ4MSYZLS"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Jacqueline Mayer
üéâ First booking detected for customer: 1X3HWY42F9YV5PQFZFP6EWATF4
   Name: Jacqueline Mayer
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 1X3HWY42F9YV5PQFZFP6EWATF4...
Error getting custom attributes for customer 1X3HWY42F9YV5PQFZFP6EWATF4: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 1X3HWY42F9YV5PQFZFP6EWATF4
{"ts":"2025-11-30T15:18:34.394Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"f6daf831-69ee-4e50-ab81-239fea9e4931","stage":"booking","correlationId":"booking-created:39d27cfb2744ae3df5f57e6d"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-11-30T15:51:40.993Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"7a3e2d9d-860d-4dc1-b4c5-b88d9cf2ec36","stage":"customer_ingest","correlationId":"customer-created:473a43a9cf8b90afe5b61dfb","attempts":1}
üì• Received customer data: {
  "id": "N5H61G6QMGCFM0V4Y9SCWX5N90",
  "address": {
    "country": "US"
  },
  "version": 0,
  "group_ids": [
    "LT4ZHFBQQYB2N.APPOINTMENTS"
  ],
  "created_at": "2025-11-30T15:48:28.792Z",
  "given_name": "Angela",
  "updated_at": "2025-11-30T15:48:28Z",
  "family_name": "Johnson",
  "preferences": {
    "email_unsubscribed": false
  },
  "phone_number": "+19253892678",
  "email_address": "ajohnson@nvp.com",
  "creation_source": "APPOINTMENTS"
}
üë§ Processing customer creation: N5H61G6QMGCFM0V4Y9SCWX5N90
üìç IP Address: unknown
üìß Email: ajohnson@nvp.com
üìû Phone: +19253892678
üë§ Name: Angela Johnson
‚ö†Ô∏è Suspicious IP activity detected: unknown used by 108 customers
‚ö†Ô∏è Suspicious activity detected for customer N5H61G6QMGCFM0V4Y9SCWX5N90, flagging for review
üéâ New customer detected: N5H61G6QMGCFM0V4Y9SCWX5N90
‚úÖ Customer added to database as NEW (temporary mark)
   - Will check for referral code when they book
   - Will give gift card on first booking if code found
‚úÖ Verification: Customer found in DB: true
{"ts":"2025-11-30T15:51:41.646Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"7a3e2d9d-860d-4dc1-b4c5-b88d9cf2ec36","stage":"customer_ingest","correlationId":"customer-created:473a43a9cf8b90afe5b61dfb"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-11-30T16:09:19.502Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"ec374727-ab31-417e-b1d7-fbc006b57634","stage":"booking","correlationId":"booking-created:a82a2e60696c52319daec187","attempts":1}
üìÖ Processing booking created for customer: N5H61G6QMGCFM0V4Y9SCWX5N90
Full booking data: {
  "id": "fqe27wazuxnnmf",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-13T20:20:00Z",
  "created_at": "2025-11-30T15:53:42Z",
  "updated_at": "2025-11-30T15:53:42Z",
  "customer_id": "N5H61G6QMGCFM0V4Y9SCWX5N90",
  "location_id": "LT4ZHFBQQYB2N",
  "customer_note": "These are my wedding nails!! Really would love to pick a neutral color, have hard gel on currently so will be a fill / reshape / recolor but really focused on the shape for photos! Thank you!!",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "N5H61G6QMGCFM0V4Y9SCWX5N90",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMOscywuGXO2VURY",
      "any_team_member": true,
      "duration_minutes": 140,
      "intermission_minutes": 0,
      "service_variation_id": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "CJI5WHOAKSFTASYPJ4MSYZLS"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Angela Johnson
üéâ First booking detected for customer: N5H61G6QMGCFM0V4Y9SCWX5N90
   Name: Angela Johnson
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer N5H61G6QMGCFM0V4Y9SCWX5N90...
Error getting custom attributes for customer N5H61G6QMGCFM0V4Y9SCWX5N90: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: N5H61G6QMGCFM0V4Y9SCWX5N90
{"ts":"2025-11-30T16:09:20.212Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"ec374727-ab31-417e-b1d7-fbc006b57634","stage":"booking","correlationId":"booking-created:a82a2e60696c52319daec187"}
{"ts":"2025-11-30T16:09:20.387Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"21c7fb3f-6b5e-461a-9a4f-e711a9332d5e","stage":"booking","correlationId":"booking-created:83991096cd9d3fb5289df0c3","attempts":1}
üìÖ Processing booking created for customer: N5H61G6QMGCFM0V4Y9SCWX5N90
Full booking data: {
  "id": "h6gsy4ptwgg2il",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-14T22:50:00Z",
  "created_at": "2025-11-30T16:00:21Z",
  "updated_at": "2025-11-30T16:00:21Z",
  "customer_id": "N5H61G6QMGCFM0V4Y9SCWX5N90",
  "location_id": "LT4ZHFBQQYB2N",
  "customer_note": "Coming in for wedding manicure the day prior - this is the wedding pedicure, thanks!",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "N5H61G6QMGCFM0V4Y9SCWX5N90",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "resource_ids": [
        "KAOXILA4CV7A23VRAACC4R66"
      ],
      "team_member_id": "TM7_r-KmvY9xjnEU",
      "any_team_member": true,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "63PG6RLS2NHWRD5JRXEC74HN",
      "service_variation_version": 1760895536505,
      "service_variation_client_id": "VZLZVOWNIEIWAQ47FX67GQS4"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Angela Johnson
üéâ First booking detected for customer: N5H61G6QMGCFM0V4Y9SCWX5N90
   Name: Angela Johnson
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer N5H61G6QMGCFM0V4Y9SCWX5N90...
Error getting custom attributes for customer N5H61G6QMGCFM0V4Y9SCWX5N90: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: N5H61G6QMGCFM0V4Y9SCWX5N90
{"ts":"2025-11-30T16:09:20.778Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"21c7fb3f-6b5e-461a-9a4f-e711a9332d5e","stage":"booking","correlationId":"booking-created:83991096cd9d3fb5289df0c3"}
{"ts":"2025-11-30T16:19:32.300Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Server has closed the connection.","stack":"PrismaClientKnownRequestError: Server has closed the connection.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-11-30T16:19:35.351Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"d07f684a-d28f-4d22-a9f8-1f0f63ec9828","stage":"booking","correlationId":"booking-created:a74476f867426a2872e03647","attempts":1}
üìÖ Processing booking created for customer: EREWJ7Y5JPPZMM2GZF599AX89W
Full booking data: {
  "id": "dg3ruaevrfjm26",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-05T23:10:00Z",
  "created_at": "2025-11-30T16:09:53Z",
  "updated_at": "2025-11-30T16:09:53Z",
  "customer_id": "EREWJ7Y5JPPZMM2GZF599AX89W",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "EREWJ7Y5JPPZMM2GZF599AX89W",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMgsjtuk5cfKnstq",
      "any_team_member": false,
      "duration_minutes": 110,
      "intermission_minutes": 0,
      "service_variation_id": "6TYOE67IDYTKHW2ZG6HKVZER",
      "service_variation_version": 1764191999049,
      "service_variation_client_id": "6TYOE67IDYTKHW2ZG6HKVZER"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Amanda Holman
üéâ First booking detected for customer: EREWJ7Y5JPPZMM2GZF599AX89W
   Name: Amanda Holman
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer EREWJ7Y5JPPZMM2GZF599AX89W...
Error getting custom attributes for customer EREWJ7Y5JPPZMM2GZF599AX89W: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: EREWJ7Y5JPPZMM2GZF599AX89W
{"ts":"2025-11-30T16:19:36.044Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"d07f684a-d28f-4d22-a9f8-1f0f63ec9828","stage":"booking","correlationId":"booking-created:a74476f867426a2872e03647"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-11-30T16:53:15.692Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"8b4fa3df-331d-49c5-bde0-774baf533664","stage":"booking","correlationId":"booking-created:c607f5b5baf5f677d1594b04","attempts":1}
üìÖ Processing booking created for customer: R0DJBT1YN08XEV4VQ3Q2V11354
Full booking data: {
  "id": "8wfyjnpaot4j7a",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-06T01:40:00Z",
  "created_at": "2025-11-30T16:46:42Z",
  "updated_at": "2025-11-30T16:46:42Z",
  "customer_id": "R0DJBT1YN08XEV4VQ3Q2V11354",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "R0DJBT1YN08XEV4VQ3Q2V11354",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMkdrQsxG5tlf-c_",
      "any_team_member": true,
      "duration_minutes": 140,
      "intermission_minutes": 0,
      "service_variation_id": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "CJI5WHOAKSFTASYPJ4MSYZLS"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Rira Raisi
üéâ First booking detected for customer: R0DJBT1YN08XEV4VQ3Q2V11354
   Name: Rira Raisi
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer R0DJBT1YN08XEV4VQ3Q2V11354...
Error getting custom attributes for customer R0DJBT1YN08XEV4VQ3Q2V11354: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: R0DJBT1YN08XEV4VQ3Q2V11354
{"ts":"2025-11-30T16:53:16.424Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"8b4fa3df-331d-49c5-bde0-774baf533664","stage":"booking","correlationId":"booking-created:c607f5b5baf5f677d1594b04"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-11-30T17:11:04.350Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"6e0cac11-2b49-4d76-bccc-678d43d1bc4f","stage":"customer_ingest","correlationId":"customer-created:af00bd6f27f93a5d5ab0a2f3","attempts":1}
üì• Received customer data: {
  "id": "9M72Y57P3VDWDHPYN8YGNRGB1R",
  "address": {
    "country": "US"
  },
  "version": 0,
  "group_ids": [
    "LT4ZHFBQQYB2N.APPOINTMENTS"
  ],
  "created_at": "2025-11-30T17:05:12.718Z",
  "given_name": "Leezae",
  "updated_at": "2025-11-30T17:05:12Z",
  "family_name": "Russell",
  "preferences": {
    "email_unsubscribed": false
  },
  "phone_number": "+15105041399",
  "email_address": "leezaerussell@gmail.com",
  "creation_source": "APPOINTMENTS"
}
üë§ Processing customer creation: 9M72Y57P3VDWDHPYN8YGNRGB1R
üìç IP Address: unknown
üìß Email: leezaerussell@gmail.com
üìû Phone: +15105041399
üë§ Name: Leezae Russell
‚ö†Ô∏è Suspicious IP activity detected: unknown used by 109 customers
‚ö†Ô∏è Suspicious activity detected for customer 9M72Y57P3VDWDHPYN8YGNRGB1R, flagging for review
üéâ New customer detected: 9M72Y57P3VDWDHPYN8YGNRGB1R
‚úÖ Customer added to database as NEW (temporary mark)
   - Will check for referral code when they book
   - Will give gift card on first booking if code found
‚úÖ Verification: Customer found in DB: true
{"ts":"2025-11-30T17:11:05.001Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"6e0cac11-2b49-4d76-bccc-678d43d1bc4f","stage":"customer_ingest","correlationId":"customer-created:af00bd6f27f93a5d5ab0a2f3"}
{"ts":"2025-11-30T17:11:05.162Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"baa87b9d-b9c8-4f93-9ab2-2886fcc22181","stage":"booking","correlationId":"booking-created:f065ad15553f0e9821bf4017","attempts":1}
üìÖ Processing booking created for customer: 9M72Y57P3VDWDHPYN8YGNRGB1R
Full booking data: {
  "id": "tckobolnna77s5",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-01T19:30:00Z",
  "created_at": "2025-11-30T17:05:15Z",
  "updated_at": "2025-11-30T17:05:15Z",
  "customer_id": "9M72Y57P3VDWDHPYN8YGNRGB1R",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "9M72Y57P3VDWDHPYN8YGNRGB1R",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TM7_r-KmvY9xjnEU",
      "any_team_member": true,
      "duration_minutes": 150,
      "intermission_minutes": 0,
      "service_variation_id": "FKVQUFGSG7BFA55SUPGKTCWF",
      "service_variation_version": 1760141204155,
      "service_variation_client_id": "FKVQUFGSG7BFA55SUPGKTCWF"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Leezae Russell
üéâ First booking detected for customer: 9M72Y57P3VDWDHPYN8YGNRGB1R
   Name: Leezae Russell
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 9M72Y57P3VDWDHPYN8YGNRGB1R...
Error getting custom attributes for customer 9M72Y57P3VDWDHPYN8YGNRGB1R: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 9M72Y57P3VDWDHPYN8YGNRGB1R
{"ts":"2025-11-30T17:11:05.576Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"baa87b9d-b9c8-4f93-9ab2-2886fcc22181","stage":"booking","correlationId":"booking-created:f065ad15553f0e9821bf4017"}
{"ts":"2025-11-30T17:20:32.200Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Server has closed the connection.","stack":"PrismaClientKnownRequestError: Server has closed the connection.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-11-30T17:37:20.368Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"419e4f98-0800-420c-8412-a5637886f8aa","stage":"booking","correlationId":"booking-created:76b75a76b42a6d7b0801582e","attempts":1}
üìÖ Processing booking created for customer: HPGX3PGJ1FTZ83Z76H1ZDC14JW
Full booking data: {
  "id": "d6yx3nbyeb3p1y",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-03T19:20:00Z",
  "created_at": "2025-11-30T17:24:36Z",
  "updated_at": "2025-11-30T17:24:36Z",
  "customer_id": "HPGX3PGJ1FTZ83Z76H1ZDC14JW",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "HPGX3PGJ1FTZ83Z76H1ZDC14JW",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMOscywuGXO2VURY",
      "any_team_member": true,
      "duration_minutes": 140,
      "intermission_minutes": 0,
      "service_variation_id": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "CJI5WHOAKSFTASYPJ4MSYZLS"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Kristen Witte
üéâ First booking detected for customer: HPGX3PGJ1FTZ83Z76H1ZDC14JW
   Name: Kristen Witte
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer HPGX3PGJ1FTZ83Z76H1ZDC14JW...
Error getting custom attributes for customer HPGX3PGJ1FTZ83Z76H1ZDC14JW: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: HPGX3PGJ1FTZ83Z76H1ZDC14JW
{"ts":"2025-11-30T17:37:21.145Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"419e4f98-0800-420c-8412-a5637886f8aa","stage":"booking","correlationId":"booking-created:76b75a76b42a6d7b0801582e"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-11-30T17:54:19.502Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"10c8ff12-c499-4218-833c-2dbffa7c9b0e","stage":"booking","correlationId":"booking-created:6368363858acc7eafeab7efb","attempts":1}
üìÖ Processing booking created for customer: MM92YMA3PA3SP7H7ENH4K6CDYM
Full booking data: {
  "id": "jy4alttpubpx5q",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-03T17:00:00Z",
  "created_at": "2025-11-30T17:46:44Z",
  "updated_at": "2025-11-30T17:46:44Z",
  "customer_id": "MM92YMA3PA3SP7H7ENH4K6CDYM",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "MM92YMA3PA3SP7H7ENH4K6CDYM",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMMBgVwykMnOlumA",
      "any_team_member": true,
      "duration_minutes": 140,
      "intermission_minutes": 0,
      "service_variation_id": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "CJI5WHOAKSFTASYPJ4MSYZLS"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Stephania Stavropoulos
üéâ First booking detected for customer: MM92YMA3PA3SP7H7ENH4K6CDYM
   Name: Stephania Stavropoulos
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer MM92YMA3PA3SP7H7ENH4K6CDYM...
Error getting custom attributes for customer MM92YMA3PA3SP7H7ENH4K6CDYM: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: MM92YMA3PA3SP7H7ENH4K6CDYM
{"ts":"2025-11-30T17:54:20.276Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"10c8ff12-c499-4218-833c-2dbffa7c9b0e","stage":"booking","correlationId":"booking-created:6368363858acc7eafeab7efb"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-11-30T18:11:43.543Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"caf04193-bbd9-4353-a490-71f1ef94edc7","stage":"booking","correlationId":"booking-created:479e8d104ef78290176cc6e3","attempts":1}
üìÖ Processing booking created for customer: 9CE709PP621PNJZVYGJFRS119C
Full booking data: {
  "id": "7kqf60dwq02s8p",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-01T19:20:00Z",
  "created_at": "2025-11-30T18:05:31Z",
  "updated_at": "2025-11-30T18:05:31Z",
  "customer_id": "9CE709PP621PNJZVYGJFRS119C",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "9CE709PP621PNJZVYGJFRS119C",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMOscywuGXO2VURY",
      "any_team_member": true,
      "duration_minutes": 140,
      "intermission_minutes": 0,
      "service_variation_id": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "CJI5WHOAKSFTASYPJ4MSYZLS"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Jessica Jones
üéâ First booking detected for customer: 9CE709PP621PNJZVYGJFRS119C
   Name: Jessica Jones
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 9CE709PP621PNJZVYGJFRS119C...
Error getting custom attributes for customer 9CE709PP621PNJZVYGJFRS119C: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 9CE709PP621PNJZVYGJFRS119C
{"ts":"2025-11-30T18:11:44.226Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"caf04193-bbd9-4353-a490-71f1ef94edc7","stage":"booking","correlationId":"booking-created:479e8d104ef78290176cc6e3"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-11-30T18:38:52.114Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"fcafac28-ea28-4f9a-ab1f-1fa35e8b0aaf","stage":"booking","correlationId":"booking-created:3c2555aa1fa043387922d289","attempts":1}
üìÖ Processing booking created for customer: 9TPS15NVHPNSTA8VG282P50QRM
Full booking data: {
  "id": "gqmres6qsas7fh",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-02T00:30:00Z",
  "created_at": "2025-11-30T18:34:33Z",
  "updated_at": "2025-11-30T18:34:33Z",
  "customer_id": "9TPS15NVHPNSTA8VG282P50QRM",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "9TPS15NVHPNSTA8VG282P50QRM",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMNW4SIF7tjp4oM_",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "BRSIGZFOWC6F4ERPKX3CODLU",
      "service_variation_version": 1764191999049,
      "service_variation_client_id": "BRSIGZFOWC6F4ERPKX3CODLU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Rachel Price
üéâ First booking detected for customer: 9TPS15NVHPNSTA8VG282P50QRM
   Name: Rachel Price
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 9TPS15NVHPNSTA8VG282P50QRM...
Error getting custom attributes for customer 9TPS15NVHPNSTA8VG282P50QRM: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 9TPS15NVHPNSTA8VG282P50QRM
{"ts":"2025-11-30T18:38:52.966Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"fcafac28-ea28-4f9a-ab1f-1fa35e8b0aaf","stage":"booking","correlationId":"booking-created:3c2555aa1fa043387922d289"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-11-30T18:56:03.607Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"033341c6-238e-48b6-be80-e63ac99c0176","stage":"booking","correlationId":"booking-created:b6786dc18a1fd88c486c67c7","attempts":1}
üìÖ Processing booking created for customer: 018GF1W55VG4BSBZKZXBSED3NR
Full booking data: {
  "id": "vgwah9gr5gijhe",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-20T20:20:00Z",
  "created_at": "2025-11-30T18:43:58Z",
  "updated_at": "2025-11-30T18:43:58Z",
  "customer_id": "018GF1W55VG4BSBZKZXBSED3NR",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "018GF1W55VG4BSBZKZXBSED3NR",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TM-zXe9fXe4axYWn",
      "any_team_member": true,
      "duration_minutes": 140,
      "intermission_minutes": 0,
      "service_variation_id": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "CJI5WHOAKSFTASYPJ4MSYZLS"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Devon Acosta
üéâ First booking detected for customer: 018GF1W55VG4BSBZKZXBSED3NR
   Name: Devon Acosta
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 018GF1W55VG4BSBZKZXBSED3NR...
Error getting custom attributes for customer 018GF1W55VG4BSBZKZXBSED3NR: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 018GF1W55VG4BSBZKZXBSED3NR
{"ts":"2025-11-30T18:56:04.460Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"033341c6-238e-48b6-be80-e63ac99c0176","stage":"booking","correlationId":"booking-created:b6786dc18a1fd88c486c67c7"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-11-30T19:12:40.460Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"f672e1f3-8d65-4207-aba5-0e400963bc05","stage":"booking","correlationId":"booking-created:908ce3cb9623f69098925f6d","attempts":1}
üìÖ Processing booking created for customer: B8PK45VWHFBG81H9R5322WYE3C
Full booking data: {
  "id": "gfq4kl8yxrhs97",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-17T19:20:00Z",
  "created_at": "2025-11-30T18:57:12Z",
  "updated_at": "2025-11-30T18:57:12Z",
  "customer_id": "B8PK45VWHFBG81H9R5322WYE3C",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "B8PK45VWHFBG81H9R5322WYE3C",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMe-bT5XxKxmk0nw",
      "any_team_member": true,
      "duration_minutes": 140,
      "intermission_minutes": 0,
      "service_variation_id": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "CJI5WHOAKSFTASYPJ4MSYZLS"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Aubree Holly
üéâ First booking detected for customer: B8PK45VWHFBG81H9R5322WYE3C
   Name: Aubree Holly
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer B8PK45VWHFBG81H9R5322WYE3C...
Error getting custom attributes for customer B8PK45VWHFBG81H9R5322WYE3C: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: B8PK45VWHFBG81H9R5322WYE3C
{"ts":"2025-11-30T19:12:41.155Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"f672e1f3-8d65-4207-aba5-0e400963bc05","stage":"booking","correlationId":"booking-created:908ce3cb9623f69098925f6d"}
{"ts":"2025-11-30T19:12:41.315Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"50d988b4-3804-4039-8f0f-3f32b5c2a783","stage":"booking","correlationId":"booking-created:381599981068bc4a5aaa163a","attempts":1}
üìÖ Processing booking created for customer: 6XW971FQS4D8Y01EHA23YGV3PW
Full booking data: {
  "id": "53v4bsyq4xl71a",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-01T18:00:00Z",
  "created_at": "2025-11-30T19:00:55Z",
  "updated_at": "2025-11-30T19:00:55Z",
  "customer_id": "6XW971FQS4D8Y01EHA23YGV3PW",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMQPbDVvvOCLwqsy"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMNW4SIF7tjp4oM_",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "BRSIGZFOWC6F4ERPKX3CODLU",
      "service_variation_version": 1762893947284,
      "service_variation_client_id": "BRSIGZFOWC6F4ERPKX3CODLU"
    },
    {
      "team_member_id": "TMNW4SIF7tjp4oM_",
      "any_team_member": false,
      "duration_minutes": 20,
      "intermission_minutes": 0,
      "service_variation_id": "HAJX45W3U2WUCCXM5MI24UEE",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "HAJX45W3U2WUCCXM5MI24UEE"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Kelly Stavish
üéâ First booking detected for customer: 6XW971FQS4D8Y01EHA23YGV3PW
   Name: Kelly Stavish
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 6XW971FQS4D8Y01EHA23YGV3PW...
Error getting custom attributes for customer 6XW971FQS4D8Y01EHA23YGV3PW: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 6XW971FQS4D8Y01EHA23YGV3PW
{"ts":"2025-11-30T19:12:41.704Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"50d988b4-3804-4039-8f0f-3f32b5c2a783","stage":"booking","correlationId":"booking-created:381599981068bc4a5aaa163a"}
{"ts":"2025-11-30T19:22:32.470Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Server has closed the connection.","stack":"PrismaClientKnownRequestError: Server has closed the connection.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-11-30T19:22:35.132Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"9fd70490-d32a-4f97-a74b-1588186f5971","stage":"booking","correlationId":"booking-created:4fb6d1c562b603eec60fe962","attempts":1}
üìÖ Processing booking created for customer: W4RFDE1A7N2CX7HF2X6D3ZTX5R
Full booking data: {
  "id": "e82kzm0px1k9mq",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-10T18:30:00Z",
  "created_at": "2025-11-30T19:20:54Z",
  "updated_at": "2025-11-30T19:20:54Z",
  "customer_id": "W4RFDE1A7N2CX7HF2X6D3ZTX5R",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMWAtQTYmZpwwxii"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMVwAQUdLz6no-cB",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    },
    {
      "team_member_id": "TMVwAQUdLz6no-cB",
      "any_team_member": false,
      "duration_minutes": 5,
      "intermission_minutes": 0,
      "service_variation_id": "DBRXEHQPCF7V4APTHDQTZW62",
      "service_variation_version": 1762374620368,
      "service_variation_client_id": "DBRXEHQPCF7V4APTHDQTZW62"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Karina Nechaeva
üéâ First booking detected for customer: W4RFDE1A7N2CX7HF2X6D3ZTX5R
   Name: Karina Nechaeva
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer W4RFDE1A7N2CX7HF2X6D3ZTX5R...
Error getting custom attributes for customer W4RFDE1A7N2CX7HF2X6D3ZTX5R: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: W4RFDE1A7N2CX7HF2X6D3ZTX5R
{"ts":"2025-11-30T19:22:35.844Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"9fd70490-d32a-4f97-a74b-1588186f5971","stage":"booking","correlationId":"booking-created:4fb6d1c562b603eec60fe962"}
{"ts":"2025-11-30T19:22:36.008Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"6b4a88f8-89ea-4426-910a-6684bc15df45","stage":"booking","correlationId":"booking-created:b005abad192db7652256208c","attempts":1}
üìÖ Processing booking created for customer: NAPS7QWF3KY5E7P68X24SB606R
Full booking data: {
  "id": "pihcc75h6s1vbv",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-01T17:00:00Z",
  "created_at": "2025-11-30T19:21:08Z",
  "updated_at": "2025-11-30T19:21:08Z",
  "customer_id": "NAPS7QWF3KY5E7P68X24SB606R",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "NAPS7QWF3KY5E7P68X24SB606R",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMOscywuGXO2VURY",
      "any_team_member": true,
      "duration_minutes": 140,
      "intermission_minutes": 0,
      "service_variation_id": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "CJI5WHOAKSFTASYPJ4MSYZLS"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Zuzana Mimochodek
üéâ First booking detected for customer: NAPS7QWF3KY5E7P68X24SB606R
   Name: Zuzana Mimochodek
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer NAPS7QWF3KY5E7P68X24SB606R...
Error getting custom attributes for customer NAPS7QWF3KY5E7P68X24SB606R: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: NAPS7QWF3KY5E7P68X24SB606R
{"ts":"2025-11-30T19:22:36.396Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"6b4a88f8-89ea-4426-910a-6684bc15df45","stage":"booking","correlationId":"booking-created:b005abad192db7652256208c"}
{"ts":"2025-11-30T19:22:36.558Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"e3518fa3-ab95-43df-a566-2bae565caefe","stage":"booking","correlationId":"booking-created:7431f4d7352c88bcb2e84407","attempts":1}
üìÖ Processing booking created for customer: W4RFDE1A7N2CX7HF2X6D3ZTX5R
Full booking data: {
  "id": "2omubhhvrquayw",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-10T18:30:00Z",
  "created_at": "2025-11-30T19:21:09Z",
  "updated_at": "2025-11-30T19:21:09Z",
  "customer_id": "W4RFDE1A7N2CX7HF2X6D3ZTX5R",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMWAtQTYmZpwwxii"
  },
  "appointment_segments": [
    {
      "resource_ids": [
        "F2MBRCC42VNNDWXNA3PAMHEU"
      ],
      "team_member_id": "TMXiw38Bbb7XQUWI",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "ZEAKNB35I37RMXNUBGWDZQIM",
      "service_variation_version": 1760895536505,
      "service_variation_client_id": "ZEAKNB35I37RMXNUBGWDZQIM"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Karina Nechaeva
üéâ First booking detected for customer: W4RFDE1A7N2CX7HF2X6D3ZTX5R
   Name: Karina Nechaeva
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer W4RFDE1A7N2CX7HF2X6D3ZTX5R...
Error getting custom attributes for customer W4RFDE1A7N2CX7HF2X6D3ZTX5R: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: W4RFDE1A7N2CX7HF2X6D3ZTX5R
{"ts":"2025-11-30T19:22:36.951Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"e3518fa3-ab95-43df-a566-2bae565caefe","stage":"booking","correlationId":"booking-created:7431f4d7352c88bcb2e84407"}
{"ts":"2025-11-30T19:38:14.087Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"364da581-d4e3-42a0-b657-ffdb1f476adf","stage":"payment","correlationId":"payment-updated:e8299960d0166480c0526928","attempts":1}
üí∞ Processing payment completion for customer: 3TP2FH9DJ94C1ENRC8QK038430
   Payment source_type: CARD
   Payment tender_types: []
Customer 3TP2FH9DJ94C1ENRC8QK038430 already completed first payment
{"ts":"2025-11-30T19:38:14.511Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"364da581-d4e3-42a0-b657-ffdb1f476adf","stage":"payment","correlationId":"payment-updated:e8299960d0166480c0526928"}
{"ts":"2025-11-30T19:38:14.685Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"4225141f-8e7b-4e4e-9f98-da6fb8b126a0","stage":"payment","correlationId":"payment-updated:d936d9d60fb608f490c2c1f1","attempts":1}
üí∞ Processing payment completion for customer: 3TP2FH9DJ94C1ENRC8QK038430
   Payment source_type: CARD
   Payment tender_types: []
Customer 3TP2FH9DJ94C1ENRC8QK038430 already completed first payment
{"ts":"2025-11-30T19:38:14.826Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"4225141f-8e7b-4e4e-9f98-da6fb8b126a0","stage":"payment","correlationId":"payment-updated:d936d9d60fb608f490c2c1f1"}
{"ts":"2025-11-30T19:38:14.987Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"589dd441-bbcb-4b86-b03e-cdb319babe9f","stage":"payment","correlationId":"payment-updated:d06bc1e799218a4f645ed235","attempts":1}
üí∞ Processing payment completion for customer: 8PPEPBG25QK2HEH2CSSD24J7CC
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Aiesha Green
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Aiesha Green, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Aiesha Green
   - Email: aieshanicole1212@yahoo.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: 8PPEPBG25QK2HEH2CSSD24J7CC
{"ts":"2025-11-30T19:38:15.315Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"589dd441-bbcb-4b86-b03e-cdb319babe9f","stage":"payment","correlationId":"payment-updated:d06bc1e799218a4f645ed235"}
{"ts":"2025-11-30T19:38:15.479Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"4840efb3-be81-4d1f-8ef1-1f291f8697eb","stage":"payment","correlationId":"payment-updated:6817531dcc2d8cb186763dce","attempts":1}
üí∞ Processing payment completion for customer: 8PPEPBG25QK2HEH2CSSD24J7CC
   Payment source_type: CARD
   Payment tender_types: []
Customer 8PPEPBG25QK2HEH2CSSD24J7CC already completed first payment
{"ts":"2025-11-30T19:38:15.615Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"4840efb3-be81-4d1f-8ef1-1f291f8697eb","stage":"payment","correlationId":"payment-updated:6817531dcc2d8cb186763dce"}
{"ts":"2025-11-30T19:38:15.825Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"d8f0d4bb-1743-448f-85b0-4045f9c06a19","stage":"payment","correlationId":"payment-updated:2270644471a1b430b21617ef","attempts":1}
üí∞ Processing payment completion for customer: DVMAN54KJVGC981DAYJV0RFAV0
   Payment source_type: CARD
   Payment tender_types: []
Customer DVMAN54KJVGC981DAYJV0RFAV0 already completed first payment
{"ts":"2025-11-30T19:38:16.014Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"d8f0d4bb-1743-448f-85b0-4045f9c06a19","stage":"payment","correlationId":"payment-updated:2270644471a1b430b21617ef"}
{"ts":"2025-11-30T19:38:16.177Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"70060fcd-49c5-4adf-879e-d2b1d3058d52","stage":"payment","correlationId":"payment-updated:7c65a9e329dfc73f787dd81e","attempts":1}
üí∞ Processing payment completion for customer: DVMAN54KJVGC981DAYJV0RFAV0
   Payment source_type: CARD
   Payment tender_types: []
Customer DVMAN54KJVGC981DAYJV0RFAV0 already completed first payment
{"ts":"2025-11-30T19:38:16.317Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"70060fcd-49c5-4adf-879e-d2b1d3058d52","stage":"payment","correlationId":"payment-updated:7c65a9e329dfc73f787dd81e"}
{"ts":"2025-11-30T19:38:16.480Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"7f91ff35-c5aa-4e81-a1db-aa72355090d8","stage":"payment","correlationId":"payment-updated:45b833146e7964d2ae1f5847","attempts":1}
üí∞ Processing payment completion for customer: QK0JEQ7Y7D3SK9VK8JA9KKZA7R
   Payment source_type: CARD
   Payment tender_types: []
Customer QK0JEQ7Y7D3SK9VK8JA9KKZA7R already completed first payment
{"ts":"2025-11-30T19:38:16.619Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"7f91ff35-c5aa-4e81-a1db-aa72355090d8","stage":"payment","correlationId":"payment-updated:45b833146e7964d2ae1f5847"}
{"ts":"2025-11-30T19:38:16.779Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"d55a2b4d-f582-4cc0-9cdd-a153bd2864a7","stage":"payment","correlationId":"payment-updated:02eb8edcbf18da7d928e693a","attempts":1}
{"ts":"2025-11-30T19:54:14.432Z","level":"error","event":"giftcard.worker.job.failed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"d55a2b4d-f582-4cc0-9cdd-a153bd2864a7","stage":"payment","correlationId":"payment-updated:02eb8edcbf18da7d928e693a","attempts":1,"error":"\nInvalid `prisma.$queryRaw()` invocation:\n\n\nServer has closed the connection."}
{"ts":"2025-11-30T19:54:14.944Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"\nInvalid `prisma.$queryRaw()` invocation:\n\n\nRaw query failed. Code: `42804`. Message: `ERROR: column \"status\" is of type \"GiftCardJobStatus\" but expression is of type text\nHINT: You will need to rewrite or cast the expression.`","stack":"PrismaClientKnownRequestError: \nInvalid `prisma.$queryRaw()` invocation:\n\n\nRaw query failed. Code: `42804`. Message: `ERROR: column \"status\" is of type \"GiftCardJobStatus\" but expression is of type text\nHINT: You will need to rewrite or cast the expression.`\n    at $n.handleRequestError (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:121:7315)\n    at $n.handleAndLogRequestError (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:121:6623)\n    at $n.request (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:121:6307)\n    at async l (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:9633)\n    at async failGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:334:18)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:146:9)"}
{"ts":"2025-11-30T19:54:17.284Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"d5922839-d02f-4157-9832-940574460bd3","stage":"booking","correlationId":"booking-created:38f72dbef433d51fa2cf67bb","attempts":1}
üìÖ Processing booking created for customer: HP0M7F82N752PTA1D9TECBDPC4
Full booking data: {
  "id": "aovyby3ne44r6b",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-01T21:30:00Z",
  "created_at": "2025-11-30T19:29:31Z",
  "updated_at": "2025-11-30T19:29:31Z",
  "customer_id": "HP0M7F82N752PTA1D9TECBDPC4",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMWAtQTYmZpwwxii"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMVwAQUdLz6no-cB",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    },
    {
      "team_member_id": "TMVwAQUdLz6no-cB",
      "any_team_member": false,
      "duration_minutes": 10,
      "intermission_minutes": 0,
      "service_variation_id": "HAJX45W3U2WUCCXM5MI24UEE",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "HAJX45W3U2WUCCXM5MI24UEE"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Kimia Rahmani
üéâ First booking detected for customer: HP0M7F82N752PTA1D9TECBDPC4
   Name: Kimia Rahmani
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer HP0M7F82N752PTA1D9TECBDPC4...
Error getting custom attributes for customer HP0M7F82N752PTA1D9TECBDPC4: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: HP0M7F82N752PTA1D9TECBDPC4
{"ts":"2025-11-30T19:54:17.885Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"d5922839-d02f-4157-9832-940574460bd3","stage":"booking","correlationId":"booking-created:38f72dbef433d51fa2cf67bb"}
{"ts":"2025-11-30T19:54:18.038Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"f92c39ff-fefb-446a-a37b-26224d6a405c","stage":"payment","correlationId":"payment-updated:5e10d7f86cfabe0b38db5a78","attempts":1}
üí∞ Processing payment completion for customer: QK0JEQ7Y7D3SK9VK8JA9KKZA7R
   Payment source_type: CARD
   Payment tender_types: []
Customer QK0JEQ7Y7D3SK9VK8JA9KKZA7R already completed first payment
{"ts":"2025-11-30T19:54:18.171Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"f92c39ff-fefb-446a-a37b-26224d6a405c","stage":"payment","correlationId":"payment-updated:5e10d7f86cfabe0b38db5a78"}
{"ts":"2025-11-30T19:54:18.328Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"4b53dee5-9533-4ffd-a64b-e433e401824e","stage":"payment","correlationId":"payment-updated:cf0be0773ece4e592b9d1ffb","attempts":1}
üí∞ Processing payment completion for customer: QK0JEQ7Y7D3SK9VK8JA9KKZA7R
   Payment source_type: CARD
   Payment tender_types: []
Customer QK0JEQ7Y7D3SK9VK8JA9KKZA7R already completed first payment
{"ts":"2025-11-30T19:54:18.463Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"4b53dee5-9533-4ffd-a64b-e433e401824e","stage":"payment","correlationId":"payment-updated:cf0be0773ece4e592b9d1ffb"}
{"ts":"2025-11-30T19:54:18.616Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"7e589158-c1f8-4638-8c52-e8fb328d3fdd","stage":"booking","correlationId":"booking-created:fd794a2ddb0b590ede5b9137","attempts":1}
üìÖ Processing booking created for customer: G9CNQX34X3Y76X7P4WXN1GNZC0
Full booking data: {
  "id": "30hxp12g1v4xxq",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-07T20:00:00Z",
  "created_at": "2025-11-30T19:51:10Z",
  "updated_at": "2025-11-30T19:51:10Z",
  "customer_id": "G9CNQX34X3Y76X7P4WXN1GNZC0",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "G9CNQX34X3Y76X7P4WXN1GNZC0",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMEWAZHdtaiRR_Zs",
      "any_team_member": true,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Izzy Acton
üéâ First booking detected for customer: G9CNQX34X3Y76X7P4WXN1GNZC0
   Name: Izzy Acton
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer G9CNQX34X3Y76X7P4WXN1GNZC0...
Error getting custom attributes for customer G9CNQX34X3Y76X7P4WXN1GNZC0: timeout of 60000ms exceeded
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: G9CNQX34X3Y76X7P4WXN1GNZC0
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-11-30T20:10:15.484Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"7e589158-c1f8-4638-8c52-e8fb328d3fdd","stage":"booking","correlationId":"booking-created:fd794a2ddb0b590ede5b9137"}
{"ts":"2025-11-30T20:10:15.745Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"f3ed5964-f86b-4775-806d-57d958eee307","stage":"payment","correlationId":"payment-updated:be46b6a1e1d2fb11b8a06747","attempts":1}
{"ts":"2025-11-30T20:23:32.233Z","level":"error","event":"giftcard.worker.job.failed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"f3ed5964-f86b-4775-806d-57d958eee307","stage":"payment","correlationId":"payment-updated:be46b6a1e1d2fb11b8a06747","attempts":1,"error":"\nInvalid `prisma.$queryRaw()` invocation:\n\n\nServer has closed the connection."}
{"ts":"2025-11-30T20:23:32.793Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"\nInvalid `prisma.$queryRaw()` invocation:\n\n\nRaw query failed. Code: `42804`. Message: `ERROR: column \"status\" is of type \"GiftCardJobStatus\" but expression is of type text\nHINT: You will need to rewrite or cast the expression.`","stack":"PrismaClientKnownRequestError: \nInvalid `prisma.$queryRaw()` invocation:\n\n\nRaw query failed. Code: `42804`. Message: `ERROR: column \"status\" is of type \"GiftCardJobStatus\" but expression is of type text\nHINT: You will need to rewrite or cast the expression.`\n    at $n.handleRequestError (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:121:7315)\n    at $n.handleAndLogRequestError (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:121:6623)\n    at $n.request (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:121:6307)\n    at async l (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:9633)\n    at async failGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:334:18)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:146:9)"}
{"ts":"2025-11-30T20:23:35.091Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"675ef8e2-5e8a-4f82-992c-506db9111a8c","stage":"payment","correlationId":"payment-updated:713fff247363a88fb3f818f7","attempts":1}
üí∞ Processing payment completion for customer: 5J78047WQ76JWSX8467HNPNSM8
   Payment source_type: CARD
   Payment tender_types: []
Customer 5J78047WQ76JWSX8467HNPNSM8 already completed first payment
{"ts":"2025-11-30T20:23:35.444Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"675ef8e2-5e8a-4f82-992c-506db9111a8c","stage":"payment","correlationId":"payment-updated:713fff247363a88fb3f818f7"}
{"ts":"2025-11-30T20:23:35.606Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"c47080a1-0bd6-4577-a869-7678f0d1bdbe","stage":"payment","correlationId":"payment-updated:18d6f3fc0edfce8392a33f99","attempts":1}
üí∞ Processing payment completion for customer: EH4YGAQT1A52RA6FFV9MZS8MGM
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Arnie Mijos
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Arnie Mijos, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Arnie Mijos
   - Email: arnie.mijos@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: EH4YGAQT1A52RA6FFV9MZS8MGM
{"ts":"2025-11-30T20:23:35.939Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"c47080a1-0bd6-4577-a869-7678f0d1bdbe","stage":"payment","correlationId":"payment-updated:18d6f3fc0edfce8392a33f99"}
{"ts":"2025-11-30T20:23:36.168Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"b63c86c8-6be0-48aa-b13a-5a5d27a8ab12","stage":"payment","correlationId":"payment-updated:26787180d3d5f211f4df11a7","attempts":1}
üí∞ Processing payment completion for customer: EH4YGAQT1A52RA6FFV9MZS8MGM
   Payment source_type: CARD
   Payment tender_types: []
Customer EH4YGAQT1A52RA6FFV9MZS8MGM already completed first payment
{"ts":"2025-11-30T20:23:36.537Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"b63c86c8-6be0-48aa-b13a-5a5d27a8ab12","stage":"payment","correlationId":"payment-updated:26787180d3d5f211f4df11a7"}
{"ts":"2025-11-30T20:23:36.760Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"a204d3bd-dc38-4224-a2c1-9d352ba65e82","stage":"booking","correlationId":"booking-created:935010b47febea5c10d9d187","attempts":1}
üìÖ Processing booking created for customer: HNF0R9FVTTW27X2N2QT30YFQ9M
Full booking data: {
  "id": "qdo6ewj3acl5rr",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-10T01:30:00Z",
  "created_at": "2025-11-30T20:13:08Z",
  "updated_at": "2025-11-30T20:13:08Z",
  "customer_id": "HNF0R9FVTTW27X2N2QT30YFQ9M",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "HNF0R9FVTTW27X2N2QT30YFQ9M",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TM9jDlRr_Hl4rdBB",
      "any_team_member": false,
      "duration_minutes": 20,
      "intermission_minutes": 0,
      "service_variation_id": "HAJX45W3U2WUCCXM5MI24UEE",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "HAJX45W3U2WUCCXM5MI24UEE"
    },
    {
      "team_member_id": "TM9jDlRr_Hl4rdBB",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "XBUDIMNKOPC2XVG5YLIQ4RYS",
      "service_variation_version": 1764191999049,
      "service_variation_client_id": "XBUDIMNKOPC2XVG5YLIQ4RYS"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Corinne Shields
üéâ First booking detected for customer: HNF0R9FVTTW27X2N2QT30YFQ9M
   Name: Corinne Shields
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer HNF0R9FVTTW27X2N2QT30YFQ9M...
Error getting custom attributes for customer HNF0R9FVTTW27X2N2QT30YFQ9M: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: HNF0R9FVTTW27X2N2QT30YFQ9M
{"ts":"2025-11-30T20:23:37.398Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"a204d3bd-dc38-4224-a2c1-9d352ba65e82","stage":"booking","correlationId":"booking-created:935010b47febea5c10d9d187"}
{"ts":"2025-11-30T20:23:37.559Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"177b6aaa-4796-4ae5-91b8-c1d29aa95f82","stage":"payment","correlationId":"payment-updated:87b9ba2d50bff3e6d2ab7e5f","attempts":1}
üí∞ Processing payment completion for customer: KX775VJY13BF0BNA9G81MA8PYM
   Payment source_type: CARD
   Payment tender_types: []
Customer KX775VJY13BF0BNA9G81MA8PYM already completed first payment
{"ts":"2025-11-30T20:23:37.699Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"177b6aaa-4796-4ae5-91b8-c1d29aa95f82","stage":"payment","correlationId":"payment-updated:87b9ba2d50bff3e6d2ab7e5f"}
{"ts":"2025-11-30T20:23:37.861Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"8fb1d743-d819-4248-ae39-a0ef830d7410","stage":"payment","correlationId":"payment-updated:1105ea68d995b23f9c592a07","attempts":1}
üí∞ Processing payment completion for customer: KX775VJY13BF0BNA9G81MA8PYM
   Payment source_type: CARD
   Payment tender_types: []
Customer KX775VJY13BF0BNA9G81MA8PYM already completed first payment
{"ts":"2025-11-30T20:23:38.001Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"8fb1d743-d819-4248-ae39-a0ef830d7410","stage":"payment","correlationId":"payment-updated:1105ea68d995b23f9c592a07"}
{"ts":"2025-11-30T20:23:38.162Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"0d761615-8004-4594-bdad-a257d249f6f8","stage":"booking","correlationId":"booking-created:3df63c16500a80c24a48cfac","attempts":1}
üìÖ Processing booking created for customer: DVMAN54KJVGC981DAYJV0RFAV0
Full booking data: {
  "id": "s68mjst54vsr3j",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-28T18:00:00Z",
  "created_at": "2025-11-30T20:18:04Z",
  "updated_at": "2025-11-30T20:18:04Z",
  "customer_id": "DVMAN54KJVGC981DAYJV0RFAV0",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "DVMAN54KJVGC981DAYJV0RFAV0",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMMHlgFBIFbMTRap",
      "any_team_member": false,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Alyssa Chazen-Richards
üéâ First booking detected for customer: DVMAN54KJVGC981DAYJV0RFAV0
   Name: Alyssa Chazen-Richards
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer DVMAN54KJVGC981DAYJV0RFAV0...
Error getting custom attributes for customer DVMAN54KJVGC981DAYJV0RFAV0: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: DVMAN54KJVGC981DAYJV0RFAV0
{"ts":"2025-11-30T20:23:38.551Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"0d761615-8004-4594-bdad-a257d249f6f8","stage":"booking","correlationId":"booking-created:3df63c16500a80c24a48cfac"}
{"ts":"2025-11-30T20:23:38.712Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"49397662-34a1-45df-8b4d-19c110402583","stage":"payment","correlationId":"payment-updated:ac2243b2f912bcfc223a47a9","attempts":1}
üí∞ Processing payment completion for customer: B8PK45VWHFBG81H9R5322WYE3C
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Aubree Holly
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Aubree Holly, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Aubree Holly
   - Email: aaholly@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: B8PK45VWHFBG81H9R5322WYE3C
{"ts":"2025-11-30T20:23:39.028Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"49397662-34a1-45df-8b4d-19c110402583","stage":"payment","correlationId":"payment-updated:ac2243b2f912bcfc223a47a9"}
{"ts":"2025-11-30T20:23:39.191Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"a123adeb-9124-42bc-acb3-dbee5ec5d6df","stage":"payment","correlationId":"payment-updated:4c4da4aa13e6521076156106","attempts":1}
üí∞ Processing payment completion for customer: B8PK45VWHFBG81H9R5322WYE3C
   Payment source_type: CARD
   Payment tender_types: []
Customer B8PK45VWHFBG81H9R5322WYE3C already completed first payment
{"ts":"2025-11-30T20:23:39.331Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"a123adeb-9124-42bc-acb3-dbee5ec5d6df","stage":"payment","correlationId":"payment-updated:4c4da4aa13e6521076156106"}
{"ts":"2025-11-30T20:23:39.495Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"ae813ddb-b8dd-4a68-9189-c340658efc4b","stage":"payment","correlationId":"payment-updated:20d0a5b8a0cb0f4b3726d9ac","attempts":1}
üí∞ Processing payment completion for customer: 4FHCGEFMW90VH05BPEKBRHPQ9G
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Kirti Shenoy
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Kirti Shenoy, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Kirti Shenoy
   - Email: shenoykir@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: 4FHCGEFMW90VH05BPEKBRHPQ9G
{"ts":"2025-11-30T20:23:39.811Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"ae813ddb-b8dd-4a68-9189-c340658efc4b","stage":"payment","correlationId":"payment-updated:20d0a5b8a0cb0f4b3726d9ac"}
{"ts":"2025-11-30T20:23:39.976Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"83ca4e1b-6981-4e0b-9062-3e8ce04f9940","stage":"payment","correlationId":"payment-updated:1d51da4513b1b614c484207b","attempts":1}
üí∞ Processing payment completion for customer: 4FHCGEFMW90VH05BPEKBRHPQ9G
   Payment source_type: CARD
   Payment tender_types: []
Customer 4FHCGEFMW90VH05BPEKBRHPQ9G already completed first payment
{"ts":"2025-11-30T20:23:40.113Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"83ca4e1b-6981-4e0b-9062-3e8ce04f9940","stage":"payment","correlationId":"payment-updated:1d51da4513b1b614c484207b"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-11-30T20:42:03.361Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Server has closed the connection.","stack":"PrismaClientKnownRequestError: Server has closed the connection.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-11-30T20:42:05.975Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"290dc4a2-7e2a-4d4d-896d-4d31eebdb6a6","stage":"payment","correlationId":"payment-updated:ccb8716fd30a8180312f9da6","attempts":1}
üí∞ Processing payment completion for customer: 4FHCGEFMW90VH05BPEKBRHPQ9G
   Payment source_type: CARD
   Payment tender_types: []
Customer 4FHCGEFMW90VH05BPEKBRHPQ9G already completed first payment
{"ts":"2025-11-30T20:42:06.415Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"290dc4a2-7e2a-4d4d-896d-4d31eebdb6a6","stage":"payment","correlationId":"payment-updated:ccb8716fd30a8180312f9da6"}
{"ts":"2025-11-30T20:42:06.573Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"6d1268c3-d467-472f-aadd-a0733b354d64","stage":"payment","correlationId":"payment-updated:f5ef8d4622b723c149974608","attempts":1}
üí∞ Processing payment completion for customer: 4FHCGEFMW90VH05BPEKBRHPQ9G
   Payment source_type: CARD
   Payment tender_types: []
Customer 4FHCGEFMW90VH05BPEKBRHPQ9G already completed first payment
{"ts":"2025-11-30T20:42:06.709Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"6d1268c3-d467-472f-aadd-a0733b354d64","stage":"payment","correlationId":"payment-updated:f5ef8d4622b723c149974608"}
{"ts":"2025-11-30T20:42:06.872Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"1a19d0c4-8340-4256-bacf-4a7075f6f2ab","stage":"booking","correlationId":"booking-created:f84fe5c7dfc992f6f4dcf42c","attempts":1}
üìÖ Processing booking created for customer: SEEWHWAN3H2YNDW8GGQ65GWCTM
Full booking data: {
  "id": "hjo99cfcxsixfa",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-19T23:30:00Z",
  "created_at": "2025-11-30T20:37:57Z",
  "updated_at": "2025-11-30T20:37:57Z",
  "customer_id": "SEEWHWAN3H2YNDW8GGQ65GWCTM",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "SEEWHWAN3H2YNDW8GGQ65GWCTM",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMgsjtuk5cfKnstq",
      "any_team_member": false,
      "duration_minutes": 110,
      "intermission_minutes": 0,
      "service_variation_id": "6TYOE67IDYTKHW2ZG6HKVZER",
      "service_variation_version": 1764191999049,
      "service_variation_client_id": "6TYOE67IDYTKHW2ZG6HKVZER"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Tiffani Trevethan
üéâ First booking detected for customer: SEEWHWAN3H2YNDW8GGQ65GWCTM
   Name: Tiffani Trevethan
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer SEEWHWAN3H2YNDW8GGQ65GWCTM...
Error getting custom attributes for customer SEEWHWAN3H2YNDW8GGQ65GWCTM: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: SEEWHWAN3H2YNDW8GGQ65GWCTM
{"ts":"2025-11-30T20:42:07.274Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"1a19d0c4-8340-4256-bacf-4a7075f6f2ab","stage":"booking","correlationId":"booking-created:f84fe5c7dfc992f6f4dcf42c"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-11-30T20:57:37.421Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"e38c4578-6992-469e-9c1a-2ee45d5148c8","stage":"payment","correlationId":"payment-updated:75421ac05b4348ffedc36e21","attempts":1}
üí∞ Processing payment completion for customer: D6DAGEY5YMWNRTXERPR7XVAMY0
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Daisy Long
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Daisy Long, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Daisy Long
   - Email: daisyduyenlong@yahoo.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: D6DAGEY5YMWNRTXERPR7XVAMY0
{"ts":"2025-11-30T20:57:38.016Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"e38c4578-6992-469e-9c1a-2ee45d5148c8","stage":"payment","correlationId":"payment-updated:75421ac05b4348ffedc36e21"}
{"ts":"2025-11-30T20:57:38.176Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"c43f73ba-47ce-4680-a083-b3f1d8a0c0b8","stage":"payment","correlationId":"payment-updated:d33a9422f006575cb6b44459","attempts":1}
üí∞ Processing payment completion for customer: D6DAGEY5YMWNRTXERPR7XVAMY0
   Payment source_type: CARD
   Payment tender_types: []
Customer D6DAGEY5YMWNRTXERPR7XVAMY0 already completed first payment
{"ts":"2025-11-30T20:57:38.444Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"c43f73ba-47ce-4680-a083-b3f1d8a0c0b8","stage":"payment","correlationId":"payment-updated:d33a9422f006575cb6b44459"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-11-30T21:13:02.414Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"47c47d74-baf8-4b34-8df5-7aef8be8fb91","stage":"customer_ingest","correlationId":"customer-created:c0c3d510e186d592d9109506","attempts":1}
üì• Received customer data: {
  "id": "HDBQDJ6MGJW3NVX4VJCR28VYSM",
  "address": {
    "country": "US"
  },
  "version": 0,
  "group_ids": [
    "LT4ZHFBQQYB2N.APPOINTMENTS"
  ],
  "created_at": "2025-11-30T21:05:08.357Z",
  "given_name": "Crystal",
  "updated_at": "2025-11-30T21:05:08Z",
  "family_name": "H",
  "preferences": {
    "email_unsubscribed": false
  },
  "phone_number": "+12024598975",
  "email_address": "crystal2011_2012@yahoo.com",
  "creation_source": "APPOINTMENTS"
}
üë§ Processing customer creation: HDBQDJ6MGJW3NVX4VJCR28VYSM
üìç IP Address: unknown
üìß Email: crystal2011_2012@yahoo.com
üìû Phone: +12024598975
üë§ Name: Crystal H
‚ö†Ô∏è Suspicious IP activity detected: unknown used by 110 customers
‚ö†Ô∏è Suspicious activity detected for customer HDBQDJ6MGJW3NVX4VJCR28VYSM, flagging for review
üéâ New customer detected: HDBQDJ6MGJW3NVX4VJCR28VYSM
‚úÖ Customer added to database as NEW (temporary mark)
   - Will check for referral code when they book
   - Will give gift card on first booking if code found
‚úÖ Verification: Customer found in DB: true
{"ts":"2025-11-30T21:13:03.132Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"47c47d74-baf8-4b34-8df5-7aef8be8fb91","stage":"customer_ingest","correlationId":"customer-created:c0c3d510e186d592d9109506"}
{"ts":"2025-11-30T21:13:03.294Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"cc87341a-5830-49ad-86ce-4bc218067bc1","stage":"booking","correlationId":"booking-created:f00d75af1b8ab7e9bc73d2d1","attempts":1}
üìÖ Processing booking created for customer: HDBQDJ6MGJW3NVX4VJCR28VYSM
Full booking data: {
  "id": "xmoiynebeyutef",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-02T00:30:00Z",
  "created_at": "2025-11-30T21:05:11Z",
  "updated_at": "2025-11-30T21:05:11Z",
  "customer_id": "HDBQDJ6MGJW3NVX4VJCR28VYSM",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "HDBQDJ6MGJW3NVX4VJCR28VYSM",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMyUMvTJIj2HrHSg",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "JMTK5M2CY2W7WEXSTAJKAJ35",
      "service_variation_version": 1764191999049,
      "service_variation_client_id": "JMTK5M2CY2W7WEXSTAJKAJ35"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Crystal H
üéâ First booking detected for customer: HDBQDJ6MGJW3NVX4VJCR28VYSM
   Name: Crystal H
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer HDBQDJ6MGJW3NVX4VJCR28VYSM...
Error getting custom attributes for customer HDBQDJ6MGJW3NVX4VJCR28VYSM: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: HDBQDJ6MGJW3NVX4VJCR28VYSM
{"ts":"2025-11-30T21:13:03.738Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"cc87341a-5830-49ad-86ce-4bc218067bc1","stage":"booking","correlationId":"booking-created:f00d75af1b8ab7e9bc73d2d1"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-11-30T21:24:34.452Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"698e1ccc-da4b-47f8-84fd-00662e99783f","stage":"booking","correlationId":"booking-created:cefd46b47dfe801fe9d5c59c","attempts":1}
üìÖ Processing booking created for customer: 3JJ106WK58FG67W38X2SAMTSF8
Full booking data: {
  "id": "eugy88w315y7cz",
  "source": "THIRD_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-08T20:30:00Z",
  "created_at": "2025-11-30T21:16:59Z",
  "updated_at": "2025-11-30T21:16:59Z",
  "customer_id": "3JJ106WK58FG67W38X2SAMTSF8",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "3JJ106WK58FG67W38X2SAMTSF8",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMVwAQUdLz6no-cB",
      "any_team_member": false,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Symone Parker
üéâ First booking detected for customer: 3JJ106WK58FG67W38X2SAMTSF8
   Name: Symone Parker
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 3JJ106WK58FG67W38X2SAMTSF8...
Error getting custom attributes for customer 3JJ106WK58FG67W38X2SAMTSF8: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 3JJ106WK58FG67W38X2SAMTSF8
{"ts":"2025-11-30T21:24:35.180Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"698e1ccc-da4b-47f8-84fd-00662e99783f","stage":"booking","correlationId":"booking-created:cefd46b47dfe801fe9d5c59c"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-11-30T21:42:14.399Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Server has closed the connection.","stack":"PrismaClientKnownRequestError: Server has closed the connection.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-11-30T21:42:17.187Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"546e4e0f-48e5-47e2-917c-912d79e6bf1e","stage":"payment","correlationId":"payment-updated:a622f477a1613aefb57eb407","attempts":1}
üí∞ Processing payment completion for customer: EDAP6Z012DMZHGTSXQMT56MKPM
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Kristine Blukis
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Kristine Blukis, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Kristine Blukis
   - Email: krizdole@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: EDAP6Z012DMZHGTSXQMT56MKPM
{"ts":"2025-11-30T21:42:17.784Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"546e4e0f-48e5-47e2-917c-912d79e6bf1e","stage":"payment","correlationId":"payment-updated:a622f477a1613aefb57eb407"}
{"ts":"2025-11-30T21:42:17.943Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"b0ace9e6-26b9-40a4-a375-dc05ec5be1cf","stage":"payment","correlationId":"payment-updated:d023c600618f9a441141c6ba","attempts":1}
üí∞ Processing payment completion for customer: EDAP6Z012DMZHGTSXQMT56MKPM
   Payment source_type: CARD
   Payment tender_types: []
Customer EDAP6Z012DMZHGTSXQMT56MKPM already completed first payment
{"ts":"2025-11-30T21:42:18.083Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"b0ace9e6-26b9-40a4-a375-dc05ec5be1cf","stage":"payment","correlationId":"payment-updated:d023c600618f9a441141c6ba"}
{"ts":"2025-11-30T21:42:18.242Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"0db77a0e-28e7-4fc2-98e4-477904e9c3fa","stage":"payment","correlationId":"payment-updated:be3e3eab4413e4c0342e26a7","attempts":1}
üí∞ Processing payment completion for customer: 2AHGJZNGG1XFQG37ABTYYVE6KW
   Payment source_type: CASH
   Payment tender_types: []
üéâ First payment completed for customer: Melissa Daimler
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Melissa Daimler, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Melissa Daimler
   - Email: Melissa.daimler@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: 2AHGJZNGG1XFQG37ABTYYVE6KW
{"ts":"2025-11-30T21:42:18.557Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"0db77a0e-28e7-4fc2-98e4-477904e9c3fa","stage":"payment","correlationId":"payment-updated:be3e3eab4413e4c0342e26a7"}
{"ts":"2025-11-30T21:42:18.716Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"d50b3c87-0ea9-4810-8cac-9bb6c22b376b","stage":"booking","correlationId":"booking-created:1e806c98bdd93358f1140d69","attempts":1}
{"ts":"2025-11-30T21:57:46.261Z","level":"error","event":"giftcard.worker.job.failed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"d50b3c87-0ea9-4810-8cac-9bb6c22b376b","stage":"booking","correlationId":"booking-created:1e806c98bdd93358f1140d69","attempts":1,"error":"\nInvalid `prisma.$queryRaw()` invocation:\n\n\nServer has closed the connection."}
{"ts":"2025-11-30T21:57:47.362Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"\nInvalid `prisma.$queryRaw()` invocation:\n\n\nRaw query failed. Code: `42804`. Message: `ERROR: column \"status\" is of type \"GiftCardJobStatus\" but expression is of type text\nHINT: You will need to rewrite or cast the expression.`","stack":"PrismaClientKnownRequestError: \nInvalid `prisma.$queryRaw()` invocation:\n\n\nRaw query failed. Code: `42804`. Message: `ERROR: column \"status\" is of type \"GiftCardJobStatus\" but expression is of type text\nHINT: You will need to rewrite or cast the expression.`\n    at $n.handleRequestError (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:121:7315)\n    at $n.handleAndLogRequestError (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:121:6623)\n    at $n.request (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:121:6307)\n    at async l (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:9633)\n    at async failGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:334:18)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:146:9)"}
{"ts":"2025-11-30T21:57:49.734Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"68b7e357-0f56-4470-bece-968c45e87db5","stage":"payment","correlationId":"payment-updated:4bf1266864b77d13655f7826","attempts":1}
üí∞ Processing payment completion for customer: 87D21GV129KTGEXZY3J7AZC1RC
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Jennifer Lau
‚ùå Referrer not found for code: null
‚úÖ Generated new personal_code in name+ID format: JENNIFER9371
‚ùå Error creating/loading gift card for Jennifer Lau: Response status code was not ok: 401.
Square API errors: [
  {
    "category": "AUTHENTICATION_ERROR",
    "code": "UNAUTHORIZED",
    "detail": "This request could not be authorized."
  }
]
‚ùå Failed to create referrer gift card
Error upserting custom attribute "square:a3dde506-f69e-48e4-a98a-004c1822d3ad" for customer 87D21GV129KTGEXZY3J7AZC1RC: Response status code was not ok: 401.
Square API errors: [
  {
    "category": "AUTHENTICATION_ERROR",
    "code": "UNAUTHORIZED",
    "detail": "This request could not be authorized."
  }
]
Error appending referral note for customer 87D21GV129KTGEXZY3J7AZC1RC: timeout of 60000ms exceeded
‚ùå Error sending referral email to jlau82694@gmail.com: Unauthorized
SendGrid error details: {
  errors: [
    {
      message: 'The provided authorization grant is invalid, expired, or revoked',
      field: null,
      help: null
    }
  ]
}
‚ö†Ô∏è Analytics operation "notification_event" failed: 
Invalid `prisma.notificationEvent.create()` invocation in
/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/analytics-service.js:164:39

  161 return runAnalyticsOperation(
  162   'notification_event',
  163   async () => {
‚Üí 164     return prisma.notificationEvent.create({
            data: {
              channel: "EMAIL",
              templateType: "REFERRAL_INVITE",
              status: "failed",
              createdAt: new Date("2025-11-30T22:09:31.844Z"),
              errorCode: 401,
                         ~~~
              errorMessage: "Unauthorized",
              metadata: {
                email: "jlau82694@gmail.com",
                referralCode: "JENNIFER9371",
                referralUrl: "https://referral-system-salon-fbbq6x1wt-umis-projects-e802f152.vercel.app/ref/JENNIFER9371",
                suppressionGroupId: 28008
              }
            }
          })

Argument `errorCode`: Invalid value provided. Expected String or Null, provided Int.
‚ùå Failed to send email: Unauthorized
‚ÑπÔ∏è SMS sending disabled. Would send referral link to +16465120429
‚è∏Ô∏è SMS sending disabled (skipped sending to +16465120429)
üìß Referral code generated and sent:
   - Customer: Jennifer Lau
   - Email: jlau82694@gmail.com
   - Referral Code: JENNIFER9371
   - Referral URL: https://referral-system-salon-fbbq6x1wt-umis-projects-e802f152.vercel.app/ref/JENNIFER9371
   - Gift Card ID: null
   - Status: Customer is now a referrer
‚úÖ Referral code sent to new client:
   - Customer: Jennifer Lau
   - Email: jlau82694@gmail.com
   - Referral Code: JENNIFER9371
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: 87D21GV129KTGEXZY3J7AZC1RC
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-11-30T22:09:32.663Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"68b7e357-0f56-4470-bece-968c45e87db5","stage":"payment","correlationId":"payment-updated:4bf1266864b77d13655f7826"}
{"ts":"2025-11-30T22:09:32.938Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"1add134e-fd06-456b-9eb9-11b918d6841b","stage":"payment","correlationId":"payment-updated:04655795582ac76200fb00a6","attempts":1}
üí∞ Processing payment completion for customer: 87D21GV129KTGEXZY3J7AZC1RC
   Payment source_type: CARD
   Payment tender_types: []
Customer 87D21GV129KTGEXZY3J7AZC1RC already completed first payment
{"ts":"2025-11-30T22:09:33.121Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"1add134e-fd06-456b-9eb9-11b918d6841b","stage":"payment","correlationId":"payment-updated:04655795582ac76200fb00a6"}
{"ts":"2025-11-30T22:09:33.277Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"6ac92da0-4df4-4bf5-ae74-cd8708fc67ef","stage":"payment","correlationId":"payment-updated:d0bb289c05f92e686f32db64","attempts":1}
üí∞ Processing payment completion for customer: 87TA83C64WXA2J0WWDSJ2ZG5S4
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Mallory North
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Mallory North, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Mallory North
   - Email: north.mallory@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: 87TA83C64WXA2J0WWDSJ2ZG5S4
{"ts":"2025-11-30T22:09:33.602Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"6ac92da0-4df4-4bf5-ae74-cd8708fc67ef","stage":"payment","correlationId":"payment-updated:d0bb289c05f92e686f32db64"}
{"ts":"2025-11-30T22:09:33.754Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"bb2c1450-6c8a-4598-87a9-0a54c3fb6d67","stage":"payment","correlationId":"payment-updated:4926ae4a4c0c5235d151f51b","attempts":1}
üí∞ Processing payment completion for customer: 87TA83C64WXA2J0WWDSJ2ZG5S4
   Payment source_type: CARD
   Payment tender_types: []
Customer 87TA83C64WXA2J0WWDSJ2ZG5S4 already completed first payment
{"ts":"2025-11-30T22:09:33.888Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"bb2c1450-6c8a-4598-87a9-0a54c3fb6d67","stage":"payment","correlationId":"payment-updated:4926ae4a4c0c5235d151f51b"}
{"ts":"2025-11-30T22:09:34.042Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"ac179a59-7bb6-4214-a60f-2dbb5a40fa39","stage":"booking","correlationId":"booking-created:3adb660eb25be376e253f6b5","attempts":1}
üìÖ Processing booking created for customer: V9EEXWBNGTBG998HJPHB80WS7W
Full booking data: {
  "id": "i7tcvo6g8strn4",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-05T20:00:00Z",
  "created_at": "2025-11-30T21:44:50Z",
  "updated_at": "2025-11-30T21:44:50Z",
  "customer_id": "V9EEXWBNGTBG998HJPHB80WS7W",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMWAtQTYmZpwwxii"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMEWAZHdtaiRR_Zs",
      "any_team_member": false,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Bethany Hodge
üéâ First booking detected for customer: V9EEXWBNGTBG998HJPHB80WS7W
   Name: Bethany Hodge
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer V9EEXWBNGTBG998HJPHB80WS7W...
Error getting custom attributes for customer V9EEXWBNGTBG998HJPHB80WS7W: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: V9EEXWBNGTBG998HJPHB80WS7W
{"ts":"2025-11-30T22:09:34.475Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"ac179a59-7bb6-4214-a60f-2dbb5a40fa39","stage":"booking","correlationId":"booking-created:3adb660eb25be376e253f6b5"}
{"ts":"2025-11-30T22:09:34.632Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"2c43837a-96ed-4c0c-8be9-9906afa544b1","stage":"booking","correlationId":"booking-created:4c525006ae00dbb8ffc685c5","attempts":1}
üìÖ Processing booking created for customer: V9EEXWBNGTBG998HJPHB80WS7W
Full booking data: {
  "id": "re2j4ggiyjsi90",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-05T20:00:00Z",
  "created_at": "2025-11-30T21:45:06Z",
  "updated_at": "2025-11-30T21:45:06Z",
  "customer_id": "V9EEXWBNGTBG998HJPHB80WS7W",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMWAtQTYmZpwwxii"
  },
  "appointment_segments": [
    {
      "resource_ids": [
        "5OVIQ6GSSUXORACP6T7WBAQ7"
      ],
      "team_member_id": "TMMCVDJoKh3ZkfFo",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "ZEAKNB35I37RMXNUBGWDZQIM",
      "service_variation_version": 1760895536505,
      "service_variation_client_id": "ZEAKNB35I37RMXNUBGWDZQIM"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Bethany Hodge
üéâ First booking detected for customer: V9EEXWBNGTBG998HJPHB80WS7W
   Name: Bethany Hodge
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer V9EEXWBNGTBG998HJPHB80WS7W...
Error getting custom attributes for customer V9EEXWBNGTBG998HJPHB80WS7W: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: V9EEXWBNGTBG998HJPHB80WS7W
{"ts":"2025-11-30T22:09:35.007Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"2c43837a-96ed-4c0c-8be9-9906afa544b1","stage":"booking","correlationId":"booking-created:4c525006ae00dbb8ffc685c5"}
{"ts":"2025-11-30T22:09:35.178Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"cb58d7ed-dfc0-450e-834d-383bfbcc42d6","stage":"booking","correlationId":"booking-created:a832fda0d8bd1d72344bfde2","attempts":1}
üìÖ Processing booking created for customer: 3JJ106WK58FG67W38X2SAMTSF8
Full booking data: {
  "id": "xl61jlpgo41hef",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-20T20:00:00Z",
  "created_at": "2025-11-30T21:48:13Z",
  "updated_at": "2025-11-30T21:48:13Z",
  "customer_id": "3JJ106WK58FG67W38X2SAMTSF8",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMWAtQTYmZpwwxii"
  },
  "appointment_segments": [
    {
      "resource_ids": [
        "5OVIQ6GSSUXORACP6T7WBAQ7"
      ],
      "team_member_id": "TMXiw38Bbb7XQUWI",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "ZEAKNB35I37RMXNUBGWDZQIM",
      "service_variation_version": 1760895536505,
      "service_variation_client_id": "ZEAKNB35I37RMXNUBGWDZQIM"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Symone Parker
üéâ First booking detected for customer: 3JJ106WK58FG67W38X2SAMTSF8
   Name: Symone Parker
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 3JJ106WK58FG67W38X2SAMTSF8...
Error getting custom attributes for customer 3JJ106WK58FG67W38X2SAMTSF8: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 3JJ106WK58FG67W38X2SAMTSF8
{"ts":"2025-11-30T22:09:35.565Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"cb58d7ed-dfc0-450e-834d-383bfbcc42d6","stage":"booking","correlationId":"booking-created:a832fda0d8bd1d72344bfde2"}
{"ts":"2025-11-30T22:09:35.720Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"1f2ac006-0603-44a1-ab73-5d6342dad49b","stage":"payment","correlationId":"payment-updated:3c1d9181903739b3ec0b34c7","attempts":1}
üí∞ Processing payment completion for customer: DKKAD7ZRB0SPQKSYPMFPRACERC
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Mae Heitmann
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Mae Heitmann, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Mae Heitmann
   - Email: maeheitmann@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: DKKAD7ZRB0SPQKSYPMFPRACERC
{"ts":"2025-11-30T22:09:36.036Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"1f2ac006-0603-44a1-ab73-5d6342dad49b","stage":"payment","correlationId":"payment-updated:3c1d9181903739b3ec0b34c7"}
{"ts":"2025-11-30T22:09:36.189Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"8d9ca89a-4b77-4411-9585-ae8150f7482b","stage":"payment","correlationId":"payment-updated:d4eb222309c90f155f6b8e65","attempts":1}
üí∞ Processing payment completion for customer: DKKAD7ZRB0SPQKSYPMFPRACERC
   Payment source_type: CARD
   Payment tender_types: []
Customer DKKAD7ZRB0SPQKSYPMFPRACERC already completed first payment
{"ts":"2025-11-30T22:09:36.323Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"8d9ca89a-4b77-4411-9585-ae8150f7482b","stage":"payment","correlationId":"payment-updated:d4eb222309c90f155f6b8e65"}
{"ts":"2025-11-30T22:09:36.481Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"04c92cf0-8eb7-4849-b3b4-32a2a55bb6f1","stage":"payment","correlationId":"payment-updated:85ca50618b73e4e7317d9240","attempts":1}
No customer ID in payment data, skipping...
Payment data received: {
  "id": "vRrrYtABLqcVYWq6DfEoloYIaIgZY",
  "status": "COMPLETED",
  "version": 3,
  "order_id": "njT8Q2XGcdQJjo1MIsq8yikvM7eZY",
  "created_at": "2025-11-30T22:05:32.031Z",
  "updated_at": "2025-11-30T22:05:34.037Z",
  "location_id": "LT4ZHFBQQYB2N",
  "receipt_url": "https://squareup.com/receipt/preview/vRrrYtABLqcVYWq6DfEoloYIaIgZY",
  "source_type": "CARD",
  "total_money": {
    "amount": 15000,
    "currency": "USD"
  },
  "amount_money": {
    "amount": 15000,
    "currency": "USD"
  },
  "card_details": {
    "card": {
      "bin": "414720",
      "last_4": "6681",
      "exp_year": 2029,
      "card_type": "CREDIT",
      "exp_month": 11,
      "card_brand": "VISA",
      "fingerprint": "sq-1-rEL4fco5BCdsgOKe8VZd6mLUbmYeXPzMQRZwXxhkEv4GqEbrk7YOgwKC9DdNsXQWIg",
      "prepaid_type": "NOT_PREPAID",
      "payment_account_reference": "V0010013021287554451978449711"
    },
    "status": "CAPTURED",
    "avs_status": "AVS_ACCEPTED",
    "cvv_status": "CVV_ACCEPTED",
    "entry_method": "KEYED",
    "auth_result_code": "05968D",
    "card_payment_timeline": {
      "captured_at": "2025-11-30T22:05:32.697Z",
      "authorized_at": "2025-11-30T22:05:32.323Z"
    },
    "statement_description": "SQ *ZORINA NAIL STUDIO 2"
  },
  "delay_action": "CANCEL",
  "delayed_until": "2025-12-07T22:05:32.031Z",
  "approved_money": {
    "amount": 15000,
    "currency": "USD"
  },
  "delay_duration": "PT168H",
  "receipt_number": "vRrr",
  "risk_evaluation": {
    "created_at": "2025-11-30T22:05:32.558Z",
    "risk_level": "NORMAL"
  },
  "application_details": {
    "application_id": "sq0idp-LnQlDEBJrriD2F3rrhnmtg",
    "square_product": "OTHER"
  },
  "buyer_email_address": "mscherer1124@gmail.com"
}
{"ts":"2025-11-30T22:09:36.546Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"04c92cf0-8eb7-4849-b3b4-32a2a55bb6f1","stage":"payment","correlationId":"payment-updated:85ca50618b73e4e7317d9240"}
{"ts":"2025-11-30T22:09:36.704Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"b9c62002-c41a-4b61-9e3d-e46f57a6dd2b","stage":"payment","correlationId":"payment-updated:86ee175f4c07bb41cf047e6f","attempts":1}
üí∞ Processing payment completion for customer: BQM3PY1G4NZG57F6T5M2W05138
   Payment source_type: CARD
   Payment tender_types: []
Customer BQM3PY1G4NZG57F6T5M2W05138 not found in database
{"ts":"2025-11-30T22:09:36.843Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"b9c62002-c41a-4b61-9e3d-e46f57a6dd2b","stage":"payment","correlationId":"payment-updated:86ee175f4c07bb41cf047e6f"}
{"ts":"2025-11-30T22:09:36.995Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"e51ad3ce-ecf1-4bba-a937-d2580694cdb1","stage":"customer_ingest","correlationId":"customer-created:d63a0827026cf9945124fb19","attempts":1}
üì• Received customer data: {
  "id": "BQM3PY1G4NZG57F6T5M2W05138",
  "version": 0,
  "created_at": "2025-11-30T22:05:34.315Z",
  "given_name": "Michael",
  "updated_at": "2025-11-30T22:05:34Z",
  "family_name": "scherer",
  "preferences": {
    "email_unsubscribed": false
  },
  "email_address": "mscherer1124@gmail.com",
  "creation_source": "EGIFTING"
}
üë§ Processing customer creation: BQM3PY1G4NZG57F6T5M2W05138
üìç IP Address: unknown
Error retrieving Square customer BQM3PY1G4NZG57F6T5M2W05138: Response status code was not ok: 401.
Square API errors: [
  {
    "category": "AUTHENTICATION_ERROR",
    "code": "UNAUTHORIZED",
    "detail": "This request could not be authorized."
  }
]
üìß Email: mscherer1124@gmail.com
üìû Phone: None
üë§ Name: Michael scherer
‚ö†Ô∏è Suspicious IP activity detected: unknown used by 111 customers
‚ö†Ô∏è Suspicious activity detected for customer BQM3PY1G4NZG57F6T5M2W05138, flagging for review
üéâ New customer detected: BQM3PY1G4NZG57F6T5M2W05138
‚úÖ Customer added to database as NEW (temporary mark)
   - Will check for referral code when they book
   - Will give gift card on first booking if code found
‚úÖ Verification: Customer found in DB: true
{"ts":"2025-11-30T22:09:37.529Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"e51ad3ce-ecf1-4bba-a937-d2580694cdb1","stage":"customer_ingest","correlationId":"customer-created:d63a0827026cf9945124fb19"}
{"ts":"2025-11-30T22:09:37.683Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"9b5d4008-f46f-49d2-85a3-8bbe6b3bc302","stage":"customer_ingest","correlationId":"customer-created:17f2482ca605d7c1c99610d1","attempts":1}
üì• Received customer data: {
  "id": "F8XKAF2SX6J61RF4YKQKNQXT90",
  "version": 0,
  "created_at": "2025-11-30T22:05:36.437Z",
  "updated_at": "2025-11-30T22:05:36Z",
  "preferences": {
    "email_unsubscribed": false
  },
  "email_address": "kjfriedmann@gmail.com",
  "creation_source": "EGIFTING"
}
üë§ Processing customer creation: F8XKAF2SX6J61RF4YKQKNQXT90
üìç IP Address: unknown
Error retrieving Square customer F8XKAF2SX6J61RF4YKQKNQXT90: Response status code was not ok: 401.
Square API errors: [
  {
    "category": "AUTHENTICATION_ERROR",
    "code": "UNAUTHORIZED",
    "detail": "This request could not be authorized."
  }
]
üìß Email: kjfriedmann@gmail.com
üìû Phone: None
üë§ Name:  
‚ö†Ô∏è Suspicious IP activity detected: unknown used by 112 customers
‚ö†Ô∏è Suspicious activity detected for customer F8XKAF2SX6J61RF4YKQKNQXT90, flagging for review
üéâ New customer detected: F8XKAF2SX6J61RF4YKQKNQXT90
‚úÖ Customer added to database as NEW (temporary mark)
   - Will check for referral code when they book
   - Will give gift card on first booking if code found
‚úÖ Verification: Customer found in DB: true
‚ùå Error processing customer creation: Error: Connection terminated unexpectedly
    at /Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@neondatabase/serverless/index.js:1345:74
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async PrismaNeon.performIO (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/adapter-neon/dist/index.js:427:22)
    at async PrismaNeon.queryRaw (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/adapter-neon/dist/index.js:384:17)
    at async /Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:29:14083 {
  clientVersion: '5.22.0'
}
Stack trace: Error: Connection terminated unexpectedly
    at /Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@neondatabase/serverless/index.js:1345:74
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async PrismaNeon.performIO (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/adapter-neon/dist/index.js:427:22)
    at async PrismaNeon.queryRaw (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/adapter-neon/dist/index.js:384:17)
    at async /Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:29:14083
{"ts":"2025-11-30T22:25:33.625Z","level":"error","event":"giftcard.worker.job.failed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"9b5d4008-f46f-49d2-85a3-8bbe6b3bc302","stage":"customer_ingest","correlationId":"customer-created:17f2482ca605d7c1c99610d1","attempts":1,"error":"Connection terminated unexpectedly"}
{"ts":"2025-11-30T22:25:33.656Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"\nInvalid `prisma.$queryRaw()` invocation:\n\n\nServer has closed the connection.","stack":"PrismaClientKnownRequestError: \nInvalid `prisma.$queryRaw()` invocation:\n\n\nServer has closed the connection.\n    at $n.handleRequestError (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:121:7315)\n    at $n.handleAndLogRequestError (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:121:6623)\n    at $n.request (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:121:6307)\n    at async l (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:9633)\n    at async updateGiftCardRunStage (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/runs/giftcard-run-tracker.js:330:18)\n    at async markGiftCardRunError (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/runs/giftcard-run-tracker.js:364:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:133:9)"}
{"ts":"2025-11-30T22:25:36.288Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"acd91489-db28-4779-9f68-32d4e32593bd","stage":"payment","correlationId":"payment-updated:23e883f3786965ab707c44a9","attempts":1}
üí∞ Processing payment completion for customer: BQM3PY1G4NZG57F6T5M2W05138
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Michael scherer
‚ùå Referrer not found for code: null
‚úÖ Generated new personal_code in name+ID format: MICHAEL5138
‚ùå Error creating/loading gift card for Michael scherer: Response status code was not ok: 401.
Square API errors: [
  {
    "category": "AUTHENTICATION_ERROR",
    "code": "UNAUTHORIZED",
    "detail": "This request could not be authorized."
  }
]
‚ùå Failed to create referrer gift card
Error upserting custom attribute "square:a3dde506-f69e-48e4-a98a-004c1822d3ad" for customer BQM3PY1G4NZG57F6T5M2W05138: Response status code was not ok: 401.
Square API errors: [
  {
    "category": "AUTHENTICATION_ERROR",
    "code": "UNAUTHORIZED",
    "detail": "This request could not be authorized."
  }
]
Error appending referral note for customer BQM3PY1G4NZG57F6T5M2W05138: Response status code was not ok: 401.
Square API errors: [
  {
    "category": "AUTHENTICATION_ERROR",
    "code": "UNAUTHORIZED",
    "detail": "This request could not be authorized."
  }
]
‚ùå Error sending referral email to mscherer1124@gmail.com: Unauthorized
SendGrid error details: {
  errors: [
    {
      message: 'The provided authorization grant is invalid, expired, or revoked',
      field: null,
      help: null
    }
  ]
}
‚ö†Ô∏è Analytics operation "notification_event" failed: 
Invalid `prisma.notificationEvent.create()` invocation in
/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/analytics-service.js:164:39

  161 return runAnalyticsOperation(
  162   'notification_event',
  163   async () => {
‚Üí 164     return prisma.notificationEvent.create({
            data: {
              channel: "EMAIL",
              templateType: "REFERRAL_INVITE",
              status: "failed",
              createdAt: new Date("2025-11-30T22:25:37.724Z"),
              errorCode: 401,
                         ~~~
              errorMessage: "Unauthorized",
              metadata: {
                email: "mscherer1124@gmail.com",
                referralCode: "MICHAEL5138",
                referralUrl: "https://referral-system-salon-fbbq6x1wt-umis-projects-e802f152.vercel.app/ref/MICHAEL5138",
                suppressionGroupId: 28008
              }
            }
          })

Argument `errorCode`: Invalid value provided. Expected String or Null, provided Int.
‚ùå Failed to send email: Unauthorized
‚ÑπÔ∏è Referral SMS not sent ‚Äî missing phone number
üìß Referral code generated and sent:
   - Customer: Michael scherer
   - Email: mscherer1124@gmail.com
   - Referral Code: MICHAEL5138
   - Referral URL: https://referral-system-salon-fbbq6x1wt-umis-projects-e802f152.vercel.app/ref/MICHAEL5138
   - Gift Card ID: null
   - Status: Customer is now a referrer
‚úÖ Referral code sent to new client:
   - Customer: Michael scherer
   - Email: mscherer1124@gmail.com
   - Referral Code: MICHAEL5138
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: BQM3PY1G4NZG57F6T5M2W05138
{"ts":"2025-11-30T22:25:37.937Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"acd91489-db28-4779-9f68-32d4e32593bd","stage":"payment","correlationId":"payment-updated:23e883f3786965ab707c44a9"}
{"ts":"2025-11-30T22:25:38.092Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"bad1367c-970a-4cab-afb1-fb6de8143fec","stage":"payment","correlationId":"payment-updated:3c2a1b3b6d531e0ad639585a","attempts":1}
üí∞ Processing payment completion for customer: BQM3PY1G4NZG57F6T5M2W05138
   Payment source_type: CARD
   Payment tender_types: []
Customer BQM3PY1G4NZG57F6T5M2W05138 already completed first payment
{"ts":"2025-11-30T22:25:38.229Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"bad1367c-970a-4cab-afb1-fb6de8143fec","stage":"payment","correlationId":"payment-updated:3c2a1b3b6d531e0ad639585a"}
{"ts":"2025-11-30T22:25:38.389Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"e0471ccf-3c86-49bb-a440-19ff8a92ef77","stage":"payment","correlationId":"payment-updated:a5a44c63eb79c7acadce6653","attempts":1}
üí∞ Processing payment completion for customer: 8PPEPBG25QK2HEH2CSSD24J7CC
   Payment source_type: CARD
   Payment tender_types: []
Customer 8PPEPBG25QK2HEH2CSSD24J7CC already completed first payment
{"ts":"2025-11-30T22:25:38.528Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"e0471ccf-3c86-49bb-a440-19ff8a92ef77","stage":"payment","correlationId":"payment-updated:a5a44c63eb79c7acadce6653"}
{"ts":"2025-11-30T22:25:38.688Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"2309c1ce-9e9c-4931-86be-8f0e2c3bde8c","stage":"payment","correlationId":"payment-updated:1c7ad730339cbb5367981709","attempts":1}
üí∞ Processing payment completion for customer: 8PPEPBG25QK2HEH2CSSD24J7CC
   Payment source_type: CARD
   Payment tender_types: []
Customer 8PPEPBG25QK2HEH2CSSD24J7CC already completed first payment
{"ts":"2025-11-30T22:25:38.823Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"2309c1ce-9e9c-4931-86be-8f0e2c3bde8c","stage":"payment","correlationId":"payment-updated:1c7ad730339cbb5367981709"}
{"ts":"2025-11-30T22:25:38.980Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"d43a4639-c610-4ddf-afdb-e8015a19e93f","stage":"booking","correlationId":"booking-created:acbf593ddab30e83f6ec4e1c","attempts":1}
üìÖ Processing booking created for customer: 8PPEPBG25QK2HEH2CSSD24J7CC
Full booking data: {
  "id": "otkf3pqafqvk5x",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-21T20:00:00Z",
  "created_at": "2025-11-30T22:21:21Z",
  "updated_at": "2025-11-30T22:21:21Z",
  "customer_id": "8PPEPBG25QK2HEH2CSSD24J7CC",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMWAtQTYmZpwwxii"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMXiw38Bbb7XQUWI",
      "any_team_member": false,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    },
    {
      "resource_ids": [
        "5OVIQ6GSSUXORACP6T7WBAQ7"
      ],
      "team_member_id": "TMXiw38Bbb7XQUWI",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "ZEAKNB35I37RMXNUBGWDZQIM",
      "service_variation_version": 1760895536505,
      "service_variation_client_id": "ZEAKNB35I37RMXNUBGWDZQIM"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Aiesha Green
üéâ First booking detected for customer: 8PPEPBG25QK2HEH2CSSD24J7CC
   Name: Aiesha Green
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 8PPEPBG25QK2HEH2CSSD24J7CC...
Error getting custom attributes for customer 8PPEPBG25QK2HEH2CSSD24J7CC: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 8PPEPBG25QK2HEH2CSSD24J7CC
{"ts":"2025-11-30T22:25:39.370Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"d43a4639-c610-4ddf-afdb-e8015a19e93f","stage":"booking","correlationId":"booking-created:acbf593ddab30e83f6ec4e1c"}
{"ts":"2025-11-30T22:41:43.346Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Server has closed the connection.","stack":"PrismaClientKnownRequestError: Server has closed the connection.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-11-30T22:57:40.197Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"2b4bc1ef-ce74-45d3-97a0-4b7a2f00aeff","stage":"payment","correlationId":"payment-updated:cef4d236e75d6c66eaccdbc9","attempts":1}
üí∞ Processing payment completion for customer: MT77A5DC58XX03KK4J3QDNCPQR
   Payment source_type: CARD
   Payment tender_types: []
Customer MT77A5DC58XX03KK4J3QDNCPQR already completed first payment
{"ts":"2025-11-30T22:57:40.640Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"2b4bc1ef-ce74-45d3-97a0-4b7a2f00aeff","stage":"payment","correlationId":"payment-updated:cef4d236e75d6c66eaccdbc9"}
{"ts":"2025-11-30T22:57:40.800Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"aa76f185-b014-4434-addf-7a21b7ac150d","stage":"payment","correlationId":"payment-updated:6cd8d0d39a174acfbd545975","attempts":1}
üí∞ Processing payment completion for customer: MT77A5DC58XX03KK4J3QDNCPQR
   Payment source_type: CARD
   Payment tender_types: []
Customer MT77A5DC58XX03KK4J3QDNCPQR already completed first payment
{"ts":"2025-11-30T22:57:40.943Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"aa76f185-b014-4434-addf-7a21b7ac150d","stage":"payment","correlationId":"payment-updated:6cd8d0d39a174acfbd545975"}
{"ts":"2025-11-30T22:57:41.102Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"c665243e-b78d-40b0-9030-8f0b08a44333","stage":"booking","correlationId":"booking-created:6ddd67e41b5febe0af1c420d","attempts":1}
üìÖ Processing booking created for customer: MT77A5DC58XX03KK4J3QDNCPQR
Full booking data: {
  "id": "qx7ljcd9ism1v2",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-21T22:30:00Z",
  "created_at": "2025-11-30T22:45:43Z",
  "updated_at": "2025-11-30T22:45:43Z",
  "customer_id": "MT77A5DC58XX03KK4J3QDNCPQR",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMQPbDVvvOCLwqsy"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMNW4SIF7tjp4oM_",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "BRSIGZFOWC6F4ERPKX3CODLU",
      "service_variation_version": 1762893947284,
      "service_variation_client_id": "BRSIGZFOWC6F4ERPKX3CODLU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Elizabeth Brown
üéâ First booking detected for customer: MT77A5DC58XX03KK4J3QDNCPQR
   Name: Elizabeth Brown
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer MT77A5DC58XX03KK4J3QDNCPQR...
Error getting custom attributes for customer MT77A5DC58XX03KK4J3QDNCPQR: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: MT77A5DC58XX03KK4J3QDNCPQR
{"ts":"2025-11-30T22:57:41.509Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"c665243e-b78d-40b0-9030-8f0b08a44333","stage":"booking","correlationId":"booking-created:6ddd67e41b5febe0af1c420d"}
{"ts":"2025-11-30T22:57:41.666Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"69661a3d-7b14-426b-b6cf-691b747528b6","stage":"payment","correlationId":"payment-updated:10da332222a8ad6a4cec9f15","attempts":1}
üí∞ Processing payment completion for customer: SMR44PGNQGG3VZ831QS25TP17M
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Megan Mathews
‚ùå Referrer not found for code: null
‚úÖ Generated new personal_code in name+ID format: MEGAN2517
‚ùå Error creating/loading gift card for Megan Mathews: Response status code was not ok: 401.
Square API errors: [
  {
    "category": "AUTHENTICATION_ERROR",
    "code": "UNAUTHORIZED",
    "detail": "This request could not be authorized."
  }
]
‚ùå Failed to create referrer gift card
Error upserting custom attribute "square:a3dde506-f69e-48e4-a98a-004c1822d3ad" for customer SMR44PGNQGG3VZ831QS25TP17M: Response status code was not ok: 401.
Square API errors: [
  {
    "category": "AUTHENTICATION_ERROR",
    "code": "UNAUTHORIZED",
    "detail": "This request could not be authorized."
  }
]
Error appending referral note for customer SMR44PGNQGG3VZ831QS25TP17M: Response status code was not ok: 401.
Square API errors: [
  {
    "category": "AUTHENTICATION_ERROR",
    "code": "UNAUTHORIZED",
    "detail": "This request could not be authorized."
  }
]
‚ùå Error sending referral email to meganrmathews1@gmail.com: Unauthorized
SendGrid error details: {
  errors: [
    {
      message: 'The provided authorization grant is invalid, expired, or revoked',
      field: null,
      help: null
    }
  ]
}
‚ö†Ô∏è Analytics operation "notification_event" failed: 
Invalid `prisma.notificationEvent.create()` invocation in
/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/analytics-service.js:164:39

  161 return runAnalyticsOperation(
  162   'notification_event',
  163   async () => {
‚Üí 164     return prisma.notificationEvent.create({
            data: {
              channel: "EMAIL",
              templateType: "REFERRAL_INVITE",
              status: "failed",
              createdAt: new Date("2025-11-30T22:57:42.966Z"),
              errorCode: 401,
                         ~~~
              errorMessage: "Unauthorized",
              metadata: {
                email: "meganrmathews1@gmail.com",
                referralCode: "MEGAN2517",
                referralUrl: "https://referral-system-salon-fbbq6x1wt-umis-projects-e802f152.vercel.app/ref/MEGAN2517",
                suppressionGroupId: 28008
              }
            }
          })

Argument `errorCode`: Invalid value provided. Expected String or Null, provided Int.
‚ùå Failed to send email: Unauthorized
‚ö†Ô∏è Phone number (925) 640-4873 is not in E.164 format
‚ÑπÔ∏è SMS sending disabled. Would send referral link to (925) 640-4873
‚è∏Ô∏è SMS sending disabled (skipped sending to (925) 640-4873)
üìß Referral code generated and sent:
   - Customer: Megan Mathews
   - Email: meganrmathews1@gmail.com
   - Referral Code: MEGAN2517
   - Referral URL: https://referral-system-salon-fbbq6x1wt-umis-projects-e802f152.vercel.app/ref/MEGAN2517
   - Gift Card ID: null
   - Status: Customer is now a referrer
‚úÖ Referral code sent to new client:
   - Customer: Megan Mathews
   - Email: meganrmathews1@gmail.com
   - Referral Code: MEGAN2517
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: SMR44PGNQGG3VZ831QS25TP17M
{"ts":"2025-11-30T22:57:43.208Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"69661a3d-7b14-426b-b6cf-691b747528b6","stage":"payment","correlationId":"payment-updated:10da332222a8ad6a4cec9f15"}
{"ts":"2025-11-30T22:57:43.365Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"b70d8e65-6463-4099-89c9-24bc41d075d9","stage":"payment","correlationId":"payment-updated:6bb553d6f96d5da17d59174a","attempts":1}
üí∞ Processing payment completion for customer: SMR44PGNQGG3VZ831QS25TP17M
   Payment source_type: CARD
   Payment tender_types: []
Customer SMR44PGNQGG3VZ831QS25TP17M already completed first payment
{"ts":"2025-11-30T22:57:43.502Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"b70d8e65-6463-4099-89c9-24bc41d075d9","stage":"payment","correlationId":"payment-updated:6bb553d6f96d5da17d59174a"}
{"ts":"2025-11-30T22:57:43.664Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"caadbff9-a2e3-4555-bcaf-47faf5025e3c","stage":"booking","correlationId":"booking-created:0311f3729659de891743fabd","attempts":1}
üìÖ Processing booking created for customer: Q18M3GTWMST22CEPJRJCVMVWNG
Full booking data: {
  "id": "tel7q47w5nizij",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-01T22:00:00Z",
  "created_at": "2025-11-30T22:56:57Z",
  "updated_at": "2025-11-30T22:56:57Z",
  "customer_id": "Q18M3GTWMST22CEPJRJCVMVWNG",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMQPbDVvvOCLwqsy"
  },
  "appointment_segments": [
    {
      "team_member_id": "TM7_r-KmvY9xjnEU",
      "any_team_member": false,
      "duration_minutes": 110,
      "intermission_minutes": 0,
      "service_variation_id": "GJ5SRTYFV6ZCDI62TMSZP2OP",
      "service_variation_version": 1757963765505,
      "service_variation_client_id": "GJ5SRTYFV6ZCDI62TMSZP2OP"
    },
    {
      "team_member_id": "TM7_r-KmvY9xjnEU",
      "any_team_member": false,
      "duration_minutes": 20,
      "intermission_minutes": 0,
      "service_variation_id": "HAJX45W3U2WUCCXM5MI24UEE",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "HAJX45W3U2WUCCXM5MI24UEE"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Eve Lewis
üéâ First booking detected for customer: Q18M3GTWMST22CEPJRJCVMVWNG
   Name: Eve Lewis
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer Q18M3GTWMST22CEPJRJCVMVWNG...
Error getting custom attributes for customer Q18M3GTWMST22CEPJRJCVMVWNG: timeout of 60000ms exceeded
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: Q18M3GTWMST22CEPJRJCVMVWNG
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-11-30T23:15:33.125Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"caadbff9-a2e3-4555-bcaf-47faf5025e3c","stage":"booking","correlationId":"booking-created:0311f3729659de891743fabd"}
{"ts":"2025-11-30T23:15:33.395Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"cc601de7-54e7-4d96-92e9-5da90a8a7b27","stage":"payment","correlationId":"payment-updated:5699e96ef41005392b516e18","attempts":1}
üí∞ Processing payment completion for customer: BJ6W16Y68C8N9KJXW121EB6VN0
   Payment source_type: CARD
   Payment tender_types: []
Customer BJ6W16Y68C8N9KJXW121EB6VN0 already completed first payment
{"ts":"2025-11-30T23:15:33.596Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"cc601de7-54e7-4d96-92e9-5da90a8a7b27","stage":"payment","correlationId":"payment-updated:5699e96ef41005392b516e18"}
{"ts":"2025-11-30T23:15:33.757Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"c45b0700-51be-4955-82bd-5889e324ca0c","stage":"payment","correlationId":"payment-updated:c3ca98fe677cbd427d47bee7","attempts":1}
üí∞ Processing payment completion for customer: BJ6W16Y68C8N9KJXW121EB6VN0
   Payment source_type: CARD
   Payment tender_types: []
Customer BJ6W16Y68C8N9KJXW121EB6VN0 already completed first payment
{"ts":"2025-11-30T23:15:33.898Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"c45b0700-51be-4955-82bd-5889e324ca0c","stage":"payment","correlationId":"payment-updated:c3ca98fe677cbd427d47bee7"}
{"ts":"2025-11-30T23:15:34.069Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"25ac0bcd-939b-4560-a854-bf39010ae2f6","stage":"booking","correlationId":"booking-created:e00def3143c6e71ff1851a72","attempts":1}
üìÖ Processing booking created for customer: BJ6W16Y68C8N9KJXW121EB6VN0
Full booking data: {
  "id": "556t00062d9c09",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-21T18:00:00Z",
  "created_at": "2025-11-30T22:58:16Z",
  "updated_at": "2025-11-30T22:58:16Z",
  "customer_id": "BJ6W16Y68C8N9KJXW121EB6VN0",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMWAtQTYmZpwwxii"
  },
  "appointment_segments": [
    {
      "team_member_id": "TM-zXe9fXe4axYWn",
      "any_team_member": false,
      "duration_minutes": 140,
      "intermission_minutes": 0,
      "service_variation_id": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "CJI5WHOAKSFTASYPJ4MSYZLS"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Caroline Kelly
‚ÑπÔ∏è Customer BJ6W16Y68C8N9KJXW121EB6VN0 already received signup bonus, not first booking
{"ts":"2025-11-30T23:15:34.208Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"25ac0bcd-939b-4560-a854-bf39010ae2f6","stage":"booking","correlationId":"booking-created:e00def3143c6e71ff1851a72"}
{"ts":"2025-11-30T23:15:34.370Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"2da7557d-c4ba-405d-863c-ea592d03451e","stage":"payment","correlationId":"payment-updated:cccfe41efdade92e05c6010f","attempts":1}
üí∞ Processing payment completion for customer: WW7ZMK9PFG7QG0VDYF6Y4BBAHR
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Carla Souza
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Carla Souza, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Carla Souza
   - Email: carlamalia.s@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: WW7ZMK9PFG7QG0VDYF6Y4BBAHR
{"ts":"2025-11-30T23:15:34.690Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"2da7557d-c4ba-405d-863c-ea592d03451e","stage":"payment","correlationId":"payment-updated:cccfe41efdade92e05c6010f"}
{"ts":"2025-11-30T23:15:34.851Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"84de5785-6436-4366-856d-e6ff12b60038","stage":"payment","correlationId":"payment-updated:70be38790cbb64ea20f4f646","attempts":1}
üí∞ Processing payment completion for customer: WW7ZMK9PFG7QG0VDYF6Y4BBAHR
   Payment source_type: CARD
   Payment tender_types: []
Customer WW7ZMK9PFG7QG0VDYF6Y4BBAHR already completed first payment
{"ts":"2025-11-30T23:15:34.990Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"84de5785-6436-4366-856d-e6ff12b60038","stage":"payment","correlationId":"payment-updated:70be38790cbb64ea20f4f646"}
{"ts":"2025-11-30T23:15:35.154Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"79f917ec-cbcd-4d19-b74f-e837d61d5b4e","stage":"payment","correlationId":"payment-updated:84f219d19e903da06732cb5b","attempts":1}
üí∞ Processing payment completion for customer: YCVAFVPN1W5YDYW9T4AE3P2MHR
   Payment source_type: CARD
   Payment tender_types: []
Customer YCVAFVPN1W5YDYW9T4AE3P2MHR already completed first payment
{"ts":"2025-11-30T23:15:35.295Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"79f917ec-cbcd-4d19-b74f-e837d61d5b4e","stage":"payment","correlationId":"payment-updated:84f219d19e903da06732cb5b"}
{"ts":"2025-11-30T23:15:35.453Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"eec06a6a-e8e7-46eb-bd21-937da7c08ba8","stage":"payment","correlationId":"payment-updated:33d04c660409974e1606433e","attempts":1}
üí∞ Processing payment completion for customer: YCVAFVPN1W5YDYW9T4AE3P2MHR
   Payment source_type: CARD
   Payment tender_types: []
Customer YCVAFVPN1W5YDYW9T4AE3P2MHR already completed first payment
{"ts":"2025-11-30T23:15:35.593Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"eec06a6a-e8e7-46eb-bd21-937da7c08ba8","stage":"payment","correlationId":"payment-updated:33d04c660409974e1606433e"}
{"ts":"2025-11-30T23:15:35.758Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"6c3cc758-a847-4db1-8544-21b5e8de3c4e","stage":"booking","correlationId":"booking-created:aa6693875b4cd35c932caabb","attempts":1}
üìÖ Processing booking created for customer: K2QXWS69CWW0WSVZMHQ891TPMR
Full booking data: {
  "id": "gdy5ro3yvp4pii",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-01T01:00:00Z",
  "created_at": "2025-11-30T23:12:25Z",
  "updated_at": "2025-11-30T23:12:25Z",
  "customer_id": "K2QXWS69CWW0WSVZMHQ891TPMR",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMWAtQTYmZpwwxii"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMMBgVwykMnOlumA",
      "any_team_member": false,
      "duration_minutes": 15,
      "intermission_minutes": 0,
      "service_variation_id": "KBHPHVKLJNAF223GMYIRUUH3",
      "service_variation_version": 1760895536505,
      "service_variation_client_id": "KBHPHVKLJNAF223GMYIRUUH3"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Nina Achadjian
üéâ First booking detected for customer: K2QXWS69CWW0WSVZMHQ891TPMR
   Name: Nina Achadjian
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer K2QXWS69CWW0WSVZMHQ891TPMR...
Error getting custom attributes for customer K2QXWS69CWW0WSVZMHQ891TPMR: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: K2QXWS69CWW0WSVZMHQ891TPMR
{"ts":"2025-11-30T23:15:36.163Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"6c3cc758-a847-4db1-8544-21b5e8de3c4e","stage":"booking","correlationId":"booking-created:aa6693875b4cd35c932caabb"}
{"ts":"2025-11-30T23:15:36.323Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"b6e8eb33-95cf-4f4d-939d-5c6a3a1577a7","stage":"payment","correlationId":"payment-updated:bc4ba9658fa5eeed20834786","attempts":1}
üí∞ Processing payment completion for customer: ZQYMGH6ZSSJ8VF7YB6J2TPBPK0
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Noha Nayeri
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Noha Nayeri, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Noha Nayeri
   - Email: Nomcpa@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: ZQYMGH6ZSSJ8VF7YB6J2TPBPK0
{"ts":"2025-11-30T23:15:36.639Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"b6e8eb33-95cf-4f4d-939d-5c6a3a1577a7","stage":"payment","correlationId":"payment-updated:bc4ba9658fa5eeed20834786"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-11-30T23:26:34.365Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"6aefb189-c30f-44d2-89e4-fa566e777918","stage":"payment","correlationId":"payment-updated:566499b17c6772ffdef63817","attempts":1}
üí∞ Processing payment completion for customer: ZQYMGH6ZSSJ8VF7YB6J2TPBPK0
   Payment source_type: CARD
   Payment tender_types: []
Customer ZQYMGH6ZSSJ8VF7YB6J2TPBPK0 already completed first payment
{"ts":"2025-11-30T23:26:34.796Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"6aefb189-c30f-44d2-89e4-fa566e777918","stage":"payment","correlationId":"payment-updated:566499b17c6772ffdef63817"}
{"ts":"2025-11-30T23:42:31.068Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"2a5e2c3b-1df0-48ac-8c3f-6b610352ec32","stage":"payment","correlationId":"payment-updated:4ac19a56fcb2f114a945532d","attempts":1}
üí∞ Processing payment completion for customer: 2C1VE5PYG1ZD8291E2P299G1XG
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Molly Surbridge
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Molly Surbridge, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Molly Surbridge
   - Email: Tamolly54@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: 2C1VE5PYG1ZD8291E2P299G1XG
{"ts":"2025-11-30T23:42:31.663Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"2a5e2c3b-1df0-48ac-8c3f-6b610352ec32","stage":"payment","correlationId":"payment-updated:4ac19a56fcb2f114a945532d"}
{"ts":"2025-11-30T23:42:31.823Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"c6ab5696-c573-4d07-a05c-872c1aa5bd07","stage":"payment","correlationId":"payment-updated:fb278185b511d20b1f2fcfeb","attempts":1}
üí∞ Processing payment completion for customer: 2C1VE5PYG1ZD8291E2P299G1XG
   Payment source_type: CARD
   Payment tender_types: []
Customer 2C1VE5PYG1ZD8291E2P299G1XG already completed first payment
{"ts":"2025-11-30T23:42:31.965Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"c6ab5696-c573-4d07-a05c-872c1aa5bd07","stage":"payment","correlationId":"payment-updated:fb278185b511d20b1f2fcfeb"}
{"ts":"2025-11-30T23:42:32.135Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"fe1055bc-4d67-4d98-a3ea-3a61b7d193ee","stage":"booking","correlationId":"booking-created:7f14ad6f9d9bc02d15aa61a8","attempts":1}
üìÖ Processing booking created for customer: N7G5C5798X7V927ZW29PZ3BCF4
Full booking data: {
  "id": "h4gjeqws0kicx0",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-20T21:00:00Z",
  "created_at": "2025-11-30T23:31:09Z",
  "updated_at": "2025-11-30T23:31:09Z",
  "customer_id": "N7G5C5798X7V927ZW29PZ3BCF4",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "N7G5C5798X7V927ZW29PZ3BCF4",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMkdrQsxG5tlf-c_",
      "any_team_member": true,
      "duration_minutes": 140,
      "intermission_minutes": 0,
      "service_variation_id": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "CJI5WHOAKSFTASYPJ4MSYZLS"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Courtney Giraudo
üéâ First booking detected for customer: N7G5C5798X7V927ZW29PZ3BCF4
   Name: Courtney Giraudo
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer N7G5C5798X7V927ZW29PZ3BCF4...
Error getting custom attributes for customer N7G5C5798X7V927ZW29PZ3BCF4: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: N7G5C5798X7V927ZW29PZ3BCF4
{"ts":"2025-11-30T23:42:32.591Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"fe1055bc-4d67-4d98-a3ea-3a61b7d193ee","stage":"booking","correlationId":"booking-created:7f14ad6f9d9bc02d15aa61a8"}
{"ts":"2025-11-30T23:42:32.746Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"0f623d45-a892-41a5-bada-1c6aad675bae","stage":"payment","correlationId":"payment-updated:d1a3f01dd61004bdf6c523a7","attempts":1}
üí∞ Processing payment completion for customer: TW2JEF01FA528FW9B11ZV58YF8
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Brittany Helm
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Brittany Helm, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Brittany Helm
   - Email: brittany.helm92@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: TW2JEF01FA528FW9B11ZV58YF8
{"ts":"2025-11-30T23:42:33.065Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"0f623d45-a892-41a5-bada-1c6aad675bae","stage":"payment","correlationId":"payment-updated:d1a3f01dd61004bdf6c523a7"}
{"ts":"2025-11-30T23:42:33.224Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"b8b0a066-918a-465e-a4d5-f48aa34a002e","stage":"payment","correlationId":"payment-updated:6f34c4336887e147e207a817","attempts":1}
üí∞ Processing payment completion for customer: TW2JEF01FA528FW9B11ZV58YF8
   Payment source_type: CARD
   Payment tender_types: []
Customer TW2JEF01FA528FW9B11ZV58YF8 already completed first payment
{"ts":"2025-11-30T23:42:33.361Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"b8b0a066-918a-465e-a4d5-f48aa34a002e","stage":"payment","correlationId":"payment-updated:6f34c4336887e147e207a817"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-11-30T23:57:56.065Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"23b2f02b-2914-4fde-93b8-5e2dcb4a53d7","stage":"booking","correlationId":"booking-created:1a538316f2859da0f9b77745","attempts":1}
üìÖ Processing booking created for customer: BST5MHY5Y0RMG0G5MZM0Y3DEB8
Full booking data: {
  "id": "sdx6c0eiirytdn",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-11T22:00:00Z",
  "created_at": "2025-11-30T23:46:21Z",
  "updated_at": "2025-11-30T23:46:21Z",
  "customer_id": "BST5MHY5Y0RMG0G5MZM0Y3DEB8",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "BST5MHY5Y0RMG0G5MZM0Y3DEB8",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMMHlgFBIFbMTRap",
      "any_team_member": false,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Cindy Lloyd
üéâ First booking detected for customer: BST5MHY5Y0RMG0G5MZM0Y3DEB8
   Name: Cindy Lloyd
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer BST5MHY5Y0RMG0G5MZM0Y3DEB8...
Error getting custom attributes for customer BST5MHY5Y0RMG0G5MZM0Y3DEB8: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: BST5MHY5Y0RMG0G5MZM0Y3DEB8
{"ts":"2025-11-30T23:57:56.743Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"23b2f02b-2914-4fde-93b8-5e2dcb4a53d7","stage":"booking","correlationId":"booking-created:1a538316f2859da0f9b77745"}
{"ts":"2025-11-30T23:57:56.895Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"8f37d36a-5817-4fbb-b155-9b8dfe2e1d0b","stage":"booking","correlationId":"booking-created:5981b8ff5cf42e6f111896fd","attempts":1}
üìÖ Processing booking created for customer: 9YTBH773KK9CVE9MDX9DAHDZZW
Full booking data: {
  "id": "7mf8cxgkxq9lwq",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-07T00:00:00Z",
  "created_at": "2025-11-30T23:53:19Z",
  "updated_at": "2025-11-30T23:53:19Z",
  "customer_id": "9YTBH773KK9CVE9MDX9DAHDZZW",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "9YTBH773KK9CVE9MDX9DAHDZZW",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TM9jDlRr_Hl4rdBB",
      "any_team_member": true,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "XBUDIMNKOPC2XVG5YLIQ4RYS",
      "service_variation_version": 1764191999049,
      "service_variation_client_id": "XBUDIMNKOPC2XVG5YLIQ4RYS"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Heidi Newton
üéâ First booking detected for customer: 9YTBH773KK9CVE9MDX9DAHDZZW
   Name: Heidi Newton
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 9YTBH773KK9CVE9MDX9DAHDZZW...
Error getting custom attributes for customer 9YTBH773KK9CVE9MDX9DAHDZZW: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 9YTBH773KK9CVE9MDX9DAHDZZW
{"ts":"2025-11-30T23:57:57.269Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"8f37d36a-5817-4fbb-b155-9b8dfe2e1d0b","stage":"booking","correlationId":"booking-created:5981b8ff5cf42e6f111896fd"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-12-01T00:13:38.153Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"73a55271-d54f-4658-b889-dff77467a626","stage":"payment","correlationId":"payment-updated:2e8b47d8a7cba654935a4abd","attempts":1}
üí∞ Processing payment completion for customer: RABD8GC0GSECA1ZVPBCGFYD6P4
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Paige Berglund
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Paige Berglund, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Paige Berglund
   - Email: Paigie.berglund@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: RABD8GC0GSECA1ZVPBCGFYD6P4
{"ts":"2025-12-01T00:13:38.768Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"73a55271-d54f-4658-b889-dff77467a626","stage":"payment","correlationId":"payment-updated:2e8b47d8a7cba654935a4abd"}
{"ts":"2025-12-01T00:13:38.930Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"6b67382e-5c39-4efc-9cf3-3c103f8a9343","stage":"payment","correlationId":"payment-updated:bd92fb2d928bcaad01e89adf","attempts":1}
üí∞ Processing payment completion for customer: RABD8GC0GSECA1ZVPBCGFYD6P4
   Payment source_type: CARD
   Payment tender_types: []
Customer RABD8GC0GSECA1ZVPBCGFYD6P4 already completed first payment
{"ts":"2025-12-01T00:13:39.069Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"6b67382e-5c39-4efc-9cf3-3c103f8a9343","stage":"payment","correlationId":"payment-updated:bd92fb2d928bcaad01e89adf"}
{"ts":"2025-12-01T00:13:39.226Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"72a74384-e80c-4c17-9b80-04b8fdc8e050","stage":"booking","correlationId":"booking-created:9d7f8fdf838f3e5eabca3d7c","attempts":1}
üìÖ Processing booking created for customer: VFHF70KFZ7D6HJY0QK12ANGHSR
Full booking data: {
  "id": "45cugd2b4dmbg2",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-06T18:00:00Z",
  "created_at": "2025-12-01T00:07:29Z",
  "updated_at": "2025-12-01T00:07:29Z",
  "customer_id": "VFHF70KFZ7D6HJY0QK12ANGHSR",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "VFHF70KFZ7D6HJY0QK12ANGHSR",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMoZGdZlg-iKWTDu",
      "any_team_member": false,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1758921239397,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Cortney Kinchlow
üéâ First booking detected for customer: VFHF70KFZ7D6HJY0QK12ANGHSR
   Name: Cortney Kinchlow
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer VFHF70KFZ7D6HJY0QK12ANGHSR...
Error getting custom attributes for customer VFHF70KFZ7D6HJY0QK12ANGHSR: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: VFHF70KFZ7D6HJY0QK12ANGHSR
{"ts":"2025-12-01T00:13:39.631Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"72a74384-e80c-4c17-9b80-04b8fdc8e050","stage":"booking","correlationId":"booking-created:9d7f8fdf838f3e5eabca3d7c"}
{"ts":"2025-12-01T00:13:39.789Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"0872cdfb-7c57-4890-9f24-f8e3c1825d14","stage":"booking","correlationId":"booking-created:32b28ee939c1ecdcb487931c","attempts":1}
üìÖ Processing booking created for customer: VFHF70KFZ7D6HJY0QK12ANGHSR
Full booking data: {
  "id": "ehmn7t4nka341j",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-20T18:00:00Z",
  "created_at": "2025-12-01T00:09:58Z",
  "updated_at": "2025-12-01T00:09:58Z",
  "customer_id": "VFHF70KFZ7D6HJY0QK12ANGHSR",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "VFHF70KFZ7D6HJY0QK12ANGHSR",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMoZGdZlg-iKWTDu",
      "any_team_member": true,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    },
    {
      "team_member_id": "TMoZGdZlg-iKWTDu",
      "any_team_member": true,
      "duration_minutes": 20,
      "intermission_minutes": 0,
      "service_variation_id": "HAJX45W3U2WUCCXM5MI24UEE",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "HAJX45W3U2WUCCXM5MI24UEE"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Cortney Kinchlow
üéâ First booking detected for customer: VFHF70KFZ7D6HJY0QK12ANGHSR
   Name: Cortney Kinchlow
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer VFHF70KFZ7D6HJY0QK12ANGHSR...
Error getting custom attributes for customer VFHF70KFZ7D6HJY0QK12ANGHSR: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: VFHF70KFZ7D6HJY0QK12ANGHSR
{"ts":"2025-12-01T00:13:40.177Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"0872cdfb-7c57-4890-9f24-f8e3c1825d14","stage":"booking","correlationId":"booking-created:32b28ee939c1ecdcb487931c"}
{"ts":"2025-12-01T00:13:40.336Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"1bb62692-5c22-4456-9ec3-b364c2b76d4d","stage":"booking","correlationId":"booking-created:5b0084725fc3f44a5238c827","attempts":1}
üìÖ Processing booking created for customer: EC61N5410N0HW53XZF78DX5VJ4
Full booking data: {
  "id": "2dwje6lf71oi0w",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-11T21:55:00Z",
  "created_at": "2025-12-01T00:10:04Z",
  "updated_at": "2025-12-01T00:10:04Z",
  "customer_id": "EC61N5410N0HW53XZF78DX5VJ4",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "EC61N5410N0HW53XZF78DX5VJ4",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMgsjtuk5cfKnstq",
      "any_team_member": false,
      "duration_minutes": 110,
      "intermission_minutes": 0,
      "service_variation_id": "6TYOE67IDYTKHW2ZG6HKVZER",
      "service_variation_version": 1758313494744,
      "service_variation_client_id": "6TYOE67IDYTKHW2ZG6HKVZER"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Marina Taylor
üéâ First booking detected for customer: EC61N5410N0HW53XZF78DX5VJ4
   Name: Marina Taylor
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer EC61N5410N0HW53XZF78DX5VJ4...
Error getting custom attributes for customer EC61N5410N0HW53XZF78DX5VJ4: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: EC61N5410N0HW53XZF78DX5VJ4
{"ts":"2025-12-01T00:13:40.739Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"1bb62692-5c22-4456-9ec3-b364c2b76d4d","stage":"booking","correlationId":"booking-created:5b0084725fc3f44a5238c827"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-12-01T00:25:50.764Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"f09b4464-cf67-48f8-94c2-4ce1d1821c6d","stage":"booking","correlationId":"booking-created:5d5c83cb1e72188ff8f25f8d","attempts":1}
üìÖ Processing booking created for customer: ZTSR01VBVMB06HW7ARNKGC5648
Full booking data: {
  "id": "uehj4z04wngmrf",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-23T01:00:00Z",
  "created_at": "2025-12-01T00:19:39Z",
  "updated_at": "2025-12-01T00:19:39Z",
  "customer_id": "ZTSR01VBVMB06HW7ARNKGC5648",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "ZTSR01VBVMB06HW7ARNKGC5648",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TM1L5yPC-yKx6CyO",
      "any_team_member": false,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "NCOIL6ZGDTCC7SO3IJHENCQ2",
      "service_variation_version": 1764191999049,
      "service_variation_client_id": "NCOIL6ZGDTCC7SO3IJHENCQ2"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Emma Stickel
üéâ First booking detected for customer: ZTSR01VBVMB06HW7ARNKGC5648
   Name: Emma Stickel
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer ZTSR01VBVMB06HW7ARNKGC5648...
Error getting custom attributes for customer ZTSR01VBVMB06HW7ARNKGC5648: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: ZTSR01VBVMB06HW7ARNKGC5648
{"ts":"2025-12-01T00:25:51.434Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"f09b4464-cf67-48f8-94c2-4ce1d1821c6d","stage":"booking","correlationId":"booking-created:5d5c83cb1e72188ff8f25f8d"}
{"ts":"2025-12-01T00:25:51.593Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"afa6d80e-e487-487d-9900-b1bba087a214","stage":"booking","correlationId":"booking-created:ba296a59f828e36e06c78b42","attempts":1}
üìÖ Processing booking created for customer: ZTSR01VBVMB06HW7ARNKGC5648
Full booking data: {
  "id": "qsjb9oh84jzkxf",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-22T23:00:00Z",
  "created_at": "2025-12-01T00:21:00Z",
  "updated_at": "2025-12-01T00:21:00Z",
  "customer_id": "ZTSR01VBVMB06HW7ARNKGC5648",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "ZTSR01VBVMB06HW7ARNKGC5648",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TM1L5yPC-yKx6CyO",
      "any_team_member": false,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "NCOIL6ZGDTCC7SO3IJHENCQ2",
      "service_variation_version": 1764191999049,
      "service_variation_client_id": "NCOIL6ZGDTCC7SO3IJHENCQ2"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Emma Stickel
üéâ First booking detected for customer: ZTSR01VBVMB06HW7ARNKGC5648
   Name: Emma Stickel
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer ZTSR01VBVMB06HW7ARNKGC5648...
Error getting custom attributes for customer ZTSR01VBVMB06HW7ARNKGC5648: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: ZTSR01VBVMB06HW7ARNKGC5648
{"ts":"2025-12-01T00:25:52.002Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"afa6d80e-e487-487d-9900-b1bba087a214","stage":"booking","correlationId":"booking-created:ba296a59f828e36e06c78b42"}
{"ts":"2025-12-01T00:25:52.159Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"62f1c3c6-8ef8-45c2-8eb3-06c84638eca5","stage":"booking","correlationId":"booking-created:af14f506601bcbd9ff0e982e","attempts":1}
üìÖ Processing booking created for customer: JJPYJPWQGWRRRK12VH21T5Z4DW
Full booking data: {
  "id": "pqmtmpclw1f0oa",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-14T18:00:00Z",
  "created_at": "2025-12-01T00:21:50Z",
  "updated_at": "2025-12-01T00:21:50Z",
  "customer_id": "JJPYJPWQGWRRRK12VH21T5Z4DW",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "JJPYJPWQGWRRRK12VH21T5Z4DW",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TM-zXe9fXe4axYWn",
      "any_team_member": true,
      "duration_minutes": 140,
      "intermission_minutes": 0,
      "service_variation_id": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "CJI5WHOAKSFTASYPJ4MSYZLS"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Keilani Vega
üéâ First booking detected for customer: JJPYJPWQGWRRRK12VH21T5Z4DW
   Name: Keilani Vega
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer JJPYJPWQGWRRRK12VH21T5Z4DW...
Error getting custom attributes for customer JJPYJPWQGWRRRK12VH21T5Z4DW: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: JJPYJPWQGWRRRK12VH21T5Z4DW
{"ts":"2025-12-01T00:25:52.601Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"62f1c3c6-8ef8-45c2-8eb3-06c84638eca5","stage":"booking","correlationId":"booking-created:af14f506601bcbd9ff0e982e"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-12-01T00:43:20.503Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"fcb29d03-495a-4979-b4a0-3c3aacb79d03","stage":"booking","correlationId":"booking-created:e0c0cc9ea5cb6bf178be27f0","attempts":1}
üìÖ Processing booking created for customer: 3JJ106WK58FG67W38X2SAMTSF8
Full booking data: {
  "id": "9gggo3nfjzltym",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-08T20:00:00Z",
  "created_at": "2025-12-01T00:30:14Z",
  "updated_at": "2025-12-01T00:30:14Z",
  "customer_id": "3JJ106WK58FG67W38X2SAMTSF8",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMWAtQTYmZpwwxii"
  },
  "appointment_segments": [
    {
      "resource_ids": [
        "5OVIQ6GSSUXORACP6T7WBAQ7"
      ],
      "team_member_id": "TMXiw38Bbb7XQUWI",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "ZEAKNB35I37RMXNUBGWDZQIM",
      "service_variation_version": 1760895536505,
      "service_variation_client_id": "ZEAKNB35I37RMXNUBGWDZQIM"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Symone Parker
üéâ First booking detected for customer: 3JJ106WK58FG67W38X2SAMTSF8
   Name: Symone Parker
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 3JJ106WK58FG67W38X2SAMTSF8...
Error getting custom attributes for customer 3JJ106WK58FG67W38X2SAMTSF8: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 3JJ106WK58FG67W38X2SAMTSF8
{"ts":"2025-12-01T00:43:21.216Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"fcb29d03-495a-4979-b4a0-3c3aacb79d03","stage":"booking","correlationId":"booking-created:e0c0cc9ea5cb6bf178be27f0"}
{"ts":"2025-12-01T00:43:21.376Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"4e387a80-70b2-45b7-bbe5-af214c738eee","stage":"payment","correlationId":"payment-updated:be28cbc33ce3cfd699fd8dac","attempts":1}
üí∞ Processing payment completion for customer: M76DEH89VH3J5GGJNG5TPFTAYM
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Emma Driscoll
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Emma Driscoll, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Emma Driscoll
   - Email: smonkey2001@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: M76DEH89VH3J5GGJNG5TPFTAYM
{"ts":"2025-12-01T00:43:21.700Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"4e387a80-70b2-45b7-bbe5-af214c738eee","stage":"payment","correlationId":"payment-updated:be28cbc33ce3cfd699fd8dac"}
{"ts":"2025-12-01T00:43:21.860Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"7cc04df6-e70b-4c1a-a23c-aca9dfc6c675","stage":"payment","correlationId":"payment-updated:2b21218c64a88b71a4ce1fc3","attempts":1}
üí∞ Processing payment completion for customer: M76DEH89VH3J5GGJNG5TPFTAYM
   Payment source_type: CARD
   Payment tender_types: []
Customer M76DEH89VH3J5GGJNG5TPFTAYM already completed first payment
{"ts":"2025-12-01T00:43:22.000Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"7cc04df6-e70b-4c1a-a23c-aca9dfc6c675","stage":"payment","correlationId":"payment-updated:2b21218c64a88b71a4ce1fc3"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-12-01T01:00:31.933Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"76af8c21-42db-4f0d-b72b-dfb9bd8103e3","stage":"payment","correlationId":"payment-updated:d5186ce34a2ce6291ea7d0b2","attempts":1}
üí∞ Processing payment completion for customer: F7ZEVXHAZKASN6SHTMVRFMMEHW
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Jordan Jayne
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Jordan Jayne, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Jordan Jayne
   - Email: jordanjayne15@yahoo.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: F7ZEVXHAZKASN6SHTMVRFMMEHW
{"ts":"2025-12-01T01:00:32.525Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"76af8c21-42db-4f0d-b72b-dfb9bd8103e3","stage":"payment","correlationId":"payment-updated:d5186ce34a2ce6291ea7d0b2"}
{"ts":"2025-12-01T01:00:32.681Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"dee3fe0d-9321-4172-947f-fd94e02fc7a6","stage":"payment","correlationId":"payment-updated:48687eae578029cf725797b1","attempts":1}
üí∞ Processing payment completion for customer: F7ZEVXHAZKASN6SHTMVRFMMEHW
   Payment source_type: CARD
   Payment tender_types: []
Customer F7ZEVXHAZKASN6SHTMVRFMMEHW already completed first payment
{"ts":"2025-12-01T01:00:32.818Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"dee3fe0d-9321-4172-947f-fd94e02fc7a6","stage":"payment","correlationId":"payment-updated:48687eae578029cf725797b1"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-12-01T01:15:36.586Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"d67df9a9-95be-4e56-96bb-d10c497275e3","stage":"booking","correlationId":"booking-created:2ae6bd2d4a180a80ba955f29","attempts":1}
üìÖ Processing booking created for customer: 7S3V4QVA5E9WX8EZMWNKZMZRRW
Full booking data: {
  "id": "cgw3w57ysrjkem",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-08T19:20:00Z",
  "created_at": "2025-12-01T01:05:16Z",
  "updated_at": "2025-12-01T01:05:16Z",
  "customer_id": "7S3V4QVA5E9WX8EZMWNKZMZRRW",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "7S3V4QVA5E9WX8EZMWNKZMZRRW",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMOscywuGXO2VURY",
      "any_team_member": true,
      "duration_minutes": 140,
      "intermission_minutes": 0,
      "service_variation_id": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "CJI5WHOAKSFTASYPJ4MSYZLS"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Katie Giatzis
üéâ First booking detected for customer: 7S3V4QVA5E9WX8EZMWNKZMZRRW
   Name: Katie Giatzis
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 7S3V4QVA5E9WX8EZMWNKZMZRRW...
Error getting custom attributes for customer 7S3V4QVA5E9WX8EZMWNKZMZRRW: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 7S3V4QVA5E9WX8EZMWNKZMZRRW
{"ts":"2025-12-01T01:15:37.237Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"d67df9a9-95be-4e56-96bb-d10c497275e3","stage":"booking","correlationId":"booking-created:2ae6bd2d4a180a80ba955f29"}
{"ts":"2025-12-01T01:15:37.395Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"ac610502-decf-40f4-9023-4ae9436a9aab","stage":"booking","correlationId":"booking-created:d3e0977313d02e31157f85f2","attempts":1}
üìÖ Processing booking created for customer: KEZ9VAVBFZ2CCQ19MHQZ7NG6BG
Full booking data: {
  "id": "o9p5d35vy8xvv6",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-06T21:00:00Z",
  "created_at": "2025-12-01T01:09:24Z",
  "updated_at": "2025-12-01T01:09:24Z",
  "customer_id": "KEZ9VAVBFZ2CCQ19MHQZ7NG6BG",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "KEZ9VAVBFZ2CCQ19MHQZ7NG6BG",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TM9jDlRr_Hl4rdBB",
      "any_team_member": true,
      "duration_minutes": 150,
      "intermission_minutes": 0,
      "service_variation_id": "4QI3JWGEYQANKCGC36J3MYNB",
      "service_variation_version": 1760141204155,
      "service_variation_client_id": "4QI3JWGEYQANKCGC36J3MYNB"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Maggie White
üéâ First booking detected for customer: KEZ9VAVBFZ2CCQ19MHQZ7NG6BG
   Name: Maggie White
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer KEZ9VAVBFZ2CCQ19MHQZ7NG6BG...
Error getting custom attributes for customer KEZ9VAVBFZ2CCQ19MHQZ7NG6BG: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: KEZ9VAVBFZ2CCQ19MHQZ7NG6BG
{"ts":"2025-12-01T01:15:37.770Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"ac610502-decf-40f4-9023-4ae9436a9aab","stage":"booking","correlationId":"booking-created:d3e0977313d02e31157f85f2"}
{"ts":"2025-12-01T01:15:37.927Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"00685541-2a02-4d7a-877b-46aabdf50491","stage":"payment","correlationId":"payment-updated:ed0812a6917bc1b0e5f0b0d9","attempts":1}
üí∞ Processing payment completion for customer: 15FD48HH5W155VQ8EP5VXK1VK4
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Erin Mouratoff
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Erin Mouratoff, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Erin Mouratoff
   - Email: emouratoff@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: 15FD48HH5W155VQ8EP5VXK1VK4
{"ts":"2025-12-01T01:15:38.238Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"00685541-2a02-4d7a-877b-46aabdf50491","stage":"payment","correlationId":"payment-updated:ed0812a6917bc1b0e5f0b0d9"}
{"ts":"2025-12-01T01:15:38.393Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"2afea6d6-8c5f-4068-8d48-b60a6a4fac22","stage":"payment","correlationId":"payment-updated:81103af018a3d00d8041dc49","attempts":1}
üí∞ Processing payment completion for customer: 15FD48HH5W155VQ8EP5VXK1VK4
   Payment source_type: CARD
   Payment tender_types: []
Customer 15FD48HH5W155VQ8EP5VXK1VK4 already completed first payment
{"ts":"2025-12-01T01:15:38.528Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"2afea6d6-8c5f-4068-8d48-b60a6a4fac22","stage":"payment","correlationId":"payment-updated:81103af018a3d00d8041dc49"}
{"ts":"2025-12-01T01:15:38.683Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"94e687e8-2d8d-478f-933c-1ccd973c3fcc","stage":"customer_ingest","correlationId":"customer-created:3b445406beeca6d44d3e6f0e","attempts":1}
üì• Received customer data: {
  "id": "TNHS62F0Y13DGJET8919E4EMWM",
  "address": {
    "country": "US"
  },
  "version": 0,
  "group_ids": [
    "LT4ZHFBQQYB2N.APPOINTMENTS"
  ],
  "created_at": "2025-12-01T01:13:20.049Z",
  "given_name": "Paula",
  "updated_at": "2025-12-01T01:13:20Z",
  "family_name": "Maia",
  "preferences": {
    "email_unsubscribed": false
  },
  "phone_number": "+16508889056",
  "email_address": "Pmaia.makeup@gmail.com",
  "creation_source": "APPOINTMENTS"
}
üë§ Processing customer creation: TNHS62F0Y13DGJET8919E4EMWM
üìç IP Address: unknown
üìß Email: Pmaia.makeup@gmail.com
üìû Phone: +16508889056
üë§ Name: Paula Maia
Error checking suspicious activity for IP unknown: Connection terminated unexpectedly
üéâ New customer detected: TNHS62F0Y13DGJET8919E4EMWM
‚úÖ Customer added to database as NEW (temporary mark)
   - Will check for referral code when they book
   - Will give gift card on first booking if code found
‚úÖ Verification: Customer found in DB: true
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-12-01T01:28:34.131Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"94e687e8-2d8d-478f-933c-1ccd973c3fcc","stage":"customer_ingest","correlationId":"customer-created:3b445406beeca6d44d3e6f0e"}
{"ts":"2025-12-01T01:28:34.362Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"8b966cf6-abbb-4cce-9eb4-3a15c7356c95","stage":"booking","correlationId":"booking-created:5fc1b17cdae1af3df1087d19","attempts":1}
üìÖ Processing booking created for customer: TNHS62F0Y13DGJET8919E4EMWM
Full booking data: {
  "id": "5mv9opwc3lb4c7",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-17T23:40:00Z",
  "created_at": "2025-12-01T01:13:22Z",
  "updated_at": "2025-12-01T01:13:22Z",
  "customer_id": "TNHS62F0Y13DGJET8919E4EMWM",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "TNHS62F0Y13DGJET8919E4EMWM",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMXiw38Bbb7XQUWI",
      "any_team_member": false,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Paula Maia
üéâ First booking detected for customer: TNHS62F0Y13DGJET8919E4EMWM
   Name: Paula Maia
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer TNHS62F0Y13DGJET8919E4EMWM...
Error getting custom attributes for customer TNHS62F0Y13DGJET8919E4EMWM: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: TNHS62F0Y13DGJET8919E4EMWM
{"ts":"2025-12-01T01:28:34.871Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"8b966cf6-abbb-4cce-9eb4-3a15c7356c95","stage":"booking","correlationId":"booking-created:5fc1b17cdae1af3df1087d19"}
{"ts":"2025-12-01T01:28:35.028Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"de1534bc-254f-4854-8074-9b58b07a9fb9","stage":"payment","correlationId":"payment-updated:73af650ef6ce009241f2ba5e","attempts":1}
üí∞ Processing payment completion for customer: CVMPZMETADGKBNA919CVECKC9C
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Tamara Kawadri
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Tamara Kawadri, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Tamara Kawadri
   - Email: pebblekawadri@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: CVMPZMETADGKBNA919CVECKC9C
{"ts":"2025-12-01T01:28:35.333Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"de1534bc-254f-4854-8074-9b58b07a9fb9","stage":"payment","correlationId":"payment-updated:73af650ef6ce009241f2ba5e"}
{"ts":"2025-12-01T01:28:35.490Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"82b04a30-0d4e-4808-ad88-5bef1d52e168","stage":"payment","correlationId":"payment-updated:c8c22bf2fd792deb86a66b9f","attempts":1}
üí∞ Processing payment completion for customer: CVMPZMETADGKBNA919CVECKC9C
   Payment source_type: CARD
   Payment tender_types: []
Customer CVMPZMETADGKBNA919CVECKC9C already completed first payment
{"ts":"2025-12-01T01:28:35.622Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"82b04a30-0d4e-4808-ad88-5bef1d52e168","stage":"payment","correlationId":"payment-updated:c8c22bf2fd792deb86a66b9f"}
{"ts":"2025-12-01T01:28:35.777Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"9e36f082-fbfc-4d78-9f2f-51b58855adb8","stage":"payment","correlationId":"payment-updated:d33269b0c6afbf918695d729","attempts":1}
üí∞ Processing payment completion for customer: K2QXWS69CWW0WSVZMHQ891TPMR
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Nina Achadjian
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Nina Achadjian, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Nina Achadjian
   - Email: ninerni49@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: K2QXWS69CWW0WSVZMHQ891TPMR
{"ts":"2025-12-01T01:28:36.081Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"9e36f082-fbfc-4d78-9f2f-51b58855adb8","stage":"payment","correlationId":"payment-updated:d33269b0c6afbf918695d729"}
{"ts":"2025-12-01T01:28:36.237Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"a27563a8-36fd-4a3d-896b-eba66c148072","stage":"payment","correlationId":"payment-updated:1d0a3ebdf3a5d686cd146239","attempts":1}
üí∞ Processing payment completion for customer: K2QXWS69CWW0WSVZMHQ891TPMR
   Payment source_type: CARD
   Payment tender_types: []
Customer K2QXWS69CWW0WSVZMHQ891TPMR already completed first payment
{"ts":"2025-12-01T01:28:36.377Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"a27563a8-36fd-4a3d-896b-eba66c148072","stage":"payment","correlationId":"payment-updated:1d0a3ebdf3a5d686cd146239"}
{"ts":"2025-12-01T01:28:36.539Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"c7ce9678-ef3d-4ce2-b13f-da3502809171","stage":"payment","correlationId":"payment-updated:b0a303663d041c55acb47f13","attempts":1}
üí∞ Processing payment completion for customer: ZG36MF6864P0HJJ7AH0BSPS1MM
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Janel Hodo
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Janel Hodo, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Janel Hodo
   - Email: Janel.hodo@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: ZG36MF6864P0HJJ7AH0BSPS1MM
{"ts":"2025-12-01T01:28:36.847Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"c7ce9678-ef3d-4ce2-b13f-da3502809171","stage":"payment","correlationId":"payment-updated:b0a303663d041c55acb47f13"}
{"ts":"2025-12-01T01:28:37.011Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"a04daee5-3caf-4cec-9bae-c5fb2df21bb0","stage":"payment","correlationId":"payment-updated:834087a75ac20d8af786f99a","attempts":1}
üí∞ Processing payment completion for customer: ZG36MF6864P0HJJ7AH0BSPS1MM
   Payment source_type: CARD
   Payment tender_types: []
Customer ZG36MF6864P0HJJ7AH0BSPS1MM already completed first payment
{"ts":"2025-12-01T01:28:37.143Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"a04daee5-3caf-4cec-9bae-c5fb2df21bb0","stage":"payment","correlationId":"payment-updated:834087a75ac20d8af786f99a"}
{"ts":"2025-12-01T01:28:37.299Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"404c35b2-5cf4-426b-ba89-5058cd487610","stage":"payment","correlationId":"payment-updated:77a537ea0e12fa0fc7fb6dec","attempts":1}
üí∞ Processing payment completion for customer: TE85QP9QYNHGGQ19T137CMP9CG
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Niki Kalergis
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Niki Kalergis, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Niki Kalergis
   - Email: kalergisniki@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: TE85QP9QYNHGGQ19T137CMP9CG
{"ts":"2025-12-01T01:28:37.604Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"404c35b2-5cf4-426b-ba89-5058cd487610","stage":"payment","correlationId":"payment-updated:77a537ea0e12fa0fc7fb6dec"}
{"ts":"2025-12-01T01:28:37.764Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"2889df1b-422d-4d9e-9817-a9dae6528f41","stage":"payment","correlationId":"payment-updated:0701b0222f9ecffc9de4fbde","attempts":1}
üí∞ Processing payment completion for customer: TE85QP9QYNHGGQ19T137CMP9CG
   Payment source_type: CARD
   Payment tender_types: []
Customer TE85QP9QYNHGGQ19T137CMP9CG already completed first payment
{"ts":"2025-12-01T01:28:37.893Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"2889df1b-422d-4d9e-9817-a9dae6528f41","stage":"payment","correlationId":"payment-updated:0701b0222f9ecffc9de4fbde"}
{"ts":"2025-12-01T01:28:38.060Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"0524d33a-0eda-47b4-a2ac-5d37435ae2dc","stage":"booking","correlationId":"booking-created:f299a19f2bbdf727296657e4","attempts":1}
üìÖ Processing booking created for customer: FD35BZQY13ENTCVZVB75H9J16R
Full booking data: {
  "id": "bzr623bib7fkcs",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-09T21:30:00Z",
  "created_at": "2025-12-01T01:28:16Z",
  "updated_at": "2025-12-01T01:28:16Z",
  "customer_id": "FD35BZQY13ENTCVZVB75H9J16R",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMWAtQTYmZpwwxii"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMVwAQUdLz6no-cB",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    },
    {
      "team_member_id": "TMVwAQUdLz6no-cB",
      "any_team_member": false,
      "duration_minutes": 30,
      "intermission_minutes": 0,
      "service_variation_id": "LFLFEZO7L46URIM2OVZOJADI",
      "service_variation_version": 1762374620368,
      "service_variation_client_id": "LFLFEZO7L46URIM2OVZOJADI"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Sara Aksdal-Jansen
üéâ First booking detected for customer: FD35BZQY13ENTCVZVB75H9J16R
   Name: Sara Aksdal-Jansen
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer FD35BZQY13ENTCVZVB75H9J16R...
Error getting custom attributes for customer FD35BZQY13ENTCVZVB75H9J16R: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: FD35BZQY13ENTCVZVB75H9J16R
{"ts":"2025-12-01T01:28:38.456Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"0524d33a-0eda-47b4-a2ac-5d37435ae2dc","stage":"booking","correlationId":"booking-created:f299a19f2bbdf727296657e4"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-12-01T01:36:17.207Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"1d040de5-e04c-40cc-afc9-895f4bd81fe3","stage":"payment","correlationId":"payment-updated:1cde0df0ced62b912db3aebd","attempts":1}
üí∞ Processing payment completion for customer: D5CTPAWV3D133SK80DYQGZ0BW8
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Emma Genesen
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Emma Genesen, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Emma Genesen
   - Email: Genesen.emma@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: D5CTPAWV3D133SK80DYQGZ0BW8
{"ts":"2025-12-01T01:36:17.798Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"1d040de5-e04c-40cc-afc9-895f4bd81fe3","stage":"payment","correlationId":"payment-updated:1cde0df0ced62b912db3aebd"}
{"ts":"2025-12-01T01:36:17.967Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"c8921338-655b-4dd6-a17f-66a4cb1d00be","stage":"payment","correlationId":"payment-updated:63a3b081179fddfa39304ef0","attempts":1}
üí∞ Processing payment completion for customer: D5CTPAWV3D133SK80DYQGZ0BW8
   Payment source_type: CARD
   Payment tender_types: []
Customer D5CTPAWV3D133SK80DYQGZ0BW8 already completed first payment
{"ts":"2025-12-01T01:36:18.107Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"c8921338-655b-4dd6-a17f-66a4cb1d00be","stage":"payment","correlationId":"payment-updated:63a3b081179fddfa39304ef0"}
{"ts":"2025-12-01T01:36:18.274Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"11ca9387-8f9e-4b12-aed0-2d76e4669d6c","stage":"payment","correlationId":"payment-updated:d2b0cd4dda007a013fdd1a5c","attempts":1}
üí∞ Processing payment completion for customer: 6PQ82YBVJ5G1WRQ46A1KR3KWBM
   Payment source_type: CARD
   Payment tender_types: []
Customer 6PQ82YBVJ5G1WRQ46A1KR3KWBM already completed first payment
{"ts":"2025-12-01T01:36:18.414Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"11ca9387-8f9e-4b12-aed0-2d76e4669d6c","stage":"payment","correlationId":"payment-updated:d2b0cd4dda007a013fdd1a5c"}
{"ts":"2025-12-01T01:36:18.576Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"e3be4d1b-f729-4cc9-a75b-2fd33550bbfd","stage":"payment","correlationId":"payment-updated:e9773832a78b4ab765cb82a6","attempts":1}
üí∞ Processing payment completion for customer: 6PQ82YBVJ5G1WRQ46A1KR3KWBM
   Payment source_type: CARD
   Payment tender_types: []
Customer 6PQ82YBVJ5G1WRQ46A1KR3KWBM already completed first payment
{"ts":"2025-12-01T01:36:18.716Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"e3be4d1b-f729-4cc9-a75b-2fd33550bbfd","stage":"payment","correlationId":"payment-updated:e9773832a78b4ab765cb82a6"}
{"ts":"2025-12-01T01:36:31.702Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"b9b91a0b-5d36-4c0e-8dcc-d27edc13f38e","stage":"payment","correlationId":"payment-updated:98a03e12dfaf6c3994f44d04","attempts":1}
üí∞ Processing payment completion for customer: 4W5KXZ7SXB2JTDA41N4APC9N0M
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Ash Golzio
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Ash Golzio, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Ash Golzio
   - Email: ashgolzio0207@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: 4W5KXZ7SXB2JTDA41N4APC9N0M
{"ts":"2025-12-01T01:36:32.146Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"b9b91a0b-5d36-4c0e-8dcc-d27edc13f38e","stage":"payment","correlationId":"payment-updated:98a03e12dfaf6c3994f44d04"}
{"ts":"2025-12-01T01:36:36.596Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"cdec128e-5b37-4b7f-b58b-5fa250e4de21","stage":"payment","correlationId":"payment-updated:043970977363be48eb73de02","attempts":1}
üí∞ Processing payment completion for customer: 4W5KXZ7SXB2JTDA41N4APC9N0M
   Payment source_type: CARD
   Payment tender_types: []
Customer 4W5KXZ7SXB2JTDA41N4APC9N0M already completed first payment
{"ts":"2025-12-01T01:36:36.745Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"cdec128e-5b37-4b7f-b58b-5fa250e4de21","stage":"payment","correlationId":"payment-updated:043970977363be48eb73de02"}
{"ts":"2025-12-01T01:51:58.421Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"1b1e74d5-4447-4f14-8799-6f69cd045dc3","stage":"payment","correlationId":"payment-updated:1592ec6d449803ff5173719f","attempts":1}
üí∞ Processing payment completion for customer: N8000JR398W5BBPRK2YQ8S8MDM
   Payment source_type: CARD
   Payment tender_types: []
Customer N8000JR398W5BBPRK2YQ8S8MDM already completed first payment
{"ts":"2025-12-01T01:51:58.905Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"1b1e74d5-4447-4f14-8799-6f69cd045dc3","stage":"payment","correlationId":"payment-updated:1592ec6d449803ff5173719f"}
{"ts":"2025-12-01T01:51:59.066Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"63ef4ca9-cd6f-457c-80ab-c8737c7b1ee7","stage":"payment","correlationId":"payment-updated:646697876705b3edc38d00a3","attempts":1}
üí∞ Processing payment completion for customer: N8000JR398W5BBPRK2YQ8S8MDM
   Payment source_type: CARD
   Payment tender_types: []
Customer N8000JR398W5BBPRK2YQ8S8MDM already completed first payment
{"ts":"2025-12-01T01:51:59.206Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"63ef4ca9-cd6f-457c-80ab-c8737c7b1ee7","stage":"payment","correlationId":"payment-updated:646697876705b3edc38d00a3"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-12-01T02:08:36.323Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"539f73c8-05ca-4440-a3d8-f63f08c55eda","stage":"customer_ingest","correlationId":"customer-created:fdaffc7f65d50d854fb73cb9","attempts":1}
üì• Received customer data: {
  "id": "HZJN3XW012X3EEPYRSXJFMP8R4",
  "address": {
    "country": "US"
  },
  "version": 0,
  "group_ids": [
    "LT4ZHFBQQYB2N.APPOINTMENTS"
  ],
  "created_at": "2025-12-01T01:58:24.871Z",
  "given_name": "Liz",
  "updated_at": "2025-12-01T01:58:24Z",
  "family_name": "Jones",
  "preferences": {
    "email_unsubscribed": false
  },
  "phone_number": "+15178813794",
  "email_address": "Lizmjjones@gmail.com",
  "creation_source": "APPOINTMENTS"
}
üë§ Processing customer creation: HZJN3XW012X3EEPYRSXJFMP8R4
üìç IP Address: unknown
üìß Email: Lizmjjones@gmail.com
üìû Phone: +15178813794
üë§ Name: Liz Jones
‚ö†Ô∏è Suspicious IP activity detected: unknown used by 114 customers
‚ö†Ô∏è Suspicious activity detected for customer HZJN3XW012X3EEPYRSXJFMP8R4, flagging for review
üéâ New customer detected: HZJN3XW012X3EEPYRSXJFMP8R4
‚úÖ Customer added to database as NEW (temporary mark)
   - Will check for referral code when they book
   - Will give gift card on first booking if code found
‚úÖ Verification: Customer found in DB: true
{"ts":"2025-12-01T02:08:37.312Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"539f73c8-05ca-4440-a3d8-f63f08c55eda","stage":"customer_ingest","correlationId":"customer-created:fdaffc7f65d50d854fb73cb9"}
{"ts":"2025-12-01T02:08:37.678Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"410d0efd-c4d1-4b8a-8dc3-d7b846d8b7d5","stage":"booking","correlationId":"booking-created:de7961d80a42242fe98a088a","attempts":1}
üìÖ Processing booking created for customer: HZJN3XW012X3EEPYRSXJFMP8R4
Full booking data: {
  "id": "qkleiarhcvfs40",
  "source": "THIRD_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-01T21:50:00Z",
  "created_at": "2025-12-01T01:58:28Z",
  "updated_at": "2025-12-01T01:58:28Z",
  "customer_id": "HZJN3XW012X3EEPYRSXJFMP8R4",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "HZJN3XW012X3EEPYRSXJFMP8R4",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMoZGdZlg-iKWTDu",
      "any_team_member": true,
      "duration_minutes": 150,
      "intermission_minutes": 0,
      "service_variation_id": "4QI3JWGEYQANKCGC36J3MYNB",
      "service_variation_version": 1760141204155,
      "service_variation_client_id": "4QI3JWGEYQANKCGC36J3MYNB"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Liz Jones
üéâ First booking detected for customer: HZJN3XW012X3EEPYRSXJFMP8R4
   Name: Liz Jones
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer HZJN3XW012X3EEPYRSXJFMP8R4...
Error getting custom attributes for customer HZJN3XW012X3EEPYRSXJFMP8R4: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: HZJN3XW012X3EEPYRSXJFMP8R4
{"ts":"2025-12-01T02:08:38.327Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"410d0efd-c4d1-4b8a-8dc3-d7b846d8b7d5","stage":"booking","correlationId":"booking-created:de7961d80a42242fe98a088a"}
{"ts":"2025-12-01T02:08:38.675Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"9a0828fe-1b8f-42cc-868e-a5b80c120a68","stage":"booking","correlationId":"booking-created:ff3a05e449434ca9eaa95ad2","attempts":1}
üìÖ Processing booking created for customer: BNR9ZK11NGRJWPW4RHBV4EQ9KW
Full booking data: {
  "id": "poqo6cua8xe30a",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-11-30T23:45:00Z",
  "created_at": "2025-12-01T01:59:59Z",
  "updated_at": "2025-12-01T01:59:59Z",
  "customer_id": "BNR9ZK11NGRJWPW4RHBV4EQ9KW",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMWAtQTYmZpwwxii"
  },
  "appointment_segments": [
    {
      "team_member_id": "TM-zXe9fXe4axYWn",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "U5TVSCVGAEQCWV7PCCER37UX",
      "service_variation_version": 1762374620368,
      "service_variation_client_id": "U5TVSCVGAEQCWV7PCCER37UX"
    }
  ],
  "transition_time_minutes": 0
}
‚ùå Error processing booking creation: Connection terminated unexpectedly
Stack trace: Error: Connection terminated unexpectedly
    at /Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@neondatabase/serverless/index.js:1345:74
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async PrismaNeon.performIO (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/adapter-neon/dist/index.js:427:22)
    at async PrismaNeon.queryRaw (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/adapter-neon/dist/index.js:384:17)
    at async /Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:29:14083
{"ts":"2025-12-01T02:21:38.325Z","level":"error","event":"giftcard.worker.job.failed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"9a0828fe-1b8f-42cc-868e-a5b80c120a68","stage":"booking","correlationId":"booking-created:ff3a05e449434ca9eaa95ad2","attempts":1,"error":"Connection terminated unexpectedly"}
{"ts":"2025-12-01T02:21:38.357Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"\nInvalid `prisma.$queryRaw()` invocation:\n\n\nServer has closed the connection.","stack":"PrismaClientKnownRequestError: \nInvalid `prisma.$queryRaw()` invocation:\n\n\nServer has closed the connection.\n    at $n.handleRequestError (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:121:7315)\n    at $n.handleAndLogRequestError (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:121:6623)\n    at $n.request (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:121:6307)\n    at async l (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:9633)\n    at async updateGiftCardRunStage (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/runs/giftcard-run-tracker.js:330:18)\n    at async markGiftCardRunError (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/runs/giftcard-run-tracker.js:364:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:133:9)"}
{"ts":"2025-12-01T02:21:41.031Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"93aaf1e1-a862-4a3e-8acb-13fc1298ac77","stage":"payment","correlationId":"payment-updated:529c2319f810e4296df0a025","attempts":1}
üí∞ Processing payment completion for customer: BNR9ZK11NGRJWPW4RHBV4EQ9KW
   Payment source_type: CASH
   Payment tender_types: []
Customer BNR9ZK11NGRJWPW4RHBV4EQ9KW already completed first payment
{"ts":"2025-12-01T02:21:41.263Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"93aaf1e1-a862-4a3e-8acb-13fc1298ac77","stage":"payment","correlationId":"payment-updated:529c2319f810e4296df0a025"}
{"ts":"2025-12-01T02:21:41.424Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"5b2b9091-f33c-4648-8a57-63ff5759d82c","stage":"payment","correlationId":"payment-updated:817fc2bcea270748bb32c8fb","attempts":1}
üí∞ Processing payment completion for customer: BNR9ZK11NGRJWPW4RHBV4EQ9KW
   Payment source_type: CARD
   Payment tender_types: []
Customer BNR9ZK11NGRJWPW4RHBV4EQ9KW already completed first payment
{"ts":"2025-12-01T02:21:41.569Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"5b2b9091-f33c-4648-8a57-63ff5759d82c","stage":"payment","correlationId":"payment-updated:817fc2bcea270748bb32c8fb"}
{"ts":"2025-12-01T02:21:41.731Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"009e6382-bcc9-4d87-b724-082c72f7961c","stage":"payment","correlationId":"payment-updated:50e8812188203efb560178a3","attempts":1}
üí∞ Processing payment completion for customer: BNR9ZK11NGRJWPW4RHBV4EQ9KW
   Payment source_type: CARD
   Payment tender_types: []
Customer BNR9ZK11NGRJWPW4RHBV4EQ9KW already completed first payment
{"ts":"2025-12-01T02:21:41.872Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"009e6382-bcc9-4d87-b724-082c72f7961c","stage":"payment","correlationId":"payment-updated:50e8812188203efb560178a3"}
{"ts":"2025-12-01T02:21:42.035Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"631756c8-06e6-4637-8e65-29c24ed9ebbd","stage":"booking","correlationId":"booking-created:c010e3a0eedc8827d0548af9","attempts":1}
üìÖ Processing booking created for customer: FD35BZQY13ENTCVZVB75H9J16R
Full booking data: {
  "id": "0fosh86fy2s0k3",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-16T20:00:00Z",
  "created_at": "2025-12-01T02:05:24Z",
  "updated_at": "2025-12-01T02:05:24Z",
  "customer_id": "FD35BZQY13ENTCVZVB75H9J16R",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMWAtQTYmZpwwxii"
  },
  "appointment_segments": [
    {
      "resource_ids": [
        "F2MBRCC42VNNDWXNA3PAMHEU"
      ],
      "team_member_id": "TMVwAQUdLz6no-cB",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "ZEAKNB35I37RMXNUBGWDZQIM",
      "service_variation_version": 1760895536505,
      "service_variation_client_id": "ZEAKNB35I37RMXNUBGWDZQIM"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Sara Aksdal-Jansen
üéâ First booking detected for customer: FD35BZQY13ENTCVZVB75H9J16R
   Name: Sara Aksdal-Jansen
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer FD35BZQY13ENTCVZVB75H9J16R...
Error getting custom attributes for customer FD35BZQY13ENTCVZVB75H9J16R: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: FD35BZQY13ENTCVZVB75H9J16R
{"ts":"2025-12-01T02:21:42.447Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"631756c8-06e6-4637-8e65-29c24ed9ebbd","stage":"booking","correlationId":"booking-created:c010e3a0eedc8827d0548af9"}
{"ts":"2025-12-01T02:21:42.608Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"199f3964-38ba-4e4c-90f8-672afeb3c4ac","stage":"payment","correlationId":"payment-updated:e646cf180f89879f213ac5e7","attempts":1}
üí∞ Processing payment completion for customer: WVF9C9XMEP6DK635K4S061HPNG
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Kendal Zeff
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Kendal Zeff, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Kendal Zeff
   - Email: kendalagins@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: WVF9C9XMEP6DK635K4S061HPNG
{"ts":"2025-12-01T02:21:42.938Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"199f3964-38ba-4e4c-90f8-672afeb3c4ac","stage":"payment","correlationId":"payment-updated:e646cf180f89879f213ac5e7"}
{"ts":"2025-12-01T02:21:43.102Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"712aa112-a8d8-4358-8377-9f83c8b007cf","stage":"payment","correlationId":"payment-updated:1faa72916ef4d9da6428effe","attempts":1}
üí∞ Processing payment completion for customer: WVF9C9XMEP6DK635K4S061HPNG
   Payment source_type: CARD
   Payment tender_types: []
Customer WVF9C9XMEP6DK635K4S061HPNG already completed first payment
{"ts":"2025-12-01T02:21:43.254Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"712aa112-a8d8-4358-8377-9f83c8b007cf","stage":"payment","correlationId":"payment-updated:1faa72916ef4d9da6428effe"}
{"ts":"2025-12-01T02:21:43.418Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"f03d6af5-1092-4d43-a897-b526f6acc777","stage":"booking","correlationId":"booking-created:e1357996ce943fce9abbcf27","attempts":1}
üìÖ Processing booking created for customer: 10F3BTV9CWE3BJ5XS5S7JVK7T4
Full booking data: {
  "id": "y3gelf772m70vh",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-03T22:50:00Z",
  "created_at": "2025-12-01T02:16:28Z",
  "updated_at": "2025-12-01T02:16:28Z",
  "customer_id": "10F3BTV9CWE3BJ5XS5S7JVK7T4",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "10F3BTV9CWE3BJ5XS5S7JVK7T4",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMVwAQUdLz6no-cB",
      "any_team_member": false,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Rachel Salinas
üéâ First booking detected for customer: 10F3BTV9CWE3BJ5XS5S7JVK7T4
   Name: Rachel Salinas
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 10F3BTV9CWE3BJ5XS5S7JVK7T4...
Error getting custom attributes for customer 10F3BTV9CWE3BJ5XS5S7JVK7T4: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 10F3BTV9CWE3BJ5XS5S7JVK7T4
{"ts":"2025-12-01T02:21:43.866Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"f03d6af5-1092-4d43-a897-b526f6acc777","stage":"booking","correlationId":"booking-created:e1357996ce943fce9abbcf27"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-12-01T02:29:33.856Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"c9fa81a4-c310-4973-8dc7-64d1a3ebe535","stage":"booking","correlationId":"booking-created:a4a301d1a94e0cadd54ca6db","attempts":1}
üìÖ Processing booking created for customer: K9EJ3R3ZKGAYEYRRKN16TCE01M
Full booking data: {
  "id": "ujfjnb520dmop5",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-14T23:00:00Z",
  "created_at": "2025-12-01T02:25:37Z",
  "updated_at": "2025-12-01T02:25:37Z",
  "customer_id": "K9EJ3R3ZKGAYEYRRKN16TCE01M",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "K9EJ3R3ZKGAYEYRRKN16TCE01M",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TM-zXe9fXe4axYWn",
      "any_team_member": false,
      "duration_minutes": 140,
      "intermission_minutes": 0,
      "service_variation_id": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "CJI5WHOAKSFTASYPJ4MSYZLS"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Faranak Ahmadi
üéâ First booking detected for customer: K9EJ3R3ZKGAYEYRRKN16TCE01M
   Name: Faranak Ahmadi
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer K9EJ3R3ZKGAYEYRRKN16TCE01M...
Error getting custom attributes for customer K9EJ3R3ZKGAYEYRRKN16TCE01M: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: K9EJ3R3ZKGAYEYRRKN16TCE01M
{"ts":"2025-12-01T02:29:34.633Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"c9fa81a4-c310-4973-8dc7-64d1a3ebe535","stage":"booking","correlationId":"booking-created:a4a301d1a94e0cadd54ca6db"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-12-01T02:47:10.297Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"574db8e5-2b87-457b-959c-29a66ba6ceae","stage":"booking","correlationId":"booking-created:8dd1a3f5e8378a6630f7baa5","attempts":1}
üìÖ Processing booking created for customer: F4459Z29BYNBV4TN8CW6FM8RBG
Full booking data: {
  "id": "1k3y190jtumxqh",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-28T00:00:00Z",
  "created_at": "2025-12-01T02:39:45Z",
  "updated_at": "2025-12-01T02:39:45Z",
  "customer_id": "F4459Z29BYNBV4TN8CW6FM8RBG",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "F4459Z29BYNBV4TN8CW6FM8RBG",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TM9jDlRr_Hl4rdBB",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "XBUDIMNKOPC2XVG5YLIQ4RYS",
      "service_variation_version": 1764191999049,
      "service_variation_client_id": "XBUDIMNKOPC2XVG5YLIQ4RYS"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Olivia Tomares
üéâ First booking detected for customer: F4459Z29BYNBV4TN8CW6FM8RBG
   Name: Olivia Tomares
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer F4459Z29BYNBV4TN8CW6FM8RBG...
Error getting custom attributes for customer F4459Z29BYNBV4TN8CW6FM8RBG: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: F4459Z29BYNBV4TN8CW6FM8RBG
{"ts":"2025-12-01T02:47:11.224Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"574db8e5-2b87-457b-959c-29a66ba6ceae","stage":"booking","correlationId":"booking-created:8dd1a3f5e8378a6630f7baa5"}
{"ts":"2025-12-01T02:47:11.379Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"4cf7975a-ecc8-4239-8844-1363c76556c5","stage":"booking","correlationId":"booking-created:ffc92d79bbf422cb4de5ef09","attempts":1}
üìÖ Processing booking created for customer: ENYVMR66DSAGXQ45GR7FA393XC
Full booking data: {
  "id": "vs6lcu4eberja1",
  "source": "THIRD_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-01T17:00:00Z",
  "created_at": "2025-12-01T02:39:57Z",
  "updated_at": "2025-12-01T02:39:57Z",
  "customer_id": "ENYVMR66DSAGXQ45GR7FA393XC",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "ENYVMR66DSAGXQ45GR7FA393XC",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMEWAZHdtaiRR_Zs",
      "any_team_member": true,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Kelly Costello
üéâ First booking detected for customer: ENYVMR66DSAGXQ45GR7FA393XC
   Name: Kelly Costello
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer ENYVMR66DSAGXQ45GR7FA393XC...
Error getting custom attributes for customer ENYVMR66DSAGXQ45GR7FA393XC: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: ENYVMR66DSAGXQ45GR7FA393XC
{"ts":"2025-12-01T02:47:11.759Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"4cf7975a-ecc8-4239-8844-1363c76556c5","stage":"booking","correlationId":"booking-created:ffc92d79bbf422cb4de5ef09"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-12-01T03:17:11.083Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"701c9131-a904-4c22-870f-9294ac277dfe","stage":"payment","correlationId":"payment-updated:7db6a6a2c2cc04af6d53bff8","attempts":1}
üí∞ Processing payment completion for customer: MAMXBMH3GWRVZZKST07MZ8WD24
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Greta Johnsen
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Greta Johnsen, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Greta Johnsen
   - Email: gjohnsen@live.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: MAMXBMH3GWRVZZKST07MZ8WD24
{"ts":"2025-12-01T03:17:11.702Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"701c9131-a904-4c22-870f-9294ac277dfe","stage":"payment","correlationId":"payment-updated:7db6a6a2c2cc04af6d53bff8"}
{"ts":"2025-12-01T03:17:11.860Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"0ce23152-184a-4a9c-a64b-204574a789e7","stage":"payment","correlationId":"payment-updated:0b67206274432c505d724b57","attempts":1}
üí∞ Processing payment completion for customer: MAMXBMH3GWRVZZKST07MZ8WD24
   Payment source_type: CARD
   Payment tender_types: []
Customer MAMXBMH3GWRVZZKST07MZ8WD24 already completed first payment
{"ts":"2025-12-01T03:17:12.001Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"0ce23152-184a-4a9c-a64b-204574a789e7","stage":"payment","correlationId":"payment-updated:0b67206274432c505d724b57"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-12-01T03:30:33.346Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Server has closed the connection.","stack":"PrismaClientKnownRequestError: Server has closed the connection.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-01T03:30:36.037Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"1da26e3a-5b8e-43d2-b35e-370eec74577f","stage":"customer_ingest","correlationId":"customer-created:768a1c3b0988d49d21502d54","attempts":1}
üì• Received customer data: {
  "id": "JBSSXD662STDAD89DZ5Z33VTT8",
  "version": 0,
  "created_at": "2025-12-01T03:26:08.354Z",
  "given_name": "Isabella",
  "updated_at": "2025-12-01T03:26:08Z",
  "family_name": "Garcia-Camargo",
  "preferences": {
    "email_unsubscribed": false
  },
  "phone_number": "+14258924209",
  "email_address": "isabellagc2010@gmail.com",
  "creation_source": "THIRD_PARTY"
}
üë§ Processing customer creation: JBSSXD662STDAD89DZ5Z33VTT8
üìç IP Address: unknown
üìß Email: isabellagc2010@gmail.com
üìû Phone: +14258924209
üë§ Name: Isabella Garcia-Camargo
‚ö†Ô∏è Suspicious IP activity detected: unknown used by 115 customers
‚ö†Ô∏è Suspicious activity detected for customer JBSSXD662STDAD89DZ5Z33VTT8, flagging for review
üéâ New customer detected: JBSSXD662STDAD89DZ5Z33VTT8
‚úÖ Customer added to database as NEW (temporary mark)
   - Will check for referral code when they book
   - Will give gift card on first booking if code found
‚úÖ Verification: Customer found in DB: true
{"ts":"2025-12-01T03:30:36.652Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"1da26e3a-5b8e-43d2-b35e-370eec74577f","stage":"customer_ingest","correlationId":"customer-created:768a1c3b0988d49d21502d54"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-12-01T03:46:37.001Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"2ccec2bc-e844-454e-a9fd-9c610521f0a5","stage":"booking","correlationId":"booking-created:8c174281914d798de01d074d","attempts":1}
üìÖ Processing booking created for customer: AQ5HTMD863W48ZAPTF711WRQ30
Full booking data: {
  "id": "ceqmeep13cerdf",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-17T18:30:00Z",
  "created_at": "2025-12-01T03:44:08Z",
  "updated_at": "2025-12-01T03:44:08Z",
  "customer_id": "AQ5HTMD863W48ZAPTF711WRQ30",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "AQ5HTMD863W48ZAPTF711WRQ30",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMyUMvTJIj2HrHSg",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "JMTK5M2CY2W7WEXSTAJKAJ35",
      "service_variation_version": 1764191999049,
      "service_variation_client_id": "JMTK5M2CY2W7WEXSTAJKAJ35"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Jenna Kernus
üéâ First booking detected for customer: AQ5HTMD863W48ZAPTF711WRQ30
   Name: Jenna Kernus
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer AQ5HTMD863W48ZAPTF711WRQ30...
Error getting custom attributes for customer AQ5HTMD863W48ZAPTF711WRQ30: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: AQ5HTMD863W48ZAPTF711WRQ30
{"ts":"2025-12-01T03:46:37.661Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"2ccec2bc-e844-454e-a9fd-9c610521f0a5","stage":"booking","correlationId":"booking-created:8c174281914d798de01d074d"}
{"ts":"2025-12-01T03:46:37.819Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"bf1e8d5b-fad9-4cf6-a771-93e85e7e7f44","stage":"booking","correlationId":"booking-created:44290bd5c86e060ca6454175","attempts":1}
üìÖ Processing booking created for customer: AQ5HTMD863W48ZAPTF711WRQ30
Full booking data: {
  "id": "38q8sgcbncjr4f",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-23T00:30:00Z",
  "created_at": "2025-12-01T03:44:40Z",
  "updated_at": "2025-12-01T03:44:40Z",
  "customer_id": "AQ5HTMD863W48ZAPTF711WRQ30",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "AQ5HTMD863W48ZAPTF711WRQ30",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMyUMvTJIj2HrHSg",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "JMTK5M2CY2W7WEXSTAJKAJ35",
      "service_variation_version": 1764191999049,
      "service_variation_client_id": "JMTK5M2CY2W7WEXSTAJKAJ35"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Jenna Kernus
üéâ First booking detected for customer: AQ5HTMD863W48ZAPTF711WRQ30
   Name: Jenna Kernus
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer AQ5HTMD863W48ZAPTF711WRQ30...
Error getting custom attributes for customer AQ5HTMD863W48ZAPTF711WRQ30: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: AQ5HTMD863W48ZAPTF711WRQ30
{"ts":"2025-12-01T03:46:38.196Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"bf1e8d5b-fad9-4cf6-a771-93e85e7e7f44","stage":"booking","correlationId":"booking-created:44290bd5c86e060ca6454175"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-12-01T04:21:18.486Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"bad54b42-547d-455b-9878-3d1fffea1d52","stage":"booking","correlationId":"booking-created:c23707f8838fdffd56371fab","attempts":1}
üìÖ Processing booking created for customer: B55S0NRB4CZKMWRFCYN94WJV0R
Full booking data: {
  "id": "ah10x08jstuzji",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-07T22:00:00Z",
  "created_at": "2025-12-01T04:04:33Z",
  "updated_at": "2025-12-01T04:04:33Z",
  "customer_id": "B55S0NRB4CZKMWRFCYN94WJV0R",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "B55S0NRB4CZKMWRFCYN94WJV0R",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMEWAZHdtaiRR_Zs",
      "any_team_member": true,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    },
    {
      "team_member_id": "TMEWAZHdtaiRR_Zs",
      "any_team_member": true,
      "duration_minutes": 20,
      "intermission_minutes": 0,
      "service_variation_id": "HAJX45W3U2WUCCXM5MI24UEE",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "HAJX45W3U2WUCCXM5MI24UEE"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Emily Calkins
üéâ First booking detected for customer: B55S0NRB4CZKMWRFCYN94WJV0R
   Name: Emily Calkins
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer B55S0NRB4CZKMWRFCYN94WJV0R...
Error getting custom attributes for customer B55S0NRB4CZKMWRFCYN94WJV0R: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: B55S0NRB4CZKMWRFCYN94WJV0R
{"ts":"2025-12-01T04:21:19.168Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"bad54b42-547d-455b-9878-3d1fffea1d52","stage":"booking","correlationId":"booking-created:c23707f8838fdffd56371fab"}
{"ts":"2025-12-01T04:21:19.322Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"7ed201c1-967f-48c6-b704-95d871268e9f","stage":"customer_ingest","correlationId":"customer-created:f8dad5b0adffec21fdb8bdd1","attempts":1}
üì• Received customer data: {
  "id": "02KFRKP8HZ6YSJ8A14F3CPAGN4",
  "address": {
    "country": "US"
  },
  "version": 0,
  "group_ids": [
    "LT4ZHFBQQYB2N.APPOINTMENTS"
  ],
  "created_at": "2025-12-01T04:09:14.296Z",
  "given_name": "Lindsey",
  "updated_at": "2025-12-01T04:09:14Z",
  "family_name": "Fenner",
  "preferences": {
    "email_unsubscribed": false
  },
  "phone_number": "+18156009303",
  "email_address": "Lindseyfenner@yahoo.com",
  "creation_source": "APPOINTMENTS"
}
üë§ Processing customer creation: 02KFRKP8HZ6YSJ8A14F3CPAGN4
üìç IP Address: unknown
üìß Email: Lindseyfenner@yahoo.com
üìû Phone: +18156009303
üë§ Name: Lindsey Fenner
‚ö†Ô∏è Suspicious IP activity detected: unknown used by 116 customers
‚ö†Ô∏è Suspicious activity detected for customer 02KFRKP8HZ6YSJ8A14F3CPAGN4, flagging for review
üéâ New customer detected: 02KFRKP8HZ6YSJ8A14F3CPAGN4
‚úÖ Customer added to database as NEW (temporary mark)
   - Will check for referral code when they book
   - Will give gift card on first booking if code found
‚úÖ Verification: Customer found in DB: true
{"ts":"2025-12-01T04:21:19.684Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"7ed201c1-967f-48c6-b704-95d871268e9f","stage":"customer_ingest","correlationId":"customer-created:f8dad5b0adffec21fdb8bdd1"}
{"ts":"2025-12-01T04:21:19.840Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"00b7b750-4896-4cdb-8963-36340487db99","stage":"booking","correlationId":"booking-created:73b560de62ac531e7928fced","attempts":1}
üìÖ Processing booking created for customer: 02KFRKP8HZ6YSJ8A14F3CPAGN4
Full booking data: {
  "id": "3yiexesyyhlj38",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-05T17:00:00Z",
  "created_at": "2025-12-01T04:09:17Z",
  "updated_at": "2025-12-01T04:09:17Z",
  "customer_id": "02KFRKP8HZ6YSJ8A14F3CPAGN4",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "02KFRKP8HZ6YSJ8A14F3CPAGN4",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TM-zXe9fXe4axYWn",
      "any_team_member": false,
      "duration_minutes": 140,
      "intermission_minutes": 0,
      "service_variation_id": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "CJI5WHOAKSFTASYPJ4MSYZLS"
    },
    {
      "resource_ids": [
        "F2MBRCC42VNNDWXNA3PAMHEU"
      ],
      "team_member_id": "TM-zXe9fXe4axYWn",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "ZEAKNB35I37RMXNUBGWDZQIM",
      "service_variation_version": 1760895536505,
      "service_variation_client_id": "ZEAKNB35I37RMXNUBGWDZQIM"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Lindsey Fenner
üéâ First booking detected for customer: 02KFRKP8HZ6YSJ8A14F3CPAGN4
   Name: Lindsey Fenner
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 02KFRKP8HZ6YSJ8A14F3CPAGN4...
Error getting custom attributes for customer 02KFRKP8HZ6YSJ8A14F3CPAGN4: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 02KFRKP8HZ6YSJ8A14F3CPAGN4
{"ts":"2025-12-01T04:21:20.223Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"00b7b750-4896-4cdb-8963-36340487db99","stage":"booking","correlationId":"booking-created:73b560de62ac531e7928fced"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-12-01T04:51:47.852Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"a18b422b-2e3f-4e2e-9efd-9966b7f29e5a","stage":"booking","correlationId":"booking-created:9ec35f7ff00ca3f1f47f9bc8","attempts":1}
üìÖ Processing booking created for customer: SQT8GAX0ESNFPPCWCJV0MR3R8M
Full booking data: {
  "id": "ef60o5zewzgfqb",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-09T01:20:00Z",
  "created_at": "2025-12-01T04:50:40Z",
  "updated_at": "2025-12-01T04:50:40Z",
  "customer_id": "SQT8GAX0ESNFPPCWCJV0MR3R8M",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "SQT8GAX0ESNFPPCWCJV0MR3R8M",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMSt73bSp59caRzt",
      "any_team_member": true,
      "duration_minutes": 140,
      "intermission_minutes": 0,
      "service_variation_id": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "CJI5WHOAKSFTASYPJ4MSYZLS"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Katelynn Rekow
üéâ First booking detected for customer: SQT8GAX0ESNFPPCWCJV0MR3R8M
   Name: Katelynn Rekow
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer SQT8GAX0ESNFPPCWCJV0MR3R8M...
Error getting custom attributes for customer SQT8GAX0ESNFPPCWCJV0MR3R8M: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: SQT8GAX0ESNFPPCWCJV0MR3R8M
{"ts":"2025-12-01T04:51:48.540Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"a18b422b-2e3f-4e2e-9efd-9966b7f29e5a","stage":"booking","correlationId":"booking-created:9ec35f7ff00ca3f1f47f9bc8"}
{"ts":"2025-12-01T05:02:27.438Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"786ae0a5-b4bb-4d85-8b67-c50762cbc647","stage":"booking","correlationId":"booking-created:09ad599ec795fb787d2d6e1d","attempts":1}
üìÖ Processing booking created for customer: YCVAFVPN1W5YDYW9T4AE3P2MHR
Full booking data: {
  "id": "ykwb76dux99mwp",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-23T00:30:00Z",
  "created_at": "2025-12-01T05:02:01Z",
  "updated_at": "2025-12-01T05:02:01Z",
  "customer_id": "YCVAFVPN1W5YDYW9T4AE3P2MHR",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "YCVAFVPN1W5YDYW9T4AE3P2MHR",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMNW4SIF7tjp4oM_",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "BRSIGZFOWC6F4ERPKX3CODLU",
      "service_variation_version": 1764191999049,
      "service_variation_client_id": "BRSIGZFOWC6F4ERPKX3CODLU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Catherine Ladd
üéâ First booking detected for customer: YCVAFVPN1W5YDYW9T4AE3P2MHR
   Name: Catherine Ladd
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer YCVAFVPN1W5YDYW9T4AE3P2MHR...
Error getting custom attributes for customer YCVAFVPN1W5YDYW9T4AE3P2MHR: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: YCVAFVPN1W5YDYW9T4AE3P2MHR
{"ts":"2025-12-01T05:02:28.105Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"786ae0a5-b4bb-4d85-8b67-c50762cbc647","stage":"booking","correlationId":"booking-created:09ad599ec795fb787d2d6e1d"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-12-01T05:17:54.203Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"b49e4483-c910-407e-af2c-aa0330a32ba3","stage":"booking","correlationId":"booking-created:4110caae32fbf62303023462","attempts":1}
üìÖ Processing booking created for customer: 3CJ4CNEW7PJKK9MCFVZ433D8ZW
Full booking data: {
  "id": "dlux1e7lyeynlv",
  "source": "THIRD_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-26T23:00:00Z",
  "created_at": "2025-12-01T05:11:48Z",
  "updated_at": "2025-12-01T05:11:48Z",
  "customer_id": "3CJ4CNEW7PJKK9MCFVZ433D8ZW",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "3CJ4CNEW7PJKK9MCFVZ433D8ZW",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMNW4SIF7tjp4oM_",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "BRSIGZFOWC6F4ERPKX3CODLU",
      "service_variation_version": 1764191999049,
      "service_variation_client_id": "BRSIGZFOWC6F4ERPKX3CODLU"
    },
    {
      "resource_ids": [
        "KAOXILA4CV7A23VRAACC4R66"
      ],
      "team_member_id": "TMNW4SIF7tjp4oM_",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "ZEAKNB35I37RMXNUBGWDZQIM",
      "service_variation_version": 1760895536505,
      "service_variation_client_id": "ZEAKNB35I37RMXNUBGWDZQIM"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Brett Stevenson
‚ÑπÔ∏è Customer 3CJ4CNEW7PJKK9MCFVZ433D8ZW already received signup bonus, not first booking
{"ts":"2025-12-01T05:17:54.613Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"b49e4483-c910-407e-af2c-aa0330a32ba3","stage":"booking","correlationId":"booking-created:4110caae32fbf62303023462"}
{"ts":"2025-12-01T05:17:54.777Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"5dba980a-a2eb-4945-b833-103154fd7bdb","stage":"booking","correlationId":"booking-created:f3d95f1db84e86a7f72a9d96","attempts":1}
üìÖ Processing booking created for customer: 3CJ4CNEW7PJKK9MCFVZ433D8ZW
Full booking data: {
  "id": "k0sedfl06ls822",
  "source": "THIRD_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-07T22:00:00Z",
  "created_at": "2025-12-01T05:14:48Z",
  "updated_at": "2025-12-01T05:14:48Z",
  "customer_id": "3CJ4CNEW7PJKK9MCFVZ433D8ZW",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "3CJ4CNEW7PJKK9MCFVZ433D8ZW",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMNW4SIF7tjp4oM_",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "BRSIGZFOWC6F4ERPKX3CODLU",
      "service_variation_version": 1764191999049,
      "service_variation_client_id": "BRSIGZFOWC6F4ERPKX3CODLU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Brett Stevenson
‚ÑπÔ∏è Customer 3CJ4CNEW7PJKK9MCFVZ433D8ZW already received signup bonus, not first booking
{"ts":"2025-12-01T05:17:54.915Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"5dba980a-a2eb-4945-b833-103154fd7bdb","stage":"booking","correlationId":"booking-created:f3d95f1db84e86a7f72a9d96"}
{"ts":"2025-12-01T05:17:55.095Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"5cc496b6-70eb-4d51-876a-f64422ebbd2e","stage":"booking","correlationId":"booking-created:e29d823e75da2b3784f73b53","attempts":1}
üìÖ Processing booking created for customer: 3CJ4CNEW7PJKK9MCFVZ433D8ZW
Full booking data: {
  "id": "bu6f9357c8j4xx",
  "source": "THIRD_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-21T00:00:00Z",
  "created_at": "2025-12-01T05:17:53Z",
  "updated_at": "2025-12-01T05:17:53Z",
  "customer_id": "3CJ4CNEW7PJKK9MCFVZ433D8ZW",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "3CJ4CNEW7PJKK9MCFVZ433D8ZW",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "resource_ids": [
        "KAOXILA4CV7A23VRAACC4R66"
      ],
      "team_member_id": "TM9jDlRr_Hl4rdBB",
      "any_team_member": true,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "ZEAKNB35I37RMXNUBGWDZQIM",
      "service_variation_version": 1760895536505,
      "service_variation_client_id": "ZEAKNB35I37RMXNUBGWDZQIM"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Brett Stevenson
‚ÑπÔ∏è Customer 3CJ4CNEW7PJKK9MCFVZ433D8ZW already received signup bonus, not first booking
{"ts":"2025-12-01T05:17:55.234Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"5cc496b6-70eb-4d51-876a-f64422ebbd2e","stage":"booking","correlationId":"booking-created:e29d823e75da2b3784f73b53"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-12-01T06:00:41.729Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-01T06:00:45.737Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-01T06:16:27.013Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-01T06:31:29.547Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Server has closed the connection.","stack":"PrismaClientKnownRequestError: Server has closed the connection.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-01T06:34:07.308Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Transaction already closed: A commit cannot be executed on an expired transaction. The timeout for this transaction was 5000 ms, however 17801 ms passed since the start of the transaction. Consider increasing the interactive transaction timeout or doing less work in the transaction.","stack":"PrismaClientKnownRequestError: Transaction API error: Transaction already closed: A commit cannot be executed on an expired transaction. The timeout for this transaction was 5000 ms, however 17801 ms passed since the start of the transaction. Consider increasing the interactive transaction timeout or doing less work in the transaction.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:8034)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-12-01T07:09:47.015Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"a31a64aa-801b-48b4-9eda-8b45b7da10a4","stage":"booking","correlationId":"booking-created:86a927561f7fe86a0ec2f943","attempts":1}
üìÖ Processing booking created for customer: 82K003M730Q31BH8JCWDHFRDYC
Full booking data: {
  "id": "becyko0obw1o4q",
  "source": "THIRD_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-03T19:20:00Z",
  "created_at": "2025-12-01T07:06:31Z",
  "updated_at": "2025-12-01T07:06:31Z",
  "customer_id": "82K003M730Q31BH8JCWDHFRDYC",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "82K003M730Q31BH8JCWDHFRDYC",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMe-bT5XxKxmk0nw",
      "any_team_member": true,
      "duration_minutes": 140,
      "intermission_minutes": 0,
      "service_variation_id": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "CJI5WHOAKSFTASYPJ4MSYZLS"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Alexis Friedman
‚ÑπÔ∏è Customer 82K003M730Q31BH8JCWDHFRDYC already received signup bonus, not first booking
{"ts":"2025-12-01T07:09:47.464Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"a31a64aa-801b-48b4-9eda-8b45b7da10a4","stage":"booking","correlationId":"booking-created:86a927561f7fe86a0ec2f943"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-12-01T07:56:44.409Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Server has closed the connection.","stack":"PrismaClientKnownRequestError: Server has closed the connection.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-12-01T08:51:21.071Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"4a7aa95f-d35e-4f59-814e-570b706e1fd7","stage":"booking","correlationId":"booking-created:ce4b6a09cc98c7fed8140f53","attempts":1}
üìÖ Processing booking created for customer: QC5CAE551ETHY1XJ0TMCV55CHW
Full booking data: {
  "id": "pf5yhyn4n4izw2",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-12T19:30:00Z",
  "created_at": "2025-12-01T08:50:16Z",
  "updated_at": "2025-12-01T08:50:16Z",
  "customer_id": "QC5CAE551ETHY1XJ0TMCV55CHW",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "QC5CAE551ETHY1XJ0TMCV55CHW",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TM9jDlRr_Hl4rdBB",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "XBUDIMNKOPC2XVG5YLIQ4RYS",
      "service_variation_version": 1764191999049,
      "service_variation_client_id": "XBUDIMNKOPC2XVG5YLIQ4RYS"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Ana Keusch
üéâ First booking detected for customer: QC5CAE551ETHY1XJ0TMCV55CHW
   Name: Ana Keusch
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer QC5CAE551ETHY1XJ0TMCV55CHW...
Error getting custom attributes for customer QC5CAE551ETHY1XJ0TMCV55CHW: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: QC5CAE551ETHY1XJ0TMCV55CHW
{"ts":"2025-12-01T08:51:21.757Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"4a7aa95f-d35e-4f59-814e-570b706e1fd7","stage":"booking","correlationId":"booking-created:ce4b6a09cc98c7fed8140f53"}
{"ts":"2025-12-01T09:07:34.419Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Server has closed the connection.","stack":"PrismaClientKnownRequestError: Server has closed the connection.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-12-01T11:24:16.586Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"930f2125-09e2-4a3b-8bce-8338b2a854e0","stage":"booking","correlationId":"booking-created:4001e170c10996ddea4d78c1","attempts":1}
üìÖ Processing booking created for customer: KE2AVN7NE59QD1W312Y7AZCHMR
Full booking data: {
  "id": "w7c1f4l1pxph4k",
  "source": "THIRD_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-01T17:00:00Z",
  "created_at": "2025-12-01T11:12:15Z",
  "updated_at": "2025-12-01T11:12:15Z",
  "customer_id": "KE2AVN7NE59QD1W312Y7AZCHMR",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "KE2AVN7NE59QD1W312Y7AZCHMR",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMdagA6g0F03A7_w",
      "any_team_member": false,
      "duration_minutes": 140,
      "intermission_minutes": 0,
      "service_variation_id": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "CJI5WHOAKSFTASYPJ4MSYZLS"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Ekaterina Androsova
üéâ First booking detected for customer: KE2AVN7NE59QD1W312Y7AZCHMR
   Name: Ekaterina Androsova
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer KE2AVN7NE59QD1W312Y7AZCHMR...
Error getting custom attributes for customer KE2AVN7NE59QD1W312Y7AZCHMR: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: KE2AVN7NE59QD1W312Y7AZCHMR
{"ts":"2025-12-01T11:24:17.280Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"930f2125-09e2-4a3b-8bce-8338b2a854e0","stage":"booking","correlationId":"booking-created:4001e170c10996ddea4d78c1"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-12-01T13:01:23.120Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"9e9cdc24-3bc2-474a-ba8b-18c658e233b2","stage":"booking","correlationId":"booking-created:d1493fe9f3a574926f158a2b","attempts":1}
üìÖ Processing booking created for customer: QM5QWBR081EW0EWW1KNWRTJPE4
Full booking data: {
  "id": "b7ulb6g76hwa2s",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-10T23:20:00Z",
  "created_at": "2025-12-01T12:59:20Z",
  "updated_at": "2025-12-01T12:59:20Z",
  "customer_id": "QM5QWBR081EW0EWW1KNWRTJPE4",
  "location_id": "LT4ZHFBQQYB2N",
  "customer_note": "Can you please let me if something later opens up?",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "QM5QWBR081EW0EWW1KNWRTJPE4",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMe-bT5XxKxmk0nw",
      "any_team_member": true,
      "duration_minutes": 140,
      "intermission_minutes": 0,
      "service_variation_id": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "CJI5WHOAKSFTASYPJ4MSYZLS"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Nadia Sebghati
üéâ First booking detected for customer: QM5QWBR081EW0EWW1KNWRTJPE4
   Name: Nadia Sebghati
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer QM5QWBR081EW0EWW1KNWRTJPE4...
Error getting custom attributes for customer QM5QWBR081EW0EWW1KNWRTJPE4: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: QM5QWBR081EW0EWW1KNWRTJPE4
{"ts":"2025-12-01T13:01:23.796Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"9e9cdc24-3bc2-474a-ba8b-18c658e233b2","stage":"booking","correlationId":"booking-created:d1493fe9f3a574926f158a2b"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-12-01T14:33:15.418Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"339c6227-c0f0-40c2-8781-41e74276bfa9","stage":"booking","correlationId":"booking-created:b6efa6b72b31a0145aea9c9d","attempts":1}
üìÖ Processing booking created for customer: 7QEECQDAJ7K1W0BM9HHFQ1NVCR
Full booking data: {
  "id": "62ib1m6v5h1wz6",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-30T00:30:00Z",
  "created_at": "2025-12-01T14:24:07Z",
  "updated_at": "2025-12-01T14:24:07Z",
  "customer_id": "7QEECQDAJ7K1W0BM9HHFQ1NVCR",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "7QEECQDAJ7K1W0BM9HHFQ1NVCR",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMNW4SIF7tjp4oM_",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "BRSIGZFOWC6F4ERPKX3CODLU",
      "service_variation_version": 1764191999049,
      "service_variation_client_id": "BRSIGZFOWC6F4ERPKX3CODLU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Ashley Fehrmann
üéâ First booking detected for customer: 7QEECQDAJ7K1W0BM9HHFQ1NVCR
   Name: Ashley Fehrmann
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 7QEECQDAJ7K1W0BM9HHFQ1NVCR...
Error getting custom attributes for customer 7QEECQDAJ7K1W0BM9HHFQ1NVCR: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 7QEECQDAJ7K1W0BM9HHFQ1NVCR
{"ts":"2025-12-01T14:33:16.147Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"339c6227-c0f0-40c2-8781-41e74276bfa9","stage":"booking","correlationId":"booking-created:b6efa6b72b31a0145aea9c9d"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-12-01T15:01:36.428Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-01T15:16:52.288Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"\nInvalid `prisma.$queryRaw()` invocation:\n\n\nServer has closed the connection.","stack":"PrismaClientKnownRequestError: \nInvalid `prisma.$queryRaw()` invocation:\n\n\nServer has closed the connection.\n    at $n.handleRequestError (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:121:7315)\n    at $n.handleAndLogRequestError (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:121:6623)\n    at $n.request (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:121:6307)\n    at async l (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:9633)\n    at async prisma.$transaction.isolationLevel (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:239:26)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:8000)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-12-01T15:29:02.939Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"2ae14898-c242-4330-9890-635c76202bff","stage":"booking","correlationId":"booking-created:c8e11f57f4ea213562e8253f","attempts":1}
üìÖ Processing booking created for customer: JYFNRT4B69RNP2J43CHM0K2NE0
Full booking data: {
  "id": "4bnpbtbh8cbrxu",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-18T21:00:00Z",
  "created_at": "2025-12-01T15:26:41Z",
  "updated_at": "2025-12-01T15:26:41Z",
  "customer_id": "JYFNRT4B69RNP2J43CHM0K2NE0",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "JYFNRT4B69RNP2J43CHM0K2NE0",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMEWAZHdtaiRR_Zs",
      "any_team_member": true,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    },
    {
      "team_member_id": "TMEWAZHdtaiRR_Zs",
      "any_team_member": true,
      "duration_minutes": 20,
      "intermission_minutes": 0,
      "service_variation_id": "HAJX45W3U2WUCCXM5MI24UEE",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "HAJX45W3U2WUCCXM5MI24UEE"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Elaina Envia
üéâ First booking detected for customer: JYFNRT4B69RNP2J43CHM0K2NE0
   Name: Elaina Envia
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer JYFNRT4B69RNP2J43CHM0K2NE0...
Error getting custom attributes for customer JYFNRT4B69RNP2J43CHM0K2NE0: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: JYFNRT4B69RNP2J43CHM0K2NE0
{"ts":"2025-12-01T15:29:03.696Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"2ae14898-c242-4330-9890-635c76202bff","stage":"booking","correlationId":"booking-created:c8e11f57f4ea213562e8253f"}
{"ts":"2025-12-01T15:46:27.413Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Server has closed the connection.","stack":"PrismaClientKnownRequestError: Server has closed the connection.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-12-01T15:57:23.463Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"84514080-68cc-4e35-98d5-ce4e34a983a2","stage":"payment","correlationId":"payment-updated:50a0206ad9ff9f5d366b102f","attempts":1}
No customer ID in payment data, skipping...
Payment data received: {
  "id": "7hysst98Y4zxBKVXRmntytL2Ui7YY",
  "status": "COMPLETED",
  "version": 3,
  "order_id": "VelQqQ4mXjGUrQZJilX6spf9DLQZY",
  "created_at": "2025-12-01T15:56:41.680Z",
  "updated_at": "2025-12-01T15:56:44.381Z",
  "location_id": "LT4ZHFBQQYB2N",
  "receipt_url": "https://squareup.com/receipt/preview/7hysst98Y4zxBKVXRmntytL2Ui7YY",
  "source_type": "CARD",
  "total_money": {
    "amount": 35000,
    "currency": "USD"
  },
  "amount_money": {
    "amount": 35000,
    "currency": "USD"
  },
  "card_details": {
    "card": {
      "bin": "559005",
      "last_4": "8731",
      "exp_year": 2028,
      "card_type": "DEBIT",
      "exp_month": 7,
      "card_brand": "MASTERCARD",
      "fingerprint": "sq-1-rsu8nOKXDEcp3wL6hSf7l8wP3k_Zu6du6Om1tN5u6RTF0824TAB5-Ajvzwjq0jIlHg",
      "prepaid_type": "NOT_PREPAID",
      "payment_account_reference": "5001CTK1VBEWCOB01UL6A39NS0A7J"
    },
    "status": "CAPTURED",
    "avs_status": "AVS_ACCEPTED",
    "cvv_status": "CVV_ACCEPTED",
    "entry_method": "KEYED",
    "auth_result_code": "423637",
    "card_payment_timeline": {
      "captured_at": "2025-12-01T15:56:42.835Z",
      "authorized_at": "2025-12-01T15:56:42.494Z"
    },
    "statement_description": "SQ *ZORINA NAIL STUDIO 2"
  },
  "delay_action": "CANCEL",
  "delayed_until": "2025-12-08T15:56:41.680Z",
  "approved_money": {
    "amount": 35000,
    "currency": "USD"
  },
  "delay_duration": "PT168H",
  "receipt_number": "7hys",
  "risk_evaluation": {
    "created_at": "2025-12-01T15:56:42.709Z",
    "risk_level": "NORMAL"
  },
  "application_details": {
    "application_id": "sq0idp-LnQlDEBJrriD2F3rrhnmtg",
    "square_product": "OTHER"
  },
  "buyer_email_address": "Jeremy.pippen@yahoo.com"
}
{"ts":"2025-12-01T15:57:23.671Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"84514080-68cc-4e35-98d5-ce4e34a983a2","stage":"payment","correlationId":"payment-updated:50a0206ad9ff9f5d366b102f"}
{"ts":"2025-12-01T15:57:23.835Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"d5c40263-578a-4199-a5bb-2318aaa762b6","stage":"payment","correlationId":"payment-updated:8da39083b53234bbfb398869","attempts":1}
üí∞ Processing payment completion for customer: WXM1DHDSEQHMHM6WMYVQK82J80
   Payment source_type: CARD
   Payment tender_types: []
Customer WXM1DHDSEQHMHM6WMYVQK82J80 not found in database
{"ts":"2025-12-01T15:57:24.105Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"d5c40263-578a-4199-a5bb-2318aaa762b6","stage":"payment","correlationId":"payment-updated:8da39083b53234bbfb398869"}
{"ts":"2025-12-01T15:57:24.265Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"b97b2115-49c0-47fb-81a5-56196fdecd3c","stage":"payment","correlationId":"payment-updated:ccc936e41689d578ae494e82","attempts":1}
üí∞ Processing payment completion for customer: YMMA4JNTGXQ44CC4STRMW9R46R
   Payment source_type: CARD
   Payment tender_types: []
Customer YMMA4JNTGXQ44CC4STRMW9R46R not found in database
{"ts":"2025-12-01T15:57:24.399Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"b97b2115-49c0-47fb-81a5-56196fdecd3c","stage":"payment","correlationId":"payment-updated:ccc936e41689d578ae494e82"}
{"ts":"2025-12-01T15:57:24.558Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"626a51ac-6b6f-41e5-9896-621c5c21670e","stage":"customer_ingest","correlationId":"customer-created:dd605c195a0eb573e61f1d46","attempts":1}
üì• Received customer data: {
  "id": "WXM1DHDSEQHMHM6WMYVQK82J80",
  "version": 1,
  "preferences": {
    "email_unsubscribed": false
  },
  "creation_source": "INSTANT_PROFILE"
}
üë§ Processing customer creation: WXM1DHDSEQHMHM6WMYVQK82J80
üìç IP Address: unknown
Error retrieving Square customer WXM1DHDSEQHMHM6WMYVQK82J80: Response status code was not ok: 401.
Square API errors: [
  {
    "category": "AUTHENTICATION_ERROR",
    "code": "UNAUTHORIZED",
    "detail": "This request could not be authorized."
  }
]
üìß Email: None
üìû Phone: None
üë§ Name:  
‚ö†Ô∏è Suspicious IP activity detected: unknown used by 117 customers
‚ö†Ô∏è Suspicious activity detected for customer WXM1DHDSEQHMHM6WMYVQK82J80, flagging for review
üéâ New customer detected: WXM1DHDSEQHMHM6WMYVQK82J80
‚úÖ Customer added to database as NEW (temporary mark)
   - Will check for referral code when they book
   - Will give gift card on first booking if code found
‚úÖ Verification: Customer found in DB: true
{"ts":"2025-12-01T15:57:25.156Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"626a51ac-6b6f-41e5-9896-621c5c21670e","stage":"customer_ingest","correlationId":"customer-created:dd605c195a0eb573e61f1d46"}
{"ts":"2025-12-01T15:57:25.317Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"00c8fef4-9cef-4f51-91f5-30ad22346256","stage":"customer_ingest","correlationId":"customer-created:7b7f331dcb32c3580e979c9b","attempts":1}
üì• Received customer data: {
  "id": "YMMA4JNTGXQ44CC4STRMW9R46R",
  "version": 1,
  "given_name": "Jeremy",
  "family_name": "Pippen",
  "preferences": {
    "email_unsubscribed": false
  },
  "email_address": "jeremy.pippen@yahoo.com",
  "creation_source": "EGIFTING"
}
üë§ Processing customer creation: YMMA4JNTGXQ44CC4STRMW9R46R
üìç IP Address: unknown
Error retrieving Square customer YMMA4JNTGXQ44CC4STRMW9R46R: Response status code was not ok: 401.
Square API errors: [
  {
    "category": "AUTHENTICATION_ERROR",
    "code": "UNAUTHORIZED",
    "detail": "This request could not be authorized."
  }
]
üìß Email: jeremy.pippen@yahoo.com
üìû Phone: None
üë§ Name: Jeremy Pippen
‚ö†Ô∏è Suspicious IP activity detected: unknown used by 118 customers
‚ö†Ô∏è Suspicious activity detected for customer YMMA4JNTGXQ44CC4STRMW9R46R, flagging for review
üéâ New customer detected: YMMA4JNTGXQ44CC4STRMW9R46R
‚úÖ Customer added to database as NEW (temporary mark)
   - Will check for referral code when they book
   - Will give gift card on first booking if code found
‚úÖ Verification: Customer found in DB: true
{"ts":"2025-12-01T15:57:25.806Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"00c8fef4-9cef-4f51-91f5-30ad22346256","stage":"customer_ingest","correlationId":"customer-created:7b7f331dcb32c3580e979c9b"}
{"ts":"2025-12-01T15:57:25.965Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"b35b8fa4-2a18-4afa-bbdf-ca2951d6db52","stage":"customer_ingest","correlationId":"customer-created:772df975b35da3ce6113cffb","attempts":1}
üì• Received customer data: {
  "id": "8684AF5XC12T5FQAGTWK9KC12M",
  "version": 0,
  "created_at": "2025-12-01T15:56:44.883Z",
  "given_name": "Jeremy",
  "updated_at": "2025-12-01T15:56:46Z",
  "family_name": "Pippen",
  "preferences": {
    "email_unsubscribed": false
  },
  "email_address": "jeremy.pippen@yahoo.com",
  "creation_source": "MERGE"
}
üë§ Processing customer creation: 8684AF5XC12T5FQAGTWK9KC12M
üìç IP Address: unknown
Error retrieving Square customer 8684AF5XC12T5FQAGTWK9KC12M: Response status code was not ok: 401.
Square API errors: [
  {
    "category": "AUTHENTICATION_ERROR",
    "code": "UNAUTHORIZED",
    "detail": "This request could not be authorized."
  }
]
üìß Email: jeremy.pippen@yahoo.com
üìû Phone: None
üë§ Name: Jeremy Pippen
‚ö†Ô∏è Suspicious IP activity detected: unknown used by 119 customers
‚ö†Ô∏è Suspicious activity detected for customer 8684AF5XC12T5FQAGTWK9KC12M, flagging for review
üéâ New customer detected: 8684AF5XC12T5FQAGTWK9KC12M
‚úÖ Customer added to database as NEW (temporary mark)
   - Will check for referral code when they book
   - Will give gift card on first booking if code found
‚úÖ Verification: Customer found in DB: true
{"ts":"2025-12-01T15:57:26.435Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"b35b8fa4-2a18-4afa-bbdf-ca2951d6db52","stage":"customer_ingest","correlationId":"customer-created:772df975b35da3ce6113cffb"}
{"ts":"2025-12-01T15:57:26.592Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"bfb3c61a-4df2-4eb5-a9f6-687381f263f9","stage":"payment","correlationId":"payment-updated:49f6a4452d10c73e8c14a0e0","attempts":1}
üí∞ Processing payment completion for customer: YMMA4JNTGXQ44CC4STRMW9R46R
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Jeremy Pippen
‚ùå Referrer not found for code: null
‚úÖ Generated new personal_code in name+ID format: JEREMY4946
‚ùå Error creating/loading gift card for Jeremy Pippen: Response status code was not ok: 401.
Square API errors: [
  {
    "category": "AUTHENTICATION_ERROR",
    "code": "UNAUTHORIZED",
    "detail": "This request could not be authorized."
  }
]
‚ùå Failed to create referrer gift card
Error upserting custom attribute "square:a3dde506-f69e-48e4-a98a-004c1822d3ad" for customer YMMA4JNTGXQ44CC4STRMW9R46R: Response status code was not ok: 401.
Square API errors: [
  {
    "category": "AUTHENTICATION_ERROR",
    "code": "UNAUTHORIZED",
    "detail": "This request could not be authorized."
  }
]
Error appending referral note for customer YMMA4JNTGXQ44CC4STRMW9R46R: Response status code was not ok: 401.
Square API errors: [
  {
    "category": "AUTHENTICATION_ERROR",
    "code": "UNAUTHORIZED",
    "detail": "This request could not be authorized."
  }
]
‚ùå Error sending referral email to jeremy.pippen@yahoo.com: Unauthorized
SendGrid error details: {
  errors: [
    {
      message: 'The provided authorization grant is invalid, expired, or revoked',
      field: null,
      help: null
    }
  ]
}
‚ö†Ô∏è Analytics operation "notification_event" failed: 
Invalid `prisma.notificationEvent.create()` invocation in
/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/analytics-service.js:164:39

  161 return runAnalyticsOperation(
  162   'notification_event',
  163   async () => {
‚Üí 164     return prisma.notificationEvent.create({
            data: {
              channel: "EMAIL",
              templateType: "REFERRAL_INVITE",
              status: "failed",
              createdAt: new Date("2025-12-01T15:57:28.120Z"),
              errorCode: 401,
                         ~~~
              errorMessage: "Unauthorized",
              metadata: {
                email: "jeremy.pippen@yahoo.com",
                referralCode: "JEREMY4946",
                referralUrl: "https://referral-system-salon-fbbq6x1wt-umis-projects-e802f152.vercel.app/ref/JEREMY4946",
                suppressionGroupId: 28008
              }
            }
          })

Argument `errorCode`: Invalid value provided. Expected String or Null, provided Int.
‚ùå Failed to send email: Unauthorized
‚ÑπÔ∏è Referral SMS not sent ‚Äî missing phone number
üìß Referral code generated and sent:
   - Customer: Jeremy Pippen
   - Email: jeremy.pippen@yahoo.com
   - Referral Code: JEREMY4946
   - Referral URL: https://referral-system-salon-fbbq6x1wt-umis-projects-e802f152.vercel.app/ref/JEREMY4946
   - Gift Card ID: null
   - Status: Customer is now a referrer
‚úÖ Referral code sent to new client:
   - Customer: Jeremy Pippen
   - Email: jeremy.pippen@yahoo.com
   - Referral Code: JEREMY4946
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: YMMA4JNTGXQ44CC4STRMW9R46R
{"ts":"2025-12-01T15:57:28.329Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"bfb3c61a-4df2-4eb5-a9f6-687381f263f9","stage":"payment","correlationId":"payment-updated:49f6a4452d10c73e8c14a0e0"}
{"ts":"2025-12-01T15:59:44.553Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Server has closed the connection.","stack":"PrismaClientKnownRequestError: Server has closed the connection.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-01T16:14:50.437Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"\nInvalid `prisma.$queryRaw()` invocation:\n\n\nServer has closed the connection.","stack":"PrismaClientKnownRequestError: \nInvalid `prisma.$queryRaw()` invocation:\n\n\nServer has closed the connection.\n    at $n.handleRequestError (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:121:7315)\n    at $n.handleAndLogRequestError (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:121:6623)\n    at $n.request (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:121:6307)\n    at async l (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:9633)\n    at async prisma.$transaction.isolationLevel (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:239:26)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:8000)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-01T16:14:53.546Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"012d67c4-42b0-455b-8cfd-fde579733609","stage":"payment","correlationId":"payment-updated:135bcfbbc4d38b118f83be72","attempts":1}
üí∞ Processing payment completion for customer: YMMA4JNTGXQ44CC4STRMW9R46R
   Payment source_type: CARD
   Payment tender_types: []
Customer YMMA4JNTGXQ44CC4STRMW9R46R already completed first payment
{"ts":"2025-12-01T16:14:53.954Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"012d67c4-42b0-455b-8cfd-fde579733609","stage":"payment","correlationId":"payment-updated:135bcfbbc4d38b118f83be72"}
{"ts":"2025-12-01T16:14:54.113Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"a1310757-e438-4bd3-afc7-9ad4ee3a5931","stage":"booking","correlationId":"booking-created:cfa2e2d94cf14cbc30b65c6b","attempts":1}
üìÖ Processing booking created for customer: EDAP6Z012DMZHGTSXQMT56MKPM
Full booking data: {
  "id": "4zig4bi1d2kv3g",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-19T02:00:00Z",
  "created_at": "2025-12-01T16:08:24Z",
  "updated_at": "2025-12-01T16:08:24Z",
  "customer_id": "EDAP6Z012DMZHGTSXQMT56MKPM",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "EDAP6Z012DMZHGTSXQMT56MKPM",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMgsjtuk5cfKnstq",
      "any_team_member": false,
      "duration_minutes": 110,
      "intermission_minutes": 0,
      "service_variation_id": "6TYOE67IDYTKHW2ZG6HKVZER",
      "service_variation_version": 1764191999049,
      "service_variation_client_id": "6TYOE67IDYTKHW2ZG6HKVZER"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Kristine Blukis
üéâ First booking detected for customer: EDAP6Z012DMZHGTSXQMT56MKPM
   Name: Kristine Blukis
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer EDAP6Z012DMZHGTSXQMT56MKPM...
Error getting custom attributes for customer EDAP6Z012DMZHGTSXQMT56MKPM: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: EDAP6Z012DMZHGTSXQMT56MKPM
{"ts":"2025-12-01T16:14:54.518Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"a1310757-e438-4bd3-afc7-9ad4ee3a5931","stage":"booking","correlationId":"booking-created:cfa2e2d94cf14cbc30b65c6b"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-12-01T16:45:55.042Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"890752fe-14c4-447b-acd2-28ea195e3c41","stage":"booking","correlationId":"booking-created:717dc3348541aba85a10c0af","attempts":1}
üìÖ Processing booking created for customer: 1GDE3NZBG6GGSVJM973MRKPR2M
Full booking data: {
  "id": "9vgrj9hjymxd62",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-22T23:00:00Z",
  "created_at": "2025-12-01T16:42:51Z",
  "updated_at": "2025-12-01T16:42:51Z",
  "customer_id": "1GDE3NZBG6GGSVJM973MRKPR2M",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "1GDE3NZBG6GGSVJM973MRKPR2M",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMyUMvTJIj2HrHSg",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "JMTK5M2CY2W7WEXSTAJKAJ35",
      "service_variation_version": 1764191999049,
      "service_variation_client_id": "JMTK5M2CY2W7WEXSTAJKAJ35"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Noelle Eades
üéâ First booking detected for customer: 1GDE3NZBG6GGSVJM973MRKPR2M
   Name: Noelle Eades
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 1GDE3NZBG6GGSVJM973MRKPR2M...
Error getting custom attributes for customer 1GDE3NZBG6GGSVJM973MRKPR2M: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 1GDE3NZBG6GGSVJM973MRKPR2M
{"ts":"2025-12-01T16:45:55.713Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"890752fe-14c4-447b-acd2-28ea195e3c41","stage":"booking","correlationId":"booking-created:717dc3348541aba85a10c0af"}
{"ts":"2025-12-01T16:45:55.877Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"35aa9d60-0b6b-4eca-96b6-93b003bd1f14","stage":"booking","correlationId":"booking-created:2257ef99ed72b6fff8785398","attempts":1}
üìÖ Processing booking created for customer: 0FVJ3ZYJ3BC83W4DDP96CVE94W
Full booking data: {
  "id": "g7z8qzfyxp1wiu",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-13T21:00:00Z",
  "created_at": "2025-12-01T16:44:37Z",
  "updated_at": "2025-12-01T16:44:37Z",
  "customer_id": "0FVJ3ZYJ3BC83W4DDP96CVE94W",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "0FVJ3ZYJ3BC83W4DDP96CVE94W",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TM9jDlRr_Hl4rdBB",
      "any_team_member": true,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "HXLBKQC3DRE57DB7IK5RBYOB",
      "service_variation_version": 1758654327496,
      "service_variation_client_id": "HXLBKQC3DRE57DB7IK5RBYOB"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Bess Green
üéâ First booking detected for customer: 0FVJ3ZYJ3BC83W4DDP96CVE94W
   Name: Bess Green
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 0FVJ3ZYJ3BC83W4DDP96CVE94W...
Error getting custom attributes for customer 0FVJ3ZYJ3BC83W4DDP96CVE94W: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 0FVJ3ZYJ3BC83W4DDP96CVE94W
{"ts":"2025-12-01T16:45:56.257Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"35aa9d60-0b6b-4eca-96b6-93b003bd1f14","stage":"booking","correlationId":"booking-created:2257ef99ed72b6fff8785398"}
{"ts":"2025-12-01T17:02:58.206Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"0349dc01-aeaf-4b1c-9cf5-aa639c4336bb","stage":"booking","correlationId":"booking-created:b1f03e9335b6389cb9177b05","attempts":1}
üìÖ Processing booking created for customer: CARPDQW9B6JXDK3WR08P21KKF8
Full booking data: {
  "id": "ifluhmyaikhs20",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-09T01:00:00Z",
  "created_at": "2025-12-01T17:00:37Z",
  "updated_at": "2025-12-01T17:00:37Z",
  "customer_id": "CARPDQW9B6JXDK3WR08P21KKF8",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMaVpirfZhWw5oM-"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMoZGdZlg-iKWTDu",
      "any_team_member": false,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    },
    {
      "team_member_id": "TMoZGdZlg-iKWTDu",
      "any_team_member": false,
      "duration_minutes": 30,
      "intermission_minutes": 0,
      "service_variation_id": "HAJX45W3U2WUCCXM5MI24UEE",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "HAJX45W3U2WUCCXM5MI24UEE"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: GRACE BLOGGER
üéâ First booking detected for customer: CARPDQW9B6JXDK3WR08P21KKF8
   Name: GRACE BLOGGER
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer CARPDQW9B6JXDK3WR08P21KKF8...
Error getting custom attributes for customer CARPDQW9B6JXDK3WR08P21KKF8: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: CARPDQW9B6JXDK3WR08P21KKF8
{"ts":"2025-12-01T17:02:59.034Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"0349dc01-aeaf-4b1c-9cf5-aa639c4336bb","stage":"booking","correlationId":"booking-created:b1f03e9335b6389cb9177b05"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-12-01T17:18:11.263Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"cb32a17a-e174-4220-9cc7-1b8e7274d45d","stage":"booking","correlationId":"booking-created:3353e3e887e7f7edaf7c3dbd","attempts":1}
üìÖ Processing booking created for customer: TXCZXNXFXSDZT59EWGXNT9SJ28
Full booking data: {
  "id": "k394rvm0ukej88",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-17T21:30:00Z",
  "created_at": "2025-12-01T17:07:54Z",
  "updated_at": "2025-12-01T17:07:54Z",
  "customer_id": "TXCZXNXFXSDZT59EWGXNT9SJ28",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMWAtQTYmZpwwxii"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMVwAQUdLz6no-cB",
      "any_team_member": false,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Joanna Rondon
üéâ First booking detected for customer: TXCZXNXFXSDZT59EWGXNT9SJ28
   Name: Joanna Rondon
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer TXCZXNXFXSDZT59EWGXNT9SJ28...
Error getting custom attributes for customer TXCZXNXFXSDZT59EWGXNT9SJ28: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: TXCZXNXFXSDZT59EWGXNT9SJ28
{"ts":"2025-12-01T17:18:12.089Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"cb32a17a-e174-4220-9cc7-1b8e7274d45d","stage":"booking","correlationId":"booking-created:3353e3e887e7f7edaf7c3dbd"}
{"ts":"2025-12-01T17:18:12.255Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"37385f41-16bd-4a99-b117-54fbd2df027f","stage":"customer_ingest","correlationId":"customer-created:02d2103a8928a396defd8c80","attempts":1}
üì• Received customer data: {
  "id": "P3XPMTRNCY1XHRTTWS8C6HXYT4",
  "address": {
    "country": "US"
  },
  "version": 0,
  "group_ids": [
    "LT4ZHFBQQYB2N.APPOINTMENTS"
  ],
  "created_at": "2025-12-01T17:08:19.871Z",
  "given_name": "Matti",
  "updated_at": "2025-12-01T17:08:19Z",
  "family_name": "Harrison",
  "preferences": {
    "email_unsubscribed": false
  },
  "phone_number": "+16025405862",
  "email_address": "mattiharrison1@gmail.com",
  "creation_source": "APPOINTMENTS"
}
üë§ Processing customer creation: P3XPMTRNCY1XHRTTWS8C6HXYT4
üìç IP Address: unknown
üìß Email: mattiharrison1@gmail.com
üìû Phone: +16025405862
üë§ Name: Matti Harrison
‚ö†Ô∏è Suspicious IP activity detected: unknown used by 120 customers
‚ö†Ô∏è Suspicious activity detected for customer P3XPMTRNCY1XHRTTWS8C6HXYT4, flagging for review
üéâ New customer detected: P3XPMTRNCY1XHRTTWS8C6HXYT4
‚úÖ Customer added to database as NEW (temporary mark)
   - Will check for referral code when they book
   - Will give gift card on first booking if code found
‚úÖ Verification: Customer found in DB: true
{"ts":"2025-12-01T17:18:12.672Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"37385f41-16bd-4a99-b117-54fbd2df027f","stage":"customer_ingest","correlationId":"customer-created:02d2103a8928a396defd8c80"}
{"ts":"2025-12-01T17:18:12.913Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"e7f3ba82-f366-4b9b-a3c9-a8d1ce29429d","stage":"booking","correlationId":"booking-created:20e934cd7ce56015266a8b93","attempts":1}
üìÖ Processing booking created for customer: P3XPMTRNCY1XHRTTWS8C6HXYT4
Full booking data: {
  "id": "1jpkdllb2aevjs",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-08T17:00:00Z",
  "created_at": "2025-12-01T17:08:22Z",
  "updated_at": "2025-12-01T17:08:22Z",
  "customer_id": "P3XPMTRNCY1XHRTTWS8C6HXYT4",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "P3XPMTRNCY1XHRTTWS8C6HXYT4",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMMHlgFBIFbMTRap",
      "any_team_member": false,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Matti Harrison
üéâ First booking detected for customer: P3XPMTRNCY1XHRTTWS8C6HXYT4
   Name: Matti Harrison
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer P3XPMTRNCY1XHRTTWS8C6HXYT4...
Error getting custom attributes for customer P3XPMTRNCY1XHRTTWS8C6HXYT4: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: P3XPMTRNCY1XHRTTWS8C6HXYT4
{"ts":"2025-12-01T17:18:13.362Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"e7f3ba82-f366-4b9b-a3c9-a8d1ce29429d","stage":"booking","correlationId":"booking-created:20e934cd7ce56015266a8b93"}
{"ts":"2025-12-01T17:18:13.523Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"c2b3fd0f-e437-4e70-8d5c-543c21077d1f","stage":"booking","correlationId":"booking-created:00c33a04a0f2aa686a719aaf","attempts":1}
üìÖ Processing booking created for customer: JBSSXD662STDAD89DZ5Z33VTT8
Full booking data: {
  "id": "5t9acxd8x6dbin",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-03T00:20:00Z",
  "created_at": "2025-12-01T17:12:36Z",
  "updated_at": "2025-12-01T17:12:36Z",
  "customer_id": "JBSSXD662STDAD89DZ5Z33VTT8",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMQPbDVvvOCLwqsy"
  },
  "appointment_segments": [
    {
      "team_member_id": "TM9jDlRr_Hl4rdBB",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "XBUDIMNKOPC2XVG5YLIQ4RYS",
      "service_variation_version": 1764191999049,
      "service_variation_client_id": "XBUDIMNKOPC2XVG5YLIQ4RYS"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Isabella Garcia-Camargo
üéâ First booking detected for customer: JBSSXD662STDAD89DZ5Z33VTT8
   Name: Isabella Garcia-Camargo
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer JBSSXD662STDAD89DZ5Z33VTT8...
Error getting custom attributes for customer JBSSXD662STDAD89DZ5Z33VTT8: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: JBSSXD662STDAD89DZ5Z33VTT8
{"ts":"2025-12-01T17:18:13.935Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"c2b3fd0f-e437-4e70-8d5c-543c21077d1f","stage":"booking","correlationId":"booking-created:00c33a04a0f2aa686a719aaf"}
{"ts":"2025-12-01T17:18:14.135Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"5bad89e1-e36d-42de-8c6f-b72a6243863a","stage":"booking","correlationId":"booking-created:6751071ac1af00f8b4416a03","attempts":1}
üìÖ Processing booking created for customer: JBSSXD662STDAD89DZ5Z33VTT8
Full booking data: {
  "id": "jztw55bp5wc2ul",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-03T00:20:00Z",
  "created_at": "2025-12-01T17:13:25Z",
  "updated_at": "2025-12-01T17:13:25Z",
  "customer_id": "JBSSXD662STDAD89DZ5Z33VTT8",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMQPbDVvvOCLwqsy"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMMHlgFBIFbMTRap",
      "any_team_member": false,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Isabella Garcia-Camargo
üéâ First booking detected for customer: JBSSXD662STDAD89DZ5Z33VTT8
   Name: Isabella Garcia-Camargo
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer JBSSXD662STDAD89DZ5Z33VTT8...
Error getting custom attributes for customer JBSSXD662STDAD89DZ5Z33VTT8: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: JBSSXD662STDAD89DZ5Z33VTT8
{"ts":"2025-12-01T17:18:14.536Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"5bad89e1-e36d-42de-8c6f-b72a6243863a","stage":"booking","correlationId":"booking-created:6751071ac1af00f8b4416a03"}
{"ts":"2025-12-01T17:18:14.722Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"adafef70-cba1-4849-bf9c-5b3fec502388","stage":"booking","correlationId":"booking-created:c87352a1819b85c9c50ff58b","attempts":1}
üìÖ Processing booking created for customer: JBSSXD662STDAD89DZ5Z33VTT8
Full booking data: {
  "id": "d76zn9mojhra1b",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-03T00:20:00Z",
  "created_at": "2025-12-01T17:14:04Z",
  "updated_at": "2025-12-01T17:14:04Z",
  "customer_id": "JBSSXD662STDAD89DZ5Z33VTT8",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMQPbDVvvOCLwqsy"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMyUMvTJIj2HrHSg",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "JMTK5M2CY2W7WEXSTAJKAJ35",
      "service_variation_version": 1762893947284,
      "service_variation_client_id": "JMTK5M2CY2W7WEXSTAJKAJ35"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
‚ùå Error processing booking creation: Connection terminated unexpectedly
Stack trace: Error: Connection terminated unexpectedly
    at /Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@neondatabase/serverless/index.js:1345:74
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async PrismaNeon.performIO (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/adapter-neon/dist/index.js:427:22)
    at async PrismaNeon.queryRaw (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/adapter-neon/dist/index.js:384:17)
    at async /Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:29:14083
{"ts":"2025-12-01T17:29:34.799Z","level":"error","event":"giftcard.worker.job.failed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"adafef70-cba1-4849-bf9c-5b3fec502388","stage":"booking","correlationId":"booking-created:c87352a1819b85c9c50ff58b","attempts":1,"error":"Connection terminated unexpectedly"}
{"ts":"2025-12-01T17:29:34.859Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"\nInvalid `prisma.$queryRaw()` invocation:\n\n\nServer has closed the connection.","stack":"PrismaClientKnownRequestError: \nInvalid `prisma.$queryRaw()` invocation:\n\n\nServer has closed the connection.\n    at $n.handleRequestError (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:121:7315)\n    at $n.handleAndLogRequestError (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:121:6623)\n    at $n.request (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:121:6307)\n    at async l (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:9633)\n    at async updateGiftCardRunStage (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/runs/giftcard-run-tracker.js:330:18)\n    at async markGiftCardRunError (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/runs/giftcard-run-tracker.js:364:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:133:9)"}
{"ts":"2025-12-01T17:29:38.146Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"a367a845-572e-452b-85d2-2673e44f7446","stage":"booking","correlationId":"booking-created:00e93ccd2edd983eae5e6f73","attempts":1}
üìÖ Processing booking created for customer: 595G2DQ37GHB99DDRADN67HPT8
Full booking data: {
  "id": "o5q81w9qmx18cf",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-05T01:30:00Z",
  "created_at": "2025-12-01T17:28:48Z",
  "updated_at": "2025-12-01T17:28:48Z",
  "customer_id": "595G2DQ37GHB99DDRADN67HPT8",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMWAtQTYmZpwwxii"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMMCVDJoKh3ZkfFo",
      "any_team_member": false,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1764609601083,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    },
    {
      "team_member_id": "TMMCVDJoKh3ZkfFo",
      "any_team_member": false,
      "duration_minutes": 20,
      "intermission_minutes": 0,
      "service_variation_id": "HAJX45W3U2WUCCXM5MI24UEE",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "HAJX45W3U2WUCCXM5MI24UEE"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: null null
Error retrieving Square customer 595G2DQ37GHB99DDRADN67HPT8: Response status code was not ok: 401.
Square API errors: [
  {
    "category": "AUTHENTICATION_ERROR",
    "code": "UNAUTHORIZED",
    "detail": "This request could not be authorized."
  }
]
üéâ First booking detected for customer: 595G2DQ37GHB99DDRADN67HPT8
   Name: null null
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 595G2DQ37GHB99DDRADN67HPT8...
Error getting custom attributes for customer 595G2DQ37GHB99DDRADN67HPT8: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 595G2DQ37GHB99DDRADN67HPT8
{"ts":"2025-12-01T17:29:39.371Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"a367a845-572e-452b-85d2-2673e44f7446","stage":"booking","correlationId":"booking-created:00e93ccd2edd983eae5e6f73"}
{"ts":"2025-12-01T17:46:38.256Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Server has closed the connection.","stack":"PrismaClientKnownRequestError: Server has closed the connection.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-01T17:46:40.973Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"62d35f4d-c0f1-491a-98ca-60e587606979","stage":"booking","correlationId":"booking-created:bc47596f0a9b41407af6f254","attempts":1}
üìÖ Processing booking created for customer: V9XW1F5VV01C0XFY7G65JC3XE8
Full booking data: {
  "id": "gf9em71e2v4qht",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-04T01:15:00Z",
  "created_at": "2025-12-01T17:38:07Z",
  "updated_at": "2025-12-01T17:38:07Z",
  "customer_id": "V9XW1F5VV01C0XFY7G65JC3XE8",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "V9XW1F5VV01C0XFY7G65JC3XE8",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TM-zXe9fXe4axYWn",
      "any_team_member": true,
      "duration_minutes": 140,
      "intermission_minutes": 0,
      "service_variation_id": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "CJI5WHOAKSFTASYPJ4MSYZLS"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Charlotte Waechter
üéâ First booking detected for customer: V9XW1F5VV01C0XFY7G65JC3XE8
   Name: Charlotte Waechter
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer V9XW1F5VV01C0XFY7G65JC3XE8...
Error getting custom attributes for customer V9XW1F5VV01C0XFY7G65JC3XE8: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: V9XW1F5VV01C0XFY7G65JC3XE8
{"ts":"2025-12-01T17:46:41.628Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"62d35f4d-c0f1-491a-98ca-60e587606979","stage":"booking","correlationId":"booking-created:bc47596f0a9b41407af6f254"}
{"ts":"2025-12-01T17:46:41.783Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"8ad80589-7aa5-4e6b-9351-d5e4d9bb3a8b","stage":"booking","correlationId":"booking-created:65590b4a7c5f85735b130a11","attempts":1}
üìÖ Processing booking created for customer: TBMN0G3EB44FVK99TP38YQFVM0
Full booking data: {
  "id": "tz6uvgqw67ppvh",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-15T22:40:00Z",
  "created_at": "2025-12-01T17:41:32Z",
  "updated_at": "2025-12-01T17:41:32Z",
  "customer_id": "TBMN0G3EB44FVK99TP38YQFVM0",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "TBMN0G3EB44FVK99TP38YQFVM0",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMVwAQUdLz6no-cB",
      "any_team_member": false,
      "duration_minutes": 100,
      "intermission_minutes": 0,
      "service_variation_id": "GSZZR45VJXB44NF4P4WXI5NB",
      "service_variation_version": 1764609577793,
      "service_variation_client_id": "GSZZR45VJXB44NF4P4WXI5NB"
    },
    {
      "team_member_id": "TMVwAQUdLz6no-cB",
      "any_team_member": false,
      "duration_minutes": 30,
      "intermission_minutes": 0,
      "service_variation_id": "LFLFEZO7L46URIM2OVZOJADI",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "LFLFEZO7L46URIM2OVZOJADI"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Emily Richmond
üéâ First booking detected for customer: TBMN0G3EB44FVK99TP38YQFVM0
   Name: Emily Richmond
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer TBMN0G3EB44FVK99TP38YQFVM0...
Error getting custom attributes for customer TBMN0G3EB44FVK99TP38YQFVM0: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: TBMN0G3EB44FVK99TP38YQFVM0
{"ts":"2025-12-01T17:46:42.161Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"8ad80589-7aa5-4e6b-9351-d5e4d9bb3a8b","stage":"booking","correlationId":"booking-created:65590b4a7c5f85735b130a11"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-12-01T18:04:26.391Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"c9bc769a-3271-43e8-abbf-7438a3f539d5","stage":"booking","correlationId":"booking-created:07112a3bfba9fa40b0acadd9","attempts":1}
üìÖ Processing booking created for customer: 5XF0BMGYFFCMQFVD469XRWXZK8
Full booking data: {
  "id": "gpfz3lvteegfrx",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-27T19:30:00Z",
  "created_at": "2025-12-01T17:47:32Z",
  "updated_at": "2025-12-01T17:47:32Z",
  "customer_id": "5XF0BMGYFFCMQFVD469XRWXZK8",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "5XF0BMGYFFCMQFVD469XRWXZK8",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMNW4SIF7tjp4oM_",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "BRSIGZFOWC6F4ERPKX3CODLU",
      "service_variation_version": 1764609577793,
      "service_variation_client_id": "BRSIGZFOWC6F4ERPKX3CODLU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Megan Reynolds
üéâ First booking detected for customer: 5XF0BMGYFFCMQFVD469XRWXZK8
   Name: Megan Reynolds
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 5XF0BMGYFFCMQFVD469XRWXZK8...
Error getting custom attributes for customer 5XF0BMGYFFCMQFVD469XRWXZK8: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 5XF0BMGYFFCMQFVD469XRWXZK8
{"ts":"2025-12-01T18:04:27.105Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"c9bc769a-3271-43e8-abbf-7438a3f539d5","stage":"booking","correlationId":"booking-created:07112a3bfba9fa40b0acadd9"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-12-01T18:16:09.844Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"f51c8848-3739-4fa1-b4d1-3efc171ce648","stage":"customer_ingest","correlationId":"customer-created:c7ff55505bda9e039b8e1ec1","attempts":1}
üì• Received customer data: {
  "id": "7D6Q3R5K8S8NH3SSGMA75KWR6W",
  "version": 0,
  "created_at": "2025-12-01T18:08:25.321Z",
  "given_name": "Julia",
  "updated_at": "2025-12-01T18:08:25Z",
  "family_name": "Lucey",
  "preferences": {
    "email_unsubscribed": false
  },
  "phone_number": "+14152598004",
  "email_address": "Julialucey@comcast.net",
  "creation_source": "THIRD_PARTY"
}
üë§ Processing customer creation: 7D6Q3R5K8S8NH3SSGMA75KWR6W
üìç IP Address: unknown
üìß Email: Julialucey@comcast.net
üìû Phone: +14152598004
üë§ Name: Julia Lucey
‚ö†Ô∏è Suspicious IP activity detected: unknown used by 121 customers
‚ö†Ô∏è Suspicious activity detected for customer 7D6Q3R5K8S8NH3SSGMA75KWR6W, flagging for review
üéâ New customer detected: 7D6Q3R5K8S8NH3SSGMA75KWR6W
‚úÖ Customer added to database as NEW (temporary mark)
   - Will check for referral code when they book
   - Will give gift card on first booking if code found
‚úÖ Verification: Customer found in DB: true
{"ts":"2025-12-01T18:16:10.478Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"f51c8848-3739-4fa1-b4d1-3efc171ce648","stage":"customer_ingest","correlationId":"customer-created:c7ff55505bda9e039b8e1ec1"}
{"ts":"2025-12-01T18:16:10.637Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"abefa9c0-9be8-40bf-92e4-d0563cb30510","stage":"booking","correlationId":"booking-created:5f303cc9ae51ffba09889a4c","attempts":1}
üìÖ Processing booking created for customer: 7D6Q3R5K8S8NH3SSGMA75KWR6W
Full booking data: {
  "id": "lqbnn6in5o10cd",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-08T01:00:00Z",
  "created_at": "2025-12-01T18:10:00Z",
  "updated_at": "2025-12-01T18:10:00Z",
  "customer_id": "7D6Q3R5K8S8NH3SSGMA75KWR6W",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMQPbDVvvOCLwqsy"
  },
  "appointment_segments": [
    {
      "team_member_id": "TM7_r-KmvY9xjnEU",
      "any_team_member": false,
      "duration_minutes": 110,
      "intermission_minutes": 0,
      "service_variation_id": "GJ5SRTYFV6ZCDI62TMSZP2OP",
      "service_variation_version": 1764609577793,
      "service_variation_client_id": "GJ5SRTYFV6ZCDI62TMSZP2OP"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Julia Lucey
üéâ First booking detected for customer: 7D6Q3R5K8S8NH3SSGMA75KWR6W
   Name: Julia Lucey
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 7D6Q3R5K8S8NH3SSGMA75KWR6W...
Error getting custom attributes for customer 7D6Q3R5K8S8NH3SSGMA75KWR6W: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 7D6Q3R5K8S8NH3SSGMA75KWR6W
{"ts":"2025-12-01T18:16:11.041Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"abefa9c0-9be8-40bf-92e4-d0563cb30510","stage":"booking","correlationId":"booking-created:5f303cc9ae51ffba09889a4c"}
{"ts":"2025-12-01T18:16:11.198Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"8fa7c868-06ed-41c9-aefd-a2a2de4d3ff3","stage":"booking","correlationId":"booking-created:bf9c489e8b384fbc4e53a4c8","attempts":1}
üìÖ Processing booking created for customer: 7D6Q3R5K8S8NH3SSGMA75KWR6W
Full booking data: {
  "id": "44b1xsqjbfugte",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-08T01:00:00Z",
  "created_at": "2025-12-01T18:10:33Z",
  "updated_at": "2025-12-01T18:10:33Z",
  "customer_id": "7D6Q3R5K8S8NH3SSGMA75KWR6W",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMQPbDVvvOCLwqsy"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMe-bT5XxKxmk0nw",
      "any_team_member": false,
      "duration_minutes": 140,
      "intermission_minutes": 0,
      "service_variation_id": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "CJI5WHOAKSFTASYPJ4MSYZLS"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Julia Lucey
üéâ First booking detected for customer: 7D6Q3R5K8S8NH3SSGMA75KWR6W
   Name: Julia Lucey
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 7D6Q3R5K8S8NH3SSGMA75KWR6W...
Error getting custom attributes for customer 7D6Q3R5K8S8NH3SSGMA75KWR6W: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 7D6Q3R5K8S8NH3SSGMA75KWR6W
{"ts":"2025-12-01T18:16:11.583Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"8fa7c868-06ed-41c9-aefd-a2a2de4d3ff3","stage":"booking","correlationId":"booking-created:bf9c489e8b384fbc4e53a4c8"}
{"ts":"2025-12-01T18:33:51.947Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"abda3d31-2118-49be-a312-b307be053bf8","stage":"booking","correlationId":"booking-created:d978e4901895068347ca042d","attempts":1}
üìÖ Processing booking created for customer: VK76GYDZ8DNJ4GQTWATAD2SAGM
Full booking data: {
  "id": "433fn341ayaitm",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-03T18:00:00Z",
  "created_at": "2025-12-01T18:31:54Z",
  "updated_at": "2025-12-01T18:31:54Z",
  "customer_id": "VK76GYDZ8DNJ4GQTWATAD2SAGM",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMWAtQTYmZpwwxii"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMMCVDJoKh3ZkfFo",
      "any_team_member": false,
      "duration_minutes": 45,
      "intermission_minutes": 0,
      "service_variation_id": "VVA7G2UN7N2HUFMCW5LQOVHB",
      "service_variation_version": 1763579781183,
      "service_variation_client_id": "VVA7G2UN7N2HUFMCW5LQOVHB"
    },
    {
      "team_member_id": "TMMCVDJoKh3ZkfFo",
      "any_team_member": false,
      "duration_minutes": 5,
      "intermission_minutes": 0,
      "service_variation_id": "DBRXEHQPCF7V4APTHDQTZW62",
      "service_variation_version": 1762374620368,
      "service_variation_client_id": "DBRXEHQPCF7V4APTHDQTZW62"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Alina Arzamassky
üéâ First booking detected for customer: VK76GYDZ8DNJ4GQTWATAD2SAGM
   Name: Alina Arzamassky
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer VK76GYDZ8DNJ4GQTWATAD2SAGM...
Error getting custom attributes for customer VK76GYDZ8DNJ4GQTWATAD2SAGM: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: VK76GYDZ8DNJ4GQTWATAD2SAGM
{"ts":"2025-12-01T18:33:52.710Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"abda3d31-2118-49be-a312-b307be053bf8","stage":"booking","correlationId":"booking-created:d978e4901895068347ca042d"}
{"ts":"2025-12-01T18:33:52.875Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"c62b37b0-8d48-46f6-b852-6a6cf29d0805","stage":"booking","correlationId":"booking-created:a782e5493dcea6159e9a6795","attempts":1}
üìÖ Processing booking created for customer: VK76GYDZ8DNJ4GQTWATAD2SAGM
Full booking data: {
  "id": "jwhms7kv5tu6p9",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-03T18:00:00Z",
  "created_at": "2025-12-01T18:32:31Z",
  "updated_at": "2025-12-01T18:32:31Z",
  "customer_id": "VK76GYDZ8DNJ4GQTWATAD2SAGM",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMWAtQTYmZpwwxii"
  },
  "appointment_segments": [
    {
      "resource_ids": [
        "5OVIQ6GSSUXORACP6T7WBAQ7"
      ],
      "team_member_id": "TMXiw38Bbb7XQUWI",
      "any_team_member": false,
      "duration_minutes": 60,
      "intermission_minutes": 0,
      "service_variation_id": "SBE5XUATXRM76CBTT25HL2NZ",
      "service_variation_version": 1760895536505,
      "service_variation_client_id": "SBE5XUATXRM76CBTT25HL2NZ"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Alina Arzamassky
üéâ First booking detected for customer: VK76GYDZ8DNJ4GQTWATAD2SAGM
   Name: Alina Arzamassky
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer VK76GYDZ8DNJ4GQTWATAD2SAGM...
Error getting custom attributes for customer VK76GYDZ8DNJ4GQTWATAD2SAGM: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: VK76GYDZ8DNJ4GQTWATAD2SAGM
{"ts":"2025-12-01T18:33:53.389Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"c62b37b0-8d48-46f6-b852-6a6cf29d0805","stage":"booking","correlationId":"booking-created:a782e5493dcea6159e9a6795"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-12-01T18:47:39.061Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"d57e4caf-da3a-43ad-b1d2-124f65e8a581","stage":"booking","correlationId":"booking-created:8083551115d5395623a4e13c","attempts":1}
üìÖ Processing booking created for customer: WH10ACWXEP8094X832TZG04JT4
Full booking data: {
  "id": "mco7vp1osi22yg",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-03T02:00:00Z",
  "created_at": "2025-12-01T18:42:29Z",
  "updated_at": "2025-12-01T18:42:29Z",
  "customer_id": "WH10ACWXEP8094X832TZG04JT4",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMWAtQTYmZpwwxii"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMVwAQUdLz6no-cB",
      "any_team_member": false,
      "duration_minutes": 100,
      "intermission_minutes": 0,
      "service_variation_id": "GSZZR45VJXB44NF4P4WXI5NB",
      "service_variation_version": 1764609577793,
      "service_variation_client_id": "GSZZR45VJXB44NF4P4WXI5NB"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Crystal Yu
üéâ First booking detected for customer: WH10ACWXEP8094X832TZG04JT4
   Name: Crystal Yu
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer WH10ACWXEP8094X832TZG04JT4...
Error getting custom attributes for customer WH10ACWXEP8094X832TZG04JT4: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: WH10ACWXEP8094X832TZG04JT4
{"ts":"2025-12-01T18:47:39.765Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"d57e4caf-da3a-43ad-b1d2-124f65e8a581","stage":"booking","correlationId":"booking-created:8083551115d5395623a4e13c"}
{"ts":"2025-12-01T18:47:39.934Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"2af8757d-ec41-487a-a2e7-544f294fa3c6","stage":"payment","correlationId":"payment-updated:87f34e1e0427e44d08a1a837","attempts":1}
üí∞ Processing payment completion for customer: ENYVMR66DSAGXQ45GR7FA393XC
   Payment source_type: CARD
   Payment tender_types: []
Customer ENYVMR66DSAGXQ45GR7FA393XC already completed first payment
{"ts":"2025-12-01T18:47:40.081Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"2af8757d-ec41-487a-a2e7-544f294fa3c6","stage":"payment","correlationId":"payment-updated:87f34e1e0427e44d08a1a837"}
{"ts":"2025-12-01T18:47:40.251Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"856caf59-e10a-4953-bc81-aa94142a371e","stage":"payment","correlationId":"payment-updated:27fa951ad84d2d0a5c0275a0","attempts":1}
üí∞ Processing payment completion for customer: ENYVMR66DSAGXQ45GR7FA393XC
   Payment source_type: CARD
   Payment tender_types: []
Customer ENYVMR66DSAGXQ45GR7FA393XC already completed first payment
{"ts":"2025-12-01T18:47:40.387Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"856caf59-e10a-4953-bc81-aa94142a371e","stage":"payment","correlationId":"payment-updated:27fa951ad84d2d0a5c0275a0"}
{"ts":"2025-12-01T19:03:31.562Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Server has closed the connection.","stack":"PrismaClientKnownRequestError: Server has closed the connection.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-01T19:03:34.721Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"a49bd1ec-a1cb-4b6a-bdd3-9ccb46f775d4","stage":"payment","correlationId":"payment-updated:72feb6635ca17b61c1f00b6b","attempts":1}
üí∞ Processing payment completion for customer: KE2AVN7NE59QD1W312Y7AZCHMR
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Ekaterina Androsova
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Ekaterina Androsova, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Ekaterina Androsova
   - Email: eandrosova1985@icloud.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: KE2AVN7NE59QD1W312Y7AZCHMR
{"ts":"2025-12-01T19:03:35.311Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"a49bd1ec-a1cb-4b6a-bdd3-9ccb46f775d4","stage":"payment","correlationId":"payment-updated:72feb6635ca17b61c1f00b6b"}
{"ts":"2025-12-01T19:03:35.470Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"c3507e8e-c3d3-4f88-8f47-23f76f0fe4c3","stage":"payment","correlationId":"payment-updated:a7743dbfa42b7c776e411264","attempts":1}
üí∞ Processing payment completion for customer: KE2AVN7NE59QD1W312Y7AZCHMR
   Payment source_type: CARD
   Payment tender_types: []
Customer KE2AVN7NE59QD1W312Y7AZCHMR already completed first payment
{"ts":"2025-12-01T19:03:35.606Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"c3507e8e-c3d3-4f88-8f47-23f76f0fe4c3","stage":"payment","correlationId":"payment-updated:a7743dbfa42b7c776e411264"}
{"ts":"2025-12-01T19:03:35.770Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"420f1339-03e4-453b-9549-bedd35159ae1","stage":"payment","correlationId":"payment-updated:d671e1b692669aae16fbfac7","attempts":1}
üí∞ Processing payment completion for customer: W8X9W9RPZ3QX6KW4JBBFHBR63W
   Payment source_type: CARD
   Payment tender_types: []
Error processing payment completion: Error: Connection terminated unexpectedly
    at /Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@neondatabase/serverless/index.js:1345:74
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async PrismaNeon.performIO (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/adapter-neon/dist/index.js:427:22)
    at async PrismaNeon.queryRaw (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/adapter-neon/dist/index.js:384:17)
    at async /Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:29:14083 {
  clientVersion: '5.22.0'
}
{"ts":"2025-12-01T19:19:18.212Z","level":"error","event":"giftcard.worker.job.failed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"420f1339-03e4-453b-9549-bedd35159ae1","stage":"payment","correlationId":"payment-updated:d671e1b692669aae16fbfac7","attempts":1,"error":"Connection terminated unexpectedly"}
{"ts":"2025-12-01T19:19:18.245Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"\nInvalid `prisma.$queryRaw()` invocation:\n\n\nServer has closed the connection.","stack":"PrismaClientKnownRequestError: \nInvalid `prisma.$queryRaw()` invocation:\n\n\nServer has closed the connection.\n    at $n.handleRequestError (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:121:7315)\n    at $n.handleAndLogRequestError (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:121:6623)\n    at $n.request (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:121:6307)\n    at async l (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:9633)\n    at async updateGiftCardRunStage (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/runs/giftcard-run-tracker.js:330:18)\n    at async markGiftCardRunError (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/runs/giftcard-run-tracker.js:364:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:133:9)"}
{"ts":"2025-12-01T19:19:20.896Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"18eb1a7c-ed36-4e8a-ae49-fac175ce9127","stage":"payment","correlationId":"payment-updated:61e7954cf393188946493ffe","attempts":1}
No customer ID in payment data, skipping...
Payment data received: {
  "id": "rRUfI1IN6YK2gV0V3kunztD8wvcZY",
  "status": "COMPLETED",
  "version": 3,
  "order_id": "pA7LrtvPl3dT38HIFlEpELgXIFXZY",
  "tip_money": {
    "amount": 1000,
    "currency": "USD"
  },
  "created_at": "2025-12-01T18:57:10.168Z",
  "updated_at": "2025-12-01T18:57:15.384Z",
  "employee_id": "TMQPbDVvvOCLwqsy",
  "location_id": "LT4ZHFBQQYB2N",
  "receipt_url": "https://squareup.com/receipt/preview/rRUfI1IN6YK2gV0V3kunztD8wvcZY",
  "source_type": "CARD",
  "total_money": {
    "amount": 5000,
    "currency": "USD"
  },
  "amount_money": {
    "amount": 4000,
    "currency": "USD"
  },
  "card_details": {
    "card": {
      "bin": "414720",
      "last_4": "3845",
      "exp_year": 2027,
      "card_type": "CREDIT",
      "exp_month": 11,
      "card_brand": "VISA",
      "fingerprint": "sq-1-wkTA1JXMDkVIxurcC7YiQql7ohWC_53RC1J3IhwlVctUF5t6IKV8uS-eZKrgAYbr6w",
      "prepaid_type": "NOT_PREPAID",
      "payment_account_reference": "V0010013822321163697180431473"
    },
    "status": "CAPTURED",
    "avs_status": "AVS_ACCEPTED",
    "cvv_status": "CVV_NOT_CHECKED",
    "entry_method": "KEYED",
    "device_details": {
      "device_id": "DEVICE_INSTALLATION_ID:914537D2-2376-4915-9309-D8B7C04A3892",
      "device_name": "iPad",
      "device_installation_id": "914537D2-2376-4915-9309-D8B7C04A3892"
    },
    "auth_result_code": "01310D",
    "card_payment_timeline": {
      "captured_at": "2025-12-01T18:57:14.819Z",
      "authorized_at": "2025-12-01T18:57:10.637Z"
    },
    "statement_description": "SQ *ZORINA NAIL STUDIO 2"
  },
  "delay_action": "CANCEL",
  "delayed_until": "2025-12-01T20:07:10.168Z",
  "approved_money": {
    "amount": 5000,
    "currency": "USD"
  },
  "delay_duration": "PT70M",
  "device_details": {
    "device_id": "DEVICE_INSTALLATION_ID:914537D2-2376-4915-9309-D8B7C04A3892",
    "device_name": "iPad",
    "device_installation_id": "914537D2-2376-4915-9309-D8B7C04A3892"
  },
  "receipt_number": "rRUf",
  "team_member_id": "TMQPbDVvvOCLwqsy",
  "application_details": {
    "square_product": "SQUARE_POS"
  }
}
{"ts":"2025-12-01T19:19:21.026Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"18eb1a7c-ed36-4e8a-ae49-fac175ce9127","stage":"payment","correlationId":"payment-updated:61e7954cf393188946493ffe"}
{"ts":"2025-12-01T19:19:21.185Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"947ea8e6-b949-4e11-b325-0dba96e64a9a","stage":"payment","correlationId":"payment-updated:516f28d1f42a423e98bc16c9","attempts":1}
üí∞ Processing payment completion for customer: W8X9W9RPZ3QX6KW4JBBFHBR63W
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Janice Jung
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Janice Jung, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Janice Jung
   - Email: jungjanice87@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: W8X9W9RPZ3QX6KW4JBBFHBR63W
{"ts":"2025-12-01T19:19:21.534Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"947ea8e6-b949-4e11-b325-0dba96e64a9a","stage":"payment","correlationId":"payment-updated:516f28d1f42a423e98bc16c9"}
{"ts":"2025-12-01T19:19:21.626Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"7d0b310a-43cf-45d7-a173-8338c477a67a","stage":"payment","correlationId":"payment-updated:476a2e8e402b9155c94bb028","attempts":1}
üí∞ Processing payment completion for customer: W8X9W9RPZ3QX6KW4JBBFHBR63W
   Payment source_type: CARD
   Payment tender_types: []
Customer W8X9W9RPZ3QX6KW4JBBFHBR63W already completed first payment
{"ts":"2025-12-01T19:19:21.760Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"7d0b310a-43cf-45d7-a173-8338c477a67a","stage":"payment","correlationId":"payment-updated:476a2e8e402b9155c94bb028"}
{"ts":"2025-12-01T19:25:51.769Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"\nInvalid `prisma.$queryRaw()` invocation:\n\n\nServer has closed the connection.","stack":"PrismaClientKnownRequestError: \nInvalid `prisma.$queryRaw()` invocation:\n\n\nServer has closed the connection.\n    at $n.handleRequestError (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:121:7315)\n    at $n.handleAndLogRequestError (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:121:6623)\n    at $n.request (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:121:6307)\n    at async l (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:9633)\n    at async prisma.$transaction.isolationLevel (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:239:26)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:8000)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-01T19:25:54.839Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"1594742d-c279-4d1e-baec-0717a20dc490","stage":"booking","correlationId":"booking-created:203ff02f1556f5cf3c0f15b8","attempts":1}
üìÖ Processing booking created for customer: XPC0VBPBSKXWXRVBS7BBX5NRKM
Full booking data: {
  "id": "hzgajkf5beb02t",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-03T00:00:00Z",
  "created_at": "2025-12-01T19:05:02Z",
  "updated_at": "2025-12-01T19:05:02Z",
  "customer_id": "XPC0VBPBSKXWXRVBS7BBX5NRKM",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "XPC0VBPBSKXWXRVBS7BBX5NRKM",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMMBgVwykMnOlumA",
      "any_team_member": true,
      "duration_minutes": 140,
      "intermission_minutes": 0,
      "service_variation_id": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "CJI5WHOAKSFTASYPJ4MSYZLS"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Julianne McGoldrick
üéâ First booking detected for customer: XPC0VBPBSKXWXRVBS7BBX5NRKM
   Name: Julianne McGoldrick
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer XPC0VBPBSKXWXRVBS7BBX5NRKM...
Error getting custom attributes for customer XPC0VBPBSKXWXRVBS7BBX5NRKM: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: XPC0VBPBSKXWXRVBS7BBX5NRKM
{"ts":"2025-12-01T19:25:55.537Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"1594742d-c279-4d1e-baec-0717a20dc490","stage":"booking","correlationId":"booking-created:203ff02f1556f5cf3c0f15b8"}
{"ts":"2025-12-01T19:25:55.697Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"9c027a51-4a0f-4891-bb53-3799c0677ec7","stage":"booking","correlationId":"booking-created:22bfa197f6bb2c4d6e92c36a","attempts":1}
üìÖ Processing booking created for customer: RZTV01R2J10T57GAD57BWHJBSR
Full booking data: {
  "id": "3vbwpffiomuvyj",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-19T00:30:00Z",
  "created_at": "2025-12-01T19:05:42Z",
  "updated_at": "2025-12-01T19:05:42Z",
  "customer_id": "RZTV01R2J10T57GAD57BWHJBSR",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMQPbDVvvOCLwqsy"
  },
  "appointment_segments": [
    {
      "team_member_id": "TM9jDlRr_Hl4rdBB",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "XBUDIMNKOPC2XVG5YLIQ4RYS",
      "service_variation_version": 1764609577793,
      "service_variation_client_id": "XBUDIMNKOPC2XVG5YLIQ4RYS"
    },
    {
      "team_member_id": "TM9jDlRr_Hl4rdBB",
      "any_team_member": false,
      "duration_minutes": 20,
      "intermission_minutes": 0,
      "service_variation_id": "HAJX45W3U2WUCCXM5MI24UEE",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "HAJX45W3U2WUCCXM5MI24UEE"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Alex Cardona
üéâ First booking detected for customer: RZTV01R2J10T57GAD57BWHJBSR
   Name: Alex Cardona
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer RZTV01R2J10T57GAD57BWHJBSR...
Error getting custom attributes for customer RZTV01R2J10T57GAD57BWHJBSR: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: RZTV01R2J10T57GAD57BWHJBSR
{"ts":"2025-12-01T19:25:56.106Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"9c027a51-4a0f-4891-bb53-3799c0677ec7","stage":"booking","correlationId":"booking-created:22bfa197f6bb2c4d6e92c36a"}
{"ts":"2025-12-01T19:25:56.367Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"58af1a70-18c3-4411-ad0d-f2efc4f1d57e","stage":"booking","correlationId":"booking-created:ef0bed422380bfcd6e983b48","attempts":1}
üìÖ Processing booking created for customer: 446Q3R1YQ956K58XW9SW2W151C
Full booking data: {
  "id": "k9hikwtahw8hs5",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-27T20:00:00Z",
  "created_at": "2025-12-01T19:11:24Z",
  "updated_at": "2025-12-01T19:11:24Z",
  "customer_id": "446Q3R1YQ956K58XW9SW2W151C",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "446Q3R1YQ956K58XW9SW2W151C",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TM1L5yPC-yKx6CyO",
      "any_team_member": false,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "NCOIL6ZGDTCC7SO3IJHENCQ2",
      "service_variation_version": 1764609577793,
      "service_variation_client_id": "NCOIL6ZGDTCC7SO3IJHENCQ2"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Luciana Corral
üéâ First booking detected for customer: 446Q3R1YQ956K58XW9SW2W151C
   Name: Luciana Corral
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 446Q3R1YQ956K58XW9SW2W151C...
Error getting custom attributes for customer 446Q3R1YQ956K58XW9SW2W151C: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 446Q3R1YQ956K58XW9SW2W151C
{"ts":"2025-12-01T19:25:56.767Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"58af1a70-18c3-4411-ad0d-f2efc4f1d57e","stage":"booking","correlationId":"booking-created:ef0bed422380bfcd6e983b48"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-12-01T19:47:12.369Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"dbcb224f-c05d-4fbd-b892-2db3f459d19a","stage":"booking","correlationId":"booking-created:98086e1b90418522a407b694","attempts":1}
üìÖ Processing booking created for customer: 853SMKGAWCW44FNR7MZ23FZBH8
Full booking data: {
  "id": "oqxfvyi7z3bh21",
  "source": "THIRD_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-02T01:00:00Z",
  "created_at": "2025-12-01T19:35:25Z",
  "updated_at": "2025-12-01T19:35:25Z",
  "customer_id": "853SMKGAWCW44FNR7MZ23FZBH8",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "853SMKGAWCW44FNR7MZ23FZBH8",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TM1L5yPC-yKx6CyO",
      "any_team_member": false,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "NCOIL6ZGDTCC7SO3IJHENCQ2",
      "service_variation_version": 1764609577793,
      "service_variation_client_id": "NCOIL6ZGDTCC7SO3IJHENCQ2"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Anastasia S
üéâ First booking detected for customer: 853SMKGAWCW44FNR7MZ23FZBH8
   Name: Anastasia S
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 853SMKGAWCW44FNR7MZ23FZBH8...
Error getting custom attributes for customer 853SMKGAWCW44FNR7MZ23FZBH8: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 853SMKGAWCW44FNR7MZ23FZBH8
{"ts":"2025-12-01T19:47:13.224Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"dbcb224f-c05d-4fbd-b892-2db3f459d19a","stage":"booking","correlationId":"booking-created:98086e1b90418522a407b694"}
{"ts":"2025-12-01T19:47:13.395Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"a4a08631-1596-4003-8ded-690ffc87ce60","stage":"payment","correlationId":"payment-updated:3f15213d07e0b1d7974ef1e7","attempts":1}
üí∞ Processing payment completion for customer: D2BJ46CXWNZNF5CT2RJMJQN89R
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Connie Tamaddon
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Connie Tamaddon, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Connie Tamaddon
   - Email: connie@mac.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: D2BJ46CXWNZNF5CT2RJMJQN89R
{"ts":"2025-12-01T19:47:13.825Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"a4a08631-1596-4003-8ded-690ffc87ce60","stage":"payment","correlationId":"payment-updated:3f15213d07e0b1d7974ef1e7"}
{"ts":"2025-12-01T19:47:13.987Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"663b3e0d-34d2-4799-b7ad-707703b2481b","stage":"payment","correlationId":"payment-updated:ea3a5c2f5713654e6daf1fea","attempts":1}
üí∞ Processing payment completion for customer: D2BJ46CXWNZNF5CT2RJMJQN89R
   Payment source_type: CARD
   Payment tender_types: []
Customer D2BJ46CXWNZNF5CT2RJMJQN89R already completed first payment
{"ts":"2025-12-01T19:47:14.150Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"663b3e0d-34d2-4799-b7ad-707703b2481b","stage":"payment","correlationId":"payment-updated:ea3a5c2f5713654e6daf1fea"}
{"ts":"2025-12-01T19:47:14.319Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"52f4c429-caae-4e6c-9e4e-f5e04bf0527b","stage":"payment","correlationId":"payment-updated:0c9ebafd38c045053b417d53","attempts":1}
üí∞ Processing payment completion for customer: NAPS7QWF3KY5E7P68X24SB606R
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Zuzana Mimochodek
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Zuzana Mimochodek, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Zuzana Mimochodek
   - Email: Zuzanahodova@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: NAPS7QWF3KY5E7P68X24SB606R
{"ts":"2025-12-01T19:47:14.629Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"52f4c429-caae-4e6c-9e4e-f5e04bf0527b","stage":"payment","correlationId":"payment-updated:0c9ebafd38c045053b417d53"}
{"ts":"2025-12-01T19:47:14.793Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"07765d1f-b63c-4850-97fd-30d13b2ca7fa","stage":"payment","correlationId":"payment-updated:71c05cb671eeb99a5f7e1c02","attempts":1}
üí∞ Processing payment completion for customer: NAPS7QWF3KY5E7P68X24SB606R
   Payment source_type: CARD
   Payment tender_types: []
Customer NAPS7QWF3KY5E7P68X24SB606R already completed first payment
{"ts":"2025-12-01T19:47:15.011Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"07765d1f-b63c-4850-97fd-30d13b2ca7fa","stage":"payment","correlationId":"payment-updated:71c05cb671eeb99a5f7e1c02"}
{"ts":"2025-12-01T19:47:15.303Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"1deccbf4-f2d7-4fb4-b42e-795f916a806f","stage":"booking","correlationId":"booking-created:dd4f037e530146d89e0df902","attempts":1}
üìÖ Processing booking created for customer: D2BJ46CXWNZNF5CT2RJMJQN89R
Full booking data: {
  "id": "x0vfwdr2chnsrc",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-29T19:50:00Z",
  "created_at": "2025-12-01T19:38:55Z",
  "updated_at": "2025-12-01T19:38:55Z",
  "customer_id": "D2BJ46CXWNZNF5CT2RJMJQN89R",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMWAtQTYmZpwwxii"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMgsjtuk5cfKnstq",
      "any_team_member": false,
      "duration_minutes": 110,
      "intermission_minutes": 0,
      "service_variation_id": "6TYOE67IDYTKHW2ZG6HKVZER",
      "service_variation_version": 1757963765505,
      "service_variation_client_id": "6TYOE67IDYTKHW2ZG6HKVZER"
    },
    {
      "team_member_id": "TMgsjtuk5cfKnstq",
      "any_team_member": false,
      "duration_minutes": 5,
      "intermission_minutes": 0,
      "service_variation_id": "DBRXEHQPCF7V4APTHDQTZW62",
      "service_variation_version": 1762374620368,
      "service_variation_client_id": "DBRXEHQPCF7V4APTHDQTZW62"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Connie Tamaddon
üéâ First booking detected for customer: D2BJ46CXWNZNF5CT2RJMJQN89R
   Name: Connie Tamaddon
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer D2BJ46CXWNZNF5CT2RJMJQN89R...
Error getting custom attributes for customer D2BJ46CXWNZNF5CT2RJMJQN89R: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: D2BJ46CXWNZNF5CT2RJMJQN89R
{"ts":"2025-12-01T19:47:16.125Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"1deccbf4-f2d7-4fb4-b42e-795f916a806f","stage":"booking","correlationId":"booking-created:dd4f037e530146d89e0df902"}
{"ts":"2025-12-01T19:47:16.322Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"235b5f82-e436-4426-aefb-e4db5b279794","stage":"booking","correlationId":"booking-created:57417739891cdfac74d8fae2","attempts":1}
üìÖ Processing booking created for customer: 1D1FWPF6JNW0CWEWAY0T82GAXR
Full booking data: {
  "id": "l8hw7wivl5p1l5",
  "source": "THIRD_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-07T21:00:00Z",
  "created_at": "2025-12-01T19:38:57Z",
  "updated_at": "2025-12-01T19:38:57Z",
  "customer_id": "1D1FWPF6JNW0CWEWAY0T82GAXR",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "1D1FWPF6JNW0CWEWAY0T82GAXR",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TM7_r-KmvY9xjnEU",
      "any_team_member": true,
      "duration_minutes": 30,
      "intermission_minutes": 0,
      "service_variation_id": "JNRUKPGA2ZZUFCEB6YPNDC2Y",
      "service_variation_version": 1760895536505,
      "service_variation_client_id": "JNRUKPGA2ZZUFCEB6YPNDC2Y"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Alex Wade
üéâ First booking detected for customer: 1D1FWPF6JNW0CWEWAY0T82GAXR
   Name: Alex Wade
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 1D1FWPF6JNW0CWEWAY0T82GAXR...
Error getting custom attributes for customer 1D1FWPF6JNW0CWEWAY0T82GAXR: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 1D1FWPF6JNW0CWEWAY0T82GAXR
{"ts":"2025-12-01T19:47:16.847Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"235b5f82-e436-4426-aefb-e4db5b279794","stage":"booking","correlationId":"booking-created:57417739891cdfac74d8fae2"}
{"ts":"2025-12-01T19:47:17.034Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"725a20ad-3424-4696-aa72-6d880b8fc874","stage":"booking","correlationId":"booking-created:4622b295fc51dec5cdca436d","attempts":1}
üìÖ Processing booking created for customer: D2BJ46CXWNZNF5CT2RJMJQN89R
Full booking data: {
  "id": "o71ng4au86n93g",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-29T19:50:00Z",
  "created_at": "2025-12-01T19:40:10Z",
  "updated_at": "2025-12-01T19:40:10Z",
  "customer_id": "D2BJ46CXWNZNF5CT2RJMJQN89R",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMWAtQTYmZpwwxii"
  },
  "appointment_segments": [
    {
      "resource_ids": [
        "5OVIQ6GSSUXORACP6T7WBAQ7"
      ],
      "team_member_id": "TMVwAQUdLz6no-cB",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "ZEAKNB35I37RMXNUBGWDZQIM",
      "service_variation_version": 1760895536505,
      "service_variation_client_id": "ZEAKNB35I37RMXNUBGWDZQIM"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Connie Tamaddon
üéâ First booking detected for customer: D2BJ46CXWNZNF5CT2RJMJQN89R
   Name: Connie Tamaddon
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer D2BJ46CXWNZNF5CT2RJMJQN89R...
Error getting custom attributes for customer D2BJ46CXWNZNF5CT2RJMJQN89R: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: D2BJ46CXWNZNF5CT2RJMJQN89R
{"ts":"2025-12-01T19:47:17.427Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"725a20ad-3424-4696-aa72-6d880b8fc874","stage":"booking","correlationId":"booking-created:4622b295fc51dec5cdca436d"}
{"ts":"2025-12-01T19:47:17.599Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"1403c1e1-7719-4961-86d1-736fc171b1e3","stage":"payment","correlationId":"payment-updated:d1c554a8e5a385264cb34857","attempts":1}
üí∞ Processing payment completion for customer: 6XW971FQS4D8Y01EHA23YGV3PW
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Kelly Stavish
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Kelly Stavish, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Kelly Stavish
   - Email: kellystavish@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: 6XW971FQS4D8Y01EHA23YGV3PW
{"ts":"2025-12-01T19:47:17.926Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"1403c1e1-7719-4961-86d1-736fc171b1e3","stage":"payment","correlationId":"payment-updated:d1c554a8e5a385264cb34857"}
{"ts":"2025-12-01T19:47:18.088Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"1be68cf8-9636-4b31-b937-37ed4afcf4b6","stage":"payment","correlationId":"payment-updated:0bc0fd253a74bf4a9048148e","attempts":1}
üí∞ Processing payment completion for customer: 6XW971FQS4D8Y01EHA23YGV3PW
   Payment source_type: CARD
   Payment tender_types: []
Customer 6XW971FQS4D8Y01EHA23YGV3PW already completed first payment
{"ts":"2025-12-01T19:47:18.221Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"1be68cf8-9636-4b31-b937-37ed4afcf4b6","stage":"payment","correlationId":"payment-updated:0bc0fd253a74bf4a9048148e"}
{"ts":"2025-12-01T19:47:18.380Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"2727c66d-446a-46e6-86ff-1386751f2dad","stage":"booking","correlationId":"booking-created:df55421bdd7850935791e916","attempts":1}
üìÖ Processing booking created for customer: 0DQFXWXCMHQVVXGT3RE57N41R0
Full booking data: {
  "id": "h4bbi8ixuzwba5",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-12T19:00:00Z",
  "created_at": "2025-12-01T19:43:28Z",
  "updated_at": "2025-12-01T19:43:28Z",
  "customer_id": "0DQFXWXCMHQVVXGT3RE57N41R0",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "0DQFXWXCMHQVVXGT3RE57N41R0",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMMCVDJoKh3ZkfFo",
      "any_team_member": true,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1764609601083,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Zoie Dilley
üéâ First booking detected for customer: 0DQFXWXCMHQVVXGT3RE57N41R0
   Name: Zoie Dilley
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 0DQFXWXCMHQVVXGT3RE57N41R0...
Error getting custom attributes for customer 0DQFXWXCMHQVVXGT3RE57N41R0: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 0DQFXWXCMHQVVXGT3RE57N41R0
{"ts":"2025-12-01T19:47:18.767Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"2727c66d-446a-46e6-86ff-1386751f2dad","stage":"booking","correlationId":"booking-created:df55421bdd7850935791e916"}
{"ts":"2025-12-01T19:47:18.932Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"b74107b2-8241-4613-b814-98c41aa78a5b","stage":"booking","correlationId":"booking-created:f018ac828953acd6d55e0e75","attempts":1}
üìÖ Processing booking created for customer: 6XW971FQS4D8Y01EHA23YGV3PW
Full booking data: {
  "id": "54yesaebj5p6pl",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-10T18:30:00Z",
  "created_at": "2025-12-01T19:44:54Z",
  "updated_at": "2025-12-01T19:44:54Z",
  "customer_id": "6XW971FQS4D8Y01EHA23YGV3PW",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMQPbDVvvOCLwqsy"
  },
  "appointment_segments": [
    {
      "team_member_id": "TM9jDlRr_Hl4rdBB",
      "any_team_member": false,
      "duration_minutes": 150,
      "intermission_minutes": 0,
      "service_variation_id": "4QI3JWGEYQANKCGC36J3MYNB",
      "service_variation_version": 1758654327496,
      "service_variation_client_id": "4QI3JWGEYQANKCGC36J3MYNB"
    },
    {
      "team_member_id": "TM9jDlRr_Hl4rdBB",
      "any_team_member": false,
      "duration_minutes": 20,
      "intermission_minutes": 0,
      "service_variation_id": "HAJX45W3U2WUCCXM5MI24UEE",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "HAJX45W3U2WUCCXM5MI24UEE"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Kelly Stavish
üéâ First booking detected for customer: 6XW971FQS4D8Y01EHA23YGV3PW
   Name: Kelly Stavish
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 6XW971FQS4D8Y01EHA23YGV3PW...
Error getting custom attributes for customer 6XW971FQS4D8Y01EHA23YGV3PW: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 6XW971FQS4D8Y01EHA23YGV3PW
{"ts":"2025-12-01T19:47:19.322Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"b74107b2-8241-4613-b814-98c41aa78a5b","stage":"booking","correlationId":"booking-created:f018ac828953acd6d55e0e75"}
{"ts":"2025-12-01T19:50:11.010Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Server has closed the connection.","stack":"PrismaClientKnownRequestError: Server has closed the connection.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`

Please make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.
{"ts":"2025-12-01T19:52:15.156Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-01T19:52:17.165Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-01T19:52:19.168Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-01T19:52:21.173Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-01T19:52:23.177Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-01T19:52:27.184Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-01T19:52:31.188Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-01T19:52:35.191Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-01T19:52:39.200Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-01T19:52:43.214Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-01T19:52:47.228Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-01T19:52:51.233Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-01T19:52:55.311Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-01T19:52:59.754Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-01T19:53:04.577Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-01T19:53:10.014Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-01T19:53:14.069Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-01T19:53:24.622Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Transaction not found. Transaction ID is invalid, refers to an old closed transaction Prisma doesn't have information about anymore, or was obtained before disconnecting.","stack":"PrismaClientKnownRequestError: Transaction API error: Transaction not found. Transaction ID is invalid, refers to an old closed transaction Prisma doesn't have information about anymore, or was obtained before disconnecting.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:8034)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-01T19:53:34.227Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Transaction already closed: A commit cannot be executed on an expired transaction. The timeout for this transaction was 5000 ms, however 7455 ms passed since the start of the transaction. Consider increasing the interactive transaction timeout or doing less work in the transaction.","stack":"PrismaClientKnownRequestError: Transaction API error: Transaction already closed: A commit cannot be executed on an expired transaction. The timeout for this transaction was 5000 ms, however 7455 ms passed since the start of the transaction. Consider increasing the interactive transaction timeout or doing less work in the transaction.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:8034)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-01T19:53:41.487Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"a1fa8685-4389-4ee1-b6b4-342498b52770","stage":"booking","correlationId":"booking-created:33a6d75afc2d587107d8a44b","attempts":1}
üìÖ Processing booking created for customer: 1D1FWPF6JNW0CWEWAY0T82GAXR
Full booking data: {
  "id": "o6x5i1w2ld2aa3",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-07T23:30:00Z",
  "created_at": "2025-12-01T19:53:30Z",
  "updated_at": "2025-12-01T19:53:30Z",
  "customer_id": "1D1FWPF6JNW0CWEWAY0T82GAXR",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMQPbDVvvOCLwqsy"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMNW4SIF7tjp4oM_",
      "any_team_member": false,
      "duration_minutes": 15,
      "intermission_minutes": 0,
      "service_variation_id": "KBHPHVKLJNAF223GMYIRUUH3",
      "service_variation_version": 1760895536505,
      "service_variation_client_id": "WOKQXBYCDVX6LQACJMHZTH2Q"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Alex Wade
üéâ First booking detected for customer: 1D1FWPF6JNW0CWEWAY0T82GAXR
   Name: Alex Wade
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 1D1FWPF6JNW0CWEWAY0T82GAXR...
Error getting custom attributes for customer 1D1FWPF6JNW0CWEWAY0T82GAXR: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 1D1FWPF6JNW0CWEWAY0T82GAXR
{"ts":"2025-12-01T19:53:44.110Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"a1fa8685-4389-4ee1-b6b4-342498b52770","stage":"booking","correlationId":"booking-created:33a6d75afc2d587107d8a44b"}
{"ts":"2025-12-01T19:55:16.971Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Transaction already closed: A commit cannot be executed on an expired transaction. The timeout for this transaction was 5000 ms, however 6764 ms passed since the start of the transaction. Consider increasing the interactive transaction timeout or doing less work in the transaction.","stack":"PrismaClientKnownRequestError: Transaction API error: Transaction already closed: A commit cannot be executed on an expired transaction. The timeout for this transaction was 5000 ms, however 6764 ms passed since the start of the transaction. Consider increasing the interactive transaction timeout or doing less work in the transaction.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:8034)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-01T20:00:40.895Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Server has closed the connection.","stack":"PrismaClientKnownRequestError: Server has closed the connection.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-01T20:02:55.215Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"48abac70-9c45-4cbe-9627-a7b47f7607fb","stage":"customer_ingest","correlationId":"customer-created:88641891c9efdb6a76435a9a","attempts":1}
üì• Received customer data: {
  "id": "86AGBRF7HSX1METR7ZKN0C5JPR",
  "version": 0,
  "created_at": "2025-12-01T20:02:50.218Z",
  "given_name": "Isabelle",
  "updated_at": "2025-12-01T20:02:50Z",
  "family_name": "Talebi",
  "preferences": {
    "email_unsubscribed": false
  },
  "phone_number": "+14152182392",
  "email_address": "intalebi@gmail.com",
  "creation_source": "THIRD_PARTY"
}
üë§ Processing customer creation: 86AGBRF7HSX1METR7ZKN0C5JPR
üìç IP Address: unknown
üìß Email: intalebi@gmail.com
üìû Phone: +14152182392
üë§ Name: Isabelle Talebi
‚ö†Ô∏è Suspicious IP activity detected: unknown used by 122 customers
‚ö†Ô∏è Suspicious activity detected for customer 86AGBRF7HSX1METR7ZKN0C5JPR, flagging for review
üéâ New customer detected: 86AGBRF7HSX1METR7ZKN0C5JPR
‚úÖ Customer added to database as NEW (temporary mark)
   - Will check for referral code when they book
   - Will give gift card on first booking if code found
‚úÖ Verification: Customer found in DB: true
{"ts":"2025-12-01T20:02:56.211Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"48abac70-9c45-4cbe-9627-a7b47f7607fb","stage":"customer_ingest","correlationId":"customer-created:88641891c9efdb6a76435a9a"}
{"ts":"2025-12-01T20:04:18.038Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"d735a31a-feba-4467-991a-970080b8192f","stage":"booking","correlationId":"booking-created:0444a1a80580525884160de2","attempts":1}
üìÖ Processing booking created for customer: 86AGBRF7HSX1METR7ZKN0C5JPR
Full booking data: {
  "id": "7uka5610aia3t1",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-01T21:30:00Z",
  "created_at": "2025-12-01T20:04:14Z",
  "updated_at": "2025-12-01T20:04:14Z",
  "customer_id": "86AGBRF7HSX1METR7ZKN0C5JPR",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMQPbDVvvOCLwqsy"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMNW4SIF7tjp4oM_",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "BRSIGZFOWC6F4ERPKX3CODLU",
      "service_variation_version": 1762893947284,
      "service_variation_client_id": "BRSIGZFOWC6F4ERPKX3CODLU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Isabelle Talebi
üéâ First booking detected for customer: 86AGBRF7HSX1METR7ZKN0C5JPR
   Name: Isabelle Talebi
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 86AGBRF7HSX1METR7ZKN0C5JPR...
Error getting custom attributes for customer 86AGBRF7HSX1METR7ZKN0C5JPR: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 86AGBRF7HSX1METR7ZKN0C5JPR
{"ts":"2025-12-01T20:04:20.662Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"d735a31a-feba-4467-991a-970080b8192f","stage":"booking","correlationId":"booking-created:0444a1a80580525884160de2"}
{"ts":"2025-12-01T20:11:12.225Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"be95d655-13eb-4545-8eb6-11535e42ee14","stage":"payment","correlationId":"payment-updated:aa5c8056b047b225b6d1d022","attempts":1}
üí∞ Processing payment completion for customer: YM0E7EM7XEM9RMCHKFH5BGCNQM
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Astrid Serrano
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Astrid Serrano, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Astrid Serrano
   - Email: abrizserrano9@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: YM0E7EM7XEM9RMCHKFH5BGCNQM
{"ts":"2025-12-01T20:11:13.118Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"be95d655-13eb-4545-8eb6-11535e42ee14","stage":"payment","correlationId":"payment-updated:aa5c8056b047b225b6d1d022"}
{"ts":"2025-12-01T20:11:20.078Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"4afc3a50-6471-4ac7-abf8-ccf91f283e41","stage":"payment","correlationId":"payment-updated:90808e0749398e753b98d244","attempts":1}
üí∞ Processing payment completion for customer: YM0E7EM7XEM9RMCHKFH5BGCNQM
   Payment source_type: CARD
   Payment tender_types: []
Customer YM0E7EM7XEM9RMCHKFH5BGCNQM already completed first payment
{"ts":"2025-12-01T20:11:21.107Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"4afc3a50-6471-4ac7-abf8-ccf91f283e41","stage":"payment","correlationId":"payment-updated:90808e0749398e753b98d244"}
{"ts":"2025-12-01T20:12:38.266Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"f2b5d9fa-330d-428b-8731-1dd6e5245503","stage":"booking","correlationId":"booking-created:64ff88ec1f50aa6a38d32c95","attempts":1}
üìÖ Processing booking created for customer: YM0E7EM7XEM9RMCHKFH5BGCNQM
Full booking data: {
  "id": "vfyq674srqfblq",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-26T18:00:00Z",
  "created_at": "2025-12-01T20:12:35Z",
  "updated_at": "2025-12-01T20:12:35Z",
  "customer_id": "YM0E7EM7XEM9RMCHKFH5BGCNQM",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMWAtQTYmZpwwxii"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMILsQUVwLkLzbVo",
      "any_team_member": false,
      "duration_minutes": 100,
      "intermission_minutes": 0,
      "service_variation_id": "BM556FTNFOTEHYVG4GPXAXFM",
      "service_variation_version": 1762893947284,
      "service_variation_client_id": "BM556FTNFOTEHYVG4GPXAXFM"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Astrid Serrano
üéâ First booking detected for customer: YM0E7EM7XEM9RMCHKFH5BGCNQM
   Name: Astrid Serrano
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer YM0E7EM7XEM9RMCHKFH5BGCNQM...
Error getting custom attributes for customer YM0E7EM7XEM9RMCHKFH5BGCNQM: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: YM0E7EM7XEM9RMCHKFH5BGCNQM
{"ts":"2025-12-01T20:12:40.275Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"f2b5d9fa-330d-428b-8731-1dd6e5245503","stage":"booking","correlationId":"booking-created:64ff88ec1f50aa6a38d32c95"}
{"ts":"2025-12-01T20:13:00.265Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"f56066f8-16de-41ad-bbfb-cb8601d7985d","stage":"booking","correlationId":"booking-created:a56b6ff54f3847c52334f163","attempts":1}
üìÖ Processing booking created for customer: AQJM14K5E90BB90WSPPYEMEN1R
Full booking data: {
  "id": "ut1nnh1154n4vd",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-02T22:50:00Z",
  "created_at": "2025-12-01T20:12:57Z",
  "updated_at": "2025-12-01T20:12:57Z",
  "customer_id": "AQJM14K5E90BB90WSPPYEMEN1R",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMQPbDVvvOCLwqsy"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMyUMvTJIj2HrHSg",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "JMTK5M2CY2W7WEXSTAJKAJ35",
      "service_variation_version": 1762893947284,
      "service_variation_client_id": "JMTK5M2CY2W7WEXSTAJKAJ35"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Anne Fung
üéâ First booking detected for customer: AQJM14K5E90BB90WSPPYEMEN1R
   Name: Anne Fung
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer AQJM14K5E90BB90WSPPYEMEN1R...
Error getting custom attributes for customer AQJM14K5E90BB90WSPPYEMEN1R: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: AQJM14K5E90BB90WSPPYEMEN1R
{"ts":"2025-12-01T20:13:00.957Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"f56066f8-16de-41ad-bbfb-cb8601d7985d","stage":"booking","correlationId":"booking-created:a56b6ff54f3847c52334f163"}
{"ts":"2025-12-01T20:24:22.790Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"58e82a7d-8975-4c07-ac3c-6838bf24ebf6","stage":"payment","correlationId":"payment-updated:d1fbed2524f76c16f2109750","attempts":1}
üí∞ Processing payment completion for customer: ATF01XQWM5VT6FTF4ESV0RC3CG
   Payment source_type: CARD
   Payment tender_types: []
Customer ATF01XQWM5VT6FTF4ESV0RC3CG already completed first payment
{"ts":"2025-12-01T20:24:23.425Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"58e82a7d-8975-4c07-ac3c-6838bf24ebf6","stage":"payment","correlationId":"payment-updated:d1fbed2524f76c16f2109750"}
{"ts":"2025-12-01T20:24:30.308Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"c079f0e3-e215-493b-a0b2-1849afbf2877","stage":"payment","correlationId":"payment-updated:0dac1aa9444c2022abb84a12","attempts":1}
üí∞ Processing payment completion for customer: ATF01XQWM5VT6FTF4ESV0RC3CG
   Payment source_type: CARD
   Payment tender_types: []
Customer ATF01XQWM5VT6FTF4ESV0RC3CG already completed first payment
{"ts":"2025-12-01T20:24:30.502Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"c079f0e3-e215-493b-a0b2-1849afbf2877","stage":"payment","correlationId":"payment-updated:0dac1aa9444c2022abb84a12"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Timed out fetching a new connection from the connection pool. More info: http://pris.ly/d/connection-pool (Current connection pool timeout: 10, connection limit: 21)
{"ts":"2025-12-01T21:49:14.144Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"4d0d7e8a-abd9-4f5d-842e-de0d960598f6","stage":"booking","correlationId":"booking-created:03c485148922ebd753d247fd","attempts":1}
üìÖ Processing booking created for customer: MKJ6QJ202C3737YYZRZ4FNPH4R
Full booking data: {
  "id": "ze4ow747uzmrq5",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-04T00:10:00Z",
  "created_at": "2025-12-01T20:30:38Z",
  "updated_at": "2025-12-01T20:30:38Z",
  "customer_id": "MKJ6QJ202C3737YYZRZ4FNPH4R",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "MKJ6QJ202C3737YYZRZ4FNPH4R",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMOscywuGXO2VURY",
      "any_team_member": true,
      "duration_minutes": 140,
      "intermission_minutes": 0,
      "service_variation_id": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "CJI5WHOAKSFTASYPJ4MSYZLS"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Rachel Yetso
üéâ First booking detected for customer: MKJ6QJ202C3737YYZRZ4FNPH4R
   Name: Rachel Yetso
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer MKJ6QJ202C3737YYZRZ4FNPH4R...
Error getting custom attributes for customer MKJ6QJ202C3737YYZRZ4FNPH4R: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: MKJ6QJ202C3737YYZRZ4FNPH4R
{"ts":"2025-12-01T21:49:15.907Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"4d0d7e8a-abd9-4f5d-842e-de0d960598f6","stage":"booking","correlationId":"booking-created:03c485148922ebd753d247fd"}
{"ts":"2025-12-01T21:49:16.076Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"52899ce2-1df9-4715-a3ed-766a09320f5f","stage":"payment","correlationId":"payment-updated:f59978df3808627140935b5b","attempts":1}
üí∞ Processing payment completion for customer: MHW8NBVV1AH9K5BRS42G02ZSJM
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Corine Antoun
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Corine Antoun, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Corine Antoun
   - Email: corine.an2n@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: MHW8NBVV1AH9K5BRS42G02ZSJM
{"ts":"2025-12-01T21:49:16.432Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"52899ce2-1df9-4715-a3ed-766a09320f5f","stage":"payment","correlationId":"payment-updated:f59978df3808627140935b5b"}
{"ts":"2025-12-01T21:49:16.592Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"e9075041-84b4-4d6d-ac72-7f3ebcbf5174","stage":"payment","correlationId":"payment-updated:da0026ceca94fe62f04f6c6f","attempts":1}
üí∞ Processing payment completion for customer: MHW8NBVV1AH9K5BRS42G02ZSJM
   Payment source_type: CARD
   Payment tender_types: []
Customer MHW8NBVV1AH9K5BRS42G02ZSJM already completed first payment
{"ts":"2025-12-01T21:49:16.737Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"e9075041-84b4-4d6d-ac72-7f3ebcbf5174","stage":"payment","correlationId":"payment-updated:da0026ceca94fe62f04f6c6f"}
{"ts":"2025-12-01T21:49:16.907Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"1fe7ac20-6eff-49eb-85de-259072241e5e","stage":"payment","correlationId":"payment-updated:170a6754d7fbe43bae3f36a7","attempts":1}
üí∞ Processing payment completion for customer: YD8453VHTDN5FR1F4GDW20HD3C
   Payment source_type: CASH
   Payment tender_types: []
üéâ First payment completed for customer: Ripsime Tadevosian
‚ùå Referrer not found for code: null
‚úÖ First payment processing completed for customer: YD8453VHTDN5FR1F4GDW20HD3C
{"ts":"2025-12-01T21:49:17.111Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"1fe7ac20-6eff-49eb-85de-259072241e5e","stage":"payment","correlationId":"payment-updated:170a6754d7fbe43bae3f36a7"}
{"ts":"2025-12-01T21:49:17.271Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"5bc5c449-d050-4d1b-89b0-399bf3ca446b","stage":"payment","correlationId":"payment-updated:e84bc4fbf48544caf3e03d5f","attempts":1}
üí∞ Processing payment completion for customer: XERB3P3EVSTPSZVRMX379F28R8
   Payment source_type: CARD
   Payment tender_types: []
Customer XERB3P3EVSTPSZVRMX379F28R8 already completed first payment
{"ts":"2025-12-01T21:49:17.407Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"5bc5c449-d050-4d1b-89b0-399bf3ca446b","stage":"payment","correlationId":"payment-updated:e84bc4fbf48544caf3e03d5f"}
{"ts":"2025-12-01T21:49:17.574Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"568f2785-7e30-4768-808e-4f0258540bec","stage":"payment","correlationId":"payment-updated:e5f508c28719ad622e7f0564","attempts":1}
üí∞ Processing payment completion for customer: XERB3P3EVSTPSZVRMX379F28R8
   Payment source_type: CARD
   Payment tender_types: []
Customer XERB3P3EVSTPSZVRMX379F28R8 already completed first payment
{"ts":"2025-12-01T21:49:17.717Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"568f2785-7e30-4768-808e-4f0258540bec","stage":"payment","correlationId":"payment-updated:e5f508c28719ad622e7f0564"}
{"ts":"2025-12-01T21:49:17.876Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"52b24213-0b6c-48de-a1b4-b79c25df12aa","stage":"booking","correlationId":"booking-created:850cc2253c1f9bb7089f5180","attempts":1}
üìÖ Processing booking created for customer: ZQ8EKNRB391S5EESGQ8D9G3Z90
Full booking data: {
  "id": "viclh786ahbext",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-16T22:50:00Z",
  "created_at": "2025-12-01T21:11:40Z",
  "updated_at": "2025-12-01T21:11:40Z",
  "customer_id": "ZQ8EKNRB391S5EESGQ8D9G3Z90",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "ZQ8EKNRB391S5EESGQ8D9G3Z90",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMILsQUVwLkLzbVo",
      "any_team_member": false,
      "duration_minutes": 100,
      "intermission_minutes": 0,
      "service_variation_id": "BM556FTNFOTEHYVG4GPXAXFM",
      "service_variation_version": 1764609577793,
      "service_variation_client_id": "BM556FTNFOTEHYVG4GPXAXFM"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Anastasiya Sakharava
‚ÑπÔ∏è Customer ZQ8EKNRB391S5EESGQ8D9G3Z90 already received signup bonus, not first booking
{"ts":"2025-12-01T21:49:18.023Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"52b24213-0b6c-48de-a1b4-b79c25df12aa","stage":"booking","correlationId":"booking-created:850cc2253c1f9bb7089f5180"}
{"ts":"2025-12-01T21:49:18.190Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"e379306e-4cf6-4f7f-b344-4b350d362a18","stage":"booking","correlationId":"booking-created:9c802e9572dd524eaab4a8d8","attempts":1}
üìÖ Processing booking created for customer: YTSZ1P7GT9D1YCB5D278253TDW
Full booking data: {
  "id": "gmk12c7wexbiw3",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-10T23:30:00Z",
  "created_at": "2025-12-01T21:22:02Z",
  "updated_at": "2025-12-01T21:22:02Z",
  "customer_id": "YTSZ1P7GT9D1YCB5D278253TDW",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "YTSZ1P7GT9D1YCB5D278253TDW",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMgsjtuk5cfKnstq",
      "any_team_member": false,
      "duration_minutes": 110,
      "intermission_minutes": 0,
      "service_variation_id": "6TYOE67IDYTKHW2ZG6HKVZER",
      "service_variation_version": 1764609577793,
      "service_variation_client_id": "6TYOE67IDYTKHW2ZG6HKVZER"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Kathrin Koz
‚ÑπÔ∏è Customer YTSZ1P7GT9D1YCB5D278253TDW already received signup bonus, not first booking
{"ts":"2025-12-01T21:49:18.324Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"e379306e-4cf6-4f7f-b344-4b350d362a18","stage":"booking","correlationId":"booking-created:9c802e9572dd524eaab4a8d8"}
{"ts":"2025-12-01T21:49:18.491Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"165d051b-0f17-4b33-bce9-6b2ae09f65cc","stage":"payment","correlationId":"payment-updated:9b9f84b0b8a5ab6f61cc07c0","attempts":1}
üí∞ Processing payment completion for customer: 9CE709PP621PNJZVYGJFRS119C
   Payment source_type: CASH
   Payment tender_types: []
üéâ First payment completed for customer: Jessica Jones
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Jessica Jones, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Jessica Jones
   - Email: jessicajones@pacbell.net
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: 9CE709PP621PNJZVYGJFRS119C
{"ts":"2025-12-01T21:49:18.804Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"165d051b-0f17-4b33-bce9-6b2ae09f65cc","stage":"payment","correlationId":"payment-updated:9b9f84b0b8a5ab6f61cc07c0"}
{"ts":"2025-12-01T21:49:18.967Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"60896628-d66d-4986-a041-4387e977f8ac","stage":"payment","correlationId":"payment-updated:5b36a6ad6b8b187b9e672db3","attempts":1}
üí∞ Processing payment completion for customer: N60CZP4T697J8CQ505T2FW07M4
   Payment source_type: CARD
   Payment tender_types: []
Customer N60CZP4T697J8CQ505T2FW07M4 already completed first payment
{"ts":"2025-12-01T21:49:19.104Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"60896628-d66d-4986-a041-4387e977f8ac","stage":"payment","correlationId":"payment-updated:5b36a6ad6b8b187b9e672db3"}
{"ts":"2025-12-01T21:49:19.265Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"fa3f8bf1-08c2-465a-9da0-2ed5f94d96c0","stage":"payment","correlationId":"payment-updated:cc4fb57fcf5586332cec8dee","attempts":1}
üí∞ Processing payment completion for customer: N60CZP4T697J8CQ505T2FW07M4
   Payment source_type: CARD
   Payment tender_types: []
Customer N60CZP4T697J8CQ505T2FW07M4 already completed first payment
{"ts":"2025-12-01T21:49:19.403Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"fa3f8bf1-08c2-465a-9da0-2ed5f94d96c0","stage":"payment","correlationId":"payment-updated:cc4fb57fcf5586332cec8dee"}
{"ts":"2025-12-01T21:49:19.564Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"5b94510a-4dc0-4fc9-83fa-e8d7e13512fb","stage":"booking","correlationId":"booking-created:13fadb5615c119d4490429be","attempts":1}
üìÖ Processing booking created for customer: N60CZP4T697J8CQ505T2FW07M4
Full booking data: {
  "id": "0dzpbuebc8l1wv",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-29T17:00:00Z",
  "created_at": "2025-12-01T21:26:09Z",
  "updated_at": "2025-12-01T21:26:09Z",
  "customer_id": "N60CZP4T697J8CQ505T2FW07M4",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMQPbDVvvOCLwqsy"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMNW4SIF7tjp4oM_",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "BRSIGZFOWC6F4ERPKX3CODLU",
      "service_variation_version": 1762893947284,
      "service_variation_client_id": "BRSIGZFOWC6F4ERPKX3CODLU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Kelly DeNigris
üéâ First booking detected for customer: N60CZP4T697J8CQ505T2FW07M4
   Name: Kelly DeNigris
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer N60CZP4T697J8CQ505T2FW07M4...
Error getting custom attributes for customer N60CZP4T697J8CQ505T2FW07M4: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: N60CZP4T697J8CQ505T2FW07M4
{"ts":"2025-12-01T21:49:19.942Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"5b94510a-4dc0-4fc9-83fa-e8d7e13512fb","stage":"booking","correlationId":"booking-created:13fadb5615c119d4490429be"}
{"ts":"2025-12-01T21:49:20.106Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"eb43193f-e89c-4ddf-b9ea-39209c8dd7e7","stage":"customer_ingest","correlationId":"customer-created:141d157207f880173c6f5119","attempts":1}
üì• Received customer data: {
  "id": "9RE9VEDM1ZGCX2H8WBF12F1F6R",
  "version": 0,
  "created_at": "2025-12-01T21:28:22.974Z",
  "given_name": "Neve",
  "updated_at": "2025-12-01T21:28:22Z",
  "preferences": {
    "email_unsubscribed": false
  },
  "phone_number": "+16283104269",
  "creation_source": "THIRD_PARTY"
}
üë§ Processing customer creation: 9RE9VEDM1ZGCX2H8WBF12F1F6R
üìç IP Address: unknown
Error retrieving Square customer 9RE9VEDM1ZGCX2H8WBF12F1F6R: Response status code was not ok: 401.
Square API errors: [
  {
    "category": "AUTHENTICATION_ERROR",
    "code": "UNAUTHORIZED",
    "detail": "This request could not be authorized."
  }
]
üìß Email: None
üìû Phone: +16283104269
üë§ Name: Neve 
‚ö†Ô∏è Suspicious IP activity detected: unknown used by 123 customers
‚ö†Ô∏è Suspicious activity detected for customer 9RE9VEDM1ZGCX2H8WBF12F1F6R, flagging for review
üéâ New customer detected: 9RE9VEDM1ZGCX2H8WBF12F1F6R
‚úÖ Customer added to database as NEW (temporary mark)
   - Will check for referral code when they book
   - Will give gift card on first booking if code found
‚úÖ Verification: Customer found in DB: true
{"ts":"2025-12-01T21:49:20.685Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"eb43193f-e89c-4ddf-b9ea-39209c8dd7e7","stage":"customer_ingest","correlationId":"customer-created:141d157207f880173c6f5119"}
{"ts":"2025-12-01T21:49:20.846Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"886647f1-34d5-438c-b578-4cf84cde12ec","stage":"booking","correlationId":"booking-created:5fd543760a5c3aab1c78b89d","attempts":1}
üìÖ Processing booking created for customer: B1SD31A26YCWNJT9V2B4HGJCB0
Full booking data: {
  "id": "7dgjw5bsqn308t",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-01T21:30:00Z",
  "created_at": "2025-12-01T21:30:14Z",
  "updated_at": "2025-12-01T21:30:14Z",
  "customer_id": "B1SD31A26YCWNJT9V2B4HGJCB0",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMQPbDVvvOCLwqsy"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMOscywuGXO2VURY",
      "any_team_member": false,
      "duration_minutes": 15,
      "intermission_minutes": 0,
      "service_variation_id": "KBHPHVKLJNAF223GMYIRUUH3",
      "service_variation_version": 1760895536505,
      "service_variation_client_id": "WOKQXBYCDVX6LQACJMHZTH2Q"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Emily Machado
üéâ First booking detected for customer: B1SD31A26YCWNJT9V2B4HGJCB0
   Name: Emily Machado
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer B1SD31A26YCWNJT9V2B4HGJCB0...
Error getting custom attributes for customer B1SD31A26YCWNJT9V2B4HGJCB0: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: B1SD31A26YCWNJT9V2B4HGJCB0
{"ts":"2025-12-01T21:49:21.265Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"886647f1-34d5-438c-b578-4cf84cde12ec","stage":"booking","correlationId":"booking-created:5fd543760a5c3aab1c78b89d"}
{"ts":"2025-12-01T21:49:21.428Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"7d48f344-2ab2-4bb6-9007-9e386770cc90","stage":"booking","correlationId":"booking-created:3fa535ec03a766225b0f7df7","attempts":1}
üìÖ Processing booking created for customer: VX4W3SJ6RTFDRQNK1TZJC1T19G
Full booking data: {
  "id": "6owunervnkke4x",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-02T00:10:00Z",
  "created_at": "2025-12-01T21:33:31Z",
  "updated_at": "2025-12-01T21:33:31Z",
  "customer_id": "VX4W3SJ6RTFDRQNK1TZJC1T19G",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "VX4W3SJ6RTFDRQNK1TZJC1T19G",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TM7_r-KmvY9xjnEU",
      "any_team_member": false,
      "duration_minutes": 110,
      "intermission_minutes": 0,
      "service_variation_id": "GJ5SRTYFV6ZCDI62TMSZP2OP",
      "service_variation_version": 1764609577793,
      "service_variation_client_id": "GJ5SRTYFV6ZCDI62TMSZP2OP"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Monica Everett
üéâ First booking detected for customer: VX4W3SJ6RTFDRQNK1TZJC1T19G
   Name: Monica Everett
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer VX4W3SJ6RTFDRQNK1TZJC1T19G...
Error getting custom attributes for customer VX4W3SJ6RTFDRQNK1TZJC1T19G: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: VX4W3SJ6RTFDRQNK1TZJC1T19G
{"ts":"2025-12-01T21:49:21.935Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"7d48f344-2ab2-4bb6-9007-9e386770cc90","stage":"booking","correlationId":"booking-created:3fa535ec03a766225b0f7df7"}
{"ts":"2025-12-01T21:49:22.095Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"14fa793a-ce1d-43cd-9eb2-3ef71dd80820","stage":"payment","correlationId":"payment-updated:f672214a490c79410c0c31b0","attempts":1}
üí∞ Processing payment completion for customer: BH012Y7N886M70PQ37P0V26EVM
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Francesca Misuraca
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Francesca Misuraca, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Francesca Misuraca
   - Email: francescamisuraca7@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: BH012Y7N886M70PQ37P0V26EVM
{"ts":"2025-12-01T21:49:22.392Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"14fa793a-ce1d-43cd-9eb2-3ef71dd80820","stage":"payment","correlationId":"payment-updated:f672214a490c79410c0c31b0"}
{"ts":"2025-12-01T21:49:22.553Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"617ae7ab-4838-48ad-b24c-8c5e19b13277","stage":"payment","correlationId":"payment-updated:9985b309fde4de627bef71d5","attempts":1}
üí∞ Processing payment completion for customer: BH012Y7N886M70PQ37P0V26EVM
   Payment source_type: CARD
   Payment tender_types: []
Customer BH012Y7N886M70PQ37P0V26EVM already completed first payment
{"ts":"2025-12-01T21:49:22.799Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"617ae7ab-4838-48ad-b24c-8c5e19b13277","stage":"payment","correlationId":"payment-updated:9985b309fde4de627bef71d5"}
{"ts":"2025-12-01T21:49:23.142Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"e963aaec-5cab-40b6-ba0f-d4bfb93ce468","stage":"payment","correlationId":"payment-updated:a106ff8c5ea6022e5f436484","attempts":1}
üí∞ Processing payment completion for customer: BH012Y7N886M70PQ37P0V26EVM
   Payment source_type: CARD
   Payment tender_types: []
Customer BH012Y7N886M70PQ37P0V26EVM already completed first payment
{"ts":"2025-12-01T21:49:23.316Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"e963aaec-5cab-40b6-ba0f-d4bfb93ce468","stage":"payment","correlationId":"payment-updated:a106ff8c5ea6022e5f436484"}
{"ts":"2025-12-01T21:49:23.489Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"5787d5ad-3067-4e1b-9490-d26150f242b2","stage":"payment","correlationId":"payment-updated:ac10a89896e5a0f56fa8d0c6","attempts":1}
üí∞ Processing payment completion for customer: BH012Y7N886M70PQ37P0V26EVM
   Payment source_type: CARD
   Payment tender_types: []
Customer BH012Y7N886M70PQ37P0V26EVM already completed first payment
{"ts":"2025-12-01T21:49:23.633Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"5787d5ad-3067-4e1b-9490-d26150f242b2","stage":"payment","correlationId":"payment-updated:ac10a89896e5a0f56fa8d0c6"}
{"ts":"2025-12-01T21:49:23.791Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"273b10d3-29d0-4833-bec7-f662d4774a09","stage":"booking","correlationId":"booking-created:0b90b6fd9ebf57bee83e1cb1","attempts":1}
üìÖ Processing booking created for customer: X5HB49K6S1PAKZBG22ABYMYH2R
Full booking data: {
  "id": "k03zucjz1oscoh",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-18T19:50:00Z",
  "created_at": "2025-12-01T21:36:19Z",
  "updated_at": "2025-12-01T21:36:19Z",
  "customer_id": "X5HB49K6S1PAKZBG22ABYMYH2R",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "X5HB49K6S1PAKZBG22ABYMYH2R",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMILsQUVwLkLzbVo",
      "any_team_member": false,
      "duration_minutes": 100,
      "intermission_minutes": 0,
      "service_variation_id": "BM556FTNFOTEHYVG4GPXAXFM",
      "service_variation_version": 1764609577793,
      "service_variation_client_id": "BM556FTNFOTEHYVG4GPXAXFM"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Makda Gebrezghi
üéâ First booking detected for customer: X5HB49K6S1PAKZBG22ABYMYH2R
   Name: Makda Gebrezghi
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer X5HB49K6S1PAKZBG22ABYMYH2R...
Error getting custom attributes for customer X5HB49K6S1PAKZBG22ABYMYH2R: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: X5HB49K6S1PAKZBG22ABYMYH2R
{"ts":"2025-12-01T21:49:24.189Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"273b10d3-29d0-4833-bec7-f662d4774a09","stage":"booking","correlationId":"booking-created:0b90b6fd9ebf57bee83e1cb1"}
{"ts":"2025-12-01T21:49:24.347Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"1efe9e63-ebe4-49f6-9133-cddeca6625c0","stage":"payment","correlationId":"payment-updated:8c8b5c2f6328dcf64c0893e8","attempts":1}
No customer ID in payment data, skipping...
Payment data received: {
  "id": "9SaG7GPHu7AS9vjwClOjXWgOlvHZY",
  "status": "COMPLETED",
  "version": 3,
  "order_id": "vlAfyCEEmTg5Rc4v18pxhGcZIe7YY",
  "tip_money": {
    "amount": 0,
    "currency": "USD"
  },
  "created_at": "2025-12-01T21:38:53.907Z",
  "updated_at": "2025-12-01T21:39:03.905Z",
  "employee_id": "TMQPbDVvvOCLwqsy",
  "location_id": "LT4ZHFBQQYB2N",
  "receipt_url": "https://squareup.com/receipt/preview/9SaG7GPHu7AS9vjwClOjXWgOlvHZY",
  "source_type": "CARD",
  "total_money": {
    "amount": 6000,
    "currency": "USD"
  },
  "amount_money": {
    "amount": 6000,
    "currency": "USD"
  },
  "card_details": {
    "card": {
      "bin": "778332",
      "last_4": "6570",
      "exp_year": 2099,
      "card_type": "DEBIT",
      "exp_month": 12,
      "card_brand": "SQUARE_GIFT_CARD",
      "fingerprint": "sq-1-Ya2dwk6L9aMmUaJpCn3GgPgizj61DC8JLg87NUfw0nyPLYQdJAp_qavy75JWuuxQbg",
      "prepaid_type": "PREPAID"
    },
    "status": "CAPTURED",
    "entry_method": "KEYED",
    "device_details": {
      "device_id": "DEVICE_INSTALLATION_ID:914537D2-2376-4915-9309-D8B7C04A3892",
      "device_name": "iPad",
      "device_installation_id": "914537D2-2376-4915-9309-D8B7C04A3892"
    },
    "auth_result_code": "0",
    "card_payment_timeline": {
      "captured_at": "2025-12-01T21:39:03.320Z",
      "authorized_at": "2025-12-01T21:38:53.992Z"
    }
  },
  "delay_action": "CANCEL",
  "delayed_until": "2025-12-01T22:48:53.907Z",
  "approved_money": {
    "amount": 6000,
    "currency": "USD"
  },
  "delay_duration": "PT70M",
  "device_details": {
    "device_id": "DEVICE_INSTALLATION_ID:914537D2-2376-4915-9309-D8B7C04A3892",
    "device_name": "iPad",
    "device_installation_id": "914537D2-2376-4915-9309-D8B7C04A3892"
  },
  "receipt_number": "9SaG",
  "team_member_id": "TMQPbDVvvOCLwqsy",
  "application_details": {
    "square_product": "SQUARE_POS"
  }
}
{"ts":"2025-12-01T21:49:24.413Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"1efe9e63-ebe4-49f6-9133-cddeca6625c0","stage":"payment","correlationId":"payment-updated:8c8b5c2f6328dcf64c0893e8"}
{"ts":"2025-12-01T21:49:24.570Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"36ba13d3-a69f-469e-b7a8-4cc3a90b3468","stage":"payment","correlationId":"payment-updated:a02068e7063ed6c906743265","attempts":1}
üí∞ Processing payment completion for customer: 9M72Y57P3VDWDHPYN8YGNRGB1R
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Leezae Russell
‚ùå Referrer not found for code: null
‚úÖ Generated new personal_code in name+ID format: LEEZAE7381
‚ùå Error creating/loading gift card for Leezae Russell: Response status code was not ok: 401.
Square API errors: [
  {
    "category": "AUTHENTICATION_ERROR",
    "code": "UNAUTHORIZED",
    "detail": "This request could not be authorized."
  }
]
‚ùå Failed to create referrer gift card
Error upserting custom attribute "square:a3dde506-f69e-48e4-a98a-004c1822d3ad" for customer 9M72Y57P3VDWDHPYN8YGNRGB1R: Response status code was not ok: 401.
Square API errors: [
  {
    "category": "AUTHENTICATION_ERROR",
    "code": "UNAUTHORIZED",
    "detail": "This request could not be authorized."
  }
]
Error appending referral note for customer 9M72Y57P3VDWDHPYN8YGNRGB1R: Response status code was not ok: 401.
Square API errors: [
  {
    "category": "AUTHENTICATION_ERROR",
    "code": "UNAUTHORIZED",
    "detail": "This request could not be authorized."
  }
]
‚ùå Error sending referral email to leezaerussell@gmail.com: Unauthorized
SendGrid error details: {
  errors: [
    {
      message: 'The provided authorization grant is invalid, expired, or revoked',
      field: null,
      help: null
    }
  ]
}
‚ö†Ô∏è Analytics operation "notification_event" failed: 
Invalid `prisma.notificationEvent.create()` invocation in
/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/analytics-service.js:164:39

  161 return runAnalyticsOperation(
  162   'notification_event',
  163   async () => {
‚Üí 164     return prisma.notificationEvent.create({
            data: {
              channel: "EMAIL",
              templateType: "REFERRAL_INVITE",
              status: "failed",
              createdAt: new Date("2025-12-01T21:49:26.565Z"),
              errorCode: 401,
                         ~~~
              errorMessage: "Unauthorized",
              metadata: {
                email: "leezaerussell@gmail.com",
                referralCode: "LEEZAE7381",
                referralUrl: "https://referral-system-salon-fbbq6x1wt-umis-projects-e802f152.vercel.app/ref/LEEZAE7381",
                suppressionGroupId: 28008
              }
            }
          })

Argument `errorCode`: Invalid value provided. Expected String or Null, provided Int.
‚ùå Failed to send email: Unauthorized
‚ÑπÔ∏è SMS sending disabled. Would send referral link to +15105041399
‚è∏Ô∏è SMS sending disabled (skipped sending to +15105041399)
üìß Referral code generated and sent:
   - Customer: Leezae Russell
   - Email: leezaerussell@gmail.com
   - Referral Code: LEEZAE7381
   - Referral URL: https://referral-system-salon-fbbq6x1wt-umis-projects-e802f152.vercel.app/ref/LEEZAE7381
   - Gift Card ID: null
   - Status: Customer is now a referrer
‚úÖ Referral code sent to new client:
   - Customer: Leezae Russell
   - Email: leezaerussell@gmail.com
   - Referral Code: LEEZAE7381
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: 9M72Y57P3VDWDHPYN8YGNRGB1R
{"ts":"2025-12-01T21:49:27.076Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"36ba13d3-a69f-469e-b7a8-4cc3a90b3468","stage":"payment","correlationId":"payment-updated:a02068e7063ed6c906743265"}
{"ts":"2025-12-01T21:49:27.241Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"9a8a8ccc-e177-47b8-bf1b-ed5a513d654f","stage":"payment","correlationId":"payment-updated:eddb5b8a83b3065b7df92394","attempts":1}
üí∞ Processing payment completion for customer: 9M72Y57P3VDWDHPYN8YGNRGB1R
   Payment source_type: CARD
   Payment tender_types: []
Customer 9M72Y57P3VDWDHPYN8YGNRGB1R already completed first payment
{"ts":"2025-12-01T21:49:27.387Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"9a8a8ccc-e177-47b8-bf1b-ed5a513d654f","stage":"payment","correlationId":"payment-updated:eddb5b8a83b3065b7df92394"}
{"ts":"2025-12-01T21:49:27.655Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"7a1b6a2b-4433-4c44-b0a7-24b915dd57ed","stage":"booking","correlationId":"booking-created:c69bb6a59926ad474af83a09","attempts":1}
üìÖ Processing booking created for customer: 9RE9VEDM1ZGCX2H8WBF12F1F6R
Full booking data: {
  "id": "zy8uqcbzlf70zd",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-09T18:30:00Z",
  "created_at": "2025-12-01T21:43:36Z",
  "updated_at": "2025-12-01T21:43:36Z",
  "customer_id": "9RE9VEDM1ZGCX2H8WBF12F1F6R",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMQPbDVvvOCLwqsy"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMyUMvTJIj2HrHSg",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "JMTK5M2CY2W7WEXSTAJKAJ35",
      "service_variation_version": 1762893947284,
      "service_variation_client_id": "JMTK5M2CY2W7WEXSTAJKAJ35"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Neve null
Error retrieving Square customer 9RE9VEDM1ZGCX2H8WBF12F1F6R: Response status code was not ok: 401.
Square API errors: [
  {
    "category": "AUTHENTICATION_ERROR",
    "code": "UNAUTHORIZED",
    "detail": "This request could not be authorized."
  }
]
üéâ First booking detected for customer: 9RE9VEDM1ZGCX2H8WBF12F1F6R
   Name: Neve null
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 9RE9VEDM1ZGCX2H8WBF12F1F6R...
Error getting custom attributes for customer 9RE9VEDM1ZGCX2H8WBF12F1F6R: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 9RE9VEDM1ZGCX2H8WBF12F1F6R
{"ts":"2025-12-01T21:49:28.327Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"7a1b6a2b-4433-4c44-b0a7-24b915dd57ed","stage":"booking","correlationId":"booking-created:c69bb6a59926ad474af83a09"}
{"ts":"2025-12-01T21:49:28.494Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"42361609-bcb6-4d4b-8cec-0f9f68af1200","stage":"payment","correlationId":"payment-updated:f7183eb696af17e4ba8447af","attempts":1}
üí∞ Processing payment completion for customer: BCDAEYDCS05SCKA1C291CKN3EW
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Hannah Bagby
‚ùå Referrer not found for code: null
‚úÖ First payment processing completed for customer: BCDAEYDCS05SCKA1C291CKN3EW
{"ts":"2025-12-01T21:49:28.744Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"42361609-bcb6-4d4b-8cec-0f9f68af1200","stage":"payment","correlationId":"payment-updated:f7183eb696af17e4ba8447af"}
{"ts":"2025-12-01T21:49:28.911Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"8ceb59a9-11e4-470f-9e93-7bdab69fe9a0","stage":"payment","correlationId":"payment-updated:8d689b9eae831e70929a0f47","attempts":1}
üí∞ Processing payment completion for customer: BCDAEYDCS05SCKA1C291CKN3EW
   Payment source_type: CARD
   Payment tender_types: []
Customer BCDAEYDCS05SCKA1C291CKN3EW already completed first payment
{"ts":"2025-12-01T21:49:29.049Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"8ceb59a9-11e4-470f-9e93-7bdab69fe9a0","stage":"payment","correlationId":"payment-updated:8d689b9eae831e70929a0f47"}
{"ts":"2025-12-01T21:49:29.242Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"9e8e9b1b-f853-45da-aea9-5b5fa16da95a","stage":"payment","correlationId":"payment-updated:205012bd041385836abd77ff","attempts":1}
üí∞ Processing payment completion for customer: W1DTVZ0MJ4PYHHPFDQ47VN3G8C
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Erin Page
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Erin Page, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Erin Page
   - Email: erin.page3@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: W1DTVZ0MJ4PYHHPFDQ47VN3G8C
{"ts":"2025-12-01T21:49:29.629Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"9e8e9b1b-f853-45da-aea9-5b5fa16da95a","stage":"payment","correlationId":"payment-updated:205012bd041385836abd77ff"}
{"ts":"2025-12-01T21:49:29.788Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"9be48d3e-a6d1-436f-b2e5-cfdb94b208e7","stage":"payment","correlationId":"payment-updated:485f1d73d73e927d01bc515c","attempts":1}
üí∞ Processing payment completion for customer: W1DTVZ0MJ4PYHHPFDQ47VN3G8C
   Payment source_type: CARD
   Payment tender_types: []
Customer W1DTVZ0MJ4PYHHPFDQ47VN3G8C already completed first payment
{"ts":"2025-12-01T21:49:29.921Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"9be48d3e-a6d1-436f-b2e5-cfdb94b208e7","stage":"payment","correlationId":"payment-updated:485f1d73d73e927d01bc515c"}
{"ts":"2025-12-01T21:49:46.023Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"a426a57a-c955-4915-bf5e-ac7f39003503","stage":"payment","correlationId":"payment-updated:f1cd4aff1751e077f8c48ca9","attempts":1}
üí∞ Processing payment completion for customer: CHZWA7K9N6HB9NZAG5CB1A2A08
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Mariko Dennis
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Mariko Dennis, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Mariko Dennis
   - Email: mariko1997@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: CHZWA7K9N6HB9NZAG5CB1A2A08
{"ts":"2025-12-01T21:49:46.459Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"a426a57a-c955-4915-bf5e-ac7f39003503","stage":"payment","correlationId":"payment-updated:f1cd4aff1751e077f8c48ca9"}
{"ts":"2025-12-01T21:49:52.995Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"bebc437b-b990-4eed-a63e-15c8724d5139","stage":"payment","correlationId":"payment-updated:45d66bb5ca5bf842a3264853","attempts":1}
üí∞ Processing payment completion for customer: CHZWA7K9N6HB9NZAG5CB1A2A08
   Payment source_type: CARD
   Payment tender_types: []
Customer CHZWA7K9N6HB9NZAG5CB1A2A08 already completed first payment
{"ts":"2025-12-01T21:49:53.136Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"bebc437b-b990-4eed-a63e-15c8724d5139","stage":"payment","correlationId":"payment-updated:45d66bb5ca5bf842a3264853"}
{"ts":"2025-12-01T21:56:22.742Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"6488e229-b0e8-4463-966f-c2f8b09bfa54","stage":"payment","correlationId":"payment-updated:6a50024cec84fa994edecd59","attempts":1}
üí∞ Processing payment completion for customer: B1SD31A26YCWNJT9V2B4HGJCB0
   Payment source_type: CARD
   Payment tender_types: []
Customer B1SD31A26YCWNJT9V2B4HGJCB0 already completed first payment
{"ts":"2025-12-01T21:56:23.125Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"6488e229-b0e8-4463-966f-c2f8b09bfa54","stage":"payment","correlationId":"payment-updated:6a50024cec84fa994edecd59"}
{"ts":"2025-12-01T21:56:27.531Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"eb835d9f-5930-4c78-aee9-cd0e27b6a204","stage":"payment","correlationId":"payment-updated:895eae5ce724a5fa0f5c24cf","attempts":1}
üí∞ Processing payment completion for customer: B1SD31A26YCWNJT9V2B4HGJCB0
   Payment source_type: CARD
   Payment tender_types: []
Customer B1SD31A26YCWNJT9V2B4HGJCB0 already completed first payment
{"ts":"2025-12-01T21:56:27.684Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"eb835d9f-5930-4c78-aee9-cd0e27b6a204","stage":"payment","correlationId":"payment-updated:895eae5ce724a5fa0f5c24cf"}
{"ts":"2025-12-01T21:56:44.890Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"41588078-87c9-468a-98c0-9a1995cb5c71","stage":"booking","correlationId":"booking-created:fd4c6ec27c5bb3592c2dfb1b","attempts":1}
üìÖ Processing booking created for customer: B0GJFR8WR9H20EN067QT7RVMHM
Full booking data: {
  "id": "jumx3x8bvdsrjb",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-04T23:00:00Z",
  "created_at": "2025-12-01T21:56:42Z",
  "updated_at": "2025-12-01T21:56:42Z",
  "customer_id": "B0GJFR8WR9H20EN067QT7RVMHM",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "B0GJFR8WR9H20EN067QT7RVMHM",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TM9jDlRr_Hl4rdBB",
      "any_team_member": false,
      "duration_minutes": 20,
      "intermission_minutes": 0,
      "service_variation_id": "HAJX45W3U2WUCCXM5MI24UEE",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "HAJX45W3U2WUCCXM5MI24UEE"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Anne Murdoch
üéâ First booking detected for customer: B0GJFR8WR9H20EN067QT7RVMHM
   Name: Anne Murdoch
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer B0GJFR8WR9H20EN067QT7RVMHM...
Error getting custom attributes for customer B0GJFR8WR9H20EN067QT7RVMHM: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: B0GJFR8WR9H20EN067QT7RVMHM
{"ts":"2025-12-01T21:56:45.456Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"41588078-87c9-468a-98c0-9a1995cb5c71","stage":"booking","correlationId":"booking-created:fd4c6ec27c5bb3592c2dfb1b"}
{"ts":"2025-12-01T22:10:10.952Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"e0a8ef38-dc57-4d86-a086-4ab2fc097175","stage":"customer_ingest","correlationId":"customer-created:679c6d51fa8a386a43737b9f","attempts":1}
üì• Received customer data: {
  "id": "ZF5Z9M6KY4064HBJBVTDSNEM44",
  "version": 0,
  "created_at": "2025-12-01T22:10:07.954Z",
  "given_name": "Marisa",
  "updated_at": "2025-12-01T22:10:07Z",
  "family_name": "LaVallee",
  "preferences": {
    "email_unsubscribed": false
  },
  "phone_number": "+13369721095",
  "email_address": "marisa.lavallee2@gmail.com",
  "creation_source": "THIRD_PARTY"
}
üë§ Processing customer creation: ZF5Z9M6KY4064HBJBVTDSNEM44
üìç IP Address: unknown
üìß Email: marisa.lavallee2@gmail.com
üìû Phone: +13369721095
üë§ Name: Marisa LaVallee
‚ö†Ô∏è Suspicious IP activity detected: unknown used by 124 customers
‚ö†Ô∏è Suspicious activity detected for customer ZF5Z9M6KY4064HBJBVTDSNEM44, flagging for review
üéâ New customer detected: ZF5Z9M6KY4064HBJBVTDSNEM44
‚úÖ Customer added to database as NEW (temporary mark)
   - Will check for referral code when they book
   - Will give gift card on first booking if code found
‚úÖ Verification: Customer found in DB: true
{"ts":"2025-12-01T22:10:11.477Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"e0a8ef38-dc57-4d86-a086-4ab2fc097175","stage":"customer_ingest","correlationId":"customer-created:679c6d51fa8a386a43737b9f"}
{"ts":"2025-12-01T22:11:15.604Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"ad89331e-afb5-4c73-8ea4-da2eeb9f28a6","stage":"booking","correlationId":"booking-created:a27191609fa2eb841f201069","attempts":1}
üìÖ Processing booking created for customer: ZF5Z9M6KY4064HBJBVTDSNEM44
Full booking data: {
  "id": "4e1gsez91mymp8",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-01T23:00:00Z",
  "created_at": "2025-12-01T22:11:14Z",
  "updated_at": "2025-12-01T22:11:14Z",
  "customer_id": "ZF5Z9M6KY4064HBJBVTDSNEM44",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMQPbDVvvOCLwqsy"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMyUMvTJIj2HrHSg",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "JMTK5M2CY2W7WEXSTAJKAJ35",
      "service_variation_version": 1762893947284,
      "service_variation_client_id": "JMTK5M2CY2W7WEXSTAJKAJ35"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Marisa LaVallee
üéâ First booking detected for customer: ZF5Z9M6KY4064HBJBVTDSNEM44
   Name: Marisa LaVallee
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer ZF5Z9M6KY4064HBJBVTDSNEM44...
Error getting custom attributes for customer ZF5Z9M6KY4064HBJBVTDSNEM44: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: ZF5Z9M6KY4064HBJBVTDSNEM44
{"ts":"2025-12-01T22:11:16.208Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"ad89331e-afb5-4c73-8ea4-da2eeb9f28a6","stage":"booking","correlationId":"booking-created:a27191609fa2eb841f201069"}
{"ts":"2025-12-01T22:11:24.871Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"df6b59cb-1cba-4baf-8c59-20699438bb72","stage":"booking","correlationId":"booking-created:03ccb207cd296afe4d18fb6a","attempts":1}
üìÖ Processing booking created for customer: B0GJFR8WR9H20EN067QT7RVMHM
Full booking data: {
  "id": "e5hvh2ev1kg6au",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-04T20:40:00Z",
  "created_at": "2025-12-01T22:11:22Z",
  "updated_at": "2025-12-01T22:11:22Z",
  "customer_id": "B0GJFR8WR9H20EN067QT7RVMHM",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "B0GJFR8WR9H20EN067QT7RVMHM",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TM9jDlRr_Hl4rdBB",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "XBUDIMNKOPC2XVG5YLIQ4RYS",
      "service_variation_version": 1764609577793,
      "service_variation_client_id": "XBUDIMNKOPC2XVG5YLIQ4RYS"
    },
    {
      "team_member_id": "TM9jDlRr_Hl4rdBB",
      "any_team_member": false,
      "duration_minutes": 20,
      "intermission_minutes": 0,
      "service_variation_id": "HAJX45W3U2WUCCXM5MI24UEE",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "HAJX45W3U2WUCCXM5MI24UEE"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Anne Murdoch
üéâ First booking detected for customer: B0GJFR8WR9H20EN067QT7RVMHM
   Name: Anne Murdoch
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer B0GJFR8WR9H20EN067QT7RVMHM...
Error getting custom attributes for customer B0GJFR8WR9H20EN067QT7RVMHM: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: B0GJFR8WR9H20EN067QT7RVMHM
{"ts":"2025-12-01T22:11:25.271Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"df6b59cb-1cba-4baf-8c59-20699438bb72","stage":"booking","correlationId":"booking-created:03ccb207cd296afe4d18fb6a"}
{"ts":"2025-12-01T22:13:22.743Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"62723a14-0ff5-4220-905b-a21860ef8cf4","stage":"booking","correlationId":"booking-created:c32fea4a55db3aff1951e9ae","attempts":1}
üìÖ Processing booking created for customer: K54SN5QMHBJRR7D4B2K0716V24
Full booking data: {
  "id": "hs1dacbv1l4t2i",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-03T18:30:00Z",
  "created_at": "2025-12-01T22:13:19Z",
  "updated_at": "2025-12-01T22:13:19Z",
  "customer_id": "K54SN5QMHBJRR7D4B2K0716V24",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "K54SN5QMHBJRR7D4B2K0716V24",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMyUMvTJIj2HrHSg",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "JMTK5M2CY2W7WEXSTAJKAJ35",
      "service_variation_version": 1764609577793,
      "service_variation_client_id": "JMTK5M2CY2W7WEXSTAJKAJ35"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Meredith Bergman
üéâ First booking detected for customer: K54SN5QMHBJRR7D4B2K0716V24
   Name: Meredith Bergman
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer K54SN5QMHBJRR7D4B2K0716V24...
Error getting custom attributes for customer K54SN5QMHBJRR7D4B2K0716V24: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: K54SN5QMHBJRR7D4B2K0716V24
{"ts":"2025-12-01T22:13:23.300Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"62723a14-0ff5-4220-905b-a21860ef8cf4","stage":"booking","correlationId":"booking-created:c32fea4a55db3aff1951e9ae"}
{"ts":"2025-12-01T22:36:07.963Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"1fec9429-6d49-4c01-a0a9-b7139103729a","stage":"booking","correlationId":"booking-created:01fa2e48b9714deba9e70064","attempts":1}
üìÖ Processing booking created for customer: XEVNS8V0M24A1PZ5Y6JS6W6JY8
Full booking data: {
  "id": "692w11r6trkigw",
  "source": "THIRD_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-19T22:00:00Z",
  "created_at": "2025-12-01T22:36:04Z",
  "updated_at": "2025-12-01T22:36:04Z",
  "customer_id": "XEVNS8V0M24A1PZ5Y6JS6W6JY8",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "XEVNS8V0M24A1PZ5Y6JS6W6JY8",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TM-zXe9fXe4axYWn",
      "any_team_member": true,
      "duration_minutes": 140,
      "intermission_minutes": 0,
      "service_variation_id": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "CJI5WHOAKSFTASYPJ4MSYZLS"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Lisha Li
üéâ First booking detected for customer: XEVNS8V0M24A1PZ5Y6JS6W6JY8
   Name: Lisha Li
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer XEVNS8V0M24A1PZ5Y6JS6W6JY8...
Error getting custom attributes for customer XEVNS8V0M24A1PZ5Y6JS6W6JY8: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: XEVNS8V0M24A1PZ5Y6JS6W6JY8
{"ts":"2025-12-01T22:36:08.671Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"1fec9429-6d49-4c01-a0a9-b7139103729a","stage":"booking","correlationId":"booking-created:01fa2e48b9714deba9e70064"}
{"ts":"2025-12-01T22:39:01.618Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"96cb502a-0f8d-4e6c-a5c8-d716553356a1","stage":"payment","correlationId":"payment-updated:2d1af2ee3e319c64240cf8f4","attempts":1}
üí∞ Processing payment completion for customer: 1CS3MY35Y6G59MFHGY5V7W5C88
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Kristen Juntunen
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Kristen Juntunen, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Kristen Juntunen
   - Email: kristenjuntunen@yahoo.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: 1CS3MY35Y6G59MFHGY5V7W5C88
{"ts":"2025-12-01T22:39:02.082Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"96cb502a-0f8d-4e6c-a5c8-d716553356a1","stage":"payment","correlationId":"payment-updated:2d1af2ee3e319c64240cf8f4"}
{"ts":"2025-12-01T22:39:08.620Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"86b990c4-2281-46d5-86de-ce59ad1222eb","stage":"payment","correlationId":"payment-updated:e7fc4beeeac6f2218a42ce85","attempts":1}
üí∞ Processing payment completion for customer: 1CS3MY35Y6G59MFHGY5V7W5C88
   Payment source_type: CARD
   Payment tender_types: []
Customer 1CS3MY35Y6G59MFHGY5V7W5C88 already completed first payment
{"ts":"2025-12-01T22:39:08.753Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"86b990c4-2281-46d5-86de-ce59ad1222eb","stage":"payment","correlationId":"payment-updated:e7fc4beeeac6f2218a42ce85"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`

Please make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.
{"ts":"2025-12-01T22:50:52.336Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-01T22:50:55.386Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"82e286f3-9638-4091-83a8-50f1e752312b","stage":"payment","correlationId":"payment-updated:7709cda2b4915c516c65b7c5","attempts":1}
üí∞ Processing payment completion for customer: RZHSEFFD8PVJ11762PDMZNC8XM
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Kacy Dorrity
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Kacy Dorrity, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Kacy Dorrity
   - Email: kcmacintyre@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: RZHSEFFD8PVJ11762PDMZNC8XM
{"ts":"2025-12-01T22:50:56.624Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"82e286f3-9638-4091-83a8-50f1e752312b","stage":"payment","correlationId":"payment-updated:7709cda2b4915c516c65b7c5"}
{"ts":"2025-12-01T22:50:56.787Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"3f4fda11-b3db-4dc4-b1d9-58fffbde01d4","stage":"payment","correlationId":"payment-updated:8e9758f47456f9be360eff2a","attempts":1}
üí∞ Processing payment completion for customer: RZHSEFFD8PVJ11762PDMZNC8XM
   Payment source_type: CARD
   Payment tender_types: []
Customer RZHSEFFD8PVJ11762PDMZNC8XM already completed first payment
{"ts":"2025-12-01T22:50:57.014Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"3f4fda11-b3db-4dc4-b1d9-58fffbde01d4","stage":"payment","correlationId":"payment-updated:8e9758f47456f9be360eff2a"}
{"ts":"2025-12-01T22:50:57.275Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"5aeeabde-b5fe-4d61-bd10-e108a3b5ecde","stage":"payment","correlationId":"payment-updated:dd5ba5a508edf59d43e24a96","attempts":1}
üí∞ Processing payment completion for customer: R18V9R5A676DS04TX1VFEM7PKW
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Jael Berger
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Jael Berger, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Jael Berger
   - Email: jael.berger8@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: R18V9R5A676DS04TX1VFEM7PKW
{"ts":"2025-12-01T22:50:57.761Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"5aeeabde-b5fe-4d61-bd10-e108a3b5ecde","stage":"payment","correlationId":"payment-updated:dd5ba5a508edf59d43e24a96"}
{"ts":"2025-12-01T22:50:58.000Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"8264dcd9-c273-44ae-b50d-a281b0d9cb53","stage":"payment","correlationId":"payment-updated:abf0464b023a657b000f6e44","attempts":1}
üí∞ Processing payment completion for customer: R18V9R5A676DS04TX1VFEM7PKW
   Payment source_type: CARD
   Payment tender_types: []
Customer R18V9R5A676DS04TX1VFEM7PKW already completed first payment
{"ts":"2025-12-01T22:50:58.262Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"8264dcd9-c273-44ae-b50d-a281b0d9cb53","stage":"payment","correlationId":"payment-updated:abf0464b023a657b000f6e44"}
{"ts":"2025-12-01T22:50:58.520Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"7c98de52-2b5a-4978-add4-45dd982f2ef8","stage":"booking","correlationId":"booking-created:aee29389a7228ed66ae369ac","attempts":1}
üìÖ Processing booking created for customer: 2TCXHRN3KH62HF1CSA2NKPGA1M
Full booking data: {
  "id": "r0pkfh3n8rw7r6",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-15T19:20:00Z",
  "created_at": "2025-12-01T22:49:47Z",
  "updated_at": "2025-12-01T22:49:47Z",
  "customer_id": "2TCXHRN3KH62HF1CSA2NKPGA1M",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMQPbDVvvOCLwqsy"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMOscywuGXO2VURY",
      "any_team_member": false,
      "duration_minutes": 140,
      "intermission_minutes": 0,
      "service_variation_id": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "CJI5WHOAKSFTASYPJ4MSYZLS"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Stacy Barnes
üéâ First booking detected for customer: 2TCXHRN3KH62HF1CSA2NKPGA1M
   Name: Stacy Barnes
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 2TCXHRN3KH62HF1CSA2NKPGA1M...
Error getting custom attributes for customer 2TCXHRN3KH62HF1CSA2NKPGA1M: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 2TCXHRN3KH62HF1CSA2NKPGA1M
{"ts":"2025-12-01T22:50:59.085Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"7c98de52-2b5a-4978-add4-45dd982f2ef8","stage":"booking","correlationId":"booking-created:aee29389a7228ed66ae369ac"}
{"ts":"2025-12-01T22:50:59.345Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"cd9970b9-89cc-4139-95f8-ce1898d1e079","stage":"payment","correlationId":"payment-updated:3ed5060d88c236958ff3a691","attempts":1}
üí∞ Processing payment completion for customer: A820AC65FDKQ3NGCTH9ZRS08VM
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Jessica Jackson
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Jessica Jackson, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Jessica Jackson
   - Email: jessicajackson125@yahoo.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: A820AC65FDKQ3NGCTH9ZRS08VM
{"ts":"2025-12-01T22:50:59.827Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"cd9970b9-89cc-4139-95f8-ce1898d1e079","stage":"payment","correlationId":"payment-updated:3ed5060d88c236958ff3a691"}
{"ts":"2025-12-01T22:51:00.060Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"3409135f-78be-492f-8a0d-7d96eb3d9cf6","stage":"payment","correlationId":"payment-updated:ff2bd6dd7c655ea98410641e","attempts":1}
üí∞ Processing payment completion for customer: A820AC65FDKQ3NGCTH9ZRS08VM
   Payment source_type: CARD
   Payment tender_types: []
Customer A820AC65FDKQ3NGCTH9ZRS08VM already completed first payment
{"ts":"2025-12-01T22:51:00.257Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"3409135f-78be-492f-8a0d-7d96eb3d9cf6","stage":"payment","correlationId":"payment-updated:ff2bd6dd7c655ea98410641e"}
{"ts":"2025-12-01T22:51:00.423Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"f9a92978-c412-45c3-be65-9ce1f1ec8aa4","stage":"payment","correlationId":"payment-updated:7ce3ab86a5c9ed3699ab64db","attempts":1}
üí∞ Processing payment completion for customer: YTBM2Q2XV23WW25KR2W25CF934
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: jacqueline baumann
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to jacqueline baumann, skipping...
‚úÖ Referral code sent to new client:
   - Customer: jacqueline baumann
   - Email: Jbaumann1958@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: YTBM2Q2XV23WW25KR2W25CF934
{"ts":"2025-12-01T22:51:00.850Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"f9a92978-c412-45c3-be65-9ce1f1ec8aa4","stage":"payment","correlationId":"payment-updated:7ce3ab86a5c9ed3699ab64db"}
{"ts":"2025-12-01T22:51:01.014Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"eba1078e-5704-4157-a01d-9e18ccae6f85","stage":"payment","correlationId":"payment-updated:b3da432fbec3bae1034c65cf","attempts":1}
üí∞ Processing payment completion for customer: YTBM2Q2XV23WW25KR2W25CF934
   Payment source_type: CARD
   Payment tender_types: []
Customer YTBM2Q2XV23WW25KR2W25CF934 already completed first payment
{"ts":"2025-12-01T22:51:01.205Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"eba1078e-5704-4157-a01d-9e18ccae6f85","stage":"payment","correlationId":"payment-updated:b3da432fbec3bae1034c65cf"}
{"ts":"2025-12-01T22:51:25.302Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"386d00eb-16b7-4ca9-a06f-a9690c14a107","stage":"booking","correlationId":"booking-created:47dd565ede43e611b36904e2","attempts":1}
üìÖ Processing booking created for customer: YTBM2Q2XV23WW25KR2W25CF934
Full booking data: {
  "id": "524sc6325wji2c",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-29T23:00:00Z",
  "created_at": "2025-12-01T22:51:23Z",
  "updated_at": "2025-12-01T22:51:23Z",
  "customer_id": "YTBM2Q2XV23WW25KR2W25CF934",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMQPbDVvvOCLwqsy"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMMHlgFBIFbMTRap",
      "any_team_member": false,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1764609601083,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: jacqueline baumann
üéâ First booking detected for customer: YTBM2Q2XV23WW25KR2W25CF934
   Name: jacqueline baumann
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer YTBM2Q2XV23WW25KR2W25CF934...
Error getting custom attributes for customer YTBM2Q2XV23WW25KR2W25CF934: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: YTBM2Q2XV23WW25KR2W25CF934
{"ts":"2025-12-01T22:51:25.840Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"386d00eb-16b7-4ca9-a06f-a9690c14a107","stage":"booking","correlationId":"booking-created:47dd565ede43e611b36904e2"}
{"ts":"2025-12-01T22:53:06.563Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"763794a6-accd-4c49-8b91-5d4755ba5d8c","stage":"booking","correlationId":"booking-created:1211e33e62f20772acb4e178","attempts":1}
üìÖ Processing booking created for customer: JQP08CGVH90BF2J18P4E5EHAM4
Full booking data: {
  "id": "lrwmflkcu5ipff",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-16T01:00:00Z",
  "created_at": "2025-12-01T22:53:04Z",
  "updated_at": "2025-12-01T22:53:04Z",
  "customer_id": "JQP08CGVH90BF2J18P4E5EHAM4",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "JQP08CGVH90BF2J18P4E5EHAM4",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMoZGdZlg-iKWTDu",
      "any_team_member": false,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1764609601083,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Rachel Flores
üéâ First booking detected for customer: JQP08CGVH90BF2J18P4E5EHAM4
   Name: Rachel Flores
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer JQP08CGVH90BF2J18P4E5EHAM4...
Error getting custom attributes for customer JQP08CGVH90BF2J18P4E5EHAM4: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: JQP08CGVH90BF2J18P4E5EHAM4
{"ts":"2025-12-01T22:53:07.221Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"763794a6-accd-4c49-8b91-5d4755ba5d8c","stage":"booking","correlationId":"booking-created:1211e33e62f20772acb4e178"}
{"ts":"2025-12-01T22:59:57.940Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"f673fda9-9cdd-4eb5-b958-0a2bcc938b1d","stage":"payment","correlationId":"payment-updated:fc886dca96d41dc59fb12602","attempts":1}
üí∞ Processing payment completion for customer: 86AGBRF7HSX1METR7ZKN0C5JPR
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Isabelle Talebi
‚ùå Referrer not found for code: null
‚úÖ Generated new personal_code in name+ID format: ISABELLE1705
‚ùå Error creating/loading gift card for Isabelle Talebi: Response status code was not ok: 401.
Square API errors: [
  {
    "category": "AUTHENTICATION_ERROR",
    "code": "UNAUTHORIZED",
    "detail": "This request could not be authorized."
  }
]
‚ùå Failed to create referrer gift card
Error upserting custom attribute "square:a3dde506-f69e-48e4-a98a-004c1822d3ad" for customer 86AGBRF7HSX1METR7ZKN0C5JPR: Response status code was not ok: 401.
Square API errors: [
  {
    "category": "AUTHENTICATION_ERROR",
    "code": "UNAUTHORIZED",
    "detail": "This request could not be authorized."
  }
]
Error appending referral note for customer 86AGBRF7HSX1METR7ZKN0C5JPR: Response status code was not ok: 401.
Square API errors: [
  {
    "category": "AUTHENTICATION_ERROR",
    "code": "UNAUTHORIZED",
    "detail": "This request could not be authorized."
  }
]
‚ùå Error sending referral email to intalebi@gmail.com: Unauthorized
SendGrid error details: {
  errors: [
    {
      message: 'The provided authorization grant is invalid, expired, or revoked',
      field: null,
      help: null
    }
  ]
}
‚ö†Ô∏è Analytics operation "notification_event" failed: 
Invalid `prisma.notificationEvent.create()` invocation in
/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/analytics-service.js:164:39

  161 return runAnalyticsOperation(
  162   'notification_event',
  163   async () => {
‚Üí 164     return prisma.notificationEvent.create({
            data: {
              channel: "EMAIL",
              templateType: "REFERRAL_INVITE",
              status: "failed",
              createdAt: new Date("2025-12-01T22:59:59.592Z"),
              errorCode: 401,
                         ~~~
              errorMessage: "Unauthorized",
              metadata: {
                email: "intalebi@gmail.com",
                referralCode: "ISABELLE1705",
                referralUrl: "https://referral-system-salon-fbbq6x1wt-umis-projects-e802f152.vercel.app/ref/ISABELLE1705",
                suppressionGroupId: 28008
              }
            }
          })

Argument `errorCode`: Invalid value provided. Expected String or Null, provided Int.
‚ùå Failed to send email: Unauthorized
‚ÑπÔ∏è SMS sending disabled. Would send referral link to +14152182392
‚è∏Ô∏è SMS sending disabled (skipped sending to +14152182392)
üìß Referral code generated and sent:
   - Customer: Isabelle Talebi
   - Email: intalebi@gmail.com
   - Referral Code: ISABELLE1705
   - Referral URL: https://referral-system-salon-fbbq6x1wt-umis-projects-e802f152.vercel.app/ref/ISABELLE1705
   - Gift Card ID: null
   - Status: Customer is now a referrer
‚úÖ Referral code sent to new client:
   - Customer: Isabelle Talebi
   - Email: intalebi@gmail.com
   - Referral Code: ISABELLE1705
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: 86AGBRF7HSX1METR7ZKN0C5JPR
{"ts":"2025-12-01T22:59:59.847Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"f673fda9-9cdd-4eb5-b958-0a2bcc938b1d","stage":"payment","correlationId":"payment-updated:fc886dca96d41dc59fb12602"}
{"ts":"2025-12-01T23:00:02.136Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"5e9f2601-ad2f-44fa-b566-bc732a7ce640","stage":"payment","correlationId":"payment-updated:03dbb4b65f91d5d3e847c1b9","attempts":1}
üí∞ Processing payment completion for customer: 86AGBRF7HSX1METR7ZKN0C5JPR
   Payment source_type: CARD
   Payment tender_types: []
Customer 86AGBRF7HSX1METR7ZKN0C5JPR already completed first payment
{"ts":"2025-12-01T23:00:02.268Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"5e9f2601-ad2f-44fa-b566-bc732a7ce640","stage":"payment","correlationId":"payment-updated:03dbb4b65f91d5d3e847c1b9"}
{"ts":"2025-12-01T23:00:17.371Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"05098083-9425-4714-8b58-0690f9470da1","stage":"customer_ingest","correlationId":"customer-created:9b3d09082e6ca4624f9194b4","attempts":1}
üì• Received customer data: {
  "id": "36PQ80PMWFDYBX5J93VDXZ72WM",
  "address": {
    "country": "US"
  },
  "version": 0,
  "group_ids": [
    "LT4ZHFBQQYB2N.APPOINTMENTS"
  ],
  "created_at": "2025-12-01T23:00:13.118Z",
  "given_name": "Adriana",
  "updated_at": "2025-12-01T23:00:13Z",
  "family_name": "Herrera-Saujani",
  "preferences": {
    "email_unsubscribed": false
  },
  "phone_number": "+19089636714",
  "email_address": "adrianalhs98@gmail.com",
  "creation_source": "APPOINTMENTS"
}
üë§ Processing customer creation: 36PQ80PMWFDYBX5J93VDXZ72WM
üìç IP Address: unknown
üìß Email: adrianalhs98@gmail.com
üìû Phone: +19089636714
üë§ Name: Adriana Herrera-Saujani
‚ö†Ô∏è Suspicious IP activity detected: unknown used by 125 customers
‚ö†Ô∏è Suspicious activity detected for customer 36PQ80PMWFDYBX5J93VDXZ72WM, flagging for review
üéâ New customer detected: 36PQ80PMWFDYBX5J93VDXZ72WM
‚úÖ Customer added to database as NEW (temporary mark)
   - Will check for referral code when they book
   - Will give gift card on first booking if code found
‚úÖ Verification: Customer found in DB: true
{"ts":"2025-12-01T23:00:17.754Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"05098083-9425-4714-8b58-0690f9470da1","stage":"customer_ingest","correlationId":"customer-created:9b3d09082e6ca4624f9194b4"}
{"ts":"2025-12-01T23:00:20.043Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"456c586f-21df-4bee-8cc6-db55f7f403d1","stage":"booking","correlationId":"booking-created:943562de0a9ef215c2f48474","attempts":1}
üìÖ Processing booking created for customer: 36PQ80PMWFDYBX5J93VDXZ72WM
Full booking data: {
  "id": "4ifudsks8h3ozr",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-08T21:50:00Z",
  "created_at": "2025-12-01T23:00:16Z",
  "updated_at": "2025-12-01T23:00:16Z",
  "customer_id": "36PQ80PMWFDYBX5J93VDXZ72WM",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "36PQ80PMWFDYBX5J93VDXZ72WM",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMoZGdZlg-iKWTDu",
      "any_team_member": true,
      "duration_minutes": 150,
      "intermission_minutes": 0,
      "service_variation_id": "FKVQUFGSG7BFA55SUPGKTCWF",
      "service_variation_version": 1760141204155,
      "service_variation_client_id": "FKVQUFGSG7BFA55SUPGKTCWF"
    },
    {
      "team_member_id": "TMoZGdZlg-iKWTDu",
      "any_team_member": true,
      "duration_minutes": 20,
      "intermission_minutes": 0,
      "service_variation_id": "HAJX45W3U2WUCCXM5MI24UEE",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "HAJX45W3U2WUCCXM5MI24UEE"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Adriana Herrera-Saujani
üéâ First booking detected for customer: 36PQ80PMWFDYBX5J93VDXZ72WM
   Name: Adriana Herrera-Saujani
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 36PQ80PMWFDYBX5J93VDXZ72WM...
Error getting custom attributes for customer 36PQ80PMWFDYBX5J93VDXZ72WM: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 36PQ80PMWFDYBX5J93VDXZ72WM
{"ts":"2025-12-01T23:00:20.453Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"456c586f-21df-4bee-8cc6-db55f7f403d1","stage":"booking","correlationId":"booking-created:943562de0a9ef215c2f48474"}
{"ts":"2025-12-01T23:02:24.790Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"060aec4b-b02a-484f-8f83-bb580acc9755","stage":"payment","correlationId":"payment-updated:bba91f2c6dfefdc2baec327f","attempts":1}
üí∞ Processing payment completion for customer: HP0M7F82N752PTA1D9TECBDPC4
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Kimia Rahmani
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Kimia Rahmani, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Kimia Rahmani
   - Email: Kimirah99@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: HP0M7F82N752PTA1D9TECBDPC4
{"ts":"2025-12-01T23:02:25.401Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"060aec4b-b02a-484f-8f83-bb580acc9755","stage":"payment","correlationId":"payment-updated:bba91f2c6dfefdc2baec327f"}
{"ts":"2025-12-01T23:02:27.678Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"f0d99223-4280-4937-9a2f-5c132cbabd23","stage":"payment","correlationId":"payment-updated:d4034a6cc93a4f89389b0623","attempts":1}
üí∞ Processing payment completion for customer: HP0M7F82N752PTA1D9TECBDPC4
   Payment source_type: CARD
   Payment tender_types: []
Customer HP0M7F82N752PTA1D9TECBDPC4 already completed first payment
{"ts":"2025-12-01T23:02:27.810Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"f0d99223-4280-4937-9a2f-5c132cbabd23","stage":"payment","correlationId":"payment-updated:d4034a6cc93a4f89389b0623"}
{"ts":"2025-12-01T23:10:32.846Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"0929fa5f-7a52-4797-aa74-bb27d10c59c0","stage":"booking","correlationId":"booking-created:758a5eacd106cbf19f84d855","attempts":1}
üìÖ Processing booking created for customer: 4S77B84J2X58S9PRGRPEPC8XBM
Full booking data: {
  "id": "e02m5q5gkmvv81",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-02T22:30:00Z",
  "created_at": "2025-12-01T23:10:30Z",
  "updated_at": "2025-12-01T23:10:30Z",
  "customer_id": "4S77B84J2X58S9PRGRPEPC8XBM",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMQPbDVvvOCLwqsy"
  },
  "appointment_segments": [
    {
      "team_member_id": "TM9jDlRr_Hl4rdBB",
      "any_team_member": false,
      "duration_minutes": 30,
      "intermission_minutes": 0,
      "service_variation_id": "JNRUKPGA2ZZUFCEB6YPNDC2Y",
      "service_variation_version": 1760895536505,
      "service_variation_client_id": "JNRUKPGA2ZZUFCEB6YPNDC2Y"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Lilli Ouyang
üéâ First booking detected for customer: 4S77B84J2X58S9PRGRPEPC8XBM
   Name: Lilli Ouyang
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 4S77B84J2X58S9PRGRPEPC8XBM...
Error getting custom attributes for customer 4S77B84J2X58S9PRGRPEPC8XBM: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 4S77B84J2X58S9PRGRPEPC8XBM
{"ts":"2025-12-01T23:10:33.606Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"0929fa5f-7a52-4797-aa74-bb27d10c59c0","stage":"booking","correlationId":"booking-created:758a5eacd106cbf19f84d855"}
{"ts":"2025-12-01T23:23:42.136Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"508318ca-9312-4291-99bb-c2cc0d2cce61","stage":"booking","correlationId":"booking-created:96968c4ff53f37ca15b9bf09","attempts":1}
üìÖ Processing booking created for customer: P8F14M0HPR5KYEM70AH708K69W
Full booking data: {
  "id": "42qrgrjyeqz070",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-02T20:40:00Z",
  "created_at": "2025-12-01T23:23:38Z",
  "updated_at": "2025-12-01T23:23:38Z",
  "customer_id": "P8F14M0HPR5KYEM70AH708K69W",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "P8F14M0HPR5KYEM70AH708K69W",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMMHlgFBIFbMTRap",
      "any_team_member": false,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1764609601083,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Susie Roy
üéâ First booking detected for customer: P8F14M0HPR5KYEM70AH708K69W
   Name: Susie Roy
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer P8F14M0HPR5KYEM70AH708K69W...
Error getting custom attributes for customer P8F14M0HPR5KYEM70AH708K69W: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: P8F14M0HPR5KYEM70AH708K69W
{"ts":"2025-12-01T23:23:42.839Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"508318ca-9312-4291-99bb-c2cc0d2cce61","stage":"booking","correlationId":"booking-created:96968c4ff53f37ca15b9bf09"}
{"ts":"2025-12-01T23:37:24.097Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"686b40a0-787f-4bb8-8799-2f54b9753847","stage":"payment","correlationId":"payment-updated:1d9d7af27962399093606412","attempts":1}
üí∞ Processing payment completion for customer: TXKEEXS47V4VP6HYR224SMGVNR
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Sai Paspulati
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Sai Paspulati, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Sai Paspulati
   - Email: saisruthi@hotmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: TXKEEXS47V4VP6HYR224SMGVNR
{"ts":"2025-12-01T23:37:25.041Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"686b40a0-787f-4bb8-8799-2f54b9753847","stage":"payment","correlationId":"payment-updated:1d9d7af27962399093606412"}
{"ts":"2025-12-01T23:37:29.449Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"6186d2f5-e9b2-4e0c-ad57-fc0069eecc9a","stage":"payment","correlationId":"payment-updated:52c47f2ae6cd01e2ad82d64b","attempts":1}
üí∞ Processing payment completion for customer: TXKEEXS47V4VP6HYR224SMGVNR
   Payment source_type: CARD
   Payment tender_types: []
Customer TXKEEXS47V4VP6HYR224SMGVNR already completed first payment
{"ts":"2025-12-01T23:37:29.582Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"6186d2f5-e9b2-4e0c-ad57-fc0069eecc9a","stage":"payment","correlationId":"payment-updated:52c47f2ae6cd01e2ad82d64b"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-12-01T23:51:48.442Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-01T23:51:51.362Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"eb2af3d2-5f0e-47c2-b9dc-51a05e410e66","stage":"booking","correlationId":"booking-created:94c72f5d5ee88f07cefc24fe","attempts":1}
üìÖ Processing booking created for customer: T0A20DRFTAMN91TYZY0M3K1P70
Full booking data: {
  "id": "0ei6fr1n7g6njz",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-07T00:00:00Z",
  "created_at": "2025-12-01T23:46:44Z",
  "updated_at": "2025-12-01T23:46:44Z",
  "customer_id": "T0A20DRFTAMN91TYZY0M3K1P70",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "T0A20DRFTAMN91TYZY0M3K1P70",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMkdrQsxG5tlf-c_",
      "any_team_member": true,
      "duration_minutes": 140,
      "intermission_minutes": 0,
      "service_variation_id": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "CJI5WHOAKSFTASYPJ4MSYZLS"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Isabella Alveal
üéâ First booking detected for customer: T0A20DRFTAMN91TYZY0M3K1P70
   Name: Isabella Alveal
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer T0A20DRFTAMN91TYZY0M3K1P70...
Error getting custom attributes for customer T0A20DRFTAMN91TYZY0M3K1P70: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: T0A20DRFTAMN91TYZY0M3K1P70
{"ts":"2025-12-01T23:51:52.804Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"eb2af3d2-5f0e-47c2-b9dc-51a05e410e66","stage":"booking","correlationId":"booking-created:94c72f5d5ee88f07cefc24fe"}
{"ts":"2025-12-01T23:51:52.966Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"5d8f4a43-1b18-410c-b3d8-1f3c3eba6b02","stage":"booking","correlationId":"booking-created:71ae01c5b97fe83a6dca2aad","attempts":1}
üìÖ Processing booking created for customer: T0A20DRFTAMN91TYZY0M3K1P70
Full booking data: {
  "id": "xo1p9pzh0l6r6r",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-08T00:10:00Z",
  "created_at": "2025-12-01T23:48:51Z",
  "updated_at": "2025-12-01T23:48:51Z",
  "customer_id": "T0A20DRFTAMN91TYZY0M3K1P70",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "T0A20DRFTAMN91TYZY0M3K1P70",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "resource_ids": [
        "5OVIQ6GSSUXORACP6T7WBAQ7"
      ],
      "team_member_id": "TM-zXe9fXe4axYWn",
      "any_team_member": true,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "ZEAKNB35I37RMXNUBGWDZQIM",
      "service_variation_version": 1760895536505,
      "service_variation_client_id": "ZEAKNB35I37RMXNUBGWDZQIM"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Isabella Alveal
üéâ First booking detected for customer: T0A20DRFTAMN91TYZY0M3K1P70
   Name: Isabella Alveal
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer T0A20DRFTAMN91TYZY0M3K1P70...
Error getting custom attributes for customer T0A20DRFTAMN91TYZY0M3K1P70: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: T0A20DRFTAMN91TYZY0M3K1P70
{"ts":"2025-12-01T23:51:53.461Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"5d8f4a43-1b18-410c-b3d8-1f3c3eba6b02","stage":"booking","correlationId":"booking-created:71ae01c5b97fe83a6dca2aad"}
{"ts":"2025-12-01T23:51:53.646Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"3fc0fd01-f407-4c4e-bfb0-0c0637fb345c","stage":"booking","correlationId":"booking-created:cac6e58cf781de1f18ed4bda","attempts":1}
üìÖ Processing booking created for customer: CE3RV7TDM04EVX8BZD66CT72ZM
Full booking data: {
  "id": "umuvpzbbxsu9zw",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-07T00:20:00Z",
  "created_at": "2025-12-01T23:50:12Z",
  "updated_at": "2025-12-01T23:50:12Z",
  "customer_id": "CE3RV7TDM04EVX8BZD66CT72ZM",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "CE3RV7TDM04EVX8BZD66CT72ZM",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMoZGdZlg-iKWTDu",
      "any_team_member": true,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1764609601083,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Kristin Derby
üéâ First booking detected for customer: CE3RV7TDM04EVX8BZD66CT72ZM
   Name: Kristin Derby
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer CE3RV7TDM04EVX8BZD66CT72ZM...
Error getting custom attributes for customer CE3RV7TDM04EVX8BZD66CT72ZM: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: CE3RV7TDM04EVX8BZD66CT72ZM
{"ts":"2025-12-01T23:51:54.230Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"3fc0fd01-f407-4c4e-bfb0-0c0637fb345c","stage":"booking","correlationId":"booking-created:cac6e58cf781de1f18ed4bda"}
{"ts":"2025-12-01T23:51:54.396Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"d57ad5eb-f1f9-4376-8549-2b8c24bb288c","stage":"booking","correlationId":"booking-created:4b73acf3be3180eebf0bcd5c","attempts":1}
üìÖ Processing booking created for customer: JBJGE76DFEY21177TXB682M734
Full booking data: {
  "id": "5zig49cddcj6nm",
  "source": "THIRD_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-03T17:00:00Z",
  "created_at": "2025-12-01T23:50:54Z",
  "updated_at": "2025-12-01T23:50:54Z",
  "customer_id": "JBJGE76DFEY21177TXB682M734",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "JBJGE76DFEY21177TXB682M734",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMMHlgFBIFbMTRap",
      "any_team_member": false,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1764609601083,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Cassandra Trainor
üéâ First booking detected for customer: JBJGE76DFEY21177TXB682M734
   Name: Cassandra Trainor
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer JBJGE76DFEY21177TXB682M734...
Error getting custom attributes for customer JBJGE76DFEY21177TXB682M734: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: JBJGE76DFEY21177TXB682M734
{"ts":"2025-12-01T23:51:54.807Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"d57ad5eb-f1f9-4376-8549-2b8c24bb288c","stage":"booking","correlationId":"booking-created:4b73acf3be3180eebf0bcd5c"}
{"ts":"2025-12-02T00:00:48.196Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"\nInvalid `prisma.$queryRaw()` invocation:\n\n\nTransaction API error: Transaction already closed: A query cannot be executed on an expired transaction. The timeout for this transaction was 5000 ms, however 13875 ms passed since the start of the transaction. Consider increasing the interactive transaction timeout or doing less work in the transaction.","stack":"PrismaClientKnownRequestError: \nInvalid `prisma.$queryRaw()` invocation:\n\n\nTransaction API error: Transaction already closed: A query cannot be executed on an expired transaction. The timeout for this transaction was 5000 ms, however 13875 ms passed since the start of the transaction. Consider increasing the interactive transaction timeout or doing less work in the transaction.\n    at $n.handleRequestError (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:121:7315)\n    at $n.handleAndLogRequestError (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:121:6623)\n    at $n.request (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:121:6307)\n    at async l (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:9633)\n    at async prisma.$transaction.isolationLevel (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:239:26)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:8000)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T00:00:51.982Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"2ebd6470-1888-46b9-aab9-45c552562df9","stage":"booking","correlationId":"booking-created:a0db0e5e733f0780df07dcbf","attempts":1}
üìÖ Processing booking created for customer: E5ZQZ7E7RHZKRW11G2HAVCN60M
Full booking data: {
  "id": "kjybljxglwkjeo",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-03T19:30:00Z",
  "created_at": "2025-12-01T23:56:26Z",
  "updated_at": "2025-12-01T23:56:26Z",
  "customer_id": "E5ZQZ7E7RHZKRW11G2HAVCN60M",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "E5ZQZ7E7RHZKRW11G2HAVCN60M",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TM9jDlRr_Hl4rdBB",
      "any_team_member": true,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "HXLBKQC3DRE57DB7IK5RBYOB",
      "service_variation_version": 1758654327496,
      "service_variation_client_id": "HXLBKQC3DRE57DB7IK5RBYOB"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Angelina Yilmaz
üéâ First booking detected for customer: E5ZQZ7E7RHZKRW11G2HAVCN60M
   Name: Angelina Yilmaz
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer E5ZQZ7E7RHZKRW11G2HAVCN60M...
Error getting custom attributes for customer E5ZQZ7E7RHZKRW11G2HAVCN60M: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: E5ZQZ7E7RHZKRW11G2HAVCN60M
{"ts":"2025-12-02T00:00:55.144Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"2ebd6470-1888-46b9-aab9-45c552562df9","stage":"booking","correlationId":"booking-created:a0db0e5e733f0780df07dcbf"}
{"ts":"2025-12-02T00:00:56.166Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"a8347976-a3e2-45a0-9e26-362ab8b478e7","stage":"payment","correlationId":"payment-updated:45d003ca1b11771a495c71e3","attempts":1}
üí∞ Processing payment completion for customer: Q18M3GTWMST22CEPJRJCVMVWNG
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Eve Lewis
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Eve Lewis, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Eve Lewis
   - Email: evegavinlewis@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: Q18M3GTWMST22CEPJRJCVMVWNG
{"ts":"2025-12-02T00:00:57.023Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"a8347976-a3e2-45a0-9e26-362ab8b478e7","stage":"payment","correlationId":"payment-updated:45d003ca1b11771a495c71e3"}
{"ts":"2025-12-02T00:00:57.244Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"4577db4f-e820-4164-b253-3498ef85322f","stage":"payment","correlationId":"payment-updated:c066cc8e1a5d0234799e66f8","attempts":1}
üí∞ Processing payment completion for customer: Q18M3GTWMST22CEPJRJCVMVWNG
   Payment source_type: CARD
   Payment tender_types: []
Customer Q18M3GTWMST22CEPJRJCVMVWNG already completed first payment
{"ts":"2025-12-02T00:00:57.477Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"4577db4f-e820-4164-b253-3498ef85322f","stage":"payment","correlationId":"payment-updated:c066cc8e1a5d0234799e66f8"}
{"ts":"2025-12-02T00:00:57.987Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"0f14dbb6-2548-41b1-acb7-55dfe15b00ab","stage":"payment","correlationId":"payment-updated:f1db7da69df5f7fe93f933bd","attempts":1}
üí∞ Processing payment completion for customer: HZJN3XW012X3EEPYRSXJFMP8R4
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Liz Jones
‚ùå Referrer not found for code: null
‚úÖ Generated new personal_code in name+ID format: LIZ2384
‚ùå Error creating/loading gift card for Liz Jones: Response status code was not ok: 401.
Square API errors: [
  {
    "category": "AUTHENTICATION_ERROR",
    "code": "UNAUTHORIZED",
    "detail": "This request could not be authorized."
  }
]
‚ùå Failed to create referrer gift card
Error upserting custom attribute "square:a3dde506-f69e-48e4-a98a-004c1822d3ad" for customer HZJN3XW012X3EEPYRSXJFMP8R4: Response status code was not ok: 401.
Square API errors: [
  {
    "category": "AUTHENTICATION_ERROR",
    "code": "UNAUTHORIZED",
    "detail": "This request could not be authorized."
  }
]
Error appending referral note for customer HZJN3XW012X3EEPYRSXJFMP8R4: Response status code was not ok: 401.
Square API errors: [
  {
    "category": "AUTHENTICATION_ERROR",
    "code": "UNAUTHORIZED",
    "detail": "This request could not be authorized."
  }
]
‚ùå Error sending referral email to Lizmjjones@gmail.com: Unauthorized
SendGrid error details: {
  errors: [
    {
      message: 'The provided authorization grant is invalid, expired, or revoked',
      field: null,
      help: null
    }
  ]
}
‚ö†Ô∏è Analytics operation "notification_event" failed: 
Invalid `prisma.notificationEvent.create()` invocation in
/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/analytics-service.js:164:39

  161 return runAnalyticsOperation(
  162   'notification_event',
  163   async () => {
‚Üí 164     return prisma.notificationEvent.create({
            data: {
              channel: "EMAIL",
              templateType: "REFERRAL_INVITE",
              status: "failed",
              createdAt: new Date("2025-12-02T00:00:59.542Z"),
              errorCode: 401,
                         ~~~
              errorMessage: "Unauthorized",
              metadata: {
                email: "Lizmjjones@gmail.com",
                referralCode: "LIZ2384",
                referralUrl: "https://referral-system-salon-fbbq6x1wt-umis-projects-e802f152.vercel.app/ref/LIZ2384",
                suppressionGroupId: 28008
              }
            }
          })

Argument `errorCode`: Invalid value provided. Expected String or Null, provided Int.
‚ùå Failed to send email: Unauthorized
‚ÑπÔ∏è SMS sending disabled. Would send referral link to +15178813794
‚è∏Ô∏è SMS sending disabled (skipped sending to +15178813794)
üìß Referral code generated and sent:
   - Customer: Liz Jones
   - Email: Lizmjjones@gmail.com
   - Referral Code: LIZ2384
   - Referral URL: https://referral-system-salon-fbbq6x1wt-umis-projects-e802f152.vercel.app/ref/LIZ2384
   - Gift Card ID: null
   - Status: Customer is now a referrer
‚úÖ Referral code sent to new client:
   - Customer: Liz Jones
   - Email: Lizmjjones@gmail.com
   - Referral Code: LIZ2384
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: HZJN3XW012X3EEPYRSXJFMP8R4
{"ts":"2025-12-02T00:01:00.218Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"0f14dbb6-2548-41b1-acb7-55dfe15b00ab","stage":"payment","correlationId":"payment-updated:f1db7da69df5f7fe93f933bd"}
{"ts":"2025-12-02T00:01:00.435Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"cd8598e3-7301-4ae7-a882-2f7064b4ee1c","stage":"payment","correlationId":"payment-updated:ab43da5a468316d33c62da02","attempts":1}
üí∞ Processing payment completion for customer: HZJN3XW012X3EEPYRSXJFMP8R4
   Payment source_type: CARD
   Payment tender_types: []
Customer HZJN3XW012X3EEPYRSXJFMP8R4 already completed first payment
{"ts":"2025-12-02T00:01:00.577Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"cd8598e3-7301-4ae7-a882-2f7064b4ee1c","stage":"payment","correlationId":"payment-updated:ab43da5a468316d33c62da02"}
{"ts":"2025-12-02T00:01:03.866Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"3958a570-cc35-4545-afbf-6286be85cb0f","stage":"payment","correlationId":"payment-updated:0908a63c3b0721abb54d6531","attempts":1}
üí∞ Processing payment completion for customer: 3KV5MMQJFH1N33PATWDM9KN58C
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Yangjee Macri
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Yangjee Macri, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Yangjee Macri
   - Email: macri.yangjee@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: 3KV5MMQJFH1N33PATWDM9KN58C
{"ts":"2025-12-02T00:01:05.118Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"3958a570-cc35-4545-afbf-6286be85cb0f","stage":"payment","correlationId":"payment-updated:0908a63c3b0721abb54d6531"}
{"ts":"2025-12-02T00:02:13.081Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Transaction already closed: A commit cannot be executed on an expired transaction. The timeout for this transaction was 5000 ms, however 18363 ms passed since the start of the transaction. Consider increasing the interactive transaction timeout or doing less work in the transaction.","stack":"PrismaClientKnownRequestError: Transaction API error: Transaction already closed: A commit cannot be executed on an expired transaction. The timeout for this transaction was 5000 ms, however 18363 ms passed since the start of the transaction. Consider increasing the interactive transaction timeout or doing less work in the transaction.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:8034)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`

Please make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.
{"ts":"2025-12-02T00:02:15.094Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T00:02:17.112Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T00:02:19.120Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T00:02:21.125Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T00:02:23.130Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T00:02:25.131Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T00:02:27.137Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`

Please make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.
{"ts":"2025-12-02T00:12:23.786Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T00:12:25.791Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T00:12:27.795Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T00:12:29.799Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T00:12:31.803Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T00:12:33.813Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T00:12:35.820Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T00:12:37.826Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T00:12:39.834Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T00:12:41.838Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T00:12:43.842Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T00:12:45.846Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T00:12:47.851Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T00:12:49.856Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T00:12:51.861Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T00:12:53.865Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T00:12:55.868Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T00:12:57.873Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T00:12:59.878Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T00:13:01.881Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T00:13:03.885Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T00:13:05.893Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T00:13:07.898Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T00:13:09.902Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T00:13:11.909Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T00:13:13.912Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T00:13:15.915Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T00:13:17.918Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T00:13:19.922Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T00:13:21.926Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`

Please make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.
{"ts":"2025-12-02T00:13:23.938Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T00:13:25.942Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T00:13:27.946Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T00:13:29.951Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T00:13:31.961Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T00:13:34.127Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T00:13:36.150Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T00:13:38.167Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T00:13:40.179Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T00:13:42.182Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T00:13:44.187Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T00:13:46.195Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T00:13:48.199Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T00:13:50.203Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T00:13:52.206Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T00:13:54.210Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T00:13:56.213Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T00:13:58.217Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T00:14:00.220Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T00:14:02.226Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T00:14:04.231Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T00:14:06.235Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T00:14:08.238Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T00:14:10.243Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T00:14:12.246Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T00:14:14.249Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T00:14:16.253Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T00:14:18.258Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T00:14:20.262Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T00:14:22.266Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`

Please make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.
{"ts":"2025-12-02T00:14:24.274Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T00:14:26.277Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T00:14:28.281Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T00:14:30.290Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T00:14:32.294Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T00:14:34.305Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T00:14:36.309Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T00:14:38.313Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T00:14:40.316Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T00:14:42.320Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T00:14:44.324Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T00:14:46.327Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T00:14:48.330Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T00:14:50.334Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T00:14:52.338Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T00:14:54.342Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T00:14:56.346Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T00:14:58.350Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T00:15:00.354Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T00:15:02.358Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T00:15:04.363Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T00:15:06.366Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T00:15:08.370Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T00:15:10.372Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T00:15:12.376Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T00:15:14.381Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T00:15:18.171Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"e52906c2-4364-4d09-a942-b1961064c01b","stage":"payment","correlationId":"payment-updated:27512dc8855e292ceb4e3f74","attempts":1}
üí∞ Processing payment completion for customer: 3KV5MMQJFH1N33PATWDM9KN58C
   Payment source_type: CARD
   Payment tender_types: []
Customer 3KV5MMQJFH1N33PATWDM9KN58C already completed first payment
{"ts":"2025-12-02T00:15:19.733Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"e52906c2-4364-4d09-a942-b1961064c01b","stage":"payment","correlationId":"payment-updated:27512dc8855e292ceb4e3f74"}
{"ts":"2025-12-02T00:15:20.193Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"bc7923c5-d998-4064-a4cc-f67bcc70e79d","stage":"booking","correlationId":"booking-created:b81551f9e97fcc798e62d771","attempts":1}
üìÖ Processing booking created for customer: 992FQZKFJWK2SH6P04Q1DK8Q0G
Full booking data: {
  "id": "choqtett6js0da",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-11T18:00:00Z",
  "created_at": "2025-12-02T00:04:04Z",
  "updated_at": "2025-12-02T00:04:04Z",
  "customer_id": "992FQZKFJWK2SH6P04Q1DK8Q0G",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "992FQZKFJWK2SH6P04Q1DK8Q0G",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMgsjtuk5cfKnstq",
      "any_team_member": false,
      "duration_minutes": 110,
      "intermission_minutes": 0,
      "service_variation_id": "6TYOE67IDYTKHW2ZG6HKVZER",
      "service_variation_version": 1764609577793,
      "service_variation_client_id": "6TYOE67IDYTKHW2ZG6HKVZER"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Jacki Jones
üéâ First booking detected for customer: 992FQZKFJWK2SH6P04Q1DK8Q0G
   Name: Jacki Jones
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 992FQZKFJWK2SH6P04Q1DK8Q0G...
Error getting custom attributes for customer 992FQZKFJWK2SH6P04Q1DK8Q0G: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 992FQZKFJWK2SH6P04Q1DK8Q0G
{"ts":"2025-12-02T00:15:20.782Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"bc7923c5-d998-4064-a4cc-f67bcc70e79d","stage":"booking","correlationId":"booking-created:b81551f9e97fcc798e62d771"}
{"ts":"2025-12-02T00:15:20.950Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"baba3de6-5a1c-4cfe-89d7-d534c06ce3fb","stage":"payment","correlationId":"payment-updated:524fb40cd239eab763644b3e","attempts":1}
üí∞ Processing payment completion for customer: ZF5Z9M6KY4064HBJBVTDSNEM44
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Marisa LaVallee
‚ùå Referrer not found for code: null
‚úÖ Generated new personal_code in name+ID format: MARISA6444
‚ùå Error creating/loading gift card for Marisa LaVallee: Response status code was not ok: 401.
Square API errors: [
  {
    "category": "AUTHENTICATION_ERROR",
    "code": "UNAUTHORIZED",
    "detail": "This request could not be authorized."
  }
]
‚ùå Failed to create referrer gift card
Error upserting custom attribute "square:a3dde506-f69e-48e4-a98a-004c1822d3ad" for customer ZF5Z9M6KY4064HBJBVTDSNEM44: Response status code was not ok: 401.
Square API errors: [
  {
    "category": "AUTHENTICATION_ERROR",
    "code": "UNAUTHORIZED",
    "detail": "This request could not be authorized."
  }
]
Error appending referral note for customer ZF5Z9M6KY4064HBJBVTDSNEM44: Response status code was not ok: 401.
Square API errors: [
  {
    "category": "AUTHENTICATION_ERROR",
    "code": "UNAUTHORIZED",
    "detail": "This request could not be authorized."
  }
]
‚ùå Error sending referral email to marisa.lavallee2@gmail.com: Unauthorized
SendGrid error details: {
  errors: [
    {
      message: 'The provided authorization grant is invalid, expired, or revoked',
      field: null,
      help: null
    }
  ]
}
‚ö†Ô∏è Analytics operation "notification_event" failed: 
Invalid `prisma.notificationEvent.create()` invocation in
/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/analytics-service.js:164:39

  161 return runAnalyticsOperation(
  162   'notification_event',
  163   async () => {
‚Üí 164     return prisma.notificationEvent.create({
            data: {
              channel: "EMAIL",
              templateType: "REFERRAL_INVITE",
              status: "failed",
              createdAt: new Date("2025-12-02T00:15:22.186Z"),
              errorCode: 401,
                         ~~~
              errorMessage: "Unauthorized",
              metadata: {
                email: "marisa.lavallee2@gmail.com",
                referralCode: "MARISA6444",
                referralUrl: "https://referral-system-salon-fbbq6x1wt-umis-projects-e802f152.vercel.app/ref/MARISA6444",
                suppressionGroupId: 28008
              }
            }
          })

Argument `errorCode`: Invalid value provided. Expected String or Null, provided Int.
‚ùå Failed to send email: Unauthorized
‚ÑπÔ∏è SMS sending disabled. Would send referral link to +13369721095
‚è∏Ô∏è SMS sending disabled (skipped sending to +13369721095)
üìß Referral code generated and sent:
   - Customer: Marisa LaVallee
   - Email: marisa.lavallee2@gmail.com
   - Referral Code: MARISA6444
   - Referral URL: https://referral-system-salon-fbbq6x1wt-umis-projects-e802f152.vercel.app/ref/MARISA6444
   - Gift Card ID: null
   - Status: Customer is now a referrer
‚úÖ Referral code sent to new client:
   - Customer: Marisa LaVallee
   - Email: marisa.lavallee2@gmail.com
   - Referral Code: MARISA6444
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: ZF5Z9M6KY4064HBJBVTDSNEM44
{"ts":"2025-12-02T00:15:22.421Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"baba3de6-5a1c-4cfe-89d7-d534c06ce3fb","stage":"payment","correlationId":"payment-updated:524fb40cd239eab763644b3e"}
{"ts":"2025-12-02T00:15:22.590Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"72cedb79-57d1-4475-8c5f-7b9097b235f5","stage":"payment","correlationId":"payment-updated:854407be5d38feaac783fa38","attempts":1}
üí∞ Processing payment completion for customer: ZF5Z9M6KY4064HBJBVTDSNEM44
   Payment source_type: CARD
   Payment tender_types: []
Customer ZF5Z9M6KY4064HBJBVTDSNEM44 already completed first payment
{"ts":"2025-12-02T00:15:22.728Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"72cedb79-57d1-4475-8c5f-7b9097b235f5","stage":"payment","correlationId":"payment-updated:854407be5d38feaac783fa38"}
{"ts":"2025-12-02T00:29:41.098Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"60f32aee-3def-4650-b422-4847112975b1","stage":"payment","correlationId":"payment-updated:c22ddf097260f1fe72902815","attempts":1}
üí∞ Processing payment completion for customer: SBTMN68GMH0AB3YFW7R3FQ7VPW
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Kendall Ritter
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Kendall Ritter, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Kendall Ritter
   - Email: kendallbritter@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: SBTMN68GMH0AB3YFW7R3FQ7VPW
{"ts":"2025-12-02T00:29:41.725Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"60f32aee-3def-4650-b422-4847112975b1","stage":"payment","correlationId":"payment-updated:c22ddf097260f1fe72902815"}
{"ts":"2025-12-02T00:29:46.161Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"46ae7015-91cb-4817-8f62-7a109788af6d","stage":"payment","correlationId":"payment-updated:1847fde7fd12b999e1a298ed","attempts":1}
üí∞ Processing payment completion for customer: SBTMN68GMH0AB3YFW7R3FQ7VPW
   Payment source_type: CARD
   Payment tender_types: []
Customer SBTMN68GMH0AB3YFW7R3FQ7VPW already completed first payment
{"ts":"2025-12-02T00:29:46.309Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"46ae7015-91cb-4817-8f62-7a109788af6d","stage":"payment","correlationId":"payment-updated:1847fde7fd12b999e1a298ed"}
{"ts":"2025-12-02T00:32:44.755Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"e6c64eb9-223a-4dd6-b2ed-2a94d983387d","stage":"booking","correlationId":"booking-created:70ab91b6ac5170d9fdd7982a","attempts":1}
üìÖ Processing booking created for customer: SBTMN68GMH0AB3YFW7R3FQ7VPW
Full booking data: {
  "id": "uv65x0h0c162ic",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-29T23:00:00Z",
  "created_at": "2025-12-02T00:32:41Z",
  "updated_at": "2025-12-02T00:32:41Z",
  "customer_id": "SBTMN68GMH0AB3YFW7R3FQ7VPW",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "SBTMN68GMH0AB3YFW7R3FQ7VPW",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMNW4SIF7tjp4oM_",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "BRSIGZFOWC6F4ERPKX3CODLU",
      "service_variation_version": 1764609577793,
      "service_variation_client_id": "BRSIGZFOWC6F4ERPKX3CODLU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Kendall Ritter
üéâ First booking detected for customer: SBTMN68GMH0AB3YFW7R3FQ7VPW
   Name: Kendall Ritter
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer SBTMN68GMH0AB3YFW7R3FQ7VPW...
Error getting custom attributes for customer SBTMN68GMH0AB3YFW7R3FQ7VPW: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: SBTMN68GMH0AB3YFW7R3FQ7VPW
{"ts":"2025-12-02T00:32:46.040Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"e6c64eb9-223a-4dd6-b2ed-2a94d983387d","stage":"booking","correlationId":"booking-created:70ab91b6ac5170d9fdd7982a"}
{"ts":"2025-12-02T00:35:16.268Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"a6ebc71c-93a7-4bed-8614-570bf76e35ba","stage":"payment","correlationId":"payment-updated:a3b3b8131cf48f77922ea972","attempts":1}
üí∞ Processing payment completion for customer: Q4WSB4NTNXWG9HSTJ5NEEWSMYW
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Neda Nguyen
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Neda Nguyen, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Neda Nguyen
   - Email: neda.nguyen06@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: Q4WSB4NTNXWG9HSTJ5NEEWSMYW
{"ts":"2025-12-02T00:35:16.835Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"a6ebc71c-93a7-4bed-8614-570bf76e35ba","stage":"payment","correlationId":"payment-updated:a3b3b8131cf48f77922ea972"}
{"ts":"2025-12-02T00:35:21.656Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"57aac956-0cff-48cc-9613-57650fe174e0","stage":"payment","correlationId":"payment-updated:08b19fb4c06a8e514477863d","attempts":1}
üí∞ Processing payment completion for customer: Q4WSB4NTNXWG9HSTJ5NEEWSMYW
   Payment source_type: CARD
   Payment tender_types: []
Customer Q4WSB4NTNXWG9HSTJ5NEEWSMYW already completed first payment
{"ts":"2025-12-02T00:35:21.865Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"57aac956-0cff-48cc-9613-57650fe174e0","stage":"payment","correlationId":"payment-updated:08b19fb4c06a8e514477863d"}
{"ts":"2025-12-02T00:35:41.246Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"6405a812-c184-4e49-a60b-f5528ff4f866","stage":"booking","correlationId":"booking-created:8b43493fc2eae40372bac7ac","attempts":1}
üìÖ Processing booking created for customer: AY26YBF9Z9Y1EQZ76QJGXE6ZN0
Full booking data: {
  "id": "c6pzardrlg0amx",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-06T20:20:00Z",
  "created_at": "2025-12-02T00:35:38Z",
  "updated_at": "2025-12-02T00:35:38Z",
  "customer_id": "AY26YBF9Z9Y1EQZ76QJGXE6ZN0",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "AY26YBF9Z9Y1EQZ76QJGXE6ZN0",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TM-zXe9fXe4axYWn",
      "any_team_member": false,
      "duration_minutes": 140,
      "intermission_minutes": 0,
      "service_variation_id": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "service_variation_version": 1758927251718,
      "service_variation_client_id": "CJI5WHOAKSFTASYPJ4MSYZLS"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Tanaya Kumar
üéâ First booking detected for customer: AY26YBF9Z9Y1EQZ76QJGXE6ZN0
   Name: Tanaya Kumar
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer AY26YBF9Z9Y1EQZ76QJGXE6ZN0...
Error getting custom attributes for customer AY26YBF9Z9Y1EQZ76QJGXE6ZN0: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: AY26YBF9Z9Y1EQZ76QJGXE6ZN0
{"ts":"2025-12-02T00:35:41.793Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"6405a812-c184-4e49-a60b-f5528ff4f866","stage":"booking","correlationId":"booking-created:8b43493fc2eae40372bac7ac"}
{"ts":"2025-12-02T00:42:55.651Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"4a1ae751-1611-49d5-aff8-48929f627213","stage":"payment","correlationId":"payment-updated:b035a8b7067c89679a25ddcd","attempts":1}
üí∞ Processing payment completion for customer: 0TG5WNATPE362NC416TC4YQ14C
   Payment source_type: CARD
   Payment tender_types: []
Customer 0TG5WNATPE362NC416TC4YQ14C already completed first payment
{"ts":"2025-12-02T00:42:56.142Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"4a1ae751-1611-49d5-aff8-48929f627213","stage":"payment","correlationId":"payment-updated:b035a8b7067c89679a25ddcd"}
{"ts":"2025-12-02T00:43:00.772Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"bc445052-b0d4-4493-9469-7b8c680f3941","stage":"payment","correlationId":"payment-updated:dac407e0e13af99d7c67db6b","attempts":1}
üí∞ Processing payment completion for customer: 0TG5WNATPE362NC416TC4YQ14C
   Payment source_type: CARD
   Payment tender_types: []
Customer 0TG5WNATPE362NC416TC4YQ14C already completed first payment
{"ts":"2025-12-02T00:43:00.953Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"bc445052-b0d4-4493-9469-7b8c680f3941","stage":"payment","correlationId":"payment-updated:dac407e0e13af99d7c67db6b"}
{"ts":"2025-12-02T00:52:15.172Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Server has closed the connection.","stack":"PrismaClientKnownRequestError: Server has closed the connection.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T00:52:18.132Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"99edade1-c588-4460-96f2-f603d5b7a3c8","stage":"payment","correlationId":"payment-updated:0dbb4564a30b7f62df884632","attempts":1}
üí∞ Processing payment completion for customer: AQJM14K5E90BB90WSPPYEMEN1R
   Payment source_type: CARD
   Payment tender_types: []
Customer AQJM14K5E90BB90WSPPYEMEN1R already completed first payment
{"ts":"2025-12-02T00:52:19.003Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"99edade1-c588-4460-96f2-f603d5b7a3c8","stage":"payment","correlationId":"payment-updated:0dbb4564a30b7f62df884632"}
{"ts":"2025-12-02T00:52:19.350Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"4646f5f8-a44f-412e-9968-c65f93538483","stage":"payment","correlationId":"payment-updated:c02a7afba7ac3608cde48dc5","attempts":1}
üí∞ Processing payment completion for customer: AQJM14K5E90BB90WSPPYEMEN1R
   Payment source_type: CARD
   Payment tender_types: []
Customer AQJM14K5E90BB90WSPPYEMEN1R already completed first payment
{"ts":"2025-12-02T00:52:19.552Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"4646f5f8-a44f-412e-9968-c65f93538483","stage":"payment","correlationId":"payment-updated:c02a7afba7ac3608cde48dc5"}
{"ts":"2025-12-02T06:13:15.942Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Server has closed the connection.","stack":"PrismaClientKnownRequestError: Server has closed the connection.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T06:13:19.417Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"b16edbbd-4481-441f-82ac-ae2857346592","stage":"booking","correlationId":"booking-created:2155fc1b529566045fb4b847","attempts":1}
üìÖ Processing booking created for customer: XDD5BBZKVEEGX6PKFS2F56XY8C
Full booking data: {
  "id": "i0zx7vdbmnlxcc",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-05T18:00:00Z",
  "created_at": "2025-12-02T00:53:24Z",
  "updated_at": "2025-12-02T00:53:24Z",
  "customer_id": "XDD5BBZKVEEGX6PKFS2F56XY8C",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMWAtQTYmZpwwxii"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMMCVDJoKh3ZkfFo",
      "any_team_member": false,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1764609601083,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Maureya Lebowitz
üéâ First booking detected for customer: XDD5BBZKVEEGX6PKFS2F56XY8C
   Name: Maureya Lebowitz
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer XDD5BBZKVEEGX6PKFS2F56XY8C...
Error getting custom attributes for customer XDD5BBZKVEEGX6PKFS2F56XY8C: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: XDD5BBZKVEEGX6PKFS2F56XY8C
{"ts":"2025-12-02T06:13:20.204Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"b16edbbd-4481-441f-82ac-ae2857346592","stage":"booking","correlationId":"booking-created:2155fc1b529566045fb4b847"}
{"ts":"2025-12-02T06:13:20.371Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"f6ca2ae0-d106-489d-ba43-dac2a1e0068d","stage":"payment","correlationId":"payment-updated:1f9454103bb09f04a956c451","attempts":1}
üí∞ Processing payment completion for customer: D6Y59VS7SYCE4YZTM1MECYGWF8
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Katie Scherer
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Katie Scherer, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Katie Scherer
   - Email: kbishop444@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: D6Y59VS7SYCE4YZTM1MECYGWF8
{"ts":"2025-12-02T06:13:20.772Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"f6ca2ae0-d106-489d-ba43-dac2a1e0068d","stage":"payment","correlationId":"payment-updated:1f9454103bb09f04a956c451"}
{"ts":"2025-12-02T06:13:20.930Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"f47b97a1-47e4-4d49-819d-bfa52805845c","stage":"payment","correlationId":"payment-updated:5a4141e40b43f7dcad30d3bf","attempts":1}
üí∞ Processing payment completion for customer: D6Y59VS7SYCE4YZTM1MECYGWF8
   Payment source_type: CARD
   Payment tender_types: []
Customer D6Y59VS7SYCE4YZTM1MECYGWF8 already completed first payment
{"ts":"2025-12-02T06:13:21.080Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"f47b97a1-47e4-4d49-819d-bfa52805845c","stage":"payment","correlationId":"payment-updated:5a4141e40b43f7dcad30d3bf"}
{"ts":"2025-12-02T06:13:21.236Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"20a3a5e9-5cb1-45a5-9531-78fd33ce293b","stage":"payment","correlationId":"payment-updated:b9df90b5c569ebed7ace4087","attempts":1}
üí∞ Processing payment completion for customer: QF9TM3Z75QVE6QX1FM7TTY8YBW
   Payment source_type: CARD
   Payment tender_types: []
Customer QF9TM3Z75QVE6QX1FM7TTY8YBW already completed first payment
{"ts":"2025-12-02T06:13:21.377Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"20a3a5e9-5cb1-45a5-9531-78fd33ce293b","stage":"payment","correlationId":"payment-updated:b9df90b5c569ebed7ace4087"}
{"ts":"2025-12-02T06:13:21.532Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"4452092e-ee79-4fdb-ad0b-28064498ab87","stage":"payment","correlationId":"payment-updated:659f28db0984fb0efff7e1ea","attempts":1}
üí∞ Processing payment completion for customer: QF9TM3Z75QVE6QX1FM7TTY8YBW
   Payment source_type: CARD
   Payment tender_types: []
Customer QF9TM3Z75QVE6QX1FM7TTY8YBW already completed first payment
{"ts":"2025-12-02T06:13:21.670Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"4452092e-ee79-4fdb-ad0b-28064498ab87","stage":"payment","correlationId":"payment-updated:659f28db0984fb0efff7e1ea"}
{"ts":"2025-12-02T06:13:21.827Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"ede27856-d25e-4375-be63-75bb5ba0d66f","stage":"payment","correlationId":"payment-updated:029502e770d32d120dd57b34","attempts":1}
üí∞ Processing payment completion for customer: HDBQDJ6MGJW3NVX4VJCR28VYSM
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Crystal H
‚ùå Referrer not found for code: null
‚úÖ Generated new personal_code in name+ID format: CRYSTAL3428
‚ùå Error creating/loading gift card for Crystal H: Response status code was not ok: 401.
Square API errors: [
  {
    "category": "AUTHENTICATION_ERROR",
    "code": "UNAUTHORIZED",
    "detail": "This request could not be authorized."
  }
]
‚ùå Failed to create referrer gift card
Error upserting custom attribute "square:a3dde506-f69e-48e4-a98a-004c1822d3ad" for customer HDBQDJ6MGJW3NVX4VJCR28VYSM: Response status code was not ok: 401.
Square API errors: [
  {
    "category": "AUTHENTICATION_ERROR",
    "code": "UNAUTHORIZED",
    "detail": "This request could not be authorized."
  }
]
Error appending referral note for customer HDBQDJ6MGJW3NVX4VJCR28VYSM: Response status code was not ok: 401.
Square API errors: [
  {
    "category": "AUTHENTICATION_ERROR",
    "code": "UNAUTHORIZED",
    "detail": "This request could not be authorized."
  }
]
‚ùå Error sending referral email to crystal2011_2012@yahoo.com: Unauthorized
SendGrid error details: {
  errors: [
    {
      message: 'The provided authorization grant is invalid, expired, or revoked',
      field: null,
      help: null
    }
  ]
}
‚ö†Ô∏è Analytics operation "notification_event" failed: 
Invalid `prisma.notificationEvent.create()` invocation in
/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/analytics-service.js:164:39

  161 return runAnalyticsOperation(
  162   'notification_event',
  163   async () => {
‚Üí 164     return prisma.notificationEvent.create({
            data: {
              channel: "EMAIL",
              templateType: "REFERRAL_INVITE",
              status: "failed",
              createdAt: new Date("2025-12-02T06:13:23.239Z"),
              errorCode: 401,
                         ~~~
              errorMessage: "Unauthorized",
              metadata: {
                email: "crystal2011_2012@yahoo.com",
                referralCode: "CRYSTAL3428",
                referralUrl: "https://referral-system-salon-fbbq6x1wt-umis-projects-e802f152.vercel.app/ref/CRYSTAL3428",
                suppressionGroupId: 28008
              }
            }
          })

Argument `errorCode`: Invalid value provided. Expected String or Null, provided Int.
‚ùå Failed to send email: Unauthorized
‚ÑπÔ∏è SMS sending disabled. Would send referral link to +12024598975
‚è∏Ô∏è SMS sending disabled (skipped sending to +12024598975)
üìß Referral code generated and sent:
   - Customer: Crystal H
   - Email: crystal2011_2012@yahoo.com
   - Referral Code: CRYSTAL3428
   - Referral URL: https://referral-system-salon-fbbq6x1wt-umis-projects-e802f152.vercel.app/ref/CRYSTAL3428
   - Gift Card ID: null
   - Status: Customer is now a referrer
‚úÖ Referral code sent to new client:
   - Customer: Crystal H
   - Email: crystal2011_2012@yahoo.com
   - Referral Code: CRYSTAL3428
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: HDBQDJ6MGJW3NVX4VJCR28VYSM
{"ts":"2025-12-02T06:13:23.501Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"ede27856-d25e-4375-be63-75bb5ba0d66f","stage":"payment","correlationId":"payment-updated:029502e770d32d120dd57b34"}
{"ts":"2025-12-02T06:13:23.658Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"df440f1b-a952-43a4-af87-7ede774fed40","stage":"payment","correlationId":"payment-updated:8f08a9ae7c2ca4587431acf8","attempts":1}
üí∞ Processing payment completion for customer: HDBQDJ6MGJW3NVX4VJCR28VYSM
   Payment source_type: CARD
   Payment tender_types: []
Customer HDBQDJ6MGJW3NVX4VJCR28VYSM already completed first payment
{"ts":"2025-12-02T06:13:23.796Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"df440f1b-a952-43a4-af87-7ede774fed40","stage":"payment","correlationId":"payment-updated:8f08a9ae7c2ca4587431acf8"}
{"ts":"2025-12-02T06:13:23.953Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"30ec99c3-a454-48c7-8486-d8ac3d66e77b","stage":"payment","correlationId":"payment-updated:8b5a5564af29228721d07ae2","attempts":1}
üí∞ Processing payment completion for customer: 9VT9PGM9VAEAVJ2B0QCYHJC8R0
   Payment source_type: CARD
   Payment tender_types: []
Customer 9VT9PGM9VAEAVJ2B0QCYHJC8R0 already completed first payment
{"ts":"2025-12-02T06:13:24.135Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"30ec99c3-a454-48c7-8486-d8ac3d66e77b","stage":"payment","correlationId":"payment-updated:8b5a5564af29228721d07ae2"}
{"ts":"2025-12-02T06:13:24.297Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"7053858f-e990-4c78-954c-a919903d62f5","stage":"payment","correlationId":"payment-updated:18f36ac0607b5b83d6fc236f","attempts":1}
üí∞ Processing payment completion for customer: 9VT9PGM9VAEAVJ2B0QCYHJC8R0
   Payment source_type: CARD
   Payment tender_types: []
Customer 9VT9PGM9VAEAVJ2B0QCYHJC8R0 already completed first payment
{"ts":"2025-12-02T06:13:24.431Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"7053858f-e990-4c78-954c-a919903d62f5","stage":"payment","correlationId":"payment-updated:18f36ac0607b5b83d6fc236f"}
{"ts":"2025-12-02T06:13:24.589Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"d10c696b-b909-4919-a3f0-e8f95be66142","stage":"payment","correlationId":"payment-updated:a6c364b666533eb6aea4a6a1","attempts":1}
üí∞ Processing payment completion for customer: 9TPS15NVHPNSTA8VG282P50QRM
   Payment source_type: CARD
   Payment tender_types: []
Customer 9TPS15NVHPNSTA8VG282P50QRM already completed first payment
{"ts":"2025-12-02T06:13:24.730Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"d10c696b-b909-4919-a3f0-e8f95be66142","stage":"payment","correlationId":"payment-updated:a6c364b666533eb6aea4a6a1"}
{"ts":"2025-12-02T06:13:24.887Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"2adce4a2-08bd-4412-b450-50f987aba579","stage":"payment","correlationId":"payment-updated:82d10feff1be8e917a16ca50","attempts":1}
üí∞ Processing payment completion for customer: 9TPS15NVHPNSTA8VG282P50QRM
   Payment source_type: CARD
   Payment tender_types: []
Customer 9TPS15NVHPNSTA8VG282P50QRM already completed first payment
{"ts":"2025-12-02T06:13:25.746Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"2adce4a2-08bd-4412-b450-50f987aba579","stage":"payment","correlationId":"payment-updated:82d10feff1be8e917a16ca50"}
{"ts":"2025-12-02T06:13:25.902Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"07fd07d5-8259-4949-8ad4-b3f94067e143","stage":"booking","correlationId":"booking-created:1c813a30a1a015eb29c24fc2","attempts":1}
üìÖ Processing booking created for customer: XRZEGMAX6JP6RRW8R8NFA1MV3W
Full booking data: {
  "id": "bv4qve3niwotya",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-03T01:50:00Z",
  "created_at": "2025-12-02T01:51:01Z",
  "updated_at": "2025-12-02T01:51:01Z",
  "customer_id": "XRZEGMAX6JP6RRW8R8NFA1MV3W",
  "location_id": "LT4ZHFBQQYB2N",
  "seller_note": "–í–Ω–µ—Å—Ç–∏ –≤ –æ—Ç—á–µ—Ç –±–µ—Å–ø–ª–∞—Ç–Ω–æ!",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMQPbDVvvOCLwqsy"
  },
  "appointment_segments": [
    {
      "team_member_id": "TM9jDlRr_Hl4rdBB",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "XBUDIMNKOPC2XVG5YLIQ4RYS",
      "service_variation_version": 1764609577793,
      "service_variation_client_id": "XBUDIMNKOPC2XVG5YLIQ4RYS"
    },
    {
      "team_member_id": "TM9jDlRr_Hl4rdBB",
      "any_team_member": false,
      "duration_minutes": 20,
      "intermission_minutes": 0,
      "service_variation_id": "HAJX45W3U2WUCCXM5MI24UEE",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "HAJX45W3U2WUCCXM5MI24UEE"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Isabelle BLOGGER
üéâ First booking detected for customer: XRZEGMAX6JP6RRW8R8NFA1MV3W
   Name: Isabelle BLOGGER
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer XRZEGMAX6JP6RRW8R8NFA1MV3W...
Error getting custom attributes for customer XRZEGMAX6JP6RRW8R8NFA1MV3W: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: XRZEGMAX6JP6RRW8R8NFA1MV3W
{"ts":"2025-12-02T06:13:26.275Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"07fd07d5-8259-4949-8ad4-b3f94067e143","stage":"booking","correlationId":"booking-created:1c813a30a1a015eb29c24fc2"}
{"ts":"2025-12-02T06:13:26.429Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"171648d0-cd41-4248-8e39-012e5f404c9e","stage":"payment","correlationId":"payment-updated:be8ad199d13dedd29cfc7da9","attempts":1}
üí∞ Processing payment completion for customer: 1K5VSMKX25H36NP1MR7GREP8M4
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Kelley Eason
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Kelley Eason, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Kelley Eason
   - Email: easonkelley@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: 1K5VSMKX25H36NP1MR7GREP8M4
{"ts":"2025-12-02T06:13:26.746Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"171648d0-cd41-4248-8e39-012e5f404c9e","stage":"payment","correlationId":"payment-updated:be8ad199d13dedd29cfc7da9"}
{"ts":"2025-12-02T06:13:26.899Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"fa261a7b-62a5-471b-b9be-3c01efb5c832","stage":"payment","correlationId":"payment-updated:8e898bb96c8ab9406055d811","attempts":1}
üí∞ Processing payment completion for customer: 1K5VSMKX25H36NP1MR7GREP8M4
   Payment source_type: CARD
   Payment tender_types: []
Customer 1K5VSMKX25H36NP1MR7GREP8M4 already completed first payment
{"ts":"2025-12-02T06:13:27.035Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"fa261a7b-62a5-471b-b9be-3c01efb5c832","stage":"payment","correlationId":"payment-updated:8e898bb96c8ab9406055d811"}
{"ts":"2025-12-02T06:13:27.194Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"556c65df-65d3-4c4e-b9dd-0648b3bd7939","stage":"payment","correlationId":"payment-updated:ac3deaa49f6d2a5446df517e","attempts":1}
üí∞ Processing payment completion for customer: A4YBX3096R86QF34DTSWRCVXG8
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: brooke mattia
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to brooke mattia, skipping...
‚úÖ Referral code sent to new client:
   - Customer: brooke mattia
   - Email: Mattiabt7@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: A4YBX3096R86QF34DTSWRCVXG8
{"ts":"2025-12-02T06:13:27.525Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"556c65df-65d3-4c4e-b9dd-0648b3bd7939","stage":"payment","correlationId":"payment-updated:ac3deaa49f6d2a5446df517e"}
{"ts":"2025-12-02T06:13:27.686Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"822501c9-bb98-425c-b7c4-e7a7523a2ba0","stage":"payment","correlationId":"payment-updated:d885dd35e72ce451dadcfd3e","attempts":1}
üí∞ Processing payment completion for customer: A4YBX3096R86QF34DTSWRCVXG8
   Payment source_type: CARD
   Payment tender_types: []
Customer A4YBX3096R86QF34DTSWRCVXG8 already completed first payment
{"ts":"2025-12-02T06:13:27.822Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"822501c9-bb98-425c-b7c4-e7a7523a2ba0","stage":"payment","correlationId":"payment-updated:d885dd35e72ce451dadcfd3e"}
{"ts":"2025-12-02T06:13:27.978Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"e1d3151b-f7a3-4183-a358-da50ac1f56ff","stage":"booking","correlationId":"booking-created:4e39ef3faab2709d70e5c816","attempts":1}
üìÖ Processing booking created for customer: 9PVWXK4RXRXYRVM4BDQA2XD3TC
Full booking data: {
  "id": "ep49wo41habjar",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-07T23:30:00Z",
  "created_at": "2025-12-02T02:00:55Z",
  "updated_at": "2025-12-02T02:00:55Z",
  "customer_id": "9PVWXK4RXRXYRVM4BDQA2XD3TC",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "9PVWXK4RXRXYRVM4BDQA2XD3TC",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMXiw38Bbb7XQUWI",
      "any_team_member": true,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1764609601083,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Mahika Dubey
üéâ First booking detected for customer: 9PVWXK4RXRXYRVM4BDQA2XD3TC
   Name: Mahika Dubey
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 9PVWXK4RXRXYRVM4BDQA2XD3TC...
Error getting custom attributes for customer 9PVWXK4RXRXYRVM4BDQA2XD3TC: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 9PVWXK4RXRXYRVM4BDQA2XD3TC
{"ts":"2025-12-02T06:13:28.359Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"e1d3151b-f7a3-4183-a358-da50ac1f56ff","stage":"booking","correlationId":"booking-created:4e39ef3faab2709d70e5c816"}
{"ts":"2025-12-02T06:13:28.517Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"93b6ec4c-056b-4407-8422-337ca0c06b7f","stage":"payment","correlationId":"payment-updated:f2f34e03ada3f1f6ecffd834","attempts":1}
üí∞ Processing payment completion for customer: VX4W3SJ6RTFDRQNK1TZJC1T19G
   Payment source_type: CARD
   Payment tender_types: []
Customer VX4W3SJ6RTFDRQNK1TZJC1T19G already completed first payment
{"ts":"2025-12-02T06:13:28.662Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"93b6ec4c-056b-4407-8422-337ca0c06b7f","stage":"payment","correlationId":"payment-updated:f2f34e03ada3f1f6ecffd834"}
{"ts":"2025-12-02T06:13:28.816Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"6944b9fa-2f95-4c88-9883-56dc52e85b8b","stage":"payment","correlationId":"payment-updated:422b565197922f43a190316a","attempts":1}
üí∞ Processing payment completion for customer: VX4W3SJ6RTFDRQNK1TZJC1T19G
   Payment source_type: CARD
   Payment tender_types: []
Customer VX4W3SJ6RTFDRQNK1TZJC1T19G already completed first payment
{"ts":"2025-12-02T06:13:28.999Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"6944b9fa-2f95-4c88-9883-56dc52e85b8b","stage":"payment","correlationId":"payment-updated:422b565197922f43a190316a"}
{"ts":"2025-12-02T06:13:29.188Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"86de83aa-baa6-43ba-83b7-14e5f31930be","stage":"booking","correlationId":"booking-created:9f99346dbb0cdfc6280c5629","attempts":1}
üìÖ Processing booking created for customer: BG84AFYW767H4Y3XZB8S8P8ME4
Full booking data: {
  "id": "1gr7k10tdw7a7i",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-16T01:00:00Z",
  "created_at": "2025-12-02T02:29:40Z",
  "updated_at": "2025-12-02T02:29:40Z",
  "customer_id": "BG84AFYW767H4Y3XZB8S8P8ME4",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMWAtQTYmZpwwxii"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMgsjtuk5cfKnstq",
      "any_team_member": false,
      "duration_minutes": 110,
      "intermission_minutes": 0,
      "service_variation_id": "6TYOE67IDYTKHW2ZG6HKVZER",
      "service_variation_version": 1757963765505,
      "service_variation_client_id": "6TYOE67IDYTKHW2ZG6HKVZER"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Bozhena V
üéâ First booking detected for customer: BG84AFYW767H4Y3XZB8S8P8ME4
   Name: Bozhena V
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer BG84AFYW767H4Y3XZB8S8P8ME4...
Error getting custom attributes for customer BG84AFYW767H4Y3XZB8S8P8ME4: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: BG84AFYW767H4Y3XZB8S8P8ME4
{"ts":"2025-12-02T06:13:29.592Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"86de83aa-baa6-43ba-83b7-14e5f31930be","stage":"booking","correlationId":"booking-created:9f99346dbb0cdfc6280c5629"}
{"ts":"2025-12-02T06:13:29.750Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"7870304e-65db-4d5b-adc3-89c57e866708","stage":"payment","correlationId":"payment-updated:94c0518c8d649e17d478be87","attempts":1}
üí∞ Processing payment completion for customer: ZJTAADYCZMPGS4YS2F39CJFM1C
   Payment source_type: CASH
   Payment tender_types: []
Customer ZJTAADYCZMPGS4YS2F39CJFM1C already completed first payment
{"ts":"2025-12-02T06:13:29.888Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"7870304e-65db-4d5b-adc3-89c57e866708","stage":"payment","correlationId":"payment-updated:94c0518c8d649e17d478be87"}
{"ts":"2025-12-02T06:13:30.047Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"ecfcb3e8-a2ea-494e-a55a-e79af04d75a7","stage":"booking","correlationId":"booking-created:85c1503504d6951df3c0c7cd","attempts":1}
üìÖ Processing booking created for customer: 0GZTYPV8F1QJZ55D9CYBX29RZ0
Full booking data: {
  "id": "byopqn7m4fwig6",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-04T23:00:00Z",
  "created_at": "2025-12-02T02:37:33Z",
  "updated_at": "2025-12-02T02:37:33Z",
  "customer_id": "0GZTYPV8F1QJZ55D9CYBX29RZ0",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMWAtQTYmZpwwxii"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMVwAQUdLz6no-cB",
      "any_team_member": false,
      "duration_minutes": 30,
      "intermission_minutes": 0,
      "service_variation_id": "SGSLS3INMK5YV637KUITCILL",
      "service_variation_version": 1760895536505,
      "service_variation_client_id": "SGSLS3INMK5YV637KUITCILL"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Victoria Huang
üéâ First booking detected for customer: 0GZTYPV8F1QJZ55D9CYBX29RZ0
   Name: Victoria Huang
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 0GZTYPV8F1QJZ55D9CYBX29RZ0...
Error getting custom attributes for customer 0GZTYPV8F1QJZ55D9CYBX29RZ0: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 0GZTYPV8F1QJZ55D9CYBX29RZ0
{"ts":"2025-12-02T06:13:30.426Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"ecfcb3e8-a2ea-494e-a55a-e79af04d75a7","stage":"booking","correlationId":"booking-created:85c1503504d6951df3c0c7cd"}
{"ts":"2025-12-02T06:13:30.590Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"d9f504a0-6593-47e0-9a50-87276cd0ff2d","stage":"payment","correlationId":"payment-updated:f3860ef6728eec5871fb68bf","attempts":1}
üí∞ Processing payment completion for customer: BCWHNCZXMHMMV4VECHT1QEWNX8
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Olivia Koshy
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Olivia Koshy, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Olivia Koshy
   - Email: oliviamkoshy@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: BCWHNCZXMHMMV4VECHT1QEWNX8
{"ts":"2025-12-02T06:13:30.903Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"d9f504a0-6593-47e0-9a50-87276cd0ff2d","stage":"payment","correlationId":"payment-updated:f3860ef6728eec5871fb68bf"}
{"ts":"2025-12-02T06:13:31.061Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"9fac136c-8ee3-45b2-aae5-3933e98b1a48","stage":"payment","correlationId":"payment-updated:7ce10a4519da781ddb309614","attempts":1}
üí∞ Processing payment completion for customer: BCWHNCZXMHMMV4VECHT1QEWNX8
   Payment source_type: CARD
   Payment tender_types: []
Customer BCWHNCZXMHMMV4VECHT1QEWNX8 already completed first payment
{"ts":"2025-12-02T06:13:31.196Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"9fac136c-8ee3-45b2-aae5-3933e98b1a48","stage":"payment","correlationId":"payment-updated:7ce10a4519da781ddb309614"}
{"ts":"2025-12-02T06:13:31.352Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"63b67181-9ba0-4aa2-af6c-097c91550303","stage":"booking","correlationId":"booking-created:1b857f8124f9e738bfe3de6f","attempts":1}
üìÖ Processing booking created for customer: 6J5AM5C5C2RR67P4KBBJ0A7ZB8
Full booking data: {
  "id": "h4vnchhqlne59n",
  "source": "THIRD_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-19T18:30:00Z",
  "created_at": "2025-12-02T03:11:10Z",
  "updated_at": "2025-12-02T03:11:10Z",
  "customer_id": "6J5AM5C5C2RR67P4KBBJ0A7ZB8",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "6J5AM5C5C2RR67P4KBBJ0A7ZB8",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "resource_ids": [
        "5OVIQ6GSSUXORACP6T7WBAQ7"
      ],
      "team_member_id": "TMMCVDJoKh3ZkfFo",
      "any_team_member": true,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "ZEAKNB35I37RMXNUBGWDZQIM",
      "service_variation_version": 1760895536505,
      "service_variation_client_id": "ZEAKNB35I37RMXNUBGWDZQIM"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 0 customer(s) in database
‚ÑπÔ∏è Customer 6J5AM5C5C2RR67P4KBBJ0A7ZB8 not in database yet - need to add them first
‚ùå Error fetching/adding customer from Square: Response status code was not ok: 401.
{"ts":"2025-12-02T06:13:31.706Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"63b67181-9ba0-4aa2-af6c-097c91550303","stage":"booking","correlationId":"booking-created:1b857f8124f9e738bfe3de6f"}
{"ts":"2025-12-02T06:13:31.888Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"2bee0c1f-2a67-4ce7-a669-d20d8b1e5bb4","stage":"customer_ingest","correlationId":"customer-created:e501ae88c2415af03723dc1e","attempts":1}
üì• Received customer data: {
  "id": "6J5AM5C5C2RR67P4KBBJ0A7ZB8",
  "address": {
    "country": "US"
  },
  "version": 1,
  "group_ids": [
    "LT4ZHFBQQYB2N.APPOINTMENTS"
  ],
  "created_at": "2025-12-02T03:11:08.553Z",
  "given_name": "Zoe",
  "updated_at": "2025-12-02T03:11:11Z",
  "family_name": "Gisewhite",
  "preferences": {
    "email_unsubscribed": false
  },
  "phone_number": "(810) 280-5444",
  "email_address": "Theeeoo@gmail.com",
  "creation_source": "APPOINTMENTS"
}
üë§ Processing customer creation: 6J5AM5C5C2RR67P4KBBJ0A7ZB8
üìç IP Address: unknown
üìß Email: Theeeoo@gmail.com
üìû Phone: (810) 280-5444
üë§ Name: Zoe Gisewhite
‚ö†Ô∏è Suspicious IP activity detected: unknown used by 126 customers
‚ö†Ô∏è Suspicious activity detected for customer 6J5AM5C5C2RR67P4KBBJ0A7ZB8, flagging for review
üéâ New customer detected: 6J5AM5C5C2RR67P4KBBJ0A7ZB8
‚úÖ Customer added to database as NEW (temporary mark)
   - Will check for referral code when they book
   - Will give gift card on first booking if code found
‚úÖ Verification: Customer found in DB: true
{"ts":"2025-12-02T06:13:32.235Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"2bee0c1f-2a67-4ce7-a669-d20d8b1e5bb4","stage":"customer_ingest","correlationId":"customer-created:e501ae88c2415af03723dc1e"}
{"ts":"2025-12-02T06:13:32.394Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"fb761e37-7b5e-4018-a5e0-c8850b8afb81","stage":"payment","correlationId":"payment-updated:35df824abec594163bd58f0a","attempts":1}
üí∞ Processing payment completion for customer: 853SMKGAWCW44FNR7MZ23FZBH8
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Anastasia S
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Anastasia S, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Anastasia S
   - Email: thisisnotmypost@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: 853SMKGAWCW44FNR7MZ23FZBH8
{"ts":"2025-12-02T06:13:32.703Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"fb761e37-7b5e-4018-a5e0-c8850b8afb81","stage":"payment","correlationId":"payment-updated:35df824abec594163bd58f0a"}
{"ts":"2025-12-02T06:13:32.902Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"7258e109-7300-4d83-a574-89eb6260c389","stage":"payment","correlationId":"payment-updated:8476ca50c3e65c874126211a","attempts":1}
üí∞ Processing payment completion for customer: 853SMKGAWCW44FNR7MZ23FZBH8
   Payment source_type: CARD
   Payment tender_types: []
Customer 853SMKGAWCW44FNR7MZ23FZBH8 already completed first payment
{"ts":"2025-12-02T06:13:33.040Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"7258e109-7300-4d83-a574-89eb6260c389","stage":"payment","correlationId":"payment-updated:8476ca50c3e65c874126211a"}
{"ts":"2025-12-02T06:13:33.197Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"8b39f6c1-1c4d-48ca-93b6-54d0bfc9ff7f","stage":"booking","correlationId":"booking-created:eb85c4a55b2851fc8b9f3145","attempts":1}
üìÖ Processing booking created for customer: TV2AY3B5SV44WQR4092FQA02Q8
Full booking data: {
  "id": "aebl34dkb02u7f",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-05T23:10:00Z",
  "created_at": "2025-12-02T03:35:44Z",
  "updated_at": "2025-12-02T03:35:44Z",
  "customer_id": "TV2AY3B5SV44WQR4092FQA02Q8",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "TV2AY3B5SV44WQR4092FQA02Q8",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TM-zXe9fXe4axYWn",
      "any_team_member": true,
      "duration_minutes": 140,
      "intermission_minutes": 0,
      "service_variation_id": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "CJI5WHOAKSFTASYPJ4MSYZLS"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Amanda Sweeney
üéâ First booking detected for customer: TV2AY3B5SV44WQR4092FQA02Q8
   Name: Amanda Sweeney
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer TV2AY3B5SV44WQR4092FQA02Q8...
Error getting custom attributes for customer TV2AY3B5SV44WQR4092FQA02Q8: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: TV2AY3B5SV44WQR4092FQA02Q8
{"ts":"2025-12-02T06:13:33.584Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"8b39f6c1-1c4d-48ca-93b6-54d0bfc9ff7f","stage":"booking","correlationId":"booking-created:eb85c4a55b2851fc8b9f3145"}
{"ts":"2025-12-02T06:13:33.740Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"c189d15d-269e-41d4-a670-935558252afb","stage":"payment","correlationId":"payment-updated:c8d7935013cc663176080183","attempts":1}
üí∞ Processing payment completion for customer: CCKWK1FXC28402DMD5MS1A45JM
   Payment source_type: CARD
   Payment tender_types: []
Customer CCKWK1FXC28402DMD5MS1A45JM already completed first payment
{"ts":"2025-12-02T06:13:33.884Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"c189d15d-269e-41d4-a670-935558252afb","stage":"payment","correlationId":"payment-updated:c8d7935013cc663176080183"}
{"ts":"2025-12-02T06:13:34.039Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"9dcb69d7-1571-4381-b912-7179e94a6cdf","stage":"payment","correlationId":"payment-updated:84003371e7d8bf1f9097c6b0","attempts":1}
üí∞ Processing payment completion for customer: CCKWK1FXC28402DMD5MS1A45JM
   Payment source_type: CARD
   Payment tender_types: []
Customer CCKWK1FXC28402DMD5MS1A45JM already completed first payment
{"ts":"2025-12-02T06:13:34.207Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"9dcb69d7-1571-4381-b912-7179e94a6cdf","stage":"payment","correlationId":"payment-updated:84003371e7d8bf1f9097c6b0"}
{"ts":"2025-12-02T06:13:34.363Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"b6bf8db8-dc78-4253-9d91-1e0f0c2edb4a","stage":"booking","correlationId":"booking-created:4e7f9f6497b2e31e0e9bca8e","attempts":1}
üìÖ Processing booking created for customer: 3HS2JX1W5VSDVDDSYYB788SP2W
Full booking data: {
  "id": "lfdmmf6sdz5zsn",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-29T21:45:00Z",
  "created_at": "2025-12-02T04:13:19Z",
  "updated_at": "2025-12-02T04:13:19Z",
  "customer_id": "3HS2JX1W5VSDVDDSYYB788SP2W",
  "location_id": "LNQKVBTQZN3EZ",
  "customer_note": "Hello - I‚Äôd like to do the manicure and pedicure at the same time if possible. Thank you!",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "3HS2JX1W5VSDVDDSYYB788SP2W",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "resource_ids": [
        "5OVIQ6GSSUXORACP6T7WBAQ7"
      ],
      "team_member_id": "TMgsjtuk5cfKnstq",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "ZEAKNB35I37RMXNUBGWDZQIM",
      "service_variation_version": 1760895536505,
      "service_variation_client_id": "ZEAKNB35I37RMXNUBGWDZQIM"
    },
    {
      "team_member_id": "TMgsjtuk5cfKnstq",
      "any_team_member": false,
      "duration_minutes": 110,
      "intermission_minutes": 0,
      "service_variation_id": "6TYOE67IDYTKHW2ZG6HKVZER",
      "service_variation_version": 1764609577793,
      "service_variation_client_id": "6TYOE67IDYTKHW2ZG6HKVZER"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Megan Nishikawa
‚ÑπÔ∏è Customer 3HS2JX1W5VSDVDDSYYB788SP2W already received signup bonus, not first booking
{"ts":"2025-12-02T06:13:34.503Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"b6bf8db8-dc78-4253-9d91-1e0f0c2edb4a","stage":"booking","correlationId":"booking-created:4e7f9f6497b2e31e0e9bca8e"}
{"ts":"2025-12-02T06:13:34.659Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"59301141-f8e7-42f4-a012-f6d37c21e1f0","stage":"booking","correlationId":"booking-created:2c8f525f83a5b6e0f2cba3a7","attempts":1}
üìÖ Processing booking created for customer: MPSGG656AA11NZB460A30HEYXM
Full booking data: {
  "id": "7pznwic9yismia",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-16T17:00:00Z",
  "created_at": "2025-12-02T04:24:09Z",
  "updated_at": "2025-12-02T04:24:09Z",
  "customer_id": "MPSGG656AA11NZB460A30HEYXM",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "MPSGG656AA11NZB460A30HEYXM",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMyUMvTJIj2HrHSg",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "JMTK5M2CY2W7WEXSTAJKAJ35",
      "service_variation_version": 1764609577793,
      "service_variation_client_id": "JMTK5M2CY2W7WEXSTAJKAJ35"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Stephanie Stillman Stephens
üéâ First booking detected for customer: MPSGG656AA11NZB460A30HEYXM
   Name: Stephanie Stillman Stephens
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer MPSGG656AA11NZB460A30HEYXM...
Error getting custom attributes for customer MPSGG656AA11NZB460A30HEYXM: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: MPSGG656AA11NZB460A30HEYXM
{"ts":"2025-12-02T06:13:35.028Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"59301141-f8e7-42f4-a012-f6d37c21e1f0","stage":"booking","correlationId":"booking-created:2c8f525f83a5b6e0f2cba3a7"}
{"ts":"2025-12-02T06:13:35.183Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"f071fdfd-a23b-4910-8d62-495f04a2d42c","stage":"booking","correlationId":"booking-created:4a221933017a2881310494cd","attempts":1}
üìÖ Processing booking created for customer: TV2AY3B5SV44WQR4092FQA02Q8
Full booking data: {
  "id": "xefkx4pf2f656q",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-05T20:50:00Z",
  "created_at": "2025-12-02T04:26:33Z",
  "updated_at": "2025-12-02T04:26:33Z",
  "customer_id": "TV2AY3B5SV44WQR4092FQA02Q8",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "TV2AY3B5SV44WQR4092FQA02Q8",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TM-zXe9fXe4axYWn",
      "any_team_member": true,
      "duration_minutes": 140,
      "intermission_minutes": 0,
      "service_variation_id": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "CJI5WHOAKSFTASYPJ4MSYZLS"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Amanda Sweeney
üéâ First booking detected for customer: TV2AY3B5SV44WQR4092FQA02Q8
   Name: Amanda Sweeney
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer TV2AY3B5SV44WQR4092FQA02Q8...
Error getting custom attributes for customer TV2AY3B5SV44WQR4092FQA02Q8: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: TV2AY3B5SV44WQR4092FQA02Q8
{"ts":"2025-12-02T06:13:35.557Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"f071fdfd-a23b-4910-8d62-495f04a2d42c","stage":"booking","correlationId":"booking-created:4a221933017a2881310494cd"}
{"ts":"2025-12-02T06:13:35.715Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"07879100-2f18-4563-8a5e-befdbd5092e6","stage":"booking","correlationId":"booking-created:de7546e651e9d8dde99e6ee0","attempts":1}
üìÖ Processing booking created for customer: 7S4651HE2QM90N125NSADV3FG4
Full booking data: {
  "id": "gbt0fnjd4vpfcq",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-07T22:40:00Z",
  "created_at": "2025-12-02T04:35:28Z",
  "updated_at": "2025-12-02T04:35:28Z",
  "customer_id": "7S4651HE2QM90N125NSADV3FG4",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "7S4651HE2QM90N125NSADV3FG4",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMSt73bSp59caRzt",
      "any_team_member": true,
      "duration_minutes": 140,
      "intermission_minutes": 0,
      "service_variation_id": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "CJI5WHOAKSFTASYPJ4MSYZLS"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Sophie Chen
üéâ First booking detected for customer: 7S4651HE2QM90N125NSADV3FG4
   Name: Sophie Chen
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 7S4651HE2QM90N125NSADV3FG4...
Error getting custom attributes for customer 7S4651HE2QM90N125NSADV3FG4: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 7S4651HE2QM90N125NSADV3FG4
{"ts":"2025-12-02T06:13:36.087Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"07879100-2f18-4563-8a5e-befdbd5092e6","stage":"booking","correlationId":"booking-created:de7546e651e9d8dde99e6ee0"}
{"ts":"2025-12-02T06:13:36.245Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"0429d521-0c33-45d6-a323-3384529415db","stage":"booking","correlationId":"booking-created:63ca1c3a24e3b94055e2e1d8","attempts":1}
üìÖ Processing booking created for customer: 7S9N41PHKD1DEGK4J4DMVR6134
Full booking data: {
  "id": "c75y8ui9udbjd9",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-30T20:45:00Z",
  "created_at": "2025-12-02T04:54:40Z",
  "updated_at": "2025-12-02T04:54:40Z",
  "customer_id": "7S9N41PHKD1DEGK4J4DMVR6134",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "7S9N41PHKD1DEGK4J4DMVR6134",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMILsQUVwLkLzbVo",
      "any_team_member": false,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "HXLBKQC3DRE57DB7IK5RBYOB",
      "service_variation_version": 1758654327496,
      "service_variation_client_id": "HXLBKQC3DRE57DB7IK5RBYOB"
    },
    {
      "team_member_id": "TMILsQUVwLkLzbVo",
      "any_team_member": false,
      "duration_minutes": 45,
      "intermission_minutes": 0,
      "service_variation_id": "XVYD33PWUOIDOBJYERR7FNXT",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "XVYD33PWUOIDOBJYERR7FNXT"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Niloofar Mahmoodian
üéâ First booking detected for customer: 7S9N41PHKD1DEGK4J4DMVR6134
   Name: Niloofar Mahmoodian
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 7S9N41PHKD1DEGK4J4DMVR6134...
Error getting custom attributes for customer 7S9N41PHKD1DEGK4J4DMVR6134: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 7S9N41PHKD1DEGK4J4DMVR6134
{"ts":"2025-12-02T06:13:36.621Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"0429d521-0c33-45d6-a323-3384529415db","stage":"booking","correlationId":"booking-created:63ca1c3a24e3b94055e2e1d8"}
{"ts":"2025-12-02T06:13:36.780Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"521bfd68-6e1a-491c-9689-0b8a4bb025fc","stage":"booking","correlationId":"booking-created:5a11189aa54f4f9f326f8b9e","attempts":1}
üìÖ Processing booking created for customer: 5CFF6X8E5AT762BA9QP7KSM8QG
Full booking data: {
  "id": "3mcwuy1qt1se0c",
  "source": "THIRD_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-06T22:50:00Z",
  "created_at": "2025-12-02T05:13:54Z",
  "updated_at": "2025-12-02T05:13:54Z",
  "customer_id": "5CFF6X8E5AT762BA9QP7KSM8QG",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "5CFF6X8E5AT762BA9QP7KSM8QG",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMOscywuGXO2VURY",
      "any_team_member": true,
      "duration_minutes": 140,
      "intermission_minutes": 0,
      "service_variation_id": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "CJI5WHOAKSFTASYPJ4MSYZLS"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Mikelly Benedict
üéâ First booking detected for customer: 5CFF6X8E5AT762BA9QP7KSM8QG
   Name: Mikelly Benedict
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 5CFF6X8E5AT762BA9QP7KSM8QG...
Error getting custom attributes for customer 5CFF6X8E5AT762BA9QP7KSM8QG: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 5CFF6X8E5AT762BA9QP7KSM8QG
{"ts":"2025-12-02T06:13:37.157Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"521bfd68-6e1a-491c-9689-0b8a4bb025fc","stage":"booking","correlationId":"booking-created:5a11189aa54f4f9f326f8b9e"}
{"ts":"2025-12-02T06:13:37.315Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"fc68db6b-ddaa-46a8-b639-f710ec2d6111","stage":"booking","correlationId":"booking-created:0c3d6274efab25a8a3cb3b13","attempts":1}
üìÖ Processing booking created for customer: RZCYD3W904QGWTQX6C521PBH94
Full booking data: {
  "id": "tg4r5xhu1s9iay",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-02T22:50:00Z",
  "created_at": "2025-12-02T05:38:40Z",
  "updated_at": "2025-12-02T05:38:40Z",
  "customer_id": "RZCYD3W904QGWTQX6C521PBH94",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "RZCYD3W904QGWTQX6C521PBH94",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMVwAQUdLz6no-cB",
      "any_team_member": false,
      "duration_minutes": 100,
      "intermission_minutes": 0,
      "service_variation_id": "GSZZR45VJXB44NF4P4WXI5NB",
      "service_variation_version": 1764609577793,
      "service_variation_client_id": "GSZZR45VJXB44NF4P4WXI5NB"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 0 customer(s) in database
‚ÑπÔ∏è Customer RZCYD3W904QGWTQX6C521PBH94 not in database yet - need to add them first
‚ùå Error fetching/adding customer from Square: Response status code was not ok: 401.
{"ts":"2025-12-02T06:13:37.742Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"fc68db6b-ddaa-46a8-b639-f710ec2d6111","stage":"booking","correlationId":"booking-created:0c3d6274efab25a8a3cb3b13"}
{"ts":"2025-12-02T06:13:37.894Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"d2879c64-e65e-41ec-a124-b917a7e9f197","stage":"customer_ingest","correlationId":"customer-created:c9c5906a557d00fae4163fd4","attempts":1}
üì• Received customer data: {
  "id": "RZCYD3W904QGWTQX6C521PBH94",
  "address": {
    "country": "US"
  },
  "version": 0,
  "group_ids": [
    "LT4ZHFBQQYB2N.APPOINTMENTS"
  ],
  "created_at": "2025-12-02T05:38:38.381Z",
  "given_name": "Lisa",
  "updated_at": "2025-12-02T05:38:38Z",
  "family_name": "Glv",
  "preferences": {
    "email_unsubscribed": false
  },
  "phone_number": "+13473490149",
  "email_address": "lisaglv31@gmail.com",
  "creation_source": "APPOINTMENTS"
}
üë§ Processing customer creation: RZCYD3W904QGWTQX6C521PBH94
üìç IP Address: unknown
üìß Email: lisaglv31@gmail.com
üìû Phone: +13473490149
üë§ Name: Lisa Glv
‚ö†Ô∏è Suspicious IP activity detected: unknown used by 127 customers
‚ö†Ô∏è Suspicious activity detected for customer RZCYD3W904QGWTQX6C521PBH94, flagging for review
üéâ New customer detected: RZCYD3W904QGWTQX6C521PBH94
‚úÖ Customer added to database as NEW (temporary mark)
   - Will check for referral code when they book
   - Will give gift card on first booking if code found
‚úÖ Verification: Customer found in DB: true
{"ts":"2025-12-02T06:13:38.168Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"d2879c64-e65e-41ec-a124-b917a7e9f197","stage":"customer_ingest","correlationId":"customer-created:c9c5906a557d00fae4163fd4"}
{"ts":"2025-12-02T06:13:38.323Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"69c2a031-6687-44fa-bcd7-4b5ed3c4a03d","stage":"booking","correlationId":"booking-created:f0264ab107199a5c311c7e2e","attempts":1}
üìÖ Processing booking created for customer: 8QZMQK99PZH7D9DBY4KM639NGM
Full booking data: {
  "id": "07w90ovpomp911",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-03T18:00:00Z",
  "created_at": "2025-12-02T05:57:44Z",
  "updated_at": "2025-12-02T05:57:44Z",
  "customer_id": "8QZMQK99PZH7D9DBY4KM639NGM",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "8QZMQK99PZH7D9DBY4KM639NGM",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMMCVDJoKh3ZkfFo",
      "any_team_member": true,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1764609601083,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    },
    {
      "resource_ids": [
        "F2MBRCC42VNNDWXNA3PAMHEU"
      ],
      "team_member_id": "TMMCVDJoKh3ZkfFo",
      "any_team_member": true,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "ZEAKNB35I37RMXNUBGWDZQIM",
      "service_variation_version": 1760895536505,
      "service_variation_client_id": "ZEAKNB35I37RMXNUBGWDZQIM"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Cauteaux Vrakelos
üéâ First booking detected for customer: 8QZMQK99PZH7D9DBY4KM639NGM
   Name: Cauteaux Vrakelos
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 8QZMQK99PZH7D9DBY4KM639NGM...
Error getting custom attributes for customer 8QZMQK99PZH7D9DBY4KM639NGM: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 8QZMQK99PZH7D9DBY4KM639NGM
{"ts":"2025-12-02T06:13:38.706Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"69c2a031-6687-44fa-bcd7-4b5ed3c4a03d","stage":"booking","correlationId":"booking-created:f0264ab107199a5c311c7e2e"}
{"ts":"2025-12-02T06:48:05.144Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"7a105cfd-62d4-4ee2-955d-10c940b52111","stage":"booking","correlationId":"booking-created:a0de1ada64a70b20c8ae4c55","attempts":1}
üìÖ Processing booking created for customer: BA5GJ3M96XMN78CBB9F08BJG2R
Full booking data: {
  "id": "ctq13m3o8z2v8z",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-17T21:50:00Z",
  "created_at": "2025-12-02T06:48:01Z",
  "updated_at": "2025-12-02T06:48:01Z",
  "customer_id": "BA5GJ3M96XMN78CBB9F08BJG2R",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "BA5GJ3M96XMN78CBB9F08BJG2R",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMgsjtuk5cfKnstq",
      "any_team_member": false,
      "duration_minutes": 110,
      "intermission_minutes": 0,
      "service_variation_id": "6TYOE67IDYTKHW2ZG6HKVZER",
      "service_variation_version": 1764609577793,
      "service_variation_client_id": "6TYOE67IDYTKHW2ZG6HKVZER"
    },
    {
      "team_member_id": "TMgsjtuk5cfKnstq",
      "any_team_member": false,
      "duration_minutes": 20,
      "intermission_minutes": 0,
      "service_variation_id": "HAJX45W3U2WUCCXM5MI24UEE",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "HAJX45W3U2WUCCXM5MI24UEE"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Zelda Iriboz
üéâ First booking detected for customer: BA5GJ3M96XMN78CBB9F08BJG2R
   Name: Zelda Iriboz
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer BA5GJ3M96XMN78CBB9F08BJG2R...
Error getting custom attributes for customer BA5GJ3M96XMN78CBB9F08BJG2R: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: BA5GJ3M96XMN78CBB9F08BJG2R
{"ts":"2025-12-02T06:48:05.867Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"7a105cfd-62d4-4ee2-955d-10c940b52111","stage":"booking","correlationId":"booking-created:a0de1ada64a70b20c8ae4c55"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-12-02T07:33:54.200Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"95629f8c-b4ab-4608-94d1-c1b8ee03dee5","stage":"payment","correlationId":"payment-updated:c88ed765c8f6846b49fce5f6","attempts":1}
No customer ID in payment data, skipping...
Payment data received: {
  "id": "rH1W047IaAeMDvAforLj6KSWu0PZY",
  "status": "COMPLETED",
  "version": 3,
  "order_id": "fLX1lqcZeo8N9BKcAAfrHXcFaBUZY",
  "created_at": "2025-12-02T07:33:50.274Z",
  "updated_at": "2025-12-02T07:33:51.882Z",
  "location_id": "LT4ZHFBQQYB2N",
  "receipt_url": "https://squareup.com/receipt/preview/rH1W047IaAeMDvAforLj6KSWu0PZY",
  "source_type": "CARD",
  "total_money": {
    "amount": 28000,
    "currency": "USD"
  },
  "amount_money": {
    "amount": 28000,
    "currency": "USD"
  },
  "card_details": {
    "card": {
      "bin": "515518",
      "last_4": "6182",
      "exp_year": 2028,
      "card_type": "CREDIT",
      "exp_month": 3,
      "card_brand": "MASTERCARD",
      "fingerprint": "sq-1-9oTv0y_OZrDihw0_hkMDTwqQ1-T5meDYINr570hkztuuyU59V5hjLqlP9mOXizi4jg",
      "prepaid_type": "NOT_PREPAID",
      "payment_account_reference": "50018FL0H2WIGT2DVMG9EKWTWL19M"
    },
    "status": "CAPTURED",
    "avs_status": "AVS_REJECTED",
    "cvv_status": "CVV_NOT_CHECKED",
    "entry_method": "KEYED",
    "auth_result_code": "00216Z",
    "card_payment_timeline": {
      "captured_at": "2025-12-02T07:33:51.079Z",
      "authorized_at": "2025-12-02T07:33:50.782Z"
    },
    "statement_description": "SQ *ZORINA NAIL STUDIO 2"
  },
  "delay_action": "CANCEL",
  "delayed_until": "2025-12-09T07:33:50.274Z",
  "approved_money": {
    "amount": 28000,
    "currency": "USD"
  },
  "delay_duration": "PT168H",
  "receipt_number": "rH1W",
  "billing_address": {
    "country": "US",
    "locality": "Long Beach",
    "last_name": "Pippen",
    "first_name": "Bailey",
    "postal_code": "90815",
    "address_line_1": "2032 Fidler Ave"
  },
  "risk_evaluation": {
    "created_at": "2025-12-02T07:33:50.971Z",
    "risk_level": "NORMAL"
  },
  "application_details": {
    "application_id": "sq0idp-LnQlDEBJrriD2F3rrhnmtg",
    "square_product": "OTHER"
  }
}
{"ts":"2025-12-02T07:33:54.410Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"95629f8c-b4ab-4608-94d1-c1b8ee03dee5","stage":"payment","correlationId":"payment-updated:c88ed765c8f6846b49fce5f6"}
{"ts":"2025-12-02T07:33:56.701Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"94ae41f3-e2e6-4acc-8e9f-6aed6cea3550","stage":"payment","correlationId":"payment-updated:414cee53df43b481a8452c41","attempts":1}
üí∞ Processing payment completion for customer: XTA6WFN33E8PDJ6W462ZJA21WG
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Bailey Pippen
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Bailey Pippen, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Bailey Pippen
   - Email: baileypippenx@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: XTA6WFN33E8PDJ6W462ZJA21WG
{"ts":"2025-12-02T07:33:57.204Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"94ae41f3-e2e6-4acc-8e9f-6aed6cea3550","stage":"payment","correlationId":"payment-updated:414cee53df43b481a8452c41"}
{"ts":"2025-12-02T07:33:59.497Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"6848342a-fa24-434a-8cb4-7183f4a3c671","stage":"payment","correlationId":"payment-updated:0bed017cf6816cef82504afd","attempts":1}
üí∞ Processing payment completion for customer: XTA6WFN33E8PDJ6W462ZJA21WG
   Payment source_type: CARD
   Payment tender_types: []
Customer XTA6WFN33E8PDJ6W462ZJA21WG already completed first payment
{"ts":"2025-12-02T07:33:59.632Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"6848342a-fa24-434a-8cb4-7183f4a3c671","stage":"payment","correlationId":"payment-updated:0bed017cf6816cef82504afd"}
{"ts":"2025-12-02T07:35:56.962Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"e6dd1ad4-87a9-4ae8-b55b-e471c8306b0d","stage":"payment","correlationId":"payment-updated:4c92c84fcc654034084b2eb9","attempts":1}
üí∞ Processing payment completion for customer: XTA6WFN33E8PDJ6W462ZJA21WG
   Payment source_type: CARD
   Payment tender_types: []
Customer XTA6WFN33E8PDJ6W462ZJA21WG already completed first payment
{"ts":"2025-12-02T07:35:57.318Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"e6dd1ad4-87a9-4ae8-b55b-e471c8306b0d","stage":"payment","correlationId":"payment-updated:4c92c84fcc654034084b2eb9"}
{"ts":"2025-12-02T09:06:46.006Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Server has closed the connection.","stack":"PrismaClientKnownRequestError: Server has closed the connection.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`

Please make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.
{"ts":"2025-12-02T09:06:55.033Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:06:59.041Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:07:03.047Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:07:07.052Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:07:11.057Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:07:15.064Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:07:19.070Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:07:23.075Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:07:27.080Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:07:31.086Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:07:35.095Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:07:39.113Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:07:43.125Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:07:47.133Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`

Please make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.
{"ts":"2025-12-02T09:07:56.144Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:08:00.149Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:08:04.156Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:08:08.162Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:08:12.169Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:08:16.174Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:08:20.181Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:08:24.187Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:08:28.191Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:08:32.197Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:08:36.204Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:08:40.210Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:08:44.215Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:08:48.221Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`

Please make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.
{"ts":"2025-12-02T09:08:57.235Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:09:01.240Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:09:05.248Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:09:09.255Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:09:13.261Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:09:17.269Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:09:21.274Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:09:25.280Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:09:29.286Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:09:33.292Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:09:37.299Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:09:41.332Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:09:45.338Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:09:49.344Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`

Please make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.
{"ts":"2025-12-02T09:09:58.356Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:10:02.362Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:10:06.370Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:10:10.378Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:10:14.384Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:10:18.390Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:10:22.395Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:10:26.401Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:10:30.407Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:10:34.411Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:10:38.415Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:10:42.426Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:10:46.433Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:10:50.440Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`

Please make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.
{"ts":"2025-12-02T09:10:59.452Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:11:03.459Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:11:07.465Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:11:11.470Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:11:15.476Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:11:19.482Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:11:23.488Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:11:27.496Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:11:31.502Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:11:35.508Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:11:39.516Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:11:43.533Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:11:47.540Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:11:51.547Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`

Please make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.
{"ts":"2025-12-02T09:12:00.558Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:12:04.565Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:12:08.571Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:12:12.577Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:12:16.583Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:12:20.588Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:12:24.594Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:12:28.600Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:12:32.606Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:12:36.612Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:12:40.620Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:12:44.631Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:12:48.637Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:12:52.643Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`

Please make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.
{"ts":"2025-12-02T09:13:01.657Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:13:05.663Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:13:09.669Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:13:13.675Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:13:17.683Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:13:21.686Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:13:25.693Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:13:29.697Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:13:33.704Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:13:37.710Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:13:41.719Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:13:45.727Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:13:49.734Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:13:53.740Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`

Please make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.
{"ts":"2025-12-02T09:14:02.753Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:14:06.758Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:14:10.764Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:14:14.770Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:14:18.776Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:14:22.782Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:14:26.787Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:14:30.792Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:14:34.798Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:14:38.807Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:14:42.817Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:14:46.826Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:14:50.831Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:14:54.838Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`

Please make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.
{"ts":"2025-12-02T09:15:03.853Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:15:07.857Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:15:11.862Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:15:15.869Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:15:19.875Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:15:23.882Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:15:27.889Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:15:31.895Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:15:35.902Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:15:39.939Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:15:44.003Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T09:53:56.474Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"404b64a0-e323-4077-a398-a52d716d592a","stage":"booking","correlationId":"booking-created:974173f8b062c6a3d8feef8a","attempts":1}
üìÖ Processing booking created for customer: E5ZQZ7E7RHZKRW11G2HAVCN60M
Full booking data: {
  "id": "5te189q419i7yg",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-23T21:00:00Z",
  "created_at": "2025-12-02T09:53:54Z",
  "updated_at": "2025-12-02T09:53:54Z",
  "customer_id": "E5ZQZ7E7RHZKRW11G2HAVCN60M",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "E5ZQZ7E7RHZKRW11G2HAVCN60M",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TM9jDlRr_Hl4rdBB",
      "any_team_member": true,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "HXLBKQC3DRE57DB7IK5RBYOB",
      "service_variation_version": 1758654327496,
      "service_variation_client_id": "HXLBKQC3DRE57DB7IK5RBYOB"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Angelina Yilmaz
üéâ First booking detected for customer: E5ZQZ7E7RHZKRW11G2HAVCN60M
   Name: Angelina Yilmaz
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer E5ZQZ7E7RHZKRW11G2HAVCN60M...
Error getting custom attributes for customer E5ZQZ7E7RHZKRW11G2HAVCN60M: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: E5ZQZ7E7RHZKRW11G2HAVCN60M
{"ts":"2025-12-02T09:53:57.190Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"404b64a0-e323-4077-a398-a52d716d592a","stage":"booking","correlationId":"booking-created:974173f8b062c6a3d8feef8a"}
{"ts":"2025-12-02T09:55:40.993Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"ab64dfdc-4ee6-4d71-a3fc-28dd300fdcc3","stage":"booking","correlationId":"booking-created:66f95ead6d29c5f3cedc1bf3","attempts":1}
üìÖ Processing booking created for customer: E5ZQZ7E7RHZKRW11G2HAVCN60M
Full booking data: {
  "id": "eahus3r01km1yu",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-23T20:20:00Z",
  "created_at": "2025-12-02T09:55:37Z",
  "updated_at": "2025-12-02T09:55:37Z",
  "customer_id": "E5ZQZ7E7RHZKRW11G2HAVCN60M",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "E5ZQZ7E7RHZKRW11G2HAVCN60M",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "resource_ids": [
        "KAOXILA4CV7A23VRAACC4R66"
      ],
      "team_member_id": "TM7_r-KmvY9xjnEU",
      "any_team_member": true,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "ZEAKNB35I37RMXNUBGWDZQIM",
      "service_variation_version": 1760895536505,
      "service_variation_client_id": "ZEAKNB35I37RMXNUBGWDZQIM"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Angelina Yilmaz
üéâ First booking detected for customer: E5ZQZ7E7RHZKRW11G2HAVCN60M
   Name: Angelina Yilmaz
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer E5ZQZ7E7RHZKRW11G2HAVCN60M...
Error getting custom attributes for customer E5ZQZ7E7RHZKRW11G2HAVCN60M: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: E5ZQZ7E7RHZKRW11G2HAVCN60M
{"ts":"2025-12-02T09:55:42.098Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"ab64dfdc-4ee6-4d71-a3fc-28dd300fdcc3","stage":"booking","correlationId":"booking-created:66f95ead6d29c5f3cedc1bf3"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-12-02T13:57:32.401Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"f3c074fe-e3a5-46d1-b46b-af8664efe488","stage":"booking","correlationId":"booking-created:5147920b3256ece9496349d4","attempts":1}
üìÖ Processing booking created for customer: NAFKKP8RNNGTQGACDTR1PQGQ2R
Full booking data: {
  "id": "tzbra0rpqr2c15",
  "source": "THIRD_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-11T21:20:00Z",
  "created_at": "2025-12-02T13:57:29Z",
  "updated_at": "2025-12-02T13:57:29Z",
  "customer_id": "NAFKKP8RNNGTQGACDTR1PQGQ2R",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "NAFKKP8RNNGTQGACDTR1PQGQ2R",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMEWAZHdtaiRR_Zs",
      "any_team_member": true,
      "duration_minutes": 30,
      "intermission_minutes": 0,
      "service_variation_id": "JNRUKPGA2ZZUFCEB6YPNDC2Y",
      "service_variation_version": 1760895536505,
      "service_variation_client_id": "JNRUKPGA2ZZUFCEB6YPNDC2Y"
    },
    {
      "team_member_id": "TMEWAZHdtaiRR_Zs",
      "any_team_member": true,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1764609601083,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Katia Plascencia
üéâ First booking detected for customer: NAFKKP8RNNGTQGACDTR1PQGQ2R
   Name: Katia Plascencia
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer NAFKKP8RNNGTQGACDTR1PQGQ2R...
Error getting custom attributes for customer NAFKKP8RNNGTQGACDTR1PQGQ2R: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: NAFKKP8RNNGTQGACDTR1PQGQ2R
{"ts":"2025-12-02T13:57:33.137Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"f3c074fe-e3a5-46d1-b46b-af8664efe488","stage":"booking","correlationId":"booking-created:5147920b3256ece9496349d4"}
{"ts":"2025-12-02T15:30:36.365Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"c0700a05-3948-4aa5-968c-41e0f50d595b","stage":"booking","correlationId":"booking-created:49b8999bc6e91d4fa3a68bdd","attempts":1}
üìÖ Processing booking created for customer: NAFKKP8RNNGTQGACDTR1PQGQ2R
Full booking data: {
  "id": "064vwf1h274x61",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-11T19:50:00Z",
  "created_at": "2025-12-02T15:30:31Z",
  "updated_at": "2025-12-02T15:30:31Z",
  "customer_id": "NAFKKP8RNNGTQGACDTR1PQGQ2R",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "NAFKKP8RNNGTQGACDTR1PQGQ2R",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMSt73bSp59caRzt",
      "any_team_member": true,
      "duration_minutes": 30,
      "intermission_minutes": 0,
      "service_variation_id": "JNRUKPGA2ZZUFCEB6YPNDC2Y",
      "service_variation_version": 1760895536505,
      "service_variation_client_id": "JNRUKPGA2ZZUFCEB6YPNDC2Y"
    },
    {
      "team_member_id": "TMSt73bSp59caRzt",
      "any_team_member": true,
      "duration_minutes": 140,
      "intermission_minutes": 0,
      "service_variation_id": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "CJI5WHOAKSFTASYPJ4MSYZLS"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Katia Plascencia
üéâ First booking detected for customer: NAFKKP8RNNGTQGACDTR1PQGQ2R
   Name: Katia Plascencia
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer NAFKKP8RNNGTQGACDTR1PQGQ2R...
Error getting custom attributes for customer NAFKKP8RNNGTQGACDTR1PQGQ2R: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: NAFKKP8RNNGTQGACDTR1PQGQ2R
{"ts":"2025-12-02T15:30:37.043Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"c0700a05-3948-4aa5-968c-41e0f50d595b","stage":"booking","correlationId":"booking-created:49b8999bc6e91d4fa3a68bdd"}
{"ts":"2025-12-02T16:50:38.496Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"407ce1ba-c9d7-48cc-b6b0-c7d4ea242795","stage":"booking","correlationId":"booking-created:0fc3ea1e237d0d846d74deb8","attempts":1}
üìÖ Processing booking created for customer: AEJPXQTTHARHTWRBEGAR84XZ8C
Full booking data: {
  "id": "yxyspjyo8ckvzi",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-13T19:30:00Z",
  "created_at": "2025-12-02T16:50:36Z",
  "updated_at": "2025-12-02T16:50:36Z",
  "customer_id": "AEJPXQTTHARHTWRBEGAR84XZ8C",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "AEJPXQTTHARHTWRBEGAR84XZ8C",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMVwAQUdLz6no-cB",
      "any_team_member": false,
      "duration_minutes": 100,
      "intermission_minutes": 0,
      "service_variation_id": "GSZZR45VJXB44NF4P4WXI5NB",
      "service_variation_version": 1764609577793,
      "service_variation_client_id": "GSZZR45VJXB44NF4P4WXI5NB"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Shannnon Gray
üéâ First booking detected for customer: AEJPXQTTHARHTWRBEGAR84XZ8C
   Name: Shannnon Gray
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer AEJPXQTTHARHTWRBEGAR84XZ8C...
Error getting custom attributes for customer AEJPXQTTHARHTWRBEGAR84XZ8C: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: AEJPXQTTHARHTWRBEGAR84XZ8C
{"ts":"2025-12-02T16:50:39.173Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"407ce1ba-c9d7-48cc-b6b0-c7d4ea242795","stage":"booking","correlationId":"booking-created:0fc3ea1e237d0d846d74deb8"}
{"ts":"2025-12-02T17:25:14.389Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"dfc2abf1-35ba-4042-9e63-ecdeafc35070","stage":"booking","correlationId":"booking-created:1e27580e2f847cf83a6d0240","attempts":1}
üìÖ Processing booking created for customer: 78YQ6M27BS23SC2GG12YH7XTSC
Full booking data: {
  "id": "vuhu7n6nq0nmvg",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-11T17:00:00Z",
  "created_at": "2025-12-02T17:25:11Z",
  "updated_at": "2025-12-02T17:25:11Z",
  "customer_id": "78YQ6M27BS23SC2GG12YH7XTSC",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "78YQ6M27BS23SC2GG12YH7XTSC",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMMHlgFBIFbMTRap",
      "any_team_member": false,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1764609601083,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Khanh Cagley
üéâ First booking detected for customer: 78YQ6M27BS23SC2GG12YH7XTSC
   Name: Khanh Cagley
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 78YQ6M27BS23SC2GG12YH7XTSC...
Error getting custom attributes for customer 78YQ6M27BS23SC2GG12YH7XTSC: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 78YQ6M27BS23SC2GG12YH7XTSC
{"ts":"2025-12-02T17:25:15.788Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"dfc2abf1-35ba-4042-9e63-ecdeafc35070","stage":"booking","correlationId":"booking-created:1e27580e2f847cf83a6d0240"}
{"ts":"2025-12-02T17:35:21.939Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"7f1e3db8-dc9a-4ac1-a065-f69016eff681","stage":"booking","correlationId":"booking-created:ae45c09345e9960993fa643b","attempts":1}
üìÖ Processing booking created for customer: J3F8Z4VQPY70DDXFHFDB98CCZ4
Full booking data: {
  "id": "rt7hkhhl00mpp1",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-09T20:00:00Z",
  "created_at": "2025-12-02T17:35:16Z",
  "updated_at": "2025-12-02T17:35:16Z",
  "customer_id": "J3F8Z4VQPY70DDXFHFDB98CCZ4",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMQPbDVvvOCLwqsy"
  },
  "appointment_segments": [
    {
      "resource_ids": [
        "VNDFB5HCSMOPZDVJ2ML6QOIJ"
      ],
      "team_member_id": "TM9jDlRr_Hl4rdBB",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "ZEAKNB35I37RMXNUBGWDZQIM",
      "service_variation_version": 1760895536505,
      "service_variation_client_id": "ZEAKNB35I37RMXNUBGWDZQIM"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Sheena Ferrari
üéâ First booking detected for customer: J3F8Z4VQPY70DDXFHFDB98CCZ4
   Name: Sheena Ferrari
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer J3F8Z4VQPY70DDXFHFDB98CCZ4...
Error getting custom attributes for customer J3F8Z4VQPY70DDXFHFDB98CCZ4: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: J3F8Z4VQPY70DDXFHFDB98CCZ4
{"ts":"2025-12-02T17:35:22.631Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"7f1e3db8-dc9a-4ac1-a065-f69016eff681","stage":"booking","correlationId":"booking-created:ae45c09345e9960993fa643b"}
{"ts":"2025-12-02T17:42:37.733Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"38df0f5f-8f8b-498f-88e3-9156816c1c19","stage":"booking","correlationId":"booking-created:ca5a4e30f8d1f6da4fd6c2bc","attempts":1}
üìÖ Processing booking created for customer: 9VT9PGM9VAEAVJ2B0QCYHJC8R0
Full booking data: {
  "id": "6rnbgzkz38bmyk",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-30T01:00:00Z",
  "created_at": "2025-12-02T17:42:35Z",
  "updated_at": "2025-12-02T17:42:35Z",
  "customer_id": "9VT9PGM9VAEAVJ2B0QCYHJC8R0",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMQPbDVvvOCLwqsy"
  },
  "appointment_segments": [
    {
      "team_member_id": "TM1L5yPC-yKx6CyO",
      "any_team_member": false,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "NCOIL6ZGDTCC7SO3IJHENCQ2",
      "service_variation_version": 1762893947284,
      "service_variation_client_id": "NCOIL6ZGDTCC7SO3IJHENCQ2"
    },
    {
      "team_member_id": "TM1L5yPC-yKx6CyO",
      "any_team_member": false,
      "duration_minutes": 10,
      "intermission_minutes": 0,
      "service_variation_id": "6F6F3OAFJSOEN3X7HSXYIVQC",
      "service_variation_version": 1760895536505,
      "service_variation_client_id": "WLFVHCXMEWOWRD7UWA5YHD4X"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Ellie Anvar
‚ÑπÔ∏è Customer 9VT9PGM9VAEAVJ2B0QCYHJC8R0 already received signup bonus, not first booking
{"ts":"2025-12-02T17:42:38.105Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"38df0f5f-8f8b-498f-88e3-9156816c1c19","stage":"booking","correlationId":"booking-created:ca5a4e30f8d1f6da4fd6c2bc"}
{"ts":"2025-12-02T18:13:28.166Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"b76a6460-8a6e-46aa-bb5c-48f6bb44e06a","stage":"booking","correlationId":"booking-created:edca906c5bdb3ac0d8670fa1","attempts":1}
üìÖ Processing booking created for customer: 83ZQHJNNF07J7E1RME84RXS1KG
Full booking data: {
  "id": "pgz85ncox0nwa4",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-11T00:00:00Z",
  "created_at": "2025-12-02T18:13:26Z",
  "updated_at": "2025-12-02T18:13:26Z",
  "customer_id": "83ZQHJNNF07J7E1RME84RXS1KG",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "83ZQHJNNF07J7E1RME84RXS1KG",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMXiw38Bbb7XQUWI",
      "any_team_member": true,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1764609601083,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Jenna Sexton
üéâ First booking detected for customer: 83ZQHJNNF07J7E1RME84RXS1KG
   Name: Jenna Sexton
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 83ZQHJNNF07J7E1RME84RXS1KG...
Error getting custom attributes for customer 83ZQHJNNF07J7E1RME84RXS1KG: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 83ZQHJNNF07J7E1RME84RXS1KG
{"ts":"2025-12-02T18:13:28.958Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"b76a6460-8a6e-46aa-bb5c-48f6bb44e06a","stage":"booking","correlationId":"booking-created:edca906c5bdb3ac0d8670fa1"}
{"ts":"2025-12-02T18:16:28.427Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"8b437cb5-8fd9-4729-8b1e-a6a2d8d3514c","stage":"booking","correlationId":"booking-created:bd55faf723c04c461949f28c","attempts":1}
üìÖ Processing booking created for customer: VA3X0JWJ4GFCVN24QB5WS2GC1G
Full booking data: {
  "id": "rcas7ipeucyfvc",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-15T17:00:00Z",
  "created_at": "2025-12-02T18:16:24Z",
  "updated_at": "2025-12-02T18:16:24Z",
  "customer_id": "VA3X0JWJ4GFCVN24QB5WS2GC1G",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "VA3X0JWJ4GFCVN24QB5WS2GC1G",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMyUMvTJIj2HrHSg",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "JMTK5M2CY2W7WEXSTAJKAJ35",
      "service_variation_version": 1764609577793,
      "service_variation_client_id": "JMTK5M2CY2W7WEXSTAJKAJ35"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Sarah de Vries
üéâ First booking detected for customer: VA3X0JWJ4GFCVN24QB5WS2GC1G
   Name: Sarah de Vries
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer VA3X0JWJ4GFCVN24QB5WS2GC1G...
Error getting custom attributes for customer VA3X0JWJ4GFCVN24QB5WS2GC1G: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: VA3X0JWJ4GFCVN24QB5WS2GC1G
{"ts":"2025-12-02T18:16:29.094Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"8b437cb5-8fd9-4729-8b1e-a6a2d8d3514c","stage":"booking","correlationId":"booking-created:bd55faf723c04c461949f28c"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-12-02T18:39:17.266Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"881ee4a0-af07-4e96-8e05-7576bc4d7bf1","stage":"booking","correlationId":"booking-created:6fb6f7d4cf251b576a448ded","attempts":1}
üìÖ Processing booking created for customer: F75RWEJBQJNGMPQNYM01XKK9TC
Full booking data: {
  "id": "ul0s2u3xpzufjk",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-05T21:30:00Z",
  "created_at": "2025-12-02T18:23:16Z",
  "updated_at": "2025-12-02T18:23:16Z",
  "customer_id": "F75RWEJBQJNGMPQNYM01XKK9TC",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMQPbDVvvOCLwqsy"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMyUMvTJIj2HrHSg",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "JMTK5M2CY2W7WEXSTAJKAJ35",
      "service_variation_version": 1762893947284,
      "service_variation_client_id": "JMTK5M2CY2W7WEXSTAJKAJ35"
    },
    {
      "team_member_id": "TMyUMvTJIj2HrHSg",
      "any_team_member": false,
      "duration_minutes": 50,
      "intermission_minutes": 0,
      "service_variation_id": "WDGZ6T4JLCDPLM5GYCWCSUDY",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "WDGZ6T4JLCDPLM5GYCWCSUDY"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: null null
Error retrieving Square customer F75RWEJBQJNGMPQNYM01XKK9TC: Response status code was not ok: 401.
Square API errors: [
  {
    "category": "AUTHENTICATION_ERROR",
    "code": "UNAUTHORIZED",
    "detail": "This request could not be authorized."
  }
]
üéâ First booking detected for customer: F75RWEJBQJNGMPQNYM01XKK9TC
   Name: null null
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer F75RWEJBQJNGMPQNYM01XKK9TC...
Error getting custom attributes for customer F75RWEJBQJNGMPQNYM01XKK9TC: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: F75RWEJBQJNGMPQNYM01XKK9TC
{"ts":"2025-12-02T18:39:18.273Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"881ee4a0-af07-4e96-8e05-7576bc4d7bf1","stage":"booking","correlationId":"booking-created:6fb6f7d4cf251b576a448ded"}
{"ts":"2025-12-02T18:39:18.438Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"5badc775-5b72-4981-b67d-3e08e1e7548e","stage":"booking","correlationId":"booking-created:ebd799378c23957c26fa7175","attempts":1}
üìÖ Processing booking created for customer: QJ1MNNDVV7QM2N9ZNTTK859MN0
Full booking data: {
  "id": "tzy6apbwz21qmw",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-08T23:45:00Z",
  "created_at": "2025-12-02T18:27:51Z",
  "updated_at": "2025-12-02T18:27:51Z",
  "customer_id": "QJ1MNNDVV7QM2N9ZNTTK859MN0",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMQPbDVvvOCLwqsy"
  },
  "appointment_segments": [
    {
      "team_member_id": "TM7_r-KmvY9xjnEU",
      "any_team_member": false,
      "duration_minutes": 150,
      "intermission_minutes": 0,
      "service_variation_id": "4QI3JWGEYQANKCGC36J3MYNB",
      "service_variation_version": 1758654327496,
      "service_variation_client_id": "4QI3JWGEYQANKCGC36J3MYNB"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Magdalena Gallagher
üéâ First booking detected for customer: QJ1MNNDVV7QM2N9ZNTTK859MN0
   Name: Magdalena Gallagher
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer QJ1MNNDVV7QM2N9ZNTTK859MN0...
Error getting custom attributes for customer QJ1MNNDVV7QM2N9ZNTTK859MN0: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: QJ1MNNDVV7QM2N9ZNTTK859MN0
{"ts":"2025-12-02T18:39:19.145Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"5badc775-5b72-4981-b67d-3e08e1e7548e","stage":"booking","correlationId":"booking-created:ebd799378c23957c26fa7175"}
{"ts":"2025-12-02T18:39:19.583Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"1b713f20-6dfa-45a4-b7f5-ece9160df896","stage":"booking","correlationId":"booking-created:e205b7701e0474ed59a2b4fb","attempts":1}
üìÖ Processing booking created for customer: KYC58841FFV6YG0X0HS5S4QEK8
Full booking data: {
  "id": "pjekinhufh655u",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-08T23:00:00Z",
  "created_at": "2025-12-02T18:34:32Z",
  "updated_at": "2025-12-02T18:34:32Z",
  "customer_id": "KYC58841FFV6YG0X0HS5S4QEK8",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMQPbDVvvOCLwqsy"
  },
  "appointment_segments": [
    {
      "resource_ids": [
        "KAOXILA4CV7A23VRAACC4R66"
      ],
      "team_member_id": "TM1L5yPC-yKx6CyO",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "ZEAKNB35I37RMXNUBGWDZQIM",
      "service_variation_version": 1760895536505,
      "service_variation_client_id": "ZEAKNB35I37RMXNUBGWDZQIM"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Donna Berg
üéâ First booking detected for customer: KYC58841FFV6YG0X0HS5S4QEK8
   Name: Donna Berg
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer KYC58841FFV6YG0X0HS5S4QEK8...
Error getting custom attributes for customer KYC58841FFV6YG0X0HS5S4QEK8: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: KYC58841FFV6YG0X0HS5S4QEK8
{"ts":"2025-12-02T18:39:20.760Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"1b713f20-6dfa-45a4-b7f5-ece9160df896","stage":"booking","correlationId":"booking-created:e205b7701e0474ed59a2b4fb"}
{"ts":"2025-12-02T18:39:21.286Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"361dafe1-c5b6-436f-8cfc-ece7bf5d0eba","stage":"booking","correlationId":"booking-created:811651a7789e4520649b1365","attempts":1}
üìÖ Processing booking created for customer: KYC58841FFV6YG0X0HS5S4QEK8
Full booking data: {
  "id": "bbwgiu6cdeg0p8",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-08T23:00:00Z",
  "created_at": "2025-12-02T18:37:37Z",
  "updated_at": "2025-12-02T18:37:37Z",
  "customer_id": "KYC58841FFV6YG0X0HS5S4QEK8",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMQPbDVvvOCLwqsy"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMyUMvTJIj2HrHSg",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "JMTK5M2CY2W7WEXSTAJKAJ35",
      "service_variation_version": 1762893947284,
      "service_variation_client_id": "JMTK5M2CY2W7WEXSTAJKAJ35"
    },
    {
      "team_member_id": "TMyUMvTJIj2HrHSg",
      "any_team_member": false,
      "duration_minutes": 5,
      "intermission_minutes": 0,
      "service_variation_id": "DBRXEHQPCF7V4APTHDQTZW62",
      "service_variation_version": 1762374620368,
      "service_variation_client_id": "WYYALSW7EFQP5CLOWBH22GPD"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Donna Berg
üéâ First booking detected for customer: KYC58841FFV6YG0X0HS5S4QEK8
   Name: Donna Berg
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer KYC58841FFV6YG0X0HS5S4QEK8...
Error getting custom attributes for customer KYC58841FFV6YG0X0HS5S4QEK8: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: KYC58841FFV6YG0X0HS5S4QEK8
{"ts":"2025-12-02T18:39:22.151Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"361dafe1-c5b6-436f-8cfc-ece7bf5d0eba","stage":"booking","correlationId":"booking-created:811651a7789e4520649b1365"}
{"ts":"2025-12-02T18:42:06.104Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"4f4f76a5-0e7a-4599-aa70-0ecaf13a8e8d","stage":"payment","correlationId":"payment-updated:6cdca9f72c927f16598e14ae","attempts":1}
üí∞ Processing payment completion for customer: J3F8Z4VQPY70DDXFHFDB98CCZ4
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Sheena Ferrari
‚ùå Referrer not found for code: null
‚úÖ Generated new personal_code in name+ID format: SHEENA0984
‚ùå Error creating/loading gift card for Sheena Ferrari: Response status code was not ok: 401.
Square API errors: [
  {
    "category": "AUTHENTICATION_ERROR",
    "code": "UNAUTHORIZED",
    "detail": "This request could not be authorized."
  }
]
‚ùå Failed to create referrer gift card
Error upserting custom attribute "square:a3dde506-f69e-48e4-a98a-004c1822d3ad" for customer J3F8Z4VQPY70DDXFHFDB98CCZ4: Response status code was not ok: 401.
Square API errors: [
  {
    "category": "AUTHENTICATION_ERROR",
    "code": "UNAUTHORIZED",
    "detail": "This request could not be authorized."
  }
]
Error appending referral note for customer J3F8Z4VQPY70DDXFHFDB98CCZ4: Response status code was not ok: 401.
Square API errors: [
  {
    "category": "AUTHENTICATION_ERROR",
    "code": "UNAUTHORIZED",
    "detail": "This request could not be authorized."
  }
]
‚ùå Error sending referral email to sheenaloren@gmail.com: Unauthorized
SendGrid error details: {
  errors: [
    {
      message: 'The provided authorization grant is invalid, expired, or revoked',
      field: null,
      help: null
    }
  ]
}
‚ö†Ô∏è Analytics operation "notification_event" failed: 
Invalid `prisma.notificationEvent.create()` invocation in
/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/analytics-service.js:164:39

  161 return runAnalyticsOperation(
  162   'notification_event',
  163   async () => {
‚Üí 164     return prisma.notificationEvent.create({
            data: {
              channel: "EMAIL",
              templateType: "REFERRAL_INVITE",
              status: "failed",
              createdAt: new Date("2025-12-02T18:42:07.955Z"),
              errorCode: 401,
                         ~~~
              errorMessage: "Unauthorized",
              metadata: {
                email: "sheenaloren@gmail.com",
                referralCode: "SHEENA0984",
                referralUrl: "https://referral-system-salon-fbbq6x1wt-umis-projects-e802f152.vercel.app/ref/SHEENA0984",
                suppressionGroupId: 28008
              }
            }
          })

Argument `errorCode`: Invalid value provided. Expected String or Null, provided Int.
‚ùå Failed to send email: Unauthorized
‚ö†Ô∏è Phone number (669) 233-9273 is not in E.164 format
‚ÑπÔ∏è SMS sending disabled. Would send referral link to (669) 233-9273
‚è∏Ô∏è SMS sending disabled (skipped sending to (669) 233-9273)
üìß Referral code generated and sent:
   - Customer: Sheena Ferrari
   - Email: sheenaloren@gmail.com
   - Referral Code: SHEENA0984
   - Referral URL: https://referral-system-salon-fbbq6x1wt-umis-projects-e802f152.vercel.app/ref/SHEENA0984
   - Gift Card ID: null
   - Status: Customer is now a referrer
‚úÖ Referral code sent to new client:
   - Customer: Sheena Ferrari
   - Email: sheenaloren@gmail.com
   - Referral Code: SHEENA0984
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: J3F8Z4VQPY70DDXFHFDB98CCZ4
{"ts":"2025-12-02T18:42:08.229Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"4f4f76a5-0e7a-4599-aa70-0ecaf13a8e8d","stage":"payment","correlationId":"payment-updated:6cdca9f72c927f16598e14ae"}
{"ts":"2025-12-02T18:42:08.385Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"876b4e2b-ce83-4afc-b1fd-cabdc98153ca","stage":"customer_ingest","correlationId":"customer-created:a451edf79e39d7c992ce8fc3","attempts":1}
üì• Received customer data: {
  "id": "3CW345RHSCDCZXH8T32XA2FGS8",
  "version": 0,
  "created_at": "2025-12-02T18:42:04.724Z",
  "given_name": "Rania",
  "updated_at": "2025-12-02T18:42:04Z",
  "family_name": "Ben Aoun",
  "preferences": {
    "email_unsubscribed": false
  },
  "phone_number": "+16282240051",
  "email_address": "raniabenaouun@gmail.com",
  "creation_source": "THIRD_PARTY"
}
üë§ Processing customer creation: 3CW345RHSCDCZXH8T32XA2FGS8
üìç IP Address: unknown
üìß Email: raniabenaouun@gmail.com
üìû Phone: +16282240051
üë§ Name: Rania Ben Aoun
‚ö†Ô∏è Suspicious IP activity detected: unknown used by 128 customers
‚ö†Ô∏è Suspicious activity detected for customer 3CW345RHSCDCZXH8T32XA2FGS8, flagging for review
üéâ New customer detected: 3CW345RHSCDCZXH8T32XA2FGS8
‚úÖ Customer added to database as NEW (temporary mark)
   - Will check for referral code when they book
   - Will give gift card on first booking if code found
‚úÖ Verification: Customer found in DB: true
{"ts":"2025-12-02T18:42:08.725Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"876b4e2b-ce83-4afc-b1fd-cabdc98153ca","stage":"customer_ingest","correlationId":"customer-created:a451edf79e39d7c992ce8fc3"}
{"ts":"2025-12-02T18:42:11.006Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"fe530add-0423-42c4-941c-938e6a935510","stage":"payment","correlationId":"payment-updated:3ccab108c6cba4906a08207b","attempts":1}
üí∞ Processing payment completion for customer: J3F8Z4VQPY70DDXFHFDB98CCZ4
   Payment source_type: CARD
   Payment tender_types: []
Customer J3F8Z4VQPY70DDXFHFDB98CCZ4 already completed first payment
{"ts":"2025-12-02T18:42:11.141Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"fe530add-0423-42c4-941c-938e6a935510","stage":"payment","correlationId":"payment-updated:3ccab108c6cba4906a08207b"}
{"ts":"2025-12-02T18:58:12.501Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Server has closed the connection.","stack":"PrismaClientKnownRequestError: Server has closed the connection.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T18:58:15.862Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"e909c798-375b-4363-9216-c4e19d349e8c","stage":"booking","correlationId":"booking-created:d58d84a6db08b356f9e65c1d","attempts":1}
üìÖ Processing booking created for customer: 3CW345RHSCDCZXH8T32XA2FGS8
Full booking data: {
  "id": "6fmpfwc447lvnt",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-02T18:30:00Z",
  "created_at": "2025-12-02T18:42:58Z",
  "updated_at": "2025-12-02T18:42:58Z",
  "customer_id": "3CW345RHSCDCZXH8T32XA2FGS8",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMQPbDVvvOCLwqsy"
  },
  "appointment_segments": [
    {
      "team_member_id": "TM9jDlRr_Hl4rdBB",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "XBUDIMNKOPC2XVG5YLIQ4RYS",
      "service_variation_version": 1764609577793,
      "service_variation_client_id": "XBUDIMNKOPC2XVG5YLIQ4RYS"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Rania Ben Aoun
üéâ First booking detected for customer: 3CW345RHSCDCZXH8T32XA2FGS8
   Name: Rania Ben Aoun
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 3CW345RHSCDCZXH8T32XA2FGS8...
Error getting custom attributes for customer 3CW345RHSCDCZXH8T32XA2FGS8: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 3CW345RHSCDCZXH8T32XA2FGS8
{"ts":"2025-12-02T18:58:16.598Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"e909c798-375b-4363-9216-c4e19d349e8c","stage":"booking","correlationId":"booking-created:d58d84a6db08b356f9e65c1d"}
{"ts":"2025-12-02T18:58:16.760Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"81a7797e-1c57-4762-8337-f0c83a27c3b7","stage":"payment","correlationId":"payment-updated:c085edd160403f0bdf510dd2","attempts":1}
üí∞ Processing payment completion for customer: CARHXXDE2RDXJHRM93Y83V750G
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Tayler Jones
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Tayler Jones, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Tayler Jones
   - Email: taylerbrookejones@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: CARHXXDE2RDXJHRM93Y83V750G
{"ts":"2025-12-02T18:58:17.085Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"81a7797e-1c57-4762-8337-f0c83a27c3b7","stage":"payment","correlationId":"payment-updated:c085edd160403f0bdf510dd2"}
{"ts":"2025-12-02T18:58:17.244Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"a07e6d4d-4729-49b0-9ee5-71d70a8ed284","stage":"payment","correlationId":"payment-updated:ac423614acfccc9266426e2a","attempts":1}
üí∞ Processing payment completion for customer: CARHXXDE2RDXJHRM93Y83V750G
   Payment source_type: CARD
   Payment tender_types: []
Customer CARHXXDE2RDXJHRM93Y83V750G already completed first payment
{"ts":"2025-12-02T18:58:17.383Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"a07e6d4d-4729-49b0-9ee5-71d70a8ed284","stage":"payment","correlationId":"payment-updated:ac423614acfccc9266426e2a"}
{"ts":"2025-12-02T18:58:17.579Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"f9c1bf86-2575-476d-ada6-f596247494d9","stage":"booking","correlationId":"booking-created:e9f04b73f69b005c59f0b835","attempts":1}
üìÖ Processing booking created for customer: 6XW971FQS4D8Y01EHA23YGV3PW
Full booking data: {
  "id": "ribcik13c10enh",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-03T20:00:00Z",
  "created_at": "2025-12-02T18:49:24Z",
  "updated_at": "2025-12-02T18:49:24Z",
  "customer_id": "6XW971FQS4D8Y01EHA23YGV3PW",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMQPbDVvvOCLwqsy"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMyUMvTJIj2HrHSg",
      "any_team_member": false,
      "duration_minutes": 150,
      "intermission_minutes": 0,
      "service_variation_id": "4QI3JWGEYQANKCGC36J3MYNB",
      "service_variation_version": 1758654327496,
      "service_variation_client_id": "4QI3JWGEYQANKCGC36J3MYNB"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Kelly Stavish
üéâ First booking detected for customer: 6XW971FQS4D8Y01EHA23YGV3PW
   Name: Kelly Stavish
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 6XW971FQS4D8Y01EHA23YGV3PW...
Error getting custom attributes for customer 6XW971FQS4D8Y01EHA23YGV3PW: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 6XW971FQS4D8Y01EHA23YGV3PW
{"ts":"2025-12-02T18:58:18.078Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"f9c1bf86-2575-476d-ada6-f596247494d9","stage":"booking","correlationId":"booking-created:e9f04b73f69b005c59f0b835"}
{"ts":"2025-12-02T18:58:19.009Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"237e9e46-7cec-4f42-a627-4a54ecce76fe","stage":"booking","correlationId":"booking-created:acc85dd2d3fa3d7ed495e2b7","attempts":1}
üìÖ Processing booking created for customer: 2F7KF3BN3EKZ2HZK8K3GHHYNA4
Full booking data: {
  "id": "y2bo81a8hl6q4f",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-04T01:00:00Z",
  "created_at": "2025-12-02T18:50:53Z",
  "updated_at": "2025-12-02T18:50:53Z",
  "customer_id": "2F7KF3BN3EKZ2HZK8K3GHHYNA4",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMWAtQTYmZpwwxii"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMSt73bSp59caRzt",
      "any_team_member": false,
      "duration_minutes": 140,
      "intermission_minutes": 0,
      "service_variation_id": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "CJI5WHOAKSFTASYPJ4MSYZLS"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Emily Nansen
üéâ First booking detected for customer: 2F7KF3BN3EKZ2HZK8K3GHHYNA4
   Name: Emily Nansen
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 2F7KF3BN3EKZ2HZK8K3GHHYNA4...
Error getting custom attributes for customer 2F7KF3BN3EKZ2HZK8K3GHHYNA4: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 2F7KF3BN3EKZ2HZK8K3GHHYNA4
{"ts":"2025-12-02T18:58:19.592Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"237e9e46-7cec-4f42-a627-4a54ecce76fe","stage":"booking","correlationId":"booking-created:acc85dd2d3fa3d7ed495e2b7"}
{"ts":"2025-12-02T18:59:31.402Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"e78ea2b9-50b9-4492-a96a-2cb9d981b4b7","stage":"booking","correlationId":"booking-created:ff9854a6f43bb666d93c9e71","attempts":1}
üìÖ Processing booking created for customer: RZEKARJ9JQBJ25RDT6PYE32VF8
Full booking data: {
  "id": "wwal7oy6wdxj8m",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-12T00:00:00Z",
  "created_at": "2025-12-02T18:59:29Z",
  "updated_at": "2025-12-02T18:59:29Z",
  "customer_id": "RZEKARJ9JQBJ25RDT6PYE32VF8",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "RZEKARJ9JQBJ25RDT6PYE32VF8",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMMCVDJoKh3ZkfFo",
      "any_team_member": false,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1764609601083,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Kelsey OHara
‚ÑπÔ∏è Customer RZEKARJ9JQBJ25RDT6PYE32VF8 already received signup bonus, not first booking
{"ts":"2025-12-02T18:59:31.727Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"e78ea2b9-50b9-4492-a96a-2cb9d981b4b7","stage":"booking","correlationId":"booking-created:ff9854a6f43bb666d93c9e71"}
{"ts":"2025-12-02T19:10:32.361Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"5a715779-30dc-4310-b80c-26829d776dc7","stage":"booking","correlationId":"booking-created:831ab0d0cb1bd88581ddae98","attempts":1}
üìÖ Processing booking created for customer: W1B6A581BGFMYY518F69MPD7ER
Full booking data: {
  "id": "9na589u99xq9md",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-16T21:10:00Z",
  "created_at": "2025-12-02T19:10:29Z",
  "updated_at": "2025-12-02T19:10:29Z",
  "customer_id": "W1B6A581BGFMYY518F69MPD7ER",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "W1B6A581BGFMYY518F69MPD7ER",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMILsQUVwLkLzbVo",
      "any_team_member": false,
      "duration_minutes": 100,
      "intermission_minutes": 0,
      "service_variation_id": "BM556FTNFOTEHYVG4GPXAXFM",
      "service_variation_version": 1764609577793,
      "service_variation_client_id": "BM556FTNFOTEHYVG4GPXAXFM"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Chelsea Gonella
üéâ First booking detected for customer: W1B6A581BGFMYY518F69MPD7ER
   Name: Chelsea Gonella
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer W1B6A581BGFMYY518F69MPD7ER...
Error getting custom attributes for customer W1B6A581BGFMYY518F69MPD7ER: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: W1B6A581BGFMYY518F69MPD7ER
{"ts":"2025-12-02T19:10:33.147Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"5a715779-30dc-4310-b80c-26829d776dc7","stage":"booking","correlationId":"booking-created:831ab0d0cb1bd88581ddae98"}
{"ts":"2025-12-02T19:12:45.934Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"4c327a4c-afd9-4fba-b096-dd596bfe3943","stage":"booking","correlationId":"booking-created:c980a95148ec6d3af31a8a8e","attempts":1}
üìÖ Processing booking created for customer: W1B6A581BGFMYY518F69MPD7ER
Full booking data: {
  "id": "k3xj4atm9ujnm2",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-09T23:30:00Z",
  "created_at": "2025-12-02T19:12:44Z",
  "updated_at": "2025-12-02T19:12:44Z",
  "customer_id": "W1B6A581BGFMYY518F69MPD7ER",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "W1B6A581BGFMYY518F69MPD7ER",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "resource_ids": [
        "5OVIQ6GSSUXORACP6T7WBAQ7"
      ],
      "team_member_id": "TMVwAQUdLz6no-cB",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "ZEAKNB35I37RMXNUBGWDZQIM",
      "service_variation_version": 1760895536505,
      "service_variation_client_id": "ZEAKNB35I37RMXNUBGWDZQIM"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Chelsea Gonella
üéâ First booking detected for customer: W1B6A581BGFMYY518F69MPD7ER
   Name: Chelsea Gonella
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer W1B6A581BGFMYY518F69MPD7ER...
Error getting custom attributes for customer W1B6A581BGFMYY518F69MPD7ER: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: W1B6A581BGFMYY518F69MPD7ER
{"ts":"2025-12-02T19:12:46.656Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"4c327a4c-afd9-4fba-b096-dd596bfe3943","stage":"booking","correlationId":"booking-created:c980a95148ec6d3af31a8a8e"}
{"ts":"2025-12-02T19:31:48.475Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"4c41fdb4-474b-43af-a14f-63703d5c3665","stage":"payment","correlationId":"payment-updated:d82d4bafcb637b8a8b891e83","attempts":1}
üí∞ Processing payment completion for customer: HTXX11HKQ0XJD2SK0DDKAXGHH0
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Jade Rice
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Jade Rice, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Jade Rice
   - Email: jade.cooks222@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: HTXX11HKQ0XJD2SK0DDKAXGHH0
{"ts":"2025-12-02T19:31:49.128Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"4c41fdb4-474b-43af-a14f-63703d5c3665","stage":"payment","correlationId":"payment-updated:d82d4bafcb637b8a8b891e83"}
{"ts":"2025-12-02T19:31:53.551Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"429c38f3-07a0-40ed-9be8-e7cc35140f08","stage":"payment","correlationId":"payment-updated:09e3680c6dddf2dce74aaadf","attempts":1}
üí∞ Processing payment completion for customer: HTXX11HKQ0XJD2SK0DDKAXGHH0
   Payment source_type: CARD
   Payment tender_types: []
Customer HTXX11HKQ0XJD2SK0DDKAXGHH0 already completed first payment
{"ts":"2025-12-02T19:31:53.690Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"429c38f3-07a0-40ed-9be8-e7cc35140f08","stage":"payment","correlationId":"payment-updated:09e3680c6dddf2dce74aaadf"}
{"ts":"2025-12-02T19:36:57.419Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"6db5e3ba-8802-4da0-b120-deba25ea1c17","stage":"payment","correlationId":"payment-updated:580d59e649a03c1bab4fde4e","attempts":1}
üí∞ Processing payment completion for customer: XDBH7894B1JA5FVZVE37RPBR98
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Kristina Loh
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Kristina Loh, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Kristina Loh
   - Email: kristinaaloh@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: XDBH7894B1JA5FVZVE37RPBR98
{"ts":"2025-12-02T19:36:57.991Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"6db5e3ba-8802-4da0-b120-deba25ea1c17","stage":"payment","correlationId":"payment-updated:580d59e649a03c1bab4fde4e"}
{"ts":"2025-12-02T19:37:02.603Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"75df5d40-486b-42f6-8605-c91d9c0fb83a","stage":"payment","correlationId":"payment-updated:ee126fc2421fc5d484add44b","attempts":1}
üí∞ Processing payment completion for customer: XDBH7894B1JA5FVZVE37RPBR98
   Payment source_type: CARD
   Payment tender_types: []
Customer XDBH7894B1JA5FVZVE37RPBR98 already completed first payment
{"ts":"2025-12-02T19:37:02.959Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"75df5d40-486b-42f6-8605-c91d9c0fb83a","stage":"payment","correlationId":"payment-updated:ee126fc2421fc5d484add44b"}
{"ts":"2025-12-02T19:37:45.398Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"eb6b3f49-378e-400a-8936-5130b71d0605","stage":"booking","correlationId":"booking-created:140ebfa26e7e70cb90f46ed7","attempts":1}
üìÖ Processing booking created for customer: W79MRAGVDX3E53BXPCEB9MQ0EM
Full booking data: {
  "id": "0x6ndj1il1su57",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-27T22:30:00Z",
  "created_at": "2025-12-02T19:37:42Z",
  "updated_at": "2025-12-02T19:37:42Z",
  "customer_id": "W79MRAGVDX3E53BXPCEB9MQ0EM",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMQPbDVvvOCLwqsy"
  },
  "appointment_segments": [
    {
      "resource_ids": [
        "KAOXILA4CV7A23VRAACC4R66"
      ],
      "team_member_id": "TM9jDlRr_Hl4rdBB",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "ZEAKNB35I37RMXNUBGWDZQIM",
      "service_variation_version": 1760895536505,
      "service_variation_client_id": "ZEAKNB35I37RMXNUBGWDZQIM"
    },
    {
      "team_member_id": "TM9jDlRr_Hl4rdBB",
      "any_team_member": false,
      "duration_minutes": 20,
      "intermission_minutes": 0,
      "service_variation_id": "HAJX45W3U2WUCCXM5MI24UEE",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "HAJX45W3U2WUCCXM5MI24UEE"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Nichole Rosten
üéâ First booking detected for customer: W79MRAGVDX3E53BXPCEB9MQ0EM
   Name: Nichole Rosten
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer W79MRAGVDX3E53BXPCEB9MQ0EM...
Error getting custom attributes for customer W79MRAGVDX3E53BXPCEB9MQ0EM: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: W79MRAGVDX3E53BXPCEB9MQ0EM
{"ts":"2025-12-02T19:37:46.410Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"eb6b3f49-378e-400a-8936-5130b71d0605","stage":"booking","correlationId":"booking-created:140ebfa26e7e70cb90f46ed7"}
{"ts":"2025-12-02T19:42:16.067Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"4e4c9718-a7ab-4110-b279-dbab1912d007","stage":"booking","correlationId":"booking-created:82e164e599de69d2df7b6cac","attempts":1}
üìÖ Processing booking created for customer: 6PQ82YBVJ5G1WRQ46A1KR3KWBM
Full booking data: {
  "id": "heo26146zxnqzj",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-02T22:00:00Z",
  "created_at": "2025-12-02T19:42:11Z",
  "updated_at": "2025-12-02T19:42:11Z",
  "customer_id": "6PQ82YBVJ5G1WRQ46A1KR3KWBM",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMWAtQTYmZpwwxii"
  },
  "appointment_segments": [
    {
      "team_member_id": "TM-zXe9fXe4axYWn",
      "any_team_member": false,
      "duration_minutes": 30,
      "intermission_minutes": 0,
      "service_variation_id": "SGSLS3INMK5YV637KUITCILL",
      "service_variation_version": 1760895536505,
      "service_variation_client_id": "SGSLS3INMK5YV637KUITCILL"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Candice Adden
üéâ First booking detected for customer: 6PQ82YBVJ5G1WRQ46A1KR3KWBM
   Name: Candice Adden
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 6PQ82YBVJ5G1WRQ46A1KR3KWBM...
Error getting custom attributes for customer 6PQ82YBVJ5G1WRQ46A1KR3KWBM: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 6PQ82YBVJ5G1WRQ46A1KR3KWBM
{"ts":"2025-12-02T19:42:16.802Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"4e4c9718-a7ab-4110-b279-dbab1912d007","stage":"booking","correlationId":"booking-created:82e164e599de69d2df7b6cac"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-12-02T20:07:02.686Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"019449f9-206b-412a-9977-c4e36af34ec1","stage":"booking","correlationId":"booking-created:accef9db594a7731b426e72a","attempts":1}
üìÖ Processing booking created for customer: RK2WGGR1X2T28ZCNSM3228993M
Full booking data: {
  "id": "92p3231waq3fgx",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-22T17:00:00Z",
  "created_at": "2025-12-02T19:59:49Z",
  "updated_at": "2025-12-02T19:59:49Z",
  "customer_id": "RK2WGGR1X2T28ZCNSM3228993M",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMQPbDVvvOCLwqsy"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMNW4SIF7tjp4oM_",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "BRSIGZFOWC6F4ERPKX3CODLU",
      "service_variation_version": 1762893947284,
      "service_variation_client_id": "BRSIGZFOWC6F4ERPKX3CODLU"
    },
    {
      "team_member_id": "TMNW4SIF7tjp4oM_",
      "any_team_member": false,
      "duration_minutes": 15,
      "intermission_minutes": 0,
      "service_variation_id": "KBHPHVKLJNAF223GMYIRUUH3",
      "service_variation_version": 1760895536505,
      "service_variation_client_id": "WOKQXBYCDVX6LQACJMHZTH2Q"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Labeira Galarza
üéâ First booking detected for customer: RK2WGGR1X2T28ZCNSM3228993M
   Name: Labeira Galarza
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer RK2WGGR1X2T28ZCNSM3228993M...
Error getting custom attributes for customer RK2WGGR1X2T28ZCNSM3228993M: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: RK2WGGR1X2T28ZCNSM3228993M
{"ts":"2025-12-02T20:07:03.383Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"019449f9-206b-412a-9977-c4e36af34ec1","stage":"booking","correlationId":"booking-created:accef9db594a7731b426e72a"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-12-02T20:12:51.084Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"78e6f333-4f5e-4d04-beb9-d5d0290564c5","stage":"payment","correlationId":"payment-updated:283da3ef21a9d8d6ce2376a5","attempts":1}
üí∞ Processing payment completion for customer: 3NJ6BX3M3S31F6QJQMT3BF2MZR
   Payment source_type: CARD
   Payment tender_types: []
Customer 3NJ6BX3M3S31F6QJQMT3BF2MZR already completed first payment
{"ts":"2025-12-02T20:12:52.405Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"78e6f333-4f5e-4d04-beb9-d5d0290564c5","stage":"payment","correlationId":"payment-updated:283da3ef21a9d8d6ce2376a5"}
{"ts":"2025-12-02T20:12:52.758Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"58b520cd-b8e7-41bc-a458-909481b87b1b","stage":"payment","correlationId":"payment-updated:424b4c2d0fc7e7f865220976","attempts":1}
üí∞ Processing payment completion for customer: 3NJ6BX3M3S31F6QJQMT3BF2MZR
   Payment source_type: CARD
   Payment tender_types: []
Customer 3NJ6BX3M3S31F6QJQMT3BF2MZR already completed first payment
{"ts":"2025-12-02T20:12:52.933Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"58b520cd-b8e7-41bc-a458-909481b87b1b","stage":"payment","correlationId":"payment-updated:424b4c2d0fc7e7f865220976"}
{"ts":"2025-12-02T20:12:53.108Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"0b51f354-970e-44b9-a9f3-92279e587d6b","stage":"booking","correlationId":"booking-created:4d3c5b32eba095797e8d02b7","attempts":1}
üìÖ Processing booking created for customer: 3NJ6BX3M3S31F6QJQMT3BF2MZR
Full booking data: {
  "id": "eem1o4fyauf42g",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-17T18:30:00Z",
  "created_at": "2025-12-02T20:10:33Z",
  "updated_at": "2025-12-02T20:10:33Z",
  "customer_id": "3NJ6BX3M3S31F6QJQMT3BF2MZR",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMWAtQTYmZpwwxii"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMVwAQUdLz6no-cB",
      "any_team_member": false,
      "duration_minutes": 100,
      "intermission_minutes": 0,
      "service_variation_id": "GSZZR45VJXB44NF4P4WXI5NB",
      "service_variation_version": 1764609577793,
      "service_variation_client_id": "GSZZR45VJXB44NF4P4WXI5NB"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Cryztal Sayle
üéâ First booking detected for customer: 3NJ6BX3M3S31F6QJQMT3BF2MZR
   Name: Cryztal Sayle
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 3NJ6BX3M3S31F6QJQMT3BF2MZR...
Error getting custom attributes for customer 3NJ6BX3M3S31F6QJQMT3BF2MZR: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 3NJ6BX3M3S31F6QJQMT3BF2MZR
{"ts":"2025-12-02T20:12:53.532Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"0b51f354-970e-44b9-a9f3-92279e587d6b","stage":"booking","correlationId":"booking-created:4d3c5b32eba095797e8d02b7"}
{"ts":"2025-12-02T20:12:53.700Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"ef7defab-bb0e-4592-a430-4b3c8f09b150","stage":"payment","correlationId":"payment-updated:f41f368b637b9b42a34d5897","attempts":1}
üí∞ Processing payment completion for customer: 5TYM9H2R3CNGP5YFR3YE9Y74J8
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Erin McGuinness
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Erin McGuinness, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Erin McGuinness
   - Email: e_mcguinness@yahoo.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: 5TYM9H2R3CNGP5YFR3YE9Y74J8
{"ts":"2025-12-02T20:12:54.614Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"ef7defab-bb0e-4592-a430-4b3c8f09b150","stage":"payment","correlationId":"payment-updated:f41f368b637b9b42a34d5897"}
{"ts":"2025-12-02T20:12:55.165Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"8d6a1d66-3bd0-4d74-954c-4f326f4f4b69","stage":"payment","correlationId":"payment-updated:481ee9fb67d142f0bfdb1626","attempts":1}
üí∞ Processing payment completion for customer: 5TYM9H2R3CNGP5YFR3YE9Y74J8
   Payment source_type: CARD
   Payment tender_types: []
Customer 5TYM9H2R3CNGP5YFR3YE9Y74J8 already completed first payment
{"ts":"2025-12-02T20:12:55.669Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"8d6a1d66-3bd0-4d74-954c-4f326f4f4b69","stage":"payment","correlationId":"payment-updated:481ee9fb67d142f0bfdb1626"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Timed out fetching a new connection from the connection pool. More info: http://pris.ly/d/connection-pool (Current connection pool timeout: 10, connection limit: 21)
{"ts":"2025-12-02T20:19:47.642Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T20:19:49.647Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T20:19:51.651Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T20:19:53.664Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`

Please make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.
{"ts":"2025-12-02T20:21:33.795Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T20:21:35.800Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T20:21:37.813Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T20:21:39.818Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T20:21:41.821Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T20:21:43.824Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T20:21:45.827Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T20:21:47.830Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T20:21:49.832Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T20:21:51.836Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T20:21:53.841Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T20:21:55.846Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T20:21:57.847Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T20:21:59.850Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T20:22:01.853Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T20:22:03.858Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T20:22:05.862Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T20:22:07.866Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T20:22:11.054Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"ba06f49d-0da3-4dbe-924d-f9a7dc41ba01","stage":"payment","correlationId":"payment-updated:a608fbdf58352e822b0d3254","attempts":1}
üí∞ Processing payment completion for customer: 3CW345RHSCDCZXH8T32XA2FGS8
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Rania Ben Aoun
‚ùå Referrer not found for code: null
‚úÖ Generated new personal_code in name+ID format: RANIA3228
‚ùå Error creating/loading gift card for Rania Ben Aoun: Response status code was not ok: 401.
Square API errors: [
  {
    "category": "AUTHENTICATION_ERROR",
    "code": "UNAUTHORIZED",
    "detail": "This request could not be authorized."
  }
]
‚ùå Failed to create referrer gift card
Error upserting custom attribute "square:a3dde506-f69e-48e4-a98a-004c1822d3ad" for customer 3CW345RHSCDCZXH8T32XA2FGS8: Response status code was not ok: 401.
Square API errors: [
  {
    "category": "AUTHENTICATION_ERROR",
    "code": "UNAUTHORIZED",
    "detail": "This request could not be authorized."
  }
]
Error appending referral note for customer 3CW345RHSCDCZXH8T32XA2FGS8: Response status code was not ok: 401.
Square API errors: [
  {
    "category": "AUTHENTICATION_ERROR",
    "code": "UNAUTHORIZED",
    "detail": "This request could not be authorized."
  }
]
‚ùå Error sending referral email to raniabenaouun@gmail.com: Unauthorized
SendGrid error details: {
  errors: [
    {
      message: 'The provided authorization grant is invalid, expired, or revoked',
      field: null,
      help: null
    }
  ]
}
‚ö†Ô∏è Analytics operation "notification_event" failed: 
Invalid `prisma.notificationEvent.create()` invocation in
/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/analytics-service.js:164:39

  161 return runAnalyticsOperation(
  162   'notification_event',
  163   async () => {
‚Üí 164     return prisma.notificationEvent.create({
            data: {
              channel: "EMAIL",
              templateType: "REFERRAL_INVITE",
              status: "failed",
              createdAt: new Date("2025-12-02T20:22:13.600Z"),
              errorCode: 401,
                         ~~~
              errorMessage: "Unauthorized",
              metadata: {
                email: "raniabenaouun@gmail.com",
                referralCode: "RANIA3228",
                referralUrl: "https://referral-system-salon-fbbq6x1wt-umis-projects-e802f152.vercel.app/ref/RANIA3228",
                suppressionGroupId: 28008
              }
            }
          })

Argument `errorCode`: Invalid value provided. Expected String or Null, provided Int.
‚ùå Failed to send email: Unauthorized
‚ÑπÔ∏è SMS sending disabled. Would send referral link to +16282240051
‚è∏Ô∏è SMS sending disabled (skipped sending to +16282240051)
üìß Referral code generated and sent:
   - Customer: Rania Ben Aoun
   - Email: raniabenaouun@gmail.com
   - Referral Code: RANIA3228
   - Referral URL: https://referral-system-salon-fbbq6x1wt-umis-projects-e802f152.vercel.app/ref/RANIA3228
   - Gift Card ID: null
   - Status: Customer is now a referrer
‚úÖ Referral code sent to new client:
   - Customer: Rania Ben Aoun
   - Email: raniabenaouun@gmail.com
   - Referral Code: RANIA3228
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: 3CW345RHSCDCZXH8T32XA2FGS8
{"ts":"2025-12-02T20:22:14.104Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"ba06f49d-0da3-4dbe-924d-f9a7dc41ba01","stage":"payment","correlationId":"payment-updated:a608fbdf58352e822b0d3254"}
{"ts":"2025-12-02T20:22:14.457Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"556978cf-f8cd-4c82-85e4-90afba4a3623","stage":"payment","correlationId":"payment-updated:c6bb61346ee0bda5f6689836","attempts":1}
üí∞ Processing payment completion for customer: 3CW345RHSCDCZXH8T32XA2FGS8
   Payment source_type: CARD
   Payment tender_types: []
Customer 3CW345RHSCDCZXH8T32XA2FGS8 already completed first payment
{"ts":"2025-12-02T20:22:14.976Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"556978cf-f8cd-4c82-85e4-90afba4a3623","stage":"payment","correlationId":"payment-updated:c6bb61346ee0bda5f6689836"}
{"ts":"2025-12-02T20:22:15.472Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"4a8eb56a-ca69-4029-9a43-418b7308d1d7","stage":"booking","correlationId":"booking-created:07f3fd23a2a2a004cc096b0a","attempts":1}
üìÖ Processing booking created for customer: SGZJP4PPYNMZWZ0573FMRQ2X4W
Full booking data: {
  "id": "lcucixidlzqfcy",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-15T20:30:00Z",
  "created_at": "2025-12-02T20:19:49Z",
  "updated_at": "2025-12-02T20:19:49Z",
  "customer_id": "SGZJP4PPYNMZWZ0573FMRQ2X4W",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "SGZJP4PPYNMZWZ0573FMRQ2X4W",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMVwAQUdLz6no-cB",
      "any_team_member": false,
      "duration_minutes": 100,
      "intermission_minutes": 0,
      "service_variation_id": "GSZZR45VJXB44NF4P4WXI5NB",
      "service_variation_version": 1764609577793,
      "service_variation_client_id": "GSZZR45VJXB44NF4P4WXI5NB"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Renata Drucker
üéâ First booking detected for customer: SGZJP4PPYNMZWZ0573FMRQ2X4W
   Name: Renata Drucker
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer SGZJP4PPYNMZWZ0573FMRQ2X4W...
Error getting custom attributes for customer SGZJP4PPYNMZWZ0573FMRQ2X4W: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: SGZJP4PPYNMZWZ0573FMRQ2X4W
{"ts":"2025-12-02T20:22:16.087Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"4a8eb56a-ca69-4029-9a43-418b7308d1d7","stage":"booking","correlationId":"booking-created:07f3fd23a2a2a004cc096b0a"}
{"ts":"2025-12-02T20:24:44.549Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"bcac478f-74f5-4e09-ab1e-26401f8a5054","stage":"booking","correlationId":"booking-created:71f183549311ce2b855a1cdb","attempts":1}
üìÖ Processing booking created for customer: C5SY3G1H41TSQBT0HS5QV64DY4
Full booking data: {
  "id": "p5bg3uwxonwfxh",
  "source": "THIRD_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-03T19:00:00Z",
  "created_at": "2025-12-02T20:24:43Z",
  "updated_at": "2025-12-02T20:24:43Z",
  "customer_id": "C5SY3G1H41TSQBT0HS5QV64DY4",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "C5SY3G1H41TSQBT0HS5QV64DY4",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMXiw38Bbb7XQUWI",
      "any_team_member": false,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1764609601083,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: null null
Error retrieving Square customer C5SY3G1H41TSQBT0HS5QV64DY4: Response status code was not ok: 401.
Square API errors: [
  {
    "category": "AUTHENTICATION_ERROR",
    "code": "UNAUTHORIZED",
    "detail": "This request could not be authorized."
  }
]
üéâ First booking detected for customer: C5SY3G1H41TSQBT0HS5QV64DY4
   Name: null null
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer C5SY3G1H41TSQBT0HS5QV64DY4...
Error getting custom attributes for customer C5SY3G1H41TSQBT0HS5QV64DY4: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: C5SY3G1H41TSQBT0HS5QV64DY4
{"ts":"2025-12-02T20:24:45.718Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"bcac478f-74f5-4e09-ab1e-26401f8a5054","stage":"booking","correlationId":"booking-created:71f183549311ce2b855a1cdb"}
{"ts":"2025-12-02T20:28:53.284Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"e2f8e8a8-e3be-445d-b187-71845bce69fb","stage":"payment","correlationId":"payment-updated:80bc054dc2abca8df616b92a","attempts":1}
üí∞ Processing payment completion for customer: N7G5C5798X7V927ZW29PZ3BCF4
   Payment source_type: CARD
   Payment tender_types: []
Customer N7G5C5798X7V927ZW29PZ3BCF4 already completed first payment
{"ts":"2025-12-02T20:28:55.221Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"e2f8e8a8-e3be-445d-b187-71845bce69fb","stage":"payment","correlationId":"payment-updated:80bc054dc2abca8df616b92a"}
{"ts":"2025-12-02T20:28:57.734Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"17a206ee-1396-4345-89f5-9cff18d7dc85","stage":"payment","correlationId":"payment-updated:da404a9d1d619f29677c6479","attempts":1}
üí∞ Processing payment completion for customer: N7G5C5798X7V927ZW29PZ3BCF4
   Payment source_type: CARD
   Payment tender_types: []
Customer N7G5C5798X7V927ZW29PZ3BCF4 already completed first payment
{"ts":"2025-12-02T20:28:57.936Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"17a206ee-1396-4345-89f5-9cff18d7dc85","stage":"payment","correlationId":"payment-updated:da404a9d1d619f29677c6479"}
{"ts":"2025-12-02T20:30:17.907Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"7a5b68f7-f36c-404f-b324-3966666ed439","stage":"booking","correlationId":"booking-created:76aba51e2a4a41412db5f49d","attempts":1}
üìÖ Processing booking created for customer: N7G5C5798X7V927ZW29PZ3BCF4
Full booking data: {
  "id": "oqo4e3jplrp4c7",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-20T19:30:00Z",
  "created_at": "2025-12-02T20:30:14Z",
  "updated_at": "2025-12-02T20:30:14Z",
  "customer_id": "N7G5C5798X7V927ZW29PZ3BCF4",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMQPbDVvvOCLwqsy"
  },
  "appointment_segments": [
    {
      "team_member_id": "TM9jDlRr_Hl4rdBB",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "XBUDIMNKOPC2XVG5YLIQ4RYS",
      "service_variation_version": 1764609577793,
      "service_variation_client_id": "XBUDIMNKOPC2XVG5YLIQ4RYS"
    },
    {
      "team_member_id": "TM9jDlRr_Hl4rdBB",
      "any_team_member": false,
      "duration_minutes": 20,
      "intermission_minutes": 0,
      "service_variation_id": "HAJX45W3U2WUCCXM5MI24UEE",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "HAJX45W3U2WUCCXM5MI24UEE"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Courtney Giraudo
üéâ First booking detected for customer: N7G5C5798X7V927ZW29PZ3BCF4
   Name: Courtney Giraudo
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer N7G5C5798X7V927ZW29PZ3BCF4...
Error getting custom attributes for customer N7G5C5798X7V927ZW29PZ3BCF4: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: N7G5C5798X7V927ZW29PZ3BCF4
{"ts":"2025-12-02T20:30:22.515Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"7a5b68f7-f36c-404f-b324-3966666ed439","stage":"booking","correlationId":"booking-created:76aba51e2a4a41412db5f49d"}
{"ts":"2025-12-02T20:32:06.564Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"581cb384-93a9-47d6-b9ef-e01b135b52a0","stage":"booking","correlationId":"booking-created:6d070b653185b603db82de2c","attempts":1}
üìÖ Processing booking created for customer: P8F14M0HPR5KYEM70AH708K69W
Full booking data: {
  "id": "nhaacr06lv88wl",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-23T18:30:00Z",
  "created_at": "2025-12-02T20:32:05Z",
  "updated_at": "2025-12-02T20:32:05Z",
  "customer_id": "P8F14M0HPR5KYEM70AH708K69W",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMQPbDVvvOCLwqsy"
  },
  "appointment_segments": [
    {
      "team_member_id": "TM9jDlRr_Hl4rdBB",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "XBUDIMNKOPC2XVG5YLIQ4RYS",
      "service_variation_version": 1764609577793,
      "service_variation_client_id": "XBUDIMNKOPC2XVG5YLIQ4RYS"
    },
    {
      "team_member_id": "TM9jDlRr_Hl4rdBB",
      "any_team_member": false,
      "duration_minutes": 5,
      "intermission_minutes": 0,
      "service_variation_id": "DBRXEHQPCF7V4APTHDQTZW62",
      "service_variation_version": 1762374620368,
      "service_variation_client_id": "WYYALSW7EFQP5CLOWBH22GPD"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Susie Roy
üéâ First booking detected for customer: P8F14M0HPR5KYEM70AH708K69W
   Name: Susie Roy
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer P8F14M0HPR5KYEM70AH708K69W...
Error getting custom attributes for customer P8F14M0HPR5KYEM70AH708K69W: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: P8F14M0HPR5KYEM70AH708K69W
{"ts":"2025-12-02T20:32:07.494Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"581cb384-93a9-47d6-b9ef-e01b135b52a0","stage":"booking","correlationId":"booking-created:6d070b653185b603db82de2c"}
{"ts":"2025-12-02T20:32:48.396Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"d93ca322-4c30-4a53-af24-758f2874aa71","stage":"booking","correlationId":"booking-created:62b8a59f4bb9ac8205bd985b","attempts":1}
üìÖ Processing booking created for customer: P8F14M0HPR5KYEM70AH708K69W
Full booking data: {
  "id": "2l2mq06netdjxf",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-23T18:30:00Z",
  "created_at": "2025-12-02T20:32:44Z",
  "updated_at": "2025-12-02T20:32:44Z",
  "customer_id": "P8F14M0HPR5KYEM70AH708K69W",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMQPbDVvvOCLwqsy"
  },
  "appointment_segments": [
    {
      "resource_ids": [
        "KAOXILA4CV7A23VRAACC4R66"
      ],
      "team_member_id": "TMyUMvTJIj2HrHSg",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "ZEAKNB35I37RMXNUBGWDZQIM",
      "service_variation_version": 1760895536505,
      "service_variation_client_id": "ZEAKNB35I37RMXNUBGWDZQIM"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Susie Roy
üéâ First booking detected for customer: P8F14M0HPR5KYEM70AH708K69W
   Name: Susie Roy
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer P8F14M0HPR5KYEM70AH708K69W...
Error getting custom attributes for customer P8F14M0HPR5KYEM70AH708K69W: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: P8F14M0HPR5KYEM70AH708K69W
{"ts":"2025-12-02T20:32:49.486Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"d93ca322-4c30-4a53-af24-758f2874aa71","stage":"booking","correlationId":"booking-created:62b8a59f4bb9ac8205bd985b"}
{"ts":"2025-12-02T20:37:16.378Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T20:37:20.382Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T20:47:27.657Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T20:50:14.658Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"653c8956-a17b-4e87-acfc-427a00ba258e","stage":"payment","correlationId":"payment-updated:61dd53eeaf1c2ad061e54e56","attempts":1}
üí∞ Processing payment completion for customer: GN2VNDAW4AWKRKAARXHXBM0Z4C
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Shefali Razdan
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Shefali Razdan, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Shefali Razdan
   - Email: shefali@shefalirazdanduggal.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: GN2VNDAW4AWKRKAARXHXBM0Z4C
{"ts":"2025-12-02T20:50:15.779Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"653c8956-a17b-4e87-acfc-427a00ba258e","stage":"payment","correlationId":"payment-updated:61dd53eeaf1c2ad061e54e56"}
{"ts":"2025-12-02T20:50:18.296Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"8269f82a-06e9-48ed-a681-b6e953db91a1","stage":"payment","correlationId":"payment-updated:8e22595cf21f09ce5f1ec200","attempts":1}
üí∞ Processing payment completion for customer: GN2VNDAW4AWKRKAARXHXBM0Z4C
   Payment source_type: CARD
   Payment tender_types: []
Customer GN2VNDAW4AWKRKAARXHXBM0Z4C already completed first payment
{"ts":"2025-12-02T20:50:18.494Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"8269f82a-06e9-48ed-a681-b6e953db91a1","stage":"payment","correlationId":"payment-updated:8e22595cf21f09ce5f1ec200"}
{"ts":"2025-12-02T21:01:02.937Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"67ab93b1-da94-461e-b069-5b5603b9d35d","stage":"booking","correlationId":"booking-created:1d6c655554ca0fb6cad9a882","attempts":1}
üìÖ Processing booking created for customer: DF8XHTQ7PKYYH69A403X3Z5YRG
Full booking data: {
  "id": "gbyibodeji28qm",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-22T18:30:00Z",
  "created_at": "2025-12-02T21:01:01Z",
  "updated_at": "2025-12-02T21:01:01Z",
  "customer_id": "DF8XHTQ7PKYYH69A403X3Z5YRG",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "DF8XHTQ7PKYYH69A403X3Z5YRG",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMNW4SIF7tjp4oM_",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "BRSIGZFOWC6F4ERPKX3CODLU",
      "service_variation_version": 1764609577793,
      "service_variation_client_id": "BRSIGZFOWC6F4ERPKX3CODLU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Amber Baur
üéâ First booking detected for customer: DF8XHTQ7PKYYH69A403X3Z5YRG
   Name: Amber Baur
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer DF8XHTQ7PKYYH69A403X3Z5YRG...
Error getting custom attributes for customer DF8XHTQ7PKYYH69A403X3Z5YRG: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: DF8XHTQ7PKYYH69A403X3Z5YRG
{"ts":"2025-12-02T21:01:04.149Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"67ab93b1-da94-461e-b069-5b5603b9d35d","stage":"booking","correlationId":"booking-created:1d6c655554ca0fb6cad9a882"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-12-02T21:45:40.538Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"d0485b3e-7118-4972-a6d7-8b379f63ac3b","stage":"customer_ingest","correlationId":"customer-created:ffe30025dcf5daaa6b0d6068","attempts":1}
üì• Received customer data: {
  "id": "V56R2CDR6R4Q85KE6KV4NRGXD0",
  "address": {
    "country": "US"
  },
  "version": 1,
  "group_ids": [
    "LT4ZHFBQQYB2N.APPOINTMENTS"
  ],
  "created_at": "2025-12-02T21:09:15.405Z",
  "given_name": "Yawen",
  "updated_at": "2025-12-02T21:09:18Z",
  "family_name": "Mackey",
  "preferences": {
    "email_unsubscribed": false
  },
  "phone_number": "+15083357482",
  "email_address": "yawensung@gmail.com",
  "creation_source": "APPOINTMENTS"
}
üë§ Processing customer creation: V56R2CDR6R4Q85KE6KV4NRGXD0
üìç IP Address: unknown
üìß Email: yawensung@gmail.com
üìû Phone: +15083357482
üë§ Name: Yawen Mackey
‚ö†Ô∏è Suspicious IP activity detected: unknown used by 129 customers
‚ö†Ô∏è Suspicious activity detected for customer V56R2CDR6R4Q85KE6KV4NRGXD0, flagging for review
üéâ New customer detected: V56R2CDR6R4Q85KE6KV4NRGXD0
‚úÖ Customer added to database as NEW (temporary mark)
   - Will check for referral code when they book
   - Will give gift card on first booking if code found
‚úÖ Verification: Customer found in DB: true
{"ts":"2025-12-02T21:45:41.459Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"d0485b3e-7118-4972-a6d7-8b379f63ac3b","stage":"customer_ingest","correlationId":"customer-created:ffe30025dcf5daaa6b0d6068"}
{"ts":"2025-12-02T21:45:41.938Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"a34deb3d-5907-4df8-b10b-a8518277c57f","stage":"booking","correlationId":"booking-created:c5feaec860385e8037736644","attempts":1}
üìÖ Processing booking created for customer: V56R2CDR6R4Q85KE6KV4NRGXD0
Full booking data: {
  "id": "tdokvr5vph5iam",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-03T17:00:00Z",
  "created_at": "2025-12-02T21:09:18Z",
  "updated_at": "2025-12-02T21:09:18Z",
  "customer_id": "V56R2CDR6R4Q85KE6KV4NRGXD0",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "V56R2CDR6R4Q85KE6KV4NRGXD0",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMe-bT5XxKxmk0nw",
      "any_team_member": true,
      "duration_minutes": 140,
      "intermission_minutes": 0,
      "service_variation_id": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "CJI5WHOAKSFTASYPJ4MSYZLS"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Yawen Mackey
üéâ First booking detected for customer: V56R2CDR6R4Q85KE6KV4NRGXD0
   Name: Yawen Mackey
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer V56R2CDR6R4Q85KE6KV4NRGXD0...
Error getting custom attributes for customer V56R2CDR6R4Q85KE6KV4NRGXD0: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: V56R2CDR6R4Q85KE6KV4NRGXD0
{"ts":"2025-12-02T21:45:42.892Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"a34deb3d-5907-4df8-b10b-a8518277c57f","stage":"booking","correlationId":"booking-created:c5feaec860385e8037736644"}
{"ts":"2025-12-02T21:45:43.488Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"23cd07f5-af63-43e4-b358-8dfe4c536cc8","stage":"booking","correlationId":"booking-created:5d8818e491f7db51d934e109","attempts":1}
üìÖ Processing booking created for customer: NCRQRN5BTS4RDEKE2NKFXQQCHR
Full booking data: {
  "id": "gfnq21uooqxwv6",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-05T23:10:00Z",
  "created_at": "2025-12-02T21:12:55Z",
  "updated_at": "2025-12-02T21:12:55Z",
  "customer_id": "NCRQRN5BTS4RDEKE2NKFXQQCHR",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMWAtQTYmZpwwxii"
  },
  "appointment_segments": [
    {
      "team_member_id": "TM-zXe9fXe4axYWn",
      "any_team_member": false,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "HXLBKQC3DRE57DB7IK5RBYOB",
      "service_variation_version": 1758654327496,
      "service_variation_client_id": "HXLBKQC3DRE57DB7IK5RBYOB"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Zoe RusselHapp
Error retrieving Square customer NCRQRN5BTS4RDEKE2NKFXQQCHR: Response status code was not ok: 401.
Square API errors: [
  {
    "category": "AUTHENTICATION_ERROR",
    "code": "UNAUTHORIZED",
    "detail": "This request could not be authorized."
  }
]
üéâ First booking detected for customer: NCRQRN5BTS4RDEKE2NKFXQQCHR
   Name: Zoe RusselHapp
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer NCRQRN5BTS4RDEKE2NKFXQQCHR...
Error getting custom attributes for customer NCRQRN5BTS4RDEKE2NKFXQQCHR: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: NCRQRN5BTS4RDEKE2NKFXQQCHR
{"ts":"2025-12-02T21:45:46.626Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"23cd07f5-af63-43e4-b358-8dfe4c536cc8","stage":"booking","correlationId":"booking-created:5d8818e491f7db51d934e109"}
{"ts":"2025-12-02T21:45:46.839Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"4cfd50a1-b200-4709-873e-471f07e9447f","stage":"booking","correlationId":"booking-created:ed909c0e6e1db208a1158011","attempts":1}
üìÖ Processing booking created for customer: W56S712KAJK7A6QNBQ5A03ETGC
Full booking data: {
  "id": "8x46ikxn1v23o2",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-31T17:00:00Z",
  "created_at": "2025-12-02T21:20:38Z",
  "updated_at": "2025-12-02T21:20:38Z",
  "customer_id": "W56S712KAJK7A6QNBQ5A03ETGC",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMQPbDVvvOCLwqsy"
  },
  "appointment_segments": [
    {
      "team_member_id": "TM9jDlRr_Hl4rdBB",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "XBUDIMNKOPC2XVG5YLIQ4RYS",
      "service_variation_version": 1764609577793,
      "service_variation_client_id": "XBUDIMNKOPC2XVG5YLIQ4RYS"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Jessica Clements
üéâ First booking detected for customer: W56S712KAJK7A6QNBQ5A03ETGC
   Name: Jessica Clements
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer W56S712KAJK7A6QNBQ5A03ETGC...
Error getting custom attributes for customer W56S712KAJK7A6QNBQ5A03ETGC: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: W56S712KAJK7A6QNBQ5A03ETGC
{"ts":"2025-12-02T21:45:47.231Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"4cfd50a1-b200-4709-873e-471f07e9447f","stage":"booking","correlationId":"booking-created:ed909c0e6e1db208a1158011"}
{"ts":"2025-12-02T21:45:47.393Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"09ef8711-9bbf-4fa1-af4b-0e98ba273d94","stage":"payment","correlationId":"payment-updated:3f9994bc8e20d2429d588b74","attempts":1}
üí∞ Processing payment completion for customer: JHSRA7KN16Z63EMD1HV8T1757R
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Alexis Haynes
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Alexis Haynes, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Alexis Haynes
   - Email: alexisannhaynes@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: JHSRA7KN16Z63EMD1HV8T1757R
{"ts":"2025-12-02T21:45:47.731Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"09ef8711-9bbf-4fa1-af4b-0e98ba273d94","stage":"payment","correlationId":"payment-updated:3f9994bc8e20d2429d588b74"}
{"ts":"2025-12-02T21:45:48.012Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"f1f29965-bf27-4ed2-b79b-56d1661b622a","stage":"payment","correlationId":"payment-updated:4fa823e6cd8fa27f3f6d1490","attempts":1}
üí∞ Processing payment completion for customer: JHSRA7KN16Z63EMD1HV8T1757R
   Payment source_type: CARD
   Payment tender_types: []
Customer JHSRA7KN16Z63EMD1HV8T1757R already completed first payment
{"ts":"2025-12-02T21:45:48.368Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"f1f29965-bf27-4ed2-b79b-56d1661b622a","stage":"payment","correlationId":"payment-updated:4fa823e6cd8fa27f3f6d1490"}
{"ts":"2025-12-02T21:45:48.542Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"3aa086c1-ab4f-4d78-b0dc-39cdb11388cf","stage":"booking","correlationId":"booking-created:ceb828793512b044fc43d57f","attempts":1}
üìÖ Processing booking created for customer: JHSRA7KN16Z63EMD1HV8T1757R
Full booking data: {
  "id": "k228pfxb7i3v48",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-30T19:00:00Z",
  "created_at": "2025-12-02T21:27:13Z",
  "updated_at": "2025-12-02T21:27:13Z",
  "customer_id": "JHSRA7KN16Z63EMD1HV8T1757R",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMWAtQTYmZpwwxii"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMILsQUVwLkLzbVo",
      "any_team_member": false,
      "duration_minutes": 100,
      "intermission_minutes": 0,
      "service_variation_id": "BM556FTNFOTEHYVG4GPXAXFM",
      "service_variation_version": 1762893947284,
      "service_variation_client_id": "BM556FTNFOTEHYVG4GPXAXFM"
    },
    {
      "team_member_id": "TMILsQUVwLkLzbVo",
      "any_team_member": false,
      "duration_minutes": 20,
      "intermission_minutes": 0,
      "service_variation_id": "HAJX45W3U2WUCCXM5MI24UEE",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "HAJX45W3U2WUCCXM5MI24UEE"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Alexis Haynes
üéâ First booking detected for customer: JHSRA7KN16Z63EMD1HV8T1757R
   Name: Alexis Haynes
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer JHSRA7KN16Z63EMD1HV8T1757R...
Error getting custom attributes for customer JHSRA7KN16Z63EMD1HV8T1757R: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: JHSRA7KN16Z63EMD1HV8T1757R
{"ts":"2025-12-02T21:45:48.924Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"3aa086c1-ab4f-4d78-b0dc-39cdb11388cf","stage":"booking","correlationId":"booking-created:ceb828793512b044fc43d57f"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-12-02T21:54:53.712Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-02T21:54:56.720Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"02dd72a3-b45f-41cd-9fa2-7383eef2336f","stage":"booking","correlationId":"booking-created:4f629826b32903d8607340b4","attempts":1}
üìÖ Processing booking created for customer: 9CKA0D9BXK4V7Q0F2SPRPX5JYM
Full booking data: {
  "id": "ldpr2pxnrjy0ma",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-03T22:30:00Z",
  "created_at": "2025-12-02T21:45:59Z",
  "updated_at": "2025-12-02T21:45:59Z",
  "customer_id": "9CKA0D9BXK4V7Q0F2SPRPX5JYM",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMQPbDVvvOCLwqsy"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMyUMvTJIj2HrHSg",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "JMTK5M2CY2W7WEXSTAJKAJ35",
      "service_variation_version": 1762893947284,
      "service_variation_client_id": "JMTK5M2CY2W7WEXSTAJKAJ35"
    },
    {
      "resource_ids": [
        "KAOXILA4CV7A23VRAACC4R66"
      ],
      "team_member_id": "TMyUMvTJIj2HrHSg",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "ZEAKNB35I37RMXNUBGWDZQIM",
      "service_variation_version": 1760895536505,
      "service_variation_client_id": "ZEAKNB35I37RMXNUBGWDZQIM"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Sienna Torney
üéâ First booking detected for customer: 9CKA0D9BXK4V7Q0F2SPRPX5JYM
   Name: Sienna Torney
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 9CKA0D9BXK4V7Q0F2SPRPX5JYM...
Error getting custom attributes for customer 9CKA0D9BXK4V7Q0F2SPRPX5JYM: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 9CKA0D9BXK4V7Q0F2SPRPX5JYM
{"ts":"2025-12-02T21:54:57.713Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"02dd72a3-b45f-41cd-9fa2-7383eef2336f","stage":"booking","correlationId":"booking-created:4f629826b32903d8607340b4"}
{"ts":"2025-12-02T21:57:49.461Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"36ee24ed-db4a-4800-a62b-7b6a5e96c406","stage":"booking","correlationId":"booking-created:46b1981842df71bd48b0045e","attempts":1}
üìÖ Processing booking created for customer: 43FR88N8XEPYC9JV69WRY0X70W
Full booking data: {
  "id": "k874n1wxygaujd",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-16T20:00:00Z",
  "created_at": "2025-12-02T21:57:45Z",
  "updated_at": "2025-12-02T21:57:45Z",
  "customer_id": "43FR88N8XEPYC9JV69WRY0X70W",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMQPbDVvvOCLwqsy"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMyUMvTJIj2HrHSg",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "JMTK5M2CY2W7WEXSTAJKAJ35",
      "service_variation_version": 1762893947284,
      "service_variation_client_id": "JMTK5M2CY2W7WEXSTAJKAJ35"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Cassondra Segovia
üéâ First booking detected for customer: 43FR88N8XEPYC9JV69WRY0X70W
   Name: Cassondra Segovia
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 43FR88N8XEPYC9JV69WRY0X70W...
Error getting custom attributes for customer 43FR88N8XEPYC9JV69WRY0X70W: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 43FR88N8XEPYC9JV69WRY0X70W
{"ts":"2025-12-02T21:57:50.057Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"36ee24ed-db4a-4800-a62b-7b6a5e96c406","stage":"booking","correlationId":"booking-created:46b1981842df71bd48b0045e"}
{"ts":"2025-12-02T21:59:39.100Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"e93cc775-eefe-480d-99a7-8df88c740bf7","stage":"booking","correlationId":"booking-created:f10b362820cb66dd7841c8af","attempts":1}
üìÖ Processing booking created for customer: WZNZMGRVY2E373BZJVV0DBDBNW
Full booking data: {
  "id": "chpdeo10c7zxm7",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-03T21:00:00Z",
  "created_at": "2025-12-02T21:59:35Z",
  "updated_at": "2025-12-02T21:59:35Z",
  "customer_id": "WZNZMGRVY2E373BZJVV0DBDBNW",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "WZNZMGRVY2E373BZJVV0DBDBNW",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMXiw38Bbb7XQUWI",
      "any_team_member": true,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1764609601083,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Corinna King-Brown
üéâ First booking detected for customer: WZNZMGRVY2E373BZJVV0DBDBNW
   Name: Corinna King-Brown
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer WZNZMGRVY2E373BZJVV0DBDBNW...
Error getting custom attributes for customer WZNZMGRVY2E373BZJVV0DBDBNW: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: WZNZMGRVY2E373BZJVV0DBDBNW
{"ts":"2025-12-02T21:59:40.576Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"e93cc775-eefe-480d-99a7-8df88c740bf7","stage":"booking","correlationId":"booking-created:f10b362820cb66dd7841c8af"}
{"ts":"2025-12-02T21:59:54.006Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"ffd6d82b-10b7-427f-b421-49a2e1a2ab51","stage":"payment","correlationId":"payment-updated:779253764a53f5e44b462f67","attempts":1}
üí∞ Processing payment completion for customer: P8F14M0HPR5KYEM70AH708K69W
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Susie Roy
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Susie Roy, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Susie Roy
   - Email: susiemillerroy@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: P8F14M0HPR5KYEM70AH708K69W
{"ts":"2025-12-02T21:59:54.978Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"ffd6d82b-10b7-427f-b421-49a2e1a2ab51","stage":"payment","correlationId":"payment-updated:779253764a53f5e44b462f67"}
{"ts":"2025-12-02T21:59:58.732Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"2832eeba-eac2-46a6-8588-60c6e27c2ef5","stage":"payment","correlationId":"payment-updated:4cddbaa8996c94b21cecc2ec","attempts":1}
üí∞ Processing payment completion for customer: P8F14M0HPR5KYEM70AH708K69W
   Payment source_type: CARD
   Payment tender_types: []
Customer P8F14M0HPR5KYEM70AH708K69W already completed first payment
{"ts":"2025-12-02T21:59:59.290Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"2832eeba-eac2-46a6-8588-60c6e27c2ef5","stage":"payment","correlationId":"payment-updated:4cddbaa8996c94b21cecc2ec"}
{"ts":"2025-12-02T22:02:25.431Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"e5ef7702-ef26-4da0-b6dc-15c81ddc95e3","stage":"payment","correlationId":"payment-updated:405dbc8d2a0b127f32f2b467","attempts":1}
üí∞ Processing payment completion for customer: Y4BC8KGTD2PZ3ZB04916RKP85M
   Payment source_type: CARD
   Payment tender_types: []
Customer Y4BC8KGTD2PZ3ZB04916RKP85M already completed first payment
{"ts":"2025-12-02T22:02:25.785Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"e5ef7702-ef26-4da0-b6dc-15c81ddc95e3","stage":"payment","correlationId":"payment-updated:405dbc8d2a0b127f32f2b467"}
{"ts":"2025-12-02T22:02:30.447Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"7d7a7ac7-d5f3-47af-8977-097a7fb167fe","stage":"payment","correlationId":"payment-updated:a475e67fd56f2bc6cadbe44b","attempts":1}
üí∞ Processing payment completion for customer: Y4BC8KGTD2PZ3ZB04916RKP85M
   Payment source_type: CARD
   Payment tender_types: []
Customer Y4BC8KGTD2PZ3ZB04916RKP85M already completed first payment
{"ts":"2025-12-02T22:02:30.807Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"7d7a7ac7-d5f3-47af-8977-097a7fb167fe","stage":"payment","correlationId":"payment-updated:a475e67fd56f2bc6cadbe44b"}
{"ts":"2025-12-02T22:03:41.949Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"810ddcbe-9be5-4a52-bff9-730ac2616e8e","stage":"booking","correlationId":"booking-created:afa956476f6466df7291f982","attempts":1}
üìÖ Processing booking created for customer: Y4BC8KGTD2PZ3ZB04916RKP85M
Full booking data: {
  "id": "5cxyylvbpfywz0",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-23T23:30:00Z",
  "created_at": "2025-12-02T22:03:38Z",
  "updated_at": "2025-12-02T22:03:38Z",
  "customer_id": "Y4BC8KGTD2PZ3ZB04916RKP85M",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMWAtQTYmZpwwxii"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMVwAQUdLz6no-cB",
      "any_team_member": false,
      "duration_minutes": 100,
      "intermission_minutes": 0,
      "service_variation_id": "GSZZR45VJXB44NF4P4WXI5NB",
      "service_variation_version": 1764609577793,
      "service_variation_client_id": "GSZZR45VJXB44NF4P4WXI5NB"
    },
    {
      "resource_ids": [
        "5OVIQ6GSSUXORACP6T7WBAQ7"
      ],
      "team_member_id": "TMVwAQUdLz6no-cB",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "ZEAKNB35I37RMXNUBGWDZQIM",
      "service_variation_version": 1760895536505,
      "service_variation_client_id": "ZEAKNB35I37RMXNUBGWDZQIM"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Carrie Maxwell
üéâ First booking detected for customer: Y4BC8KGTD2PZ3ZB04916RKP85M
   Name: Carrie Maxwell
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer Y4BC8KGTD2PZ3ZB04916RKP85M...
Error getting custom attributes for customer Y4BC8KGTD2PZ3ZB04916RKP85M: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: Y4BC8KGTD2PZ3ZB04916RKP85M
{"ts":"2025-12-02T22:03:42.719Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"810ddcbe-9be5-4a52-bff9-730ac2616e8e","stage":"booking","correlationId":"booking-created:afa956476f6466df7291f982"}
{"ts":"2025-12-02T22:09:50.089Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"4b296d70-5393-4a2c-ab0b-8ab07678874c","stage":"booking","correlationId":"booking-created:0725f529f373195d3559bf04","attempts":1}
üìÖ Processing booking created for customer: ZWRC692BV3GAH9HDJXGTSDWA6W
Full booking data: {
  "id": "rmeux446rnfwn0",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-03T00:00:00Z",
  "created_at": "2025-12-02T22:09:48Z",
  "updated_at": "2025-12-02T22:09:48Z",
  "customer_id": "ZWRC692BV3GAH9HDJXGTSDWA6W",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMWAtQTYmZpwwxii"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMILsQUVwLkLzbVo",
      "any_team_member": false,
      "duration_minutes": 100,
      "intermission_minutes": 0,
      "service_variation_id": "BM556FTNFOTEHYVG4GPXAXFM",
      "service_variation_version": 1762893947284,
      "service_variation_client_id": "BM556FTNFOTEHYVG4GPXAXFM"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Vera Watt
üéâ First booking detected for customer: ZWRC692BV3GAH9HDJXGTSDWA6W
   Name: Vera Watt
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer ZWRC692BV3GAH9HDJXGTSDWA6W...
Error getting custom attributes for customer ZWRC692BV3GAH9HDJXGTSDWA6W: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: ZWRC692BV3GAH9HDJXGTSDWA6W
{"ts":"2025-12-02T22:09:50.760Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"4b296d70-5393-4a2c-ab0b-8ab07678874c","stage":"booking","correlationId":"booking-created:0725f529f373195d3559bf04"}
{"ts":"2025-12-02T22:24:09.050Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"6c58f3c4-4510-4d8f-9b30-aac5b6eee2c9","stage":"booking","correlationId":"booking-created:f4f080d9e2e78ddd6bf2ac36","attempts":1}
üìÖ Processing booking created for customer: FQ69H2YCAWPFF2PAZQNACH8KFC
Full booking data: {
  "id": "bj6ruojbhfj0bw",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-09T17:00:00Z",
  "created_at": "2025-12-02T22:24:06Z",
  "updated_at": "2025-12-02T22:24:06Z",
  "customer_id": "FQ69H2YCAWPFF2PAZQNACH8KFC",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "FQ69H2YCAWPFF2PAZQNACH8KFC",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TM7_r-KmvY9xjnEU",
      "any_team_member": false,
      "duration_minutes": 45,
      "intermission_minutes": 0,
      "service_variation_id": "VVA7G2UN7N2HUFMCW5LQOVHB",
      "service_variation_version": 1760141204155,
      "service_variation_client_id": "VVA7G2UN7N2HUFMCW5LQOVHB"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Ksenia Klochkova
üéâ First booking detected for customer: FQ69H2YCAWPFF2PAZQNACH8KFC
   Name: Ksenia Klochkova
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer FQ69H2YCAWPFF2PAZQNACH8KFC...
Error getting custom attributes for customer FQ69H2YCAWPFF2PAZQNACH8KFC: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: FQ69H2YCAWPFF2PAZQNACH8KFC
{"ts":"2025-12-02T22:24:09.723Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"6c58f3c4-4510-4d8f-9b30-aac5b6eee2c9","stage":"booking","correlationId":"booking-created:f4f080d9e2e78ddd6bf2ac36"}
{"ts":"2025-12-02T22:28:57.616Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"2ee97388-5fa8-4e49-9821-688bd92708f9","stage":"booking","correlationId":"booking-created:b738bedb74ad9f40d7e29877","attempts":1}
üìÖ Processing booking created for customer: 6PQ82YBVJ5G1WRQ46A1KR3KWBM
Full booking data: {
  "id": "24eooox1ydwwba",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-03T23:30:00Z",
  "created_at": "2025-12-02T22:28:55Z",
  "updated_at": "2025-12-02T22:28:55Z",
  "customer_id": "6PQ82YBVJ5G1WRQ46A1KR3KWBM",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMWAtQTYmZpwwxii"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMMBgVwykMnOlumA",
      "any_team_member": false,
      "duration_minutes": 30,
      "intermission_minutes": 0,
      "service_variation_id": "SGSLS3INMK5YV637KUITCILL",
      "service_variation_version": 1760895536505,
      "service_variation_client_id": "SGSLS3INMK5YV637KUITCILL"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Candice Adden
üéâ First booking detected for customer: 6PQ82YBVJ5G1WRQ46A1KR3KWBM
   Name: Candice Adden
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 6PQ82YBVJ5G1WRQ46A1KR3KWBM...
Error getting custom attributes for customer 6PQ82YBVJ5G1WRQ46A1KR3KWBM: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 6PQ82YBVJ5G1WRQ46A1KR3KWBM
{"ts":"2025-12-02T22:28:58.524Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"2ee97388-5fa8-4e49-9821-688bd92708f9","stage":"booking","correlationId":"booking-created:b738bedb74ad9f40d7e29877"}
{"ts":"2025-12-02T22:59:11.603Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"8c9dd4e1-6c50-4b42-9841-84d0de88b045","stage":"customer_ingest","correlationId":"customer-created:c72cdff2eac1e9607bd2ffab","attempts":1}
üì• Received customer data: {
  "id": "33VX2YKRQ8STP230XRJM3K6NA4",
  "address": {
    "country": "US"
  },
  "version": 0,
  "group_ids": [
    "LT4ZHFBQQYB2N.APPOINTMENTS"
  ],
  "created_at": "2025-12-02T22:59:08.49Z",
  "given_name": "Gaia",
  "updated_at": "2025-12-02T22:59:08Z",
  "family_name": "Simonian",
  "preferences": {
    "email_unsubscribed": false
  },
  "phone_number": "+16172307490",
  "email_address": "Gsimonyan11@gmail.com",
  "creation_source": "APPOINTMENTS"
}
üë§ Processing customer creation: 33VX2YKRQ8STP230XRJM3K6NA4
üìç IP Address: unknown
üìß Email: Gsimonyan11@gmail.com
üìû Phone: +16172307490
üë§ Name: Gaia Simonian
‚ö†Ô∏è Suspicious IP activity detected: unknown used by 130 customers
‚ö†Ô∏è Suspicious activity detected for customer 33VX2YKRQ8STP230XRJM3K6NA4, flagging for review
üéâ New customer detected: 33VX2YKRQ8STP230XRJM3K6NA4
‚úÖ Customer added to database as NEW (temporary mark)
   - Will check for referral code when they book
   - Will give gift card on first booking if code found
‚úÖ Verification: Customer found in DB: true
{"ts":"2025-12-02T22:59:12.230Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"8c9dd4e1-6c50-4b42-9841-84d0de88b045","stage":"customer_ingest","correlationId":"customer-created:c72cdff2eac1e9607bd2ffab"}
{"ts":"2025-12-02T22:59:14.514Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"3865e6d0-d0b5-4966-96f0-293bf0c9229d","stage":"booking","correlationId":"booking-created:8df8c9738d60e315853d3352","attempts":1}
üìÖ Processing booking created for customer: 33VX2YKRQ8STP230XRJM3K6NA4
Full booking data: {
  "id": "3nokzcc3jw8lay",
  "source": "THIRD_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-24T00:30:00Z",
  "created_at": "2025-12-02T22:59:11Z",
  "updated_at": "2025-12-02T22:59:11Z",
  "customer_id": "33VX2YKRQ8STP230XRJM3K6NA4",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "33VX2YKRQ8STP230XRJM3K6NA4",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMgsjtuk5cfKnstq",
      "any_team_member": false,
      "duration_minutes": 110,
      "intermission_minutes": 0,
      "service_variation_id": "6TYOE67IDYTKHW2ZG6HKVZER",
      "service_variation_version": 1764609577793,
      "service_variation_client_id": "6TYOE67IDYTKHW2ZG6HKVZER"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Gaia Simonian
üéâ First booking detected for customer: 33VX2YKRQ8STP230XRJM3K6NA4
   Name: Gaia Simonian
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 33VX2YKRQ8STP230XRJM3K6NA4...
Error getting custom attributes for customer 33VX2YKRQ8STP230XRJM3K6NA4: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 33VX2YKRQ8STP230XRJM3K6NA4
{"ts":"2025-12-02T22:59:14.958Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"3865e6d0-d0b5-4966-96f0-293bf0c9229d","stage":"booking","correlationId":"booking-created:8df8c9738d60e315853d3352"}
{"ts":"2025-12-02T23:01:42.388Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"7de8e1e2-4ce4-48f5-9c0f-e1a138504848","stage":"booking","correlationId":"booking-created:59144afc2ae7ecdbda2c9b9f","attempts":1}
üìÖ Processing booking created for customer: 8QZMQK99PZH7D9DBY4KM639NGM
Full booking data: {
  "id": "nlit6bzcgdph0b",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-03T17:30:00Z",
  "created_at": "2025-12-02T23:01:40Z",
  "updated_at": "2025-12-02T23:01:40Z",
  "customer_id": "8QZMQK99PZH7D9DBY4KM639NGM",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMWAtQTYmZpwwxii"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMSt73bSp59caRzt",
      "any_team_member": false,
      "duration_minutes": 140,
      "intermission_minutes": 0,
      "service_variation_id": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "CJI5WHOAKSFTASYPJ4MSYZLS"
    },
    {
      "team_member_id": "TMSt73bSp59caRzt",
      "any_team_member": false,
      "duration_minutes": 5,
      "intermission_minutes": 0,
      "service_variation_id": "DBRXEHQPCF7V4APTHDQTZW62",
      "service_variation_version": 1762374620368,
      "service_variation_client_id": "DBRXEHQPCF7V4APTHDQTZW62"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Cauteaux Vrakelos
üéâ First booking detected for customer: 8QZMQK99PZH7D9DBY4KM639NGM
   Name: Cauteaux Vrakelos
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 8QZMQK99PZH7D9DBY4KM639NGM...
Error getting custom attributes for customer 8QZMQK99PZH7D9DBY4KM639NGM: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 8QZMQK99PZH7D9DBY4KM639NGM
{"ts":"2025-12-02T23:01:43.604Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"7de8e1e2-4ce4-48f5-9c0f-e1a138504848","stage":"booking","correlationId":"booking-created:59144afc2ae7ecdbda2c9b9f"}
{"ts":"2025-12-02T23:02:30.324Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"7c8433d2-c1b7-4e5e-af5a-451b3f7848b3","stage":"booking","correlationId":"booking-created:0d878ef1fdaa8002e31ae588","attempts":1}
üìÖ Processing booking created for customer: 2TCXHRN3KH62HF1CSA2NKPGA1M
Full booking data: {
  "id": "9wn0htegdhs8d9",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-15T19:20:00Z",
  "created_at": "2025-12-02T23:02:26Z",
  "updated_at": "2025-12-02T23:02:26Z",
  "customer_id": "2TCXHRN3KH62HF1CSA2NKPGA1M",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMQPbDVvvOCLwqsy"
  },
  "appointment_segments": [
    {
      "team_member_id": "TM7_r-KmvY9xjnEU",
      "any_team_member": false,
      "duration_minutes": 110,
      "intermission_minutes": 0,
      "service_variation_id": "GJ5SRTYFV6ZCDI62TMSZP2OP",
      "service_variation_version": 1764609577793,
      "service_variation_client_id": "GJ5SRTYFV6ZCDI62TMSZP2OP"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Stacy Barnes
üéâ First booking detected for customer: 2TCXHRN3KH62HF1CSA2NKPGA1M
   Name: Stacy Barnes
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 2TCXHRN3KH62HF1CSA2NKPGA1M...
Error getting custom attributes for customer 2TCXHRN3KH62HF1CSA2NKPGA1M: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 2TCXHRN3KH62HF1CSA2NKPGA1M
{"ts":"2025-12-02T23:02:30.882Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"7c8433d2-c1b7-4e5e-af5a-451b3f7848b3","stage":"booking","correlationId":"booking-created:0d878ef1fdaa8002e31ae588"}
{"ts":"2025-12-02T23:02:31.041Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"3140da06-ec85-428b-859e-50a2828165de","stage":"booking","correlationId":"booking-created:6a93f9835e8276cf004864d3","attempts":1}
üìÖ Processing booking created for customer: 8QZMQK99PZH7D9DBY4KM639NGM
Full booking data: {
  "id": "85iy7mda4thql1",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-03T17:30:00Z",
  "created_at": "2025-12-02T23:02:27Z",
  "updated_at": "2025-12-02T23:02:27Z",
  "customer_id": "8QZMQK99PZH7D9DBY4KM639NGM",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMWAtQTYmZpwwxii"
  },
  "appointment_segments": [
    {
      "resource_ids": [
        "F2MBRCC42VNNDWXNA3PAMHEU"
      ],
      "team_member_id": "TM-zXe9fXe4axYWn",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "ZEAKNB35I37RMXNUBGWDZQIM",
      "service_variation_version": 1760895536505,
      "service_variation_client_id": "ZEAKNB35I37RMXNUBGWDZQIM"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Cauteaux Vrakelos
üéâ First booking detected for customer: 8QZMQK99PZH7D9DBY4KM639NGM
   Name: Cauteaux Vrakelos
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 8QZMQK99PZH7D9DBY4KM639NGM...
Error getting custom attributes for customer 8QZMQK99PZH7D9DBY4KM639NGM: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 8QZMQK99PZH7D9DBY4KM639NGM
{"ts":"2025-12-02T23:02:31.525Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"3140da06-ec85-428b-859e-50a2828165de","stage":"booking","correlationId":"booking-created:6a93f9835e8276cf004864d3"}
{"ts":"2025-12-02T23:03:53.325Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"aba6431b-00d6-4452-825b-a1e6151d45e1","stage":"booking","correlationId":"booking-created:c4360991ef7ae424733a0f8e","attempts":1}
üìÖ Processing booking created for customer: 69RTTY8H2DX69H0MM4P495E8AM
Full booking data: {
  "id": "yk3sdfr8221kkl",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-15T19:20:00Z",
  "created_at": "2025-12-02T23:03:50Z",
  "updated_at": "2025-12-02T23:03:50Z",
  "customer_id": "69RTTY8H2DX69H0MM4P495E8AM",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMQPbDVvvOCLwqsy"
  },
  "appointment_segments": [
    {
      "team_member_id": "TM7_r-KmvY9xjnEU",
      "any_team_member": false,
      "duration_minutes": 110,
      "intermission_minutes": 0,
      "service_variation_id": "GJ5SRTYFV6ZCDI62TMSZP2OP",
      "service_variation_version": 1764609577793,
      "service_variation_client_id": "GJ5SRTYFV6ZCDI62TMSZP2OP"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Linley Kaye
üéâ First booking detected for customer: 69RTTY8H2DX69H0MM4P495E8AM
   Name: Linley Kaye
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 69RTTY8H2DX69H0MM4P495E8AM...
Error getting custom attributes for customer 69RTTY8H2DX69H0MM4P495E8AM: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 69RTTY8H2DX69H0MM4P495E8AM
{"ts":"2025-12-02T23:03:53.873Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"aba6431b-00d6-4452-825b-a1e6151d45e1","stage":"booking","correlationId":"booking-created:c4360991ef7ae424733a0f8e"}
{"ts":"2025-12-02T23:11:11.676Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"5b09faac-90e9-4a70-b361-310b1b30a0a6","stage":"booking","correlationId":"booking-created:212cc11efcf9cd4c0b8914ab","attempts":1}
üìÖ Processing booking created for customer: 6XW971FQS4D8Y01EHA23YGV3PW
Full booking data: {
  "id": "duk14jahgvsauj",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-03T19:45:00Z",
  "created_at": "2025-12-02T23:11:10Z",
  "updated_at": "2025-12-02T23:11:10Z",
  "customer_id": "6XW971FQS4D8Y01EHA23YGV3PW",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMWAtQTYmZpwwxii"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMgsjtuk5cfKnstq",
      "any_team_member": false,
      "duration_minutes": 150,
      "intermission_minutes": 0,
      "service_variation_id": "4QI3JWGEYQANKCGC36J3MYNB",
      "service_variation_version": 1758654327496,
      "service_variation_client_id": "4QI3JWGEYQANKCGC36J3MYNB"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Kelly Stavish
üéâ First booking detected for customer: 6XW971FQS4D8Y01EHA23YGV3PW
   Name: Kelly Stavish
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 6XW971FQS4D8Y01EHA23YGV3PW...
Error getting custom attributes for customer 6XW971FQS4D8Y01EHA23YGV3PW: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 6XW971FQS4D8Y01EHA23YGV3PW
{"ts":"2025-12-02T23:11:13.220Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"5b09faac-90e9-4a70-b361-310b1b30a0a6","stage":"booking","correlationId":"booking-created:212cc11efcf9cd4c0b8914ab"}
{"ts":"2025-12-02T23:17:13.109Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"20cae773-35bc-4c68-a9d8-3b55dc04e5e7","stage":"booking","correlationId":"booking-created:c7599440fd5bb2f27cb810d2","attempts":1}
üìÖ Processing booking created for customer: 0GZTYPV8F1QJZ55D9CYBX29RZ0
Full booking data: {
  "id": "4e9tkjkzgcs0h9",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-03T00:15:00Z",
  "created_at": "2025-12-02T23:17:10Z",
  "updated_at": "2025-12-02T23:17:10Z",
  "customer_id": "0GZTYPV8F1QJZ55D9CYBX29RZ0",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMWAtQTYmZpwwxii"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMVwAQUdLz6no-cB",
      "any_team_member": false,
      "duration_minutes": 30,
      "intermission_minutes": 0,
      "service_variation_id": "SGSLS3INMK5YV637KUITCILL",
      "service_variation_version": 1760895536505,
      "service_variation_client_id": "SGSLS3INMK5YV637KUITCILL"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Victoria Huang
üéâ First booking detected for customer: 0GZTYPV8F1QJZ55D9CYBX29RZ0
   Name: Victoria Huang
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 0GZTYPV8F1QJZ55D9CYBX29RZ0...
Error getting custom attributes for customer 0GZTYPV8F1QJZ55D9CYBX29RZ0: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 0GZTYPV8F1QJZ55D9CYBX29RZ0
{"ts":"2025-12-02T23:17:13.772Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"20cae773-35bc-4c68-a9d8-3b55dc04e5e7","stage":"booking","correlationId":"booking-created:c7599440fd5bb2f27cb810d2"}
{"ts":"2025-12-02T23:24:33.914Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"8374ac26-5b06-4fe6-aef7-c4b1d341c3a3","stage":"booking","correlationId":"booking-created:a6910a9625a53de511e3e6a6","attempts":1}
üìÖ Processing booking created for customer: QKZ142XSZQKQMM4AKY35SKET3M
Full booking data: {
  "id": "ld6hq8ht0yors9",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-03T20:00:00Z",
  "created_at": "2025-12-02T23:24:30Z",
  "updated_at": "2025-12-02T23:24:30Z",
  "customer_id": "QKZ142XSZQKQMM4AKY35SKET3M",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMQPbDVvvOCLwqsy"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMyUMvTJIj2HrHSg",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "JMTK5M2CY2W7WEXSTAJKAJ35",
      "service_variation_version": 1762893947284,
      "service_variation_client_id": "JMTK5M2CY2W7WEXSTAJKAJ35"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Jereena Justin
üéâ First booking detected for customer: QKZ142XSZQKQMM4AKY35SKET3M
   Name: Jereena Justin
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer QKZ142XSZQKQMM4AKY35SKET3M...
Error getting custom attributes for customer QKZ142XSZQKQMM4AKY35SKET3M: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: QKZ142XSZQKQMM4AKY35SKET3M
{"ts":"2025-12-02T23:24:35.429Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"8374ac26-5b06-4fe6-aef7-c4b1d341c3a3","stage":"booking","correlationId":"booking-created:a6910a9625a53de511e3e6a6"}
{"ts":"2025-12-02T23:29:36.751Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"0542ea07-6197-4188-94b2-ccea5c3a52c0","stage":"payment","correlationId":"payment-updated:11e8ce4bf988b6559900fa5a","attempts":1}
üí∞ Processing payment completion for customer: XERB3P3EVSTPSZVRMX379F28R8
   Payment source_type: CARD
   Payment tender_types: []
Customer XERB3P3EVSTPSZVRMX379F28R8 already completed first payment
{"ts":"2025-12-02T23:29:37.703Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"0542ea07-6197-4188-94b2-ccea5c3a52c0","stage":"payment","correlationId":"payment-updated:11e8ce4bf988b6559900fa5a"}
{"ts":"2025-12-02T23:29:42.391Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"c5de5c25-99f8-434b-b6c8-19e0d794a2dd","stage":"payment","correlationId":"payment-updated:2cfa7e1823db546495502818","attempts":1}
üí∞ Processing payment completion for customer: XERB3P3EVSTPSZVRMX379F28R8
   Payment source_type: CARD
   Payment tender_types: []
Customer XERB3P3EVSTPSZVRMX379F28R8 already completed first payment
{"ts":"2025-12-02T23:29:42.527Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"c5de5c25-99f8-434b-b6c8-19e0d794a2dd","stage":"payment","correlationId":"payment-updated:2cfa7e1823db546495502818"}
{"ts":"2025-12-02T23:30:45.254Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"e4f67785-0ad4-46e0-a537-aa76afd2f311","stage":"booking","correlationId":"booking-created:395c492c8508615a46f6af85","attempts":1}
üìÖ Processing booking created for customer: PFP8Z9H90WZVKCBD494JK13P2W
Full booking data: {
  "id": "w6a7ayb7ke54u2",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-09T00:00:00Z",
  "created_at": "2025-12-02T23:30:42Z",
  "updated_at": "2025-12-02T23:30:42Z",
  "customer_id": "PFP8Z9H90WZVKCBD494JK13P2W",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMWAtQTYmZpwwxii"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMdagA6g0F03A7_w",
      "any_team_member": false,
      "duration_minutes": 140,
      "intermission_minutes": 0,
      "service_variation_id": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "CJI5WHOAKSFTASYPJ4MSYZLS"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: null null
Error retrieving Square customer PFP8Z9H90WZVKCBD494JK13P2W: Response status code was not ok: 401.
Square API errors: [
  {
    "category": "AUTHENTICATION_ERROR",
    "code": "UNAUTHORIZED",
    "detail": "This request could not be authorized."
  }
]
üéâ First booking detected for customer: PFP8Z9H90WZVKCBD494JK13P2W
   Name: null null
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer PFP8Z9H90WZVKCBD494JK13P2W...
Error getting custom attributes for customer PFP8Z9H90WZVKCBD494JK13P2W: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: PFP8Z9H90WZVKCBD494JK13P2W
{"ts":"2025-12-02T23:30:46.100Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"e4f67785-0ad4-46e0-a537-aa76afd2f311","stage":"booking","correlationId":"booking-created:395c492c8508615a46f6af85"}
{"ts":"2025-12-02T23:31:00.190Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"e12c6c6c-f385-4eaf-8d57-fde1c41388e8","stage":"booking","correlationId":"booking-created:8fe6fc3bd8f40074f7ff4169","attempts":1}
üìÖ Processing booking created for customer: PFP8Z9H90WZVKCBD494JK13P2W
Full booking data: {
  "id": "ca13i97a7t80yg",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-09T00:00:00Z",
  "created_at": "2025-12-02T23:30:58Z",
  "updated_at": "2025-12-02T23:30:58Z",
  "customer_id": "PFP8Z9H90WZVKCBD494JK13P2W",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMWAtQTYmZpwwxii"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMMBgVwykMnOlumA",
      "any_team_member": false,
      "duration_minutes": 140,
      "intermission_minutes": 0,
      "service_variation_id": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "CJI5WHOAKSFTASYPJ4MSYZLS"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: null null
Error retrieving Square customer PFP8Z9H90WZVKCBD494JK13P2W: Response status code was not ok: 401.
Square API errors: [
  {
    "category": "AUTHENTICATION_ERROR",
    "code": "UNAUTHORIZED",
    "detail": "This request could not be authorized."
  }
]
üéâ First booking detected for customer: PFP8Z9H90WZVKCBD494JK13P2W
   Name: null null
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer PFP8Z9H90WZVKCBD494JK13P2W...
Error getting custom attributes for customer PFP8Z9H90WZVKCBD494JK13P2W: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: PFP8Z9H90WZVKCBD494JK13P2W
{"ts":"2025-12-02T23:31:01.043Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"e12c6c6c-f385-4eaf-8d57-fde1c41388e8","stage":"booking","correlationId":"booking-created:8fe6fc3bd8f40074f7ff4169"}
{"ts":"2025-12-02T23:31:10.040Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"c6bc9536-e429-44c4-87bb-6b69417e514b","stage":"payment","correlationId":"payment-updated:e995e20bae2d924a3fc0e691","attempts":1}
üí∞ Processing payment completion for customer: 4S77B84J2X58S9PRGRPEPC8XBM
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Lilli Ouyang
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Lilli Ouyang, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Lilli Ouyang
   - Email: philandlill2@yahoo.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: 4S77B84J2X58S9PRGRPEPC8XBM
{"ts":"2025-12-02T23:31:10.703Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"c6bc9536-e429-44c4-87bb-6b69417e514b","stage":"payment","correlationId":"payment-updated:e995e20bae2d924a3fc0e691"}
{"ts":"2025-12-02T23:31:15.701Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"32ae7beb-3595-4c00-9d28-b360f64bf2cb","stage":"payment","correlationId":"payment-updated:d1804678256bbe4c1ca951c2","attempts":1}
üí∞ Processing payment completion for customer: 4S77B84J2X58S9PRGRPEPC8XBM
   Payment source_type: CARD
   Payment tender_types: []
Customer 4S77B84J2X58S9PRGRPEPC8XBM already completed first payment
{"ts":"2025-12-02T23:31:16.067Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"32ae7beb-3595-4c00-9d28-b360f64bf2cb","stage":"payment","correlationId":"payment-updated:d1804678256bbe4c1ca951c2"}
{"ts":"2025-12-02T23:32:52.655Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"1b33427b-8d0f-41f6-8d18-e7ed98e92315","stage":"payment","correlationId":"payment-updated:04eb3591db9af8abc6a98954","attempts":1}
üí∞ Processing payment completion for customer: RZCYD3W904QGWTQX6C521PBH94
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Lisa Glv
‚ùå Referrer not found for code: null
‚úÖ Generated new personal_code in name+ID format: LISA2194
‚ùå Error creating/loading gift card for Lisa Glv: Response status code was not ok: 401.
Square API errors: [
  {
    "category": "AUTHENTICATION_ERROR",
    "code": "UNAUTHORIZED",
    "detail": "This request could not be authorized."
  }
]
‚ùå Failed to create referrer gift card
Error upserting custom attribute "square:a3dde506-f69e-48e4-a98a-004c1822d3ad" for customer RZCYD3W904QGWTQX6C521PBH94: Response status code was not ok: 401.
Square API errors: [
  {
    "category": "AUTHENTICATION_ERROR",
    "code": "UNAUTHORIZED",
    "detail": "This request could not be authorized."
  }
]
Error appending referral note for customer RZCYD3W904QGWTQX6C521PBH94: Response status code was not ok: 401.
Square API errors: [
  {
    "category": "AUTHENTICATION_ERROR",
    "code": "UNAUTHORIZED",
    "detail": "This request could not be authorized."
  }
]
‚ùå Error sending referral email to lisaglv31@gmail.com: Unauthorized
SendGrid error details: {
  errors: [
    {
      message: 'The provided authorization grant is invalid, expired, or revoked',
      field: null,
      help: null
    }
  ]
}
‚ö†Ô∏è Analytics operation "notification_event" failed: 
Invalid `prisma.notificationEvent.create()` invocation in
/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/analytics-service.js:164:39

  161 return runAnalyticsOperation(
  162   'notification_event',
  163   async () => {
‚Üí 164     return prisma.notificationEvent.create({
            data: {
              channel: "EMAIL",
              templateType: "REFERRAL_INVITE",
              status: "failed",
              createdAt: new Date("2025-12-02T23:32:55.418Z"),
              errorCode: 401,
                         ~~~
              errorMessage: "Unauthorized",
              metadata: {
                email: "lisaglv31@gmail.com",
                referralCode: "LISA2194",
                referralUrl: "https://referral-system-salon-fbbq6x1wt-umis-projects-e802f152.vercel.app/ref/LISA2194",
                suppressionGroupId: 28008
              }
            }
          })

Argument `errorCode`: Invalid value provided. Expected String or Null, provided Int.
‚ùå Failed to send email: Unauthorized
‚ÑπÔ∏è SMS sending disabled. Would send referral link to +13473490149
‚è∏Ô∏è SMS sending disabled (skipped sending to +13473490149)
üìß Referral code generated and sent:
   - Customer: Lisa Glv
   - Email: lisaglv31@gmail.com
   - Referral Code: LISA2194
   - Referral URL: https://referral-system-salon-fbbq6x1wt-umis-projects-e802f152.vercel.app/ref/LISA2194
   - Gift Card ID: null
   - Status: Customer is now a referrer
‚úÖ Referral code sent to new client:
   - Customer: Lisa Glv
   - Email: lisaglv31@gmail.com
   - Referral Code: LISA2194
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: RZCYD3W904QGWTQX6C521PBH94
{"ts":"2025-12-02T23:32:55.663Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"1b33427b-8d0f-41f6-8d18-e7ed98e92315","stage":"payment","correlationId":"payment-updated:04eb3591db9af8abc6a98954"}
{"ts":"2025-12-02T23:32:57.955Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"d9c0a8f0-3517-4120-bfa8-ff39491df287","stage":"payment","correlationId":"payment-updated:daa85f32ff98cd015e863d8d","attempts":1}
üí∞ Processing payment completion for customer: RZCYD3W904QGWTQX6C521PBH94
   Payment source_type: CARD
   Payment tender_types: []
Customer RZCYD3W904QGWTQX6C521PBH94 already completed first payment
{"ts":"2025-12-02T23:32:58.096Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"d9c0a8f0-3517-4120-bfa8-ff39491df287","stage":"payment","correlationId":"payment-updated:daa85f32ff98cd015e863d8d"}
{"ts":"2025-12-02T23:36:17.808Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"5070e92c-0c0b-4251-b31c-60aeb3145278","stage":"payment","correlationId":"payment-updated:1742ea1a0bd399486f231acf","attempts":1}
üí∞ Processing payment completion for customer: D6DAGEY5YMWNRTXERPR7XVAMY0
   Payment source_type: CARD
   Payment tender_types: []
Customer D6DAGEY5YMWNRTXERPR7XVAMY0 already completed first payment
{"ts":"2025-12-02T23:36:18.172Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"5070e92c-0c0b-4251-b31c-60aeb3145278","stage":"payment","correlationId":"payment-updated:1742ea1a0bd399486f231acf"}
{"ts":"2025-12-02T23:36:20.464Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"50a402d6-ec23-4778-8277-41606d802c4f","stage":"payment","correlationId":"payment-updated:42d1a9fccecede05db3fd4ed","attempts":1}
üí∞ Processing payment completion for customer: D6DAGEY5YMWNRTXERPR7XVAMY0
   Payment source_type: CARD
   Payment tender_types: []
Customer D6DAGEY5YMWNRTXERPR7XVAMY0 already completed first payment
{"ts":"2025-12-02T23:36:20.601Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"50a402d6-ec23-4778-8277-41606d802c4f","stage":"payment","correlationId":"payment-updated:42d1a9fccecede05db3fd4ed"}
{"ts":"2025-12-02T23:52:12.488Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"5e1894f5-857b-45f1-83dc-526ae3518eb1","stage":"payment","correlationId":"payment-updated:e7f08782a90c83e95a668618","attempts":1}
üí∞ Processing payment completion for customer: M6CRRAP9FAQ6HSTZSXGMEHAKDR
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Yuliana Nevarez
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Yuliana Nevarez, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Yuliana Nevarez
   - Email: yuliana.nevarez@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: M6CRRAP9FAQ6HSTZSXGMEHAKDR
{"ts":"2025-12-02T23:52:14.151Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"5e1894f5-857b-45f1-83dc-526ae3518eb1","stage":"payment","correlationId":"payment-updated:e7f08782a90c83e95a668618"}
{"ts":"2025-12-02T23:52:14.510Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"edc3e281-c52f-4c0d-91a5-c8e2ba6af0e0","stage":"payment","correlationId":"payment-updated:0e65cc54424665336d8e1645","attempts":1}
üí∞ Processing payment completion for customer: M6CRRAP9FAQ6HSTZSXGMEHAKDR
   Payment source_type: CARD
   Payment tender_types: []
Customer M6CRRAP9FAQ6HSTZSXGMEHAKDR already completed first payment
{"ts":"2025-12-02T23:52:14.776Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"edc3e281-c52f-4c0d-91a5-c8e2ba6af0e0","stage":"payment","correlationId":"payment-updated:0e65cc54424665336d8e1645"}
{"ts":"2025-12-02T23:53:57.292Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"1bde49ff-cdb3-4321-bd22-001856ab83e7","stage":"booking","correlationId":"booking-created:11e7399d5541afdf31e0e4d8","attempts":1}
üìÖ Processing booking created for customer: M6CRRAP9FAQ6HSTZSXGMEHAKDR
Full booking data: {
  "id": "07y8gywav15yc0",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-29T23:00:00Z",
  "created_at": "2025-12-02T23:53:54Z",
  "updated_at": "2025-12-02T23:53:54Z",
  "customer_id": "M6CRRAP9FAQ6HSTZSXGMEHAKDR",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMWAtQTYmZpwwxii"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMILsQUVwLkLzbVo",
      "any_team_member": false,
      "duration_minutes": 100,
      "intermission_minutes": 0,
      "service_variation_id": "BM556FTNFOTEHYVG4GPXAXFM",
      "service_variation_version": 1762893947284,
      "service_variation_client_id": "BM556FTNFOTEHYVG4GPXAXFM"
    },
    {
      "team_member_id": "TMILsQUVwLkLzbVo",
      "any_team_member": false,
      "duration_minutes": 20,
      "intermission_minutes": 0,
      "service_variation_id": "HAJX45W3U2WUCCXM5MI24UEE",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "HAJX45W3U2WUCCXM5MI24UEE"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Yuliana Nevarez
üéâ First booking detected for customer: M6CRRAP9FAQ6HSTZSXGMEHAKDR
   Name: Yuliana Nevarez
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer M6CRRAP9FAQ6HSTZSXGMEHAKDR...
Error getting custom attributes for customer M6CRRAP9FAQ6HSTZSXGMEHAKDR: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: M6CRRAP9FAQ6HSTZSXGMEHAKDR
{"ts":"2025-12-02T23:53:57.982Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"1bde49ff-cdb3-4321-bd22-001856ab83e7","stage":"booking","correlationId":"booking-created:11e7399d5541afdf31e0e4d8"}
{"ts":"2025-12-02T23:56:12.173Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"82a717d9-4522-48ba-b097-3699e2428915","stage":"payment","correlationId":"payment-updated:66afb366767fcd27653ba7f7","attempts":1}
üí∞ Processing payment completion for customer: 028EB4QW8W716GTDSZ5MNXG8NC
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Abby Marmer
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Abby Marmer, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Abby Marmer
   - Email: abigailmarmer@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: 028EB4QW8W716GTDSZ5MNXG8NC
{"ts":"2025-12-02T23:56:12.807Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"82a717d9-4522-48ba-b097-3699e2428915","stage":"payment","correlationId":"payment-updated:66afb366767fcd27653ba7f7"}
{"ts":"2025-12-02T23:56:17.535Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"548a4f96-0f41-4976-8c10-7443c68a90ae","stage":"payment","correlationId":"payment-updated:4fbac25057cc8ef4dc6fc75e","attempts":1}
üí∞ Processing payment completion for customer: 028EB4QW8W716GTDSZ5MNXG8NC
   Payment source_type: CARD
   Payment tender_types: []
Customer 028EB4QW8W716GTDSZ5MNXG8NC already completed first payment
{"ts":"2025-12-02T23:56:17.673Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"548a4f96-0f41-4976-8c10-7443c68a90ae","stage":"payment","correlationId":"payment-updated:4fbac25057cc8ef4dc6fc75e"}
{"ts":"2025-12-03T00:08:48.857Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"d3b264a4-cd63-43b4-8572-19c61bfe38ea","stage":"booking","correlationId":"booking-created:c48fff703d7ee9ed4524a19e","attempts":1}
üìÖ Processing booking created for customer: N502KDFVD0S45QA1NSKM1FQBHC
Full booking data: {
  "id": "v5kqwffdlpce12",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-26T19:00:00Z",
  "created_at": "2025-12-03T00:08:46Z",
  "updated_at": "2025-12-03T00:08:46Z",
  "customer_id": "N502KDFVD0S45QA1NSKM1FQBHC",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMQPbDVvvOCLwqsy"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMNW4SIF7tjp4oM_",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "BRSIGZFOWC6F4ERPKX3CODLU",
      "service_variation_version": 1762893947284,
      "service_variation_client_id": "BRSIGZFOWC6F4ERPKX3CODLU"
    },
    {
      "team_member_id": "TMNW4SIF7tjp4oM_",
      "any_team_member": false,
      "duration_minutes": 5,
      "intermission_minutes": 0,
      "service_variation_id": "DBRXEHQPCF7V4APTHDQTZW62",
      "service_variation_version": 1762374620368,
      "service_variation_client_id": "WYYALSW7EFQP5CLOWBH22GPD"
    },
    {
      "team_member_id": "TMNW4SIF7tjp4oM_",
      "any_team_member": false,
      "duration_minutes": 20,
      "intermission_minutes": 0,
      "service_variation_id": "HAJX45W3U2WUCCXM5MI24UEE",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "HAJX45W3U2WUCCXM5MI24UEE"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Ksenia Shchelkonogova
üéâ First booking detected for customer: N502KDFVD0S45QA1NSKM1FQBHC
   Name: Ksenia Shchelkonogova
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer N502KDFVD0S45QA1NSKM1FQBHC...
Error getting custom attributes for customer N502KDFVD0S45QA1NSKM1FQBHC: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: N502KDFVD0S45QA1NSKM1FQBHC
{"ts":"2025-12-03T00:08:50.284Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"d3b264a4-cd63-43b4-8572-19c61bfe38ea","stage":"booking","correlationId":"booking-created:c48fff703d7ee9ed4524a19e"}
{"ts":"2025-12-03T00:09:26.120Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"bc5d36d2-73da-4f92-8b0a-0afd360e617c","stage":"booking","correlationId":"booking-created:76f2f4d965cc424bbf059ec2","attempts":1}
üìÖ Processing booking created for customer: N502KDFVD0S45QA1NSKM1FQBHC
Full booking data: {
  "id": "yypib29b7k5wfz",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-26T19:00:00Z",
  "created_at": "2025-12-03T00:09:22Z",
  "updated_at": "2025-12-03T00:09:22Z",
  "customer_id": "N502KDFVD0S45QA1NSKM1FQBHC",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMQPbDVvvOCLwqsy"
  },
  "appointment_segments": [
    {
      "resource_ids": [
        "KAOXILA4CV7A23VRAACC4R66"
      ],
      "team_member_id": "TM9jDlRr_Hl4rdBB",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "ZEAKNB35I37RMXNUBGWDZQIM",
      "service_variation_version": 1760895536505,
      "service_variation_client_id": "ZEAKNB35I37RMXNUBGWDZQIM"
    },
    {
      "team_member_id": "TM9jDlRr_Hl4rdBB",
      "any_team_member": false,
      "duration_minutes": 20,
      "intermission_minutes": 0,
      "service_variation_id": "HAJX45W3U2WUCCXM5MI24UEE",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "HAJX45W3U2WUCCXM5MI24UEE"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Ksenia Shchelkonogova
üéâ First booking detected for customer: N502KDFVD0S45QA1NSKM1FQBHC
   Name: Ksenia Shchelkonogova
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer N502KDFVD0S45QA1NSKM1FQBHC...
Error getting custom attributes for customer N502KDFVD0S45QA1NSKM1FQBHC: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: N502KDFVD0S45QA1NSKM1FQBHC
{"ts":"2025-12-03T00:09:26.814Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"bc5d36d2-73da-4f92-8b0a-0afd360e617c","stage":"booking","correlationId":"booking-created:76f2f4d965cc424bbf059ec2"}
{"ts":"2025-12-03T00:09:51.867Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"9a9cb5d3-9123-4043-a22b-1dc5928d91d2","stage":"booking","correlationId":"booking-created:55a797861ec11aab3f594c95","attempts":1}
üìÖ Processing booking created for customer: QY21PYNRYD2GFBGA4J7XCKZV8C
Full booking data: {
  "id": "lwoow92glrg7xf",
  "source": "THIRD_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-14T02:00:00Z",
  "created_at": "2025-12-03T00:09:47Z",
  "updated_at": "2025-12-03T00:09:47Z",
  "customer_id": "QY21PYNRYD2GFBGA4J7XCKZV8C",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "QY21PYNRYD2GFBGA4J7XCKZV8C",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TM1L5yPC-yKx6CyO",
      "any_team_member": false,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "NCOIL6ZGDTCC7SO3IJHENCQ2",
      "service_variation_version": 1764609577793,
      "service_variation_client_id": "NCOIL6ZGDTCC7SO3IJHENCQ2"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Aruzhan Tustikbayeva
üéâ First booking detected for customer: QY21PYNRYD2GFBGA4J7XCKZV8C
   Name: Aruzhan Tustikbayeva
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer QY21PYNRYD2GFBGA4J7XCKZV8C...
Error getting custom attributes for customer QY21PYNRYD2GFBGA4J7XCKZV8C: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: QY21PYNRYD2GFBGA4J7XCKZV8C
{"ts":"2025-12-03T00:09:53.027Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"9a9cb5d3-9123-4043-a22b-1dc5928d91d2","stage":"booking","correlationId":"booking-created:55a797861ec11aab3f594c95"}
{"ts":"2025-12-03T00:26:39.694Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"b7c52c3e-79b3-42c6-b4f3-bfe357f018da","stage":"booking","correlationId":"booking-created:95cfd51a05f6f3c041e1641c","attempts":1}
üìÖ Processing booking created for customer: 1RR67YYEPTRTF01GHDC9H1S3BR
Full booking data: {
  "id": "x6t9unzirreo7i",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-10T21:50:00Z",
  "created_at": "2025-12-03T00:26:36Z",
  "updated_at": "2025-12-03T00:26:36Z",
  "customer_id": "1RR67YYEPTRTF01GHDC9H1S3BR",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "1RR67YYEPTRTF01GHDC9H1S3BR",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMyUMvTJIj2HrHSg",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "JMTK5M2CY2W7WEXSTAJKAJ35",
      "service_variation_version": 1764609577793,
      "service_variation_client_id": "JMTK5M2CY2W7WEXSTAJKAJ35"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Laura Greige
üéâ First booking detected for customer: 1RR67YYEPTRTF01GHDC9H1S3BR
   Name: Laura Greige
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 1RR67YYEPTRTF01GHDC9H1S3BR...
Error getting custom attributes for customer 1RR67YYEPTRTF01GHDC9H1S3BR: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 1RR67YYEPTRTF01GHDC9H1S3BR
{"ts":"2025-12-03T00:26:41.231Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"b7c52c3e-79b3-42c6-b4f3-bfe357f018da","stage":"booking","correlationId":"booking-created:95cfd51a05f6f3c041e1641c"}
{"ts":"2025-12-03T00:30:41.307Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"51a42fe6-036f-4d5b-a55d-1397b8421fbb","stage":"payment","correlationId":"payment-updated:76f00c27b20bc8c4f9ce297e","attempts":1}
üí∞ Processing payment completion for customer: AQJM14K5E90BB90WSPPYEMEN1R
   Payment source_type: CARD
   Payment tender_types: []
Customer AQJM14K5E90BB90WSPPYEMEN1R already completed first payment
{"ts":"2025-12-03T00:30:41.705Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"51a42fe6-036f-4d5b-a55d-1397b8421fbb","stage":"payment","correlationId":"payment-updated:76f00c27b20bc8c4f9ce297e"}
{"ts":"2025-12-03T00:30:46.109Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"ac088eb9-25b1-4a65-be22-aa774fdd4584","stage":"payment","correlationId":"payment-updated:f3b4a0e2721c2ee5e5ad4461","attempts":1}
üí∞ Processing payment completion for customer: AQJM14K5E90BB90WSPPYEMEN1R
   Payment source_type: CARD
   Payment tender_types: []
Customer AQJM14K5E90BB90WSPPYEMEN1R already completed first payment
{"ts":"2025-12-03T00:30:46.247Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"ac088eb9-25b1-4a65-be22-aa774fdd4584","stage":"payment","correlationId":"payment-updated:f3b4a0e2721c2ee5e5ad4461"}
{"ts":"2025-12-03T00:39:00.653Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"ba9ea046-50f7-417d-9c37-7caca3cdd2d6","stage":"customer_ingest","correlationId":"customer-created:2edc39a03aa1232d49059add","attempts":1}
üì• Received customer data: {
  "id": "HP79HEE77QSBEQ4R9B9C0F1KRM",
  "address": {
    "country": "US"
  },
  "version": 0,
  "group_ids": [
    "LT4ZHFBQQYB2N.APPOINTMENTS"
  ],
  "created_at": "2025-12-03T00:38:55.51Z",
  "given_name": "Mindy",
  "updated_at": "2025-12-03T00:38:55Z",
  "family_name": "Anderson",
  "preferences": {
    "email_unsubscribed": false
  },
  "phone_number": "+14056097058",
  "email_address": "Mindyma714@gmail.com",
  "creation_source": "APPOINTMENTS"
}
üë§ Processing customer creation: HP79HEE77QSBEQ4R9B9C0F1KRM
üìç IP Address: unknown
üìß Email: Mindyma714@gmail.com
üìû Phone: +14056097058
üë§ Name: Mindy Anderson
‚ö†Ô∏è Suspicious IP activity detected: unknown used by 131 customers
‚ö†Ô∏è Suspicious activity detected for customer HP79HEE77QSBEQ4R9B9C0F1KRM, flagging for review
üéâ New customer detected: HP79HEE77QSBEQ4R9B9C0F1KRM
‚úÖ Customer added to database as NEW (temporary mark)
   - Will check for referral code when they book
   - Will give gift card on first booking if code found
‚úÖ Verification: Customer found in DB: true
{"ts":"2025-12-03T00:39:02.157Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"ba9ea046-50f7-417d-9c37-7caca3cdd2d6","stage":"customer_ingest","correlationId":"customer-created:2edc39a03aa1232d49059add"}
{"ts":"2025-12-03T00:39:02.485Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"eefe427c-a6b8-4905-940a-3797b7d7c35c","stage":"booking","correlationId":"booking-created:f75fb3a1c69adc80052a7157","attempts":1}
üìÖ Processing booking created for customer: HP79HEE77QSBEQ4R9B9C0F1KRM
Full booking data: {
  "id": "f8fqe0vuzcrpyl",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-23T19:20:00Z",
  "created_at": "2025-12-03T00:38:58Z",
  "updated_at": "2025-12-03T00:38:58Z",
  "customer_id": "HP79HEE77QSBEQ4R9B9C0F1KRM",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "HP79HEE77QSBEQ4R9B9C0F1KRM",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMOscywuGXO2VURY",
      "any_team_member": true,
      "duration_minutes": 140,
      "intermission_minutes": 0,
      "service_variation_id": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "CJI5WHOAKSFTASYPJ4MSYZLS"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Mindy Anderson
üéâ First booking detected for customer: HP79HEE77QSBEQ4R9B9C0F1KRM
   Name: Mindy Anderson
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer HP79HEE77QSBEQ4R9B9C0F1KRM...
Error getting custom attributes for customer HP79HEE77QSBEQ4R9B9C0F1KRM: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: HP79HEE77QSBEQ4R9B9C0F1KRM
{"ts":"2025-12-03T00:39:03.233Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"eefe427c-a6b8-4905-940a-3797b7d7c35c","stage":"booking","correlationId":"booking-created:f75fb3a1c69adc80052a7157"}
{"ts":"2025-12-03T00:58:48.515Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"7c63cdda-1a73-4671-ba7a-2cb4395099d4","stage":"payment","correlationId":"payment-updated:4fe8a105857b49033ff657e1","attempts":1}
üí∞ Processing payment completion for customer: ZWRC692BV3GAH9HDJXGTSDWA6W
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Vera Watt
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Vera Watt, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Vera Watt
   - Email: vera.shaban@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: ZWRC692BV3GAH9HDJXGTSDWA6W
{"ts":"2025-12-03T00:58:49.113Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"7c63cdda-1a73-4671-ba7a-2cb4395099d4","stage":"payment","correlationId":"payment-updated:4fe8a105857b49033ff657e1"}
{"ts":"2025-12-03T00:58:56.646Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"42838eaa-4de9-4660-856a-5a20470bcefd","stage":"payment","correlationId":"payment-updated:231243d6a35fa28132369f12","attempts":1}
üí∞ Processing payment completion for customer: ZWRC692BV3GAH9HDJXGTSDWA6W
   Payment source_type: CARD
   Payment tender_types: []
Customer ZWRC692BV3GAH9HDJXGTSDWA6W already completed first payment
{"ts":"2025-12-03T00:58:56.912Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"42838eaa-4de9-4660-856a-5a20470bcefd","stage":"payment","correlationId":"payment-updated:231243d6a35fa28132369f12"}
{"ts":"2025-12-03T01:00:16.045Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"6ab85db1-f216-41fb-bf6a-0b2a4e6ba28c","stage":"booking","correlationId":"booking-created:0d1de9b4dd5351a671706ae1","attempts":1}
üìÖ Processing booking created for customer: ZWRC692BV3GAH9HDJXGTSDWA6W
Full booking data: {
  "id": "x70qsbbv8lq79t",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-18T23:00:00Z",
  "created_at": "2025-12-03T01:00:13Z",
  "updated_at": "2025-12-03T01:00:13Z",
  "customer_id": "ZWRC692BV3GAH9HDJXGTSDWA6W",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMWAtQTYmZpwwxii"
  },
  "appointment_segments": [
    {
      "resource_ids": [
        "F2MBRCC42VNNDWXNA3PAMHEU"
      ],
      "team_member_id": "TMVwAQUdLz6no-cB",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "ZEAKNB35I37RMXNUBGWDZQIM",
      "service_variation_version": 1760895536505,
      "service_variation_client_id": "ZEAKNB35I37RMXNUBGWDZQIM"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Vera Watt
üéâ First booking detected for customer: ZWRC692BV3GAH9HDJXGTSDWA6W
   Name: Vera Watt
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer ZWRC692BV3GAH9HDJXGTSDWA6W...
Error getting custom attributes for customer ZWRC692BV3GAH9HDJXGTSDWA6W: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: ZWRC692BV3GAH9HDJXGTSDWA6W
{"ts":"2025-12-03T01:00:16.684Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"6ab85db1-f216-41fb-bf6a-0b2a4e6ba28c","stage":"booking","correlationId":"booking-created:0d1de9b4dd5351a671706ae1"}
{"ts":"2025-12-03T01:00:41.160Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"3b45d25f-7df4-47b3-84e2-530f00ac3209","stage":"booking","correlationId":"booking-created:a21ced74a22699dca0afefd5","attempts":1}
üìÖ Processing booking created for customer: ZWRC692BV3GAH9HDJXGTSDWA6W
Full booking data: {
  "id": "cruyfadlgyztec",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-18T23:00:00Z",
  "created_at": "2025-12-03T01:00:38Z",
  "updated_at": "2025-12-03T01:00:38Z",
  "customer_id": "ZWRC692BV3GAH9HDJXGTSDWA6W",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMWAtQTYmZpwwxii"
  },
  "appointment_segments": [
    {
      "resource_ids": [
        "L5IDOPM7JNYI6CM6BUUOXRDM"
      ],
      "team_member_id": "TM-zXe9fXe4axYWn",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "63PG6RLS2NHWRD5JRXEC74HN",
      "service_variation_version": 1760895536505,
      "service_variation_client_id": "63PG6RLS2NHWRD5JRXEC74HN"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Vera Watt
üéâ First booking detected for customer: ZWRC692BV3GAH9HDJXGTSDWA6W
   Name: Vera Watt
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer ZWRC692BV3GAH9HDJXGTSDWA6W...
Error getting custom attributes for customer ZWRC692BV3GAH9HDJXGTSDWA6W: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: ZWRC692BV3GAH9HDJXGTSDWA6W
{"ts":"2025-12-03T01:00:41.688Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"3b45d25f-7df4-47b3-84e2-530f00ac3209","stage":"booking","correlationId":"booking-created:a21ced74a22699dca0afefd5"}
{"ts":"2025-12-03T01:01:11.963Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"7d6c4cbf-2ea7-41a2-916c-b6011272f3b6","stage":"booking","correlationId":"booking-created:243fdfb824b3678243de341a","attempts":1}
üìÖ Processing booking created for customer: ZWRC692BV3GAH9HDJXGTSDWA6W
Full booking data: {
  "id": "mv8p4pmb33t1ef",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-18T23:00:00Z",
  "created_at": "2025-12-03T01:01:09Z",
  "updated_at": "2025-12-03T01:01:09Z",
  "customer_id": "ZWRC692BV3GAH9HDJXGTSDWA6W",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMWAtQTYmZpwwxii"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMSt73bSp59caRzt",
      "any_team_member": false,
      "duration_minutes": 140,
      "intermission_minutes": 0,
      "service_variation_id": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "CJI5WHOAKSFTASYPJ4MSYZLS"
    },
    {
      "team_member_id": "TMSt73bSp59caRzt",
      "any_team_member": false,
      "duration_minutes": 5,
      "intermission_minutes": 0,
      "service_variation_id": "DBRXEHQPCF7V4APTHDQTZW62",
      "service_variation_version": 1762374620368,
      "service_variation_client_id": "DBRXEHQPCF7V4APTHDQTZW62"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Vera Watt
üéâ First booking detected for customer: ZWRC692BV3GAH9HDJXGTSDWA6W
   Name: Vera Watt
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer ZWRC692BV3GAH9HDJXGTSDWA6W...
Error getting custom attributes for customer ZWRC692BV3GAH9HDJXGTSDWA6W: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: ZWRC692BV3GAH9HDJXGTSDWA6W
{"ts":"2025-12-03T01:01:13.258Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"7d6c4cbf-2ea7-41a2-916c-b6011272f3b6","stage":"booking","correlationId":"booking-created:243fdfb824b3678243de341a"}
{"ts":"2025-12-03T01:01:53.271Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"d215386c-608a-4d9c-b8be-c7f21647c510","stage":"booking","correlationId":"booking-created:8a74f37695e37147fee3605a","attempts":1}
üìÖ Processing booking created for customer: ZWRC692BV3GAH9HDJXGTSDWA6W
Full booking data: {
  "id": "ynzq10u62m3c3d",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-18T23:15:00Z",
  "created_at": "2025-12-03T01:01:50Z",
  "updated_at": "2025-12-03T01:01:50Z",
  "customer_id": "ZWRC692BV3GAH9HDJXGTSDWA6W",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMWAtQTYmZpwwxii"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMEWAZHdtaiRR_Zs",
      "any_team_member": false,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1764609601083,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Vera Watt
üéâ First booking detected for customer: ZWRC692BV3GAH9HDJXGTSDWA6W
   Name: Vera Watt
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer ZWRC692BV3GAH9HDJXGTSDWA6W...
Error getting custom attributes for customer ZWRC692BV3GAH9HDJXGTSDWA6W: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: ZWRC692BV3GAH9HDJXGTSDWA6W
{"ts":"2025-12-03T01:01:53.869Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"d215386c-608a-4d9c-b8be-c7f21647c510","stage":"booking","correlationId":"booking-created:8a74f37695e37147fee3605a"}
{"ts":"2025-12-03T01:22:08.585Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Server has closed the connection.","stack":"PrismaClientKnownRequestError: Server has closed the connection.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-03T01:22:11.270Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"6c2f3198-20af-4460-ac3b-43152063b31f","stage":"booking","correlationId":"booking-created:c5801ee42efbe8f19f4de19e","attempts":1}
üìÖ Processing booking created for customer: ADMXFM7ZZMWRWK83B8P49M0888
Full booking data: {
  "id": "b1d479j7oydpc9",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-08T18:00:00Z",
  "created_at": "2025-12-03T01:20:10Z",
  "updated_at": "2025-12-03T01:20:10Z",
  "customer_id": "ADMXFM7ZZMWRWK83B8P49M0888",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "ADMXFM7ZZMWRWK83B8P49M0888",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMXiw38Bbb7XQUWI",
      "any_team_member": false,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1764609601083,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Tugce YENER
üéâ First booking detected for customer: ADMXFM7ZZMWRWK83B8P49M0888
   Name: Tugce YENER
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer ADMXFM7ZZMWRWK83B8P49M0888...
Error getting custom attributes for customer ADMXFM7ZZMWRWK83B8P49M0888: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: ADMXFM7ZZMWRWK83B8P49M0888
{"ts":"2025-12-03T01:22:12.120Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"6c2f3198-20af-4460-ac3b-43152063b31f","stage":"booking","correlationId":"booking-created:c5801ee42efbe8f19f4de19e"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-12-03T01:36:50.011Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"39e9bcec-86ed-42ee-a2d7-2bf08d71f3e3","stage":"booking","correlationId":"booking-created:6ca0011f2d5b61b5f287818a","attempts":1}
üìÖ Processing booking created for customer: YTFV2DVFQM4ZVFFCTRM5G69EKC
Full booking data: {
  "id": "kb1my3mpescub7",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-03T02:00:00Z",
  "created_at": "2025-12-03T01:25:57Z",
  "updated_at": "2025-12-03T01:25:57Z",
  "customer_id": "YTFV2DVFQM4ZVFFCTRM5G69EKC",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMWAtQTYmZpwwxii"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMgsjtuk5cfKnstq",
      "any_team_member": false,
      "duration_minutes": 30,
      "intermission_minutes": 0,
      "service_variation_id": "SGSLS3INMK5YV637KUITCILL",
      "service_variation_version": 1760895536505,
      "service_variation_client_id": "SGSLS3INMK5YV637KUITCILL"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Britt Lindberg
üéâ First booking detected for customer: YTFV2DVFQM4ZVFFCTRM5G69EKC
   Name: Britt Lindberg
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer YTFV2DVFQM4ZVFFCTRM5G69EKC...
Error getting custom attributes for customer YTFV2DVFQM4ZVFFCTRM5G69EKC: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: YTFV2DVFQM4ZVFFCTRM5G69EKC
{"ts":"2025-12-03T01:36:50.757Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"39e9bcec-86ed-42ee-a2d7-2bf08d71f3e3","stage":"booking","correlationId":"booking-created:6ca0011f2d5b61b5f287818a"}
{"ts":"2025-12-03T01:36:50.915Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"95dd6300-c132-4a21-bdb7-e5b2aac72471","stage":"payment","correlationId":"payment-updated:e76027e88e571f7a602087fb","attempts":1}
üí∞ Processing payment completion for customer: ET5W3RZZ5RKFX9G93C7CQB7HV0
   Payment source_type: CARD
   Payment tender_types: []
Customer ET5W3RZZ5RKFX9G93C7CQB7HV0 already completed first payment
{"ts":"2025-12-03T01:36:51.059Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"95dd6300-c132-4a21-bdb7-e5b2aac72471","stage":"payment","correlationId":"payment-updated:e76027e88e571f7a602087fb"}
{"ts":"2025-12-03T01:36:51.217Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"afc68262-f182-439c-ab07-fc11f921cde5","stage":"payment","correlationId":"payment-updated:b267c4dd7ce7b10ece4bc962","attempts":1}
üí∞ Processing payment completion for customer: ET5W3RZZ5RKFX9G93C7CQB7HV0
   Payment source_type: CARD
   Payment tender_types: []
Customer ET5W3RZZ5RKFX9G93C7CQB7HV0 already completed first payment
{"ts":"2025-12-03T01:36:51.352Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"afc68262-f182-439c-ab07-fc11f921cde5","stage":"payment","correlationId":"payment-updated:b267c4dd7ce7b10ece4bc962"}
{"ts":"2025-12-03T01:54:20.198Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"f0f63edf-96a3-4f06-a5a1-d8f8b48bec37","stage":"payment","correlationId":"payment-updated:c89df934226204255418efbe","attempts":1}
üí∞ Processing payment completion for customer: MXRP4ZXMHS47V4ZR3S3XXGDXQC
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Rachel Delphin
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Rachel Delphin, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Rachel Delphin
   - Email: rachel.delphin@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: MXRP4ZXMHS47V4ZR3S3XXGDXQC
{"ts":"2025-12-03T01:54:20.802Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"f0f63edf-96a3-4f06-a5a1-d8f8b48bec37","stage":"payment","correlationId":"payment-updated:c89df934226204255418efbe"}
{"ts":"2025-12-03T01:54:20.967Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"d98fd1e0-b216-4958-8645-ca8093735bd0","stage":"payment","correlationId":"payment-updated:cd055306980de680a086f15a","attempts":1}
üí∞ Processing payment completion for customer: MXRP4ZXMHS47V4ZR3S3XXGDXQC
   Payment source_type: CARD
   Payment tender_types: []
Customer MXRP4ZXMHS47V4ZR3S3XXGDXQC already completed first payment
{"ts":"2025-12-03T01:54:21.106Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"d98fd1e0-b216-4958-8645-ca8093735bd0","stage":"payment","correlationId":"payment-updated:cd055306980de680a086f15a"}
{"ts":"2025-12-03T01:54:21.271Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"cdecce59-319a-431d-aa63-c263ba9299df","stage":"payment","correlationId":"payment-updated:621ecc8ab15b7be41c84547e","attempts":1}
üí∞ Processing payment completion for customer: JBSSXD662STDAD89DZ5Z33VTT8
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Isabella Garcia-Camargo
‚ùå Referrer not found for code: null
‚úÖ Generated new personal_code in name+ID format: ISABELLA5338
‚ùå Error creating/loading gift card for Isabella Garcia-Camargo: Response status code was not ok: 401.
Square API errors: [
  {
    "category": "AUTHENTICATION_ERROR",
    "code": "UNAUTHORIZED",
    "detail": "This request could not be authorized."
  }
]
‚ùå Failed to create referrer gift card
Error upserting custom attribute "square:a3dde506-f69e-48e4-a98a-004c1822d3ad" for customer JBSSXD662STDAD89DZ5Z33VTT8: Response status code was not ok: 401.
Square API errors: [
  {
    "category": "AUTHENTICATION_ERROR",
    "code": "UNAUTHORIZED",
    "detail": "This request could not be authorized."
  }
]
Error appending referral note for customer JBSSXD662STDAD89DZ5Z33VTT8: Response status code was not ok: 401.
Square API errors: [
  {
    "category": "AUTHENTICATION_ERROR",
    "code": "UNAUTHORIZED",
    "detail": "This request could not be authorized."
  }
]
‚ùå Error sending referral email to isabellagc2010@gmail.com: Unauthorized
SendGrid error details: {
  errors: [
    {
      message: 'The provided authorization grant is invalid, expired, or revoked',
      field: null,
      help: null
    }
  ]
}
‚ö†Ô∏è Analytics operation "notification_event" failed: 
Invalid `prisma.notificationEvent.create()` invocation in
/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/analytics-service.js:164:39

  161 return runAnalyticsOperation(
  162   'notification_event',
  163   async () => {
‚Üí 164     return prisma.notificationEvent.create({
            data: {
              channel: "EMAIL",
              templateType: "REFERRAL_INVITE",
              status: "failed",
              createdAt: new Date("2025-12-03T01:54:22.638Z"),
              errorCode: 401,
                         ~~~
              errorMessage: "Unauthorized",
              metadata: {
                email: "isabellagc2010@gmail.com",
                referralCode: "ISABELLA5338",
                referralUrl: "https://referral-system-salon-fbbq6x1wt-umis-projects-e802f152.vercel.app/ref/ISABELLA5338",
                suppressionGroupId: 28008
              }
            }
          })

Argument `errorCode`: Invalid value provided. Expected String or Null, provided Int.
‚ùå Failed to send email: Unauthorized
‚ÑπÔ∏è SMS sending disabled. Would send referral link to +14258924209
‚è∏Ô∏è SMS sending disabled (skipped sending to +14258924209)
üìß Referral code generated and sent:
   - Customer: Isabella Garcia-Camargo
   - Email: isabellagc2010@gmail.com
   - Referral Code: ISABELLA5338
   - Referral URL: https://referral-system-salon-fbbq6x1wt-umis-projects-e802f152.vercel.app/ref/ISABELLA5338
   - Gift Card ID: null
   - Status: Customer is now a referrer
‚úÖ Referral code sent to new client:
   - Customer: Isabella Garcia-Camargo
   - Email: isabellagc2010@gmail.com
   - Referral Code: ISABELLA5338
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: JBSSXD662STDAD89DZ5Z33VTT8
{"ts":"2025-12-03T01:54:22.890Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"cdecce59-319a-431d-aa63-c263ba9299df","stage":"payment","correlationId":"payment-updated:621ecc8ab15b7be41c84547e"}
{"ts":"2025-12-03T02:08:58.334Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Server has closed the connection.","stack":"PrismaClientKnownRequestError: Server has closed the connection.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:8034)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-03T02:09:01.422Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"fefc1120-8a73-4d7f-8af9-70c4e3c4ce55","stage":"booking","correlationId":"booking-created:bf40660454d8fedbf3ec51e3","attempts":1}
üìÖ Processing booking created for customer: MXRP4ZXMHS47V4ZR3S3XXGDXQC
Full booking data: {
  "id": "bj8q75lh4akbth",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-18T21:30:00Z",
  "created_at": "2025-12-03T01:40:24Z",
  "updated_at": "2025-12-03T01:40:24Z",
  "customer_id": "MXRP4ZXMHS47V4ZR3S3XXGDXQC",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMWAtQTYmZpwwxii"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMVwAQUdLz6no-cB",
      "any_team_member": false,
      "duration_minutes": 100,
      "intermission_minutes": 0,
      "service_variation_id": "GSZZR45VJXB44NF4P4WXI5NB",
      "service_variation_version": 1764609577793,
      "service_variation_client_id": "GSZZR45VJXB44NF4P4WXI5NB"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Rachel Delphin
üéâ First booking detected for customer: MXRP4ZXMHS47V4ZR3S3XXGDXQC
   Name: Rachel Delphin
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer MXRP4ZXMHS47V4ZR3S3XXGDXQC...
Error getting custom attributes for customer MXRP4ZXMHS47V4ZR3S3XXGDXQC: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: MXRP4ZXMHS47V4ZR3S3XXGDXQC
{"ts":"2025-12-03T02:09:02.136Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"fefc1120-8a73-4d7f-8af9-70c4e3c4ce55","stage":"booking","correlationId":"booking-created:bf40660454d8fedbf3ec51e3"}
{"ts":"2025-12-03T02:09:02.296Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"d1c74ea7-1778-47ce-ba1a-8f1a8b28d258","stage":"payment","correlationId":"payment-updated:335d215a3bb18076b03176b1","attempts":1}
üí∞ Processing payment completion for customer: S000J7PCWP5EDFF3KKA94S6EFR
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Jasveen Sodhi
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Jasveen Sodhi, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Jasveen Sodhi
   - Email: Jasveensodhi19@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: S000J7PCWP5EDFF3KKA94S6EFR
{"ts":"2025-12-03T02:09:02.634Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"d1c74ea7-1778-47ce-ba1a-8f1a8b28d258","stage":"payment","correlationId":"payment-updated:335d215a3bb18076b03176b1"}
{"ts":"2025-12-03T02:09:02.803Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"f7e8cadd-4a2a-4f2c-a1e4-077d8aedcc0d","stage":"payment","correlationId":"payment-updated:4cc0b784cae5f233d41c4c31","attempts":1}
üí∞ Processing payment completion for customer: S000J7PCWP5EDFF3KKA94S6EFR
   Payment source_type: CARD
   Payment tender_types: []
Customer S000J7PCWP5EDFF3KKA94S6EFR already completed first payment
{"ts":"2025-12-03T02:09:02.955Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"f7e8cadd-4a2a-4f2c-a1e4-077d8aedcc0d","stage":"payment","correlationId":"payment-updated:4cc0b784cae5f233d41c4c31"}
{"ts":"2025-12-03T02:09:03.139Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"79b66586-f8b1-452f-b792-5ab3e56953ef","stage":"booking","correlationId":"booking-created:6cfd39e6a3b3a1e4b1da59a2","attempts":1}
üìÖ Processing booking created for customer: VRC2G1PHS14ZBK37F5G5TZYT0M
Full booking data: {
  "id": "qzdzhn5mndzs3j",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-03T23:15:00Z",
  "created_at": "2025-12-03T01:46:36Z",
  "updated_at": "2025-12-03T01:46:36Z",
  "customer_id": "VRC2G1PHS14ZBK37F5G5TZYT0M",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMQPbDVvvOCLwqsy"
  },
  "appointment_segments": [
    {
      "team_member_id": "TM9jDlRr_Hl4rdBB",
      "any_team_member": false,
      "duration_minutes": 150,
      "intermission_minutes": 0,
      "service_variation_id": "4QI3JWGEYQANKCGC36J3MYNB",
      "service_variation_version": 1758654327496,
      "service_variation_client_id": "4QI3JWGEYQANKCGC36J3MYNB"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Suraksha Suresh Pai
üéâ First booking detected for customer: VRC2G1PHS14ZBK37F5G5TZYT0M
   Name: Suraksha Suresh Pai
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer VRC2G1PHS14ZBK37F5G5TZYT0M...
Error getting custom attributes for customer VRC2G1PHS14ZBK37F5G5TZYT0M: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: VRC2G1PHS14ZBK37F5G5TZYT0M
{"ts":"2025-12-03T02:09:03.606Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"79b66586-f8b1-452f-b792-5ab3e56953ef","stage":"booking","correlationId":"booking-created:6cfd39e6a3b3a1e4b1da59a2"}
{"ts":"2025-12-03T02:09:04.016Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"a1bca0e9-454e-48ef-b0dc-2a6aef1a1da5","stage":"payment","correlationId":"payment-updated:36b15093fa402ca66a22f6dd","attempts":1}
üí∞ Processing payment completion for customer: XPC0VBPBSKXWXRVBS7BBX5NRKM
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Julianne McGoldrick
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Julianne McGoldrick, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Julianne McGoldrick
   - Email: juliannemcgoldrick@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: XPC0VBPBSKXWXRVBS7BBX5NRKM
{"ts":"2025-12-03T02:09:04.905Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"a1bca0e9-454e-48ef-b0dc-2a6aef1a1da5","stage":"payment","correlationId":"payment-updated:36b15093fa402ca66a22f6dd"}
{"ts":"2025-12-03T02:09:05.290Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"9b514997-321e-417e-8276-9c693e6f9ecf","stage":"payment","correlationId":"payment-updated:788f992d1f24c674ff561b7c","attempts":1}
üí∞ Processing payment completion for customer: XPC0VBPBSKXWXRVBS7BBX5NRKM
   Payment source_type: CARD
   Payment tender_types: []
Customer XPC0VBPBSKXWXRVBS7BBX5NRKM already completed first payment
{"ts":"2025-12-03T02:09:05.612Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"9b514997-321e-417e-8276-9c693e6f9ecf","stage":"payment","correlationId":"payment-updated:788f992d1f24c674ff561b7c"}
{"ts":"2025-12-03T02:09:06.128Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"bd3faaec-69ba-49ca-9a0d-980c710c111c","stage":"booking","correlationId":"booking-created:7d6d8c0e405e54951286fcbf","attempts":1}
üìÖ Processing booking created for customer: XPC0VBPBSKXWXRVBS7BBX5NRKM
Full booking data: {
  "id": "gpnevuqmd6bobv",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-28T22:00:00Z",
  "created_at": "2025-12-03T01:56:35Z",
  "updated_at": "2025-12-03T01:56:35Z",
  "customer_id": "XPC0VBPBSKXWXRVBS7BBX5NRKM",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMWAtQTYmZpwwxii"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMMBgVwykMnOlumA",
      "any_team_member": false,
      "duration_minutes": 140,
      "intermission_minutes": 0,
      "service_variation_id": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "CJI5WHOAKSFTASYPJ4MSYZLS"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Julianne McGoldrick
üéâ First booking detected for customer: XPC0VBPBSKXWXRVBS7BBX5NRKM
   Name: Julianne McGoldrick
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer XPC0VBPBSKXWXRVBS7BBX5NRKM...
Error getting custom attributes for customer XPC0VBPBSKXWXRVBS7BBX5NRKM: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: XPC0VBPBSKXWXRVBS7BBX5NRKM
{"ts":"2025-12-03T02:09:06.803Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"bd3faaec-69ba-49ca-9a0d-980c710c111c","stage":"booking","correlationId":"booking-created:7d6d8c0e405e54951286fcbf"}
{"ts":"2025-12-03T02:09:07.129Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"b814ae67-c72c-4fba-891f-23e62a8e1494","stage":"payment","correlationId":"payment-updated:f6bf29102c4e293074d5f8ce","attempts":1}
üí∞ Processing payment completion for customer: JBSSXD662STDAD89DZ5Z33VTT8
   Payment source_type: CARD
   Payment tender_types: []
Customer JBSSXD662STDAD89DZ5Z33VTT8 already completed first payment
{"ts":"2025-12-03T02:09:07.272Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"b814ae67-c72c-4fba-891f-23e62a8e1494","stage":"payment","correlationId":"payment-updated:f6bf29102c4e293074d5f8ce"}
{"ts":"2025-12-03T02:09:07.439Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"f04f32d1-b3b8-48de-852d-de1b88fdb7ae","stage":"payment","correlationId":"payment-updated:998502a5a8568bc31dbe5a7e","attempts":1}
üí∞ Processing payment completion for customer: JBSSXD662STDAD89DZ5Z33VTT8
   Payment source_type: CARD
   Payment tender_types: []
Customer JBSSXD662STDAD89DZ5Z33VTT8 already completed first payment
{"ts":"2025-12-03T02:09:07.585Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"f04f32d1-b3b8-48de-852d-de1b88fdb7ae","stage":"payment","correlationId":"payment-updated:998502a5a8568bc31dbe5a7e"}
{"ts":"2025-12-03T02:09:07.744Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"60bc6074-e486-4544-b636-4905f260d039","stage":"payment","correlationId":"payment-updated:cdf44016bc0728ae0ac8c3b6","attempts":1}
üí∞ Processing payment completion for customer: JBSSXD662STDAD89DZ5Z33VTT8
   Payment source_type: CARD
   Payment tender_types: []
Customer JBSSXD662STDAD89DZ5Z33VTT8 already completed first payment
{"ts":"2025-12-03T02:09:08.013Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"60bc6074-e486-4544-b636-4905f260d039","stage":"payment","correlationId":"payment-updated:cdf44016bc0728ae0ac8c3b6"}
{"ts":"2025-12-03T02:09:08.323Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"780cd199-2b2c-47c6-8ff2-8dcb76ea8281","stage":"payment","correlationId":"payment-updated:81fa90b8520f543d797344ca","attempts":1}
üí∞ Processing payment completion for customer: JBSSXD662STDAD89DZ5Z33VTT8
   Payment source_type: CARD
   Payment tender_types: []
Customer JBSSXD662STDAD89DZ5Z33VTT8 already completed first payment
{"ts":"2025-12-03T02:09:08.602Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"780cd199-2b2c-47c6-8ff2-8dcb76ea8281","stage":"payment","correlationId":"payment-updated:81fa90b8520f543d797344ca"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-12-03T02:23:53.414Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"95529884-711b-41d7-8ed2-8fd5f3bdc7f6","stage":"booking","correlationId":"booking-created:e2b9446eb390fb9cac67ed9c","attempts":1}
üìÖ Processing booking created for customer: NQJ8C29EFCKWWW0Q79TVVSX8A4
Full booking data: {
  "id": "z2yhrhrw0dxymu",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-19T19:20:00Z",
  "created_at": "2025-12-03T02:21:13Z",
  "updated_at": "2025-12-03T02:21:13Z",
  "customer_id": "NQJ8C29EFCKWWW0Q79TVVSX8A4",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "NQJ8C29EFCKWWW0Q79TVVSX8A4",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMEWAZHdtaiRR_Zs",
      "any_team_member": true,
      "duration_minutes": 20,
      "intermission_minutes": 0,
      "service_variation_id": "HAJX45W3U2WUCCXM5MI24UEE",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "HAJX45W3U2WUCCXM5MI24UEE"
    },
    {
      "team_member_id": "TMEWAZHdtaiRR_Zs",
      "any_team_member": true,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1764609601083,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 0 customer(s) in database
‚ÑπÔ∏è Customer NQJ8C29EFCKWWW0Q79TVVSX8A4 not in database yet - need to add them first
‚ùå Error fetching/adding customer from Square: Response status code was not ok: 401.
{"ts":"2025-12-03T02:23:54.082Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"95529884-711b-41d7-8ed2-8fd5f3bdc7f6","stage":"booking","correlationId":"booking-created:e2b9446eb390fb9cac67ed9c"}
{"ts":"2025-12-03T02:23:54.246Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"f4c57f9d-a28c-4147-ba64-9bdd02907127","stage":"customer_ingest","correlationId":"customer-created:5d3f35228d6ad1b8eaacfcb2","attempts":1}
üì• Received customer data: {
  "id": "NQJ8C29EFCKWWW0Q79TVVSX8A4",
  "address": {
    "country": "US"
  },
  "version": 1,
  "group_ids": [
    "LT4ZHFBQQYB2N.APPOINTMENTS"
  ],
  "created_at": "2025-12-03T02:21:11.388Z",
  "given_name": "Pretty",
  "updated_at": "2025-12-03T02:21:14Z",
  "family_name": "Verceles",
  "preferences": {
    "email_unsubscribed": false
  },
  "phone_number": "(925) 487-5438",
  "email_address": "prettyverceles@gmail.com",
  "creation_source": "APPOINTMENTS"
}
üë§ Processing customer creation: NQJ8C29EFCKWWW0Q79TVVSX8A4
üìç IP Address: unknown
üìß Email: prettyverceles@gmail.com
üìû Phone: (925) 487-5438
üë§ Name: Pretty Verceles
‚ö†Ô∏è Suspicious IP activity detected: unknown used by 132 customers
‚ö†Ô∏è Suspicious activity detected for customer NQJ8C29EFCKWWW0Q79TVVSX8A4, flagging for review
üéâ New customer detected: NQJ8C29EFCKWWW0Q79TVVSX8A4
‚úÖ Customer added to database as NEW (temporary mark)
   - Will check for referral code when they book
   - Will give gift card on first booking if code found
‚úÖ Verification: Customer found in DB: true
{"ts":"2025-12-03T02:23:54.626Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"f4c57f9d-a28c-4147-ba64-9bdd02907127","stage":"customer_ingest","correlationId":"customer-created:5d3f35228d6ad1b8eaacfcb2"}
{"ts":"2025-12-03T02:41:36.621Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"af97f56e-4c05-4315-b77c-b28307cf9500","stage":"booking","correlationId":"booking-created:7e68417e170cc817301710eb","attempts":1}
üìÖ Processing booking created for customer: P1WY84GRAFA5N7QW6Z3XQHP6FR
Full booking data: {
  "id": "rh7ifuy5triegn",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-19T20:10:00Z",
  "created_at": "2025-12-03T02:24:39Z",
  "updated_at": "2025-12-03T02:24:39Z",
  "customer_id": "P1WY84GRAFA5N7QW6Z3XQHP6FR",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "P1WY84GRAFA5N7QW6Z3XQHP6FR",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMgsjtuk5cfKnstq",
      "any_team_member": false,
      "duration_minutes": 110,
      "intermission_minutes": 0,
      "service_variation_id": "6TYOE67IDYTKHW2ZG6HKVZER",
      "service_variation_version": 1764609577793,
      "service_variation_client_id": "6TYOE67IDYTKHW2ZG6HKVZER"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Darling Orn
üéâ First booking detected for customer: P1WY84GRAFA5N7QW6Z3XQHP6FR
   Name: Darling Orn
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer P1WY84GRAFA5N7QW6Z3XQHP6FR...
Error getting custom attributes for customer P1WY84GRAFA5N7QW6Z3XQHP6FR: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: P1WY84GRAFA5N7QW6Z3XQHP6FR
{"ts":"2025-12-03T02:41:37.360Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"af97f56e-4c05-4315-b77c-b28307cf9500","stage":"booking","correlationId":"booking-created:7e68417e170cc817301710eb"}
{"ts":"2025-12-03T02:41:37.526Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"86f65547-2786-4692-89f2-1f171e274913","stage":"payment","correlationId":"payment-updated:c8aea32042474373a5fce704","attempts":1}
üí∞ Processing payment completion for customer: 65TDNNHNZK4B3JFDSJ6Z4MFXFR
   Payment source_type: CASH
   Payment tender_types: []
üéâ First payment completed for customer: Ash Wang
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Ash Wang, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Ash Wang
   - Email: signers_arena_05@icloud.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: 65TDNNHNZK4B3JFDSJ6Z4MFXFR
{"ts":"2025-12-03T02:41:37.849Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"86f65547-2786-4692-89f2-1f171e274913","stage":"payment","correlationId":"payment-updated:c8aea32042474373a5fce704"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-12-03T02:57:08.239Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"fa9e2c57-f579-4181-ab8c-6ac7ae9cd68a","stage":"booking","correlationId":"booking-created:c1e7824bbcbb00f23cbe7101","attempts":1}
üìÖ Processing booking created for customer: VQ40QAEXD3FTSMHEA8VTRRJS34
Full booking data: {
  "id": "p62oue7ol6zqxs",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-04T23:00:00Z",
  "created_at": "2025-12-03T02:43:16Z",
  "updated_at": "2025-12-03T02:43:16Z",
  "customer_id": "VQ40QAEXD3FTSMHEA8VTRRJS34",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMWAtQTYmZpwwxii"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMVwAQUdLz6no-cB",
      "any_team_member": false,
      "duration_minutes": 150,
      "intermission_minutes": 0,
      "service_variation_id": "4QI3JWGEYQANKCGC36J3MYNB",
      "service_variation_version": 1758654327496,
      "service_variation_client_id": "4QI3JWGEYQANKCGC36J3MYNB"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Claire Saint-Donat
üéâ First booking detected for customer: VQ40QAEXD3FTSMHEA8VTRRJS34
   Name: Claire Saint-Donat
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer VQ40QAEXD3FTSMHEA8VTRRJS34...
Error getting custom attributes for customer VQ40QAEXD3FTSMHEA8VTRRJS34: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: VQ40QAEXD3FTSMHEA8VTRRJS34
{"ts":"2025-12-03T02:57:09.009Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"fa9e2c57-f579-4181-ab8c-6ac7ae9cd68a","stage":"booking","correlationId":"booking-created:c1e7824bbcbb00f23cbe7101"}
{"ts":"2025-12-03T02:57:09.175Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"70cae3e7-350a-4d75-8ee9-8c080d324b9e","stage":"payment","correlationId":"payment-updated:5b51ea2ff3ca2b3b2e26d30c","attempts":1}
üí∞ Processing payment completion for customer: BZ9XWDQKWAYT1GNVS09QDQ0ASC
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Hillary Bates
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Hillary Bates, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Hillary Bates
   - Email: hillarykbates@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: BZ9XWDQKWAYT1GNVS09QDQ0ASC
{"ts":"2025-12-03T02:57:09.499Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"70cae3e7-350a-4d75-8ee9-8c080d324b9e","stage":"payment","correlationId":"payment-updated:5b51ea2ff3ca2b3b2e26d30c"}
{"ts":"2025-12-03T02:57:09.660Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"20cb3ee6-f64f-4b6c-b7a4-9993b0637f3f","stage":"payment","correlationId":"payment-updated:970469f39896f2c52d3bc179","attempts":1}
üí∞ Processing payment completion for customer: BZ9XWDQKWAYT1GNVS09QDQ0ASC
   Payment source_type: CARD
   Payment tender_types: []
Customer BZ9XWDQKWAYT1GNVS09QDQ0ASC already completed first payment
{"ts":"2025-12-03T02:57:09.805Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"20cb3ee6-f64f-4b6c-b7a4-9993b0637f3f","stage":"payment","correlationId":"payment-updated:970469f39896f2c52d3bc179"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-12-03T03:05:31.706Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Server has closed the connection.","stack":"PrismaClientKnownRequestError: Server has closed the connection.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-12-03T03:37:17.662Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"b28ad361-a096-4a82-aca9-33283208cc71","stage":"payment","correlationId":"payment-updated:52c4782b9b19ed4078d64950","attempts":1}
üí∞ Processing payment completion for customer: WH10ACWXEP8094X832TZG04JT4
   Payment source_type: CARD
   Payment tender_types: []
Customer WH10ACWXEP8094X832TZG04JT4 already completed first payment
{"ts":"2025-12-03T03:37:18.105Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"b28ad361-a096-4a82-aca9-33283208cc71","stage":"payment","correlationId":"payment-updated:52c4782b9b19ed4078d64950"}
{"ts":"2025-12-03T03:37:18.263Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"d3e49c55-28cc-4d6d-b2e3-56c62765f66b","stage":"payment","correlationId":"payment-updated:5184186522bfc184915a6cf1","attempts":1}
üí∞ Processing payment completion for customer: WH10ACWXEP8094X832TZG04JT4
   Payment source_type: CARD
   Payment tender_types: []
Customer WH10ACWXEP8094X832TZG04JT4 already completed first payment
{"ts":"2025-12-03T03:37:18.401Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"d3e49c55-28cc-4d6d-b2e3-56c62765f66b","stage":"payment","correlationId":"payment-updated:5184186522bfc184915a6cf1"}
{"ts":"2025-12-03T05:09:16.638Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"54702473-f977-4f20-84be-9eedcd526bf8","stage":"payment","correlationId":"payment-updated:7a12cdb42f6e5f997f1ac1c5","attempts":1}
üí∞ Processing payment completion for customer: A39KQRT7HPF29XTTC8WF2S1Y5M
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Alysia Vigil
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Alysia Vigil, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Alysia Vigil
   - Email: alysiacv@yahoo.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: A39KQRT7HPF29XTTC8WF2S1Y5M
{"ts":"2025-12-03T05:09:18.458Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"54702473-f977-4f20-84be-9eedcd526bf8","stage":"payment","correlationId":"payment-updated:7a12cdb42f6e5f997f1ac1c5"}
{"ts":"2025-12-03T05:09:23.520Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"c8ff03e2-4784-4a3d-8023-d956ced6a70d","stage":"payment","correlationId":"payment-updated:dec6e8e5687e7715f1f032de","attempts":1}
üí∞ Processing payment completion for customer: A39KQRT7HPF29XTTC8WF2S1Y5M
   Payment source_type: CARD
   Payment tender_types: []
Customer A39KQRT7HPF29XTTC8WF2S1Y5M already completed first payment
{"ts":"2025-12-03T05:09:23.775Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"c8ff03e2-4784-4a3d-8023-d956ced6a70d","stage":"payment","correlationId":"payment-updated:dec6e8e5687e7715f1f032de"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-12-03T05:35:01.890Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"ebe0efa4-2d04-40f0-a276-0160b45933ec","stage":"booking","correlationId":"booking-created:19917da342ba8a308b663190","attempts":1}
üìÖ Processing booking created for customer: JYWCDAQX8BCD0WQCSF6WEXS9EG
Full booking data: {
  "id": "f5ekgaaqp1853s",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-08T00:20:00Z",
  "created_at": "2025-12-03T05:34:22Z",
  "updated_at": "2025-12-03T05:34:22Z",
  "customer_id": "JYWCDAQX8BCD0WQCSF6WEXS9EG",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "JYWCDAQX8BCD0WQCSF6WEXS9EG",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMEWAZHdtaiRR_Zs",
      "any_team_member": false,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1764609601083,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Olivia Sem
üéâ First booking detected for customer: JYWCDAQX8BCD0WQCSF6WEXS9EG
   Name: Olivia Sem
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer JYWCDAQX8BCD0WQCSF6WEXS9EG...
Error getting custom attributes for customer JYWCDAQX8BCD0WQCSF6WEXS9EG: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: JYWCDAQX8BCD0WQCSF6WEXS9EG
{"ts":"2025-12-03T05:35:02.639Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"ebe0efa4-2d04-40f0-a276-0160b45933ec","stage":"booking","correlationId":"booking-created:19917da342ba8a308b663190"}
{"ts":"2025-12-03T05:35:09.174Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"3e6d729b-2ff5-44e0-9c43-3a1ba580a84c","stage":"booking","correlationId":"booking-created:d81ea5a210835d17b48f8dd6","attempts":1}
üìÖ Processing booking created for customer: YTSZ1P7GT9D1YCB5D278253TDW
Full booking data: {
  "id": "5vxdqbs5yt4kqo",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-09T01:20:00Z",
  "created_at": "2025-12-03T05:35:05Z",
  "updated_at": "2025-12-03T05:35:05Z",
  "customer_id": "YTSZ1P7GT9D1YCB5D278253TDW",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "YTSZ1P7GT9D1YCB5D278253TDW",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMgsjtuk5cfKnstq",
      "any_team_member": false,
      "duration_minutes": 30,
      "intermission_minutes": 0,
      "service_variation_id": "JNRUKPGA2ZZUFCEB6YPNDC2Y",
      "service_variation_version": 1760895536505,
      "service_variation_client_id": "JNRUKPGA2ZZUFCEB6YPNDC2Y"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Kathrin Koz
‚ÑπÔ∏è Customer YTSZ1P7GT9D1YCB5D278253TDW already received signup bonus, not first booking
{"ts":"2025-12-03T05:35:09.312Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"3e6d729b-2ff5-44e0-9c43-3a1ba580a84c","stage":"booking","correlationId":"booking-created:d81ea5a210835d17b48f8dd6"}
{"ts":"2025-12-03T06:13:32.742Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"\nInvalid `prisma.$queryRaw()` invocation:\n\n\nTransaction API error: Transaction already closed: A query cannot be executed on an expired transaction. The timeout for this transaction was 5000 ms, however 5121 ms passed since the start of the transaction. Consider increasing the interactive transaction timeout or doing less work in the transaction.","stack":"PrismaClientKnownRequestError: \nInvalid `prisma.$queryRaw()` invocation:\n\n\nTransaction API error: Transaction already closed: A query cannot be executed on an expired transaction. The timeout for this transaction was 5000 ms, however 5121 ms passed since the start of the transaction. Consider increasing the interactive transaction timeout or doing less work in the transaction.\n    at $n.handleRequestError (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:121:7315)\n    at $n.handleAndLogRequestError (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:121:6623)\n    at $n.request (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:121:6307)\n    at async l (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:9633)\n    at async prisma.$transaction.isolationLevel (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:239:26)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:8000)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-03T06:47:10.991Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"7b6afe3c-5a17-49c1-866f-2122bf152865","stage":"booking","correlationId":"booking-created:8cf36a8f59436277eea3bebb","attempts":1}
üìÖ Processing booking created for customer: J0GR3K96V7N6MESNE2VFJQ7CVR
Full booking data: {
  "id": "2ynzri1lmecymd",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-08T19:00:00Z",
  "created_at": "2025-12-03T06:47:08Z",
  "updated_at": "2025-12-03T06:47:08Z",
  "customer_id": "J0GR3K96V7N6MESNE2VFJQ7CVR",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "J0GR3K96V7N6MESNE2VFJQ7CVR",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMMHlgFBIFbMTRap",
      "any_team_member": false,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1764609601083,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Claire Williams
üéâ First booking detected for customer: J0GR3K96V7N6MESNE2VFJQ7CVR
   Name: Claire Williams
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer J0GR3K96V7N6MESNE2VFJQ7CVR...
Error getting custom attributes for customer J0GR3K96V7N6MESNE2VFJQ7CVR: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: J0GR3K96V7N6MESNE2VFJQ7CVR
{"ts":"2025-12-03T06:47:11.914Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"7b6afe3c-5a17-49c1-866f-2122bf152865","stage":"booking","correlationId":"booking-created:8cf36a8f59436277eea3bebb"}
{"ts":"2025-12-03T07:07:46.741Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"e86cd0b8-af6f-496d-b484-89b96dab7d84","stage":"booking","correlationId":"booking-created:8c69c81fa0cd2b55b914a0f2","attempts":1}
üìÖ Processing booking created for customer: 65TDNNHNZK4B3JFDSJ6Z4MFXFR
Full booking data: {
  "id": "q5nz3zvqgxx288",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-21T20:20:00Z",
  "created_at": "2025-12-03T07:07:45Z",
  "updated_at": "2025-12-03T07:07:45Z",
  "customer_id": "65TDNNHNZK4B3JFDSJ6Z4MFXFR",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "65TDNNHNZK4B3JFDSJ6Z4MFXFR",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TM-zXe9fXe4axYWn",
      "any_team_member": false,
      "duration_minutes": 140,
      "intermission_minutes": 0,
      "service_variation_id": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "CJI5WHOAKSFTASYPJ4MSYZLS"
    },
    {
      "team_member_id": "TM-zXe9fXe4axYWn",
      "any_team_member": false,
      "duration_minutes": 10,
      "intermission_minutes": 0,
      "service_variation_id": "6F6F3OAFJSOEN3X7HSXYIVQC",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "6F6F3OAFJSOEN3X7HSXYIVQC"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Ash Wang
üéâ First booking detected for customer: 65TDNNHNZK4B3JFDSJ6Z4MFXFR
   Name: Ash Wang
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 65TDNNHNZK4B3JFDSJ6Z4MFXFR...
Error getting custom attributes for customer 65TDNNHNZK4B3JFDSJ6Z4MFXFR: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 65TDNNHNZK4B3JFDSJ6Z4MFXFR
{"ts":"2025-12-03T07:07:48.376Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"e86cd0b8-af6f-496d-b484-89b96dab7d84","stage":"booking","correlationId":"booking-created:8c69c81fa0cd2b55b914a0f2"}
{"ts":"2025-12-03T08:09:00.299Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-03T14:41:17.744Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"2d694924-7ff1-4e3c-994b-458430d0e6c9","stage":"booking","correlationId":"booking-created:56f68eee1d2486b58a91747e","attempts":1}
üìÖ Processing booking created for customer: 7QEECQDAJ7K1W0BM9HHFQ1NVCR
Full booking data: {
  "id": "mmz3a72xpvnv73",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-26T23:55:00Z",
  "created_at": "2025-12-03T14:41:14Z",
  "updated_at": "2025-12-03T14:41:14Z",
  "customer_id": "7QEECQDAJ7K1W0BM9HHFQ1NVCR",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "7QEECQDAJ7K1W0BM9HHFQ1NVCR",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "resource_ids": [
        "KAOXILA4CV7A23VRAACC4R66"
      ],
      "team_member_id": "TMNW4SIF7tjp4oM_",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "ZEAKNB35I37RMXNUBGWDZQIM",
      "service_variation_version": 1760895536505,
      "service_variation_client_id": "ZEAKNB35I37RMXNUBGWDZQIM"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Ashley Fehrmann
üéâ First booking detected for customer: 7QEECQDAJ7K1W0BM9HHFQ1NVCR
   Name: Ashley Fehrmann
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 7QEECQDAJ7K1W0BM9HHFQ1NVCR...
Error getting custom attributes for customer 7QEECQDAJ7K1W0BM9HHFQ1NVCR: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 7QEECQDAJ7K1W0BM9HHFQ1NVCR
{"ts":"2025-12-03T14:41:18.438Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"2d694924-7ff1-4e3c-994b-458430d0e6c9","stage":"booking","correlationId":"booking-created:56f68eee1d2486b58a91747e"}
{"ts":"2025-12-03T14:43:07.438Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"3a4f5159-7b41-450d-b9a0-91e1828650ee","stage":"booking","correlationId":"booking-created:8a96610a040e48d8c39c1a4b","attempts":1}
üìÖ Processing booking created for customer: 7QEECQDAJ7K1W0BM9HHFQ1NVCR
Full booking data: {
  "id": "7yuc5c615gwgzr",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-13T22:30:00Z",
  "created_at": "2025-12-03T14:43:04Z",
  "updated_at": "2025-12-03T14:43:04Z",
  "customer_id": "7QEECQDAJ7K1W0BM9HHFQ1NVCR",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "7QEECQDAJ7K1W0BM9HHFQ1NVCR",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMNW4SIF7tjp4oM_",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "BRSIGZFOWC6F4ERPKX3CODLU",
      "service_variation_version": 1764609577793,
      "service_variation_client_id": "BRSIGZFOWC6F4ERPKX3CODLU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Ashley Fehrmann
üéâ First booking detected for customer: 7QEECQDAJ7K1W0BM9HHFQ1NVCR
   Name: Ashley Fehrmann
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 7QEECQDAJ7K1W0BM9HHFQ1NVCR...
Error getting custom attributes for customer 7QEECQDAJ7K1W0BM9HHFQ1NVCR: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 7QEECQDAJ7K1W0BM9HHFQ1NVCR
{"ts":"2025-12-03T14:43:08.054Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"3a4f5159-7b41-450d-b9a0-91e1828650ee","stage":"booking","correlationId":"booking-created:8a96610a040e48d8c39c1a4b"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-12-03T17:05:19.084Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"4629d089-790e-487c-92d5-241ecd99f043","stage":"booking","correlationId":"booking-created:c0a551490b2641dd0ae11b18","attempts":1}
üìÖ Processing booking created for customer: 2W09CYGAJSQYCT7KN9YQHBEW54
Full booking data: {
  "id": "nllbs2pgqspur1",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-18T17:00:00Z",
  "created_at": "2025-12-03T17:04:16Z",
  "updated_at": "2025-12-03T17:04:16Z",
  "customer_id": "2W09CYGAJSQYCT7KN9YQHBEW54",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMQPbDVvvOCLwqsy"
  },
  "appointment_segments": [
    {
      "team_member_id": "TM9jDlRr_Hl4rdBB",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "XBUDIMNKOPC2XVG5YLIQ4RYS",
      "service_variation_version": 1764609577793,
      "service_variation_client_id": "XBUDIMNKOPC2XVG5YLIQ4RYS"
    },
    {
      "team_member_id": "TM9jDlRr_Hl4rdBB",
      "any_team_member": false,
      "duration_minutes": 5,
      "intermission_minutes": 0,
      "service_variation_id": "DBRXEHQPCF7V4APTHDQTZW62",
      "service_variation_version": 1762374620368,
      "service_variation_client_id": "WYYALSW7EFQP5CLOWBH22GPD"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Jacqueline Sharma
üéâ First booking detected for customer: 2W09CYGAJSQYCT7KN9YQHBEW54
   Name: Jacqueline Sharma
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 2W09CYGAJSQYCT7KN9YQHBEW54...
Error getting custom attributes for customer 2W09CYGAJSQYCT7KN9YQHBEW54: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 2W09CYGAJSQYCT7KN9YQHBEW54
{"ts":"2025-12-03T17:05:19.804Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"4629d089-790e-487c-92d5-241ecd99f043","stage":"booking","correlationId":"booking-created:c0a551490b2641dd0ae11b18"}
{"ts":"2025-12-03T17:05:19.966Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"e7e06e23-bef2-4a91-896b-bc49dc1c0c41","stage":"booking","correlationId":"booking-created:9248162be4e5fae6939bfa63","attempts":1}
üìÖ Processing booking created for customer: 2W09CYGAJSQYCT7KN9YQHBEW54
Full booking data: {
  "id": "w1uqz7ezu5g59x",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-18T17:00:00Z",
  "created_at": "2025-12-03T17:04:38Z",
  "updated_at": "2025-12-03T17:04:38Z",
  "customer_id": "2W09CYGAJSQYCT7KN9YQHBEW54",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMQPbDVvvOCLwqsy"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMyUMvTJIj2HrHSg",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "ZEAKNB35I37RMXNUBGWDZQIM",
      "service_variation_version": 1760895536505,
      "service_variation_client_id": "ZEAKNB35I37RMXNUBGWDZQIM"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Jacqueline Sharma
üéâ First booking detected for customer: 2W09CYGAJSQYCT7KN9YQHBEW54
   Name: Jacqueline Sharma
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 2W09CYGAJSQYCT7KN9YQHBEW54...
Error getting custom attributes for customer 2W09CYGAJSQYCT7KN9YQHBEW54: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 2W09CYGAJSQYCT7KN9YQHBEW54
{"ts":"2025-12-03T17:05:20.341Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"e7e06e23-bef2-4a91-896b-bc49dc1c0c41","stage":"booking","correlationId":"booking-created:9248162be4e5fae6939bfa63"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-12-03T17:26:56.637Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"e1e39c37-d7d9-441d-8fb3-36a4a0f9adbf","stage":"booking","correlationId":"booking-created:5a1b5986c1095e5511ba6422","attempts":1}
üìÖ Processing booking created for customer: 51Q2FNTC3C9BCS0FB3PYWC16XW
Full booking data: {
  "id": "69h9ocpewehl62",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-07T01:00:00Z",
  "created_at": "2025-12-03T17:12:42Z",
  "updated_at": "2025-12-03T17:12:42Z",
  "customer_id": "51Q2FNTC3C9BCS0FB3PYWC16XW",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "51Q2FNTC3C9BCS0FB3PYWC16XW",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "resource_ids": [
        "5OVIQ6GSSUXORACP6T7WBAQ7"
      ],
      "team_member_id": "TM-zXe9fXe4axYWn",
      "any_team_member": true,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "ZEAKNB35I37RMXNUBGWDZQIM",
      "service_variation_version": 1760895536505,
      "service_variation_client_id": "ZEAKNB35I37RMXNUBGWDZQIM"
    },
    {
      "team_member_id": "TM-zXe9fXe4axYWn",
      "any_team_member": true,
      "duration_minutes": 20,
      "intermission_minutes": 0,
      "service_variation_id": "HAJX45W3U2WUCCXM5MI24UEE",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "HAJX45W3U2WUCCXM5MI24UEE"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Alyssa Carl
üéâ First booking detected for customer: 51Q2FNTC3C9BCS0FB3PYWC16XW
   Name: Alyssa Carl
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 51Q2FNTC3C9BCS0FB3PYWC16XW...
Error getting custom attributes for customer 51Q2FNTC3C9BCS0FB3PYWC16XW: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 51Q2FNTC3C9BCS0FB3PYWC16XW
{"ts":"2025-12-03T17:26:57.406Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"e1e39c37-d7d9-441d-8fb3-36a4a0f9adbf","stage":"booking","correlationId":"booking-created:5a1b5986c1095e5511ba6422"}
{"ts":"2025-12-03T17:26:57.574Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"e4b1f27d-7708-4247-a934-22f6071950d5","stage":"booking","correlationId":"booking-created:d72aeeff39b1bff8908f07db","attempts":1}
üìÖ Processing booking created for customer: 51Q2FNTC3C9BCS0FB3PYWC16XW
Full booking data: {
  "id": "6uamgtlm00wyj5",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-08T00:05:00Z",
  "created_at": "2025-12-03T17:17:45Z",
  "updated_at": "2025-12-03T17:17:45Z",
  "customer_id": "51Q2FNTC3C9BCS0FB3PYWC16XW",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "51Q2FNTC3C9BCS0FB3PYWC16XW",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMoZGdZlg-iKWTDu",
      "any_team_member": true,
      "duration_minutes": 20,
      "intermission_minutes": 0,
      "service_variation_id": "HAJX45W3U2WUCCXM5MI24UEE",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "HAJX45W3U2WUCCXM5MI24UEE"
    },
    {
      "team_member_id": "TMoZGdZlg-iKWTDu",
      "any_team_member": true,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1764609601083,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Alyssa Carl
üéâ First booking detected for customer: 51Q2FNTC3C9BCS0FB3PYWC16XW
   Name: Alyssa Carl
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 51Q2FNTC3C9BCS0FB3PYWC16XW...
Error getting custom attributes for customer 51Q2FNTC3C9BCS0FB3PYWC16XW: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 51Q2FNTC3C9BCS0FB3PYWC16XW
{"ts":"2025-12-03T17:26:57.956Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"e4b1f27d-7708-4247-a934-22f6071950d5","stage":"booking","correlationId":"booking-created:d72aeeff39b1bff8908f07db"}
{"ts":"2025-12-03T17:26:58.116Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"f16d3bb0-15e8-460e-822a-a095aa3888ec","stage":"booking","correlationId":"booking-created:296bb56739e2be17dc50fda0","attempts":1}
üìÖ Processing booking created for customer: 0QM3FB1M39C6YTTNCYFDEC3A8M
Full booking data: {
  "id": "ohkoyexpj0kdsg",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-09T19:00:00Z",
  "created_at": "2025-12-03T17:25:39Z",
  "updated_at": "2025-12-03T17:25:39Z",
  "customer_id": "0QM3FB1M39C6YTTNCYFDEC3A8M",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "0QM3FB1M39C6YTTNCYFDEC3A8M",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMMHlgFBIFbMTRap",
      "any_team_member": false,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1764609601083,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Kirsten Hong
‚ÑπÔ∏è Customer 0QM3FB1M39C6YTTNCYFDEC3A8M already received signup bonus, not first booking
{"ts":"2025-12-03T17:26:58.250Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"f16d3bb0-15e8-460e-822a-a095aa3888ec","stage":"booking","correlationId":"booking-created:296bb56739e2be17dc50fda0"}
{"ts":"2025-12-03T17:35:04.239Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Server has closed the connection.","stack":"PrismaClientKnownRequestError: Server has closed the connection.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-03T17:35:07.431Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"d121a44a-ab6b-4642-a4b8-0a7cd4d12067","stage":"booking","correlationId":"booking-created:6ca9b5ac3fa137390bf0a7ba","attempts":1}
üìÖ Processing booking created for customer: 0QM3FB1M39C6YTTNCYFDEC3A8M
Full booking data: {
  "id": "uhmgfvr4tuw6bq",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-09T00:10:00Z",
  "created_at": "2025-12-03T17:28:56Z",
  "updated_at": "2025-12-03T17:28:56Z",
  "customer_id": "0QM3FB1M39C6YTTNCYFDEC3A8M",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "0QM3FB1M39C6YTTNCYFDEC3A8M",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMOscywuGXO2VURY",
      "any_team_member": true,
      "duration_minutes": 140,
      "intermission_minutes": 0,
      "service_variation_id": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "CJI5WHOAKSFTASYPJ4MSYZLS"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Kirsten Hong
‚ÑπÔ∏è Customer 0QM3FB1M39C6YTTNCYFDEC3A8M already received signup bonus, not first booking
{"ts":"2025-12-03T17:35:08.546Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"d121a44a-ab6b-4642-a4b8-0a7cd4d12067","stage":"booking","correlationId":"booking-created:6ca9b5ac3fa137390bf0a7ba"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-12-03T17:52:21.799Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"559ddd95-d392-4efb-86d4-7a00f35c0ac3","stage":"booking","correlationId":"booking-created:494b2362a683e2b2e549e66c","attempts":1}
üìÖ Processing booking created for customer: HDMZ5305NFSPHND34N1HCQRJ2G
Full booking data: {
  "id": "gm43jjcxomxs3v",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-05T03:00:00Z",
  "created_at": "2025-12-03T17:36:43Z",
  "updated_at": "2025-12-03T17:36:43Z",
  "customer_id": "HDMZ5305NFSPHND34N1HCQRJ2G",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMWAtQTYmZpwwxii"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMSt73bSp59caRzt",
      "any_team_member": false,
      "duration_minutes": 30,
      "intermission_minutes": 0,
      "service_variation_id": "JNRUKPGA2ZZUFCEB6YPNDC2Y",
      "service_variation_version": 1760895536505,
      "service_variation_client_id": "JNRUKPGA2ZZUFCEB6YPNDC2Y"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Savannah Williams
üéâ First booking detected for customer: HDMZ5305NFSPHND34N1HCQRJ2G
   Name: Savannah Williams
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer HDMZ5305NFSPHND34N1HCQRJ2G...
Error getting custom attributes for customer HDMZ5305NFSPHND34N1HCQRJ2G: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: HDMZ5305NFSPHND34N1HCQRJ2G
{"ts":"2025-12-03T17:52:22.543Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"559ddd95-d392-4efb-86d4-7a00f35c0ac3","stage":"booking","correlationId":"booking-created:494b2362a683e2b2e549e66c"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-12-03T18:00:44.676Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-03T18:00:48.681Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-03T18:01:10.535Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-03T18:01:14.541Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-03T18:01:17.881Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"7ed13870-9abb-4e92-b80d-f493d0d6de6c","stage":"booking","correlationId":"booking-created:803c633be574926fab63f065","attempts":1}
üìÖ Processing booking created for customer: YTSZ1P7GT9D1YCB5D278253TDW
Full booking data: {
  "id": "l5kus5gdit0btj",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-18T21:40:00Z",
  "created_at": "2025-12-03T17:53:08Z",
  "updated_at": "2025-12-03T17:53:08Z",
  "customer_id": "YTSZ1P7GT9D1YCB5D278253TDW",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMWAtQTYmZpwwxii"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMgsjtuk5cfKnstq",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "ZEAKNB35I37RMXNUBGWDZQIM",
      "service_variation_version": 1760895536505,
      "service_variation_client_id": "ZEAKNB35I37RMXNUBGWDZQIM"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Kathrin Koz
‚ÑπÔ∏è Customer YTSZ1P7GT9D1YCB5D278253TDW already received signup bonus, not first booking
{"ts":"2025-12-03T18:01:18.283Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"7ed13870-9abb-4e92-b80d-f493d0d6de6c","stage":"booking","correlationId":"booking-created:803c633be574926fab63f065"}
{"ts":"2025-12-03T18:01:18.444Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"3d89caf9-6a5b-4de8-9635-ef500da29b20","stage":"booking","correlationId":"booking-created:ec0faeb43ea584d6af3691ec","attempts":1}
üìÖ Processing booking created for customer: 4HSMXA6FYMT7GV13XZXQ7HBSNM
Full booking data: {
  "id": "7xzycrg2cqw3aq",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-19T22:00:00Z",
  "created_at": "2025-12-03T17:53:38Z",
  "updated_at": "2025-12-03T17:53:38Z",
  "customer_id": "4HSMXA6FYMT7GV13XZXQ7HBSNM",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMWAtQTYmZpwwxii"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMgsjtuk5cfKnstq",
      "any_team_member": false,
      "duration_minutes": 110,
      "intermission_minutes": 0,
      "service_variation_id": "6TYOE67IDYTKHW2ZG6HKVZER",
      "service_variation_version": 1757963765505,
      "service_variation_client_id": "6TYOE67IDYTKHW2ZG6HKVZER"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Katie Saunders
üéâ First booking detected for customer: 4HSMXA6FYMT7GV13XZXQ7HBSNM
   Name: Katie Saunders
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 4HSMXA6FYMT7GV13XZXQ7HBSNM...
Error getting custom attributes for customer 4HSMXA6FYMT7GV13XZXQ7HBSNM: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 4HSMXA6FYMT7GV13XZXQ7HBSNM
{"ts":"2025-12-03T18:01:18.883Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"3d89caf9-6a5b-4de8-9635-ef500da29b20","stage":"booking","correlationId":"booking-created:ec0faeb43ea584d6af3691ec"}
{"ts":"2025-12-03T18:01:19.042Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"4bc0ce02-2687-455f-b732-134971c693ff","stage":"customer_ingest","correlationId":"customer-created:daa5fdb6bdf72d41d4ea92a1","attempts":1}
üì• Received customer data: {
  "id": "J0D5E143AS7DG5716AY0SMXX10",
  "address": {
    "country": "US"
  },
  "version": 0,
  "group_ids": [
    "LT4ZHFBQQYB2N.APPOINTMENTS"
  ],
  "created_at": "2025-12-03T18:00:42.969Z",
  "given_name": "Ana",
  "updated_at": "2025-12-03T18:00:42Z",
  "family_name": "Cardoso",
  "preferences": {
    "email_unsubscribed": false
  },
  "phone_number": "+12093230064",
  "email_address": "cardosanaz@gmail.com",
  "creation_source": "APPOINTMENTS"
}
üë§ Processing customer creation: J0D5E143AS7DG5716AY0SMXX10
üìç IP Address: unknown
üìß Email: cardosanaz@gmail.com
üìû Phone: +12093230064
üë§ Name: Ana Cardoso
‚ö†Ô∏è Suspicious IP activity detected: unknown used by 133 customers
‚ö†Ô∏è Suspicious activity detected for customer J0D5E143AS7DG5716AY0SMXX10, flagging for review
üéâ New customer detected: J0D5E143AS7DG5716AY0SMXX10
‚úÖ Customer added to database as NEW (temporary mark)
   - Will check for referral code when they book
   - Will give gift card on first booking if code found
‚úÖ Verification: Customer found in DB: true
{"ts":"2025-12-03T18:01:19.405Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"4bc0ce02-2687-455f-b732-134971c693ff","stage":"customer_ingest","correlationId":"customer-created:daa5fdb6bdf72d41d4ea92a1"}
{"ts":"2025-12-03T18:01:19.568Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"7e582ced-7eb9-4ea8-a865-7b7587771e15","stage":"booking","correlationId":"booking-created:234b7b1fad55239dd4bf873a","attempts":1}
üìÖ Processing booking created for customer: J0D5E143AS7DG5716AY0SMXX10
Full booking data: {
  "id": "argwu3yr6587bt",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-05T20:20:00Z",
  "created_at": "2025-12-03T18:00:47Z",
  "updated_at": "2025-12-03T18:00:47Z",
  "customer_id": "J0D5E143AS7DG5716AY0SMXX10",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "J0D5E143AS7DG5716AY0SMXX10",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMkdrQsxG5tlf-c_",
      "any_team_member": true,
      "duration_minutes": 140,
      "intermission_minutes": 0,
      "service_variation_id": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "service_variation_version": 1764783981722,
      "service_variation_client_id": "CJI5WHOAKSFTASYPJ4MSYZLS"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Ana Cardoso
üéâ First booking detected for customer: J0D5E143AS7DG5716AY0SMXX10
   Name: Ana Cardoso
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer J0D5E143AS7DG5716AY0SMXX10...
Error getting custom attributes for customer J0D5E143AS7DG5716AY0SMXX10: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: J0D5E143AS7DG5716AY0SMXX10
{"ts":"2025-12-03T18:01:20.074Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"7e582ced-7eb9-4ea8-a865-7b7587771e15","stage":"booking","correlationId":"booking-created:234b7b1fad55239dd4bf873a"}
{"ts":"2025-12-03T18:01:20.235Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"4bc0ce02-2687-455f-b732-134971c693ff","stage":"customer_ingest","correlationId":"customer-created:daa5fdb6bdf72d41d4ea92a1","attempts":2}
üì• Received customer data: {
  "id": "J0D5E143AS7DG5716AY0SMXX10",
  "address": {
    "country": "US"
  },
  "version": 0,
  "group_ids": [
    "LT4ZHFBQQYB2N.APPOINTMENTS"
  ],
  "created_at": "2025-12-03T18:00:42.969Z",
  "given_name": "Ana",
  "updated_at": "2025-12-03T18:00:42Z",
  "family_name": "Cardoso",
  "preferences": {
    "email_unsubscribed": false
  },
  "phone_number": "+12093230064",
  "email_address": "cardosanaz@gmail.com",
  "creation_source": "APPOINTMENTS"
}
üë§ Processing customer creation: J0D5E143AS7DG5716AY0SMXX10
üìç IP Address: unknown
üìß Email: cardosanaz@gmail.com
üìû Phone: +12093230064
üë§ Name: Ana Cardoso
‚ö†Ô∏è Suspicious IP activity detected: unknown used by 134 customers
‚ö†Ô∏è Suspicious activity detected for customer J0D5E143AS7DG5716AY0SMXX10, flagging for review
üéâ New customer detected: J0D5E143AS7DG5716AY0SMXX10
‚úÖ Customer added to database as NEW (temporary mark)
   - Will check for referral code when they book
   - Will give gift card on first booking if code found
‚úÖ Verification: Customer found in DB: true
{"ts":"2025-12-03T18:01:20.543Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"4bc0ce02-2687-455f-b732-134971c693ff","stage":"customer_ingest","correlationId":"customer-created:daa5fdb6bdf72d41d4ea92a1"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-12-03T18:08:09.548Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"23281787-2ca6-45a5-884a-339ad3757f4e","stage":"customer_ingest","correlationId":"customer-created:cdb7f6f5fccaf99ed9d7841a","attempts":1}
üì• Received customer data: {
  "id": "Z68BCYF3VWJM0YYQ6S0MYMFCAR",
  "address": {
    "country": "US"
  },
  "version": 0,
  "group_ids": [
    "LT4ZHFBQQYB2N.APPOINTMENTS"
  ],
  "created_at": "2025-12-03T18:01:56.468Z",
  "given_name": "Nicole",
  "updated_at": "2025-12-03T18:01:56Z",
  "family_name": "Greene",
  "preferences": {
    "email_unsubscribed": false
  },
  "phone_number": "+14352250002",
  "email_address": "ngreenepc@gmail.com",
  "creation_source": "APPOINTMENTS"
}
üë§ Processing customer creation: Z68BCYF3VWJM0YYQ6S0MYMFCAR
üìç IP Address: unknown
üìß Email: ngreenepc@gmail.com
üìû Phone: +14352250002
üë§ Name: Nicole Greene
‚ö†Ô∏è Suspicious IP activity detected: unknown used by 134 customers
‚ö†Ô∏è Suspicious activity detected for customer Z68BCYF3VWJM0YYQ6S0MYMFCAR, flagging for review
üéâ New customer detected: Z68BCYF3VWJM0YYQ6S0MYMFCAR
‚úÖ Customer added to database as NEW (temporary mark)
   - Will check for referral code when they book
   - Will give gift card on first booking if code found
‚úÖ Verification: Customer found in DB: true
{"ts":"2025-12-03T18:08:10.272Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"23281787-2ca6-45a5-884a-339ad3757f4e","stage":"customer_ingest","correlationId":"customer-created:cdb7f6f5fccaf99ed9d7841a"}
{"ts":"2025-12-03T18:08:10.435Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"e191c505-c5a8-4a06-86f6-a99c6ed3b6e0","stage":"booking","correlationId":"booking-created:0f48d37babd7305b6e94b133","attempts":1}
üìÖ Processing booking created for customer: Z68BCYF3VWJM0YYQ6S0MYMFCAR
Full booking data: {
  "id": "7ysq4qsawufo2m",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-03T23:00:00Z",
  "created_at": "2025-12-03T18:01:59Z",
  "updated_at": "2025-12-03T18:01:59Z",
  "customer_id": "Z68BCYF3VWJM0YYQ6S0MYMFCAR",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "Z68BCYF3VWJM0YYQ6S0MYMFCAR",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMMHlgFBIFbMTRap",
      "any_team_member": false,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1764609601083,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Nicole Greene
üéâ First booking detected for customer: Z68BCYF3VWJM0YYQ6S0MYMFCAR
   Name: Nicole Greene
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer Z68BCYF3VWJM0YYQ6S0MYMFCAR...
Error getting custom attributes for customer Z68BCYF3VWJM0YYQ6S0MYMFCAR: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: Z68BCYF3VWJM0YYQ6S0MYMFCAR
{"ts":"2025-12-03T18:08:10.894Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"e191c505-c5a8-4a06-86f6-a99c6ed3b6e0","stage":"booking","correlationId":"booking-created:0f48d37babd7305b6e94b133"}
{"ts":"2025-12-03T18:08:11.062Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"4bc0ce02-2687-455f-b732-134971c693ff","stage":"customer_ingest","correlationId":"customer-created:daa5fdb6bdf72d41d4ea92a1","attempts":3}
üì• Received customer data: {
  "id": "J0D5E143AS7DG5716AY0SMXX10",
  "address": {
    "country": "US"
  },
  "version": 0,
  "group_ids": [
    "LT4ZHFBQQYB2N.APPOINTMENTS"
  ],
  "created_at": "2025-12-03T18:00:42.969Z",
  "given_name": "Ana",
  "updated_at": "2025-12-03T18:00:42Z",
  "family_name": "Cardoso",
  "preferences": {
    "email_unsubscribed": false
  },
  "phone_number": "+12093230064",
  "email_address": "cardosanaz@gmail.com",
  "creation_source": "APPOINTMENTS"
}
üë§ Processing customer creation: J0D5E143AS7DG5716AY0SMXX10
üìç IP Address: unknown
üìß Email: cardosanaz@gmail.com
üìû Phone: +12093230064
üë§ Name: Ana Cardoso
‚ö†Ô∏è Suspicious IP activity detected: unknown used by 135 customers
‚ö†Ô∏è Suspicious activity detected for customer J0D5E143AS7DG5716AY0SMXX10, flagging for review
üéâ New customer detected: J0D5E143AS7DG5716AY0SMXX10
‚úÖ Customer added to database as NEW (temporary mark)
   - Will check for referral code when they book
   - Will give gift card on first booking if code found
‚úÖ Verification: Customer found in DB: true
{"ts":"2025-12-03T18:08:11.396Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"4bc0ce02-2687-455f-b732-134971c693ff","stage":"customer_ingest","correlationId":"customer-created:daa5fdb6bdf72d41d4ea92a1"}
{"ts":"2025-12-03T18:08:11.838Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"7e582ced-7eb9-4ea8-a865-7b7587771e15","stage":"booking","correlationId":"booking-created:234b7b1fad55239dd4bf873a","attempts":2}
üìÖ Processing booking created for customer: J0D5E143AS7DG5716AY0SMXX10
Full booking data: {
  "id": "argwu3yr6587bt",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-05T20:20:00Z",
  "created_at": "2025-12-03T18:00:47Z",
  "updated_at": "2025-12-03T18:00:47Z",
  "customer_id": "J0D5E143AS7DG5716AY0SMXX10",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "J0D5E143AS7DG5716AY0SMXX10",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMkdrQsxG5tlf-c_",
      "any_team_member": true,
      "duration_minutes": 140,
      "intermission_minutes": 0,
      "service_variation_id": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "service_variation_version": 1764783981722,
      "service_variation_client_id": "CJI5WHOAKSFTASYPJ4MSYZLS"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Ana Cardoso
üéâ First booking detected for customer: J0D5E143AS7DG5716AY0SMXX10
   Name: Ana Cardoso
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer J0D5E143AS7DG5716AY0SMXX10...
Error getting custom attributes for customer J0D5E143AS7DG5716AY0SMXX10: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: J0D5E143AS7DG5716AY0SMXX10
{"ts":"2025-12-03T18:08:12.674Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"7e582ced-7eb9-4ea8-a865-7b7587771e15","stage":"booking","correlationId":"booking-created:234b7b1fad55239dd4bf873a"}
{"ts":"2025-12-03T18:08:13.137Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"83ada9d1-8fb2-45c3-a0a6-98089fd4cd94","stage":"booking","correlationId":"booking-created:6e87712237b95d363bc5fa4b","attempts":1}
üìÖ Processing booking created for customer: 4HSMXA6FYMT7GV13XZXQ7HBSNM
Full booking data: {
  "id": "acs7696lsewgpg",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-15T22:30:00Z",
  "created_at": "2025-12-03T18:02:12Z",
  "updated_at": "2025-12-03T18:02:12Z",
  "customer_id": "4HSMXA6FYMT7GV13XZXQ7HBSNM",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMWAtQTYmZpwwxii"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMILsQUVwLkLzbVo",
      "any_team_member": false,
      "duration_minutes": 100,
      "intermission_minutes": 0,
      "service_variation_id": "BM556FTNFOTEHYVG4GPXAXFM",
      "service_variation_version": 1762893947284,
      "service_variation_client_id": "BM556FTNFOTEHYVG4GPXAXFM"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Katie Saunders
üéâ First booking detected for customer: 4HSMXA6FYMT7GV13XZXQ7HBSNM
   Name: Katie Saunders
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 4HSMXA6FYMT7GV13XZXQ7HBSNM...
Error getting custom attributes for customer 4HSMXA6FYMT7GV13XZXQ7HBSNM: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 4HSMXA6FYMT7GV13XZXQ7HBSNM
{"ts":"2025-12-03T18:08:13.718Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"83ada9d1-8fb2-45c3-a0a6-98089fd4cd94","stage":"booking","correlationId":"booking-created:6e87712237b95d363bc5fa4b"}
{"ts":"2025-12-03T18:25:51.867Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Server has closed the connection.","stack":"PrismaClientKnownRequestError: Server has closed the connection.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:8034)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-12-03T18:32:23.601Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"c5edbe9d-e10a-4bad-9aa6-bde1db146d2c","stage":"booking","correlationId":"booking-created:65629f3bb24507e696a50952","attempts":1}
üìÖ Processing booking created for customer: 992FQZKFJWK2SH6P04Q1DK8Q0G
Full booking data: {
  "id": "cxfbj7vrhsofhj",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-09T22:50:00Z",
  "created_at": "2025-12-03T18:26:01Z",
  "updated_at": "2025-12-03T18:26:01Z",
  "customer_id": "992FQZKFJWK2SH6P04Q1DK8Q0G",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "992FQZKFJWK2SH6P04Q1DK8Q0G",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMyUMvTJIj2HrHSg",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "JMTK5M2CY2W7WEXSTAJKAJ35",
      "service_variation_version": 1764609577793,
      "service_variation_client_id": "JMTK5M2CY2W7WEXSTAJKAJ35"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Jacki Jones
üéâ First booking detected for customer: 992FQZKFJWK2SH6P04Q1DK8Q0G
   Name: Jacki Jones
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 992FQZKFJWK2SH6P04Q1DK8Q0G...
Error getting custom attributes for customer 992FQZKFJWK2SH6P04Q1DK8Q0G: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 992FQZKFJWK2SH6P04Q1DK8Q0G
{"ts":"2025-12-03T18:32:24.259Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"c5edbe9d-e10a-4bad-9aa6-bde1db146d2c","stage":"booking","correlationId":"booking-created:65629f3bb24507e696a50952"}
{"ts":"2025-12-03T18:32:24.410Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"d0e5da3f-a584-4351-9888-99c9bc410819","stage":"booking","correlationId":"booking-created:d8e7f86c16da0d95258d7481","attempts":1}
üìÖ Processing booking created for customer: XYVBSD2DKD6AX5QW0RKP0R4XN8
Full booking data: {
  "id": "yo7dr6b81fxmnk",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-05T23:50:00Z",
  "created_at": "2025-12-03T18:29:31Z",
  "updated_at": "2025-12-03T18:29:31Z",
  "customer_id": "XYVBSD2DKD6AX5QW0RKP0R4XN8",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMQPbDVvvOCLwqsy"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMyUMvTJIj2HrHSg",
      "any_team_member": false,
      "duration_minutes": 45,
      "intermission_minutes": 0,
      "service_variation_id": "VVA7G2UN7N2HUFMCW5LQOVHB",
      "service_variation_version": 1764783981722,
      "service_variation_client_id": "VVA7G2UN7N2HUFMCW5LQOVHB"
    },
    {
      "resource_ids": [
        "KAOXILA4CV7A23VRAACC4R66"
      ],
      "team_member_id": "TMyUMvTJIj2HrHSg",
      "any_team_member": false,
      "duration_minutes": 60,
      "intermission_minutes": 0,
      "service_variation_id": "SBE5XUATXRM76CBTT25HL2NZ",
      "service_variation_version": 1760895536505,
      "service_variation_client_id": "SBE5XUATXRM76CBTT25HL2NZ"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: lee hnetinka
Error retrieving Square customer XYVBSD2DKD6AX5QW0RKP0R4XN8: Response status code was not ok: 401.
Square API errors: [
  {
    "category": "AUTHENTICATION_ERROR",
    "code": "UNAUTHORIZED",
    "detail": "This request could not be authorized."
  }
]
üéâ First booking detected for customer: XYVBSD2DKD6AX5QW0RKP0R4XN8
   Name: lee hnetinka
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer XYVBSD2DKD6AX5QW0RKP0R4XN8...
Error getting custom attributes for customer XYVBSD2DKD6AX5QW0RKP0R4XN8: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: XYVBSD2DKD6AX5QW0RKP0R4XN8
{"ts":"2025-12-03T18:32:25.009Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"d0e5da3f-a584-4351-9888-99c9bc410819","stage":"booking","correlationId":"booking-created:d8e7f86c16da0d95258d7481"}
{"ts":"2025-12-03T18:49:33.997Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Server has closed the connection.","stack":"PrismaClientKnownRequestError: Server has closed the connection.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-03T18:49:37.127Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"092e9a65-cc49-4e47-866f-8083da6c5c8b","stage":"payment","correlationId":"payment-updated:869f3282b79aa2163828127a","attempts":1}
üí∞ Processing payment completion for customer: JBJGE76DFEY21177TXB682M734
   Payment source_type: CARD
   Payment tender_types: []
Customer JBJGE76DFEY21177TXB682M734 already completed first payment
{"ts":"2025-12-03T18:49:37.594Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"092e9a65-cc49-4e47-866f-8083da6c5c8b","stage":"payment","correlationId":"payment-updated:869f3282b79aa2163828127a"}
{"ts":"2025-12-03T18:49:37.760Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"56371d20-4383-4ef7-9be9-b96037107dbe","stage":"payment","correlationId":"payment-updated:406f73765a892ec841c9dfe2","attempts":1}
üí∞ Processing payment completion for customer: JBJGE76DFEY21177TXB682M734
   Payment source_type: CARD
   Payment tender_types: []
Customer JBJGE76DFEY21177TXB682M734 already completed first payment
{"ts":"2025-12-03T18:49:37.912Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"56371d20-4383-4ef7-9be9-b96037107dbe","stage":"payment","correlationId":"payment-updated:406f73765a892ec841c9dfe2"}
{"ts":"2025-12-03T18:49:38.072Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"03934bc6-bc88-463c-8526-2bcaee18d544","stage":"booking","correlationId":"booking-created:8e53e1a16c226eb8f1d04124","attempts":1}
üìÖ Processing booking created for customer: 1D774SB7RN4B186QMJT4T81DN8
Full booking data: {
  "id": "mrhf7hd8obhzfh",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-16T01:30:00Z",
  "created_at": "2025-12-03T18:42:05Z",
  "updated_at": "2025-12-03T18:42:05Z",
  "customer_id": "1D774SB7RN4B186QMJT4T81DN8",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMQPbDVvvOCLwqsy"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMNW4SIF7tjp4oM_",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "BRSIGZFOWC6F4ERPKX3CODLU",
      "service_variation_version": 1762893947284,
      "service_variation_client_id": "BRSIGZFOWC6F4ERPKX3CODLU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Dagmar Dolby
Error retrieving Square customer 1D774SB7RN4B186QMJT4T81DN8: Response status code was not ok: 401.
Square API errors: [
  {
    "category": "AUTHENTICATION_ERROR",
    "code": "UNAUTHORIZED",
    "detail": "This request could not be authorized."
  }
]
üéâ First booking detected for customer: 1D774SB7RN4B186QMJT4T81DN8
   Name: Dagmar Dolby
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 1D774SB7RN4B186QMJT4T81DN8...
Error getting custom attributes for customer 1D774SB7RN4B186QMJT4T81DN8: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 1D774SB7RN4B186QMJT4T81DN8
{"ts":"2025-12-03T18:49:38.751Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"03934bc6-bc88-463c-8526-2bcaee18d544","stage":"booking","correlationId":"booking-created:8e53e1a16c226eb8f1d04124"}
{"ts":"2025-12-03T18:49:38.920Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"a1a562b9-9243-449d-afdd-73abf861635e","stage":"booking","correlationId":"booking-created:4900b2642f83a6b2ea699dc5","attempts":1}
üìÖ Processing booking created for customer: DWZR4NYSSWWHP5JV5HDN2NV7PM
Full booking data: {
  "id": "lfn3ijnw2p1wbd",
  "source": "THIRD_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-06T21:00:00Z",
  "created_at": "2025-12-03T18:43:36Z",
  "updated_at": "2025-12-03T18:43:36Z",
  "customer_id": "DWZR4NYSSWWHP5JV5HDN2NV7PM",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "DWZR4NYSSWWHP5JV5HDN2NV7PM",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMNW4SIF7tjp4oM_",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "BRSIGZFOWC6F4ERPKX3CODLU",
      "service_variation_version": 1764609577793,
      "service_variation_client_id": "BRSIGZFOWC6F4ERPKX3CODLU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Marley Edington
üéâ First booking detected for customer: DWZR4NYSSWWHP5JV5HDN2NV7PM
   Name: Marley Edington
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer DWZR4NYSSWWHP5JV5HDN2NV7PM...
Error getting custom attributes for customer DWZR4NYSSWWHP5JV5HDN2NV7PM: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: DWZR4NYSSWWHP5JV5HDN2NV7PM
{"ts":"2025-12-03T18:49:39.336Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"a1a562b9-9243-449d-afdd-73abf861635e","stage":"booking","correlationId":"booking-created:4900b2642f83a6b2ea699dc5"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-12-03T18:57:54.451Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"a483212e-ec97-4f7f-841e-67c0e36b6b12","stage":"payment","correlationId":"payment-updated:e6cc48eb858001960a93b1f1","attempts":1}
üí∞ Processing payment completion for customer: VK76GYDZ8DNJ4GQTWATAD2SAGM
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Alina Arzamassky
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Alina Arzamassky, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Alina Arzamassky
   - Email: Alina.arzamassky@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: VK76GYDZ8DNJ4GQTWATAD2SAGM
{"ts":"2025-12-03T18:57:55.063Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"a483212e-ec97-4f7f-841e-67c0e36b6b12","stage":"payment","correlationId":"payment-updated:e6cc48eb858001960a93b1f1"}
{"ts":"2025-12-03T18:57:55.286Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"d0e9b935-6f84-4640-8256-67b6773f46d0","stage":"payment","correlationId":"payment-updated:a6cae0cb447fc2b8ddd83bb4","attempts":1}
üí∞ Processing payment completion for customer: VK76GYDZ8DNJ4GQTWATAD2SAGM
   Payment source_type: CARD
   Payment tender_types: []
Customer VK76GYDZ8DNJ4GQTWATAD2SAGM already completed first payment
{"ts":"2025-12-03T18:57:56.716Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"d0e9b935-6f84-4640-8256-67b6773f46d0","stage":"payment","correlationId":"payment-updated:a6cae0cb447fc2b8ddd83bb4"}
{"ts":"2025-12-03T18:57:56.957Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"8f3f9dd1-7ce5-4581-8018-12ea1ae2a453","stage":"payment","correlationId":"payment-updated:a74fbcdc21c9a89d4811aa1a","attempts":1}
üí∞ Processing payment completion for customer: VK76GYDZ8DNJ4GQTWATAD2SAGM
   Payment source_type: CARD
   Payment tender_types: []
Customer VK76GYDZ8DNJ4GQTWATAD2SAGM already completed first payment
{"ts":"2025-12-03T18:57:57.194Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"8f3f9dd1-7ce5-4581-8018-12ea1ae2a453","stage":"payment","correlationId":"payment-updated:a74fbcdc21c9a89d4811aa1a"}
{"ts":"2025-12-03T18:57:57.419Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"235be968-4656-414e-94a2-7bd6f2aa1da1","stage":"payment","correlationId":"payment-updated:ccc03b435fef8a259c780003","attempts":1}
üí∞ Processing payment completion for customer: VK76GYDZ8DNJ4GQTWATAD2SAGM
   Payment source_type: CARD
   Payment tender_types: []
Customer VK76GYDZ8DNJ4GQTWATAD2SAGM already completed first payment
{"ts":"2025-12-03T18:57:57.555Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"235be968-4656-414e-94a2-7bd6f2aa1da1","stage":"payment","correlationId":"payment-updated:ccc03b435fef8a259c780003"}
{"ts":"2025-12-03T22:25:54.168Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"\nInvalid `prisma.$queryRaw()` invocation:\n\n\nTransaction API error: Transaction already closed: A query cannot be executed on an expired transaction. The timeout for this transaction was 5000 ms, however 7205075 ms passed since the start of the transaction. Consider increasing the interactive transaction timeout or doing less work in the transaction.","stack":"PrismaClientKnownRequestError: \nInvalid `prisma.$queryRaw()` invocation:\n\n\nTransaction API error: Transaction already closed: A query cannot be executed on an expired transaction. The timeout for this transaction was 5000 ms, however 7205075 ms passed since the start of the transaction. Consider increasing the interactive transaction timeout or doing less work in the transaction.\n    at $n.handleRequestError (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:121:7315)\n    at $n.handleAndLogRequestError (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:121:6623)\n    at $n.request (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:121:6307)\n    at async l (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:9633)\n    at async prisma.$transaction.isolationLevel (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:239:26)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:8000)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-03T22:25:57.829Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction failed due to a write conflict or a deadlock. Please retry your transaction","stack":"PrismaClientKnownRequestError: Transaction failed due to a write conflict or a deadlock. Please retry your transaction\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:8034)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-03T22:26:00.217Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"5f71f413-bad6-4984-81e3-5a3fe9be002d","stage":"payment","correlationId":"payment-updated:8d47f2142e21f3a316ddefc5","attempts":1}
üí∞ Processing payment completion for customer: CVSW0VNTSBP8R4SWGBN05SXXJ0
   Payment source_type: CARD
   Payment tender_types: []
Customer CVSW0VNTSBP8R4SWGBN05SXXJ0 already completed first payment
{"ts":"2025-12-03T22:26:01.641Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"5f71f413-bad6-4984-81e3-5a3fe9be002d","stage":"payment","correlationId":"payment-updated:8d47f2142e21f3a316ddefc5"}
{"ts":"2025-12-03T22:26:02.129Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"9ba58ea3-c598-4b0d-be5d-3ce37d355e1c","stage":"booking","correlationId":"booking-created:ea0d77652cfce221bac26fc2","attempts":1}
üìÖ Processing booking created for customer: CVSW0VNTSBP8R4SWGBN05SXXJ0
Full booking data: {
  "id": "hq0o25cvg0w1vj",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-22T18:00:00Z",
  "created_at": "2025-12-03T20:25:45Z",
  "updated_at": "2025-12-03T20:25:45Z",
  "customer_id": "CVSW0VNTSBP8R4SWGBN05SXXJ0",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMWAtQTYmZpwwxii"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMVwAQUdLz6no-cB",
      "any_team_member": false,
      "duration_minutes": 100,
      "intermission_minutes": 0,
      "service_variation_id": "GSZZR45VJXB44NF4P4WXI5NB",
      "service_variation_version": 1764609577793,
      "service_variation_client_id": "GSZZR45VJXB44NF4P4WXI5NB"
    },
    {
      "team_member_id": "TMVwAQUdLz6no-cB",
      "any_team_member": false,
      "duration_minutes": 5,
      "intermission_minutes": 0,
      "service_variation_id": "DBRXEHQPCF7V4APTHDQTZW62",
      "service_variation_version": 1762374620368,
      "service_variation_client_id": "DBRXEHQPCF7V4APTHDQTZW62"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Kristin Smith
üéâ First booking detected for customer: CVSW0VNTSBP8R4SWGBN05SXXJ0
   Name: Kristin Smith
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer CVSW0VNTSBP8R4SWGBN05SXXJ0...
Error getting custom attributes for customer CVSW0VNTSBP8R4SWGBN05SXXJ0: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: CVSW0VNTSBP8R4SWGBN05SXXJ0
{"ts":"2025-12-03T22:26:02.576Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"9ba58ea3-c598-4b0d-be5d-3ce37d355e1c","stage":"booking","correlationId":"booking-created:ea0d77652cfce221bac26fc2"}
{"ts":"2025-12-03T22:26:02.732Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"4b47eb03-eb85-4b42-892a-8a8f559b3c45","stage":"booking","correlationId":"booking-created:cc3d38880e9af25f65d94ce3","attempts":1}
üìÖ Processing booking created for customer: EC41GCW0MHD28MQQ9B6H5QH4S8
Full booking data: {
  "id": "l4gurlr09v8jez",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-20T20:20:00Z",
  "created_at": "2025-12-03T20:30:21Z",
  "updated_at": "2025-12-03T20:30:21Z",
  "customer_id": "EC41GCW0MHD28MQQ9B6H5QH4S8",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "EC41GCW0MHD28MQQ9B6H5QH4S8",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMOscywuGXO2VURY",
      "any_team_member": false,
      "duration_minutes": 140,
      "intermission_minutes": 0,
      "service_variation_id": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "service_variation_version": 1764783981722,
      "service_variation_client_id": "CJI5WHOAKSFTASYPJ4MSYZLS"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Paula Arce
üéâ First booking detected for customer: EC41GCW0MHD28MQQ9B6H5QH4S8
   Name: Paula Arce
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer EC41GCW0MHD28MQQ9B6H5QH4S8...
Error getting custom attributes for customer EC41GCW0MHD28MQQ9B6H5QH4S8: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: EC41GCW0MHD28MQQ9B6H5QH4S8
{"ts":"2025-12-03T22:26:03.115Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"4b47eb03-eb85-4b42-892a-8a8f559b3c45","stage":"booking","correlationId":"booking-created:cc3d38880e9af25f65d94ce3"}
{"ts":"2025-12-03T22:26:03.272Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"aa3d33fa-79a2-42a7-9b28-9fd95720c525","stage":"booking","correlationId":"booking-created:8b46fb8e525a188a4fd35327","attempts":1}
üìÖ Processing booking created for customer: BX2SZCCDJQPF5E64QDE8MM534M
Full booking data: {
  "id": "50lltyvry038mu",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-03T22:00:00Z",
  "created_at": "2025-12-03T20:32:19Z",
  "updated_at": "2025-12-03T20:32:19Z",
  "customer_id": "BX2SZCCDJQPF5E64QDE8MM534M",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMWAtQTYmZpwwxii"
  },
  "appointment_segments": [
    {
      "resource_ids": [
        "5OVIQ6GSSUXORACP6T7WBAQ7"
      ],
      "team_member_id": "TM-zXe9fXe4axYWn",
      "any_team_member": false,
      "duration_minutes": 60,
      "intermission_minutes": 0,
      "service_variation_id": "SBE5XUATXRM76CBTT25HL2NZ",
      "service_variation_version": 1760895536505,
      "service_variation_client_id": "SBE5XUATXRM76CBTT25HL2NZ"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Lynn Rosenzweig
üéâ First booking detected for customer: BX2SZCCDJQPF5E64QDE8MM534M
   Name: Lynn Rosenzweig
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer BX2SZCCDJQPF5E64QDE8MM534M...
Error getting custom attributes for customer BX2SZCCDJQPF5E64QDE8MM534M: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: BX2SZCCDJQPF5E64QDE8MM534M
{"ts":"2025-12-03T22:26:03.647Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"aa3d33fa-79a2-42a7-9b28-9fd95720c525","stage":"booking","correlationId":"booking-created:8b46fb8e525a188a4fd35327"}
{"ts":"2025-12-03T22:26:03.800Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"54332733-2e34-4c0e-8fcf-f50dd949d959","stage":"payment","correlationId":"payment-updated:1560719f067e47a1f783a217","attempts":1}
üí∞ Processing payment completion for customer: 8QZMQK99PZH7D9DBY4KM639NGM
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Cauteaux Vrakelos
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Cauteaux Vrakelos, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Cauteaux Vrakelos
   - Email: cauteaux@yahoo.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: 8QZMQK99PZH7D9DBY4KM639NGM
{"ts":"2025-12-03T22:26:04.104Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"54332733-2e34-4c0e-8fcf-f50dd949d959","stage":"payment","correlationId":"payment-updated:1560719f067e47a1f783a217"}
{"ts":"2025-12-03T22:26:04.261Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"62ea95b1-d10a-4f6a-896e-467010d6484b","stage":"payment","correlationId":"payment-updated:c8ac35138e169f83d3adbeff","attempts":1}
üí∞ Processing payment completion for customer: 8QZMQK99PZH7D9DBY4KM639NGM
   Payment source_type: CARD
   Payment tender_types: []
Customer 8QZMQK99PZH7D9DBY4KM639NGM already completed first payment
{"ts":"2025-12-03T22:26:04.392Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"62ea95b1-d10a-4f6a-896e-467010d6484b","stage":"payment","correlationId":"payment-updated:c8ac35138e169f83d3adbeff"}
{"ts":"2025-12-03T22:26:04.546Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"6615d7e8-abbe-444e-8c9e-3ec754af427e","stage":"payment","correlationId":"payment-updated:bd5edec8417282cc7241b607","attempts":1}
üí∞ Processing payment completion for customer: 8QZMQK99PZH7D9DBY4KM639NGM
   Payment source_type: CARD
   Payment tender_types: []
Customer 8QZMQK99PZH7D9DBY4KM639NGM already completed first payment
{"ts":"2025-12-03T22:26:04.679Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"6615d7e8-abbe-444e-8c9e-3ec754af427e","stage":"payment","correlationId":"payment-updated:bd5edec8417282cc7241b607"}
{"ts":"2025-12-03T22:26:04.836Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"6614742b-9152-471c-aef6-c2523876555c","stage":"payment","correlationId":"payment-updated:0fd3ed0a449316bab281677c","attempts":1}
üí∞ Processing payment completion for customer: 8QZMQK99PZH7D9DBY4KM639NGM
   Payment source_type: CARD
   Payment tender_types: []
Customer 8QZMQK99PZH7D9DBY4KM639NGM already completed first payment
{"ts":"2025-12-03T22:26:04.965Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"6614742b-9152-471c-aef6-c2523876555c","stage":"payment","correlationId":"payment-updated:0fd3ed0a449316bab281677c"}
{"ts":"2025-12-03T22:26:05.119Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"a94bf8f2-9923-4594-8c32-4cab85475877","stage":"booking","correlationId":"booking-created:e86f6aebfeee01a09a39e045","attempts":1}
üìÖ Processing booking created for customer: B7Z4GS9RKS7M918BB65N545J10
Full booking data: {
  "id": "2wmhvuh07sucw5",
  "source": "THIRD_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-06T01:00:00Z",
  "created_at": "2025-12-03T20:49:00Z",
  "updated_at": "2025-12-03T20:49:00Z",
  "customer_id": "B7Z4GS9RKS7M918BB65N545J10",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "B7Z4GS9RKS7M918BB65N545J10",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMkdrQsxG5tlf-c_",
      "any_team_member": true,
      "duration_minutes": 140,
      "intermission_minutes": 0,
      "service_variation_id": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "service_variation_version": 1764783981722,
      "service_variation_client_id": "CJI5WHOAKSFTASYPJ4MSYZLS"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Gloria Mar√≠a Benavides
üéâ First booking detected for customer: B7Z4GS9RKS7M918BB65N545J10
   Name: Gloria Mar√≠a Benavides
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer B7Z4GS9RKS7M918BB65N545J10...
Error getting custom attributes for customer B7Z4GS9RKS7M918BB65N545J10: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: B7Z4GS9RKS7M918BB65N545J10
{"ts":"2025-12-03T22:26:05.492Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"a94bf8f2-9923-4594-8c32-4cab85475877","stage":"booking","correlationId":"booking-created:e86f6aebfeee01a09a39e045"}
{"ts":"2025-12-03T22:26:05.646Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"6d067d8a-7291-48d5-9e0f-1f24cf2e5b25","stage":"payment","correlationId":"payment-updated:1fd16fbd3e001700b1dcb43b","attempts":1}
üí∞ Processing payment completion for customer: E5ZQZ7E7RHZKRW11G2HAVCN60M
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Angelina Yilmaz
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Angelina Yilmaz, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Angelina Yilmaz
   - Email: Krotovaa@yahoo.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: E5ZQZ7E7RHZKRW11G2HAVCN60M
{"ts":"2025-12-03T22:26:05.947Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"6d067d8a-7291-48d5-9e0f-1f24cf2e5b25","stage":"payment","correlationId":"payment-updated:1fd16fbd3e001700b1dcb43b"}
{"ts":"2025-12-03T22:26:06.104Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"cfbe4f4c-b5e5-4196-94e0-41c09122e807","stage":"payment","correlationId":"payment-updated:37fd68b719a66d0984ac9153","attempts":1}
üí∞ Processing payment completion for customer: E5ZQZ7E7RHZKRW11G2HAVCN60M
   Payment source_type: CARD
   Payment tender_types: []
Customer E5ZQZ7E7RHZKRW11G2HAVCN60M already completed first payment
{"ts":"2025-12-03T22:26:06.671Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"cfbe4f4c-b5e5-4196-94e0-41c09122e807","stage":"payment","correlationId":"payment-updated:37fd68b719a66d0984ac9153"}
{"ts":"2025-12-03T22:26:06.828Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"9413c718-94c2-4b33-9a36-e7de13827c29","stage":"customer_ingest","correlationId":"customer-created:79108443de1427985715ded7","attempts":1}
üì• Received customer data: {
  "id": "WMAX5WQN415FHGYKBQJEQNY8PG",
  "version": 0,
  "created_at": "2025-12-03T21:02:35.543Z",
  "given_name": "Ariel",
  "updated_at": "2025-12-03T21:02:35Z",
  "family_name": "Jelsma",
  "preferences": {
    "email_unsubscribed": false
  },
  "phone_number": "+14246317325",
  "email_address": "forge-velvets.71@icloud.com",
  "creation_source": "THIRD_PARTY"
}
üë§ Processing customer creation: WMAX5WQN415FHGYKBQJEQNY8PG
üìç IP Address: unknown
üìß Email: forge-velvets.71@icloud.com
üìû Phone: +14246317325
üë§ Name: Ariel Jelsma
‚ö†Ô∏è Suspicious IP activity detected: unknown used by 135 customers
‚ö†Ô∏è Suspicious activity detected for customer WMAX5WQN415FHGYKBQJEQNY8PG, flagging for review
üéâ New customer detected: WMAX5WQN415FHGYKBQJEQNY8PG
‚úÖ Customer added to database as NEW (temporary mark)
   - Will check for referral code when they book
   - Will give gift card on first booking if code found
‚úÖ Verification: Customer found in DB: true
{"ts":"2025-12-03T22:26:07.156Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"9413c718-94c2-4b33-9a36-e7de13827c29","stage":"customer_ingest","correlationId":"customer-created:79108443de1427985715ded7"}
{"ts":"2025-12-03T22:26:07.314Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"219b503a-2874-48f2-9ab9-b0dcf3c04ddb","stage":"customer_ingest","correlationId":"customer-created:a5ba446552dd90e17e792f6a","attempts":1}
üì• Received customer data: {
  "id": "PKTHKW7PZNJK8K46R6GB4J24VW",
  "address": {
    "country": "US"
  },
  "version": 0,
  "group_ids": [
    "LT4ZHFBQQYB2N.APPOINTMENTS"
  ],
  "created_at": "2025-12-03T21:07:46.208Z",
  "given_name": "Ariel",
  "updated_at": "2025-12-03T21:07:46Z",
  "family_name": "Jelsma",
  "preferences": {
    "email_unsubscribed": false
  },
  "phone_number": "+14246347325",
  "email_address": "premix-34.viral@icloud.com",
  "creation_source": "APPOINTMENTS"
}
üë§ Processing customer creation: PKTHKW7PZNJK8K46R6GB4J24VW
üìç IP Address: unknown
üìß Email: premix-34.viral@icloud.com
üìû Phone: +14246347325
üë§ Name: Ariel Jelsma
‚ö†Ô∏è Suspicious IP activity detected: unknown used by 136 customers
‚ö†Ô∏è Suspicious activity detected for customer PKTHKW7PZNJK8K46R6GB4J24VW, flagging for review
üéâ New customer detected: PKTHKW7PZNJK8K46R6GB4J24VW
‚úÖ Customer added to database as NEW (temporary mark)
   - Will check for referral code when they book
   - Will give gift card on first booking if code found
‚úÖ Verification: Customer found in DB: true
{"ts":"2025-12-03T22:26:07.580Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"219b503a-2874-48f2-9ab9-b0dcf3c04ddb","stage":"customer_ingest","correlationId":"customer-created:a5ba446552dd90e17e792f6a"}
{"ts":"2025-12-03T22:26:07.739Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"7e6436fb-b8b8-4942-827d-37a0b3f4bf8b","stage":"booking","correlationId":"booking-created:cac7f2127e432b160b9b71e5","attempts":1}
üìÖ Processing booking created for customer: XZH93NCTP50AQBQ79Q3FAE6RZM
Full booking data: {
  "id": "7tcoorqcf4fyks",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-27T18:00:00Z",
  "created_at": "2025-12-03T21:24:29Z",
  "updated_at": "2025-12-03T21:24:29Z",
  "customer_id": "XZH93NCTP50AQBQ79Q3FAE6RZM",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "XZH93NCTP50AQBQ79Q3FAE6RZM",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMXiw38Bbb7XQUWI",
      "any_team_member": false,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1764609601083,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Manon Gourdelier
üéâ First booking detected for customer: XZH93NCTP50AQBQ79Q3FAE6RZM
   Name: Manon Gourdelier
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer XZH93NCTP50AQBQ79Q3FAE6RZM...
Error getting custom attributes for customer XZH93NCTP50AQBQ79Q3FAE6RZM: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: XZH93NCTP50AQBQ79Q3FAE6RZM
{"ts":"2025-12-03T22:26:08.111Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"7e6436fb-b8b8-4942-827d-37a0b3f4bf8b","stage":"booking","correlationId":"booking-created:cac7f2127e432b160b9b71e5"}
{"ts":"2025-12-03T22:26:08.278Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"d62f0b88-4e9b-4f22-8587-0a6b468952c8","stage":"payment","correlationId":"payment-updated:478127faaccada10b937b059","attempts":1}
üí∞ Processing payment completion for customer: 82K003M730Q31BH8JCWDHFRDYC
   Payment source_type: CARD
   Payment tender_types: []
Customer 82K003M730Q31BH8JCWDHFRDYC already completed first payment
{"ts":"2025-12-03T22:26:08.412Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"d62f0b88-4e9b-4f22-8587-0a6b468952c8","stage":"payment","correlationId":"payment-updated:478127faaccada10b937b059"}
{"ts":"2025-12-03T22:26:08.570Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"2dde6432-9c9e-4d0c-865c-133ae3eb119e","stage":"payment","correlationId":"payment-updated:ccf6be6c70f3c40a680fecc5","attempts":1}
üí∞ Processing payment completion for customer: 82K003M730Q31BH8JCWDHFRDYC
   Payment source_type: CARD
   Payment tender_types: []
Customer 82K003M730Q31BH8JCWDHFRDYC already completed first payment
{"ts":"2025-12-03T22:26:08.706Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"2dde6432-9c9e-4d0c-865c-133ae3eb119e","stage":"payment","correlationId":"payment-updated:ccf6be6c70f3c40a680fecc5"}
{"ts":"2025-12-03T22:26:08.860Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"4dd4f9f4-9891-4c05-aa65-7aaa0cfdaadb","stage":"payment","correlationId":"payment-updated:4549eb2fa10b4b81d34366c5","attempts":1}
üí∞ Processing payment completion for customer: QKZ142XSZQKQMM4AKY35SKET3M
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Jereena Justin
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Jereena Justin, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Jereena Justin
   - Email: jereena1993@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: QKZ142XSZQKQMM4AKY35SKET3M
{"ts":"2025-12-03T22:26:09.156Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"4dd4f9f4-9891-4c05-aa65-7aaa0cfdaadb","stage":"payment","correlationId":"payment-updated:4549eb2fa10b4b81d34366c5"}
{"ts":"2025-12-03T22:26:09.310Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"\nInvalid `prisma.$queryRaw()` invocation:\n\n\nRaw query failed. Code: `40001`. Message: `could not serialize access due to read/write dependencies among transactions`","stack":"PrismaClientKnownRequestError: \nInvalid `prisma.$queryRaw()` invocation:\n\n\nRaw query failed. Code: `40001`. Message: `could not serialize access due to read/write dependencies among transactions`\n    at $n.handleRequestError (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:121:7315)\n    at $n.handleAndLogRequestError (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:121:6623)\n    at $n.request (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:121:6307)\n    at async l (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:9633)\n    at async prisma.$transaction.isolationLevel (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:247:26)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:8000)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-03T22:26:11.468Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"d3617c0b-8ec6-4d73-97c9-6bae0ea25bf0","stage":"payment","correlationId":"payment-updated:b4e42c643fa7e821122d60ff","attempts":1}
üí∞ Processing payment completion for customer: 8HB56VH0T0WP9HQCVVW38Q7X9M
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Jessica Moment
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Jessica Moment, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Jessica Moment
   - Email: jjmoment@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: 8HB56VH0T0WP9HQCVVW38Q7X9M
{"ts":"2025-12-03T22:26:11.770Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"d3617c0b-8ec6-4d73-97c9-6bae0ea25bf0","stage":"payment","correlationId":"payment-updated:b4e42c643fa7e821122d60ff"}
{"ts":"2025-12-03T22:26:11.940Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"eaa30e22-c352-40fd-a847-06b7039c14a2","stage":"booking","correlationId":"booking-created:fb8ce4baed3e4fd69c07b9bf","attempts":1}
üìÖ Processing booking created for customer: 1BD0FP0WWZ7QA6K5Y7XMTJTTYC
Full booking data: {
  "id": "a22tqow4jvapjt",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-11T21:00:00Z",
  "created_at": "2025-12-03T22:22:25Z",
  "updated_at": "2025-12-03T22:22:25Z",
  "customer_id": "1BD0FP0WWZ7QA6K5Y7XMTJTTYC",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMWAtQTYmZpwwxii"
  },
  "appointment_segments": [
    {
      "team_member_id": "TM-zXe9fXe4axYWn",
      "any_team_member": false,
      "duration_minutes": 140,
      "intermission_minutes": 0,
      "service_variation_id": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "service_variation_version": 1764783981722,
      "service_variation_client_id": "CJI5WHOAKSFTASYPJ4MSYZLS"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Justine Miner
üéâ First booking detected for customer: 1BD0FP0WWZ7QA6K5Y7XMTJTTYC
   Name: Justine Miner
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 1BD0FP0WWZ7QA6K5Y7XMTJTTYC...
Error getting custom attributes for customer 1BD0FP0WWZ7QA6K5Y7XMTJTTYC: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 1BD0FP0WWZ7QA6K5Y7XMTJTTYC
{"ts":"2025-12-03T22:26:12.382Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"eaa30e22-c352-40fd-a847-06b7039c14a2","stage":"booking","correlationId":"booking-created:fb8ce4baed3e4fd69c07b9bf"}
{"ts":"2025-12-03T22:30:10.088Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"f158e377-fab6-4428-acbf-8eff6c506f99","stage":"payment","correlationId":"payment-updated:d8980ed191851b8c6e590af8","attempts":1}
üí∞ Processing payment completion for customer: WZNZMGRVY2E373BZJVV0DBDBNW
   Payment source_type: CARD
   Payment tender_types: []
Customer WZNZMGRVY2E373BZJVV0DBDBNW already completed first payment
{"ts":"2025-12-03T22:30:10.372Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"f158e377-fab6-4428-acbf-8eff6c506f99","stage":"payment","correlationId":"payment-updated:d8980ed191851b8c6e590af8"}
{"ts":"2025-12-03T22:32:58.017Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"bf8dce0e-2cd1-46e9-b306-16fbe11707d2","stage":"payment","correlationId":"payment-updated:41b67dba3ac3e16a244ad765","attempts":1}
üí∞ Processing payment completion for customer: Z68BCYF3VWJM0YYQ6S0MYMFCAR
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Nicole Greene
‚ùå Referrer not found for code: null
‚úÖ Generated new personal_code in name+ID format: NICOLE3060
‚ùå Error creating/loading gift card for Nicole Greene: Response status code was not ok: 401.
Square API errors: [
  {
    "category": "AUTHENTICATION_ERROR",
    "code": "UNAUTHORIZED",
    "detail": "This request could not be authorized."
  }
]
‚ùå Failed to create referrer gift card
Error upserting custom attribute "square:a3dde506-f69e-48e4-a98a-004c1822d3ad" for customer Z68BCYF3VWJM0YYQ6S0MYMFCAR: Response status code was not ok: 401.
Square API errors: [
  {
    "category": "AUTHENTICATION_ERROR",
    "code": "UNAUTHORIZED",
    "detail": "This request could not be authorized."
  }
]
Error appending referral note for customer Z68BCYF3VWJM0YYQ6S0MYMFCAR: Response status code was not ok: 401.
Square API errors: [
  {
    "category": "AUTHENTICATION_ERROR",
    "code": "UNAUTHORIZED",
    "detail": "This request could not be authorized."
  }
]
‚ùå Error sending referral email to ngreenepc@gmail.com: Unauthorized
SendGrid error details: {
  errors: [
    {
      message: 'The provided authorization grant is invalid, expired, or revoked',
      field: null,
      help: null
    }
  ]
}
‚ö†Ô∏è Analytics operation "notification_event" failed: 
Invalid `prisma.notificationEvent.create()` invocation in
/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/analytics-service.js:164:39

  161 return runAnalyticsOperation(
  162   'notification_event',
  163   async () => {
‚Üí 164     return prisma.notificationEvent.create({
            data: {
              channel: "EMAIL",
              templateType: "REFERRAL_INVITE",
              status: "failed",
              createdAt: new Date("2025-12-03T22:32:59.771Z"),
              errorCode: 401,
                         ~~~
              errorMessage: "Unauthorized",
              metadata: {
                email: "ngreenepc@gmail.com",
                referralCode: "NICOLE3060",
                referralUrl: "https://referral-system-salon-fbbq6x1wt-umis-projects-e802f152.vercel.app/ref/NICOLE3060",
                suppressionGroupId: 28008
              }
            }
          })

Argument `errorCode`: Invalid value provided. Expected String or Null, provided Int.
‚ùå Failed to send email: Unauthorized
‚ÑπÔ∏è SMS sending disabled. Would send referral link to +14352250002
‚è∏Ô∏è SMS sending disabled (skipped sending to +14352250002)
üìß Referral code generated and sent:
   - Customer: Nicole Greene
   - Email: ngreenepc@gmail.com
   - Referral Code: NICOLE3060
   - Referral URL: https://referral-system-salon-fbbq6x1wt-umis-projects-e802f152.vercel.app/ref/NICOLE3060
   - Gift Card ID: null
   - Status: Customer is now a referrer
‚úÖ Referral code sent to new client:
   - Customer: Nicole Greene
   - Email: ngreenepc@gmail.com
   - Referral Code: NICOLE3060
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: Z68BCYF3VWJM0YYQ6S0MYMFCAR
{"ts":"2025-12-03T22:33:00.026Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"bf8dce0e-2cd1-46e9-b306-16fbe11707d2","stage":"payment","correlationId":"payment-updated:41b67dba3ac3e16a244ad765"}
{"ts":"2025-12-03T23:50:47.758Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"46f6f164-4a9e-45e5-822b-50379a0b6c58","stage":"payment","correlationId":"payment-updated:f6f0363413a58c8b479940f0","attempts":1}
üí∞ Processing payment completion for customer: 10F3BTV9CWE3BJ5XS5S7JVK7T4
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Rachel Salinas
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Rachel Salinas, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Rachel Salinas
   - Email: salinasaoe@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: 10F3BTV9CWE3BJ5XS5S7JVK7T4
{"ts":"2025-12-03T23:50:48.430Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"46f6f164-4a9e-45e5-822b-50379a0b6c58","stage":"payment","correlationId":"payment-updated:f6f0363413a58c8b479940f0"}
{"ts":"2025-12-03T23:50:50.720Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"9e02c9fe-c5c5-49b6-aee7-020a886c38eb","stage":"payment","correlationId":"payment-updated:aaaafa9dbe28c310f97846f4","attempts":1}
üí∞ Processing payment completion for customer: 10F3BTV9CWE3BJ5XS5S7JVK7T4
   Payment source_type: CARD
   Payment tender_types: []
Customer 10F3BTV9CWE3BJ5XS5S7JVK7T4 already completed first payment
{"ts":"2025-12-03T23:50:50.856Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"9e02c9fe-c5c5-49b6-aee7-020a886c38eb","stage":"payment","correlationId":"payment-updated:aaaafa9dbe28c310f97846f4"}
{"ts":"2025-12-03T23:56:53.724Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"42b26c4a-6005-4b80-8cce-5421182e2845","stage":"booking","correlationId":"booking-created:6b5bf39c14ec59539d4a063f","attempts":1}
üìÖ Processing booking created for customer: 98YY9BQCZV5R4S12V930FJDK9M
Full booking data: {
  "id": "6dquuf8n7virzg",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-10T00:00:00Z",
  "created_at": "2025-12-03T23:56:50Z",
  "updated_at": "2025-12-03T23:56:50Z",
  "customer_id": "98YY9BQCZV5R4S12V930FJDK9M",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMWAtQTYmZpwwxii"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMILsQUVwLkLzbVo",
      "any_team_member": false,
      "duration_minutes": 100,
      "intermission_minutes": 0,
      "service_variation_id": "BM556FTNFOTEHYVG4GPXAXFM",
      "service_variation_version": 1762893947284,
      "service_variation_client_id": "BM556FTNFOTEHYVG4GPXAXFM"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Amelia Meyerhoff
üéâ First booking detected for customer: 98YY9BQCZV5R4S12V930FJDK9M
   Name: Amelia Meyerhoff
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 98YY9BQCZV5R4S12V930FJDK9M...
Error getting custom attributes for customer 98YY9BQCZV5R4S12V930FJDK9M: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 98YY9BQCZV5R4S12V930FJDK9M
{"ts":"2025-12-03T23:56:54.385Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"42b26c4a-6005-4b80-8cce-5421182e2845","stage":"booking","correlationId":"booking-created:6b5bf39c14ec59539d4a063f"}
{"ts":"2025-12-04T00:11:37.039Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"7dcf2f4c-1c53-45ca-8a00-1e341ca25476","stage":"booking","correlationId":"booking-created:aa4214d161b8fb39d54f27d7","attempts":1}
üìÖ Processing booking created for customer: V14S20ZCJV7DBP7J8YKRT352XR
Full booking data: {
  "id": "ez6gqzoan28hmm",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-09T22:55:00Z",
  "created_at": "2025-12-04T00:11:34Z",
  "updated_at": "2025-12-04T00:11:34Z",
  "customer_id": "V14S20ZCJV7DBP7J8YKRT352XR",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "V14S20ZCJV7DBP7J8YKRT352XR",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TM7_r-KmvY9xjnEU",
      "any_team_member": false,
      "duration_minutes": 110,
      "intermission_minutes": 0,
      "service_variation_id": "GJ5SRTYFV6ZCDI62TMSZP2OP",
      "service_variation_version": 1764801478862,
      "service_variation_client_id": "GJ5SRTYFV6ZCDI62TMSZP2OP"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Maryte Gylys
üéâ First booking detected for customer: V14S20ZCJV7DBP7J8YKRT352XR
   Name: Maryte Gylys
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer V14S20ZCJV7DBP7J8YKRT352XR...
Error getting custom attributes for customer V14S20ZCJV7DBP7J8YKRT352XR: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: V14S20ZCJV7DBP7J8YKRT352XR
{"ts":"2025-12-04T00:11:37.686Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"7dcf2f4c-1c53-45ca-8a00-1e341ca25476","stage":"booking","correlationId":"booking-created:aa4214d161b8fb39d54f27d7"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`

Please make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.
{"ts":"2025-12-04T00:26:00.512Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"ef068a45-588e-45f4-ba71-c10f8c50106c","stage":"booking","correlationId":"booking-created:f542f6a2f9254cc81347ee23","attempts":1}
üìÖ Processing booking created for customer: V14S20ZCJV7DBP7J8YKRT352XR
Full booking data: {
  "id": "5d2ssjbvbmjcn5",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-09T21:30:00Z",
  "created_at": "2025-12-04T00:13:59Z",
  "updated_at": "2025-12-04T00:13:59Z",
  "customer_id": "V14S20ZCJV7DBP7J8YKRT352XR",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "V14S20ZCJV7DBP7J8YKRT352XR",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TM9jDlRr_Hl4rdBB",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "XBUDIMNKOPC2XVG5YLIQ4RYS",
      "service_variation_version": 1764801478862,
      "service_variation_client_id": "XBUDIMNKOPC2XVG5YLIQ4RYS"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Maryte Gylys
üéâ First booking detected for customer: V14S20ZCJV7DBP7J8YKRT352XR
   Name: Maryte Gylys
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer V14S20ZCJV7DBP7J8YKRT352XR...
Error getting custom attributes for customer V14S20ZCJV7DBP7J8YKRT352XR: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: V14S20ZCJV7DBP7J8YKRT352XR
{"ts":"2025-12-04T00:26:01.927Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"ef068a45-588e-45f4-ba71-c10f8c50106c","stage":"booking","correlationId":"booking-created:f542f6a2f9254cc81347ee23"}
{"ts":"2025-12-04T00:26:02.103Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"89a941c3-d9ee-4cc7-b468-5f9378106963","stage":"booking","correlationId":"booking-created:de22dd56d9faf3c484276950","attempts":1}
üìÖ Processing booking created for customer: 80JA32DGXHAP7W0H4464026CA0
Full booking data: {
  "id": "glsn2pk85hnze0",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-14T00:30:00Z",
  "created_at": "2025-12-04T00:19:25Z",
  "updated_at": "2025-12-04T00:19:25Z",
  "customer_id": "80JA32DGXHAP7W0H4464026CA0",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMWAtQTYmZpwwxii"
  },
  "appointment_segments": [
    {
      "resource_ids": [
        "5OVIQ6GSSUXORACP6T7WBAQ7"
      ],
      "team_member_id": "TMXiw38Bbb7XQUWI",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "ZEAKNB35I37RMXNUBGWDZQIM",
      "service_variation_version": 1760895536505,
      "service_variation_client_id": "ZEAKNB35I37RMXNUBGWDZQIM"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Gigi Cheng
üéâ First booking detected for customer: 80JA32DGXHAP7W0H4464026CA0
   Name: Gigi Cheng
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 80JA32DGXHAP7W0H4464026CA0...
Error getting custom attributes for customer 80JA32DGXHAP7W0H4464026CA0: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 80JA32DGXHAP7W0H4464026CA0
{"ts":"2025-12-04T00:26:02.583Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"89a941c3-d9ee-4cc7-b468-5f9378106963","stage":"booking","correlationId":"booking-created:de22dd56d9faf3c484276950"}
{"ts":"2025-12-04T00:26:02.896Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"244590de-e535-478d-b997-e0939e29ad79","stage":"booking","correlationId":"booking-created:1ec48d9382825d0e1e59e7b4","attempts":1}
üìÖ Processing booking created for customer: 80JA32DGXHAP7W0H4464026CA0
Full booking data: {
  "id": "wrya4tf5xl9hb7",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-14T01:00:00Z",
  "created_at": "2025-12-04T00:19:45Z",
  "updated_at": "2025-12-04T00:19:45Z",
  "customer_id": "80JA32DGXHAP7W0H4464026CA0",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMWAtQTYmZpwwxii"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMVwAQUdLz6no-cB",
      "any_team_member": false,
      "duration_minutes": 100,
      "intermission_minutes": 0,
      "service_variation_id": "GSZZR45VJXB44NF4P4WXI5NB",
      "service_variation_version": 1764801478862,
      "service_variation_client_id": "GSZZR45VJXB44NF4P4WXI5NB"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Gigi Cheng
üéâ First booking detected for customer: 80JA32DGXHAP7W0H4464026CA0
   Name: Gigi Cheng
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 80JA32DGXHAP7W0H4464026CA0...
Error getting custom attributes for customer 80JA32DGXHAP7W0H4464026CA0: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 80JA32DGXHAP7W0H4464026CA0
{"ts":"2025-12-04T00:26:03.495Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"244590de-e535-478d-b997-e0939e29ad79","stage":"booking","correlationId":"booking-created:1ec48d9382825d0e1e59e7b4"}
{"ts":"2025-12-04T00:26:03.664Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"eb236166-e2bb-452d-8884-5ec468d08d13","stage":"customer_ingest","correlationId":"customer-created:298c3ad27300c529d160ed39","attempts":1}
üì• Received customer data: {
  "id": "AJXK9W0HFEQYFWVT0H1M2HNHV8",
  "version": 0,
  "created_at": "2025-12-04T00:24:30.064Z",
  "given_name": "Miriam",
  "updated_at": "2025-12-04T00:24:30Z",
  "family_name": "Melchor",
  "preferences": {
    "email_unsubscribed": false
  },
  "phone_number": "+17073333186",
  "email_address": "miriam314.mm@gmail.com",
  "creation_source": "THIRD_PARTY"
}
üë§ Processing customer creation: AJXK9W0HFEQYFWVT0H1M2HNHV8
üìç IP Address: unknown
üìß Email: miriam314.mm@gmail.com
üìû Phone: +17073333186
üë§ Name: Miriam Melchor
‚ö†Ô∏è Suspicious IP activity detected: unknown used by 138 customers
‚ö†Ô∏è Suspicious activity detected for customer AJXK9W0HFEQYFWVT0H1M2HNHV8, flagging for review
üéâ New customer detected: AJXK9W0HFEQYFWVT0H1M2HNHV8
‚úÖ Customer added to database as NEW (temporary mark)
   - Will check for referral code when they book
   - Will give gift card on first booking if code found
‚úÖ Verification: Customer found in DB: true
{"ts":"2025-12-04T00:26:04.326Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"eb236166-e2bb-452d-8884-5ec468d08d13","stage":"customer_ingest","correlationId":"customer-created:298c3ad27300c529d160ed39"}
{"ts":"2025-12-04T00:26:04.642Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"c9bb0751-5330-4160-86d0-70b834b7aa9a","stage":"payment","correlationId":"payment-updated:ab34a0bf142bf15768f807b9","attempts":1}
üí∞ Processing payment completion for customer: 3HS2JX1W5VSDVDDSYYB788SP2W
   Payment source_type: CARD
   Payment tender_types: []
Customer 3HS2JX1W5VSDVDDSYYB788SP2W already completed first payment
{"ts":"2025-12-04T00:26:04.858Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"c9bb0751-5330-4160-86d0-70b834b7aa9a","stage":"payment","correlationId":"payment-updated:ab34a0bf142bf15768f807b9"}
{"ts":"2025-12-04T00:26:05.345Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"ffe62e09-6cf5-427f-a762-207a94fad434","stage":"payment","correlationId":"payment-updated:f8efd33c9eccccb8d24958e8","attempts":1}
üí∞ Processing payment completion for customer: 3HS2JX1W5VSDVDDSYYB788SP2W
   Payment source_type: CARD
   Payment tender_types: []
Customer 3HS2JX1W5VSDVDDSYYB788SP2W already completed first payment
{"ts":"2025-12-04T00:26:05.643Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"ffe62e09-6cf5-427f-a762-207a94fad434","stage":"payment","correlationId":"payment-updated:f8efd33c9eccccb8d24958e8"}
{"ts":"2025-12-04T00:26:05.871Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"ff506693-5ee9-48f9-9a2c-dcb5bc65ac53","stage":"booking","correlationId":"booking-created:cd7426c57197597f108b7e61","attempts":1}
üìÖ Processing booking created for customer: 1Q3ST6S62D41V6TGPXV6J2FAN8
Full booking data: {
  "id": "6g78pjps1hkh2e",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-04T20:00:00Z",
  "created_at": "2025-12-04T00:25:55Z",
  "updated_at": "2025-12-04T00:25:55Z",
  "customer_id": "1Q3ST6S62D41V6TGPXV6J2FAN8",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMQPbDVvvOCLwqsy"
  },
  "appointment_segments": [
    {
      "team_member_id": "TM9jDlRr_Hl4rdBB",
      "any_team_member": false,
      "duration_minutes": 15,
      "intermission_minutes": 0,
      "service_variation_id": "KBHPHVKLJNAF223GMYIRUUH3",
      "service_variation_version": 1760895536505,
      "service_variation_client_id": "WOKQXBYCDVX6LQACJMHZTH2Q"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Carla Betteo
üéâ First booking detected for customer: 1Q3ST6S62D41V6TGPXV6J2FAN8
   Name: Carla Betteo
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 1Q3ST6S62D41V6TGPXV6J2FAN8...
Error getting custom attributes for customer 1Q3ST6S62D41V6TGPXV6J2FAN8: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 1Q3ST6S62D41V6TGPXV6J2FAN8
{"ts":"2025-12-04T00:26:06.429Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"ff506693-5ee9-48f9-9a2c-dcb5bc65ac53","stage":"booking","correlationId":"booking-created:cd7426c57197597f108b7e61"}
{"ts":"2025-12-04T00:29:03.282Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"51467e74-4e19-4c61-9195-c677671b817c","stage":"booking","correlationId":"booking-created:0371d1e48bd2d394581f9c39","attempts":1}
üìÖ Processing booking created for customer: AJXK9W0HFEQYFWVT0H1M2HNHV8
Full booking data: {
  "id": "nv2xyb7z4bkc1m",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-07T00:20:00Z",
  "created_at": "2025-12-04T00:28:59Z",
  "updated_at": "2025-12-04T00:28:59Z",
  "customer_id": "AJXK9W0HFEQYFWVT0H1M2HNHV8",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMQPbDVvvOCLwqsy"
  },
  "appointment_segments": [
    {
      "resource_ids": [
        "VNDFB5HCSMOPZDVJ2ML6QOIJ"
      ],
      "team_member_id": "TM1L5yPC-yKx6CyO",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "ZEAKNB35I37RMXNUBGWDZQIM",
      "service_variation_version": 1760895536505,
      "service_variation_client_id": "ZEAKNB35I37RMXNUBGWDZQIM"
    },
    {
      "team_member_id": "TM1L5yPC-yKx6CyO",
      "any_team_member": false,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "NCOIL6ZGDTCC7SO3IJHENCQ2",
      "service_variation_version": 1762893947284,
      "service_variation_client_id": "NCOIL6ZGDTCC7SO3IJHENCQ2"
    },
    {
      "team_member_id": "TM1L5yPC-yKx6CyO",
      "any_team_member": false,
      "duration_minutes": 30,
      "intermission_minutes": 0,
      "service_variation_id": "LFLFEZO7L46URIM2OVZOJADI",
      "service_variation_version": 1762374620368,
      "service_variation_client_id": "LFLFEZO7L46URIM2OVZOJADI"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Miriam Melchor
üéâ First booking detected for customer: AJXK9W0HFEQYFWVT0H1M2HNHV8
   Name: Miriam Melchor
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer AJXK9W0HFEQYFWVT0H1M2HNHV8...
Error getting custom attributes for customer AJXK9W0HFEQYFWVT0H1M2HNHV8: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: AJXK9W0HFEQYFWVT0H1M2HNHV8
{"ts":"2025-12-04T00:29:04.362Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"51467e74-4e19-4c61-9195-c677671b817c","stage":"booking","correlationId":"booking-created:0371d1e48bd2d394581f9c39"}
{"ts":"2025-12-04T00:38:39.077Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"1a535de4-3195-4e04-b26b-e140439099ca","stage":"payment","correlationId":"payment-updated:534788a87846a29216dcaf8c","attempts":1}
üí∞ Processing payment completion for customer: 9CKA0D9BXK4V7Q0F2SPRPX5JYM
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Sienna Torney
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Sienna Torney, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Sienna Torney
   - Email: siennat21@icloud.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: 9CKA0D9BXK4V7Q0F2SPRPX5JYM
{"ts":"2025-12-04T00:38:40.474Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"1a535de4-3195-4e04-b26b-e140439099ca","stage":"payment","correlationId":"payment-updated:534788a87846a29216dcaf8c"}
{"ts":"2025-12-04T00:38:40.663Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"e19dd21f-c2fc-4c6e-9d39-2ec7b9dcc63c","stage":"payment","correlationId":"payment-updated:346d479114a69dd682e77f37","attempts":1}
üí∞ Processing payment completion for customer: 9CKA0D9BXK4V7Q0F2SPRPX5JYM
   Payment source_type: CARD
   Payment tender_types: []
Customer 9CKA0D9BXK4V7Q0F2SPRPX5JYM already completed first payment
{"ts":"2025-12-04T00:38:40.807Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"e19dd21f-c2fc-4c6e-9d39-2ec7b9dcc63c","stage":"payment","correlationId":"payment-updated:346d479114a69dd682e77f37"}
{"ts":"2025-12-04T00:39:58.252Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"c5ef59c4-6558-4446-a71c-a7d1bcbe4313","stage":"payment","correlationId":"payment-updated:d665cb664935b7208ae56bec","attempts":1}
üí∞ Processing payment completion for customer: XPKBCE5813V0WC51C7AR66DRJ4
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Aileen Bailitz
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Aileen Bailitz, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Aileen Bailitz
   - Email: abailitz37@comcast.net
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: XPKBCE5813V0WC51C7AR66DRJ4
{"ts":"2025-12-04T00:39:59.250Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"c5ef59c4-6558-4446-a71c-a7d1bcbe4313","stage":"payment","correlationId":"payment-updated:d665cb664935b7208ae56bec"}
{"ts":"2025-12-04T00:40:01.836Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"e6380079-077e-4f35-970a-131a2a2a6b5a","stage":"payment","correlationId":"payment-updated:43116d2e5b311dc5106b4fdb","attempts":1}
üí∞ Processing payment completion for customer: XPKBCE5813V0WC51C7AR66DRJ4
   Payment source_type: CARD
   Payment tender_types: []
Customer XPKBCE5813V0WC51C7AR66DRJ4 already completed first payment
{"ts":"2025-12-04T00:40:01.970Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"e6380079-077e-4f35-970a-131a2a2a6b5a","stage":"payment","correlationId":"payment-updated:43116d2e5b311dc5106b4fdb"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-12-04T01:10:37.866Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"a1f7db7d-dc71-4a1d-aa30-91082a46bce5","stage":"payment","correlationId":"payment-updated:251b3948abdb74b9ce8c2d70","attempts":1}
üí∞ Processing payment completion for customer: Z4RBCQ7KPAJ4YE0C85EYGDNXA0
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Sarah Engers
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Sarah Engers, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Sarah Engers
   - Email: sarah.k.engers@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: Z4RBCQ7KPAJ4YE0C85EYGDNXA0
{"ts":"2025-12-04T01:10:38.464Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"a1f7db7d-dc71-4a1d-aa30-91082a46bce5","stage":"payment","correlationId":"payment-updated:251b3948abdb74b9ce8c2d70"}
{"ts":"2025-12-04T01:10:38.620Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"a3b8fbb6-5f5b-4fe9-8256-17d9cc613a2d","stage":"payment","correlationId":"payment-updated:1f6255a1e7f7119f2c3dce86","attempts":1}
üí∞ Processing payment completion for customer: Z4RBCQ7KPAJ4YE0C85EYGDNXA0
   Payment source_type: CARD
   Payment tender_types: []
Customer Z4RBCQ7KPAJ4YE0C85EYGDNXA0 already completed first payment
{"ts":"2025-12-04T01:10:38.762Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"a3b8fbb6-5f5b-4fe9-8256-17d9cc613a2d","stage":"payment","correlationId":"payment-updated:1f6255a1e7f7119f2c3dce86"}
{"ts":"2025-12-04T01:10:38.929Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"28e826e0-2044-4824-8ada-00a6685520be","stage":"payment","correlationId":"payment-updated:a78a95a06c0416d631fd41c4","attempts":1}
üí∞ Processing payment completion for customer: XPKBCE5813V0WC51C7AR66DRJ4
   Payment source_type: CARD
   Payment tender_types: []
Customer XPKBCE5813V0WC51C7AR66DRJ4 already completed first payment
{"ts":"2025-12-04T01:10:39.080Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"28e826e0-2044-4824-8ada-00a6685520be","stage":"payment","correlationId":"payment-updated:a78a95a06c0416d631fd41c4"}
{"ts":"2025-12-04T01:10:39.388Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"84bb26e1-d913-49e7-8792-82542d1b1ddc","stage":"payment","correlationId":"payment-updated:7d49822d440bb1bb9f82dedd","attempts":1}
üí∞ Processing payment completion for customer: XPKBCE5813V0WC51C7AR66DRJ4
   Payment source_type: CARD
   Payment tender_types: []
Customer XPKBCE5813V0WC51C7AR66DRJ4 already completed first payment
{"ts":"2025-12-04T01:10:39.703Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"84bb26e1-d913-49e7-8792-82542d1b1ddc","stage":"payment","correlationId":"payment-updated:7d49822d440bb1bb9f82dedd"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-12-04T01:28:38.156Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"745f41de-a51d-472f-9363-c7246bce23dd","stage":"payment","correlationId":"payment-updated:7838057a97994ced72d11bcb","attempts":1}
üí∞ Processing payment completion for customer: VRC2G1PHS14ZBK37F5G5TZYT0M
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Suraksha Suresh Pai
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Suraksha Suresh Pai, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Suraksha Suresh Pai
   - Email: suraksha.pai@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: VRC2G1PHS14ZBK37F5G5TZYT0M
{"ts":"2025-12-04T01:28:39.049Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"745f41de-a51d-472f-9363-c7246bce23dd","stage":"payment","correlationId":"payment-updated:7838057a97994ced72d11bcb"}
{"ts":"2025-12-04T01:28:39.209Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"116f3783-fba3-4bcd-8cf0-de1582a50525","stage":"payment","correlationId":"payment-updated:daadcef983867ba4f3871151","attempts":1}
üí∞ Processing payment completion for customer: VRC2G1PHS14ZBK37F5G5TZYT0M
   Payment source_type: CARD
   Payment tender_types: []
Customer VRC2G1PHS14ZBK37F5G5TZYT0M already completed first payment
{"ts":"2025-12-04T01:28:39.346Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"116f3783-fba3-4bcd-8cf0-de1582a50525","stage":"payment","correlationId":"payment-updated:daadcef983867ba4f3871151"}
{"ts":"2025-12-04T01:33:40.665Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"e6ed5fd1-5e9a-4f76-84fc-4523ff4f19bd","stage":"payment","correlationId":"payment-updated:68fd70cbcdb79c2e8efb0a04","attempts":1}
üí∞ Processing payment completion for customer: BX2SZCCDJQPF5E64QDE8MM534M
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Lynn Rosenzweig
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Lynn Rosenzweig, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Lynn Rosenzweig
   - Email: rosenzweig.lynn@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: BX2SZCCDJQPF5E64QDE8MM534M
{"ts":"2025-12-04T01:33:41.832Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"e6ed5fd1-5e9a-4f76-84fc-4523ff4f19bd","stage":"payment","correlationId":"payment-updated:68fd70cbcdb79c2e8efb0a04"}
{"ts":"2025-12-04T01:33:46.687Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"788ecbd7-49c6-4009-aeaa-cab215a56256","stage":"payment","correlationId":"payment-updated:8cf1d5cd57fb122b5d668835","attempts":1}
üí∞ Processing payment completion for customer: BX2SZCCDJQPF5E64QDE8MM534M
   Payment source_type: CARD
   Payment tender_types: []
Customer BX2SZCCDJQPF5E64QDE8MM534M already completed first payment
{"ts":"2025-12-04T01:33:47.059Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"788ecbd7-49c6-4009-aeaa-cab215a56256","stage":"payment","correlationId":"payment-updated:8cf1d5cd57fb122b5d668835"}
{"ts":"2025-12-04T01:34:07.264Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"66d585f7-157d-463f-aef7-57d429cd8404","stage":"payment","correlationId":"payment-updated:a9e95abfe5e89ad0823f9aa3","attempts":1}
üí∞ Processing payment completion for customer: BX2SZCCDJQPF5E64QDE8MM534M
   Payment source_type: CARD
   Payment tender_types: []
Customer BX2SZCCDJQPF5E64QDE8MM534M already completed first payment
{"ts":"2025-12-04T01:34:07.499Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"66d585f7-157d-463f-aef7-57d429cd8404","stage":"payment","correlationId":"payment-updated:a9e95abfe5e89ad0823f9aa3"}
{"ts":"2025-12-04T01:34:09.806Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"64939413-3d68-4ca4-9b38-d48a22efee52","stage":"booking","correlationId":"booking-created:c8bd351763af63558ca3f442","attempts":1}
üìÖ Processing booking created for customer: KEMKRZVD4BW9AAJJPMJ1F4G14C
Full booking data: {
  "id": "2vjse077evvba5",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-31T21:00:00Z",
  "created_at": "2025-12-04T01:34:07Z",
  "updated_at": "2025-12-04T01:34:07Z",
  "customer_id": "KEMKRZVD4BW9AAJJPMJ1F4G14C",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "KEMKRZVD4BW9AAJJPMJ1F4G14C",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMVwAQUdLz6no-cB",
      "any_team_member": false,
      "duration_minutes": 100,
      "intermission_minutes": 0,
      "service_variation_id": "GSZZR45VJXB44NF4P4WXI5NB",
      "service_variation_version": 1764801478862,
      "service_variation_client_id": "GSZZR45VJXB44NF4P4WXI5NB"
    },
    {
      "team_member_id": "TMVwAQUdLz6no-cB",
      "any_team_member": false,
      "duration_minutes": 20,
      "intermission_minutes": 0,
      "service_variation_id": "HAJX45W3U2WUCCXM5MI24UEE",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "HAJX45W3U2WUCCXM5MI24UEE"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Brenna Stanton
üéâ First booking detected for customer: KEMKRZVD4BW9AAJJPMJ1F4G14C
   Name: Brenna Stanton
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer KEMKRZVD4BW9AAJJPMJ1F4G14C...
Error getting custom attributes for customer KEMKRZVD4BW9AAJJPMJ1F4G14C: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: KEMKRZVD4BW9AAJJPMJ1F4G14C
{"ts":"2025-12-04T01:34:10.223Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"64939413-3d68-4ca4-9b38-d48a22efee52","stage":"booking","correlationId":"booking-created:c8bd351763af63558ca3f442"}
{"ts":"2025-12-04T01:34:12.511Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"945b7513-8fda-4c76-bafb-051a983c98a2","stage":"payment","correlationId":"payment-updated:be28aef77a4ae336c72a916e","attempts":1}
üí∞ Processing payment completion for customer: BX2SZCCDJQPF5E64QDE8MM534M
   Payment source_type: CARD
   Payment tender_types: []
Customer BX2SZCCDJQPF5E64QDE8MM534M already completed first payment
{"ts":"2025-12-04T01:34:12.643Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"945b7513-8fda-4c76-bafb-051a983c98a2","stage":"payment","correlationId":"payment-updated:be28aef77a4ae336c72a916e"}
{"ts":"2025-12-04T01:35:05.977Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"e3690707-5777-4dfb-a314-61a65097ad7d","stage":"payment","correlationId":"payment-updated:d9defaab4acc4d4ce6edb8c8","attempts":1}
üí∞ Processing payment completion for customer: SF4S7AZ7H3QHYJKJMAEAR5A1QR
   Payment source_type: CARD
   Payment tender_types: []
Customer SF4S7AZ7H3QHYJKJMAEAR5A1QR already completed first payment
{"ts":"2025-12-04T01:35:06.246Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"e3690707-5777-4dfb-a314-61a65097ad7d","stage":"payment","correlationId":"payment-updated:d9defaab4acc4d4ce6edb8c8"}
{"ts":"2025-12-04T01:35:12.798Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"16edd7b7-82cc-435c-b760-9417c3c59728","stage":"payment","correlationId":"payment-updated:324f1e25f45feab21ca51ebd","attempts":1}
üí∞ Processing payment completion for customer: SF4S7AZ7H3QHYJKJMAEAR5A1QR
   Payment source_type: CARD
   Payment tender_types: []
Customer SF4S7AZ7H3QHYJKJMAEAR5A1QR already completed first payment
{"ts":"2025-12-04T01:35:12.933Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"16edd7b7-82cc-435c-b760-9417c3c59728","stage":"payment","correlationId":"payment-updated:324f1e25f45feab21ca51ebd"}
{"ts":"2025-12-04T01:36:59.288Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"b8234909-57fd-4978-9d1e-afed446e7f2c","stage":"booking","correlationId":"booking-created:0b1b6c82101b413036e16fe9","attempts":1}
üìÖ Processing booking created for customer: RFRX8SQKYN4BB7T7XXSSNCS0V8
Full booking data: {
  "id": "8jqlpykmj4zblb",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-05T20:45:00Z",
  "created_at": "2025-12-04T01:36:55Z",
  "updated_at": "2025-12-04T01:36:55Z",
  "customer_id": "RFRX8SQKYN4BB7T7XXSSNCS0V8",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "RFRX8SQKYN4BB7T7XXSSNCS0V8",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMOscywuGXO2VURY",
      "any_team_member": true,
      "duration_minutes": 45,
      "intermission_minutes": 0,
      "service_variation_id": "VVA7G2UN7N2HUFMCW5LQOVHB",
      "service_variation_version": 1764783981722,
      "service_variation_client_id": "VVA7G2UN7N2HUFMCW5LQOVHB"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Sarah Curlin
üéâ First booking detected for customer: RFRX8SQKYN4BB7T7XXSSNCS0V8
   Name: Sarah Curlin
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer RFRX8SQKYN4BB7T7XXSSNCS0V8...
Error getting custom attributes for customer RFRX8SQKYN4BB7T7XXSSNCS0V8: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: RFRX8SQKYN4BB7T7XXSSNCS0V8
{"ts":"2025-12-04T01:36:59.829Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"b8234909-57fd-4978-9d1e-afed446e7f2c","stage":"booking","correlationId":"booking-created:0b1b6c82101b413036e16fe9"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-12-04T01:59:46.590Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"1fc360e2-0bb0-4456-874c-f4dfca28dc37","stage":"booking","correlationId":"booking-created:3e3c97f7162d0e14e6861e12","attempts":1}
üìÖ Processing booking created for customer: RF3WBGZNK6M0XGRF7YD4MPYSA8
Full booking data: {
  "id": "bsstbgjtwv7to0",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-11T23:20:00Z",
  "created_at": "2025-12-04T01:50:16Z",
  "updated_at": "2025-12-04T01:50:16Z",
  "customer_id": "RF3WBGZNK6M0XGRF7YD4MPYSA8",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "RF3WBGZNK6M0XGRF7YD4MPYSA8",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMEWAZHdtaiRR_Zs",
      "any_team_member": true,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1764609601083,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Chelsea Rawlins
üéâ First booking detected for customer: RF3WBGZNK6M0XGRF7YD4MPYSA8
   Name: Chelsea Rawlins
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer RF3WBGZNK6M0XGRF7YD4MPYSA8...
Error getting custom attributes for customer RF3WBGZNK6M0XGRF7YD4MPYSA8: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: RF3WBGZNK6M0XGRF7YD4MPYSA8
{"ts":"2025-12-04T01:59:47.295Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"1fc360e2-0bb0-4456-874c-f4dfca28dc37","stage":"booking","correlationId":"booking-created:3e3c97f7162d0e14e6861e12"}
{"ts":"2025-12-04T01:59:47.460Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"c61734d7-5fb9-4feb-bc27-b21ae7854260","stage":"booking","correlationId":"booking-created:86977e8f752a82f7eb46e555","attempts":1}
üìÖ Processing booking created for customer: RF3WBGZNK6M0XGRF7YD4MPYSA8
Full booking data: {
  "id": "5a7schd7p4rkc4",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-10T22:00:00Z",
  "created_at": "2025-12-04T01:54:15Z",
  "updated_at": "2025-12-04T01:54:15Z",
  "customer_id": "RF3WBGZNK6M0XGRF7YD4MPYSA8",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "RF3WBGZNK6M0XGRF7YD4MPYSA8",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMXiw38Bbb7XQUWI",
      "any_team_member": true,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1764609601083,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Chelsea Rawlins
üéâ First booking detected for customer: RF3WBGZNK6M0XGRF7YD4MPYSA8
   Name: Chelsea Rawlins
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer RF3WBGZNK6M0XGRF7YD4MPYSA8...
Error getting custom attributes for customer RF3WBGZNK6M0XGRF7YD4MPYSA8: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: RF3WBGZNK6M0XGRF7YD4MPYSA8
{"ts":"2025-12-04T01:59:47.855Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"c61734d7-5fb9-4feb-bc27-b21ae7854260","stage":"booking","correlationId":"booking-created:86977e8f752a82f7eb46e555"}
{"ts":"2025-12-04T01:59:48.018Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"df819f70-6236-43c4-a6dc-6cb6507373e8","stage":"booking","correlationId":"booking-created:6745441a73d257043c7d8584","attempts":1}
üìÖ Processing booking created for customer: JVTY5VTKS8D6HVSZWK7F5EKWJG
Full booking data: {
  "id": "fzujcl292vpwh1",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-16T18:00:00Z",
  "created_at": "2025-12-04T01:54:16Z",
  "updated_at": "2025-12-04T01:54:16Z",
  "customer_id": "JVTY5VTKS8D6HVSZWK7F5EKWJG",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "JVTY5VTKS8D6HVSZWK7F5EKWJG",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMMCVDJoKh3ZkfFo",
      "any_team_member": true,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1764609601083,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 0 customer(s) in database
‚ÑπÔ∏è Customer JVTY5VTKS8D6HVSZWK7F5EKWJG not in database yet - need to add them first
‚ùå Error fetching/adding customer from Square: Response status code was not ok: 401.
{"ts":"2025-12-04T01:59:48.378Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"df819f70-6236-43c4-a6dc-6cb6507373e8","stage":"booking","correlationId":"booking-created:6745441a73d257043c7d8584"}
{"ts":"2025-12-04T01:59:48.541Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"5efd5c08-0e62-44b1-9053-9fb193c85b40","stage":"customer_ingest","correlationId":"customer-created:3ca81e279ebe6f970b757ee6","attempts":1}
üì• Received customer data: {
  "id": "JVTY5VTKS8D6HVSZWK7F5EKWJG",
  "address": {
    "country": "US"
  },
  "version": 0,
  "group_ids": [
    "LT4ZHFBQQYB2N.APPOINTMENTS"
  ],
  "created_at": "2025-12-04T01:54:13.981Z",
  "given_name": "Sally",
  "updated_at": "2025-12-04T01:54:16Z",
  "family_name": "E",
  "preferences": {
    "email_unsubscribed": false
  },
  "phone_number": "+15109170083",
  "email_address": "sallymorgan.p@gmail.com",
  "creation_source": "APPOINTMENTS"
}
üë§ Processing customer creation: JVTY5VTKS8D6HVSZWK7F5EKWJG
üìç IP Address: unknown
üìß Email: sallymorgan.p@gmail.com
üìû Phone: +15109170083
üë§ Name: Sally E
‚ö†Ô∏è Suspicious IP activity detected: unknown used by 139 customers
‚ö†Ô∏è Suspicious activity detected for customer JVTY5VTKS8D6HVSZWK7F5EKWJG, flagging for review
üéâ New customer detected: JVTY5VTKS8D6HVSZWK7F5EKWJG
‚úÖ Customer added to database as NEW (temporary mark)
   - Will check for referral code when they book
   - Will give gift card on first booking if code found
‚úÖ Verification: Customer found in DB: true
{"ts":"2025-12-04T01:59:48.916Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"5efd5c08-0e62-44b1-9053-9fb193c85b40","stage":"customer_ingest","correlationId":"customer-created:3ca81e279ebe6f970b757ee6"}
{"ts":"2025-12-04T01:59:49.087Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"74af914a-c20f-4ff8-a335-47c43d4ca43f","stage":"payment","correlationId":"payment-updated:059257fd7c94f1679ded6a1d","attempts":1}
üí∞ Processing payment completion for customer: M611SY0KHTSXWEKZPW2N0EXF30
   Payment source_type: CASH
   Payment tender_types: []
üéâ First payment completed for customer: Chelsea Pristach
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Chelsea Pristach, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Chelsea Pristach
   - Email: chelseapristach1212@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: M611SY0KHTSXWEKZPW2N0EXF30
{"ts":"2025-12-04T01:59:49.404Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"74af914a-c20f-4ff8-a335-47c43d4ca43f","stage":"payment","correlationId":"payment-updated:059257fd7c94f1679ded6a1d"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-12-04T02:18:08.142Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"411ac178-0979-4664-93f3-77b68e0b134a","stage":"payment","correlationId":"payment-updated:42d15bef5c4325655afaec7b","attempts":1}
üí∞ Processing payment completion for customer: J6Q15M28PA893P6KGSHY59W2TR
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Sara Moore
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Sara Moore, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Sara Moore
   - Email: smoore@grsm.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: J6Q15M28PA893P6KGSHY59W2TR
{"ts":"2025-12-04T02:18:09.766Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"411ac178-0979-4664-93f3-77b68e0b134a","stage":"payment","correlationId":"payment-updated:42d15bef5c4325655afaec7b"}
{"ts":"2025-12-04T02:18:10.000Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"d0243941-df3c-4729-b544-0b8896de2b14","stage":"payment","correlationId":"payment-updated:72f9081c3d414f545d1536cf","attempts":1}
üí∞ Processing payment completion for customer: J6Q15M28PA893P6KGSHY59W2TR
   Payment source_type: CARD
   Payment tender_types: []
Customer J6Q15M28PA893P6KGSHY59W2TR already completed first payment
{"ts":"2025-12-04T02:18:10.321Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"d0243941-df3c-4729-b544-0b8896de2b14","stage":"payment","correlationId":"payment-updated:72f9081c3d414f545d1536cf"}
{"ts":"2025-12-04T02:37:33.813Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"fb2a4091-3d61-468d-b28b-d67c4ff22952","stage":"payment","correlationId":"payment-updated:fc100f94ad6c864920f22c69","attempts":1}
üí∞ Processing payment completion for customer: 9346KFBJCMQM6441TJYVJK18H0
   Payment source_type: CARD
   Payment tender_types: []
Customer 9346KFBJCMQM6441TJYVJK18H0 already completed first payment
{"ts":"2025-12-04T02:37:34.244Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"fb2a4091-3d61-468d-b28b-d67c4ff22952","stage":"payment","correlationId":"payment-updated:fc100f94ad6c864920f22c69"}
{"ts":"2025-12-04T02:37:34.402Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"ba0cefc3-2f5c-44f6-9189-57705ae38bd7","stage":"payment","correlationId":"payment-updated:fbd9e8a9a477f2d599356697","attempts":1}
üí∞ Processing payment completion for customer: 9346KFBJCMQM6441TJYVJK18H0
   Payment source_type: CARD
   Payment tender_types: []
Customer 9346KFBJCMQM6441TJYVJK18H0 already completed first payment
{"ts":"2025-12-04T02:37:34.561Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"ba0cefc3-2f5c-44f6-9189-57705ae38bd7","stage":"payment","correlationId":"payment-updated:fbd9e8a9a477f2d599356697"}
{"ts":"2025-12-04T02:37:34.722Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"a43f6327-f73d-4d7f-86c2-356a0e7e9b97","stage":"payment","correlationId":"payment-updated:fd1722e3db312f6831f6a11b","attempts":1}
üí∞ Processing payment completion for customer: Q897VDD6EPK48359WWJNBN2YSW
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Anna Bausova
‚ùå Referrer not found for code: null
‚úÖ Generated new personal_code in name+ID format: ANNA3592
‚ùå Error creating/loading gift card for Anna Bausova: Response status code was not ok: 401.
Square API errors: [
  {
    "category": "AUTHENTICATION_ERROR",
    "code": "UNAUTHORIZED",
    "detail": "This request could not be authorized."
  }
]
‚ùå Failed to create referrer gift card
Error upserting custom attribute "square:a3dde506-f69e-48e4-a98a-004c1822d3ad" for customer Q897VDD6EPK48359WWJNBN2YSW: Response status code was not ok: 401.
Square API errors: [
  {
    "category": "AUTHENTICATION_ERROR",
    "code": "UNAUTHORIZED",
    "detail": "This request could not be authorized."
  }
]
Error appending referral note for customer Q897VDD6EPK48359WWJNBN2YSW: Response status code was not ok: 401.
Square API errors: [
  {
    "category": "AUTHENTICATION_ERROR",
    "code": "UNAUTHORIZED",
    "detail": "This request could not be authorized."
  }
]
‚ùå Error sending referral email to anna.bausova@outlook.com: Unauthorized
SendGrid error details: {
  errors: [
    {
      message: 'The provided authorization grant is invalid, expired, or revoked',
      field: null,
      help: null
    }
  ]
}
‚ö†Ô∏è Analytics operation "notification_event" failed: 
Invalid `prisma.notificationEvent.create()` invocation in
/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/analytics-service.js:164:39

  161 return runAnalyticsOperation(
  162   'notification_event',
  163   async () => {
‚Üí 164     return prisma.notificationEvent.create({
            data: {
              channel: "EMAIL",
              templateType: "REFERRAL_INVITE",
              status: "failed",
              createdAt: new Date("2025-12-04T02:37:36.329Z"),
              errorCode: 401,
                         ~~~
              errorMessage: "Unauthorized",
              metadata: {
                email: "anna.bausova@outlook.com",
                referralCode: "ANNA3592",
                referralUrl: "https://referral-system-salon-fbbq6x1wt-umis-projects-e802f152.vercel.app/ref/ANNA3592",
                suppressionGroupId: 28008
              }
            }
          })

Argument `errorCode`: Invalid value provided. Expected String or Null, provided Int.
‚ùå Failed to send email: Unauthorized
‚ÑπÔ∏è SMS sending disabled. Would send referral link to +37126715512
‚è∏Ô∏è SMS sending disabled (skipped sending to +37126715512)
üìß Referral code generated and sent:
   - Customer: Anna Bausova
   - Email: anna.bausova@outlook.com
   - Referral Code: ANNA3592
   - Referral URL: https://referral-system-salon-fbbq6x1wt-umis-projects-e802f152.vercel.app/ref/ANNA3592
   - Gift Card ID: null
   - Status: Customer is now a referrer
‚úÖ Referral code sent to new client:
   - Customer: Anna Bausova
   - Email: anna.bausova@outlook.com
   - Referral Code: ANNA3592
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: Q897VDD6EPK48359WWJNBN2YSW
{"ts":"2025-12-04T02:37:36.600Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"a43f6327-f73d-4d7f-86c2-356a0e7e9b97","stage":"payment","correlationId":"payment-updated:fd1722e3db312f6831f6a11b"}
{"ts":"2025-12-04T02:37:36.760Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"9cfb3a4c-c38c-458f-aa11-67ae0649ffb8","stage":"payment","correlationId":"payment-updated:f5903b936461e1686a8638aa","attempts":1}
üí∞ Processing payment completion for customer: Q897VDD6EPK48359WWJNBN2YSW
   Payment source_type: CARD
   Payment tender_types: []
Customer Q897VDD6EPK48359WWJNBN2YSW already completed first payment
{"ts":"2025-12-04T02:37:36.902Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"9cfb3a4c-c38c-458f-aa11-67ae0649ffb8","stage":"payment","correlationId":"payment-updated:f5903b936461e1686a8638aa"}
{"ts":"2025-12-04T02:41:20.187Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"02912498-f19e-4ab0-9862-500ef3364d85","stage":"payment","correlationId":"payment-updated:150d97b60ca321d1b47368b1","attempts":1}
üí∞ Processing payment completion for customer: BXBTYQN9H36QD43PBT3Q0QPWJR
   Payment source_type: CARD
   Payment tender_types: []
Customer BXBTYQN9H36QD43PBT3Q0QPWJR already completed first payment
{"ts":"2025-12-04T02:41:20.483Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"02912498-f19e-4ab0-9862-500ef3364d85","stage":"payment","correlationId":"payment-updated:150d97b60ca321d1b47368b1"}
{"ts":"2025-12-04T02:41:24.897Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"7e33f660-994f-4be0-8353-0a0f9a00a235","stage":"payment","correlationId":"payment-updated:57388f9123c9db3660e8668a","attempts":1}
üí∞ Processing payment completion for customer: BXBTYQN9H36QD43PBT3Q0QPWJR
   Payment source_type: CARD
   Payment tender_types: []
Customer BXBTYQN9H36QD43PBT3Q0QPWJR already completed first payment
{"ts":"2025-12-04T02:41:25.034Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"7e33f660-994f-4be0-8353-0a0f9a00a235","stage":"payment","correlationId":"payment-updated:57388f9123c9db3660e8668a"}
{"ts":"2025-12-04T02:42:15.792Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"f7a674a2-adb2-4c10-88ca-cf5a52e9a9e0","stage":"booking","correlationId":"booking-created:6f74e62cf39741430f9d2450","attempts":1}
üìÖ Processing booking created for customer: BXBTYQN9H36QD43PBT3Q0QPWJR
Full booking data: {
  "id": "wloekz1pt0hsqb",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-23T23:00:00Z",
  "created_at": "2025-12-04T02:42:13Z",
  "updated_at": "2025-12-04T02:42:13Z",
  "customer_id": "BXBTYQN9H36QD43PBT3Q0QPWJR",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMQPbDVvvOCLwqsy"
  },
  "appointment_segments": [
    {
      "team_member_id": "TM9jDlRr_Hl4rdBB",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "XBUDIMNKOPC2XVG5YLIQ4RYS",
      "service_variation_version": 1764609577793,
      "service_variation_client_id": "XBUDIMNKOPC2XVG5YLIQ4RYS"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Ashley Chu
‚ÑπÔ∏è Customer BXBTYQN9H36QD43PBT3Q0QPWJR already received signup bonus, not first booking
{"ts":"2025-12-04T02:42:16.041Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"f7a674a2-adb2-4c10-88ca-cf5a52e9a9e0","stage":"booking","correlationId":"booking-created:6f74e62cf39741430f9d2450"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-12-04T02:58:09.945Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"22d94953-46e4-455e-888c-aff6fcdebad4","stage":"payment","correlationId":"payment-updated:1794541d7abf44b1feb20826","attempts":1}
üí∞ Processing payment completion for customer: 783E7QPK6P2ZDYFYE0AG616R8W
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Courtney Coakley
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Courtney Coakley, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Courtney Coakley
   - Email: ccoakley07@yahoo.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: 783E7QPK6P2ZDYFYE0AG616R8W
{"ts":"2025-12-04T02:58:10.558Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"22d94953-46e4-455e-888c-aff6fcdebad4","stage":"payment","correlationId":"payment-updated:1794541d7abf44b1feb20826"}
{"ts":"2025-12-04T02:58:10.716Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"5f1652b3-16e5-4549-a50b-9a32d772e688","stage":"payment","correlationId":"payment-updated:e83ad95c186cc0879bb03d68","attempts":1}
üí∞ Processing payment completion for customer: 783E7QPK6P2ZDYFYE0AG616R8W
   Payment source_type: CARD
   Payment tender_types: []
Customer 783E7QPK6P2ZDYFYE0AG616R8W already completed first payment
{"ts":"2025-12-04T02:58:10.858Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"5f1652b3-16e5-4549-a50b-9a32d772e688","stage":"payment","correlationId":"payment-updated:e83ad95c186cc0879bb03d68"}
{"ts":"2025-12-04T03:03:42.203Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-04T03:03:46.216Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-04T03:03:50.224Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-04T03:22:00.847Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Server has closed the connection.","stack":"PrismaClientKnownRequestError: Server has closed the connection.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-04T03:22:03.682Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"f1633414-4c46-4d13-a269-b592341d0276","stage":"booking","correlationId":"booking-created:dcc96f5968dc14ba3e8de8a3","attempts":1}
üìÖ Processing booking created for customer: BCDAEYDCS05SCKA1C291CKN3EW
Full booking data: {
  "id": "bpgk8punqdyc3t",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-05T00:00:00Z",
  "created_at": "2025-12-04T03:12:49Z",
  "updated_at": "2025-12-04T03:12:49Z",
  "customer_id": "BCDAEYDCS05SCKA1C291CKN3EW",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMWAtQTYmZpwwxii"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMILsQUVwLkLzbVo",
      "any_team_member": false,
      "duration_minutes": 20,
      "intermission_minutes": 0,
      "service_variation_id": "HAJX45W3U2WUCCXM5MI24UEE",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "HAJX45W3U2WUCCXM5MI24UEE"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Hannah Bagby
Error retrieving Square customer BCDAEYDCS05SCKA1C291CKN3EW: Response status code was not ok: 401.
Square API errors: [
  {
    "category": "AUTHENTICATION_ERROR",
    "code": "UNAUTHORIZED",
    "detail": "This request could not be authorized."
  }
]
üéâ First booking detected for customer: BCDAEYDCS05SCKA1C291CKN3EW
   Name: Hannah Bagby
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer BCDAEYDCS05SCKA1C291CKN3EW...
Error getting custom attributes for customer BCDAEYDCS05SCKA1C291CKN3EW: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: BCDAEYDCS05SCKA1C291CKN3EW
{"ts":"2025-12-04T03:22:05.860Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"f1633414-4c46-4d13-a269-b592341d0276","stage":"booking","correlationId":"booking-created:dcc96f5968dc14ba3e8de8a3"}
{"ts":"2025-12-04T03:22:06.309Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"a67c6cd7-8370-4599-884a-aec634564690","stage":"booking","correlationId":"booking-created:a9f742a753c4aedbe8310458","attempts":1}
üìÖ Processing booking created for customer: VRC2G1PHS14ZBK37F5G5TZYT0M
Full booking data: {
  "id": "m0g7misqmuhmef",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-07T00:00:00Z",
  "created_at": "2025-12-04T03:19:00Z",
  "updated_at": "2025-12-04T03:19:00Z",
  "customer_id": "VRC2G1PHS14ZBK37F5G5TZYT0M",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMQPbDVvvOCLwqsy"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMNW4SIF7tjp4oM_",
      "any_team_member": false,
      "duration_minutes": 60,
      "intermission_minutes": 0,
      "service_variation_id": "Y555I3UQZHD4TQTISQDIWPZG",
      "service_variation_version": 1762374620368,
      "service_variation_client_id": "RL6MWPOA3ZNHFFFAHNDIZGQL"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Suraksha Suresh Pai
üéâ First booking detected for customer: VRC2G1PHS14ZBK37F5G5TZYT0M
   Name: Suraksha Suresh Pai
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer VRC2G1PHS14ZBK37F5G5TZYT0M...
Error getting custom attributes for customer VRC2G1PHS14ZBK37F5G5TZYT0M: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: VRC2G1PHS14ZBK37F5G5TZYT0M
{"ts":"2025-12-04T03:22:06.894Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"a67c6cd7-8370-4599-884a-aec634564690","stage":"booking","correlationId":"booking-created:a9f742a753c4aedbe8310458"}
{"ts":"2025-12-04T03:22:35.908Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"4c989d6a-cf6e-47f3-807c-abe0c00add8b","stage":"booking","correlationId":"booking-created:ff55cbd670f4894b734e57f9","attempts":1}
üìÖ Processing booking created for customer: HTXX11HKQ0XJD2SK0DDKAXGHH0
Full booking data: {
  "id": "lcwq5hpp2kr2as",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2026-01-02T18:00:00Z",
  "created_at": "2025-12-04T03:22:33Z",
  "updated_at": "2025-12-04T03:22:33Z",
  "customer_id": "HTXX11HKQ0XJD2SK0DDKAXGHH0",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "HTXX11HKQ0XJD2SK0DDKAXGHH0",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMgsjtuk5cfKnstq",
      "any_team_member": false,
      "duration_minutes": 110,
      "intermission_minutes": 0,
      "service_variation_id": "6TYOE67IDYTKHW2ZG6HKVZER",
      "service_variation_version": 1764801478862,
      "service_variation_client_id": "6TYOE67IDYTKHW2ZG6HKVZER"
    },
    {
      "team_member_id": "TMgsjtuk5cfKnstq",
      "any_team_member": false,
      "duration_minutes": 20,
      "intermission_minutes": 0,
      "service_variation_id": "HAJX45W3U2WUCCXM5MI24UEE",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "HAJX45W3U2WUCCXM5MI24UEE"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Jade Rice
üéâ First booking detected for customer: HTXX11HKQ0XJD2SK0DDKAXGHH0
   Name: Jade Rice
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer HTXX11HKQ0XJD2SK0DDKAXGHH0...
Error getting custom attributes for customer HTXX11HKQ0XJD2SK0DDKAXGHH0: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: HTXX11HKQ0XJD2SK0DDKAXGHH0
{"ts":"2025-12-04T03:22:36.432Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"4c989d6a-cf6e-47f3-807c-abe0c00add8b","stage":"booking","correlationId":"booking-created:ff55cbd670f4894b734e57f9"}
{"ts":"2025-12-04T03:33:58.390Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Server has closed the connection.","stack":"PrismaClientKnownRequestError: Server has closed the connection.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-04T03:34:01.057Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"a3b44326-45ad-4ea0-a2ec-7dc9823201a7","stage":"payment","correlationId":"payment-updated:a36514f6b2247dfa6df5f9b0","attempts":1}
üí∞ Processing payment completion for customer: V9XW1F5VV01C0XFY7G65JC3XE8
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Charlotte Waechter
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Charlotte Waechter, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Charlotte Waechter
   - Email: cnw.soccer@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: V9XW1F5VV01C0XFY7G65JC3XE8
{"ts":"2025-12-04T03:34:01.651Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"a3b44326-45ad-4ea0-a2ec-7dc9823201a7","stage":"payment","correlationId":"payment-updated:a36514f6b2247dfa6df5f9b0"}
{"ts":"2025-12-04T03:34:01.812Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"7524a40c-80ea-4670-81fb-0a9f1f607411","stage":"payment","correlationId":"payment-updated:10784e224df60c31bf27fbef","attempts":1}
üí∞ Processing payment completion for customer: V9XW1F5VV01C0XFY7G65JC3XE8
   Payment source_type: CARD
   Payment tender_types: []
Customer V9XW1F5VV01C0XFY7G65JC3XE8 already completed first payment
{"ts":"2025-12-04T03:34:01.954Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"7524a40c-80ea-4670-81fb-0a9f1f607411","stage":"payment","correlationId":"payment-updated:10784e224df60c31bf27fbef"}
{"ts":"2025-12-04T03:55:25.874Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Server has closed the connection.","stack":"PrismaClientKnownRequestError: Server has closed the connection.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-04T03:55:29.044Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"258318c5-31f3-421a-99ef-d5b4d73c4555","stage":"payment","correlationId":"payment-updated:1a6a3c3b4e4e3b5838e31124","attempts":1}
üí∞ Processing payment completion for customer: MKJ6QJ202C3737YYZRZ4FNPH4R
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Rachel Yetso
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Rachel Yetso, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Rachel Yetso
   - Email: rachelyetso@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: MKJ6QJ202C3737YYZRZ4FNPH4R
{"ts":"2025-12-04T03:55:29.650Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"258318c5-31f3-421a-99ef-d5b4d73c4555","stage":"payment","correlationId":"payment-updated:1a6a3c3b4e4e3b5838e31124"}
{"ts":"2025-12-04T03:55:29.811Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"94193ad1-d207-4f4a-b4cd-365f25e269ed","stage":"payment","correlationId":"payment-updated:cd268d60b1629f090d173293","attempts":1}
üí∞ Processing payment completion for customer: MKJ6QJ202C3737YYZRZ4FNPH4R
   Payment source_type: CARD
   Payment tender_types: []
Customer MKJ6QJ202C3737YYZRZ4FNPH4R already completed first payment
{"ts":"2025-12-04T03:55:29.949Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"94193ad1-d207-4f4a-b4cd-365f25e269ed","stage":"payment","correlationId":"payment-updated:cd268d60b1629f090d173293"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-12-04T04:13:41.042Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-04T04:13:43.673Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"540c8807-438f-4a1c-b618-b0e5fdd10c50","stage":"payment","correlationId":"payment-updated:e6212c8fdab28ec79aafdfc6","attempts":1}
üí∞ Processing payment completion for customer: 2F7KF3BN3EKZ2HZK8K3GHHYNA4
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Emily Nansen
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Emily Nansen, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Emily Nansen
   - Email: em.nansen@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: 2F7KF3BN3EKZ2HZK8K3GHHYNA4
{"ts":"2025-12-04T04:13:44.289Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"540c8807-438f-4a1c-b618-b0e5fdd10c50","stage":"payment","correlationId":"payment-updated:e6212c8fdab28ec79aafdfc6"}
{"ts":"2025-12-04T04:13:44.447Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"b16f2830-09e3-41d9-9aee-3f5cc01e9599","stage":"payment","correlationId":"payment-updated:a16d7753504ab625e68fe86d","attempts":1}
üí∞ Processing payment completion for customer: 2F7KF3BN3EKZ2HZK8K3GHHYNA4
   Payment source_type: CARD
   Payment tender_types: []
Customer 2F7KF3BN3EKZ2HZK8K3GHHYNA4 already completed first payment
{"ts":"2025-12-04T04:13:44.587Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"b16f2830-09e3-41d9-9aee-3f5cc01e9599","stage":"payment","correlationId":"payment-updated:a16d7753504ab625e68fe86d"}
{"ts":"2025-12-04T04:23:45.722Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"cf62d5e4-cf0e-418d-93d1-e8cc42e7af5f","stage":"customer_ingest","correlationId":"customer-created:21ac38d6fe69de4ab094d936","attempts":1}
üì• Received customer data: {
  "id": "82C9MHCY12G6VV7K3XKWD24Z18",
  "address": {
    "country": "US"
  },
  "version": 0,
  "group_ids": [
    "LT4ZHFBQQYB2N.APPOINTMENTS"
  ],
  "created_at": "2025-12-04T04:23:41.338Z",
  "given_name": "Abigail",
  "updated_at": "2025-12-04T04:23:41Z",
  "family_name": "Aires",
  "preferences": {
    "email_unsubscribed": false
  },
  "phone_number": "+17073438811",
  "email_address": "abigailaleta@gmail.com",
  "creation_source": "APPOINTMENTS"
}
üë§ Processing customer creation: 82C9MHCY12G6VV7K3XKWD24Z18
üìç IP Address: unknown
üìß Email: abigailaleta@gmail.com
üìû Phone: +17073438811
üë§ Name: Abigail Aires
‚ö†Ô∏è Suspicious IP activity detected: unknown used by 140 customers
‚ö†Ô∏è Suspicious activity detected for customer 82C9MHCY12G6VV7K3XKWD24Z18, flagging for review
üéâ New customer detected: 82C9MHCY12G6VV7K3XKWD24Z18
‚úÖ Customer added to database as NEW (temporary mark)
   - Will check for referral code when they book
   - Will give gift card on first booking if code found
‚úÖ Verification: Customer found in DB: true
{"ts":"2025-12-04T04:23:46.342Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"cf62d5e4-cf0e-418d-93d1-e8cc42e7af5f","stage":"customer_ingest","correlationId":"customer-created:21ac38d6fe69de4ab094d936"}
{"ts":"2025-12-04T04:23:46.503Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"1dadd901-eb2a-4840-9106-b3b40c037683","stage":"booking","correlationId":"booking-created:17ac38d6fefa92285c82336e","attempts":1}
üìÖ Processing booking created for customer: 82C9MHCY12G6VV7K3XKWD24Z18
Full booking data: {
  "id": "r0oboonugalq99",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-28T20:10:00Z",
  "created_at": "2025-12-04T04:23:44Z",
  "updated_at": "2025-12-04T04:23:44Z",
  "customer_id": "82C9MHCY12G6VV7K3XKWD24Z18",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "82C9MHCY12G6VV7K3XKWD24Z18",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMoZGdZlg-iKWTDu",
      "any_team_member": true,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1764609601083,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    },
    {
      "team_member_id": "TMoZGdZlg-iKWTDu",
      "any_team_member": true,
      "duration_minutes": 10,
      "intermission_minutes": 0,
      "service_variation_id": "6F6F3OAFJSOEN3X7HSXYIVQC",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "6F6F3OAFJSOEN3X7HSXYIVQC"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Abigail Aires
üéâ First booking detected for customer: 82C9MHCY12G6VV7K3XKWD24Z18
   Name: Abigail Aires
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 82C9MHCY12G6VV7K3XKWD24Z18...
Error getting custom attributes for customer 82C9MHCY12G6VV7K3XKWD24Z18: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 82C9MHCY12G6VV7K3XKWD24Z18
{"ts":"2025-12-04T04:23:46.902Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"1dadd901-eb2a-4840-9106-b3b40c037683","stage":"booking","correlationId":"booking-created:17ac38d6fefa92285c82336e"}
{"ts":"2025-12-04T04:33:51.139Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-04T04:33:55.147Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-04T04:33:59.155Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-04T04:59:04.555Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"ec5df99d-24e3-438a-a335-ab0c31432c05","stage":"booking","correlationId":"booking-created:596d793c0526983a8d6cd213","attempts":1}
üìÖ Processing booking created for customer: 82C9MHCY12G6VV7K3XKWD24Z18
Full booking data: {
  "id": "rwltawc3bpujr4",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-24T18:30:00Z",
  "created_at": "2025-12-04T04:59:01Z",
  "updated_at": "2025-12-04T04:59:01Z",
  "customer_id": "82C9MHCY12G6VV7K3XKWD24Z18",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "82C9MHCY12G6VV7K3XKWD24Z18",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "resource_ids": [
        "KAOXILA4CV7A23VRAACC4R66"
      ],
      "team_member_id": "TMyUMvTJIj2HrHSg",
      "any_team_member": true,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "63PG6RLS2NHWRD5JRXEC74HN",
      "service_variation_version": 1760895536505,
      "service_variation_client_id": "VZLZVOWNIEIWAQ47FX67GQS4"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Abigail Aires
üéâ First booking detected for customer: 82C9MHCY12G6VV7K3XKWD24Z18
   Name: Abigail Aires
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 82C9MHCY12G6VV7K3XKWD24Z18...
Error getting custom attributes for customer 82C9MHCY12G6VV7K3XKWD24Z18: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 82C9MHCY12G6VV7K3XKWD24Z18
{"ts":"2025-12-04T04:59:05.903Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"ec5df99d-24e3-438a-a335-ab0c31432c05","stage":"booking","correlationId":"booking-created:596d793c0526983a8d6cd213"}
{"ts":"2025-12-04T05:02:43.131Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"964673db-826d-4229-8d42-ee542c3ad6c0","stage":"booking","correlationId":"booking-created:d16223e90912e02e601a0cfb","attempts":1}
üìÖ Processing booking created for customer: 8QZMQK99PZH7D9DBY4KM639NGM
Full booking data: {
  "id": "tcc1aq8l7u0msk",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-23T18:00:00Z",
  "created_at": "2025-12-04T05:02:41Z",
  "updated_at": "2025-12-04T05:02:41Z",
  "customer_id": "8QZMQK99PZH7D9DBY4KM639NGM",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "8QZMQK99PZH7D9DBY4KM639NGM",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMXiw38Bbb7XQUWI",
      "any_team_member": true,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1764609601083,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    },
    {
      "resource_ids": [
        "F2MBRCC42VNNDWXNA3PAMHEU"
      ],
      "team_member_id": "TMXiw38Bbb7XQUWI",
      "any_team_member": true,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "ZEAKNB35I37RMXNUBGWDZQIM",
      "service_variation_version": 1760895536505,
      "service_variation_client_id": "ZEAKNB35I37RMXNUBGWDZQIM"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Cauteaux Vrakelos
üéâ First booking detected for customer: 8QZMQK99PZH7D9DBY4KM639NGM
   Name: Cauteaux Vrakelos
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 8QZMQK99PZH7D9DBY4KM639NGM...
Error getting custom attributes for customer 8QZMQK99PZH7D9DBY4KM639NGM: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 8QZMQK99PZH7D9DBY4KM639NGM
{"ts":"2025-12-04T05:02:44.099Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"964673db-826d-4229-8d42-ee542c3ad6c0","stage":"booking","correlationId":"booking-created:d16223e90912e02e601a0cfb"}
{"ts":"2025-12-04T05:52:23.732Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"530113bb-61a2-47e5-a327-7320c49d41fb","stage":"booking","correlationId":"booking-created:d304997a7540df07b0df5b3a","attempts":1}
üìÖ Processing booking created for customer: NX1857HMZ6DF8ZFXV5S69PHP3R
Full booking data: {
  "id": "ci6qhyw3xcva6z",
  "source": "THIRD_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-15T18:40:00Z",
  "created_at": "2025-12-04T05:52:19Z",
  "updated_at": "2025-12-04T05:52:19Z",
  "customer_id": "NX1857HMZ6DF8ZFXV5S69PHP3R",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "NX1857HMZ6DF8ZFXV5S69PHP3R",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMVwAQUdLz6no-cB",
      "any_team_member": false,
      "duration_minutes": 100,
      "intermission_minutes": 0,
      "service_variation_id": "GSZZR45VJXB44NF4P4WXI5NB",
      "service_variation_version": 1764801478862,
      "service_variation_client_id": "GSZZR45VJXB44NF4P4WXI5NB"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Katerina Marinou
üéâ First booking detected for customer: NX1857HMZ6DF8ZFXV5S69PHP3R
   Name: Katerina Marinou
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer NX1857HMZ6DF8ZFXV5S69PHP3R...
Error getting custom attributes for customer NX1857HMZ6DF8ZFXV5S69PHP3R: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: NX1857HMZ6DF8ZFXV5S69PHP3R
{"ts":"2025-12-04T05:52:24.571Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"530113bb-61a2-47e5-a327-7320c49d41fb","stage":"booking","correlationId":"booking-created:d304997a7540df07b0df5b3a"}
{"ts":"2025-12-04T05:52:51.749Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"fe4f969e-3d4a-420f-b7e1-4b173f76f38d","stage":"booking","correlationId":"booking-created:3607863d65e4aceaf3b74d97","attempts":1}
üìÖ Processing booking created for customer: Q4D4PG62FBHBH2YKZ066QTWNVG
Full booking data: {
  "id": "hwei6nmveudshv",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-09T22:50:00Z",
  "created_at": "2025-12-04T05:52:48Z",
  "updated_at": "2025-12-04T05:52:48Z",
  "customer_id": "Q4D4PG62FBHBH2YKZ066QTWNVG",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "Q4D4PG62FBHBH2YKZ066QTWNVG",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMyUMvTJIj2HrHSg",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "JMTK5M2CY2W7WEXSTAJKAJ35",
      "service_variation_version": 1764801478862,
      "service_variation_client_id": "JMTK5M2CY2W7WEXSTAJKAJ35"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Dion Lim
üéâ First booking detected for customer: Q4D4PG62FBHBH2YKZ066QTWNVG
   Name: Dion Lim
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer Q4D4PG62FBHBH2YKZ066QTWNVG...
Error getting custom attributes for customer Q4D4PG62FBHBH2YKZ066QTWNVG: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: Q4D4PG62FBHBH2YKZ066QTWNVG
{"ts":"2025-12-04T05:52:52.283Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"fe4f969e-3d4a-420f-b7e1-4b173f76f38d","stage":"booking","correlationId":"booking-created:3607863d65e4aceaf3b74d97"}
{"ts":"2025-12-04T13:24:45.668Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"8a0fa152-a65f-4a20-a55f-d1338e5ef8f5","stage":"booking","correlationId":"booking-created:ebc259daaa60103f4fb947fc","attempts":1}
üìÖ Processing booking created for customer: ETWCKRR3KMJFZDVNCDJF4WSCZ4
Full booking data: {
  "id": "g8rtfioklsnrvr",
  "source": "THIRD_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-16T18:30:00Z",
  "created_at": "2025-12-04T13:24:43Z",
  "updated_at": "2025-12-04T13:24:43Z",
  "customer_id": "ETWCKRR3KMJFZDVNCDJF4WSCZ4",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "ETWCKRR3KMJFZDVNCDJF4WSCZ4",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TM9jDlRr_Hl4rdBB",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "XBUDIMNKOPC2XVG5YLIQ4RYS",
      "service_variation_version": 1764801478862,
      "service_variation_client_id": "XBUDIMNKOPC2XVG5YLIQ4RYS"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Kelly Beasley
üéâ First booking detected for customer: ETWCKRR3KMJFZDVNCDJF4WSCZ4
   Name: Kelly Beasley
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer ETWCKRR3KMJFZDVNCDJF4WSCZ4...
Error getting custom attributes for customer ETWCKRR3KMJFZDVNCDJF4WSCZ4: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: ETWCKRR3KMJFZDVNCDJF4WSCZ4
{"ts":"2025-12-04T13:24:46.376Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"8a0fa152-a65f-4a20-a55f-d1338e5ef8f5","stage":"booking","correlationId":"booking-created:ebc259daaa60103f4fb947fc"}
{"ts":"2025-12-04T15:36:49.731Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"e3d441a0-6b3e-46f0-ac24-67aaaf961e57","stage":"booking","correlationId":"booking-created:a11f918c6962fc8e50dc9ecc","attempts":1}
üìÖ Processing booking created for customer: 7W8ZZ4VYWAQQNNCKZ3PE63ZCQM
Full booking data: {
  "id": "utztx8emf1di5h",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-26T21:20:00Z",
  "created_at": "2025-12-04T15:36:46Z",
  "updated_at": "2025-12-04T15:36:46Z",
  "customer_id": "7W8ZZ4VYWAQQNNCKZ3PE63ZCQM",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "7W8ZZ4VYWAQQNNCKZ3PE63ZCQM",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMILsQUVwLkLzbVo",
      "any_team_member": false,
      "duration_minutes": 100,
      "intermission_minutes": 0,
      "service_variation_id": "BM556FTNFOTEHYVG4GPXAXFM",
      "service_variation_version": 1764801478862,
      "service_variation_client_id": "BM556FTNFOTEHYVG4GPXAXFM"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Stephanie Hernandez
üéâ First booking detected for customer: 7W8ZZ4VYWAQQNNCKZ3PE63ZCQM
   Name: Stephanie Hernandez
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 7W8ZZ4VYWAQQNNCKZ3PE63ZCQM...
Error getting custom attributes for customer 7W8ZZ4VYWAQQNNCKZ3PE63ZCQM: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 7W8ZZ4VYWAQQNNCKZ3PE63ZCQM
{"ts":"2025-12-04T15:36:50.443Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"e3d441a0-6b3e-46f0-ac24-67aaaf961e57","stage":"booking","correlationId":"booking-created:a11f918c6962fc8e50dc9ecc"}
{"ts":"2025-12-04T15:46:15.724Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-04T15:46:19.731Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-04T15:51:25.873Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-04T16:12:30.618Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"f4b2bb32-508f-4015-8ef8-16093c530b45","stage":"booking","correlationId":"booking-created:b51cbb9f153468cc17945f79","attempts":1}
üìÖ Processing booking created for customer: Z2WRJWX9P8V2ZN9KQWQ4YRMH4C
Full booking data: {
  "id": "doczvbd8g8adue",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-11T00:05:00Z",
  "created_at": "2025-12-04T16:12:27Z",
  "updated_at": "2025-12-04T16:12:27Z",
  "customer_id": "Z2WRJWX9P8V2ZN9KQWQ4YRMH4C",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "Z2WRJWX9P8V2ZN9KQWQ4YRMH4C",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMMCVDJoKh3ZkfFo",
      "any_team_member": false,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1764609601083,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Elizabeth Tourigny
üéâ First booking detected for customer: Z2WRJWX9P8V2ZN9KQWQ4YRMH4C
   Name: Elizabeth Tourigny
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer Z2WRJWX9P8V2ZN9KQWQ4YRMH4C...
Error getting custom attributes for customer Z2WRJWX9P8V2ZN9KQWQ4YRMH4C: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: Z2WRJWX9P8V2ZN9KQWQ4YRMH4C
{"ts":"2025-12-04T16:12:31.956Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"f4b2bb32-508f-4015-8ef8-16093c530b45","stage":"booking","correlationId":"booking-created:b51cbb9f153468cc17945f79"}
{"ts":"2025-12-04T16:20:43.355Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"ed608af1-25cc-49f6-bc98-85b8995b85db","stage":"booking","correlationId":"booking-created:39713c5622a69a2b60637182","attempts":1}
üìÖ Processing booking created for customer: CH3TGGBGC9CM02EH32YQFEV19C
Full booking data: {
  "id": "37jqt4py7lx40x",
  "source": "THIRD_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-15T17:00:00Z",
  "created_at": "2025-12-04T16:20:41Z",
  "updated_at": "2025-12-04T16:20:41Z",
  "customer_id": "CH3TGGBGC9CM02EH32YQFEV19C",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "CH3TGGBGC9CM02EH32YQFEV19C",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMOscywuGXO2VURY",
      "any_team_member": true,
      "duration_minutes": 140,
      "intermission_minutes": 0,
      "service_variation_id": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "service_variation_version": 1764783981722,
      "service_variation_client_id": "CJI5WHOAKSFTASYPJ4MSYZLS"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Andrea V
üéâ First booking detected for customer: CH3TGGBGC9CM02EH32YQFEV19C
   Name: Andrea V
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer CH3TGGBGC9CM02EH32YQFEV19C...
Error getting custom attributes for customer CH3TGGBGC9CM02EH32YQFEV19C: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: CH3TGGBGC9CM02EH32YQFEV19C
{"ts":"2025-12-04T16:20:44.034Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"ed608af1-25cc-49f6-bc98-85b8995b85db","stage":"booking","correlationId":"booking-created:39713c5622a69a2b60637182"}
{"ts":"2025-12-04T16:21:45.945Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"8665264e-de8d-47d7-b2ce-6c00d1558ac7","stage":"booking","correlationId":"booking-created:350ad7e6f36821ae99864520","attempts":1}
üìÖ Processing booking created for customer: D6Y59VS7SYCE4YZTM1MECYGWF8
Full booking data: {
  "id": "947qmq1pj5au5z",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-24T17:00:00Z",
  "created_at": "2025-12-04T16:21:42Z",
  "updated_at": "2025-12-04T16:21:42Z",
  "customer_id": "D6Y59VS7SYCE4YZTM1MECYGWF8",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "D6Y59VS7SYCE4YZTM1MECYGWF8",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMVwAQUdLz6no-cB",
      "any_team_member": false,
      "duration_minutes": 100,
      "intermission_minutes": 0,
      "service_variation_id": "GSZZR45VJXB44NF4P4WXI5NB",
      "service_variation_version": 1764801478862,
      "service_variation_client_id": "GSZZR45VJXB44NF4P4WXI5NB"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Katie Scherer
üéâ First booking detected for customer: D6Y59VS7SYCE4YZTM1MECYGWF8
   Name: Katie Scherer
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer D6Y59VS7SYCE4YZTM1MECYGWF8...
Error getting custom attributes for customer D6Y59VS7SYCE4YZTM1MECYGWF8: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: D6Y59VS7SYCE4YZTM1MECYGWF8
{"ts":"2025-12-04T16:21:46.675Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"8665264e-de8d-47d7-b2ce-6c00d1558ac7","stage":"booking","correlationId":"booking-created:350ad7e6f36821ae99864520"}
{"ts":"2025-12-04T16:23:39.578Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"7a96c8fe-3a67-4190-9626-e6c7b5a7788e","stage":"booking","correlationId":"booking-created:66df2f93333419c2ab134be2","attempts":1}
üìÖ Processing booking created for customer: QKEAMK5KJ90Z758QGZMQH3VKVC
Full booking data: {
  "id": "935ieu4094wv8c",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-04T21:30:00Z",
  "created_at": "2025-12-04T16:23:37Z",
  "updated_at": "2025-12-04T16:23:37Z",
  "customer_id": "QKEAMK5KJ90Z758QGZMQH3VKVC",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "QKEAMK5KJ90Z758QGZMQH3VKVC",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMyUMvTJIj2HrHSg",
      "any_team_member": true,
      "duration_minutes": 45,
      "intermission_minutes": 0,
      "service_variation_id": "VVA7G2UN7N2HUFMCW5LQOVHB",
      "service_variation_version": 1764783981722,
      "service_variation_client_id": "VVA7G2UN7N2HUFMCW5LQOVHB"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Martine Zadno
üéâ First booking detected for customer: QKEAMK5KJ90Z758QGZMQH3VKVC
   Name: Martine Zadno
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer QKEAMK5KJ90Z758QGZMQH3VKVC...
Error getting custom attributes for customer QKEAMK5KJ90Z758QGZMQH3VKVC: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: QKEAMK5KJ90Z758QGZMQH3VKVC
{"ts":"2025-12-04T16:23:40.141Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"7a96c8fe-3a67-4190-9626-e6c7b5a7788e","stage":"booking","correlationId":"booking-created:66df2f93333419c2ab134be2"}
{"ts":"2025-12-04T16:56:59.972Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"c0eb53c3-a1b4-489e-a2d3-38ba28e137b9","stage":"booking","correlationId":"booking-created:92082298361ab1f605855df6","attempts":1}
üìÖ Processing booking created for customer: XJQWJMF9N5CH2H5R3QWX5A2QJG
Full booking data: {
  "id": "46w3zitckcj7sb",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-14T23:10:00Z",
  "created_at": "2025-12-04T16:56:56Z",
  "updated_at": "2025-12-04T16:56:56Z",
  "customer_id": "XJQWJMF9N5CH2H5R3QWX5A2QJG",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "XJQWJMF9N5CH2H5R3QWX5A2QJG",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TM7_r-KmvY9xjnEU",
      "any_team_member": false,
      "duration_minutes": 110,
      "intermission_minutes": 0,
      "service_variation_id": "GJ5SRTYFV6ZCDI62TMSZP2OP",
      "service_variation_version": 1764801478862,
      "service_variation_client_id": "GJ5SRTYFV6ZCDI62TMSZP2OP"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Sandra Waliczek
üéâ First booking detected for customer: XJQWJMF9N5CH2H5R3QWX5A2QJG
   Name: Sandra Waliczek
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer XJQWJMF9N5CH2H5R3QWX5A2QJG...
Error getting custom attributes for customer XJQWJMF9N5CH2H5R3QWX5A2QJG: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: XJQWJMF9N5CH2H5R3QWX5A2QJG
{"ts":"2025-12-04T16:57:01.479Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"c0eb53c3-a1b4-489e-a2d3-38ba28e137b9","stage":"booking","correlationId":"booking-created:92082298361ab1f605855df6"}
{"ts":"2025-12-04T17:02:02.841Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"5c51f2f2-4d39-455b-a953-33fe3505dbb2","stage":"customer_ingest","correlationId":"customer-created:3ed7ebdfa9a50ceb05868480","attempts":1}
üì• Received customer data: {
  "id": "A2SZPS40XW8K9H7CWDNXHFTQHW",
  "address": {
    "country": "US"
  },
  "version": 0,
  "group_ids": [
    "LT4ZHFBQQYB2N.APPOINTMENTS"
  ],
  "created_at": "2025-12-04T17:01:57.054Z",
  "given_name": "Katy",
  "updated_at": "2025-12-04T17:01:57Z",
  "family_name": "Camp",
  "preferences": {
    "email_unsubscribed": false
  },
  "phone_number": "+18178050034",
  "email_address": "cckaty82@gmail.com",
  "creation_source": "APPOINTMENTS"
}
üë§ Processing customer creation: A2SZPS40XW8K9H7CWDNXHFTQHW
üìç IP Address: unknown
üìß Email: cckaty82@gmail.com
üìû Phone: +18178050034
üë§ Name: Katy Camp
‚ö†Ô∏è Suspicious IP activity detected: unknown used by 141 customers
‚ö†Ô∏è Suspicious activity detected for customer A2SZPS40XW8K9H7CWDNXHFTQHW, flagging for review
üéâ New customer detected: A2SZPS40XW8K9H7CWDNXHFTQHW
‚úÖ Customer added to database as NEW (temporary mark)
   - Will check for referral code when they book
   - Will give gift card on first booking if code found
‚úÖ Verification: Customer found in DB: true
{"ts":"2025-12-04T17:02:03.387Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"5c51f2f2-4d39-455b-a953-33fe3505dbb2","stage":"customer_ingest","correlationId":"customer-created:3ed7ebdfa9a50ceb05868480"}
{"ts":"2025-12-04T17:02:03.552Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"cf54cc63-4b4b-43cd-8299-eaed31f2f66e","stage":"booking","correlationId":"booking-created:a1e3f56b12d1c0607d265ebb","attempts":1}
üìÖ Processing booking created for customer: A2SZPS40XW8K9H7CWDNXHFTQHW
Full booking data: {
  "id": "7qy1a5hy3u6dxx",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-30T21:00:00Z",
  "created_at": "2025-12-04T17:01:59Z",
  "updated_at": "2025-12-04T17:01:59Z",
  "customer_id": "A2SZPS40XW8K9H7CWDNXHFTQHW",
  "location_id": "LNQKVBTQZN3EZ",
  "customer_note": "I will be in from out of town",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "A2SZPS40XW8K9H7CWDNXHFTQHW",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMILsQUVwLkLzbVo",
      "any_team_member": false,
      "duration_minutes": 100,
      "intermission_minutes": 0,
      "service_variation_id": "BM556FTNFOTEHYVG4GPXAXFM",
      "service_variation_version": 1764801478862,
      "service_variation_client_id": "BM556FTNFOTEHYVG4GPXAXFM"
    },
    {
      "resource_ids": [
        "5OVIQ6GSSUXORACP6T7WBAQ7"
      ],
      "team_member_id": "TMILsQUVwLkLzbVo",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "ZEAKNB35I37RMXNUBGWDZQIM",
      "service_variation_version": 1760895536505,
      "service_variation_client_id": "ZEAKNB35I37RMXNUBGWDZQIM"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Katy Camp
üéâ First booking detected for customer: A2SZPS40XW8K9H7CWDNXHFTQHW
   Name: Katy Camp
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer A2SZPS40XW8K9H7CWDNXHFTQHW...
Error getting custom attributes for customer A2SZPS40XW8K9H7CWDNXHFTQHW: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: A2SZPS40XW8K9H7CWDNXHFTQHW
{"ts":"2025-12-04T17:02:03.994Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"cf54cc63-4b4b-43cd-8299-eaed31f2f66e","stage":"booking","correlationId":"booking-created:a1e3f56b12d1c0607d265ebb"}
{"ts":"2025-12-04T17:13:55.599Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"862ccead-df10-4fe8-879e-5db9989dc4b3","stage":"booking","correlationId":"booking-created:eb37c936544157c1acf180e7","attempts":1}
üìÖ Processing booking created for customer: DT4KCX9R0SQTM4WV76Z0Y6M4P4
Full booking data: {
  "id": "hnspb45sakuail",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-12T02:00:00Z",
  "created_at": "2025-12-04T17:13:53Z",
  "updated_at": "2025-12-04T17:13:53Z",
  "customer_id": "DT4KCX9R0SQTM4WV76Z0Y6M4P4",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "DT4KCX9R0SQTM4WV76Z0Y6M4P4",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMMCVDJoKh3ZkfFo",
      "any_team_member": false,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1764609601083,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Catherine Batang
üéâ First booking detected for customer: DT4KCX9R0SQTM4WV76Z0Y6M4P4
   Name: Catherine Batang
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer DT4KCX9R0SQTM4WV76Z0Y6M4P4...
Error getting custom attributes for customer DT4KCX9R0SQTM4WV76Z0Y6M4P4: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: DT4KCX9R0SQTM4WV76Z0Y6M4P4
{"ts":"2025-12-04T17:13:56.538Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"862ccead-df10-4fe8-879e-5db9989dc4b3","stage":"booking","correlationId":"booking-created:eb37c936544157c1acf180e7"}
{"ts":"2025-12-04T17:24:19.242Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"356c9972-b986-4bd1-925d-66d2610624b9","stage":"booking","correlationId":"booking-created:358d343538bccd0b23391958","attempts":1}
üìÖ Processing booking created for customer: WR0DP0V9A7S39EX6X8RYHWHE30
Full booking data: {
  "id": "izf2ip9ms94z87",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-06T21:00:00Z",
  "created_at": "2025-12-04T17:24:15Z",
  "updated_at": "2025-12-04T17:24:15Z",
  "customer_id": "WR0DP0V9A7S39EX6X8RYHWHE30",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "WR0DP0V9A7S39EX6X8RYHWHE30",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMNW4SIF7tjp4oM_",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "BRSIGZFOWC6F4ERPKX3CODLU",
      "service_variation_version": 1764801478862,
      "service_variation_client_id": "BRSIGZFOWC6F4ERPKX3CODLU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Martha Wedner
üéâ First booking detected for customer: WR0DP0V9A7S39EX6X8RYHWHE30
   Name: Martha Wedner
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer WR0DP0V9A7S39EX6X8RYHWHE30...
Error getting custom attributes for customer WR0DP0V9A7S39EX6X8RYHWHE30: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: WR0DP0V9A7S39EX6X8RYHWHE30
{"ts":"2025-12-04T17:24:20.520Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"356c9972-b986-4bd1-925d-66d2610624b9","stage":"booking","correlationId":"booking-created:358d343538bccd0b23391958"}
{"ts":"2025-12-04T17:37:24.572Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"b6049e69-8d74-4193-8871-ceebaa2f6079","stage":"booking","correlationId":"booking-created:85d8f66e7c45a30287bb6d02","attempts":1}
üìÖ Processing booking created for customer: HZKGGHH8D1C9RJ11ZKMHZGYCPC
Full booking data: {
  "id": "3rns965vhmwe4q",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-05T17:00:00Z",
  "created_at": "2025-12-04T17:37:21Z",
  "updated_at": "2025-12-04T17:37:21Z",
  "customer_id": "HZKGGHH8D1C9RJ11ZKMHZGYCPC",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "HZKGGHH8D1C9RJ11ZKMHZGYCPC",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMMCVDJoKh3ZkfFo",
      "any_team_member": true,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1764609601083,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Natalie Graf
üéâ First booking detected for customer: HZKGGHH8D1C9RJ11ZKMHZGYCPC
   Name: Natalie Graf
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer HZKGGHH8D1C9RJ11ZKMHZGYCPC...
Error getting custom attributes for customer HZKGGHH8D1C9RJ11ZKMHZGYCPC: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: HZKGGHH8D1C9RJ11ZKMHZGYCPC
{"ts":"2025-12-04T17:37:25.936Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"b6049e69-8d74-4193-8871-ceebaa2f6079","stage":"booking","correlationId":"booking-created:85d8f66e7c45a30287bb6d02"}
{"ts":"2025-12-04T17:45:19.051Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"a43c6d36-b669-4bfe-b5eb-6ebff0725d66","stage":"booking","correlationId":"booking-created:db8c1ddf29642568188129f5","attempts":1}
üìÖ Processing booking created for customer: CJXTRM97MY1JM09NM8TD2480SM
Full booking data: {
  "id": "u84wdni9jn4js3",
  "source": "THIRD_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-10T00:00:00Z",
  "created_at": "2025-12-04T17:45:16Z",
  "updated_at": "2025-12-04T17:45:16Z",
  "customer_id": "CJXTRM97MY1JM09NM8TD2480SM",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "CJXTRM97MY1JM09NM8TD2480SM",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMdagA6g0F03A7_w",
      "any_team_member": true,
      "duration_minutes": 140,
      "intermission_minutes": 0,
      "service_variation_id": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "service_variation_version": 1764783981722,
      "service_variation_client_id": "CJI5WHOAKSFTASYPJ4MSYZLS"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Lauren Kline
üéâ First booking detected for customer: CJXTRM97MY1JM09NM8TD2480SM
   Name: Lauren Kline
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer CJXTRM97MY1JM09NM8TD2480SM...
Error getting custom attributes for customer CJXTRM97MY1JM09NM8TD2480SM: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: CJXTRM97MY1JM09NM8TD2480SM
{"ts":"2025-12-04T17:45:19.706Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"a43c6d36-b669-4bfe-b5eb-6ebff0725d66","stage":"booking","correlationId":"booking-created:db8c1ddf29642568188129f5"}
{"ts":"2025-12-04T17:57:16.853Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"2c9757fd-db46-43d7-a1b6-2c93f7f45339","stage":"booking","correlationId":"booking-created:1945d893d864209c7e97c134","attempts":1}
üìÖ Processing booking created for customer: 0QM3FB1M39C6YTTNCYFDEC3A8M
Full booking data: {
  "id": "2vtc51f6cy71te",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-04T21:30:00Z",
  "created_at": "2025-12-04T17:57:13Z",
  "updated_at": "2025-12-04T17:57:13Z",
  "customer_id": "0QM3FB1M39C6YTTNCYFDEC3A8M",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "0QM3FB1M39C6YTTNCYFDEC3A8M",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMyUMvTJIj2HrHSg",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "JMTK5M2CY2W7WEXSTAJKAJ35",
      "service_variation_version": 1764801478862,
      "service_variation_client_id": "JMTK5M2CY2W7WEXSTAJKAJ35"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Kirsten Hong
‚ÑπÔ∏è Customer 0QM3FB1M39C6YTTNCYFDEC3A8M already received signup bonus, not first booking
{"ts":"2025-12-04T17:57:17.236Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"2c9757fd-db46-43d7-a1b6-2c93f7f45339","stage":"booking","correlationId":"booking-created:1945d893d864209c7e97c134"}
{"ts":"2025-12-04T18:29:25.071Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"b47820bc-5201-4ea5-88cd-bf55a2a709d8","stage":"booking","correlationId":"booking-created:d711507f72f9977720baa0bf","attempts":1}
üìÖ Processing booking created for customer: JSK6DKZYPAXM04RVXXH15F9FPC
Full booking data: {
  "id": "690f186naugvda",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-07T18:00:00Z",
  "created_at": "2025-12-04T18:29:22Z",
  "updated_at": "2025-12-04T18:29:22Z",
  "customer_id": "JSK6DKZYPAXM04RVXXH15F9FPC",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "JSK6DKZYPAXM04RVXXH15F9FPC",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMEWAZHdtaiRR_Zs",
      "any_team_member": true,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1764609601083,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Brighton Miller
üéâ First booking detected for customer: JSK6DKZYPAXM04RVXXH15F9FPC
   Name: Brighton Miller
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer JSK6DKZYPAXM04RVXXH15F9FPC...
Error getting custom attributes for customer JSK6DKZYPAXM04RVXXH15F9FPC: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: JSK6DKZYPAXM04RVXXH15F9FPC
{"ts":"2025-12-04T18:29:25.777Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"b47820bc-5201-4ea5-88cd-bf55a2a709d8","stage":"booking","correlationId":"booking-created:d711507f72f9977720baa0bf"}
{"ts":"2025-12-04T18:48:04.179Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"420af7cf-5856-440e-adfb-e8504b83eec7","stage":"payment","correlationId":"payment-updated:86a90eb368575ccb4b1770b7","attempts":1}
üí∞ Processing payment completion for customer: 28KVX7W71Q3N0YKFJ4MHA45SYC
   Payment source_type: CARD
   Payment tender_types: []
Customer 28KVX7W71Q3N0YKFJ4MHA45SYC already completed first payment
{"ts":"2025-12-04T18:48:04.598Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"420af7cf-5856-440e-adfb-e8504b83eec7","stage":"payment","correlationId":"payment-updated:86a90eb368575ccb4b1770b7"}
{"ts":"2025-12-04T18:48:09.059Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"21775271-18fb-4ea9-9938-7b0bc1c5ac5c","stage":"payment","correlationId":"payment-updated:8a725b9ee322a686aa9b4454","attempts":1}
üí∞ Processing payment completion for customer: 28KVX7W71Q3N0YKFJ4MHA45SYC
   Payment source_type: CARD
   Payment tender_types: []
Customer 28KVX7W71Q3N0YKFJ4MHA45SYC already completed first payment
{"ts":"2025-12-04T18:48:09.203Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"21775271-18fb-4ea9-9938-7b0bc1c5ac5c","stage":"payment","correlationId":"payment-updated:8a725b9ee322a686aa9b4454"}
{"ts":"2025-12-04T19:02:32.066Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"c3c9fcb2-e9de-4c48-9ad6-bdbd062aab43","stage":"payment","correlationId":"payment-updated:8bb2c1fa8974064260359bc4","attempts":1}
üí∞ Processing payment completion for customer: S9R57Z7EC13A7Z42AVMH0NTCXR
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Daria Kravchenko
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Daria Kravchenko, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Daria Kravchenko
   - Email: Daria.d.kravchenko@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: S9R57Z7EC13A7Z42AVMH0NTCXR
{"ts":"2025-12-04T19:02:32.878Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"c3c9fcb2-e9de-4c48-9ad6-bdbd062aab43","stage":"payment","correlationId":"payment-updated:8bb2c1fa8974064260359bc4"}
{"ts":"2025-12-04T19:02:35.458Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"5c52344f-49bf-43a8-b264-cac7f8b70df9","stage":"payment","correlationId":"payment-updated:c20a5bdbfb162e619d3f73e2","attempts":1}
üí∞ Processing payment completion for customer: S9R57Z7EC13A7Z42AVMH0NTCXR
   Payment source_type: CARD
   Payment tender_types: []
Customer S9R57Z7EC13A7Z42AVMH0NTCXR already completed first payment
{"ts":"2025-12-04T19:02:35.812Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"5c52344f-49bf-43a8-b264-cac7f8b70df9","stage":"payment","correlationId":"payment-updated:c20a5bdbfb162e619d3f73e2"}
{"ts":"2025-12-04T19:23:30.670Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"bc056b65-c23e-435b-a071-b61954553536","stage":"payment","correlationId":"payment-updated:1856f0dfc7fccd1a7fc40e5d","attempts":1}
üí∞ Processing payment completion for customer: 494KD02DD99MYHNCT5BYK0ZNZ8
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Kelsey Kaplan
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Kelsey Kaplan, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Kelsey Kaplan
   - Email: Kelseyryplkaplan@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: 494KD02DD99MYHNCT5BYK0ZNZ8
{"ts":"2025-12-04T19:23:31.248Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"bc056b65-c23e-435b-a071-b61954553536","stage":"payment","correlationId":"payment-updated:1856f0dfc7fccd1a7fc40e5d"}
{"ts":"2025-12-04T19:23:35.714Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"a6c5e860-ab34-4465-bbee-46756fbb7df6","stage":"payment","correlationId":"payment-updated:f4db8a6aee34781f50f2e0ee","attempts":1}
üí∞ Processing payment completion for customer: 494KD02DD99MYHNCT5BYK0ZNZ8
   Payment source_type: CARD
   Payment tender_types: []
Customer 494KD02DD99MYHNCT5BYK0ZNZ8 already completed first payment
{"ts":"2025-12-04T19:23:35.850Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"a6c5e860-ab34-4465-bbee-46756fbb7df6","stage":"payment","correlationId":"payment-updated:f4db8a6aee34781f50f2e0ee"}
{"ts":"2025-12-04T19:44:50.798Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"e1791225-f3a8-401f-898a-6e4d5e1853cd","stage":"payment","correlationId":"payment-updated:3c35c903fd50ee6a7ab28a1b","attempts":1}
üí∞ Processing payment completion for customer: Y7B4GKDBYW9PP9E91TCBEPW7Y0
   Payment source_type: CARD
   Payment tender_types: []
Customer Y7B4GKDBYW9PP9E91TCBEPW7Y0 already completed first payment
{"ts":"2025-12-04T19:44:51.872Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"e1791225-f3a8-401f-898a-6e4d5e1853cd","stage":"payment","correlationId":"payment-updated:3c35c903fd50ee6a7ab28a1b"}
{"ts":"2025-12-04T19:44:56.902Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"27484a6b-c31d-4bfe-898e-0134157d7509","stage":"payment","correlationId":"payment-updated:e1f6fbd5b795a74bb5b3ba33","attempts":1}
üí∞ Processing payment completion for customer: Y7B4GKDBYW9PP9E91TCBEPW7Y0
   Payment source_type: CARD
   Payment tender_types: []
Customer Y7B4GKDBYW9PP9E91TCBEPW7Y0 already completed first payment
{"ts":"2025-12-04T19:44:57.356Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"27484a6b-c31d-4bfe-898e-0134157d7509","stage":"payment","correlationId":"payment-updated:e1f6fbd5b795a74bb5b3ba33"}
{"ts":"2025-12-04T19:55:46.009Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"dbe0003b-0701-4ac0-8f2d-08cf3b62e966","stage":"booking","correlationId":"booking-created:4080177ff152923faea0e857","attempts":1}
üìÖ Processing booking created for customer: 0JW4E11ZRRNMGT78JMKGPWPR28
Full booking data: {
  "id": "sqge1iwqull3ms",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-12T19:00:00Z",
  "created_at": "2025-12-04T19:55:43Z",
  "updated_at": "2025-12-04T19:55:43Z",
  "customer_id": "0JW4E11ZRRNMGT78JMKGPWPR28",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMaVpirfZhWw5oM-"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMoZGdZlg-iKWTDu",
      "any_team_member": false,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1764609601083,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    },
    {
      "team_member_id": "TMoZGdZlg-iKWTDu",
      "any_team_member": false,
      "duration_minutes": 40,
      "intermission_minutes": 0,
      "service_variation_id": "LFLFEZO7L46URIM2OVZOJADI",
      "service_variation_version": 1762374620368,
      "service_variation_client_id": "LFLFEZO7L46URIM2OVZOJADI"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: CATARINA BLOGGER
üéâ First booking detected for customer: 0JW4E11ZRRNMGT78JMKGPWPR28
   Name: CATARINA BLOGGER
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 0JW4E11ZRRNMGT78JMKGPWPR28...
Error getting custom attributes for customer 0JW4E11ZRRNMGT78JMKGPWPR28: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 0JW4E11ZRRNMGT78JMKGPWPR28
{"ts":"2025-12-04T19:55:46.691Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"dbe0003b-0701-4ac0-8f2d-08cf3b62e966","stage":"booking","correlationId":"booking-created:4080177ff152923faea0e857"}
{"ts":"2025-12-04T19:57:08.211Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"ce05c0a5-22d9-497b-a8c9-9ebf0e3edc96","stage":"payment","correlationId":"payment-updated:a1013d31272436d05d3f8635","attempts":1}
üí∞ Processing payment completion for customer: QZ117BT4YFEZ2V8HHK456YY5TR
   Payment source_type: CARD
   Payment tender_types: []
Customer QZ117BT4YFEZ2V8HHK456YY5TR already completed first payment
{"ts":"2025-12-04T19:57:08.486Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"ce05c0a5-22d9-497b-a8c9-9ebf0e3edc96","stage":"payment","correlationId":"payment-updated:a1013d31272436d05d3f8635"}
{"ts":"2025-12-04T19:57:16.537Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"c552bc40-75ba-443c-ab44-7b014b0639cc","stage":"payment","correlationId":"payment-updated:f075bcce116f32cfb5db001a","attempts":1}
üí∞ Processing payment completion for customer: QZ117BT4YFEZ2V8HHK456YY5TR
   Payment source_type: CARD
   Payment tender_types: []
Customer QZ117BT4YFEZ2V8HHK456YY5TR already completed first payment
{"ts":"2025-12-04T19:57:16.990Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"c552bc40-75ba-443c-ab44-7b014b0639cc","stage":"payment","correlationId":"payment-updated:f075bcce116f32cfb5db001a"}
{"ts":"2025-12-04T19:57:17.431Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"5445525a-e1f9-4a11-9ced-653cf94dcd0c","stage":"booking","correlationId":"booking-created:98eb7afe8e780cadb1923afd","attempts":1}
üìÖ Processing booking created for customer: DT4KCX9R0SQTM4WV76Z0Y6M4P4
Full booking data: {
  "id": "fpne5l8d6r0wgg",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-13T22:00:00Z",
  "created_at": "2025-12-04T19:57:15Z",
  "updated_at": "2025-12-04T19:57:15Z",
  "customer_id": "DT4KCX9R0SQTM4WV76Z0Y6M4P4",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "DT4KCX9R0SQTM4WV76Z0Y6M4P4",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMXiw38Bbb7XQUWI",
      "any_team_member": false,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1764609601083,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Catherine Batang
üéâ First booking detected for customer: DT4KCX9R0SQTM4WV76Z0Y6M4P4
   Name: Catherine Batang
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer DT4KCX9R0SQTM4WV76Z0Y6M4P4...
Error getting custom attributes for customer DT4KCX9R0SQTM4WV76Z0Y6M4P4: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: DT4KCX9R0SQTM4WV76Z0Y6M4P4
{"ts":"2025-12-04T19:57:18.186Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"5445525a-e1f9-4a11-9ced-653cf94dcd0c","stage":"booking","correlationId":"booking-created:98eb7afe8e780cadb1923afd"}
{"ts":"2025-12-04T20:13:49.151Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"31942911-397a-4ffb-bc6c-b91deb7031c1","stage":"booking","correlationId":"booking-created:8ed1a098a75673c64d876e56","attempts":1}
üìÖ Processing booking created for customer: RABD8GC0GSECA1ZVPBCGFYD6P4
Full booking data: {
  "id": "1abfr9qy9szrti",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2026-01-03T18:00:00Z",
  "created_at": "2025-12-04T20:13:45Z",
  "updated_at": "2025-12-04T20:13:45Z",
  "customer_id": "RABD8GC0GSECA1ZVPBCGFYD6P4",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "RABD8GC0GSECA1ZVPBCGFYD6P4",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMoZGdZlg-iKWTDu",
      "any_team_member": false,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1764609601083,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Paige Berglund
üéâ First booking detected for customer: RABD8GC0GSECA1ZVPBCGFYD6P4
   Name: Paige Berglund
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer RABD8GC0GSECA1ZVPBCGFYD6P4...
Error getting custom attributes for customer RABD8GC0GSECA1ZVPBCGFYD6P4: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: RABD8GC0GSECA1ZVPBCGFYD6P4
{"ts":"2025-12-04T20:13:50.669Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"31942911-397a-4ffb-bc6c-b91deb7031c1","stage":"booking","correlationId":"booking-created:8ed1a098a75673c64d876e56"}
{"ts":"2025-12-04T20:19:33.566Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"97da1208-d821-490b-b437-51f954c286b9","stage":"payment","correlationId":"payment-updated:16012f558fad7f891bdd7d83","attempts":1}
üí∞ Processing payment completion for customer: KC2Q9C3SD6Q7RVFRDG70ZZYE4G
   Payment source_type: CASH
   Payment tender_types: []
üéâ First payment completed for customer: Lea Inbody
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Lea Inbody, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Lea Inbody
   - Email: leainbody@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: KC2Q9C3SD6Q7RVFRDG70ZZYE4G
{"ts":"2025-12-04T20:19:34.159Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"97da1208-d821-490b-b437-51f954c286b9","stage":"payment","correlationId":"payment-updated:16012f558fad7f891bdd7d83"}
{"ts":"2025-12-04T20:23:04.765Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"5bd30a8d-5d9e-4948-a41f-5cd4dfadcdff","stage":"customer_ingest","correlationId":"customer-created:995598116553fc3979224397","attempts":1}
üì• Received customer data: {
  "id": "N19F8CFJY29DP6CSRJRKT4V76C",
  "address": {
    "country": "US"
  },
  "version": 0,
  "group_ids": [
    "LT4ZHFBQQYB2N.APPOINTMENTS"
  ],
  "created_at": "2025-12-04T20:23:00.699Z",
  "given_name": "Vesa",
  "updated_at": "2025-12-04T20:23:00Z",
  "family_name": "Muriqi",
  "preferences": {
    "email_unsubscribed": false
  },
  "phone_number": "+41767297164",
  "email_address": "muriqi.vesa@gmail.com",
  "creation_source": "APPOINTMENTS"
}
üë§ Processing customer creation: N19F8CFJY29DP6CSRJRKT4V76C
üìç IP Address: unknown
üìß Email: muriqi.vesa@gmail.com
üìû Phone: +41767297164
üë§ Name: Vesa Muriqi
‚ö†Ô∏è Suspicious IP activity detected: unknown used by 142 customers
‚ö†Ô∏è Suspicious activity detected for customer N19F8CFJY29DP6CSRJRKT4V76C, flagging for review
üéâ New customer detected: N19F8CFJY29DP6CSRJRKT4V76C
‚úÖ Customer added to database as NEW (temporary mark)
   - Will check for referral code when they book
   - Will give gift card on first booking if code found
‚úÖ Verification: Customer found in DB: true
{"ts":"2025-12-04T20:23:05.302Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"5bd30a8d-5d9e-4948-a41f-5cd4dfadcdff","stage":"customer_ingest","correlationId":"customer-created:995598116553fc3979224397"}
{"ts":"2025-12-04T20:23:07.593Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"2458d409-e3c0-412d-9d0a-51836b491e9a","stage":"booking","correlationId":"booking-created:6f15efde4a6ffd5d371f706d","attempts":1}
üìÖ Processing booking created for customer: N19F8CFJY29DP6CSRJRKT4V76C
Full booking data: {
  "id": "kzlieh6k4i11ms",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-05T01:50:00Z",
  "created_at": "2025-12-04T20:23:04Z",
  "updated_at": "2025-12-04T20:23:04Z",
  "customer_id": "N19F8CFJY29DP6CSRJRKT4V76C",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "N19F8CFJY29DP6CSRJRKT4V76C",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMMCVDJoKh3ZkfFo",
      "any_team_member": true,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1764609601083,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    },
    {
      "team_member_id": "TMMCVDJoKh3ZkfFo",
      "any_team_member": true,
      "duration_minutes": 10,
      "intermission_minutes": 0,
      "service_variation_id": "6F6F3OAFJSOEN3X7HSXYIVQC",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "6F6F3OAFJSOEN3X7HSXYIVQC"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Vesa Muriqi
üéâ First booking detected for customer: N19F8CFJY29DP6CSRJRKT4V76C
   Name: Vesa Muriqi
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer N19F8CFJY29DP6CSRJRKT4V76C...
Error getting custom attributes for customer N19F8CFJY29DP6CSRJRKT4V76C: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: N19F8CFJY29DP6CSRJRKT4V76C
{"ts":"2025-12-04T20:23:08.009Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"2458d409-e3c0-412d-9d0a-51836b491e9a","stage":"booking","correlationId":"booking-created:6f15efde4a6ffd5d371f706d"}
{"ts":"2025-12-04T20:25:30.319Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"63ea7121-38f7-47c4-99d3-530b9330b578","stage":"booking","correlationId":"booking-created:cae8477713935c6a0a724f27","attempts":1}
üìÖ Processing booking created for customer: X8S9JTWKHFD92JA0AQBBCXQ3JC
Full booking data: {
  "id": "e5mp8369y5it7n",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-17T17:00:00Z",
  "created_at": "2025-12-04T20:25:27Z",
  "updated_at": "2025-12-04T20:25:27Z",
  "customer_id": "X8S9JTWKHFD92JA0AQBBCXQ3JC",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMQPbDVvvOCLwqsy"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMOscywuGXO2VURY",
      "any_team_member": false,
      "duration_minutes": 140,
      "intermission_minutes": 0,
      "service_variation_id": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "service_variation_version": 1764783981722,
      "service_variation_client_id": "CJI5WHOAKSFTASYPJ4MSYZLS"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Mahk Esfahani 
üéâ First booking detected for customer: X8S9JTWKHFD92JA0AQBBCXQ3JC
   Name: Mahk Esfahani 
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer X8S9JTWKHFD92JA0AQBBCXQ3JC...
Error getting custom attributes for customer X8S9JTWKHFD92JA0AQBBCXQ3JC: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: X8S9JTWKHFD92JA0AQBBCXQ3JC
{"ts":"2025-12-04T20:25:30.907Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"63ea7121-38f7-47c4-99d3-530b9330b578","stage":"booking","correlationId":"booking-created:cae8477713935c6a0a724f27"}
{"ts":"2025-12-04T20:26:51.505Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"b1a4b4d9-ed49-478b-bb1e-32c93992ab37","stage":"booking","correlationId":"booking-created:4d73d4c169bfc39dae656f30","attempts":1}
üìÖ Processing booking created for customer: F9WGV2SAPN21151X3F8WR9WHJ8
Full booking data: {
  "id": "sd1oxmr1bxn8yu",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-06T18:00:00Z",
  "created_at": "2025-12-04T20:26:47Z",
  "updated_at": "2025-12-04T20:26:47Z",
  "customer_id": "F9WGV2SAPN21151X3F8WR9WHJ8",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "F9WGV2SAPN21151X3F8WR9WHJ8",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TM-zXe9fXe4axYWn",
      "any_team_member": true,
      "duration_minutes": 140,
      "intermission_minutes": 0,
      "service_variation_id": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "service_variation_version": 1764783981722,
      "service_variation_client_id": "CJI5WHOAKSFTASYPJ4MSYZLS"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Katia Smith
Error retrieving Square customer F9WGV2SAPN21151X3F8WR9WHJ8: Response status code was not ok: 401.
Square API errors: [
  {
    "category": "AUTHENTICATION_ERROR",
    "code": "UNAUTHORIZED",
    "detail": "This request could not be authorized."
  }
]
üéâ First booking detected for customer: F9WGV2SAPN21151X3F8WR9WHJ8
   Name: Katia Smith
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer F9WGV2SAPN21151X3F8WR9WHJ8...
Error getting custom attributes for customer F9WGV2SAPN21151X3F8WR9WHJ8: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: F9WGV2SAPN21151X3F8WR9WHJ8
{"ts":"2025-12-04T20:26:52.945Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"b1a4b4d9-ed49-478b-bb1e-32c93992ab37","stage":"booking","correlationId":"booking-created:4d73d4c169bfc39dae656f30"}
{"ts":"2025-12-04T20:31:19.327Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"55259b17-e8a1-4c1f-8498-ef0aa1d0208c","stage":"booking","correlationId":"booking-created:811830a110e604ab96410cf2","attempts":1}
üìÖ Processing booking created for customer: 5ATGNY1CDB5ZNJ61RJQAHB9TS0
Full booking data: {
  "id": "mza7j4p6luafuj",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-22T18:00:00Z",
  "created_at": "2025-12-04T20:31:16Z",
  "updated_at": "2025-12-04T20:31:16Z",
  "customer_id": "5ATGNY1CDB5ZNJ61RJQAHB9TS0",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMWAtQTYmZpwwxii"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMILsQUVwLkLzbVo",
      "any_team_member": false,
      "duration_minutes": 100,
      "intermission_minutes": 0,
      "service_variation_id": "BM556FTNFOTEHYVG4GPXAXFM",
      "service_variation_version": 1762893947284,
      "service_variation_client_id": "BM556FTNFOTEHYVG4GPXAXFM"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Akilah Hicks
üéâ First booking detected for customer: 5ATGNY1CDB5ZNJ61RJQAHB9TS0
   Name: Akilah Hicks
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 5ATGNY1CDB5ZNJ61RJQAHB9TS0...
Error getting custom attributes for customer 5ATGNY1CDB5ZNJ61RJQAHB9TS0: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 5ATGNY1CDB5ZNJ61RJQAHB9TS0
{"ts":"2025-12-04T20:31:20.043Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"55259b17-e8a1-4c1f-8498-ef0aa1d0208c","stage":"booking","correlationId":"booking-created:811830a110e604ab96410cf2"}
{"ts":"2025-12-04T20:52:53.029Z","level":"error","event":"giftcard.worker.loop_error","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","error":"Server has closed the connection.","stack":"PrismaClientKnownRequestError: Server has closed the connection.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-12-04T21:10:30.799Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"d05a48e6-05bc-4a38-81d2-2f46712651ba","stage":"booking","correlationId":"booking-created:172ba5deb435d967ac106de7","attempts":1}
üìÖ Processing booking created for customer: 33J73841RE1J9XEPB0JSABBYTG
Full booking data: {
  "id": "bnqqxkmu1nw8di",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-10T22:00:00Z",
  "created_at": "2025-12-04T20:54:52Z",
  "updated_at": "2025-12-04T20:54:52Z",
  "customer_id": "33J73841RE1J9XEPB0JSABBYTG",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMQPbDVvvOCLwqsy"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMMHlgFBIFbMTRap",
      "any_team_member": false,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1764609601083,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Laura Harris
üéâ First booking detected for customer: 33J73841RE1J9XEPB0JSABBYTG
   Name: Laura Harris
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 33J73841RE1J9XEPB0JSABBYTG...
Error getting custom attributes for customer 33J73841RE1J9XEPB0JSABBYTG: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 33J73841RE1J9XEPB0JSABBYTG
{"ts":"2025-12-04T21:10:31.496Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"d05a48e6-05bc-4a38-81d2-2f46712651ba","stage":"booking","correlationId":"booking-created:172ba5deb435d967ac106de7"}
{"ts":"2025-12-04T21:10:31.659Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"6bb41d54-a9b4-48b0-949b-b4467bb3f461","stage":"booking","correlationId":"booking-created:b6e48a200306a577b066e566","attempts":1}
üìÖ Processing booking created for customer: PHP1Q70HXKER5Y2EF1PJGYKRT0
Full booking data: {
  "id": "htzkqqroz3gfer",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-04T22:30:00Z",
  "created_at": "2025-12-04T21:03:08Z",
  "updated_at": "2025-12-04T21:03:08Z",
  "customer_id": "PHP1Q70HXKER5Y2EF1PJGYKRT0",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMQPbDVvvOCLwqsy"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMMHlgFBIFbMTRap",
      "any_team_member": false,
      "duration_minutes": 45,
      "intermission_minutes": 0,
      "service_variation_id": "VVA7G2UN7N2HUFMCW5LQOVHB",
      "service_variation_version": 1764783981722,
      "service_variation_client_id": "VVA7G2UN7N2HUFMCW5LQOVHB"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Maren Vanderkolk
üéâ First booking detected for customer: PHP1Q70HXKER5Y2EF1PJGYKRT0
   Name: Maren Vanderkolk
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer PHP1Q70HXKER5Y2EF1PJGYKRT0...
Error getting custom attributes for customer PHP1Q70HXKER5Y2EF1PJGYKRT0: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: PHP1Q70HXKER5Y2EF1PJGYKRT0
{"ts":"2025-12-04T21:10:32.124Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"6bb41d54-a9b4-48b0-949b-b4467bb3f461","stage":"booking","correlationId":"booking-created:b6e48a200306a577b066e566"}
{"ts":"2025-12-04T21:10:32.305Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"219b8fdf-754e-41f3-be00-582607c7e486","stage":"booking","correlationId":"booking-created:9627e6405fe1ec32f6350b73","attempts":1}
üìÖ Processing booking created for customer: JQZ82C24AH7MH64VAA7B20DAF8
Full booking data: {
  "id": "2bpch6ofb45elm",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-16T22:00:00Z",
  "created_at": "2025-12-04T21:09:51Z",
  "updated_at": "2025-12-04T21:09:51Z",
  "customer_id": "JQZ82C24AH7MH64VAA7B20DAF8",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "JQZ82C24AH7MH64VAA7B20DAF8",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMgsjtuk5cfKnstq",
      "any_team_member": false,
      "duration_minutes": 20,
      "intermission_minutes": 0,
      "service_variation_id": "HAJX45W3U2WUCCXM5MI24UEE",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "HAJX45W3U2WUCCXM5MI24UEE"
    },
    {
      "team_member_id": "TMgsjtuk5cfKnstq",
      "any_team_member": false,
      "duration_minutes": 110,
      "intermission_minutes": 0,
      "service_variation_id": "6TYOE67IDYTKHW2ZG6HKVZER",
      "service_variation_version": 1764801478862,
      "service_variation_client_id": "6TYOE67IDYTKHW2ZG6HKVZER"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Aida Geojayan
üéâ First booking detected for customer: JQZ82C24AH7MH64VAA7B20DAF8
   Name: Aida Geojayan
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer JQZ82C24AH7MH64VAA7B20DAF8...
Error getting custom attributes for customer JQZ82C24AH7MH64VAA7B20DAF8: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: JQZ82C24AH7MH64VAA7B20DAF8
{"ts":"2025-12-04T21:10:32.692Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"219b8fdf-754e-41f3-be00-582607c7e486","stage":"booking","correlationId":"booking-created:9627e6405fe1ec32f6350b73"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-12-04T21:28:11.607Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"5b59495f-f8c4-40af-a340-92988a887368","stage":"payment","correlationId":"payment-updated:943e07aba4c3ccbdb506ff4d","attempts":1}
üí∞ Processing payment completion for customer: D3DY5V4MY6KJK47R1N60YZSE58
   Payment source_type: CARD
   Payment tender_types: []
Customer D3DY5V4MY6KJK47R1N60YZSE58 already completed first payment
{"ts":"2025-12-04T21:28:12.007Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"5b59495f-f8c4-40af-a340-92988a887368","stage":"payment","correlationId":"payment-updated:943e07aba4c3ccbdb506ff4d"}
{"ts":"2025-12-04T21:28:12.169Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"75fb1c4b-8c8f-4f2c-9bf8-7aa7a9a327a7","stage":"payment","correlationId":"payment-updated:5d4546b0637b78fa76bad8f5","attempts":1}
üí∞ Processing payment completion for customer: D3DY5V4MY6KJK47R1N60YZSE58
   Payment source_type: CARD
   Payment tender_types: []
Customer D3DY5V4MY6KJK47R1N60YZSE58 already completed first payment
{"ts":"2025-12-04T21:28:12.302Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"75fb1c4b-8c8f-4f2c-9bf8-7aa7a9a327a7","stage":"payment","correlationId":"payment-updated:5d4546b0637b78fa76bad8f5"}
{"ts":"2025-12-04T21:28:12.461Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"51e51ef7-17e0-41ad-8eb6-70d6b2793d44","stage":"payment","correlationId":"payment-updated:e4aaafa0cc1468439a33323b","attempts":1}
üí∞ Processing payment completion for customer: D723A57SXXCJV27DN1BY3WDFQR
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Marina Jacobs
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Marina Jacobs, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Marina Jacobs
   - Email: m@marinajacobs.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: D723A57SXXCJV27DN1BY3WDFQR
{"ts":"2025-12-04T21:28:12.775Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"51e51ef7-17e0-41ad-8eb6-70d6b2793d44","stage":"payment","correlationId":"payment-updated:e4aaafa0cc1468439a33323b"}
{"ts":"2025-12-04T21:28:12.932Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"ff1d47c3-17a0-40bc-8026-0bef642a2da9","stage":"payment","correlationId":"payment-updated:552f70b8da56b8a85d1285be","attempts":1}
üí∞ Processing payment completion for customer: D723A57SXXCJV27DN1BY3WDFQR
   Payment source_type: CARD
   Payment tender_types: []
Customer D723A57SXXCJV27DN1BY3WDFQR already completed first payment
{"ts":"2025-12-04T21:28:13.067Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"ff1d47c3-17a0-40bc-8026-0bef642a2da9","stage":"payment","correlationId":"payment-updated:552f70b8da56b8a85d1285be"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-12-04T21:37:09.998Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"96d682cb-5c5c-452e-978b-de70f036d4c1","stage":"payment","correlationId":"payment-updated:e08393766012202b3acdafb4","attempts":1}
üí∞ Processing payment completion for customer: NRMZQZFG5FQF4T6QAPDD1GD0T0
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: SEDEF CEYLAN
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to SEDEF CEYLAN, skipping...
‚úÖ Referral code sent to new client:
   - Customer: SEDEF CEYLAN
   - Email: sedefbacinoglu@yahoo.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: NRMZQZFG5FQF4T6QAPDD1GD0T0
{"ts":"2025-12-04T21:37:10.595Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"96d682cb-5c5c-452e-978b-de70f036d4c1","stage":"payment","correlationId":"payment-updated:e08393766012202b3acdafb4"}
{"ts":"2025-12-04T21:37:10.753Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"d501da67-5a3c-4d10-9936-7b4d2c16cc21","stage":"payment","correlationId":"payment-updated:c1a4999fd2127e28c243d82e","attempts":1}
üí∞ Processing payment completion for customer: NRMZQZFG5FQF4T6QAPDD1GD0T0
   Payment source_type: CARD
   Payment tender_types: []
Customer NRMZQZFG5FQF4T6QAPDD1GD0T0 already completed first payment
{"ts":"2025-12-04T21:37:10.891Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"d501da67-5a3c-4d10-9936-7b4d2c16cc21","stage":"payment","correlationId":"payment-updated:c1a4999fd2127e28c243d82e"}
{"ts":"2025-12-04T21:37:11.048Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"cbdbf1a6-0cce-483b-98a4-2ff2ab4971b8","stage":"payment","correlationId":"payment-updated:a05fd5c3e7c6edb250fa3852","attempts":1}
üí∞ Processing payment completion for customer: YXZV1Y70R4WWW0K67B6JXBR37W
   Payment source_type: CARD
   Payment tender_types: []
Customer YXZV1Y70R4WWW0K67B6JXBR37W already completed first payment
{"ts":"2025-12-04T21:37:11.187Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"cbdbf1a6-0cce-483b-98a4-2ff2ab4971b8","stage":"payment","correlationId":"payment-updated:a05fd5c3e7c6edb250fa3852"}
{"ts":"2025-12-04T21:37:11.346Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"d9c7ae33-d9f0-4052-bf9a-d82485329924","stage":"payment","correlationId":"payment-updated:cc5c8e85e2cdb35302aa2a53","attempts":1}
üí∞ Processing payment completion for customer: YXZV1Y70R4WWW0K67B6JXBR37W
   Payment source_type: CARD
   Payment tender_types: []
Customer YXZV1Y70R4WWW0K67B6JXBR37W already completed first payment
{"ts":"2025-12-04T21:37:11.561Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"d9c7ae33-d9f0-4052-bf9a-d82485329924","stage":"payment","correlationId":"payment-updated:cc5c8e85e2cdb35302aa2a53"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-12-04T21:53:36.787Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"db560dff-9aff-4f5d-a7bd-564f7f1c2949","stage":"customer_ingest","correlationId":"customer-created:b6f64a4f30d6b32e51ac1282","attempts":1}
üì• Received customer data: {
  "id": "WS90HBE67QG5K5XCKFY9TK4B34",
  "address": {
    "country": "US",
    "address_line_1": "21 Forrest St"
  },
  "version": 0,
  "created_at": "2025-12-04T21:38:19.42Z",
  "given_name": "KC",
  "updated_at": "2025-12-04T21:38:19Z",
  "family_name": "Maxwell",
  "preferences": {
    "email_unsubscribed": false
  },
  "phone_number": "+14155313100",
  "email_address": "millvalleykc@gmail.com",
  "creation_source": "DIRECTORY"
}
üë§ Processing customer creation: WS90HBE67QG5K5XCKFY9TK4B34
üìç IP Address: unknown
üìß Email: millvalleykc@gmail.com
üìû Phone: +14155313100
üë§ Name: KC Maxwell
‚ö†Ô∏è Suspicious IP activity detected: unknown used by 143 customers
‚ö†Ô∏è Suspicious activity detected for customer WS90HBE67QG5K5XCKFY9TK4B34, flagging for review
üéâ New customer detected: WS90HBE67QG5K5XCKFY9TK4B34
‚úÖ Customer added to database as NEW (temporary mark)
   - Will check for referral code when they book
   - Will give gift card on first booking if code found
‚úÖ Verification: Customer found in DB: true
{"ts":"2025-12-04T21:53:37.415Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"db560dff-9aff-4f5d-a7bd-564f7f1c2949","stage":"customer_ingest","correlationId":"customer-created:b6f64a4f30d6b32e51ac1282"}
{"ts":"2025-12-04T21:53:37.575Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"190efcdb-d6cd-422f-bad1-75e902b46ccc","stage":"booking","correlationId":"booking-created:f321de7e728ca821796cd3f2","attempts":1}
üìÖ Processing booking created for customer: WS90HBE67QG5K5XCKFY9TK4B34
Full booking data: {
  "id": "nv7p71gzmgszup",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-04T22:30:00Z",
  "created_at": "2025-12-04T21:38:36Z",
  "updated_at": "2025-12-04T21:38:36Z",
  "customer_id": "WS90HBE67QG5K5XCKFY9TK4B34",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMQPbDVvvOCLwqsy"
  },
  "appointment_segments": [
    {
      "team_member_id": "TM9jDlRr_Hl4rdBB",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "XBUDIMNKOPC2XVG5YLIQ4RYS",
      "service_variation_version": 1764609577793,
      "service_variation_client_id": "XBUDIMNKOPC2XVG5YLIQ4RYS"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: KC Maxwell
üéâ First booking detected for customer: WS90HBE67QG5K5XCKFY9TK4B34
   Name: KC Maxwell
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer WS90HBE67QG5K5XCKFY9TK4B34...
Error getting custom attributes for customer WS90HBE67QG5K5XCKFY9TK4B34: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: WS90HBE67QG5K5XCKFY9TK4B34
{"ts":"2025-12-04T21:53:38.216Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"190efcdb-d6cd-422f-bad1-75e902b46ccc","stage":"booking","correlationId":"booking-created:f321de7e728ca821796cd3f2"}
{"ts":"2025-12-04T21:53:38.373Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"27e7caee-48c8-4f92-8804-9013f09e2015","stage":"booking","correlationId":"booking-created:0be43cbf79a4bf781781f721","attempts":1}
üìÖ Processing booking created for customer: YTSZ1P7GT9D1YCB5D278253TDW
Full booking data: {
  "id": "9qfdnr7rgsiveq",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-04T23:30:00Z",
  "created_at": "2025-12-04T21:39:25Z",
  "updated_at": "2025-12-04T21:39:25Z",
  "customer_id": "YTSZ1P7GT9D1YCB5D278253TDW",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMWAtQTYmZpwwxii"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMMCVDJoKh3ZkfFo",
      "any_team_member": false,
      "duration_minutes": 15,
      "intermission_minutes": 0,
      "service_variation_id": "KBHPHVKLJNAF223GMYIRUUH3",
      "service_variation_version": 1760895536505,
      "service_variation_client_id": "KBHPHVKLJNAF223GMYIRUUH3"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Kathrin Koz
‚ÑπÔ∏è Customer YTSZ1P7GT9D1YCB5D278253TDW already received signup bonus, not first booking
{"ts":"2025-12-04T21:53:38.513Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"27e7caee-48c8-4f92-8804-9013f09e2015","stage":"booking","correlationId":"booking-created:0be43cbf79a4bf781781f721"}
{"ts":"2025-12-04T21:53:38.668Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"84c64d1a-dbb3-4e0d-a695-129bbd213c68","stage":"booking","correlationId":"booking-created:c5790c10cd35206fe09295aa","attempts":1}
üìÖ Processing booking created for customer: 6PWWDDMANF1XGZKRS231N5JCP4
Full booking data: {
  "id": "zf21e9fc2kugqp",
  "source": "THIRD_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-13T23:00:00Z",
  "created_at": "2025-12-04T21:49:54Z",
  "updated_at": "2025-12-04T21:49:54Z",
  "customer_id": "6PWWDDMANF1XGZKRS231N5JCP4",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "6PWWDDMANF1XGZKRS231N5JCP4",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TM9jDlRr_Hl4rdBB",
      "any_team_member": true,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "HXLBKQC3DRE57DB7IK5RBYOB",
      "service_variation_version": 1758654327496,
      "service_variation_client_id": "HXLBKQC3DRE57DB7IK5RBYOB"
    },
    {
      "resource_ids": [
        "KAOXILA4CV7A23VRAACC4R66"
      ],
      "team_member_id": "TM9jDlRr_Hl4rdBB",
      "any_team_member": true,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "ZEAKNB35I37RMXNUBGWDZQIM",
      "service_variation_version": 1760895536505,
      "service_variation_client_id": "ZEAKNB35I37RMXNUBGWDZQIM"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Yousra El Hssaini
üéâ First booking detected for customer: 6PWWDDMANF1XGZKRS231N5JCP4
   Name: Yousra El Hssaini
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 6PWWDDMANF1XGZKRS231N5JCP4...
Error getting custom attributes for customer 6PWWDDMANF1XGZKRS231N5JCP4: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 6PWWDDMANF1XGZKRS231N5JCP4
{"ts":"2025-12-04T21:53:39.091Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"84c64d1a-dbb3-4e0d-a695-129bbd213c68","stage":"booking","correlationId":"booking-created:c5790c10cd35206fe09295aa"}
{"ts":"2025-12-04T22:05:32.761Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"246f8862-8df1-44f5-9e57-d0cdfd5db8aa","stage":"booking","correlationId":"booking-created:a605bfd4d42b75ce157852a9","attempts":1}
üìÖ Processing booking created for customer: E24350EDTN84TNM9CZ7FP2BVPC
Full booking data: {
  "id": "hjef3ir6boxcj0",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-08T17:00:00Z",
  "created_at": "2025-12-04T21:57:04Z",
  "updated_at": "2025-12-04T21:57:04Z",
  "customer_id": "E24350EDTN84TNM9CZ7FP2BVPC",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "E24350EDTN84TNM9CZ7FP2BVPC",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMVwAQUdLz6no-cB",
      "any_team_member": false,
      "duration_minutes": 100,
      "intermission_minutes": 0,
      "service_variation_id": "GSZZR45VJXB44NF4P4WXI5NB",
      "service_variation_version": 1764801478862,
      "service_variation_client_id": "GSZZR45VJXB44NF4P4WXI5NB"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Romy Balbul
üéâ First booking detected for customer: E24350EDTN84TNM9CZ7FP2BVPC
   Name: Romy Balbul
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer E24350EDTN84TNM9CZ7FP2BVPC...
Error getting custom attributes for customer E24350EDTN84TNM9CZ7FP2BVPC: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: E24350EDTN84TNM9CZ7FP2BVPC
{"ts":"2025-12-04T22:05:34.789Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"246f8862-8df1-44f5-9e57-d0cdfd5db8aa","stage":"booking","correlationId":"booking-created:a605bfd4d42b75ce157852a9"}
{"ts":"2025-12-04T22:05:34.978Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"e94a0597-b2de-4050-bd56-ac10efa3477c","stage":"payment","correlationId":"payment-updated:94e52ddf886d3a3aeb754cb4","attempts":1}
üí∞ Processing payment completion for customer: DHZ1B7SHTA4V6DPX92VZMA5JXC
   Payment source_type: CARD
   Payment tender_types: []
Customer DHZ1B7SHTA4V6DPX92VZMA5JXC already completed first payment
{"ts":"2025-12-04T22:05:35.436Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"e94a0597-b2de-4050-bd56-ac10efa3477c","stage":"payment","correlationId":"payment-updated:94e52ddf886d3a3aeb754cb4"}
{"ts":"2025-12-04T22:05:36.489Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"796e5ed9-982c-4f1a-80af-66b44aa71f8d","stage":"payment","correlationId":"payment-updated:feb9e65ea0fbcc621443d422","attempts":1}
üí∞ Processing payment completion for customer: DHZ1B7SHTA4V6DPX92VZMA5JXC
   Payment source_type: CARD
   Payment tender_types: []
Customer DHZ1B7SHTA4V6DPX92VZMA5JXC already completed first payment
{"ts":"2025-12-04T22:05:37.447Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"796e5ed9-982c-4f1a-80af-66b44aa71f8d","stage":"payment","correlationId":"payment-updated:feb9e65ea0fbcc621443d422"}
{"ts":"2025-12-04T22:17:57.167Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"97d2acbf-9efb-47ad-a7ca-54c01443e6a8","stage":"booking","correlationId":"booking-created:3b8cdedce7909544c1892ecb","attempts":1}
üìÖ Processing booking created for customer: QVE4HKZ24YCPJRS18R77W80XTG
Full booking data: {
  "id": "1e04qtxjlckonk",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-05T19:40:00Z",
  "created_at": "2025-12-04T22:17:54Z",
  "updated_at": "2025-12-04T22:17:54Z",
  "customer_id": "QVE4HKZ24YCPJRS18R77W80XTG",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMWAtQTYmZpwwxii"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMILsQUVwLkLzbVo",
      "any_team_member": false,
      "duration_minutes": 100,
      "intermission_minutes": 0,
      "service_variation_id": "BM556FTNFOTEHYVG4GPXAXFM",
      "service_variation_version": 1762893947284,
      "service_variation_client_id": "BM556FTNFOTEHYVG4GPXAXFM"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Sonali Sharma
‚ÑπÔ∏è Customer QVE4HKZ24YCPJRS18R77W80XTG already received signup bonus, not first booking
{"ts":"2025-12-04T22:17:57.599Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"97d2acbf-9efb-47ad-a7ca-54c01443e6a8","stage":"booking","correlationId":"booking-created:3b8cdedce7909544c1892ecb"}
{"ts":"2025-12-04T22:32:11.995Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"1e83513d-7436-4a96-8905-769c2166c2a8","stage":"payment","correlationId":"payment-updated:b9bb819e2fde2a65ee4722dc","attempts":1}
üí∞ Processing payment completion for customer: B0GJFR8WR9H20EN067QT7RVMHM
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Anne Murdoch
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Anne Murdoch, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Anne Murdoch
   - Email: annemurdoch@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: B0GJFR8WR9H20EN067QT7RVMHM
{"ts":"2025-12-04T22:32:13.156Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"1e83513d-7436-4a96-8905-769c2166c2a8","stage":"payment","correlationId":"payment-updated:b9bb819e2fde2a65ee4722dc"}
{"ts":"2025-12-04T22:32:15.702Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"4d1ff4d7-6f27-4cb1-b47b-f43922c94ab4","stage":"payment","correlationId":"payment-updated:0e305505b1414d3e9c7e1ba9","attempts":1}
üí∞ Processing payment completion for customer: B0GJFR8WR9H20EN067QT7RVMHM
   Payment source_type: CARD
   Payment tender_types: []
Customer B0GJFR8WR9H20EN067QT7RVMHM already completed first payment
{"ts":"2025-12-04T22:32:16.049Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"4d1ff4d7-6f27-4cb1-b47b-f43922c94ab4","stage":"payment","correlationId":"payment-updated:0e305505b1414d3e9c7e1ba9"}
{"ts":"2025-12-04T22:35:43.850Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"6927c092-30ea-42a7-bc94-04c09d78a371","stage":"customer_ingest","correlationId":"customer-created:8b0c6fba3ebec01ea9ccceb6","attempts":1}
üì• Received customer data: {
  "id": "PZJXFB903YVE1ZWPJQW5KVH6QG",
  "address": {
    "country": "US"
  },
  "version": 0,
  "group_ids": [
    "LT4ZHFBQQYB2N.APPOINTMENTS"
  ],
  "created_at": "2025-12-04T22:35:38.537Z",
  "given_name": "Stephanie",
  "updated_at": "2025-12-04T22:35:38Z",
  "family_name": "Baladi",
  "preferences": {
    "email_unsubscribed": false
  },
  "phone_number": "+16508632345",
  "email_address": "sbaladi@gmail.com",
  "creation_source": "APPOINTMENTS"
}
üë§ Processing customer creation: PZJXFB903YVE1ZWPJQW5KVH6QG
üìç IP Address: unknown
üìß Email: sbaladi@gmail.com
üìû Phone: +16508632345
üë§ Name: Stephanie Baladi
‚ö†Ô∏è Suspicious IP activity detected: unknown used by 144 customers
‚ö†Ô∏è Suspicious activity detected for customer PZJXFB903YVE1ZWPJQW5KVH6QG, flagging for review
üéâ New customer detected: PZJXFB903YVE1ZWPJQW5KVH6QG
‚úÖ Customer added to database as NEW (temporary mark)
   - Will check for referral code when they book
   - Will give gift card on first booking if code found
‚úÖ Verification: Customer found in DB: true
{"ts":"2025-12-04T22:35:44.458Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"6927c092-30ea-42a7-bc94-04c09d78a371","stage":"customer_ingest","correlationId":"customer-created:8b0c6fba3ebec01ea9ccceb6"}
{"ts":"2025-12-04T22:35:44.617Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"3578a6b0-42ea-48d2-9330-d7a1c302b5db","stage":"booking","correlationId":"booking-created:1845f872060a20542bd850fe","attempts":1}
üìÖ Processing booking created for customer: PZJXFB903YVE1ZWPJQW5KVH6QG
Full booking data: {
  "id": "xd1bcm5p04u3o1",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-05T21:50:00Z",
  "created_at": "2025-12-04T22:35:41Z",
  "updated_at": "2025-12-04T22:35:41Z",
  "customer_id": "PZJXFB903YVE1ZWPJQW5KVH6QG",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "PZJXFB903YVE1ZWPJQW5KVH6QG",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMOscywuGXO2VURY",
      "any_team_member": true,
      "duration_minutes": 140,
      "intermission_minutes": 0,
      "service_variation_id": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "service_variation_version": 1764783981722,
      "service_variation_client_id": "CJI5WHOAKSFTASYPJ4MSYZLS"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Stephanie Baladi
üéâ First booking detected for customer: PZJXFB903YVE1ZWPJQW5KVH6QG
   Name: Stephanie Baladi
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer PZJXFB903YVE1ZWPJQW5KVH6QG...
Error getting custom attributes for customer PZJXFB903YVE1ZWPJQW5KVH6QG: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: PZJXFB903YVE1ZWPJQW5KVH6QG
{"ts":"2025-12-04T22:35:45.152Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"3578a6b0-42ea-48d2-9330-d7a1c302b5db","stage":"booking","correlationId":"booking-created:1845f872060a20542bd850fe"}
{"ts":"2025-12-04T22:52:29.819Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"ba5a380c-1f3a-42b7-bed0-8d12f81f8be5","stage":"payment","correlationId":"payment-updated:22cd2469a98a2958e95ec0bc","attempts":1}
üí∞ Processing payment completion for customer: NEK855Y9FDF81V4VCHQCTZK8N8
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Kylee Self
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Kylee Self, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Kylee Self
   - Email: kylee.self@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: NEK855Y9FDF81V4VCHQCTZK8N8
{"ts":"2025-12-04T22:52:31.549Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"ba5a380c-1f3a-42b7-bed0-8d12f81f8be5","stage":"payment","correlationId":"payment-updated:22cd2469a98a2958e95ec0bc"}
{"ts":"2025-12-04T22:52:34.265Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"bc678a76-0801-4163-a27c-f4d5bc5f91f6","stage":"payment","correlationId":"payment-updated:ea2253774b41c431c922116c","attempts":1}
üí∞ Processing payment completion for customer: NEK855Y9FDF81V4VCHQCTZK8N8
   Payment source_type: CARD
   Payment tender_types: []
Customer NEK855Y9FDF81V4VCHQCTZK8N8 already completed first payment
{"ts":"2025-12-04T22:52:34.785Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"bc678a76-0801-4163-a27c-f4d5bc5f91f6","stage":"payment","correlationId":"payment-updated:ea2253774b41c431c922116c"}
{"ts":"2025-12-04T23:00:23.300Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"f87d2782-b95d-42f2-9d45-19641c4bf3e9","stage":"payment","correlationId":"payment-updated:9e1f666babfecd6b3c89de2a","attempts":1}
üí∞ Processing payment completion for customer: XTA6WFN33E8PDJ6W462ZJA21WG
   Payment source_type: CARD
   Payment tender_types: []
Customer XTA6WFN33E8PDJ6W462ZJA21WG already completed first payment
{"ts":"2025-12-04T23:00:24.325Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"f87d2782-b95d-42f2-9d45-19641c4bf3e9","stage":"payment","correlationId":"payment-updated:9e1f666babfecd6b3c89de2a"}
{"ts":"2025-12-04T23:06:31.793Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"7a525dde-101d-47e4-89f3-4898b78cf57f","stage":"customer_ingest","correlationId":"customer-created:4de357a91a480ebb5430c08e","attempts":1}
üì• Received customer data: {
  "id": "X4QXWB74K2SJHZXGZ0EJJ0NEFR",
  "address": {
    "country": "US"
  },
  "version": 0,
  "group_ids": [
    "LT4ZHFBQQYB2N.APPOINTMENTS"
  ],
  "created_at": "2025-12-04T23:06:25.625Z",
  "given_name": "G",
  "updated_at": "2025-12-04T23:06:25Z",
  "family_name": "Wood",
  "preferences": {
    "email_unsubscribed": false
  },
  "phone_number": "+14068498013",
  "email_address": "gilliancwood@gmail.com",
  "creation_source": "APPOINTMENTS"
}
üë§ Processing customer creation: X4QXWB74K2SJHZXGZ0EJJ0NEFR
üìç IP Address: unknown
üìß Email: gilliancwood@gmail.com
üìû Phone: +14068498013
üë§ Name: G Wood
‚ö†Ô∏è Suspicious IP activity detected: unknown used by 145 customers
‚ö†Ô∏è Suspicious activity detected for customer X4QXWB74K2SJHZXGZ0EJJ0NEFR, flagging for review
üéâ New customer detected: X4QXWB74K2SJHZXGZ0EJJ0NEFR
‚úÖ Customer added to database as NEW (temporary mark)
   - Will check for referral code when they book
   - Will give gift card on first booking if code found
‚úÖ Verification: Customer found in DB: true
{"ts":"2025-12-04T23:06:32.401Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"7a525dde-101d-47e4-89f3-4898b78cf57f","stage":"customer_ingest","correlationId":"customer-created:4de357a91a480ebb5430c08e"}
{"ts":"2025-12-04T23:06:32.566Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"5126c3c1-cfe6-4522-bf57-012bd3671583","stage":"booking","correlationId":"booking-created:b85a2fbc1668d723a230345e","attempts":1}
üìÖ Processing booking created for customer: PHP1Q70HXKER5Y2EF1PJGYKRT0
Full booking data: {
  "id": "nag9abehnhmn4e",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-18T20:00:00Z",
  "created_at": "2025-12-04T23:06:29Z",
  "updated_at": "2025-12-04T23:06:29Z",
  "customer_id": "PHP1Q70HXKER5Y2EF1PJGYKRT0",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMQPbDVvvOCLwqsy"
  },
  "appointment_segments": [
    {
      "team_member_id": "TM9jDlRr_Hl4rdBB",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "XBUDIMNKOPC2XVG5YLIQ4RYS",
      "service_variation_version": 1764609577793,
      "service_variation_client_id": "XBUDIMNKOPC2XVG5YLIQ4RYS"
    },
    {
      "resource_ids": [
        "VNDFB5HCSMOPZDVJ2ML6QOIJ"
      ],
      "team_member_id": "TM9jDlRr_Hl4rdBB",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "63PG6RLS2NHWRD5JRXEC74HN",
      "service_variation_version": 1760895536505,
      "service_variation_client_id": "VZLZVOWNIEIWAQ47FX67GQS4"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Maren Vanderkolk
üéâ First booking detected for customer: PHP1Q70HXKER5Y2EF1PJGYKRT0
   Name: Maren Vanderkolk
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer PHP1Q70HXKER5Y2EF1PJGYKRT0...
Error getting custom attributes for customer PHP1Q70HXKER5Y2EF1PJGYKRT0: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: PHP1Q70HXKER5Y2EF1PJGYKRT0
{"ts":"2025-12-04T23:06:33.066Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"5126c3c1-cfe6-4522-bf57-012bd3671583","stage":"booking","correlationId":"booking-created:b85a2fbc1668d723a230345e"}
{"ts":"2025-12-04T23:06:33.295Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"7e93ce51-a838-4375-b364-b96b77294bd6","stage":"booking","correlationId":"booking-created:c6e9fd12725ad4247e082d01","attempts":1}
üìÖ Processing booking created for customer: X4QXWB74K2SJHZXGZ0EJJ0NEFR
Full booking data: {
  "id": "0e3aa84l7gr7sd",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-09T00:30:00Z",
  "created_at": "2025-12-04T23:06:29Z",
  "updated_at": "2025-12-04T23:06:29Z",
  "customer_id": "X4QXWB74K2SJHZXGZ0EJJ0NEFR",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "X4QXWB74K2SJHZXGZ0EJJ0NEFR",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMNW4SIF7tjp4oM_",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "BRSIGZFOWC6F4ERPKX3CODLU",
      "service_variation_version": 1764801478862,
      "service_variation_client_id": "BRSIGZFOWC6F4ERPKX3CODLU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: G Wood
üéâ First booking detected for customer: X4QXWB74K2SJHZXGZ0EJJ0NEFR
   Name: G Wood
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer X4QXWB74K2SJHZXGZ0EJJ0NEFR...
Error getting custom attributes for customer X4QXWB74K2SJHZXGZ0EJJ0NEFR: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: X4QXWB74K2SJHZXGZ0EJJ0NEFR
{"ts":"2025-12-04T23:06:33.793Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"7e93ce51-a838-4375-b364-b96b77294bd6","stage":"booking","correlationId":"booking-created:c6e9fd12725ad4247e082d01"}
{"ts":"2025-12-04T23:08:18.341Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"28cb37a0-fe01-4c72-bb00-4a3366916b9d","stage":"payment","correlationId":"payment-updated:561cd69e8282c8ecaf13071f","attempts":1}
üí∞ Processing payment completion for customer: 0QM3FB1M39C6YTTNCYFDEC3A8M
   Payment source_type: CARD
   Payment tender_types: []
Customer 0QM3FB1M39C6YTTNCYFDEC3A8M already completed first payment
{"ts":"2025-12-04T23:08:18.659Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"28cb37a0-fe01-4c72-bb00-4a3366916b9d","stage":"payment","correlationId":"payment-updated:561cd69e8282c8ecaf13071f"}
{"ts":"2025-12-04T23:08:23.492Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"8b9bc3ac-2935-4402-82b5-32a80472fd88","stage":"payment","correlationId":"payment-updated:ce268aa921d869b81abd98a2","attempts":1}
üí∞ Processing payment completion for customer: 0QM3FB1M39C6YTTNCYFDEC3A8M
   Payment source_type: CARD
   Payment tender_types: []
Customer 0QM3FB1M39C6YTTNCYFDEC3A8M already completed first payment
{"ts":"2025-12-04T23:08:23.766Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"8b9bc3ac-2935-4402-82b5-32a80472fd88","stage":"payment","correlationId":"payment-updated:ce268aa921d869b81abd98a2"}
{"ts":"2025-12-04T23:33:44.722Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"a7051029-14a8-4249-be85-6f10617fd0d0","stage":"payment","correlationId":"payment-updated:3645b84107255daa336ffb93","attempts":1}
üí∞ Processing payment completion for customer: PDHZ3Q9EYX53K1RM10GKZRNY64
   Payment source_type: CASH
   Payment tender_types: []
üéâ First payment completed for customer: sue ko
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to sue ko, skipping...
‚úÖ Referral code sent to new client:
   - Customer: sue ko
   - Email: kosuea@yahoo.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: PDHZ3Q9EYX53K1RM10GKZRNY64
{"ts":"2025-12-04T23:33:45.958Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"a7051029-14a8-4249-be85-6f10617fd0d0","stage":"payment","correlationId":"payment-updated:3645b84107255daa336ffb93"}
{"ts":"2025-12-04T23:34:54.781Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"85221f59-310e-4ddd-8554-87c866074ef7","stage":"payment","correlationId":"payment-updated:20efda3ef5b05910499d9a8f","attempts":1}
üí∞ Processing payment completion for customer: WS90HBE67QG5K5XCKFY9TK4B34
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: KC Maxwell
‚ùå Referrer not found for code: null
‚úÖ Generated new personal_code in name+ID format: KC9434
‚ùå Error creating/loading gift card for KC Maxwell: Response status code was not ok: 401.
Square API errors: [
  {
    "category": "AUTHENTICATION_ERROR",
    "code": "UNAUTHORIZED",
    "detail": "This request could not be authorized."
  }
]
‚ùå Failed to create referrer gift card
Error upserting custom attribute "square:a3dde506-f69e-48e4-a98a-004c1822d3ad" for customer WS90HBE67QG5K5XCKFY9TK4B34: Response status code was not ok: 401.
Square API errors: [
  {
    "category": "AUTHENTICATION_ERROR",
    "code": "UNAUTHORIZED",
    "detail": "This request could not be authorized."
  }
]
Error appending referral note for customer WS90HBE67QG5K5XCKFY9TK4B34: Response status code was not ok: 401.
Square API errors: [
  {
    "category": "AUTHENTICATION_ERROR",
    "code": "UNAUTHORIZED",
    "detail": "This request could not be authorized."
  }
]
‚ùå Error sending referral email to millvalleykc@gmail.com: Unauthorized
SendGrid error details: {
  errors: [
    {
      message: 'The provided authorization grant is invalid, expired, or revoked',
      field: null,
      help: null
    }
  ]
}
‚ö†Ô∏è Analytics operation "notification_event" failed: 
Invalid `prisma.notificationEvent.create()` invocation in
/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/analytics-service.js:164:39

  161 return runAnalyticsOperation(
  162   'notification_event',
  163   async () => {
‚Üí 164     return prisma.notificationEvent.create({
            data: {
              channel: "EMAIL",
              templateType: "REFERRAL_INVITE",
              status: "failed",
              createdAt: new Date("2025-12-04T23:34:56.337Z"),
              errorCode: 401,
                         ~~~
              errorMessage: "Unauthorized",
              metadata: {
                email: "millvalleykc@gmail.com",
                referralCode: "KC9434",
                referralUrl: "https://referral-system-salon-fbbq6x1wt-umis-projects-e802f152.vercel.app/ref/KC9434",
                suppressionGroupId: 28008
              }
            }
          })

Argument `errorCode`: Invalid value provided. Expected String or Null, provided Int.
‚ùå Failed to send email: Unauthorized
‚ÑπÔ∏è SMS sending disabled. Would send referral link to +14155313100
‚è∏Ô∏è SMS sending disabled (skipped sending to +14155313100)
üìß Referral code generated and sent:
   - Customer: KC Maxwell
   - Email: millvalleykc@gmail.com
   - Referral Code: KC9434
   - Referral URL: https://referral-system-salon-fbbq6x1wt-umis-projects-e802f152.vercel.app/ref/KC9434
   - Gift Card ID: null
   - Status: Customer is now a referrer
‚úÖ Referral code sent to new client:
   - Customer: KC Maxwell
   - Email: millvalleykc@gmail.com
   - Referral Code: KC9434
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: WS90HBE67QG5K5XCKFY9TK4B34
{"ts":"2025-12-04T23:34:56.570Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"85221f59-310e-4ddd-8554-87c866074ef7","stage":"payment","correlationId":"payment-updated:20efda3ef5b05910499d9a8f"}
{"ts":"2025-12-04T23:34:58.854Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"c80a9583-5e54-41fc-8af3-871bc0050acb","stage":"payment","correlationId":"payment-updated:924a18e1aa17e9047df3589d","attempts":1}
üí∞ Processing payment completion for customer: WS90HBE67QG5K5XCKFY9TK4B34
   Payment source_type: CARD
   Payment tender_types: []
Customer WS90HBE67QG5K5XCKFY9TK4B34 already completed first payment
{"ts":"2025-12-04T23:34:58.986Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"c80a9583-5e54-41fc-8af3-871bc0050acb","stage":"payment","correlationId":"payment-updated:924a18e1aa17e9047df3589d"}
{"ts":"2025-12-04T23:37:13.412Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"00624bad-abb2-4492-80c7-4cac938c0792","stage":"booking","correlationId":"booking-created:23d1e5d31747861a7f552a81","attempts":1}
üìÖ Processing booking created for customer: NQ2XM2FWWZP2YM25XWCZGTM0HR
Full booking data: {
  "id": "hgb177dqrmlxtb",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-05T23:30:00Z",
  "created_at": "2025-12-04T23:37:08Z",
  "updated_at": "2025-12-04T23:37:08Z",
  "customer_id": "NQ2XM2FWWZP2YM25XWCZGTM0HR",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMWAtQTYmZpwwxii"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMMCVDJoKh3ZkfFo",
      "any_team_member": false,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "HXLBKQC3DRE57DB7IK5RBYOB",
      "service_variation_version": 1758654327496,
      "service_variation_client_id": "HXLBKQC3DRE57DB7IK5RBYOB"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Alondra Flores
üéâ First booking detected for customer: NQ2XM2FWWZP2YM25XWCZGTM0HR
   Name: Alondra Flores
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer NQ2XM2FWWZP2YM25XWCZGTM0HR...
Error getting custom attributes for customer NQ2XM2FWWZP2YM25XWCZGTM0HR: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: NQ2XM2FWWZP2YM25XWCZGTM0HR
{"ts":"2025-12-04T23:37:14.589Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"00624bad-abb2-4492-80c7-4cac938c0792","stage":"booking","correlationId":"booking-created:23d1e5d31747861a7f552a81"}
{"ts":"2025-12-04T23:44:24.165Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"4056c7ff-9bd3-4fc4-b22d-9aac02e3e904","stage":"payment","correlationId":"payment-updated:1f5c7f5ee6a630339ceea0ba","attempts":1}
üí∞ Processing payment completion for customer: PHP1Q70HXKER5Y2EF1PJGYKRT0
   Payment source_type: CASH
   Payment tender_types: []
üéâ First payment completed for customer: Maren Vanderkolk
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Maren Vanderkolk, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Maren Vanderkolk
   - Email: Mraernein@yahoo.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: PHP1Q70HXKER5Y2EF1PJGYKRT0
{"ts":"2025-12-04T23:44:24.834Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"4056c7ff-9bd3-4fc4-b22d-9aac02e3e904","stage":"payment","correlationId":"payment-updated:1f5c7f5ee6a630339ceea0ba"}
{"ts":"2025-12-04T23:44:58.190Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"4288bd17-c603-4c58-bdfb-c39219e5018e","stage":"booking","correlationId":"booking-created:95f56514854e3bf7e78cea49","attempts":1}
üìÖ Processing booking created for customer: 4S77B84J2X58S9PRGRPEPC8XBM
Full booking data: {
  "id": "ya5kwbvnsue4db",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-13T21:30:00Z",
  "created_at": "2025-12-04T23:44:55Z",
  "updated_at": "2025-12-04T23:44:55Z",
  "customer_id": "4S77B84J2X58S9PRGRPEPC8XBM",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMWAtQTYmZpwwxii"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMVwAQUdLz6no-cB",
      "any_team_member": false,
      "duration_minutes": 100,
      "intermission_minutes": 0,
      "service_variation_id": "GSZZR45VJXB44NF4P4WXI5NB",
      "service_variation_version": 1764801478862,
      "service_variation_client_id": "GSZZR45VJXB44NF4P4WXI5NB"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Lilli Ouyang
üéâ First booking detected for customer: 4S77B84J2X58S9PRGRPEPC8XBM
   Name: Lilli Ouyang
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 4S77B84J2X58S9PRGRPEPC8XBM...
Error getting custom attributes for customer 4S77B84J2X58S9PRGRPEPC8XBM: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 4S77B84J2X58S9PRGRPEPC8XBM
{"ts":"2025-12-04T23:44:58.784Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"4288bd17-c603-4c58-bdfb-c39219e5018e","stage":"booking","correlationId":"booking-created:95f56514854e3bf7e78cea49"}
{"ts":"2025-12-04T23:45:34.735Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"b07d2ea6-5c15-42c0-93bb-1c914e54c0f5","stage":"booking","correlationId":"booking-created:899253d34f1a3ded0fb8df6b","attempts":1}
üìÖ Processing booking created for customer: 4S77B84J2X58S9PRGRPEPC8XBM
Full booking data: {
  "id": "0lbq8jkcaejels",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-13T21:30:00Z",
  "created_at": "2025-12-04T23:45:30Z",
  "updated_at": "2025-12-04T23:45:30Z",
  "customer_id": "4S77B84J2X58S9PRGRPEPC8XBM",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMWAtQTYmZpwwxii"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMdagA6g0F03A7_w",
      "any_team_member": false,
      "duration_minutes": 140,
      "intermission_minutes": 0,
      "service_variation_id": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "service_variation_version": 1764783981722,
      "service_variation_client_id": "CJI5WHOAKSFTASYPJ4MSYZLS"
    },
    {
      "team_member_id": "TMdagA6g0F03A7_w",
      "any_team_member": false,
      "duration_minutes": 5,
      "intermission_minutes": 0,
      "service_variation_id": "DBRXEHQPCF7V4APTHDQTZW62",
      "service_variation_version": 1762374620368,
      "service_variation_client_id": "DBRXEHQPCF7V4APTHDQTZW62"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Lilli Ouyang
üéâ First booking detected for customer: 4S77B84J2X58S9PRGRPEPC8XBM
   Name: Lilli Ouyang
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 4S77B84J2X58S9PRGRPEPC8XBM...
Error getting custom attributes for customer 4S77B84J2X58S9PRGRPEPC8XBM: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 4S77B84J2X58S9PRGRPEPC8XBM
{"ts":"2025-12-04T23:45:35.811Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"b07d2ea6-5c15-42c0-93bb-1c914e54c0f5","stage":"booking","correlationId":"booking-created:899253d34f1a3ded0fb8df6b"}
{"ts":"2025-12-04T23:46:14.245Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"b6d42fe2-cfdd-470a-a43c-f49f27561bf4","stage":"booking","correlationId":"booking-created:2235a03c123fd8f61cf561ef","attempts":1}
üìÖ Processing booking created for customer: 4S77B84J2X58S9PRGRPEPC8XBM
Full booking data: {
  "id": "1a1syuwklosykh",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-13T21:30:00Z",
  "created_at": "2025-12-04T23:46:09Z",
  "updated_at": "2025-12-04T23:46:09Z",
  "customer_id": "4S77B84J2X58S9PRGRPEPC8XBM",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMWAtQTYmZpwwxii"
  },
  "appointment_segments": [
    {
      "resource_ids": [
        "5OVIQ6GSSUXORACP6T7WBAQ7"
      ],
      "team_member_id": "TM-zXe9fXe4axYWn",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "ZEAKNB35I37RMXNUBGWDZQIM",
      "service_variation_version": 1760895536505,
      "service_variation_client_id": "ZEAKNB35I37RMXNUBGWDZQIM"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Lilli Ouyang
üéâ First booking detected for customer: 4S77B84J2X58S9PRGRPEPC8XBM
   Name: Lilli Ouyang
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 4S77B84J2X58S9PRGRPEPC8XBM...
Error getting custom attributes for customer 4S77B84J2X58S9PRGRPEPC8XBM: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 4S77B84J2X58S9PRGRPEPC8XBM
{"ts":"2025-12-04T23:46:15.389Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"b6d42fe2-cfdd-470a-a43c-f49f27561bf4","stage":"booking","correlationId":"booking-created:2235a03c123fd8f61cf561ef"}
{"ts":"2025-12-04T23:46:28.121Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"8d766a59-d675-45f9-9db4-44eb5049c52b","stage":"booking","correlationId":"booking-created:86a229e073b28896b6ca9994","attempts":1}
üìÖ Processing booking created for customer: 4S77B84J2X58S9PRGRPEPC8XBM
Full booking data: {
  "id": "fhn0nfnxyt21lu",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-13T21:30:00Z",
  "created_at": "2025-12-04T23:46:24Z",
  "updated_at": "2025-12-04T23:46:24Z",
  "customer_id": "4S77B84J2X58S9PRGRPEPC8XBM",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMWAtQTYmZpwwxii"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMMBgVwykMnOlumA",
      "any_team_member": false,
      "duration_minutes": 140,
      "intermission_minutes": 0,
      "service_variation_id": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "service_variation_version": 1764783981722,
      "service_variation_client_id": "CJI5WHOAKSFTASYPJ4MSYZLS"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Lilli Ouyang
üéâ First booking detected for customer: 4S77B84J2X58S9PRGRPEPC8XBM
   Name: Lilli Ouyang
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 4S77B84J2X58S9PRGRPEPC8XBM...
Error getting custom attributes for customer 4S77B84J2X58S9PRGRPEPC8XBM: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 4S77B84J2X58S9PRGRPEPC8XBM
{"ts":"2025-12-04T23:46:29.546Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"8d766a59-d675-45f9-9db4-44eb5049c52b","stage":"booking","correlationId":"booking-created:86a229e073b28896b6ca9994"}
{"ts":"2025-12-04T23:46:45.702Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"1d92d566-8f7c-460c-88cc-d75820598a9e","stage":"booking","correlationId":"booking-created:0aa1604c7f489caefbfc8918","attempts":1}
üìÖ Processing booking created for customer: ZM2VWNSKFTBH3MEX5VHEZG10M4
Full booking data: {
  "id": "2w8i5cwgw6fexv",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-23T20:00:00Z",
  "created_at": "2025-12-04T23:46:42Z",
  "updated_at": "2025-12-04T23:46:42Z",
  "customer_id": "ZM2VWNSKFTBH3MEX5VHEZG10M4",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMaVpirfZhWw5oM-"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMyUMvTJIj2HrHSg",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "JMTK5M2CY2W7WEXSTAJKAJ35",
      "service_variation_version": 1762893947284,
      "service_variation_client_id": "JMTK5M2CY2W7WEXSTAJKAJ35"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Kathleen Rowe
üéâ First booking detected for customer: ZM2VWNSKFTBH3MEX5VHEZG10M4
   Name: Kathleen Rowe
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer ZM2VWNSKFTBH3MEX5VHEZG10M4...
Error getting custom attributes for customer ZM2VWNSKFTBH3MEX5VHEZG10M4: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: ZM2VWNSKFTBH3MEX5VHEZG10M4
{"ts":"2025-12-04T23:46:46.604Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"1d92d566-8f7c-460c-88cc-d75820598a9e","stage":"booking","correlationId":"booking-created:0aa1604c7f489caefbfc8918"}
{"ts":"2025-12-04T23:48:56.218Z","level":"info","event":"giftcard.worker.job.start","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"ea07a34f-46cb-4265-b98d-cef8fbbb371c","stage":"booking","correlationId":"booking-created:a168223cbb97ad13df16a97b","attempts":1}
üìÖ Processing booking created for customer: 6XX0SYC6GDM8EAY70P8X6YEQWG
Full booking data: {
  "id": "p37amets8xljik",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-12T17:00:00Z",
  "created_at": "2025-12-04T23:48:54Z",
  "updated_at": "2025-12-04T23:48:54Z",
  "customer_id": "6XX0SYC6GDM8EAY70P8X6YEQWG",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMaVpirfZhWw5oM-"
  },
  "appointment_segments": [
    {
      "team_member_id": "TM9jDlRr_Hl4rdBB",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "XBUDIMNKOPC2XVG5YLIQ4RYS",
      "service_variation_version": 1764609577793,
      "service_variation_client_id": "XBUDIMNKOPC2XVG5YLIQ4RYS"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Kimberly syar
üéâ First booking detected for customer: 6XX0SYC6GDM8EAY70P8X6YEQWG
   Name: Kimberly syar
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 6XX0SYC6GDM8EAY70P8X6YEQWG...
Error getting custom attributes for customer 6XX0SYC6GDM8EAY70P8X6YEQWG: Response status code was not ok: 401.
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 6XX0SYC6GDM8EAY70P8X6YEQWG
{"ts":"2025-12-04T23:48:57.059Z","level":"info","event":"giftcard.worker.job.completed","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1","jobId":"ea07a34f-46cb-4265-b98d-cef8fbbb371c","stage":"booking","correlationId":"booking-created:a168223cbb97ad13df16a97b"}
{"ts":"2025-12-04T23:51:24.979Z","level":"info","event":"giftcard.worker.shutdown_requested","workerId":"2816e879-a440-4fb1-b8f0-10b0bd09eab1"}
{"ts":"2025-12-05T00:03:59.114Z","level":"info","event":"giftcard.worker.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","pollIntervalMs":2000,"circuitCooldownMs":60000}
{"ts":"2025-12-05T00:04:02.725Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"5e68b626-4d42-42ee-b06f-d04e7f00af2c","stage":"booking","correlationId":"booking-created:329f8bcd590d35aa7e18bafe","attempts":1}
üìÖ Processing booking created for customer: CHZWA7K9N6HB9NZAG5CB1A2A08
Full booking data: {
  "id": "09pomdevakprnz",
  "allDay": false,
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94133-4608",
    "addressLine1": "550 Pacific Ave",
    "addressLine2": "",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-01T19:00:00Z",
  "version": 3,
  "createdAt": "2025-11-28T04:47:47Z",
  "updatedAt": "2025-12-01T21:49:47Z",
  "customerId": "CHZWA7K9N6HB9NZAG5CB1A2A08",
  "locationId": "LNQKVBTQZN3EZ",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "CHZWA7K9N6HB9NZAG5CB1A2A08",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMoZGdZlg-iKWTDu",
      "anyTeamMember": false,
      "durationMinutes": 150,
      "serviceVariationId": "FKVQUFGSG7BFA55SUPGKTCWF",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1760141204155"
    },
    {
      "teamMemberId": "TMoZGdZlg-iKWTDu",
      "anyTeamMember": false,
      "durationMinutes": 20,
      "serviceVariationId": "HAJX45W3U2WUCCXM5MI24UEE",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1763586786564"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Mariko Dennis
üéâ First booking detected for customer: CHZWA7K9N6HB9NZAG5CB1A2A08
   Name: Mariko Dennis
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer CHZWA7K9N6HB9NZAG5CB1A2A08...
   Full custom attributes response: {}
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: CHZWA7K9N6HB9NZAG5CB1A2A08
{"ts":"2025-12-05T00:04:05.368Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"5e68b626-4d42-42ee-b06f-d04e7f00af2c","stage":"booking","correlationId":"booking-created:329f8bcd590d35aa7e18bafe"}
{"ts":"2025-12-05T00:04:05.639Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"13449f07-c958-4c31-b878-81cb08ff08b0","stage":"booking","correlationId":"booking-created:e2423471c1052ee8cc309d05","attempts":1}
üìÖ Processing booking created for customer: 883BQZ1MM0GA4MA1Q29F6Q92V8
Full booking data: {
  "id": "2it4cw2woe59b8",
  "allDay": false,
  "source": "FIRST_PARTY_BUYER",
  "status": "CANCELLED_BY_CUSTOMER",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94133-4608",
    "addressLine1": "550 Pacific Ave",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-01T19:00:00Z",
  "version": 2,
  "createdAt": "2025-10-23T04:35:00Z",
  "updatedAt": "2025-11-13T03:29:40Z",
  "customerId": "883BQZ1MM0GA4MA1Q29F6Q92V8",
  "locationId": "LNQKVBTQZN3EZ",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "883BQZ1MM0GA4MA1Q29F6Q92V8",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMoZGdZlg-iKWTDu",
      "anyTeamMember": false,
      "durationMinutes": 120,
      "serviceVariationId": "HXLBKQC3DRE57DB7IK5RBYOB",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1758654327496"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Lily Ulriksen
üéâ First booking detected for customer: 883BQZ1MM0GA4MA1Q29F6Q92V8
   Name: Lily Ulriksen
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 883BQZ1MM0GA4MA1Q29F6Q92V8...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "af5791f8-348a-422e-98d1-5e865121bb19"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-09-03T05:59:55.150Z",
      "createdAt": "2025-09-03T05:59:55.150Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="af5791f8-348a-422e-98d1-5e865121bb19"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "af5791f8-348a-422e-98d1-5e865121bb19"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 883BQZ1MM0GA4MA1Q29F6Q92V8
{"ts":"2025-12-05T00:04:06.163Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"13449f07-c958-4c31-b878-81cb08ff08b0","stage":"booking","correlationId":"booking-created:e2423471c1052ee8cc309d05"}
{"ts":"2025-12-05T00:04:06.398Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"6e5192fd-4502-44b4-8301-47d5df92a856","stage":"booking","correlationId":"booking-created:c6cd1939bb9280378373a4a8","attempts":1}
üìÖ Processing booking created for customer: CHZWA7K9N6HB9NZAG5CB1A2A08
Full booking data: {
  "id": "erfftmpt2a3cb8",
  "allDay": false,
  "source": "FIRST_PARTY_BUYER",
  "status": "CANCELLED_BY_CUSTOMER",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94133-4608",
    "addressLine1": "550 Pacific Ave",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-01T19:00:00Z",
  "version": 1,
  "createdAt": "2025-11-27T19:12:10Z",
  "updatedAt": "2025-11-28T04:47:11Z",
  "customerId": "CHZWA7K9N6HB9NZAG5CB1A2A08",
  "locationId": "LNQKVBTQZN3EZ",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "CHZWA7K9N6HB9NZAG5CB1A2A08",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMoZGdZlg-iKWTDu",
      "anyTeamMember": true,
      "durationMinutes": 120,
      "serviceVariationId": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1763586786564"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Mariko Dennis
üéâ First booking detected for customer: CHZWA7K9N6HB9NZAG5CB1A2A08
   Name: Mariko Dennis
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer CHZWA7K9N6HB9NZAG5CB1A2A08...
   Full custom attributes response: {}
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: CHZWA7K9N6HB9NZAG5CB1A2A08
{"ts":"2025-12-05T00:04:06.801Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"6e5192fd-4502-44b4-8301-47d5df92a856","stage":"booking","correlationId":"booking-created:c6cd1939bb9280378373a4a8"}
{"ts":"2025-12-05T00:04:07.004Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"bfa8e71c-1824-498f-9315-22b7d42c74ad","stage":"booking","correlationId":"booking-created:c7643d6b8e2faf98f423fff8","attempts":1}
üìÖ Processing booking created for customer: XERB3P3EVSTPSZVRMX379F28R8
Full booking data: {
  "id": "idjqf8lfdyamb4",
  "allDay": false,
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94123-3940",
    "addressLine1": "2266 Union St",
    "addressLine2": "",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-01T19:00:00Z",
  "version": 3,
  "createdAt": "2025-11-10T21:54:09Z",
  "updatedAt": "2025-12-01T20:52:56Z",
  "customerId": "XERB3P3EVSTPSZVRMX379F28R8",
  "locationId": "LT4ZHFBQQYB2N",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "XERB3P3EVSTPSZVRMX379F28R8",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TM1L5yPC-yKx6CyO",
      "anyTeamMember": false,
      "durationMinutes": 120,
      "serviceVariationId": "NCOIL6ZGDTCC7SO3IJHENCQ2",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1761597690235"
    },
    {
      "teamMemberId": "TM1L5yPC-yKx6CyO",
      "anyTeamMember": false,
      "durationMinutes": 20,
      "serviceVariationId": "HAJX45W3U2WUCCXM5MI24UEE",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1763586786564"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Katie Keitges
üéâ First booking detected for customer: XERB3P3EVSTPSZVRMX379F28R8
   Name: Katie Keitges
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer XERB3P3EVSTPSZVRMX379F28R8...
   Full custom attributes response: {}
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: XERB3P3EVSTPSZVRMX379F28R8
{"ts":"2025-12-05T00:04:07.737Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"bfa8e71c-1824-498f-9315-22b7d42c74ad","stage":"booking","correlationId":"booking-created:c7643d6b8e2faf98f423fff8"}
{"ts":"2025-12-05T00:04:07.940Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"5a272de6-c4c5-4e31-8d46-693fdae54648","stage":"booking","correlationId":"booking-created:955d7cfa2f7c47602f4eff40","attempts":1}
üìÖ Processing booking created for customer: ATF01XQWM5VT6FTF4ESV0RC3CG
Full booking data: {
  "id": "jocd54xs1mlww0",
  "allDay": false,
  "source": "THIRD_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94123-3940",
    "addressLine1": "2266 Union St",
    "addressLine2": "",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-01T19:00:00Z",
  "version": 4,
  "createdAt": "2025-11-27T01:19:33Z",
  "updatedAt": "2025-12-01T20:24:22Z",
  "customerId": "ATF01XQWM5VT6FTF4ESV0RC3CG",
  "locationId": "LT4ZHFBQQYB2N",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "ATF01XQWM5VT6FTF4ESV0RC3CG",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMMHlgFBIFbMTRap",
      "anyTeamMember": false,
      "durationMinutes": 100,
      "serviceVariationId": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1763586786564"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Jennifer Back
üéâ First booking detected for customer: ATF01XQWM5VT6FTF4ESV0RC3CG
   Name: Jennifer Back
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer ATF01XQWM5VT6FTF4ESV0RC3CG...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "af5791f8-348a-422e-98d1-5e865121bb19"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-11-09T02:42:22.375Z",
      "createdAt": "2025-11-09T02:42:22.375Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="af5791f8-348a-422e-98d1-5e865121bb19"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "af5791f8-348a-422e-98d1-5e865121bb19"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: ATF01XQWM5VT6FTF4ESV0RC3CG
{"ts":"2025-12-05T00:04:08.351Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"5a272de6-c4c5-4e31-8d46-693fdae54648","stage":"booking","correlationId":"booking-created:955d7cfa2f7c47602f4eff40"}
{"ts":"2025-12-05T00:04:08.549Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"169b0fce-c3a2-4301-b90e-265f44c64e0d","stage":"booking","correlationId":"booking-created:1f06f90c7d9596adab730757","attempts":1}
üìÖ Processing booking created for customer: MHW8NBVV1AH9K5BRS42G02ZSJM
Full booking data: {
  "id": "revxb36c78b8cw",
  "allDay": false,
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94133-4608",
    "addressLine1": "550 Pacific Ave",
    "addressLine2": "",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-01T19:00:00Z",
  "version": 2,
  "createdAt": "2025-11-25T22:34:35Z",
  "updatedAt": "2025-12-01T20:50:47Z",
  "customerId": "MHW8NBVV1AH9K5BRS42G02ZSJM",
  "locationId": "LNQKVBTQZN3EZ",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "MHW8NBVV1AH9K5BRS42G02ZSJM",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMEWAZHdtaiRR_Zs",
      "anyTeamMember": false,
      "durationMinutes": 120,
      "serviceVariationId": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1763586786564"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Corine Antoun
üéâ First booking detected for customer: MHW8NBVV1AH9K5BRS42G02ZSJM
   Name: Corine Antoun
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer MHW8NBVV1AH9K5BRS42G02ZSJM...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "sq0idp-0WpGrONcXfCcfav3Lkd9Jg:appointments-online-booking-blocking",
      "value": false,
      "version": 2,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-05-09T19:55:47.588Z",
      "createdAt": "2025-03-29T19:12:18.803Z"
    },
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "0826aee4-d259-434d-be44-511ac61b3629"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-05-09T04:55:07.905Z",
      "createdAt": "2025-05-09T04:55:07.905Z"
    }
  ]
}
   üìã Custom attribute: key="sq0idp-0WpGrONcXfCcfav3Lkd9Jg:appointments-online-booking-blocking", value="false"
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="0826aee4-d259-434d-be44-511ac61b3629"
   Custom attributes from Square: {
  "sq0idp-0WpGrONcXfCcfav3Lkd9Jg:appointments-online-booking-blocking": false,
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "0826aee4-d259-434d-be44-511ac61b3629"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: MHW8NBVV1AH9K5BRS42G02ZSJM
{"ts":"2025-12-05T00:04:09.144Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"169b0fce-c3a2-4301-b90e-265f44c64e0d","stage":"booking","correlationId":"booking-created:1f06f90c7d9596adab730757"}
{"ts":"2025-12-05T00:04:09.459Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"f34e5091-49fc-44af-8d9d-3c033bff12f3","stage":"booking","correlationId":"booking-created:d65defe6ef0da9f22a8e483e","attempts":1}
üìÖ Processing booking created for customer: 9CE709PP621PNJZVYGJFRS119C
Full booking data: {
  "id": "7kqf60dwq02s8p",
  "allDay": false,
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94123-3940",
    "addressLine1": "2266 Union St",
    "addressLine2": "",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-01T19:20:00Z",
  "version": 2,
  "createdAt": "2025-11-30T18:05:31Z",
  "updatedAt": "2025-12-01T21:23:31Z",
  "customerId": "9CE709PP621PNJZVYGJFRS119C",
  "locationId": "LT4ZHFBQQYB2N",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "9CE709PP621PNJZVYGJFRS119C",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMOscywuGXO2VURY",
      "anyTeamMember": false,
      "durationMinutes": 140,
      "serviceVariationId": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1763586786564"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Jessica Jones
üéâ First booking detected for customer: 9CE709PP621PNJZVYGJFRS119C
   Name: Jessica Jones
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 9CE709PP621PNJZVYGJFRS119C...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "af5791f8-348a-422e-98d1-5e865121bb19"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-06-17T01:25:15.590Z",
      "createdAt": "2025-06-17T01:25:15.590Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="af5791f8-348a-422e-98d1-5e865121bb19"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "af5791f8-348a-422e-98d1-5e865121bb19"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 9CE709PP621PNJZVYGJFRS119C
{"ts":"2025-12-05T00:04:09.904Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"f34e5091-49fc-44af-8d9d-3c033bff12f3","stage":"booking","correlationId":"booking-created:d65defe6ef0da9f22a8e483e"}
{"ts":"2025-12-05T00:04:10.140Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"4e24235f-066c-4630-9df4-b7cb2a08e43a","stage":"booking","correlationId":"booking-created:9593c7469c6652dd1bc58727","attempts":1}
üìÖ Processing booking created for customer: BH012Y7N886M70PQ37P0V26EVM
Full booking data: {
  "id": "6fq7sgmebt0stt",
  "allDay": false,
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "startAt": "2025-12-01T19:30:00Z",
  "version": 4,
  "createdAt": "2025-11-24T22:48:42Z",
  "updatedAt": "2025-12-01T21:33:42Z",
  "customerId": "BH012Y7N886M70PQ37P0V26EVM",
  "locationId": "LNQKVBTQZN3EZ",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "creatorType": "TEAM_MEMBER",
    "teamMemberId": "TMWAtQTYmZpwwxii"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMXiw38Bbb7XQUWI",
      "anyTeamMember": false,
      "durationMinutes": 120,
      "serviceVariationId": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1763586786564"
    },
    {
      "teamMemberId": "TMXiw38Bbb7XQUWI",
      "anyTeamMember": false,
      "durationMinutes": 5,
      "serviceVariationId": "DBRXEHQPCF7V4APTHDQTZW62",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1762374620368"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Francesca Misuraca
üéâ First booking detected for customer: BH012Y7N886M70PQ37P0V26EVM
   Name: Francesca Misuraca
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer BH012Y7N886M70PQ37P0V26EVM...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
      ],
      "version": 4,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-10-06T22:22:57.872Z",
      "createdAt": "2025-05-20T16:49:01.274Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: BH012Y7N886M70PQ37P0V26EVM
{"ts":"2025-12-05T00:04:10.620Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"4e24235f-066c-4630-9df4-b7cb2a08e43a","stage":"booking","correlationId":"booking-created:9593c7469c6652dd1bc58727"}
{"ts":"2025-12-05T00:04:10.789Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"6c807bad-3a71-4fe6-8dae-687c82f5a038","stage":"booking","correlationId":"booking-created:38b6907a2064eb1c8b143ec5","attempts":1}
üìÖ Processing booking created for customer: 9M72Y57P3VDWDHPYN8YGNRGB1R
Full booking data: {
  "id": "tckobolnna77s5",
  "allDay": false,
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94123-3940",
    "addressLine1": "2266 Union St",
    "addressLine2": "",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-01T19:30:00Z",
  "version": 2,
  "createdAt": "2025-11-30T17:05:15Z",
  "updatedAt": "2025-12-01T21:39:06Z",
  "customerId": "9M72Y57P3VDWDHPYN8YGNRGB1R",
  "locationId": "LT4ZHFBQQYB2N",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "9M72Y57P3VDWDHPYN8YGNRGB1R",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TM7_r-KmvY9xjnEU",
      "anyTeamMember": false,
      "durationMinutes": 150,
      "serviceVariationId": "FKVQUFGSG7BFA55SUPGKTCWF",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1760141204155"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Leezae Russell
‚ÑπÔ∏è Customer 9M72Y57P3VDWDHPYN8YGNRGB1R already received signup bonus, not first booking
{"ts":"2025-12-05T00:04:10.991Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"6c807bad-3a71-4fe6-8dae-687c82f5a038","stage":"booking","correlationId":"booking-created:38b6907a2064eb1c8b143ec5"}
{"ts":"2025-12-05T00:04:11.242Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"f4c70567-7fa5-451a-9a3e-ab6f1f041528","stage":"booking","correlationId":"booking-created:19d8ec0148d95d67f047f0ab","attempts":1}
üìÖ Processing booking created for customer: BH012Y7N886M70PQ37P0V26EVM
Full booking data: {
  "id": "87biq6ybzu6uu5",
  "allDay": false,
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "startAt": "2025-12-01T20:00:00Z",
  "version": 2,
  "createdAt": "2025-11-24T22:49:14Z",
  "updatedAt": "2025-12-01T21:34:17Z",
  "customerId": "BH012Y7N886M70PQ37P0V26EVM",
  "locationId": "LNQKVBTQZN3EZ",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "creatorType": "TEAM_MEMBER",
    "teamMemberId": "TMWAtQTYmZpwwxii"
  },
  "appointmentSegments": [
    {
      "resourceIds": [
        "5OVIQ6GSSUXORACP6T7WBAQ7"
      ],
      "teamMemberId": "TMVwAQUdLz6no-cB",
      "anyTeamMember": false,
      "durationMinutes": 90,
      "serviceVariationId": "ZEAKNB35I37RMXNUBGWDZQIM",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1760895536505"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Francesca Misuraca
üéâ First booking detected for customer: BH012Y7N886M70PQ37P0V26EVM
   Name: Francesca Misuraca
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer BH012Y7N886M70PQ37P0V26EVM...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
      ],
      "version": 4,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-10-06T22:22:57.872Z",
      "createdAt": "2025-05-20T16:49:01.274Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: BH012Y7N886M70PQ37P0V26EVM
{"ts":"2025-12-05T00:04:11.775Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"f4c70567-7fa5-451a-9a3e-ab6f1f041528","stage":"booking","correlationId":"booking-created:19d8ec0148d95d67f047f0ab"}
{"ts":"2025-12-05T00:04:12.000Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"bc180176-0ee4-4248-9dc4-dd7e62a76673","stage":"booking","correlationId":"booking-created:dca59fc6d80522cf4c199ea8","attempts":1}
üìÖ Processing booking created for customer: 1CS3MY35Y6G59MFHGY5V7W5C88
Full booking data: {
  "id": "bxtrw6tyypk57m",
  "allDay": false,
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "startAt": "2025-12-01T20:00:00Z",
  "version": 3,
  "createdAt": "2025-11-29T21:25:30Z",
  "updatedAt": "2025-12-01T22:39:02Z",
  "customerId": "1CS3MY35Y6G59MFHGY5V7W5C88",
  "locationId": "LT4ZHFBQQYB2N",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "creatorType": "TEAM_MEMBER",
    "teamMemberId": "TMQPbDVvvOCLwqsy"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMyUMvTJIj2HrHSg",
      "anyTeamMember": false,
      "durationMinutes": 90,
      "serviceVariationId": "JMTK5M2CY2W7WEXSTAJKAJ35",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1762893947284"
    },
    {
      "resourceIds": [
        "KAOXILA4CV7A23VRAACC4R66"
      ],
      "teamMemberId": "TMyUMvTJIj2HrHSg",
      "anyTeamMember": false,
      "durationMinutes": 90,
      "serviceVariationId": "63PG6RLS2NHWRD5JRXEC74HN",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1760895536505"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Kristen Juntunen
üéâ First booking detected for customer: 1CS3MY35Y6G59MFHGY5V7W5C88
   Name: Kristen Juntunen
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 1CS3MY35Y6G59MFHGY5V7W5C88...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
      ],
      "version": 2,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-04-28T04:22:31.821Z",
      "createdAt": "2025-02-18T23:18:07.936Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 1CS3MY35Y6G59MFHGY5V7W5C88
{"ts":"2025-12-05T00:04:12.526Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"bc180176-0ee4-4248-9dc4-dd7e62a76673","stage":"booking","correlationId":"booking-created:dca59fc6d80522cf4c199ea8"}
{"ts":"2025-12-05T00:04:12.765Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"3df9c50d-a746-4af4-8b48-8a500bf94055","stage":"booking","correlationId":"booking-created:9056dc2d7148964acff386fa","attempts":1}
üìÖ Processing booking created for customer: N60CZP4T697J8CQ505T2FW07M4
Full booking data: {
  "id": "wrcu3rlm2ysv02",
  "allDay": false,
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94123-3940",
    "addressLine1": "2266 Union St",
    "addressLine2": "",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-01T20:00:00Z",
  "version": 7,
  "createdAt": "2025-11-15T23:57:30Z",
  "updatedAt": "2025-12-01T21:25:02Z",
  "customerId": "N60CZP4T697J8CQ505T2FW07M4",
  "locationId": "LT4ZHFBQQYB2N",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "N60CZP4T697J8CQ505T2FW07M4",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMNW4SIF7tjp4oM_",
      "anyTeamMember": false,
      "durationMinutes": 90,
      "serviceVariationId": "BRSIGZFOWC6F4ERPKX3CODLU",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1762893947284"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Kelly DeNigris
üéâ First booking detected for customer: N60CZP4T697J8CQ505T2FW07M4
   Name: Kelly DeNigris
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer N60CZP4T697J8CQ505T2FW07M4...
   Full custom attributes response: {}
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: N60CZP4T697J8CQ505T2FW07M4
{"ts":"2025-12-05T00:04:13.212Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"3df9c50d-a746-4af4-8b48-8a500bf94055","stage":"booking","correlationId":"booking-created:9056dc2d7148964acff386fa"}
{"ts":"2025-12-05T00:04:13.373Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"b0a1867b-e774-4b01-a8a5-4ce5d07ba66a","stage":"booking","correlationId":"booking-created:496ad1d72e826be855f39d30","attempts":1}
üìÖ Processing booking created for customer: 76WCVQ11NES8AH2RFFKGEPJZFW
Full booking data: {
  "id": "9ksyrmhkg4mpnn",
  "allDay": false,
  "source": "FIRST_PARTY_MERCHANT",
  "status": "CANCELLED_BY_CUSTOMER",
  "startAt": "2025-12-01T20:10:00Z",
  "version": 4,
  "createdAt": "2025-10-06T19:36:51Z",
  "updatedAt": "2025-11-13T03:06:19Z",
  "customerId": "76WCVQ11NES8AH2RFFKGEPJZFW",
  "locationId": "LNQKVBTQZN3EZ",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "creatorType": "TEAM_MEMBER",
    "teamMemberId": "TMWAtQTYmZpwwxii"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMgsjtuk5cfKnstq",
      "anyTeamMember": false,
      "durationMinutes": 120,
      "serviceVariationId": "HXLBKQC3DRE57DB7IK5RBYOB",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1753294766066"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Eileen Kerrigan
üéâ First booking detected for customer: 76WCVQ11NES8AH2RFFKGEPJZFW
   Name: Eileen Kerrigan
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 76WCVQ11NES8AH2RFFKGEPJZFW...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "0826aee4-d259-434d-be44-511ac61b3629"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-04-10T17:56:30.929Z",
      "createdAt": "2025-04-10T17:56:30.929Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="0826aee4-d259-434d-be44-511ac61b3629"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "0826aee4-d259-434d-be44-511ac61b3629"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 76WCVQ11NES8AH2RFFKGEPJZFW
{"ts":"2025-12-05T00:04:13.826Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"b0a1867b-e774-4b01-a8a5-4ce5d07ba66a","stage":"booking","correlationId":"booking-created:496ad1d72e826be855f39d30"}
{"ts":"2025-12-05T00:04:14.060Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"3cefd640-0f16-4914-bf84-2ac8f001b9cb","stage":"booking","correlationId":"booking-created:da2cb0b4a1c6ada167f88cfe","attempts":1}
üìÖ Processing booking created for customer: 1CS3MY35Y6G59MFHGY5V7W5C88
Full booking data: {
  "id": "hflqqxuogniyr0",
  "allDay": false,
  "source": "FIRST_PARTY_BUYER",
  "status": "CANCELLED_BY_SELLER",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94123-3940",
    "addressLine1": "2266 Union St",
    "addressLine2": "",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-01T20:10:00Z",
  "version": 3,
  "createdAt": "2025-11-01T00:54:23Z",
  "updatedAt": "2025-11-29T21:24:54Z",
  "customerId": "1CS3MY35Y6G59MFHGY5V7W5C88",
  "locationId": "LT4ZHFBQQYB2N",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "1CS3MY35Y6G59MFHGY5V7W5C88",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMew76L_w3bra6AH",
      "anyTeamMember": false,
      "durationMinutes": 90,
      "serviceVariationId": "JMTK5M2CY2W7WEXSTAJKAJ35",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1762893947284"
    },
    {
      "resourceIds": [
        "KAOXILA4CV7A23VRAACC4R66"
      ],
      "teamMemberId": "TMyUMvTJIj2HrHSg",
      "anyTeamMember": false,
      "durationMinutes": 90,
      "serviceVariationId": "63PG6RLS2NHWRD5JRXEC74HN",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1760895536505"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Kristen Juntunen
üéâ First booking detected for customer: 1CS3MY35Y6G59MFHGY5V7W5C88
   Name: Kristen Juntunen
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 1CS3MY35Y6G59MFHGY5V7W5C88...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
      ],
      "version": 2,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-04-28T04:22:31.821Z",
      "createdAt": "2025-02-18T23:18:07.936Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 1CS3MY35Y6G59MFHGY5V7W5C88
{"ts":"2025-12-05T00:04:14.554Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"3cefd640-0f16-4914-bf84-2ac8f001b9cb","stage":"booking","correlationId":"booking-created:da2cb0b4a1c6ada167f88cfe"}
{"ts":"2025-12-05T00:04:14.781Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"df4dcb46-6316-491f-b8e4-59154d4d25b6","stage":"booking","correlationId":"booking-created:d2be4d8708cb581886596011","attempts":1}
üìÖ Processing booking created for customer: W1DTVZ0MJ4PYHHPFDQ47VN3G8C
Full booking data: {
  "id": "ooi600gwj5zw0i",
  "allDay": false,
  "source": "THIRD_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94133-4608",
    "addressLine1": "550 Pacific Ave",
    "addressLine2": "",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-01T20:10:00Z",
  "version": 2,
  "createdAt": "2025-11-26T15:43:46Z",
  "updatedAt": "2025-12-01T21:48:21Z",
  "customerId": "W1DTVZ0MJ4PYHHPFDQ47VN3G8C",
  "locationId": "LNQKVBTQZN3EZ",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "W1DTVZ0MJ4PYHHPFDQ47VN3G8C",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMgsjtuk5cfKnstq",
      "anyTeamMember": false,
      "durationMinutes": 110,
      "serviceVariationId": "6TYOE67IDYTKHW2ZG6HKVZER",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1762893947284"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Erin Page
üéâ First booking detected for customer: W1DTVZ0MJ4PYHHPFDQ47VN3G8C
   Name: Erin Page
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer W1DTVZ0MJ4PYHHPFDQ47VN3G8C...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "0826aee4-d259-434d-be44-511ac61b3629"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-06-04T17:27:48.819Z",
      "createdAt": "2025-06-04T17:27:48.819Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="0826aee4-d259-434d-be44-511ac61b3629"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "0826aee4-d259-434d-be44-511ac61b3629"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: W1DTVZ0MJ4PYHHPFDQ47VN3G8C
{"ts":"2025-12-05T00:04:15.274Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"df4dcb46-6316-491f-b8e4-59154d4d25b6","stage":"booking","correlationId":"booking-created:d2be4d8708cb581886596011"}
{"ts":"2025-12-05T00:04:15.438Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"202df9b0-a92d-4ede-81f5-1bdb6467a7d6","stage":"booking","correlationId":"booking-created:67c2dbdd06df750009672cf7","attempts":1}
üìÖ Processing booking created for customer: 3V3QZDAWCZAWAJHZ6K7WNSRB30
Full booking data: {
  "id": "g71r09xgu8upzw",
  "allDay": false,
  "source": "FIRST_PARTY_BUYER",
  "status": "CANCELLED_BY_CUSTOMER",
  "startAt": "2025-12-01T20:30:00Z",
  "version": 1,
  "createdAt": "2025-11-19T20:50:10Z",
  "updatedAt": "2025-11-19T20:50:52Z",
  "customerId": "3V3QZDAWCZAWAJHZ6K7WNSRB30",
  "locationId": "LNQKVBTQZN3EZ",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "3V3QZDAWCZAWAJHZ6K7WNSRB30",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMILsQUVwLkLzbVo",
      "anyTeamMember": false,
      "durationMinutes": 120,
      "serviceVariationId": "HXLBKQC3DRE57DB7IK5RBYOB",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1758654327496"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Maxsirley Campos
üéâ First booking detected for customer: 3V3QZDAWCZAWAJHZ6K7WNSRB30
   Name: Maxsirley Campos
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 3V3QZDAWCZAWAJHZ6K7WNSRB30...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "af5791f8-348a-422e-98d1-5e865121bb19"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-11-19T20:48:18.298Z",
      "createdAt": "2025-11-19T20:48:18.298Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="af5791f8-348a-422e-98d1-5e865121bb19"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "af5791f8-348a-422e-98d1-5e865121bb19"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 3V3QZDAWCZAWAJHZ6K7WNSRB30
{"ts":"2025-12-05T00:04:15.915Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"202df9b0-a92d-4ede-81f5-1bdb6467a7d6","stage":"booking","correlationId":"booking-created:67c2dbdd06df750009672cf7"}
{"ts":"2025-12-05T00:04:16.156Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"26b6a075-5b0b-4cd9-a095-3c598f64a893","stage":"booking","correlationId":"booking-created:60b88cebd3bf43b5704d59f5","attempts":1}
üìÖ Processing booking created for customer: R18V9R5A676DS04TX1VFEM7PKW
Full booking data: {
  "id": "zxc8891drlbwy0",
  "allDay": false,
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94133-4608",
    "addressLine1": "550 Pacific Ave",
    "addressLine2": "",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-01T20:30:00Z",
  "version": 4,
  "createdAt": "2025-11-22T20:15:21Z",
  "updatedAt": "2025-12-01T22:46:06Z",
  "customerId": "R18V9R5A676DS04TX1VFEM7PKW",
  "locationId": "LNQKVBTQZN3EZ",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "R18V9R5A676DS04TX1VFEM7PKW",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMILsQUVwLkLzbVo",
      "anyTeamMember": false,
      "durationMinutes": 45,
      "serviceVariationId": "XVYD33PWUOIDOBJYERR7FNXT",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1762374620368"
    },
    {
      "teamMemberId": "TMILsQUVwLkLzbVo",
      "anyTeamMember": false,
      "durationMinutes": 100,
      "serviceVariationId": "BM556FTNFOTEHYVG4GPXAXFM",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1762893947284"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Jael Berger
üéâ First booking detected for customer: R18V9R5A676DS04TX1VFEM7PKW
   Name: Jael Berger
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer R18V9R5A676DS04TX1VFEM7PKW...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "af5791f8-348a-422e-98d1-5e865121bb19"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-08-01T19:13:13.690Z",
      "createdAt": "2025-08-01T19:13:13.690Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="af5791f8-348a-422e-98d1-5e865121bb19"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "af5791f8-348a-422e-98d1-5e865121bb19"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: R18V9R5A676DS04TX1VFEM7PKW
{"ts":"2025-12-05T00:04:16.691Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"26b6a075-5b0b-4cd9-a095-3c598f64a893","stage":"booking","correlationId":"booking-created:60b88cebd3bf43b5704d59f5"}
{"ts":"2025-12-05T00:04:16.957Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"9f6b2e3c-b2fd-4a3f-af45-1835b65014b2","stage":"booking","correlationId":"booking-created:e40c7031496c96a16a48ef43","attempts":1}
üìÖ Processing booking created for customer: YTBM2Q2XV23WW25KR2W25CF934
Full booking data: {
  "id": "0887akgj77n5e0",
  "allDay": false,
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94123-3940",
    "addressLine1": "2266 Union St",
    "addressLine2": "",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-01T21:00:00Z",
  "version": 3,
  "createdAt": "2025-11-24T22:20:38Z",
  "updatedAt": "2025-12-01T22:50:36Z",
  "customerId": "YTBM2Q2XV23WW25KR2W25CF934",
  "locationId": "LT4ZHFBQQYB2N",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "YTBM2Q2XV23WW25KR2W25CF934",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMMHlgFBIFbMTRap",
      "anyTeamMember": false,
      "durationMinutes": 100,
      "serviceVariationId": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1763586786564"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: jacqueline baumann
üéâ First booking detected for customer: YTBM2Q2XV23WW25KR2W25CF934
   Name: jacqueline baumann
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer YTBM2Q2XV23WW25KR2W25CF934...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "c0f2ee04-4762-42c6-a593-a4e745a81c92"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-05-20T01:44:33.151Z",
      "createdAt": "2025-05-20T01:44:33.151Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="c0f2ee04-4762-42c6-a593-a4e745a81c92"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "c0f2ee04-4762-42c6-a593-a4e745a81c92"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: YTBM2Q2XV23WW25KR2W25CF934
{"ts":"2025-12-05T00:04:17.510Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"9f6b2e3c-b2fd-4a3f-af45-1835b65014b2","stage":"booking","correlationId":"booking-created:e40c7031496c96a16a48ef43"}
{"ts":"2025-12-05T00:04:17.875Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"f0c1ae7a-c0fe-4a1a-91d5-a766464418a6","stage":"booking","correlationId":"booking-created:9108525739ceffa997a8bf77","attempts":1}
üìÖ Processing booking created for customer: A820AC65FDKQ3NGCTH9ZRS08VM
Full booking data: {
  "id": "73w8mwqq15yev5",
  "allDay": false,
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94133-4608",
    "addressLine1": "550 Pacific Ave",
    "addressLine2": "",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-01T21:00:00Z",
  "version": 3,
  "createdAt": "2025-11-27T00:28:51Z",
  "updatedAt": "2025-12-01T22:50:02Z",
  "customerId": "A820AC65FDKQ3NGCTH9ZRS08VM",
  "locationId": "LNQKVBTQZN3EZ",
  "customerNote": "If an appointment with Anna on 12/1 or 12/2 open up, please add me to her appointment time as I am her regular. Thank you!",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "A820AC65FDKQ3NGCTH9ZRS08VM",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMEWAZHdtaiRR_Zs",
      "anyTeamMember": false,
      "durationMinutes": 120,
      "serviceVariationId": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1763586786564"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Jessica Jackson
üéâ First booking detected for customer: A820AC65FDKQ3NGCTH9ZRS08VM
   Name: Jessica Jackson
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer A820AC65FDKQ3NGCTH9ZRS08VM...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
      ],
      "version": 2,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-10-30T11:22:46.500Z",
      "createdAt": "2025-08-29T00:34:40.772Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: A820AC65FDKQ3NGCTH9ZRS08VM
{"ts":"2025-12-05T00:04:18.320Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"f0c1ae7a-c0fe-4a1a-91d5-a766464418a6","stage":"booking","correlationId":"booking-created:9108525739ceffa997a8bf77"}
{"ts":"2025-12-05T00:04:18.623Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"e2f8771c-1b8c-4d0d-856f-65f7aaa50393","stage":"booking","correlationId":"booking-created:d675d523cfcfff7a68e9a10c","attempts":1}
üìÖ Processing booking created for customer: 7QZA767PSXTMT2WP3EXAS22MZR
Full booking data: {
  "id": "vw24hjrlh8lkzx",
  "allDay": false,
  "source": "FIRST_PARTY_BUYER",
  "status": "CANCELLED_BY_CUSTOMER",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94123-3940",
    "addressLine1": "2266 Union St",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-01T21:00:00Z",
  "version": 1,
  "createdAt": "2025-11-06T22:22:21Z",
  "updatedAt": "2025-11-07T04:05:48Z",
  "customerId": "7QZA767PSXTMT2WP3EXAS22MZR",
  "locationId": "LT4ZHFBQQYB2N",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "7QZA767PSXTMT2WP3EXAS22MZR",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TM1L5yPC-yKx6CyO",
      "anyTeamMember": false,
      "durationMinutes": 120,
      "serviceVariationId": "NCOIL6ZGDTCC7SO3IJHENCQ2",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1761597690235"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Ayisha Jeter
üéâ First booking detected for customer: 7QZA767PSXTMT2WP3EXAS22MZR
   Name: Ayisha Jeter
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 7QZA767PSXTMT2WP3EXAS22MZR...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "a7b40271-729a-41aa-801b-fb1fffb83650"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-02-22T20:27:59.640Z",
      "createdAt": "2025-02-22T20:27:59.640Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="a7b40271-729a-41aa-801b-fb1fffb83650"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "a7b40271-729a-41aa-801b-fb1fffb83650"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 7QZA767PSXTMT2WP3EXAS22MZR
{"ts":"2025-12-05T00:04:19.274Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"e2f8771c-1b8c-4d0d-856f-65f7aaa50393","stage":"booking","correlationId":"booking-created:d675d523cfcfff7a68e9a10c"}
{"ts":"2025-12-05T00:04:19.467Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"20e5eafa-e3c3-44c5-9fa8-54834053c07c","stage":"booking","correlationId":"booking-created:e31ac9a9d6e420b92a015914","attempts":1}
üìÖ Processing booking created for customer: RZHSEFFD8PVJ11762PDMZNC8XM
Full booking data: {
  "id": "wusgwkcox1pm90",
  "allDay": false,
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94123-3940",
    "addressLine1": "2266 Union St",
    "addressLine2": "",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-01T21:00:00Z",
  "version": 2,
  "createdAt": "2025-11-25T18:06:32Z",
  "updatedAt": "2025-12-01T22:44:52Z",
  "customerId": "RZHSEFFD8PVJ11762PDMZNC8XM",
  "locationId": "LT4ZHFBQQYB2N",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "RZHSEFFD8PVJ11762PDMZNC8XM",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TM1L5yPC-yKx6CyO",
      "anyTeamMember": false,
      "durationMinutes": 120,
      "serviceVariationId": "NCOIL6ZGDTCC7SO3IJHENCQ2",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1762893947284"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Kacy Dorrity
üéâ First booking detected for customer: RZHSEFFD8PVJ11762PDMZNC8XM
   Name: Kacy Dorrity
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer RZHSEFFD8PVJ11762PDMZNC8XM...
   Full custom attributes response: {}
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: RZHSEFFD8PVJ11762PDMZNC8XM
{"ts":"2025-12-05T00:04:20.061Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"20e5eafa-e3c3-44c5-9fa8-54834053c07c","stage":"booking","correlationId":"booking-created:e31ac9a9d6e420b92a015914"}
{"ts":"2025-12-05T00:04:20.225Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"640e6504-bc7b-4f89-bb24-4fe05c3da857","stage":"booking","correlationId":"booking-created:2c4ccdf473f9b289e6f9d99c","attempts":1}
üìÖ Processing booking created for customer: W79MRAGVDX3E53BXPCEB9MQ0EM
Full booking data: {
  "id": "ywhqwri613jqk4",
  "allDay": false,
  "source": "FIRST_PARTY_MERCHANT",
  "status": "CANCELLED_BY_SELLER",
  "startAt": "2025-12-01T21:00:00Z",
  "version": 1,
  "createdAt": "2025-11-15T23:41:11Z",
  "updatedAt": "2025-11-25T17:39:58Z",
  "customerId": "W79MRAGVDX3E53BXPCEB9MQ0EM",
  "locationId": "LT4ZHFBQQYB2N",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "creatorType": "TEAM_MEMBER",
    "teamMemberId": "TMQPbDVvvOCLwqsy"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TM1L5yPC-yKx6CyO",
      "anyTeamMember": false,
      "durationMinutes": 120,
      "serviceVariationId": "NCOIL6ZGDTCC7SO3IJHENCQ2",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1762893947284"
    },
    {
      "teamMemberId": "TM1L5yPC-yKx6CyO",
      "anyTeamMember": false,
      "durationMinutes": 20,
      "serviceVariationId": "HAJX45W3U2WUCCXM5MI24UEE",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1762374620368"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Nichole Rosten
üéâ First booking detected for customer: W79MRAGVDX3E53BXPCEB9MQ0EM
   Name: Nichole Rosten
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer W79MRAGVDX3E53BXPCEB9MQ0EM...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
      ],
      "version": 3,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-07-30T03:04:24.951Z",
      "createdAt": "2025-05-17T19:40:12.430Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: W79MRAGVDX3E53BXPCEB9MQ0EM
{"ts":"2025-12-05T00:04:21.023Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"640e6504-bc7b-4f89-bb24-4fe05c3da857","stage":"booking","correlationId":"booking-created:2c4ccdf473f9b289e6f9d99c"}
{"ts":"2025-12-05T00:04:21.186Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"98205569-3088-4d42-b833-7afccedbdc3c","stage":"booking","correlationId":"booking-created:46d80734d177f41fdc04a69c","attempts":1}
üìÖ Processing booking created for customer: B1SD31A26YCWNJT9V2B4HGJCB0
Full booking data: {
  "id": "7dgjw5bsqn308t",
  "allDay": false,
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "startAt": "2025-12-01T21:30:00Z",
  "version": 3,
  "createdAt": "2025-12-01T21:30:14Z",
  "updatedAt": "2025-12-01T21:56:22Z",
  "customerId": "B1SD31A26YCWNJT9V2B4HGJCB0",
  "locationId": "LT4ZHFBQQYB2N",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "creatorType": "TEAM_MEMBER",
    "teamMemberId": "TMQPbDVvvOCLwqsy"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMOscywuGXO2VURY",
      "anyTeamMember": false,
      "durationMinutes": 15,
      "serviceVariationId": "KBHPHVKLJNAF223GMYIRUUH3",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1760895536505"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Emily Machado
üéâ First booking detected for customer: B1SD31A26YCWNJT9V2B4HGJCB0
   Name: Emily Machado
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer B1SD31A26YCWNJT9V2B4HGJCB0...
   Full custom attributes response: {}
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: B1SD31A26YCWNJT9V2B4HGJCB0
{"ts":"2025-12-05T00:04:21.733Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"98205569-3088-4d42-b833-7afccedbdc3c","stage":"booking","correlationId":"booking-created:46d80734d177f41fdc04a69c"}
{"ts":"2025-12-05T00:04:22.198Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"bd98c583-b5b1-4a32-b949-98dc47faf83e","stage":"booking","correlationId":"booking-created:f731dfc805dfbc7240d99b7e","attempts":1}
üìÖ Processing booking created for customer: 86AGBRF7HSX1METR7ZKN0C5JPR
Full booking data: {
  "id": "7uka5610aia3t1",
  "allDay": false,
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "startAt": "2025-12-01T21:30:00Z",
  "version": 3,
  "createdAt": "2025-12-01T20:04:14Z",
  "updatedAt": "2025-12-01T22:59:56Z",
  "customerId": "86AGBRF7HSX1METR7ZKN0C5JPR",
  "locationId": "LT4ZHFBQQYB2N",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "creatorType": "TEAM_MEMBER",
    "teamMemberId": "TMQPbDVvvOCLwqsy"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMNW4SIF7tjp4oM_",
      "anyTeamMember": false,
      "durationMinutes": 90,
      "serviceVariationId": "BRSIGZFOWC6F4ERPKX3CODLU",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1762893947284"
    },
    {
      "teamMemberId": "TMNW4SIF7tjp4oM_",
      "anyTeamMember": false,
      "durationMinutes": 15,
      "serviceVariationId": "KBHPHVKLJNAF223GMYIRUUH3",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1760895536505"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Isabelle Talebi
‚ÑπÔ∏è Customer 86AGBRF7HSX1METR7ZKN0C5JPR already received signup bonus, not first booking
{"ts":"2025-12-05T00:04:22.452Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"bd98c583-b5b1-4a32-b949-98dc47faf83e","stage":"booking","correlationId":"booking-created:f731dfc805dfbc7240d99b7e"}
{"ts":"2025-12-05T00:04:22.769Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"bf87188f-9a4a-4a0b-8b1e-0775924ad7a4","stage":"booking","correlationId":"booking-created:b70b3bd748d8a49cf89df749","attempts":1}
üìÖ Processing booking created for customer: HP0M7F82N752PTA1D9TECBDPC4
Full booking data: {
  "id": "aovyby3ne44r6b",
  "allDay": false,
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "startAt": "2025-12-01T21:30:00Z",
  "version": 2,
  "createdAt": "2025-11-30T19:29:31Z",
  "updatedAt": "2025-12-01T23:02:21Z",
  "customerId": "HP0M7F82N752PTA1D9TECBDPC4",
  "locationId": "LNQKVBTQZN3EZ",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "creatorType": "TEAM_MEMBER",
    "teamMemberId": "TMWAtQTYmZpwwxii"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMVwAQUdLz6no-cB",
      "anyTeamMember": false,
      "durationMinutes": 90,
      "serviceVariationId": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1763586786564"
    },
    {
      "teamMemberId": "TMVwAQUdLz6no-cB",
      "anyTeamMember": false,
      "durationMinutes": 10,
      "serviceVariationId": "HAJX45W3U2WUCCXM5MI24UEE",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1763586786564"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Kimia Rahmani
üéâ First booking detected for customer: HP0M7F82N752PTA1D9TECBDPC4
   Name: Kimia Rahmani
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer HP0M7F82N752PTA1D9TECBDPC4...
   Full custom attributes response: {}
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: HP0M7F82N752PTA1D9TECBDPC4
{"ts":"2025-12-05T00:04:23.333Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"bf87188f-9a4a-4a0b-8b1e-0775924ad7a4","stage":"booking","correlationId":"booking-created:b70b3bd748d8a49cf89df749"}
{"ts":"2025-12-05T00:04:23.562Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"92206121-e09f-4e47-92bd-7bcd663d8bae","stage":"booking","correlationId":"booking-created:c572eb71d7878d6982b3a67e","attempts":1}
üìÖ Processing booking created for customer: 3KV5MMQJFH1N33PATWDM9KN58C
Full booking data: {
  "id": "folmi517885nuh",
  "allDay": false,
  "source": "FIRST_PARTY_BUYER",
  "status": "CANCELLED_BY_CUSTOMER",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94133-4608",
    "addressLine1": "550 Pacific Ave",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-01T21:30:00Z",
  "version": 1,
  "createdAt": "2025-11-20T04:01:24Z",
  "updatedAt": "2025-11-26T05:09:43Z",
  "customerId": "3KV5MMQJFH1N33PATWDM9KN58C",
  "locationId": "LNQKVBTQZN3EZ",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "3KV5MMQJFH1N33PATWDM9KN58C",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "resourceIds": [
        "5OVIQ6GSSUXORACP6T7WBAQ7"
      ],
      "teamMemberId": "TMXiw38Bbb7XQUWI",
      "anyTeamMember": true,
      "durationMinutes": 90,
      "serviceVariationId": "ZEAKNB35I37RMXNUBGWDZQIM",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1760895536505"
    },
    {
      "teamMemberId": "TMXiw38Bbb7XQUWI",
      "anyTeamMember": true,
      "durationMinutes": 120,
      "serviceVariationId": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1763586786564"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Yangjee Macri
üéâ First booking detected for customer: 3KV5MMQJFH1N33PATWDM9KN58C
   Name: Yangjee Macri
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 3KV5MMQJFH1N33PATWDM9KN58C...
   Full custom attributes response: {}
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 3KV5MMQJFH1N33PATWDM9KN58C
{"ts":"2025-12-05T00:04:24.082Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"92206121-e09f-4e47-92bd-7bcd663d8bae","stage":"booking","correlationId":"booking-created:c572eb71d7878d6982b3a67e"}
{"ts":"2025-12-05T00:04:24.360Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"6c984049-2536-452f-8e59-de65464a6a4e","stage":"booking","correlationId":"booking-created:a859c5fc6b7283f2adf6411e","attempts":1}
üìÖ Processing booking created for customer: 3KV5MMQJFH1N33PATWDM9KN58C
Full booking data: {
  "id": "637tq9o572dz36",
  "allDay": false,
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94133-4608",
    "addressLine1": "550 Pacific Ave",
    "addressLine2": "",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-01T21:35:00Z",
  "version": 2,
  "createdAt": "2025-11-26T05:11:49Z",
  "updatedAt": "2025-12-02T00:01:01Z",
  "customerId": "3KV5MMQJFH1N33PATWDM9KN58C",
  "locationId": "LNQKVBTQZN3EZ",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "3KV5MMQJFH1N33PATWDM9KN58C",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "resourceIds": [
        "5OVIQ6GSSUXORACP6T7WBAQ7"
      ],
      "teamMemberId": "TMXiw38Bbb7XQUWI",
      "anyTeamMember": false,
      "durationMinutes": 90,
      "serviceVariationId": "ZEAKNB35I37RMXNUBGWDZQIM",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1760895536505"
    },
    {
      "teamMemberId": "TMXiw38Bbb7XQUWI",
      "anyTeamMember": false,
      "durationMinutes": 120,
      "serviceVariationId": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1763586786564"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Yangjee Macri
üéâ First booking detected for customer: 3KV5MMQJFH1N33PATWDM9KN58C
   Name: Yangjee Macri
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 3KV5MMQJFH1N33PATWDM9KN58C...
   Full custom attributes response: {}
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 3KV5MMQJFH1N33PATWDM9KN58C
{"ts":"2025-12-05T00:04:25.042Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"6c984049-2536-452f-8e59-de65464a6a4e","stage":"booking","correlationId":"booking-created:a859c5fc6b7283f2adf6411e"}
{"ts":"2025-12-05T00:04:25.358Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"6e099213-237d-4b60-8bd7-bbdb60d50ee6","stage":"booking","correlationId":"booking-created:4752601ea7476f9273988a47","attempts":1}
üìÖ Processing booking created for customer: HZJN3XW012X3EEPYRSXJFMP8R4
Full booking data: {
  "id": "qkleiarhcvfs40",
  "allDay": false,
  "source": "THIRD_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94133-4608",
    "addressLine1": "550 Pacific Ave",
    "addressLine2": "",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-01T21:50:00Z",
  "version": 2,
  "createdAt": "2025-12-01T01:58:28Z",
  "updatedAt": "2025-12-01T23:58:41Z",
  "customerId": "HZJN3XW012X3EEPYRSXJFMP8R4",
  "locationId": "LNQKVBTQZN3EZ",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "HZJN3XW012X3EEPYRSXJFMP8R4",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMoZGdZlg-iKWTDu",
      "anyTeamMember": false,
      "durationMinutes": 150,
      "serviceVariationId": "4QI3JWGEYQANKCGC36J3MYNB",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1760141204155"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Liz Jones
‚ÑπÔ∏è Customer HZJN3XW012X3EEPYRSXJFMP8R4 already received signup bonus, not first booking
{"ts":"2025-12-05T00:04:25.566Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"6e099213-237d-4b60-8bd7-bbdb60d50ee6","stage":"booking","correlationId":"booking-created:4752601ea7476f9273988a47"}
{"ts":"2025-12-05T00:04:25.757Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"c6e93c23-d318-4cf8-bf36-871913e9d5fa","stage":"booking","correlationId":"booking-created:9b7db8407d77d6f29bb1232f","attempts":1}
üìÖ Processing booking created for customer: TXKEEXS47V4VP6HYR224SMGVNR
Full booking data: {
  "id": "5od3p5g85cfhhe",
  "allDay": false,
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94133-4608",
    "addressLine1": "550 Pacific Ave",
    "addressLine2": "",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-01T22:00:00Z",
  "version": 3,
  "createdAt": "2025-11-23T03:37:47Z",
  "updatedAt": "2025-12-01T23:37:21Z",
  "customerId": "TXKEEXS47V4VP6HYR224SMGVNR",
  "locationId": "LNQKVBTQZN3EZ",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "TXKEEXS47V4VP6HYR224SMGVNR",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMgsjtuk5cfKnstq",
      "anyTeamMember": false,
      "durationMinutes": 110,
      "serviceVariationId": "6TYOE67IDYTKHW2ZG6HKVZER",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1762893947284"
    },
    {
      "teamMemberId": "TMgsjtuk5cfKnstq",
      "anyTeamMember": false,
      "durationMinutes": 10,
      "serviceVariationId": "6F6F3OAFJSOEN3X7HSXYIVQC",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1760895536505"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Sai Paspulati
üéâ First booking detected for customer: TXKEEXS47V4VP6HYR224SMGVNR
   Name: Sai Paspulati
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer TXKEEXS47V4VP6HYR224SMGVNR...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "0826aee4-d259-434d-be44-511ac61b3629"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-02-17T21:57:46.445Z",
      "createdAt": "2025-02-17T21:57:46.445Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="0826aee4-d259-434d-be44-511ac61b3629"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "0826aee4-d259-434d-be44-511ac61b3629"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: TXKEEXS47V4VP6HYR224SMGVNR
{"ts":"2025-12-05T00:04:26.367Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"c6e93c23-d318-4cf8-bf36-871913e9d5fa","stage":"booking","correlationId":"booking-created:9b7db8407d77d6f29bb1232f"}
{"ts":"2025-12-05T00:04:26.613Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"ac5e1403-768d-4485-b1a3-94a2fb623a73","stage":"booking","correlationId":"booking-created:1c7fd7dc6ff5c8957163fc78","attempts":1}
üìÖ Processing booking created for customer: Q18M3GTWMST22CEPJRJCVMVWNG
Full booking data: {
  "id": "tel7q47w5nizij",
  "allDay": false,
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "startAt": "2025-12-01T22:00:00Z",
  "version": 4,
  "createdAt": "2025-11-30T22:56:57Z",
  "updatedAt": "2025-12-01T23:58:31Z",
  "customerId": "Q18M3GTWMST22CEPJRJCVMVWNG",
  "locationId": "LT4ZHFBQQYB2N",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "creatorType": "TEAM_MEMBER",
    "teamMemberId": "TMQPbDVvvOCLwqsy"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TM7_r-KmvY9xjnEU",
      "anyTeamMember": false,
      "durationMinutes": 110,
      "serviceVariationId": "GJ5SRTYFV6ZCDI62TMSZP2OP",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1757963765505"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Eve Lewis
üéâ First booking detected for customer: Q18M3GTWMST22CEPJRJCVMVWNG
   Name: Eve Lewis
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer Q18M3GTWMST22CEPJRJCVMVWNG...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-07-30T21:25:54.933Z",
      "createdAt": "2025-07-30T21:25:54.933Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: Q18M3GTWMST22CEPJRJCVMVWNG
{"ts":"2025-12-05T00:04:27.315Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"ac5e1403-768d-4485-b1a3-94a2fb623a73","stage":"booking","correlationId":"booking-created:1c7fd7dc6ff5c8957163fc78"}
{"ts":"2025-12-05T00:04:27.477Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"5d0d7075-3451-40c7-82fe-693ed47c0e8e","stage":"booking","correlationId":"booking-created:15650bb15853dd53c4b38627","attempts":1}
üìÖ Processing booking created for customer: ZF5Z9M6KY4064HBJBVTDSNEM44
Full booking data: {
  "id": "4e1gsez91mymp8",
  "allDay": false,
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "startAt": "2025-12-01T23:00:00Z",
  "version": 2,
  "createdAt": "2025-12-01T22:11:14Z",
  "updatedAt": "2025-12-02T00:07:12Z",
  "customerId": "ZF5Z9M6KY4064HBJBVTDSNEM44",
  "locationId": "LT4ZHFBQQYB2N",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "creatorType": "TEAM_MEMBER",
    "teamMemberId": "TMQPbDVvvOCLwqsy"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMyUMvTJIj2HrHSg",
      "anyTeamMember": false,
      "durationMinutes": 90,
      "serviceVariationId": "JMTK5M2CY2W7WEXSTAJKAJ35",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1762893947284"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Marisa LaVallee
‚ÑπÔ∏è Customer ZF5Z9M6KY4064HBJBVTDSNEM44 already received signup bonus, not first booking
{"ts":"2025-12-05T00:04:27.700Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"5d0d7075-3451-40c7-82fe-693ed47c0e8e","stage":"booking","correlationId":"booking-created:15650bb15853dd53c4b38627"}
{"ts":"2025-12-05T00:04:28.185Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"d789f3cd-8efa-4bd3-b52e-cae18a719674","stage":"booking","correlationId":"booking-created:1bad6f619ed20940d6ab40ca","attempts":1}
üìÖ Processing booking created for customer: Q4WSB4NTNXWG9HSTJ5NEEWSMYW
Full booking data: {
  "id": "mumftrohzni30e",
  "allDay": false,
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94123-3940",
    "addressLine1": "2266 Union St",
    "addressLine2": "",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-01T23:00:00Z",
  "version": 3,
  "createdAt": "2025-11-17T04:17:27Z",
  "updatedAt": "2025-12-02T00:35:16Z",
  "customerId": "Q4WSB4NTNXWG9HSTJ5NEEWSMYW",
  "locationId": "LT4ZHFBQQYB2N",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "Q4WSB4NTNXWG9HSTJ5NEEWSMYW",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMMHlgFBIFbMTRap",
      "anyTeamMember": false,
      "durationMinutes": 100,
      "serviceVariationId": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1758921239397"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Neda Nguyen
üéâ First booking detected for customer: Q4WSB4NTNXWG9HSTJ5NEEWSMYW
   Name: Neda Nguyen
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer Q4WSB4NTNXWG9HSTJ5NEEWSMYW...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-11-17T04:17:27.670Z",
      "createdAt": "2025-11-17T04:17:27.670Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: Q4WSB4NTNXWG9HSTJ5NEEWSMYW
{"ts":"2025-12-05T00:04:28.745Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"d789f3cd-8efa-4bd3-b52e-cae18a719674","stage":"booking","correlationId":"booking-created:1bad6f619ed20940d6ab40ca"}
{"ts":"2025-12-05T00:04:29.060Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"7ec588bd-9074-4699-99b9-c6ea58bb22e5","stage":"booking","correlationId":"booking-created:f2314271f0f9c9cca4cdcc77","attempts":1}
üìÖ Processing booking created for customer: AQJM14K5E90BB90WSPPYEMEN1R
Full booking data: {
  "id": "ndt47ov7zl7xwl",
  "allDay": false,
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94123-3940",
    "addressLine1": "2266 Union St",
    "addressLine2": "",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-01T23:00:00Z",
  "version": 3,
  "createdAt": "2025-11-01T23:06:18Z",
  "updatedAt": "2025-12-02T00:46:06Z",
  "customerId": "AQJM14K5E90BB90WSPPYEMEN1R",
  "locationId": "LT4ZHFBQQYB2N",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "AQJM14K5E90BB90WSPPYEMEN1R",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TM1L5yPC-yKx6CyO",
      "anyTeamMember": false,
      "durationMinutes": 120,
      "serviceVariationId": "NCOIL6ZGDTCC7SO3IJHENCQ2",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1761597690235"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Anne Fung
üéâ First booking detected for customer: AQJM14K5E90BB90WSPPYEMEN1R
   Name: Anne Fung
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer AQJM14K5E90BB90WSPPYEMEN1R...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-10-05T15:55:40.465Z",
      "createdAt": "2025-10-05T15:55:40.465Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: AQJM14K5E90BB90WSPPYEMEN1R
{"ts":"2025-12-05T00:04:29.642Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"7ec588bd-9074-4699-99b9-c6ea58bb22e5","stage":"booking","correlationId":"booking-created:f2314271f0f9c9cca4cdcc77"}
{"ts":"2025-12-05T00:04:29.888Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"73652e31-ddf9-4498-9b82-1a3a9c367b65","stage":"booking","correlationId":"booking-created:b5d3da9ebd2a5f3cdac24e4c","attempts":1}
üìÖ Processing booking created for customer: SBTMN68GMH0AB3YFW7R3FQ7VPW
Full booking data: {
  "id": "o067hnlseley77",
  "allDay": false,
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94123-3940",
    "addressLine1": "2266 Union St",
    "addressLine2": "",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-01T23:00:00Z",
  "version": 2,
  "createdAt": "2025-11-07T23:26:50Z",
  "updatedAt": "2025-12-02T00:29:36Z",
  "customerId": "SBTMN68GMH0AB3YFW7R3FQ7VPW",
  "locationId": "LT4ZHFBQQYB2N",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "SBTMN68GMH0AB3YFW7R3FQ7VPW",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMNW4SIF7tjp4oM_",
      "anyTeamMember": false,
      "durationMinutes": 90,
      "serviceVariationId": "BRSIGZFOWC6F4ERPKX3CODLU",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1761597690235"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Kendall Ritter
üéâ First booking detected for customer: SBTMN68GMH0AB3YFW7R3FQ7VPW
   Name: Kendall Ritter
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer SBTMN68GMH0AB3YFW7R3FQ7VPW...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
      ],
      "version": 2,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-06-01T23:27:42.862Z",
      "createdAt": "2025-06-01T23:27:42.425Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: SBTMN68GMH0AB3YFW7R3FQ7VPW
{"ts":"2025-12-05T00:04:30.352Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"73652e31-ddf9-4498-9b82-1a3a9c367b65","stage":"booking","correlationId":"booking-created:b5d3da9ebd2a5f3cdac24e4c"}
{"ts":"2025-12-05T00:04:30.513Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"56e440b3-f569-4ac0-8e6c-a1a14d60d5c6","stage":"booking","correlationId":"booking-created:d94eb10a8f7f2c8337cd30cf","attempts":1}
üìÖ Processing booking created for customer: D6Y59VS7SYCE4YZTM1MECYGWF8
Full booking data: {
  "id": "tnlcune9e0o0vq",
  "allDay": false,
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94133-4608",
    "addressLine1": "550 Pacific Ave",
    "addressLine2": "",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-01T23:00:00Z",
  "version": 4,
  "createdAt": "2025-11-18T02:52:54Z",
  "updatedAt": "2025-12-02T00:56:31Z",
  "customerId": "D6Y59VS7SYCE4YZTM1MECYGWF8",
  "locationId": "LNQKVBTQZN3EZ",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "D6Y59VS7SYCE4YZTM1MECYGWF8",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMVwAQUdLz6no-cB",
      "anyTeamMember": false,
      "durationMinutes": 90,
      "serviceVariationId": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1758921239397"
    },
    {
      "teamMemberId": "TMVwAQUdLz6no-cB",
      "anyTeamMember": false,
      "durationMinutes": 10,
      "serviceVariationId": "6F6F3OAFJSOEN3X7HSXYIVQC",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1760895536505"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Katie Scherer
üéâ First booking detected for customer: D6Y59VS7SYCE4YZTM1MECYGWF8
   Name: Katie Scherer
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer D6Y59VS7SYCE4YZTM1MECYGWF8...
   Full custom attributes response: {}
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: D6Y59VS7SYCE4YZTM1MECYGWF8
{"ts":"2025-12-05T00:04:30.878Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"56e440b3-f569-4ac0-8e6c-a1a14d60d5c6","stage":"booking","correlationId":"booking-created:d94eb10a8f7f2c8337cd30cf"}
{"ts":"2025-12-05T00:04:31.061Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"b76b5e80-9084-4681-8f9d-6ecd7c11d175","stage":"booking","correlationId":"booking-created:95f3651b15950b5a50b87708","attempts":1}
üìÖ Processing booking created for customer: 0TG5WNATPE362NC416TC4YQ14C
Full booking data: {
  "id": "yi3czqs3gxb8rf",
  "allDay": false,
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94133-4608",
    "addressLine1": "550 Pacific Ave",
    "addressLine2": "",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-01T23:00:00Z",
  "version": 2,
  "createdAt": "2025-11-30T01:32:16Z",
  "updatedAt": "2025-12-02T00:42:51Z",
  "customerId": "0TG5WNATPE362NC416TC4YQ14C",
  "locationId": "LNQKVBTQZN3EZ",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "0TG5WNATPE362NC416TC4YQ14C",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMEWAZHdtaiRR_Zs",
      "anyTeamMember": false,
      "durationMinutes": 120,
      "serviceVariationId": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1763586786564"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Tiffany Williams
üéâ First booking detected for customer: 0TG5WNATPE362NC416TC4YQ14C
   Name: Tiffany Williams
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 0TG5WNATPE362NC416TC4YQ14C...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-11-06T21:32:49Z",
      "createdAt": "2025-11-06T21:32:49Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 0TG5WNATPE362NC416TC4YQ14C
{"ts":"2025-12-05T00:04:31.451Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"b76b5e80-9084-4681-8f9d-6ecd7c11d175","stage":"booking","correlationId":"booking-created:95f3651b15950b5a50b87708"}
{"ts":"2025-12-05T00:04:31.614Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"654d0e54-47ec-487a-9931-f6dbc4257a98","stage":"booking","correlationId":"booking-created:dfe6229691ee62c5a9198382","attempts":1}
üìÖ Processing booking created for customer: 6Z4Z8G3077JCPYSP7NF9PTCDQ8
Full booking data: {
  "id": "9dkrjcvaojtpso",
  "allDay": false,
  "source": "THIRD_PARTY_BUYER",
  "status": "CANCELLED_BY_CUSTOMER",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94123-3940",
    "addressLine1": "2266 Union St",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-01T23:20:00Z",
  "version": 1,
  "createdAt": "2025-11-16T13:02:36Z",
  "updatedAt": "2025-11-19T04:56:06Z",
  "customerId": "6Z4Z8G3077JCPYSP7NF9PTCDQ8",
  "locationId": "LT4ZHFBQQYB2N",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "6Z4Z8G3077JCPYSP7NF9PTCDQ8",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMew76L_w3bra6AH",
      "anyTeamMember": false,
      "durationMinutes": 100,
      "serviceVariationId": "3RGAKDF5FVT2CSEJTMKUSTG6",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1762893947284"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Lauren Peters
üéâ First booking detected for customer: 6Z4Z8G3077JCPYSP7NF9PTCDQ8
   Name: Lauren Peters
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 6Z4Z8G3077JCPYSP7NF9PTCDQ8...
   Full custom attributes response: {}
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 6Z4Z8G3077JCPYSP7NF9PTCDQ8
{"ts":"2025-12-05T00:04:31.995Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"654d0e54-47ec-487a-9931-f6dbc4257a98","stage":"booking","correlationId":"booking-created:dfe6229691ee62c5a9198382"}
{"ts":"2025-12-05T00:04:32.162Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"c1012e22-efe5-4b1a-9119-891d04e3e2a7","stage":"booking","correlationId":"booking-created:fca14b788e6bd51909e563a4","attempts":1}
üìÖ Processing booking created for customer: QF9TM3Z75QVE6QX1FM7TTY8YBW
Full booking data: {
  "id": "9adaqoasxfqnrj",
  "allDay": false,
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94133-4608",
    "addressLine1": "550 Pacific Ave",
    "addressLine2": "",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-01T23:30:00Z",
  "version": 4,
  "createdAt": "2025-11-10T05:03:44Z",
  "updatedAt": "2025-12-02T01:13:32Z",
  "customerId": "QF9TM3Z75QVE6QX1FM7TTY8YBW",
  "locationId": "LNQKVBTQZN3EZ",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "QF9TM3Z75QVE6QX1FM7TTY8YBW",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMILsQUVwLkLzbVo",
      "anyTeamMember": false,
      "durationMinutes": 90,
      "serviceVariationId": "BM556FTNFOTEHYVG4GPXAXFM",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1761597690235"
    },
    {
      "teamMemberId": "TMILsQUVwLkLzbVo",
      "anyTeamMember": false,
      "durationMinutes": 30,
      "serviceVariationId": "LFLFEZO7L46URIM2OVZOJADI",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1762374620368"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: scarlett stephens
üéâ First booking detected for customer: QF9TM3Z75QVE6QX1FM7TTY8YBW
   Name: scarlett stephens
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer QF9TM3Z75QVE6QX1FM7TTY8YBW...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "0826aee4-d259-434d-be44-511ac61b3629"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-02-15T01:45:15.533Z",
      "createdAt": "2025-02-15T01:45:15.533Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="0826aee4-d259-434d-be44-511ac61b3629"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "0826aee4-d259-434d-be44-511ac61b3629"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: QF9TM3Z75QVE6QX1FM7TTY8YBW
{"ts":"2025-12-05T00:04:32.532Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"c1012e22-efe5-4b1a-9119-891d04e3e2a7","stage":"booking","correlationId":"booking-created:fca14b788e6bd51909e563a4"}
{"ts":"2025-12-05T00:04:32.693Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"7db09e95-a83a-4fc8-ac46-e634a6211115","stage":"booking","correlationId":"booking-created:c2c7b237e2ac31892fde251b","attempts":1}
üìÖ Processing booking created for customer: 1K5VSMKX25H36NP1MR7GREP8M4
Full booking data: {
  "id": "upa6sbqqsg435v",
  "allDay": false,
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94123-3940",
    "addressLine1": "2266 Union St",
    "addressLine2": "",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-01T23:30:00Z",
  "version": 4,
  "createdAt": "2025-11-17T03:58:22Z",
  "updatedAt": "2025-12-02T01:53:12Z",
  "customerId": "1K5VSMKX25H36NP1MR7GREP8M4",
  "locationId": "LT4ZHFBQQYB2N",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "1K5VSMKX25H36NP1MR7GREP8M4",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMOscywuGXO2VURY",
      "anyTeamMember": false,
      "durationMinutes": 140,
      "serviceVariationId": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1758927251718"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Kelley Eason
üéâ First booking detected for customer: 1K5VSMKX25H36NP1MR7GREP8M4
   Name: Kelley Eason
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 1K5VSMKX25H36NP1MR7GREP8M4...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "c0f2ee04-4762-42c6-a593-a4e745a81c92"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-08-24T17:23:33.207Z",
      "createdAt": "2025-08-24T17:23:33.207Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="c0f2ee04-4762-42c6-a593-a4e745a81c92"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "c0f2ee04-4762-42c6-a593-a4e745a81c92"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 1K5VSMKX25H36NP1MR7GREP8M4
{"ts":"2025-12-05T00:04:33.079Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"7db09e95-a83a-4fc8-ac46-e634a6211115","stage":"booking","correlationId":"booking-created:c2c7b237e2ac31892fde251b"}
{"ts":"2025-12-05T00:04:33.241Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"63916881-f97d-4db9-bac7-f9e2d5fa646d","stage":"booking","correlationId":"booking-created:94065ceccd2009a4628bfe31","attempts":1}
üìÖ Processing booking created for customer: 9VT9PGM9VAEAVJ2B0QCYHJC8R0
Full booking data: {
  "id": "j1jj2snmy945ex",
  "allDay": false,
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94133-4608",
    "addressLine1": "550 Pacific Ave",
    "addressLine2": "",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-01T23:50:00Z",
  "version": 5,
  "createdAt": "2025-11-28T02:42:36Z",
  "updatedAt": "2025-12-02T01:43:01Z",
  "customerId": "9VT9PGM9VAEAVJ2B0QCYHJC8R0",
  "locationId": "LNQKVBTQZN3EZ",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "9VT9PGM9VAEAVJ2B0QCYHJC8R0",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMgsjtuk5cfKnstq",
      "anyTeamMember": false,
      "durationMinutes": 110,
      "serviceVariationId": "6TYOE67IDYTKHW2ZG6HKVZER",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1764191999049"
    },
    {
      "teamMemberId": "TMgsjtuk5cfKnstq",
      "anyTeamMember": false,
      "durationMinutes": 10,
      "serviceVariationId": "6F6F3OAFJSOEN3X7HSXYIVQC",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1760895536505"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Ellie Anvar
‚ÑπÔ∏è Customer 9VT9PGM9VAEAVJ2B0QCYHJC8R0 already received signup bonus, not first booking
{"ts":"2025-12-05T00:04:33.463Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"63916881-f97d-4db9-bac7-f9e2d5fa646d","stage":"booking","correlationId":"booking-created:94065ceccd2009a4628bfe31"}
{"ts":"2025-12-05T00:04:33.626Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"612d70dd-ff10-4b2f-be5f-2dc484baadb6","stage":"booking","correlationId":"booking-created:8fb1a17c1e5308ef0d7efca7","attempts":1}
üìÖ Processing booking created for customer: VX4W3SJ6RTFDRQNK1TZJC1T19G
Full booking data: {
  "id": "6owunervnkke4x",
  "allDay": false,
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94123-3940",
    "addressLine1": "2266 Union St",
    "addressLine2": "",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-02T00:10:00Z",
  "version": 3,
  "createdAt": "2025-12-01T21:33:31Z",
  "updatedAt": "2025-12-02T02:01:36Z",
  "customerId": "VX4W3SJ6RTFDRQNK1TZJC1T19G",
  "locationId": "LT4ZHFBQQYB2N",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "VX4W3SJ6RTFDRQNK1TZJC1T19G",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TM7_r-KmvY9xjnEU",
      "anyTeamMember": false,
      "durationMinutes": 110,
      "serviceVariationId": "GJ5SRTYFV6ZCDI62TMSZP2OP",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1764609577793"
    },
    {
      "teamMemberId": "TM7_r-KmvY9xjnEU",
      "anyTeamMember": false,
      "durationMinutes": 20,
      "serviceVariationId": "HAJX45W3U2WUCCXM5MI24UEE",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1763586786564"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Monica Everett
üéâ First booking detected for customer: VX4W3SJ6RTFDRQNK1TZJC1T19G
   Name: Monica Everett
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer VX4W3SJ6RTFDRQNK1TZJC1T19G...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-10-16T05:21:30.751Z",
      "createdAt": "2025-10-16T05:21:30.751Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: VX4W3SJ6RTFDRQNK1TZJC1T19G
{"ts":"2025-12-05T00:04:34.021Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"612d70dd-ff10-4b2f-be5f-2dc484baadb6","stage":"booking","correlationId":"booking-created:8fb1a17c1e5308ef0d7efca7"}
{"ts":"2025-12-05T00:04:34.184Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"288bf566-54bc-4ece-854b-1b435ec8c45d","stage":"booking","correlationId":"booking-created:4cac802e2ed2d5e2b1b0d274","attempts":1}
üìÖ Processing booking created for customer: BG84AFYW767H4Y3XZB8S8P8ME4
Full booking data: {
  "id": "ior6ocpq529xgw",
  "allDay": false,
  "source": "FIRST_PARTY_MERCHANT",
  "status": "CANCELLED_BY_SELLER",
  "startAt": "2025-12-02T00:15:00Z",
  "version": 7,
  "createdAt": "2025-11-11T03:10:43Z",
  "updatedAt": "2025-11-22T09:14:00Z",
  "customerId": "BG84AFYW767H4Y3XZB8S8P8ME4",
  "locationId": "LNQKVBTQZN3EZ",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "creatorType": "TEAM_MEMBER",
    "teamMemberId": "TMWAtQTYmZpwwxii"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMgsjtuk5cfKnstq",
      "anyTeamMember": false,
      "durationMinutes": 110,
      "serviceVariationId": "6TYOE67IDYTKHW2ZG6HKVZER",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1757963765505"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Bozhena V
üéâ First booking detected for customer: BG84AFYW767H4Y3XZB8S8P8ME4
   Name: Bozhena V
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer BG84AFYW767H4Y3XZB8S8P8ME4...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:a3dde506-f69e-48e4-a98a-004c1822d3ad",
      "value": "BOZHENA8884",
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-11-04T21:14:09.057Z",
      "createdAt": "2025-11-04T21:14:09.057Z"
    },
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "0826aee4-d259-434d-be44-511ac61b3629"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-04-11T00:28:24.690Z",
      "createdAt": "2025-04-11T00:28:24.690Z"
    }
  ]
}
   üìã Custom attribute: key="square:a3dde506-f69e-48e4-a98a-004c1822d3ad", value="BOZHENA8884"
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="0826aee4-d259-434d-be44-511ac61b3629"
   Custom attributes from Square: {
  "square:a3dde506-f69e-48e4-a98a-004c1822d3ad": "BOZHENA8884",
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "0826aee4-d259-434d-be44-511ac61b3629"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   üîç Checking custom attribute value: "BOZHENA8884" (key: square:a3dde506-f69e-48e4-a98a-004c1822d3ad)
   üîç Looking up referral code in database: "BOZHENA8884" (original: "BOZHENA8884")
   ‚ùå No referrer found with code "BOZHENA8884" or "BOZHENA8884"
   üîç Database lookup result for "BOZHENA8884": NOT FOUND
   ‚ö†Ô∏è Value "BOZHENA8884" is not a valid referral code in database
   ‚ö†Ô∏è This means either: 1) Code doesn't exist, or 2) Referrer hasn't completed first payment yet
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: BG84AFYW767H4Y3XZB8S8P8ME4
{"ts":"2025-12-05T00:04:34.620Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"288bf566-54bc-4ece-854b-1b435ec8c45d","stage":"booking","correlationId":"booking-created:4cac802e2ed2d5e2b1b0d274"}
{"ts":"2025-12-05T00:04:34.784Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"a9de47ec-ac35-4097-9619-045cefbc1c7a","stage":"booking","correlationId":"booking-created:53baca1b7756aed290296222","attempts":1}
üìÖ Processing booking created for customer: B1SD31A26YCWNJT9V2B4HGJCB0
Full booking data: {
  "id": "4nkjfwvp8lg3tx",
  "allDay": false,
  "source": "FIRST_PARTY_BUYER",
  "status": "CANCELLED_BY_CUSTOMER",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94123-3940",
    "addressLine1": "2266 Union St",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-02T00:30:00Z",
  "version": 1,
  "createdAt": "2025-11-12T02:20:12Z",
  "updatedAt": "2025-11-30T04:25:42Z",
  "customerId": "B1SD31A26YCWNJT9V2B4HGJCB0",
  "locationId": "LT4ZHFBQQYB2N",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "B1SD31A26YCWNJT9V2B4HGJCB0",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMNW4SIF7tjp4oM_",
      "anyTeamMember": false,
      "durationMinutes": 90,
      "serviceVariationId": "BRSIGZFOWC6F4ERPKX3CODLU",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1762893947284"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Emily Machado
üéâ First booking detected for customer: B1SD31A26YCWNJT9V2B4HGJCB0
   Name: Emily Machado
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer B1SD31A26YCWNJT9V2B4HGJCB0...
   Full custom attributes response: {}
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: B1SD31A26YCWNJT9V2B4HGJCB0
{"ts":"2025-12-05T00:04:35.171Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"a9de47ec-ac35-4097-9619-045cefbc1c7a","stage":"booking","correlationId":"booking-created:53baca1b7756aed290296222"}
{"ts":"2025-12-05T00:04:35.334Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"2a18f860-8143-4b43-b32a-dd54b64bfe8d","stage":"booking","correlationId":"booking-created:e16a57d4fb461d08a94108f1","attempts":1}
üìÖ Processing booking created for customer: 9TPS15NVHPNSTA8VG282P50QRM
Full booking data: {
  "id": "gqmres6qsas7fh",
  "allDay": false,
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94123-3940",
    "addressLine1": "2266 Union St",
    "addressLine2": "",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-02T00:30:00Z",
  "version": 2,
  "createdAt": "2025-11-30T18:34:33Z",
  "updatedAt": "2025-12-02T01:50:21Z",
  "customerId": "9TPS15NVHPNSTA8VG282P50QRM",
  "locationId": "LT4ZHFBQQYB2N",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "9TPS15NVHPNSTA8VG282P50QRM",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMNW4SIF7tjp4oM_",
      "anyTeamMember": false,
      "durationMinutes": 90,
      "serviceVariationId": "BRSIGZFOWC6F4ERPKX3CODLU",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1764191999049"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Rachel Price
üéâ First booking detected for customer: 9TPS15NVHPNSTA8VG282P50QRM
   Name: Rachel Price
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 9TPS15NVHPNSTA8VG282P50QRM...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-11-30T18:34:33.423Z",
      "createdAt": "2025-11-30T18:34:33.423Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 9TPS15NVHPNSTA8VG282P50QRM
{"ts":"2025-12-05T00:04:35.780Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"2a18f860-8143-4b43-b32a-dd54b64bfe8d","stage":"booking","correlationId":"booking-created:e16a57d4fb461d08a94108f1"}
{"ts":"2025-12-05T00:04:35.943Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"54f8b7d7-3fa5-4b27-9b81-a169e7fb0ec8","stage":"booking","correlationId":"booking-created:dd076aa09e61da34893cbf49","attempts":1}
üìÖ Processing booking created for customer: HDBQDJ6MGJW3NVX4VJCR28VYSM
Full booking data: {
  "id": "xmoiynebeyutef",
  "allDay": false,
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94123-3940",
    "addressLine1": "2266 Union St",
    "addressLine2": "",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-02T00:30:00Z",
  "version": 3,
  "createdAt": "2025-11-30T21:05:11Z",
  "updatedAt": "2025-12-02T01:37:07Z",
  "customerId": "HDBQDJ6MGJW3NVX4VJCR28VYSM",
  "locationId": "LT4ZHFBQQYB2N",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "HDBQDJ6MGJW3NVX4VJCR28VYSM",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMyUMvTJIj2HrHSg",
      "anyTeamMember": false,
      "durationMinutes": 90,
      "serviceVariationId": "JMTK5M2CY2W7WEXSTAJKAJ35",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1764191999049"
    },
    {
      "teamMemberId": "TMyUMvTJIj2HrHSg",
      "anyTeamMember": false,
      "durationMinutes": 20,
      "serviceVariationId": "HAJX45W3U2WUCCXM5MI24UEE",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1763586786564"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Crystal H
‚ÑπÔ∏è Customer HDBQDJ6MGJW3NVX4VJCR28VYSM already received signup bonus, not first booking
{"ts":"2025-12-05T00:04:36.163Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"54f8b7d7-3fa5-4b27-9b81-a169e7fb0ec8","stage":"booking","correlationId":"booking-created:dd076aa09e61da34893cbf49"}
{"ts":"2025-12-05T00:04:36.344Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"a9b6577d-94ad-48e0-a2ee-bf982ad1e10c","stage":"booking","correlationId":"booking-created:1cd81b127b617f56e874151b","attempts":1}
üìÖ Processing booking created for customer: A4YBX3096R86QF34DTSWRCVXG8
Full booking data: {
  "id": "yofjwyajxw688t",
  "allDay": false,
  "source": "THIRD_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94133-4608",
    "addressLine1": "550 Pacific Ave",
    "addressLine2": "",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-02T00:30:00Z",
  "version": 3,
  "createdAt": "2025-11-19T18:47:23Z",
  "updatedAt": "2025-12-02T01:53:42Z",
  "customerId": "A4YBX3096R86QF34DTSWRCVXG8",
  "locationId": "LNQKVBTQZN3EZ",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "A4YBX3096R86QF34DTSWRCVXG8",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMVwAQUdLz6no-cB",
      "anyTeamMember": false,
      "durationMinutes": 90,
      "serviceVariationId": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1758921239397"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: brooke mattia
üéâ First booking detected for customer: A4YBX3096R86QF34DTSWRCVXG8
   Name: brooke mattia
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer A4YBX3096R86QF34DTSWRCVXG8...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "0826aee4-d259-434d-be44-511ac61b3629"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-05-29T17:57:52.288Z",
      "createdAt": "2025-05-29T17:57:52.288Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="0826aee4-d259-434d-be44-511ac61b3629"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "0826aee4-d259-434d-be44-511ac61b3629"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: A4YBX3096R86QF34DTSWRCVXG8
{"ts":"2025-12-05T00:04:36.711Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"a9b6577d-94ad-48e0-a2ee-bf982ad1e10c","stage":"booking","correlationId":"booking-created:1cd81b127b617f56e874151b"}
{"ts":"2025-12-05T00:04:36.875Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"be1f8d96-f994-48d1-871e-31c26e57136d","stage":"booking","correlationId":"booking-created:09ae8c04ea79c6a79e596826","attempts":1}
üìÖ Processing booking created for customer: ZJTAADYCZMPGS4YS2F39CJFM1C
Full booking data: {
  "id": "fxcdyztthoqxyv",
  "allDay": false,
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94133-4608",
    "addressLine1": "550 Pacific Ave",
    "addressLine2": "",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-02T01:00:00Z",
  "version": 2,
  "createdAt": "2025-11-09T11:21:07Z",
  "updatedAt": "2025-12-02T02:31:48Z",
  "customerId": "ZJTAADYCZMPGS4YS2F39CJFM1C",
  "locationId": "LNQKVBTQZN3EZ",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "ZJTAADYCZMPGS4YS2F39CJFM1C",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMoZGdZlg-iKWTDu",
      "anyTeamMember": false,
      "durationMinutes": 90,
      "serviceVariationId": "EN2GXPXFPBKRAK7MK3ZB6YRW",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1762374620368"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Maya Shetty
‚ÑπÔ∏è Customer ZJTAADYCZMPGS4YS2F39CJFM1C already received signup bonus, not first booking
{"ts":"2025-12-05T00:04:37.101Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"be1f8d96-f994-48d1-871e-31c26e57136d","stage":"booking","correlationId":"booking-created:09ae8c04ea79c6a79e596826"}
{"ts":"2025-12-05T00:04:37.266Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"f56e5878-abc2-4ded-87ce-60fb04107cb3","stage":"booking","correlationId":"booking-created:f47df2bf464edebccd75f5b4","attempts":1}
üìÖ Processing booking created for customer: 853SMKGAWCW44FNR7MZ23FZBH8
Full booking data: {
  "id": "oqxfvyi7z3bh21",
  "allDay": false,
  "source": "THIRD_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94123-3940",
    "addressLine1": "2266 Union St",
    "addressLine2": "",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-02T01:00:00Z",
  "version": 3,
  "createdAt": "2025-12-01T19:35:25Z",
  "updatedAt": "2025-12-02T03:15:46Z",
  "customerId": "853SMKGAWCW44FNR7MZ23FZBH8",
  "locationId": "LT4ZHFBQQYB2N",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "853SMKGAWCW44FNR7MZ23FZBH8",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TM1L5yPC-yKx6CyO",
      "anyTeamMember": false,
      "durationMinutes": 120,
      "serviceVariationId": "NCOIL6ZGDTCC7SO3IJHENCQ2",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1764609577793"
    },
    {
      "teamMemberId": "TM1L5yPC-yKx6CyO",
      "anyTeamMember": false,
      "durationMinutes": 15,
      "serviceVariationId": "KBHPHVKLJNAF223GMYIRUUH3",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1760895536505"
    },
    {
      "teamMemberId": "TM1L5yPC-yKx6CyO",
      "anyTeamMember": false,
      "durationMinutes": 15,
      "serviceVariationId": "KBHPHVKLJNAF223GMYIRUUH3",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1760895536505"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Anastasia S
üéâ First booking detected for customer: 853SMKGAWCW44FNR7MZ23FZBH8
   Name: Anastasia S
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 853SMKGAWCW44FNR7MZ23FZBH8...
   Full custom attributes response: {}
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 853SMKGAWCW44FNR7MZ23FZBH8
{"ts":"2025-12-05T00:04:37.694Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"f56e5878-abc2-4ded-87ce-60fb04107cb3","stage":"booking","correlationId":"booking-created:f47df2bf464edebccd75f5b4"}
{"ts":"2025-12-05T00:04:37.875Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"cbd16ba9-233f-48a8-9c8c-5066c07f0368","stage":"booking","correlationId":"booking-created:2de6a35dce02e3bb1132c045","attempts":1}
üìÖ Processing booking created for customer: ZTSR01VBVMB06HW7ARNKGC5648
Full booking data: {
  "id": "pdqnjbj0tino9u",
  "allDay": false,
  "source": "FIRST_PARTY_BUYER",
  "status": "CANCELLED_BY_CUSTOMER",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94123-3940",
    "addressLine1": "2266 Union St",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-02T01:00:00Z",
  "version": 1,
  "createdAt": "2025-11-03T16:43:19Z",
  "updatedAt": "2025-12-01T00:20:11Z",
  "customerId": "ZTSR01VBVMB06HW7ARNKGC5648",
  "locationId": "LT4ZHFBQQYB2N",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "ZTSR01VBVMB06HW7ARNKGC5648",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TM1L5yPC-yKx6CyO",
      "anyTeamMember": false,
      "durationMinutes": 120,
      "serviceVariationId": "NCOIL6ZGDTCC7SO3IJHENCQ2",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1761597690235"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Emma Stickel
üéâ First booking detected for customer: ZTSR01VBVMB06HW7ARNKGC5648
   Name: Emma Stickel
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer ZTSR01VBVMB06HW7ARNKGC5648...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-03-20T18:52:01.402Z",
      "createdAt": "2025-03-20T18:52:01.402Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: ZTSR01VBVMB06HW7ARNKGC5648
{"ts":"2025-12-05T00:04:38.240Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"cbd16ba9-233f-48a8-9c8c-5066c07f0368","stage":"booking","correlationId":"booking-created:2de6a35dce02e3bb1132c045"}
{"ts":"2025-12-05T00:04:38.405Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"703da385-fc62-4bd4-bfce-63a8db778dd7","stage":"booking","correlationId":"booking-created:701286ebdb6f46bfa587be79","attempts":1}
üìÖ Processing booking created for customer: BCDAEYDCS05SCKA1C291CKN3EW
Full booking data: {
  "id": "w7vezgsoyaoxy8",
  "allDay": false,
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "startAt": "2025-12-02T01:00:00Z",
  "version": 2,
  "createdAt": "2025-11-26T23:55:07Z",
  "updatedAt": "2025-12-01T21:47:57Z",
  "customerId": "BCDAEYDCS05SCKA1C291CKN3EW",
  "locationId": "LNQKVBTQZN3EZ",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "creatorType": "TEAM_MEMBER",
    "teamMemberId": "TMWAtQTYmZpwwxii"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMdagA6g0F03A7_w",
      "anyTeamMember": false,
      "durationMinutes": 140,
      "serviceVariationId": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1763586786564"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Hannah Bagby
üéâ First booking detected for customer: BCDAEYDCS05SCKA1C291CKN3EW
   Name: Hannah Bagby
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer BCDAEYDCS05SCKA1C291CKN3EW...
   Full custom attributes response: {}
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: BCDAEYDCS05SCKA1C291CKN3EW
{"ts":"2025-12-05T00:04:39.061Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"703da385-fc62-4bd4-bfce-63a8db778dd7","stage":"booking","correlationId":"booking-created:701286ebdb6f46bfa587be79"}
{"ts":"2025-12-05T00:04:39.308Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"0e517c31-feb4-4aa3-a081-19e23c302dde","stage":"booking","correlationId":"booking-created:0bd413d0e9811137868fc9c9","attempts":1}
üìÖ Processing booking created for customer: CCKWK1FXC28402DMD5MS1A45JM
Full booking data: {
  "id": "a3ezqnk04g946n",
  "allDay": false,
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94133-4608",
    "addressLine1": "550 Pacific Ave",
    "addressLine2": "",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-02T01:20:00Z",
  "version": 2,
  "createdAt": "2025-11-05T03:32:14Z",
  "updatedAt": "2025-12-02T04:11:06Z",
  "customerId": "CCKWK1FXC28402DMD5MS1A45JM",
  "locationId": "LNQKVBTQZN3EZ",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "CCKWK1FXC28402DMD5MS1A45JM",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMSt73bSp59caRzt",
      "anyTeamMember": false,
      "durationMinutes": 140,
      "serviceVariationId": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1758927251718"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Nicola Kirkpatrick
üéâ First booking detected for customer: CCKWK1FXC28402DMD5MS1A45JM
   Name: Nicola Kirkpatrick
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer CCKWK1FXC28402DMD5MS1A45JM...
   Full custom attributes response: {}
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: CCKWK1FXC28402DMD5MS1A45JM
{"ts":"2025-12-05T00:04:39.795Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"0e517c31-feb4-4aa3-a081-19e23c302dde","stage":"booking","correlationId":"booking-created:0bd413d0e9811137868fc9c9"}
{"ts":"2025-12-05T00:04:39.955Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"0720b0c3-2806-4a2a-9f7c-e33d5bfbe678","stage":"booking","correlationId":"booking-created:64d6f87f7792fb8df002c3f3","attempts":1}
üìÖ Processing booking created for customer: BCWHNCZXMHMMV4VECHT1QEWNX8
Full booking data: {
  "id": "32hilszcdf172p",
  "allDay": false,
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94133-4608",
    "addressLine1": "550 Pacific Ave",
    "addressLine2": "",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-02T02:00:00Z",
  "version": 3,
  "createdAt": "2025-11-24T03:18:33Z",
  "updatedAt": "2025-12-02T03:09:01Z",
  "customerId": "BCWHNCZXMHMMV4VECHT1QEWNX8",
  "locationId": "LNQKVBTQZN3EZ",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "BCWHNCZXMHMMV4VECHT1QEWNX8",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMVwAQUdLz6no-cB",
      "anyTeamMember": false,
      "durationMinutes": 90,
      "serviceVariationId": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1763586786564"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Olivia Koshy
üéâ First booking detected for customer: BCWHNCZXMHMMV4VECHT1QEWNX8
   Name: Olivia Koshy
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer BCWHNCZXMHMMV4VECHT1QEWNX8...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "fd306114-9968-4fe0-9bde-53f9bf837f39"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-11-24T03:18:33.587Z",
      "createdAt": "2025-11-24T03:18:33.587Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="fd306114-9968-4fe0-9bde-53f9bf837f39"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "fd306114-9968-4fe0-9bde-53f9bf837f39"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: BCWHNCZXMHMMV4VECHT1QEWNX8
{"ts":"2025-12-05T00:04:40.319Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"0720b0c3-2806-4a2a-9f7c-e33d5bfbe678","stage":"booking","correlationId":"booking-created:64d6f87f7792fb8df002c3f3"}
{"ts":"2025-12-05T00:04:40.484Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"8534fa4e-a652-4d10-9f65-f4bcb5e3760b","stage":"booking","correlationId":"booking-created:15a779588bee11db3a9ba57c","attempts":1}
üìÖ Processing booking created for customer: CARHXXDE2RDXJHRM93Y83V750G
Full booking data: {
  "id": "9q0rplacqvcm96",
  "allDay": false,
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94123-3940",
    "addressLine1": "2266 Union St",
    "addressLine2": "",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-02T17:00:00Z",
  "version": 6,
  "createdAt": "2025-11-20T19:43:11Z",
  "updatedAt": "2025-12-02T18:47:31Z",
  "customerId": "CARHXXDE2RDXJHRM93Y83V750G",
  "locationId": "LT4ZHFBQQYB2N",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "CARHXXDE2RDXJHRM93Y83V750G",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMMHlgFBIFbMTRap",
      "anyTeamMember": false,
      "durationMinutes": 100,
      "serviceVariationId": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1763586786564"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Tayler Jones
üéâ First booking detected for customer: CARHXXDE2RDXJHRM93Y83V750G
   Name: Tayler Jones
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer CARHXXDE2RDXJHRM93Y83V750G...
   Full custom attributes response: {}
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: CARHXXDE2RDXJHRM93Y83V750G
{"ts":"2025-12-05T00:04:40.848Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"8534fa4e-a652-4d10-9f65-f4bcb5e3760b","stage":"booking","correlationId":"booking-created:15a779588bee11db3a9ba57c"}
{"ts":"2025-12-05T00:04:41.116Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"d0ed8479-7be1-4b92-8106-5fd6d0ba54d4","stage":"booking","correlationId":"booking-created:4ee16023f306d28882507b4e","attempts":1}
üìÖ Processing booking created for customer: J3F8Z4VQPY70DDXFHFDB98CCZ4
Full booking data: {
  "id": "zcjv0l99utscpy",
  "allDay": false,
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94123-3940",
    "addressLine1": "2266 Union St",
    "addressLine2": "",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-02T17:00:00Z",
  "version": 2,
  "createdAt": "2025-11-28T03:24:54Z",
  "updatedAt": "2025-12-02T18:42:08Z",
  "customerId": "J3F8Z4VQPY70DDXFHFDB98CCZ4",
  "locationId": "LT4ZHFBQQYB2N",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "J3F8Z4VQPY70DDXFHFDB98CCZ4",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TM9jDlRr_Hl4rdBB",
      "anyTeamMember": false,
      "durationMinutes": 90,
      "serviceVariationId": "XBUDIMNKOPC2XVG5YLIQ4RYS",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1764191999049"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Sheena Ferrari
‚ÑπÔ∏è Customer J3F8Z4VQPY70DDXFHFDB98CCZ4 already received signup bonus, not first booking
{"ts":"2025-12-05T00:04:41.333Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"d0ed8479-7be1-4b92-8106-5fd6d0ba54d4","stage":"booking","correlationId":"booking-created:4ee16023f306d28882507b4e"}
{"ts":"2025-12-05T00:04:41.640Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"6872ad1f-316f-4e72-8293-8d05d376cd93","stage":"booking","correlationId":"booking-created:b96b5f31df1b6b05e8bb4e5b","attempts":1}
üìÖ Processing booking created for customer: XDBH7894B1JA5FVZVE37RPBR98
Full booking data: {
  "id": "2h7zcy6cdyrew9",
  "allDay": false,
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94133-4608",
    "addressLine1": "550 Pacific Ave",
    "addressLine2": "",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-02T18:00:00Z",
  "version": 2,
  "createdAt": "2025-11-24T21:42:52Z",
  "updatedAt": "2025-12-02T19:36:56Z",
  "customerId": "XDBH7894B1JA5FVZVE37RPBR98",
  "locationId": "LNQKVBTQZN3EZ",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "XDBH7894B1JA5FVZVE37RPBR98",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMILsQUVwLkLzbVo",
      "anyTeamMember": false,
      "durationMinutes": 100,
      "serviceVariationId": "BM556FTNFOTEHYVG4GPXAXFM",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1762893947284"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Kristina Loh
üéâ First booking detected for customer: XDBH7894B1JA5FVZVE37RPBR98
   Name: Kristina Loh
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer XDBH7894B1JA5FVZVE37RPBR98...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:a3dde506-f69e-48e4-a98a-004c1822d3ad",
      "value": "Isabelle10",
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-11-24T21:42:52.350Z",
      "createdAt": "2025-11-24T21:42:52.350Z"
    },
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "c0f2ee04-4762-42c6-a593-a4e745a81c92"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-11-24T21:42:52.349Z",
      "createdAt": "2025-11-24T21:42:52.349Z"
    }
  ]
}
   üìã Custom attribute: key="square:a3dde506-f69e-48e4-a98a-004c1822d3ad", value="Isabelle10"
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="c0f2ee04-4762-42c6-a593-a4e745a81c92"
   Custom attributes from Square: {
  "square:a3dde506-f69e-48e4-a98a-004c1822d3ad": "Isabelle10",
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "c0f2ee04-4762-42c6-a593-a4e745a81c92"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   üîç Checking custom attribute value: "Isabelle10" (key: square:a3dde506-f69e-48e4-a98a-004c1822d3ad)
   üîç Looking up referral code in database: "ISABELLE10" (original: "Isabelle10")
   ‚ùå No referrer found with code "Isabelle10" or "ISABELLE10"
   üîç Database lookup result for "Isabelle10": NOT FOUND
   ‚ö†Ô∏è Value "Isabelle10" is not a valid referral code in database
   ‚ö†Ô∏è This means either: 1) Code doesn't exist, or 2) Referrer hasn't completed first payment yet
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: XDBH7894B1JA5FVZVE37RPBR98
{"ts":"2025-12-05T00:04:42.229Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"6872ad1f-316f-4e72-8293-8d05d376cd93","stage":"booking","correlationId":"booking-created:b96b5f31df1b6b05e8bb4e5b"}
{"ts":"2025-12-05T00:04:42.630Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"af71ac40-aeba-42f8-9e8c-6570c9b7faa1","stage":"booking","correlationId":"booking-created:cbdfc7398139a0e0894c098e","attempts":1}
üìÖ Processing booking created for customer: HTXX11HKQ0XJD2SK0DDKAXGHH0
Full booking data: {
  "id": "vlo2gidhkv3yu2",
  "allDay": false,
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94133-4608",
    "addressLine1": "550 Pacific Ave",
    "addressLine2": "",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-02T18:00:00Z",
  "version": 2,
  "createdAt": "2025-11-18T02:20:12Z",
  "updatedAt": "2025-12-02T19:31:46Z",
  "customerId": "HTXX11HKQ0XJD2SK0DDKAXGHH0",
  "locationId": "LNQKVBTQZN3EZ",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "HTXX11HKQ0XJD2SK0DDKAXGHH0",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMgsjtuk5cfKnstq",
      "anyTeamMember": false,
      "durationMinutes": 110,
      "serviceVariationId": "6TYOE67IDYTKHW2ZG6HKVZER",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1762893947284"
    },
    {
      "teamMemberId": "TMgsjtuk5cfKnstq",
      "anyTeamMember": false,
      "durationMinutes": 20,
      "serviceVariationId": "HAJX45W3U2WUCCXM5MI24UEE",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1762374620368"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Jade Rice
üéâ First booking detected for customer: HTXX11HKQ0XJD2SK0DDKAXGHH0
   Name: Jade Rice
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer HTXX11HKQ0XJD2SK0DDKAXGHH0...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "0826aee4-d259-434d-be44-511ac61b3629"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-06-01T01:57:17.408Z",
      "createdAt": "2025-06-01T01:57:17.408Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="0826aee4-d259-434d-be44-511ac61b3629"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "0826aee4-d259-434d-be44-511ac61b3629"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: HTXX11HKQ0XJD2SK0DDKAXGHH0
{"ts":"2025-12-05T00:04:43.036Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"af71ac40-aeba-42f8-9e8c-6570c9b7faa1","stage":"booking","correlationId":"booking-created:cbdfc7398139a0e0894c098e"}
{"ts":"2025-12-05T00:04:43.251Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"ff69836e-877d-42de-b2a1-2cd09870fae5","stage":"booking","correlationId":"booking-created:4558a22f3eada6601ca2819f","attempts":1}
üìÖ Processing booking created for customer: 3CW345RHSCDCZXH8T32XA2FGS8
Full booking data: {
  "id": "6fmpfwc447lvnt",
  "allDay": false,
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "startAt": "2025-12-02T18:30:00Z",
  "version": 2,
  "createdAt": "2025-12-02T18:42:58Z",
  "updatedAt": "2025-12-02T20:17:42Z",
  "customerId": "3CW345RHSCDCZXH8T32XA2FGS8",
  "locationId": "LT4ZHFBQQYB2N",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "creatorType": "TEAM_MEMBER",
    "teamMemberId": "TMQPbDVvvOCLwqsy"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TM9jDlRr_Hl4rdBB",
      "anyTeamMember": false,
      "durationMinutes": 90,
      "serviceVariationId": "XBUDIMNKOPC2XVG5YLIQ4RYS",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1764609577793"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Rania Ben Aoun
‚ÑπÔ∏è Customer 3CW345RHSCDCZXH8T32XA2FGS8 already received signup bonus, not first booking
{"ts":"2025-12-05T00:04:43.571Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"ff69836e-877d-42de-b2a1-2cd09870fae5","stage":"booking","correlationId":"booking-created:4558a22f3eada6601ca2819f"}
{"ts":"2025-12-05T00:04:43.917Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"51c72f78-50ad-4aa4-95a5-84e24a14658e","stage":"booking","correlationId":"booking-created:77fdabaca226d2b3787df260","attempts":1}
üìÖ Processing booking created for customer: 5TYM9H2R3CNGP5YFR3YE9Y74J8
Full booking data: {
  "id": "4flizy6ezed03w",
  "allDay": false,
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94123-3940",
    "addressLine1": "2266 Union St",
    "addressLine2": "",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-02T18:50:00Z",
  "version": 2,
  "createdAt": "2025-11-17T21:12:39Z",
  "updatedAt": "2025-12-02T20:11:22Z",
  "customerId": "5TYM9H2R3CNGP5YFR3YE9Y74J8",
  "locationId": "LT4ZHFBQQYB2N",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "5TYM9H2R3CNGP5YFR3YE9Y74J8",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TM7_r-KmvY9xjnEU",
      "anyTeamMember": false,
      "durationMinutes": 110,
      "serviceVariationId": "GJ5SRTYFV6ZCDI62TMSZP2OP",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1762893947284"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Erin McGuinness
üéâ First booking detected for customer: 5TYM9H2R3CNGP5YFR3YE9Y74J8
   Name: Erin McGuinness
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 5TYM9H2R3CNGP5YFR3YE9Y74J8...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
      ],
      "version": 2,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-07-28T17:29:01.658Z",
      "createdAt": "2025-03-20T16:27:04.384Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 5TYM9H2R3CNGP5YFR3YE9Y74J8
{"ts":"2025-12-05T00:04:44.477Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"51c72f78-50ad-4aa4-95a5-84e24a14658e","stage":"booking","correlationId":"booking-created:77fdabaca226d2b3787df260"}
{"ts":"2025-12-05T00:04:44.998Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"41fb9f14-e79d-4a0e-925e-990480f78e1f","stage":"booking","correlationId":"booking-created:52562a142283e2ba5704cd3b","attempts":1}
üìÖ Processing booking created for customer: 3NJ6BX3M3S31F6QJQMT3BF2MZR
Full booking data: {
  "id": "keliwerr56wx57",
  "allDay": false,
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94133-4608",
    "addressLine1": "550 Pacific Ave",
    "addressLine2": "",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-02T19:00:00Z",
  "version": 2,
  "createdAt": "2025-11-10T17:54:47Z",
  "updatedAt": "2025-12-02T20:08:52Z",
  "customerId": "3NJ6BX3M3S31F6QJQMT3BF2MZR",
  "locationId": "LNQKVBTQZN3EZ",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "creatorType": "TEAM_MEMBER",
    "teamMemberId": "TMWAtQTYmZpwwxii"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMVwAQUdLz6no-cB",
      "anyTeamMember": false,
      "durationMinutes": 90,
      "serviceVariationId": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1758921239397"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Cryztal Sayle
üéâ First booking detected for customer: 3NJ6BX3M3S31F6QJQMT3BF2MZR
   Name: Cryztal Sayle
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 3NJ6BX3M3S31F6QJQMT3BF2MZR...
   Full custom attributes response: {}
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 3NJ6BX3M3S31F6QJQMT3BF2MZR
{"ts":"2025-12-05T00:04:45.619Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"41fb9f14-e79d-4a0e-925e-990480f78e1f","stage":"booking","correlationId":"booking-created:52562a142283e2ba5704cd3b"}
{"ts":"2025-12-05T00:04:46.014Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"22e87cd8-2e28-423f-9576-36a34f4ea724","stage":"booking","correlationId":"booking-created:cdf33df781bdc817c38f90fc","attempts":1}
üìÖ Processing booking created for customer: N7G5C5798X7V927ZW29PZ3BCF4
Full booking data: {
  "id": "ozg6typ4pdesix",
  "allDay": false,
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94123-3940",
    "addressLine1": "2266 Union St",
    "addressLine2": "",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-02T19:00:00Z",
  "version": 3,
  "createdAt": "2025-11-19T19:28:47Z",
  "updatedAt": "2025-12-02T20:28:53Z",
  "customerId": "N7G5C5798X7V927ZW29PZ3BCF4",
  "locationId": "LT4ZHFBQQYB2N",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "N7G5C5798X7V927ZW29PZ3BCF4",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMMHlgFBIFbMTRap",
      "anyTeamMember": false,
      "durationMinutes": 100,
      "serviceVariationId": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1758921239397"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Courtney Giraudo
üéâ First booking detected for customer: N7G5C5798X7V927ZW29PZ3BCF4
   Name: Courtney Giraudo
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer N7G5C5798X7V927ZW29PZ3BCF4...
   Full custom attributes response: {}
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: N7G5C5798X7V927ZW29PZ3BCF4
{"ts":"2025-12-05T00:04:46.572Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"22e87cd8-2e28-423f-9576-36a34f4ea724","stage":"booking","correlationId":"booking-created:cdf33df781bdc817c38f90fc"}
{"ts":"2025-12-05T00:04:46.876Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"c110731a-c2fc-486c-b06a-0a3b7774bf3e","stage":"booking","correlationId":"booking-created:3bda683efcbf0b79dd4c08cb","attempts":1}
üìÖ Processing booking created for customer: S000J7PCWP5EDFF3KKA94S6EFR
Full booking data: {
  "id": "q4ri7567w9j00l",
  "allDay": false,
  "source": "FIRST_PARTY_BUYER",
  "status": "CANCELLED_BY_CUSTOMER",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94133-4608",
    "addressLine1": "550 Pacific Ave",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-02T19:50:00Z",
  "version": 1,
  "createdAt": "2025-11-02T21:25:29Z",
  "updatedAt": "2025-11-11T05:34:19Z",
  "customerId": "S000J7PCWP5EDFF3KKA94S6EFR",
  "locationId": "LNQKVBTQZN3EZ",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "S000J7PCWP5EDFF3KKA94S6EFR",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMgsjtuk5cfKnstq",
      "anyTeamMember": false,
      "durationMinutes": 110,
      "serviceVariationId": "6TYOE67IDYTKHW2ZG6HKVZER",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1761597690235"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Jasveen Sodhi
üéâ First booking detected for customer: S000J7PCWP5EDFF3KKA94S6EFR
   Name: Jasveen Sodhi
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer S000J7PCWP5EDFF3KKA94S6EFR...
   Full custom attributes response: {}
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: S000J7PCWP5EDFF3KKA94S6EFR
{"ts":"2025-12-05T00:04:47.325Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"c110731a-c2fc-486c-b06a-0a3b7774bf3e","stage":"booking","correlationId":"booking-created:3bda683efcbf0b79dd4c08cb"}
{"ts":"2025-12-05T00:04:47.620Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"c2b524dd-a416-422c-b26e-62660bb667ee","stage":"booking","correlationId":"booking-created:d6a4634009d5cb1266be5352","attempts":1}
üìÖ Processing booking created for customer: JHSRA7KN16Z63EMD1HV8T1757R
Full booking data: {
  "id": "08gg8fhs4cwb5i",
  "allDay": false,
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "startAt": "2025-12-02T20:00:00Z",
  "version": 4,
  "createdAt": "2025-11-04T22:57:17Z",
  "updatedAt": "2025-12-02T21:23:46Z",
  "customerId": "JHSRA7KN16Z63EMD1HV8T1757R",
  "locationId": "LNQKVBTQZN3EZ",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "creatorType": "TEAM_MEMBER",
    "teamMemberId": "TMWAtQTYmZpwwxii"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMILsQUVwLkLzbVo",
      "anyTeamMember": false,
      "durationMinutes": 90,
      "serviceVariationId": "BM556FTNFOTEHYVG4GPXAXFM",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1759193842205"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Alexis Haynes
üéâ First booking detected for customer: JHSRA7KN16Z63EMD1HV8T1757R
   Name: Alexis Haynes
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer JHSRA7KN16Z63EMD1HV8T1757R...
   Full custom attributes response: {}
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: JHSRA7KN16Z63EMD1HV8T1757R
{"ts":"2025-12-05T00:04:48.223Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"c2b524dd-a416-422c-b26e-62660bb667ee","stage":"booking","correlationId":"booking-created:d6a4634009d5cb1266be5352"}
{"ts":"2025-12-05T00:04:48.497Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"05a61092-a2d7-4475-ab10-14db4f430fc6","stage":"booking","correlationId":"booking-created:998b85426b83dd0d6bf9e194","attempts":1}
üìÖ Processing booking created for customer: T68MMN7DCF1GG5ZX26JSKT62GC
Full booking data: {
  "id": "q7gnde337y4zis",
  "allDay": false,
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "startAt": "2025-12-02T20:10:00Z",
  "version": 2,
  "createdAt": "2025-11-26T20:08:23Z",
  "updatedAt": "2025-12-03T17:35:48Z",
  "customerId": "T68MMN7DCF1GG5ZX26JSKT62GC",
  "locationId": "LNQKVBTQZN3EZ",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "creatorType": "TEAM_MEMBER",
    "teamMemberId": "TMWAtQTYmZpwwxii"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMdagA6g0F03A7_w",
      "anyTeamMember": false,
      "durationMinutes": 140,
      "serviceVariationId": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1763586786564"
    },
    {
      "teamMemberId": "TMdagA6g0F03A7_w",
      "anyTeamMember": false,
      "durationMinutes": 5,
      "serviceVariationId": "DBRXEHQPCF7V4APTHDQTZW62",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1762374620368"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Yana Zorina
üéâ First booking detected for customer: T68MMN7DCF1GG5ZX26JSKT62GC
   Name: Yana Zorina
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer T68MMN7DCF1GG5ZX26JSKT62GC...
   Full custom attributes response: {}
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: T68MMN7DCF1GG5ZX26JSKT62GC
{"ts":"2025-12-05T00:04:48.993Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"05a61092-a2d7-4475-ab10-14db4f430fc6","stage":"booking","correlationId":"booking-created:998b85426b83dd0d6bf9e194"}
{"ts":"2025-12-05T00:04:49.255Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"ee7d4126-b29a-4faf-8017-7f01fb8c3112","stage":"booking","correlationId":"booking-created:7f1cc2c1136b024e5eed7213","attempts":1}
üìÖ Processing booking created for customer: T68MMN7DCF1GG5ZX26JSKT62GC
Full booking data: {
  "id": "x99pnyjefpxep4",
  "allDay": false,
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "startAt": "2025-12-02T20:10:00Z",
  "version": 4,
  "createdAt": "2025-11-26T20:07:32Z",
  "updatedAt": "2025-12-03T17:35:47Z",
  "customerId": "T68MMN7DCF1GG5ZX26JSKT62GC",
  "locationId": "LNQKVBTQZN3EZ",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "creatorType": "TEAM_MEMBER",
    "teamMemberId": "TMWAtQTYmZpwwxii"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMgsjtuk5cfKnstq",
      "anyTeamMember": false,
      "durationMinutes": 90,
      "serviceVariationId": "63PG6RLS2NHWRD5JRXEC74HN",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1760895536505"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Yana Zorina
üéâ First booking detected for customer: T68MMN7DCF1GG5ZX26JSKT62GC
   Name: Yana Zorina
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer T68MMN7DCF1GG5ZX26JSKT62GC...
   Full custom attributes response: {}
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: T68MMN7DCF1GG5ZX26JSKT62GC
{"ts":"2025-12-05T00:04:49.714Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"ee7d4126-b29a-4faf-8017-7f01fb8c3112","stage":"booking","correlationId":"booking-created:7f1cc2c1136b024e5eed7213"}
{"ts":"2025-12-05T00:04:50.102Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"312b8e0f-ab07-4d69-a41f-dbf47afde6ac","stage":"booking","correlationId":"booking-created:25e90c28e389a106d43a4255","attempts":1}
üìÖ Processing booking created for customer: Y4BC8KGTD2PZ3ZB04916RKP85M
Full booking data: {
  "id": "7i7t3s19lbvppv",
  "allDay": false,
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94133-4608",
    "addressLine1": "550 Pacific Ave",
    "addressLine2": "",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-02T20:30:00Z",
  "version": 5,
  "createdAt": "2025-11-11T20:22:35Z",
  "updatedAt": "2025-12-02T22:02:21Z",
  "customerId": "Y4BC8KGTD2PZ3ZB04916RKP85M",
  "locationId": "LNQKVBTQZN3EZ",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "creatorType": "TEAM_MEMBER",
    "teamMemberId": "TMWAtQTYmZpwwxii"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMVwAQUdLz6no-cB",
      "anyTeamMember": false,
      "durationMinutes": 80,
      "serviceVariationId": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1758921239397"
    },
    {
      "resourceIds": [
        "5OVIQ6GSSUXORACP6T7WBAQ7"
      ],
      "teamMemberId": "TMVwAQUdLz6no-cB",
      "anyTeamMember": false,
      "durationMinutes": 60,
      "serviceVariationId": "63PG6RLS2NHWRD5JRXEC74HN",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1760895536505"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Carrie Maxwell
üéâ First booking detected for customer: Y4BC8KGTD2PZ3ZB04916RKP85M
   Name: Carrie Maxwell
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer Y4BC8KGTD2PZ3ZB04916RKP85M...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "0826aee4-d259-434d-be44-511ac61b3629"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-02-24T22:06:08.826Z",
      "createdAt": "2025-02-24T22:06:08.826Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="0826aee4-d259-434d-be44-511ac61b3629"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "0826aee4-d259-434d-be44-511ac61b3629"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: Y4BC8KGTD2PZ3ZB04916RKP85M
{"ts":"2025-12-05T00:04:50.771Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"312b8e0f-ab07-4d69-a41f-dbf47afde6ac","stage":"booking","correlationId":"booking-created:25e90c28e389a106d43a4255"}
{"ts":"2025-12-05T00:04:51.289Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"3ca45d6d-0992-4ada-9fdf-5de1fb8e435d","stage":"booking","correlationId":"booking-created:ee32837c57edf939d220f751","attempts":1}
üìÖ Processing booking created for customer: P8F14M0HPR5KYEM70AH708K69W
Full booking data: {
  "id": "42qrgrjyeqz070",
  "allDay": false,
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94123-3940",
    "addressLine1": "2266 Union St",
    "addressLine2": "",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-02T20:40:00Z",
  "version": 2,
  "createdAt": "2025-12-01T23:23:38Z",
  "updatedAt": "2025-12-02T21:59:52Z",
  "customerId": "P8F14M0HPR5KYEM70AH708K69W",
  "locationId": "LT4ZHFBQQYB2N",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "P8F14M0HPR5KYEM70AH708K69W",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMMHlgFBIFbMTRap",
      "anyTeamMember": false,
      "durationMinutes": 120,
      "serviceVariationId": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1764609601083"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Susie Roy
üéâ First booking detected for customer: P8F14M0HPR5KYEM70AH708K69W
   Name: Susie Roy
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer P8F14M0HPR5KYEM70AH708K69W...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-12-01T23:23:38.296Z",
      "createdAt": "2025-12-01T23:23:38.296Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: P8F14M0HPR5KYEM70AH708K69W
{"ts":"2025-12-05T00:04:51.869Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"3ca45d6d-0992-4ada-9fdf-5de1fb8e435d","stage":"booking","correlationId":"booking-created:ee32837c57edf939d220f751"}
{"ts":"2025-12-05T00:04:52.304Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"562dbcab-10ed-463f-aad3-b1e5894f31d6","stage":"booking","correlationId":"booking-created:85dde6fc478ba3eaa6059c05","attempts":1}
üìÖ Processing booking created for customer: GN2VNDAW4AWKRKAARXHXBM0Z4C
Full booking data: {
  "id": "r8n6xfhguallro",
  "allDay": false,
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "startAt": "2025-12-02T21:00:00Z",
  "version": 2,
  "createdAt": "2025-11-29T00:44:29Z",
  "updatedAt": "2025-12-02T20:50:11Z",
  "customerId": "GN2VNDAW4AWKRKAARXHXBM0Z4C",
  "locationId": "LT4ZHFBQQYB2N",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "creatorType": "TEAM_MEMBER",
    "teamMemberId": "TMQPbDVvvOCLwqsy"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TM9jDlRr_Hl4rdBB",
      "anyTeamMember": false,
      "durationMinutes": 90,
      "serviceVariationId": "XBUDIMNKOPC2XVG5YLIQ4RYS",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1764191999049"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Shefali Razdan
üéâ First booking detected for customer: GN2VNDAW4AWKRKAARXHXBM0Z4C
   Name: Shefali Razdan
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer GN2VNDAW4AWKRKAARXHXBM0Z4C...
   Full custom attributes response: {}
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: GN2VNDAW4AWKRKAARXHXBM0Z4C
{"ts":"2025-12-05T00:04:52.858Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"562dbcab-10ed-463f-aad3-b1e5894f31d6","stage":"booking","correlationId":"booking-created:85dde6fc478ba3eaa6059c05"}
{"ts":"2025-12-05T00:04:53.178Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"b458fb91-fde7-4a85-983d-438e0da9ad7c","stage":"booking","correlationId":"booking-created:8115e6d582401498c1d9f839","attempts":1}
üìÖ Processing booking created for customer: ZRCDXYKX325WFF247E2DMQ48T0
Full booking data: {
  "id": "1y0m8mzsl79sqp",
  "allDay": false,
  "source": "FIRST_PARTY_BUYER",
  "status": "CANCELLED_BY_CUSTOMER",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94133-4608",
    "addressLine1": "550 Pacific Ave",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-02T21:40:00Z",
  "version": 1,
  "createdAt": "2025-11-03T01:25:10Z",
  "updatedAt": "2025-12-01T21:20:41Z",
  "customerId": "ZRCDXYKX325WFF247E2DMQ48T0",
  "locationId": "LNQKVBTQZN3EZ",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "ZRCDXYKX325WFF247E2DMQ48T0",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMILsQUVwLkLzbVo",
      "anyTeamMember": false,
      "durationMinutes": 90,
      "serviceVariationId": "BM556FTNFOTEHYVG4GPXAXFM",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1761597690235"
    },
    {
      "teamMemberId": "TMILsQUVwLkLzbVo",
      "anyTeamMember": false,
      "durationMinutes": 20,
      "serviceVariationId": "HAJX45W3U2WUCCXM5MI24UEE",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1760895536505"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Maral Amir
üéâ First booking detected for customer: ZRCDXYKX325WFF247E2DMQ48T0
   Name: Maral Amir
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer ZRCDXYKX325WFF247E2DMQ48T0...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "fd306114-9968-4fe0-9bde-53f9bf837f39"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-10-28T20:29:28.853Z",
      "createdAt": "2025-10-28T20:29:28.853Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="fd306114-9968-4fe0-9bde-53f9bf837f39"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "fd306114-9968-4fe0-9bde-53f9bf837f39"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: ZRCDXYKX325WFF247E2DMQ48T0
{"ts":"2025-12-05T00:04:53.625Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"b458fb91-fde7-4a85-983d-438e0da9ad7c","stage":"booking","correlationId":"booking-created:8115e6d582401498c1d9f839"}
{"ts":"2025-12-05T00:04:53.788Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"4f5653ec-729d-4a7d-b3c0-c7fb836f000e","stage":"booking","correlationId":"booking-created:19a64f39dcbba8107369154a","attempts":1}
üìÖ Processing booking created for customer: D6DAGEY5YMWNRTXERPR7XVAMY0
Full booking data: {
  "id": "gi8ak4tg8w4sh5",
  "allDay": false,
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94133-4608",
    "addressLine1": "550 Pacific Ave",
    "addressLine2": "",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-02T21:40:00Z",
  "version": 2,
  "createdAt": "2025-11-05T06:19:08Z",
  "updatedAt": "2025-12-02T23:36:11Z",
  "customerId": "D6DAGEY5YMWNRTXERPR7XVAMY0",
  "locationId": "LNQKVBTQZN3EZ",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "D6DAGEY5YMWNRTXERPR7XVAMY0",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMgsjtuk5cfKnstq",
      "anyTeamMember": false,
      "durationMinutes": 110,
      "serviceVariationId": "6TYOE67IDYTKHW2ZG6HKVZER",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1761597690235"
    },
    {
      "teamMemberId": "TMgsjtuk5cfKnstq",
      "anyTeamMember": false,
      "durationMinutes": 20,
      "serviceVariationId": "HAJX45W3U2WUCCXM5MI24UEE",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1760895536505"
    },
    {
      "teamMemberId": "TMgsjtuk5cfKnstq",
      "anyTeamMember": false,
      "durationMinutes": 15,
      "serviceVariationId": "KBHPHVKLJNAF223GMYIRUUH3",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1760895536505"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Daisy Long
üéâ First booking detected for customer: D6DAGEY5YMWNRTXERPR7XVAMY0
   Name: Daisy Long
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer D6DAGEY5YMWNRTXERPR7XVAMY0...
   Full custom attributes response: {}
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: D6DAGEY5YMWNRTXERPR7XVAMY0
{"ts":"2025-12-05T00:04:54.250Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"4f5653ec-729d-4a7d-b3c0-c7fb836f000e","stage":"booking","correlationId":"booking-created:19a64f39dcbba8107369154a"}
{"ts":"2025-12-05T00:04:54.499Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"03aadcdc-d3be-4655-b241-4708170a1852","stage":"booking","correlationId":"booking-created:bf4dc141851f187b195d1585","attempts":1}
üìÖ Processing booking created for customer: M6CRRAP9FAQ6HSTZSXGMEHAKDR
Full booking data: {
  "id": "3dml13lfskwapi",
  "allDay": false,
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "startAt": "2025-12-02T22:00:00Z",
  "version": 4,
  "createdAt": "2025-11-05T20:54:13Z",
  "updatedAt": "2025-12-02T23:52:12Z",
  "customerId": "M6CRRAP9FAQ6HSTZSXGMEHAKDR",
  "locationId": "LNQKVBTQZN3EZ",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "creatorType": "TEAM_MEMBER",
    "teamMemberId": "TMWAtQTYmZpwwxii"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMILsQUVwLkLzbVo",
      "anyTeamMember": false,
      "durationMinutes": 90,
      "serviceVariationId": "BM556FTNFOTEHYVG4GPXAXFM",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1757963765505"
    },
    {
      "teamMemberId": "TMILsQUVwLkLzbVo",
      "anyTeamMember": false,
      "durationMinutes": 30,
      "serviceVariationId": "LFLFEZO7L46URIM2OVZOJADI",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1762374620368"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Yuliana Nevarez
üéâ First booking detected for customer: M6CRRAP9FAQ6HSTZSXGMEHAKDR
   Name: Yuliana Nevarez
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer M6CRRAP9FAQ6HSTZSXGMEHAKDR...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-06-13T23:00:36.321Z",
      "createdAt": "2025-06-13T23:00:36.321Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: M6CRRAP9FAQ6HSTZSXGMEHAKDR
{"ts":"2025-12-05T00:04:54.926Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"03aadcdc-d3be-4655-b241-4708170a1852","stage":"booking","correlationId":"booking-created:bf4dc141851f187b195d1585"}
{"ts":"2025-12-05T00:04:55.094Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"8b813738-9e92-4b3e-bde7-5d7488e4ba6d","stage":"booking","correlationId":"booking-created:78bb800510157515c226a0a7","attempts":1}
üìÖ Processing booking created for customer: 6PQ82YBVJ5G1WRQ46A1KR3KWBM
Full booking data: {
  "id": "heo26146zxnqzj",
  "allDay": false,
  "source": "FIRST_PARTY_MERCHANT",
  "status": "CANCELLED_BY_SELLER",
  "startAt": "2025-12-02T22:00:00Z",
  "version": 5,
  "createdAt": "2025-12-02T19:42:11Z",
  "updatedAt": "2025-12-02T22:29:02Z",
  "customerId": "6PQ82YBVJ5G1WRQ46A1KR3KWBM",
  "locationId": "LNQKVBTQZN3EZ",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "creatorType": "TEAM_MEMBER",
    "teamMemberId": "TMWAtQTYmZpwwxii"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TM-zXe9fXe4axYWn",
      "anyTeamMember": false,
      "durationMinutes": 30,
      "serviceVariationId": "SGSLS3INMK5YV637KUITCILL",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1760895536505"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Candice Adden
üéâ First booking detected for customer: 6PQ82YBVJ5G1WRQ46A1KR3KWBM
   Name: Candice Adden
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 6PQ82YBVJ5G1WRQ46A1KR3KWBM...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-11-02T20:59:34.231Z",
      "createdAt": "2025-11-02T20:59:34.231Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 6PQ82YBVJ5G1WRQ46A1KR3KWBM
{"ts":"2025-12-05T00:04:55.522Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"8b813738-9e92-4b3e-bde7-5d7488e4ba6d","stage":"booking","correlationId":"booking-created:78bb800510157515c226a0a7"}
{"ts":"2025-12-05T00:04:55.703Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"107ff239-106d-43b2-b3e7-cb1443b60893","stage":"booking","correlationId":"booking-created:5180fc488eab380fecdbe3e8","attempts":1}
üìÖ Processing booking created for customer: XERB3P3EVSTPSZVRMX379F28R8
Full booking data: {
  "id": "q16ugafiik4he3",
  "allDay": false,
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94123-3940",
    "addressLine1": "2266 Union St",
    "addressLine2": "",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-02T22:10:00Z",
  "version": 2,
  "createdAt": "2025-11-18T21:30:39Z",
  "updatedAt": "2025-12-02T23:29:37Z",
  "customerId": "XERB3P3EVSTPSZVRMX379F28R8",
  "locationId": "LT4ZHFBQQYB2N",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "XERB3P3EVSTPSZVRMX379F28R8",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "resourceIds": [
        "KAOXILA4CV7A23VRAACC4R66"
      ],
      "teamMemberId": "TM7_r-KmvY9xjnEU",
      "anyTeamMember": false,
      "durationMinutes": 90,
      "serviceVariationId": "ZEAKNB35I37RMXNUBGWDZQIM",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1760895536505"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Katie Keitges
üéâ First booking detected for customer: XERB3P3EVSTPSZVRMX379F28R8
   Name: Katie Keitges
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer XERB3P3EVSTPSZVRMX379F28R8...
   Full custom attributes response: {}
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: XERB3P3EVSTPSZVRMX379F28R8
{"ts":"2025-12-05T00:04:56.089Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"107ff239-106d-43b2-b3e7-cb1443b60893","stage":"booking","correlationId":"booking-created:5180fc488eab380fecdbe3e8"}
{"ts":"2025-12-05T00:04:56.261Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"4fc370a0-907b-421e-a49a-dce7d96c6b3b","stage":"booking","correlationId":"booking-created:63f5e1c0dd51d0274726e625","attempts":1}
üìÖ Processing booking created for customer: 4S77B84J2X58S9PRGRPEPC8XBM
Full booking data: {
  "id": "e02m5q5gkmvv81",
  "allDay": false,
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "startAt": "2025-12-02T22:30:00Z",
  "version": 4,
  "createdAt": "2025-12-01T23:10:30Z",
  "updatedAt": "2025-12-02T23:31:06Z",
  "customerId": "4S77B84J2X58S9PRGRPEPC8XBM",
  "locationId": "LT4ZHFBQQYB2N",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "creatorType": "TEAM_MEMBER",
    "teamMemberId": "TMQPbDVvvOCLwqsy"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TM9jDlRr_Hl4rdBB",
      "anyTeamMember": false,
      "durationMinutes": 90,
      "serviceVariationId": "XBUDIMNKOPC2XVG5YLIQ4RYS",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1764609577793"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Lilli Ouyang
üéâ First booking detected for customer: 4S77B84J2X58S9PRGRPEPC8XBM
   Name: Lilli Ouyang
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 4S77B84J2X58S9PRGRPEPC8XBM...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "a7b40271-729a-41aa-801b-fb1fffb83650"
      ],
      "version": 2,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-10-27T01:35:46.243Z",
      "createdAt": "2025-10-27T01:35:45.668Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="a7b40271-729a-41aa-801b-fb1fffb83650"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "a7b40271-729a-41aa-801b-fb1fffb83650"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 4S77B84J2X58S9PRGRPEPC8XBM
{"ts":"2025-12-05T00:04:56.625Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"4fc370a0-907b-421e-a49a-dce7d96c6b3b","stage":"booking","correlationId":"booking-created:63f5e1c0dd51d0274726e625"}
{"ts":"2025-12-05T00:04:56.786Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"53de0abc-2d4a-4abc-ae66-0764a21d1d22","stage":"booking","correlationId":"booking-created:30535ca0b89e527334d2e318","attempts":1}
üìÖ Processing booking created for customer: RZCYD3W904QGWTQX6C521PBH94
Full booking data: {
  "id": "tg4r5xhu1s9iay",
  "allDay": false,
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94133-4608",
    "addressLine1": "550 Pacific Ave",
    "addressLine2": "",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-02T22:35:00Z",
  "version": 4,
  "createdAt": "2025-12-02T05:38:40Z",
  "updatedAt": "2025-12-02T23:41:56Z",
  "customerId": "RZCYD3W904QGWTQX6C521PBH94",
  "locationId": "LNQKVBTQZN3EZ",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "RZCYD3W904QGWTQX6C521PBH94",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMVwAQUdLz6no-cB",
      "anyTeamMember": false,
      "durationMinutes": 100,
      "serviceVariationId": "GSZZR45VJXB44NF4P4WXI5NB",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1764609577793"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Lisa Glv
‚ÑπÔ∏è Customer RZCYD3W904QGWTQX6C521PBH94 already received signup bonus, not first booking
{"ts":"2025-12-05T00:04:56.921Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"53de0abc-2d4a-4abc-ae66-0764a21d1d22","stage":"booking","correlationId":"booking-created:30535ca0b89e527334d2e318"}
{"ts":"2025-12-05T00:04:57.167Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"92867bc4-4ab1-41f7-a18f-2d0a4d240ee6","stage":"booking","correlationId":"booking-created:2c30da700e43ebeb4841c9fc","attempts":1}
üìÖ Processing booking created for customer: 028EB4QW8W716GTDSZ5MNXG8NC
Full booking data: {
  "id": "y986u4eujzd7uj",
  "allDay": false,
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94123-3940",
    "addressLine1": "2266 Union St",
    "addressLine2": "",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-02T22:40:00Z",
  "version": 3,
  "createdAt": "2025-11-24T16:56:44Z",
  "updatedAt": "2025-12-02T23:56:12Z",
  "customerId": "028EB4QW8W716GTDSZ5MNXG8NC",
  "locationId": "LT4ZHFBQQYB2N",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "028EB4QW8W716GTDSZ5MNXG8NC",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMMHlgFBIFbMTRap",
      "anyTeamMember": false,
      "durationMinutes": 100,
      "serviceVariationId": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1763586786564"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Abby Marmer
üéâ First booking detected for customer: 028EB4QW8W716GTDSZ5MNXG8NC
   Name: Abby Marmer
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 028EB4QW8W716GTDSZ5MNXG8NC...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "af5791f8-348a-422e-98d1-5e865121bb19"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-11-24T16:56:44.287Z",
      "createdAt": "2025-11-24T16:56:44.287Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="af5791f8-348a-422e-98d1-5e865121bb19"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "af5791f8-348a-422e-98d1-5e865121bb19"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 028EB4QW8W716GTDSZ5MNXG8NC
{"ts":"2025-12-05T00:04:57.636Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"92867bc4-4ab1-41f7-a18f-2d0a4d240ee6","stage":"booking","correlationId":"booking-created:2c30da700e43ebeb4841c9fc"}
{"ts":"2025-12-05T00:04:57.813Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"d5cb5477-8717-4249-b909-cdc20fe27306","stage":"booking","correlationId":"booking-created:bcf4530c75afd679ad947d5f","attempts":1}
üìÖ Processing booking created for customer: AQJM14K5E90BB90WSPPYEMEN1R
Full booking data: {
  "id": "ut1nnh1154n4vd",
  "allDay": false,
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "startAt": "2025-12-02T22:50:00Z",
  "version": 3,
  "createdAt": "2025-12-01T20:12:57Z",
  "updatedAt": "2025-12-03T00:30:41Z",
  "customerId": "AQJM14K5E90BB90WSPPYEMEN1R",
  "locationId": "LT4ZHFBQQYB2N",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "creatorType": "TEAM_MEMBER",
    "teamMemberId": "TMQPbDVvvOCLwqsy"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMyUMvTJIj2HrHSg",
      "anyTeamMember": false,
      "durationMinutes": 90,
      "serviceVariationId": "JMTK5M2CY2W7WEXSTAJKAJ35",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1762893947284"
    },
    {
      "teamMemberId": "TMyUMvTJIj2HrHSg",
      "anyTeamMember": false,
      "durationMinutes": 10,
      "serviceVariationId": "6F6F3OAFJSOEN3X7HSXYIVQC",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1760895536505"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Anne Fung
üéâ First booking detected for customer: AQJM14K5E90BB90WSPPYEMEN1R
   Name: Anne Fung
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer AQJM14K5E90BB90WSPPYEMEN1R...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-10-05T15:55:40.465Z",
      "createdAt": "2025-10-05T15:55:40.465Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: AQJM14K5E90BB90WSPPYEMEN1R
{"ts":"2025-12-05T00:04:58.230Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"d5cb5477-8717-4249-b909-cdc20fe27306","stage":"booking","correlationId":"booking-created:bcf4530c75afd679ad947d5f"}
{"ts":"2025-12-05T00:04:58.392Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"14925f3d-d762-476f-9677-46a46831104b","stage":"booking","correlationId":"booking-created:d26c9d44224938627676dbf2","attempts":1}
üìÖ Processing booking created for customer: YTBM2Q2XV23WW25KR2W25CF934
Full booking data: {
  "id": "7bhoi0mqkpkmry",
  "allDay": false,
  "source": "FIRST_PARTY_BUYER",
  "status": "CANCELLED_BY_CUSTOMER",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94123-3940",
    "addressLine1": "2266 Union St",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-02T23:00:00Z",
  "version": 1,
  "createdAt": "2025-11-05T00:50:03Z",
  "updatedAt": "2025-11-24T23:00:41Z",
  "customerId": "YTBM2Q2XV23WW25KR2W25CF934",
  "locationId": "LT4ZHFBQQYB2N",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "YTBM2Q2XV23WW25KR2W25CF934",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TM9jDlRr_Hl4rdBB",
      "anyTeamMember": false,
      "durationMinutes": 90,
      "serviceVariationId": "XBUDIMNKOPC2XVG5YLIQ4RYS",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1761597690235"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: jacqueline baumann
üéâ First booking detected for customer: YTBM2Q2XV23WW25KR2W25CF934
   Name: jacqueline baumann
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer YTBM2Q2XV23WW25KR2W25CF934...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "c0f2ee04-4762-42c6-a593-a4e745a81c92"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-05-20T01:44:33.151Z",
      "createdAt": "2025-05-20T01:44:33.151Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="c0f2ee04-4762-42c6-a593-a4e745a81c92"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "c0f2ee04-4762-42c6-a593-a4e745a81c92"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: YTBM2Q2XV23WW25KR2W25CF934
{"ts":"2025-12-05T00:04:58.759Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"14925f3d-d762-476f-9677-46a46831104b","stage":"booking","correlationId":"booking-created:d26c9d44224938627676dbf2"}
{"ts":"2025-12-05T00:04:58.927Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"62661a64-33fb-46d6-85ab-c5d873c3d904","stage":"booking","correlationId":"booking-created:924d9d64e511b34c59b452d2","attempts":1}
üìÖ Processing booking created for customer: ET5W3RZZ5RKFX9G93C7CQB7HV0
Full booking data: {
  "id": "4nwzw9nzxa68zm",
  "allDay": false,
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94123-3940",
    "addressLine1": "2266 Union St",
    "addressLine2": "",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-02T23:40:00Z",
  "version": 3,
  "createdAt": "2025-11-30T04:47:09Z",
  "updatedAt": "2025-12-03T01:34:22Z",
  "customerId": "ET5W3RZZ5RKFX9G93C7CQB7HV0",
  "locationId": "LT4ZHFBQQYB2N",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "ET5W3RZZ5RKFX9G93C7CQB7HV0",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TM7_r-KmvY9xjnEU",
      "anyTeamMember": false,
      "durationMinutes": 110,
      "serviceVariationId": "GJ5SRTYFV6ZCDI62TMSZP2OP",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1764191999049"
    },
    {
      "teamMemberId": "TM7_r-KmvY9xjnEU",
      "anyTeamMember": false,
      "durationMinutes": 20,
      "serviceVariationId": "HAJX45W3U2WUCCXM5MI24UEE",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1763586786564"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Julianna Qvistgaard
üéâ First booking detected for customer: ET5W3RZZ5RKFX9G93C7CQB7HV0
   Name: Julianna Qvistgaard
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer ET5W3RZZ5RKFX9G93C7CQB7HV0...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "af5791f8-348a-422e-98d1-5e865121bb19"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-10-19T23:20:58.588Z",
      "createdAt": "2025-10-19T23:20:58.588Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="af5791f8-348a-422e-98d1-5e865121bb19"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "af5791f8-348a-422e-98d1-5e865121bb19"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: ET5W3RZZ5RKFX9G93C7CQB7HV0
{"ts":"2025-12-05T00:04:59.366Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"62661a64-33fb-46d6-85ab-c5d873c3d904","stage":"booking","correlationId":"booking-created:924d9d64e511b34c59b452d2"}
{"ts":"2025-12-05T00:04:59.527Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"8e7e0648-ff8a-4942-914d-14d256177f57","stage":"booking","correlationId":"booking-created:6dcc02806c1946c66f122a81","attempts":1}
üìÖ Processing booking created for customer: 65TDNNHNZK4B3JFDSJ6Z4MFXFR
Full booking data: {
  "id": "17m4fkb26xitxg",
  "allDay": false,
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94133-4608",
    "addressLine1": "550 Pacific Ave",
    "addressLine2": "",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-03T00:00:00Z",
  "version": 6,
  "createdAt": "2025-11-06T03:44:10Z",
  "updatedAt": "2025-12-03T02:24:46Z",
  "customerId": "65TDNNHNZK4B3JFDSJ6Z4MFXFR",
  "locationId": "LNQKVBTQZN3EZ",
  "sellerNote": "$20 discount Darima‚Äôs fault –ò–°–ü–û–õ–¨–ó–û–í–ê–¢–¨ –°–ö–ò–î–ö–£ –ö–û–ì–î–ê –ü–ê–ö–ï–¢ –ó–ê–ö–û–ù–ß–ò–¢–°–Ø",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "65TDNNHNZK4B3JFDSJ6Z4MFXFR",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TM-zXe9fXe4axYWn",
      "anyTeamMember": false,
      "durationMinutes": 90,
      "serviceVariationId": "U5TVSCVGAEQCWV7PCCER37UX",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1762374620368"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Ash Wang
üéâ First booking detected for customer: 65TDNNHNZK4B3JFDSJ6Z4MFXFR
   Name: Ash Wang
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 65TDNNHNZK4B3JFDSJ6Z4MFXFR...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "c0f2ee04-4762-42c6-a593-a4e745a81c92"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-08-02T07:22:18.248Z",
      "createdAt": "2025-08-02T07:22:18.248Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="c0f2ee04-4762-42c6-a593-a4e745a81c92"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "c0f2ee04-4762-42c6-a593-a4e745a81c92"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 65TDNNHNZK4B3JFDSJ6Z4MFXFR
{"ts":"2025-12-05T00:04:59.988Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"8e7e0648-ff8a-4942-914d-14d256177f57","stage":"booking","correlationId":"booking-created:6dcc02806c1946c66f122a81"}
{"ts":"2025-12-05T00:05:00.256Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"2ecdecfa-9abc-4912-8696-d56b57021d21","stage":"booking","correlationId":"booking-created:33226942fbbefea8ebc6d757","attempts":1}
üìÖ Processing booking created for customer: 0GZTYPV8F1QJZ55D9CYBX29RZ0
Full booking data: {
  "id": "4e9tkjkzgcs0h9",
  "allDay": false,
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "startAt": "2025-12-03T00:00:00Z",
  "version": 2,
  "createdAt": "2025-12-02T23:17:10Z",
  "updatedAt": "2025-12-02T23:43:24Z",
  "customerId": "0GZTYPV8F1QJZ55D9CYBX29RZ0",
  "locationId": "LNQKVBTQZN3EZ",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "creatorType": "TEAM_MEMBER",
    "teamMemberId": "TMWAtQTYmZpwwxii"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMVwAQUdLz6no-cB",
      "anyTeamMember": false,
      "durationMinutes": 30,
      "serviceVariationId": "SGSLS3INMK5YV637KUITCILL",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1760895536505"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Victoria Huang
üéâ First booking detected for customer: 0GZTYPV8F1QJZ55D9CYBX29RZ0
   Name: Victoria Huang
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 0GZTYPV8F1QJZ55D9CYBX29RZ0...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "a7b40271-729a-41aa-801b-fb1fffb83650"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-11-07T23:26:34.956Z",
      "createdAt": "2025-11-07T23:26:34.956Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="a7b40271-729a-41aa-801b-fb1fffb83650"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "a7b40271-729a-41aa-801b-fb1fffb83650"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 0GZTYPV8F1QJZ55D9CYBX29RZ0
{"ts":"2025-12-05T00:05:00.694Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"2ecdecfa-9abc-4912-8696-d56b57021d21","stage":"booking","correlationId":"booking-created:33226942fbbefea8ebc6d757"}
{"ts":"2025-12-05T00:05:00.860Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"8545b413-03f6-4af8-9710-7e0fa2795506","stage":"booking","correlationId":"booking-created:e9e9b3554b31ae5a2f05b94f","attempts":1}
üìÖ Processing booking created for customer: XPC0VBPBSKXWXRVBS7BBX5NRKM
Full booking data: {
  "id": "hzgajkf5beb02t",
  "allDay": false,
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94133-4608",
    "addressLine1": "550 Pacific Ave",
    "addressLine2": "",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-03T00:00:00Z",
  "version": 2,
  "createdAt": "2025-12-01T19:05:02Z",
  "updatedAt": "2025-12-03T01:55:32Z",
  "customerId": "XPC0VBPBSKXWXRVBS7BBX5NRKM",
  "locationId": "LNQKVBTQZN3EZ",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "XPC0VBPBSKXWXRVBS7BBX5NRKM",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMMBgVwykMnOlumA",
      "anyTeamMember": false,
      "durationMinutes": 140,
      "serviceVariationId": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1763586786564"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Julianne McGoldrick
üéâ First booking detected for customer: XPC0VBPBSKXWXRVBS7BBX5NRKM
   Name: Julianne McGoldrick
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer XPC0VBPBSKXWXRVBS7BBX5NRKM...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "cb289afd-ba17-4a65-a12b-b7bbae60a65e"
      ],
      "version": 2,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-09-08T13:17:41.312Z",
      "createdAt": "2025-08-14T16:24:00.778Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="cb289afd-ba17-4a65-a12b-b7bbae60a65e"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "cb289afd-ba17-4a65-a12b-b7bbae60a65e"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: XPC0VBPBSKXWXRVBS7BBX5NRKM
{"ts":"2025-12-05T00:05:01.298Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"8545b413-03f6-4af8-9710-7e0fa2795506","stage":"booking","correlationId":"booking-created:e9e9b3554b31ae5a2f05b94f"}
{"ts":"2025-12-05T00:05:01.464Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"0ac5fe17-e3af-4b9d-82b7-ad71f0a1880c","stage":"booking","correlationId":"booking-created:f68f895e4d649122b682b1f2","attempts":1}
üìÖ Processing booking created for customer: MD7G9GAYVE4B8FZEJ3NNNAH4XR
Full booking data: {
  "id": "kaztaww268peuv",
  "allDay": false,
  "source": "FIRST_PARTY_BUYER",
  "status": "CANCELLED_BY_CUSTOMER",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94133-4608",
    "addressLine1": "550 Pacific Ave",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-03T00:00:00Z",
  "version": 1,
  "createdAt": "2025-11-29T04:22:25Z",
  "updatedAt": "2025-11-29T04:33:25Z",
  "customerId": "MD7G9GAYVE4B8FZEJ3NNNAH4XR",
  "locationId": "LNQKVBTQZN3EZ",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "MD7G9GAYVE4B8FZEJ3NNNAH4XR",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMMBgVwykMnOlumA",
      "anyTeamMember": true,
      "durationMinutes": 140,
      "serviceVariationId": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1763586786564"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Alana Joyce
üéâ First booking detected for customer: MD7G9GAYVE4B8FZEJ3NNNAH4XR
   Name: Alana Joyce
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer MD7G9GAYVE4B8FZEJ3NNNAH4XR...
   Full custom attributes response: {}
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: MD7G9GAYVE4B8FZEJ3NNNAH4XR
{"ts":"2025-12-05T00:05:01.857Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"0ac5fe17-e3af-4b9d-82b7-ad71f0a1880c","stage":"booking","correlationId":"booking-created:f68f895e4d649122b682b1f2"}
{"ts":"2025-12-05T00:05:02.021Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"7ea4849b-b31a-4e5f-9778-fdfb0e9c9feb","stage":"booking","correlationId":"booking-created:755c8dcba94469e578da08f9","attempts":1}
üìÖ Processing booking created for customer: ZWRC692BV3GAH9HDJXGTSDWA6W
Full booking data: {
  "id": "rmeux446rnfwn0",
  "allDay": false,
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "startAt": "2025-12-03T00:00:00Z",
  "version": 3,
  "createdAt": "2025-12-02T22:09:48Z",
  "updatedAt": "2025-12-03T00:58:46Z",
  "customerId": "ZWRC692BV3GAH9HDJXGTSDWA6W",
  "locationId": "LNQKVBTQZN3EZ",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "creatorType": "TEAM_MEMBER",
    "teamMemberId": "TMWAtQTYmZpwwxii"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMILsQUVwLkLzbVo",
      "anyTeamMember": false,
      "durationMinutes": 100,
      "serviceVariationId": "BM556FTNFOTEHYVG4GPXAXFM",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1762893947284"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Vera Watt
üéâ First booking detected for customer: ZWRC692BV3GAH9HDJXGTSDWA6W
   Name: Vera Watt
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer ZWRC692BV3GAH9HDJXGTSDWA6W...
   Full custom attributes response: {}
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: ZWRC692BV3GAH9HDJXGTSDWA6W
{"ts":"2025-12-05T00:05:02.432Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"7ea4849b-b31a-4e5f-9778-fdfb0e9c9feb","stage":"booking","correlationId":"booking-created:755c8dcba94469e578da08f9"}
{"ts":"2025-12-05T00:05:02.604Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"aa269714-8e23-40df-9814-3c8ae5bc5a2b","stage":"booking","correlationId":"booking-created:a16942a6329106406a98c403","attempts":1}
üìÖ Processing booking created for customer: S000J7PCWP5EDFF3KKA94S6EFR
Full booking data: {
  "id": "wimfzjb4gge1qn",
  "allDay": false,
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94133-4608",
    "addressLine1": "550 Pacific Ave",
    "addressLine2": "",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-03T00:05:00Z",
  "version": 3,
  "createdAt": "2025-11-11T05:17:31Z",
  "updatedAt": "2025-12-03T01:43:31Z",
  "customerId": "S000J7PCWP5EDFF3KKA94S6EFR",
  "locationId": "LNQKVBTQZN3EZ",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "S000J7PCWP5EDFF3KKA94S6EFR",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMgsjtuk5cfKnstq",
      "anyTeamMember": false,
      "durationMinutes": 110,
      "serviceVariationId": "6TYOE67IDYTKHW2ZG6HKVZER",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1761597690235"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Jasveen Sodhi
üéâ First booking detected for customer: S000J7PCWP5EDFF3KKA94S6EFR
   Name: Jasveen Sodhi
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer S000J7PCWP5EDFF3KKA94S6EFR...
   Full custom attributes response: {}
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: S000J7PCWP5EDFF3KKA94S6EFR
{"ts":"2025-12-05T00:05:03.108Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"aa269714-8e23-40df-9814-3c8ae5bc5a2b","stage":"booking","correlationId":"booking-created:a16942a6329106406a98c403"}
{"ts":"2025-12-05T00:05:03.349Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"5389c31c-7e58-414f-bc8b-cd8fc1c2134c","stage":"booking","correlationId":"booking-created:2d6d1f64775b5d1e62d5974a","attempts":1}
üìÖ Processing booking created for customer: JBSSXD662STDAD89DZ5Z33VTT8
Full booking data: {
  "id": "5t9acxd8x6dbin",
  "allDay": false,
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "startAt": "2025-12-03T00:20:00Z",
  "version": 2,
  "createdAt": "2025-12-01T17:12:36Z",
  "updatedAt": "2025-12-03T02:01:46Z",
  "customerId": "JBSSXD662STDAD89DZ5Z33VTT8",
  "locationId": "LT4ZHFBQQYB2N",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "creatorType": "TEAM_MEMBER",
    "teamMemberId": "TMQPbDVvvOCLwqsy"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TM9jDlRr_Hl4rdBB",
      "anyTeamMember": false,
      "durationMinutes": 90,
      "serviceVariationId": "XBUDIMNKOPC2XVG5YLIQ4RYS",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1764191999049"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Isabella Garcia-Camargo
‚ÑπÔ∏è Customer JBSSXD662STDAD89DZ5Z33VTT8 already received signup bonus, not first booking
{"ts":"2025-12-05T00:05:03.504Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"5389c31c-7e58-414f-bc8b-cd8fc1c2134c","stage":"booking","correlationId":"booking-created:2d6d1f64775b5d1e62d5974a"}
{"ts":"2025-12-05T00:05:03.669Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"3dc2427b-2c32-4008-9127-96cf20e29aed","stage":"booking","correlationId":"booking-created:88d1acd7e8751b93c1341319","attempts":1}
üìÖ Processing booking created for customer: JBSSXD662STDAD89DZ5Z33VTT8
Full booking data: {
  "id": "d76zn9mojhra1b",
  "allDay": false,
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "startAt": "2025-12-03T00:20:00Z",
  "version": 3,
  "createdAt": "2025-12-01T17:14:04Z",
  "updatedAt": "2025-12-03T01:58:47Z",
  "customerId": "JBSSXD662STDAD89DZ5Z33VTT8",
  "locationId": "LT4ZHFBQQYB2N",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "creatorType": "TEAM_MEMBER",
    "teamMemberId": "TMQPbDVvvOCLwqsy"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMyUMvTJIj2HrHSg",
      "anyTeamMember": false,
      "durationMinutes": 90,
      "serviceVariationId": "JMTK5M2CY2W7WEXSTAJKAJ35",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1762893947284"
    },
    {
      "teamMemberId": "TMyUMvTJIj2HrHSg",
      "anyTeamMember": false,
      "durationMinutes": 10,
      "serviceVariationId": "6F6F3OAFJSOEN3X7HSXYIVQC",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1760895536505"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Isabella Garcia-Camargo
‚ÑπÔ∏è Customer JBSSXD662STDAD89DZ5Z33VTT8 already received signup bonus, not first booking
{"ts":"2025-12-05T00:05:03.875Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"3dc2427b-2c32-4008-9127-96cf20e29aed","stage":"booking","correlationId":"booking-created:88d1acd7e8751b93c1341319"}
{"ts":"2025-12-05T00:05:04.034Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"96c94f3d-5ab3-4c74-8645-b14545b3ceec","stage":"booking","correlationId":"booking-created:0dac2fac1354db67102489a8","attempts":1}
üìÖ Processing booking created for customer: JBSSXD662STDAD89DZ5Z33VTT8
Full booking data: {
  "id": "jztw55bp5wc2ul",
  "allDay": false,
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "startAt": "2025-12-03T00:20:00Z",
  "version": 2,
  "createdAt": "2025-12-01T17:13:25Z",
  "updatedAt": "2025-12-03T01:40:07Z",
  "customerId": "JBSSXD662STDAD89DZ5Z33VTT8",
  "locationId": "LT4ZHFBQQYB2N",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "creatorType": "TEAM_MEMBER",
    "teamMemberId": "TMQPbDVvvOCLwqsy"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMMHlgFBIFbMTRap",
      "anyTeamMember": false,
      "durationMinutes": 120,
      "serviceVariationId": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1763586786564"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Isabella Garcia-Camargo
‚ÑπÔ∏è Customer JBSSXD662STDAD89DZ5Z33VTT8 already received signup bonus, not first booking
{"ts":"2025-12-05T00:05:04.171Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"96c94f3d-5ab3-4c74-8645-b14545b3ceec","stage":"booking","correlationId":"booking-created:0dac2fac1354db67102489a8"}
{"ts":"2025-12-05T00:05:04.397Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"38eee475-f312-4345-a98a-7f1cc058ea9a","stage":"booking","correlationId":"booking-created:8dfa9a60dab47e2766f304f1","attempts":1}
üìÖ Processing booking created for customer: MXRP4ZXMHS47V4ZR3S3XXGDXQC
Full booking data: {
  "id": "wc7m325dceh3c8",
  "allDay": false,
  "source": "THIRD_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94133-4608",
    "addressLine1": "550 Pacific Ave",
    "addressLine2": "",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-03T00:30:00Z",
  "version": 3,
  "createdAt": "2025-11-19T20:11:56Z",
  "updatedAt": "2025-12-03T01:39:01Z",
  "customerId": "MXRP4ZXMHS47V4ZR3S3XXGDXQC",
  "locationId": "LNQKVBTQZN3EZ",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "MXRP4ZXMHS47V4ZR3S3XXGDXQC",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMVwAQUdLz6no-cB",
      "anyTeamMember": false,
      "durationMinutes": 90,
      "serviceVariationId": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1758921239397"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Rachel Delphin
üéâ First booking detected for customer: MXRP4ZXMHS47V4ZR3S3XXGDXQC
   Name: Rachel Delphin
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer MXRP4ZXMHS47V4ZR3S3XXGDXQC...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "af5791f8-348a-422e-98d1-5e865121bb19"
      ],
      "version": 2,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-09-16T23:58:29.438Z",
      "createdAt": "2025-09-16T23:58:29.012Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="af5791f8-348a-422e-98d1-5e865121bb19"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "af5791f8-348a-422e-98d1-5e865121bb19"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: MXRP4ZXMHS47V4ZR3S3XXGDXQC
{"ts":"2025-12-05T00:05:04.924Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"38eee475-f312-4345-a98a-7f1cc058ea9a","stage":"booking","correlationId":"booking-created:8dfa9a60dab47e2766f304f1"}
{"ts":"2025-12-05T00:05:05.207Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"aa121ba1-f94d-496f-ba4a-bcc090907c57","stage":"booking","correlationId":"booking-created:68e9505ad6dfa07df4db0080","attempts":1}
üìÖ Processing booking created for customer: BZ9XWDQKWAYT1GNVS09QDQ0ASC
Full booking data: {
  "id": "g243peqn6bw333",
  "allDay": false,
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94133-4608",
    "addressLine1": "550 Pacific Ave",
    "addressLine2": "",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-03T00:50:00Z",
  "version": 2,
  "createdAt": "2025-11-28T02:51:47Z",
  "updatedAt": "2025-12-03T02:56:27Z",
  "customerId": "BZ9XWDQKWAYT1GNVS09QDQ0ASC",
  "locationId": "LNQKVBTQZN3EZ",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "BZ9XWDQKWAYT1GNVS09QDQ0ASC",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMdagA6g0F03A7_w",
      "anyTeamMember": false,
      "durationMinutes": 140,
      "serviceVariationId": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1763586786564"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Hillary Bates
üéâ First booking detected for customer: BZ9XWDQKWAYT1GNVS09QDQ0ASC
   Name: Hillary Bates
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer BZ9XWDQKWAYT1GNVS09QDQ0ASC...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "0826aee4-d259-434d-be44-511ac61b3629"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-05-13T18:59:38.479Z",
      "createdAt": "2025-05-13T18:59:38.479Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="0826aee4-d259-434d-be44-511ac61b3629"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "0826aee4-d259-434d-be44-511ac61b3629"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: BZ9XWDQKWAYT1GNVS09QDQ0ASC
{"ts":"2025-12-05T00:05:05.706Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"aa121ba1-f94d-496f-ba4a-bcc090907c57","stage":"booking","correlationId":"booking-created:68e9505ad6dfa07df4db0080"}
{"ts":"2025-12-05T00:05:05.936Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"a49e6f6f-6465-4c9e-818b-abd103990b1c","stage":"booking","correlationId":"booking-created:e8be10e3a889cfce646b1b73","attempts":1}
üìÖ Processing booking created for customer: XRZEGMAX6JP6RRW8R8NFA1MV3W
Full booking data: {
  "id": "bv4qve3niwotya",
  "allDay": false,
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "startAt": "2025-12-03T01:50:00Z",
  "version": 1,
  "createdAt": "2025-12-02T01:51:01Z",
  "updatedAt": "2025-12-03T02:45:31Z",
  "customerId": "XRZEGMAX6JP6RRW8R8NFA1MV3W",
  "locationId": "LT4ZHFBQQYB2N",
  "sellerNote": "–í–Ω–µ—Å—Ç–∏ –≤ –æ—Ç—á–µ—Ç –±–µ—Å–ø–ª–∞—Ç–Ω–æ!",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "creatorType": "TEAM_MEMBER",
    "teamMemberId": "TMQPbDVvvOCLwqsy"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TM9jDlRr_Hl4rdBB",
      "anyTeamMember": false,
      "durationMinutes": 90,
      "serviceVariationId": "XBUDIMNKOPC2XVG5YLIQ4RYS",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1764609577793"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Isabelle BLOGGER
üéâ First booking detected for customer: XRZEGMAX6JP6RRW8R8NFA1MV3W
   Name: Isabelle BLOGGER
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer XRZEGMAX6JP6RRW8R8NFA1MV3W...
   Full custom attributes response: {}
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: XRZEGMAX6JP6RRW8R8NFA1MV3W
{"ts":"2025-12-05T00:05:06.349Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"a49e6f6f-6465-4c9e-818b-abd103990b1c","stage":"booking","correlationId":"booking-created:e8be10e3a889cfce646b1b73"}
{"ts":"2025-12-05T00:05:06.629Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"3c606294-255e-4119-94d0-f2578fba4d0b","stage":"booking","correlationId":"booking-created:db9cdadc382ae804808ef749","attempts":1}
üìÖ Processing booking created for customer: YTFV2DVFQM4ZVFFCTRM5G69EKC
Full booking data: {
  "id": "kb1my3mpescub7",
  "allDay": false,
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "startAt": "2025-12-03T02:00:00Z",
  "version": 0,
  "createdAt": "2025-12-03T01:25:57Z",
  "updatedAt": "2025-12-03T01:26:01Z",
  "customerId": "YTFV2DVFQM4ZVFFCTRM5G69EKC",
  "locationId": "LNQKVBTQZN3EZ",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "creatorType": "TEAM_MEMBER",
    "teamMemberId": "TMWAtQTYmZpwwxii"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMgsjtuk5cfKnstq",
      "anyTeamMember": false,
      "durationMinutes": 30,
      "serviceVariationId": "SGSLS3INMK5YV637KUITCILL",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1760895536505"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Britt Lindberg
üéâ First booking detected for customer: YTFV2DVFQM4ZVFFCTRM5G69EKC
   Name: Britt Lindberg
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer YTFV2DVFQM4ZVFFCTRM5G69EKC...
   Full custom attributes response: {}
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: YTFV2DVFQM4ZVFFCTRM5G69EKC
{"ts":"2025-12-05T00:05:07.257Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"3c606294-255e-4119-94d0-f2578fba4d0b","stage":"booking","correlationId":"booking-created:db9cdadc382ae804808ef749"}
{"ts":"2025-12-05T00:05:07.418Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"b8ce2c91-27ca-4feb-8b33-13c13f56361c","stage":"booking","correlationId":"booking-created:35b0a7a0e2eeea09a6e2966a","attempts":1}
üìÖ Processing booking created for customer: WH10ACWXEP8094X832TZG04JT4
Full booking data: {
  "id": "mco7vp1osi22yg",
  "allDay": false,
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "startAt": "2025-12-03T02:00:00Z",
  "version": 2,
  "createdAt": "2025-12-01T18:42:29Z",
  "updatedAt": "2025-12-03T03:24:56Z",
  "customerId": "WH10ACWXEP8094X832TZG04JT4",
  "locationId": "LNQKVBTQZN3EZ",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "creatorType": "TEAM_MEMBER",
    "teamMemberId": "TMWAtQTYmZpwwxii"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMVwAQUdLz6no-cB",
      "anyTeamMember": false,
      "durationMinutes": 100,
      "serviceVariationId": "GSZZR45VJXB44NF4P4WXI5NB",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1764609577793"
    },
    {
      "teamMemberId": "TMVwAQUdLz6no-cB",
      "anyTeamMember": false,
      "durationMinutes": 10,
      "serviceVariationId": "6F6F3OAFJSOEN3X7HSXYIVQC",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1760895536505"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Crystal Yu
üéâ First booking detected for customer: WH10ACWXEP8094X832TZG04JT4
   Name: Crystal Yu
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer WH10ACWXEP8094X832TZG04JT4...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-03-19T17:25:16.739Z",
      "createdAt": "2025-03-19T17:25:16.739Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: WH10ACWXEP8094X832TZG04JT4
{"ts":"2025-12-05T00:05:08.121Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"b8ce2c91-27ca-4feb-8b33-13c13f56361c","stage":"booking","correlationId":"booking-created:35b0a7a0e2eeea09a6e2966a"}
{"ts":"2025-12-05T00:05:08.388Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"989afe0d-9070-4650-8554-90af49c35f0a","stage":"booking","correlationId":"booking-created:768fe6764ea137a9f3eaa7f2","attempts":1}
üìÖ Processing booking created for customer: A39KQRT7HPF29XTTC8WF2S1Y5M
Full booking data: {
  "id": "8du2c3mcb7narz",
  "allDay": false,
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "startAt": "2025-12-03T02:20:00Z",
  "version": 2,
  "createdAt": "2025-11-24T19:18:01Z",
  "updatedAt": "2025-12-03T05:09:11Z",
  "customerId": "A39KQRT7HPF29XTTC8WF2S1Y5M",
  "locationId": "LNQKVBTQZN3EZ",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "creatorType": "TEAM_MEMBER",
    "teamMemberId": "TMWAtQTYmZpwwxii"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TM-zXe9fXe4axYWn",
      "anyTeamMember": false,
      "durationMinutes": 140,
      "serviceVariationId": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1763586786564"
    },
    {
      "teamMemberId": "TM-zXe9fXe4axYWn",
      "anyTeamMember": false,
      "durationMinutes": 20,
      "serviceVariationId": "HAJX45W3U2WUCCXM5MI24UEE",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1763586786564"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Alysia Vigil
üéâ First booking detected for customer: A39KQRT7HPF29XTTC8WF2S1Y5M
   Name: Alysia Vigil
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer A39KQRT7HPF29XTTC8WF2S1Y5M...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "a7b40271-729a-41aa-801b-fb1fffb83650"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-09-08T03:48:57.579Z",
      "createdAt": "2025-09-08T03:48:57.579Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="a7b40271-729a-41aa-801b-fb1fffb83650"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "a7b40271-729a-41aa-801b-fb1fffb83650"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: A39KQRT7HPF29XTTC8WF2S1Y5M
{"ts":"2025-12-05T00:05:08.907Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"989afe0d-9070-4650-8554-90af49c35f0a","stage":"booking","correlationId":"booking-created:768fe6764ea137a9f3eaa7f2"}
{"ts":"2025-12-05T00:05:09.341Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"d63272fa-4019-443f-92cf-44f240c5bf9a","stage":"booking","correlationId":"booking-created:78f88e8912fb41b1b0c73847","attempts":1}
üìÖ Processing booking created for customer: C7MX9AVCFA37SKB6D8XHB2S3SC
Full booking data: {
  "id": "5ojucdjlrefq7m",
  "allDay": false,
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94123-3940",
    "addressLine1": "2266 Union St",
    "addressLine2": "",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-03T17:00:00Z",
  "version": 2,
  "createdAt": "2025-11-28T00:24:00Z",
  "updatedAt": "2025-12-03T19:34:07Z",
  "customerId": "C7MX9AVCFA37SKB6D8XHB2S3SC",
  "locationId": "LT4ZHFBQQYB2N",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "C7MX9AVCFA37SKB6D8XHB2S3SC",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMOscywuGXO2VURY",
      "anyTeamMember": false,
      "durationMinutes": 140,
      "serviceVariationId": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1763586786564"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Angelica Molina
üéâ First booking detected for customer: C7MX9AVCFA37SKB6D8XHB2S3SC
   Name: Angelica Molina
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer C7MX9AVCFA37SKB6D8XHB2S3SC...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "a7b40271-729a-41aa-801b-fb1fffb83650"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-10-06T21:55:57.159Z",
      "createdAt": "2025-10-06T21:55:57.159Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="a7b40271-729a-41aa-801b-fb1fffb83650"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "a7b40271-729a-41aa-801b-fb1fffb83650"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: C7MX9AVCFA37SKB6D8XHB2S3SC
{"ts":"2025-12-05T00:05:09.863Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"d63272fa-4019-443f-92cf-44f240c5bf9a","stage":"booking","correlationId":"booking-created:78f88e8912fb41b1b0c73847"}
{"ts":"2025-12-05T00:05:10.258Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"e50ed25d-d177-4e3f-afd7-6b99d3fb5fb9","stage":"booking","correlationId":"booking-created:641e4610fc4e5a730fd37026","attempts":1}
üìÖ Processing booking created for customer: JBJGE76DFEY21177TXB682M734
Full booking data: {
  "id": "5zig49cddcj6nm",
  "allDay": false,
  "source": "THIRD_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94123-3940",
    "addressLine1": "2266 Union St",
    "addressLine2": "",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-03T17:00:00Z",
  "version": 2,
  "createdAt": "2025-12-01T23:50:54Z",
  "updatedAt": "2025-12-03T18:33:07Z",
  "customerId": "JBJGE76DFEY21177TXB682M734",
  "locationId": "LT4ZHFBQQYB2N",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "JBJGE76DFEY21177TXB682M734",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMMHlgFBIFbMTRap",
      "anyTeamMember": false,
      "durationMinutes": 120,
      "serviceVariationId": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1764609601083"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Cassandra Trainor
üéâ First booking detected for customer: JBJGE76DFEY21177TXB682M734
   Name: Cassandra Trainor
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer JBJGE76DFEY21177TXB682M734...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "af5791f8-348a-422e-98d1-5e865121bb19"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-04-28T18:04:38.666Z",
      "createdAt": "2025-04-28T18:04:38.666Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="af5791f8-348a-422e-98d1-5e865121bb19"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "af5791f8-348a-422e-98d1-5e865121bb19"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: JBJGE76DFEY21177TXB682M734
{"ts":"2025-12-05T00:05:10.733Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"e50ed25d-d177-4e3f-afd7-6b99d3fb5fb9","stage":"booking","correlationId":"booking-created:641e4610fc4e5a730fd37026"}
{"ts":"2025-12-05T00:05:10.902Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"7e86c278-283c-4b29-83f9-6d02d6918646","stage":"booking","correlationId":"booking-created:68f5f305b1742860c2008e98","attempts":1}
üìÖ Processing booking created for customer: CMNCWJKJ9FF1W8G6N8XHA7935M
Full booking data: {
  "id": "bn203r5e9nxk11",
  "allDay": false,
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94123-3940",
    "addressLine1": "2266 Union St",
    "addressLine2": "",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-03T17:00:00Z",
  "version": 2,
  "createdAt": "2025-11-28T20:01:32Z",
  "updatedAt": "2025-12-03T19:18:27Z",
  "customerId": "CMNCWJKJ9FF1W8G6N8XHA7935M",
  "locationId": "LT4ZHFBQQYB2N",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "CMNCWJKJ9FF1W8G6N8XHA7935M",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TM9jDlRr_Hl4rdBB",
      "anyTeamMember": false,
      "durationMinutes": 150,
      "serviceVariationId": "QSVIF7ZTUIVIDPQWUMOPYETM",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1760141204155"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Hannah Strobel
‚ÑπÔ∏è Customer CMNCWJKJ9FF1W8G6N8XHA7935M already received signup bonus, not first booking
{"ts":"2025-12-05T00:05:11.216Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"7e86c278-283c-4b29-83f9-6d02d6918646","stage":"booking","correlationId":"booking-created:68f5f305b1742860c2008e98"}
{"ts":"2025-12-05T00:05:11.420Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"615a6539-48ac-43b1-a800-41b4d68a62ad","stage":"booking","correlationId":"booking-created:d55ca9397752b2a1e69925b7","attempts":1}
üìÖ Processing booking created for customer: MM92YMA3PA3SP7H7ENH4K6CDYM
Full booking data: {
  "id": "jy4alttpubpx5q",
  "allDay": false,
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94133-4608",
    "addressLine1": "550 Pacific Ave",
    "addressLine2": "",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-03T17:00:00Z",
  "version": 2,
  "createdAt": "2025-11-30T17:46:44Z",
  "updatedAt": "2025-12-03T19:11:17Z",
  "customerId": "MM92YMA3PA3SP7H7ENH4K6CDYM",
  "locationId": "LNQKVBTQZN3EZ",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "MM92YMA3PA3SP7H7ENH4K6CDYM",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMMBgVwykMnOlumA",
      "anyTeamMember": false,
      "durationMinutes": 140,
      "serviceVariationId": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1763586786564"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Stephania Stavropoulos
üéâ First booking detected for customer: MM92YMA3PA3SP7H7ENH4K6CDYM
   Name: Stephania Stavropoulos
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer MM92YMA3PA3SP7H7ENH4K6CDYM...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "fd306114-9968-4fe0-9bde-53f9bf837f39"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-11-13T17:33:42.119Z",
      "createdAt": "2025-11-13T17:33:42.119Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="fd306114-9968-4fe0-9bde-53f9bf837f39"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "fd306114-9968-4fe0-9bde-53f9bf837f39"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: MM92YMA3PA3SP7H7ENH4K6CDYM
{"ts":"2025-12-05T00:05:11.880Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"615a6539-48ac-43b1-a800-41b4d68a62ad","stage":"booking","correlationId":"booking-created:d55ca9397752b2a1e69925b7"}
{"ts":"2025-12-05T00:05:12.259Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"212cda37-4d54-4e29-b73a-137e7f3899d6","stage":"booking","correlationId":"booking-created:1233fd25560073697098acfb","attempts":1}
üìÖ Processing booking created for customer: V56R2CDR6R4Q85KE6KV4NRGXD0
Full booking data: {
  "id": "tdokvr5vph5iam",
  "allDay": false,
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94123-3940",
    "addressLine1": "2266 Union St",
    "addressLine2": "",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-03T17:00:00Z",
  "version": 2,
  "createdAt": "2025-12-02T21:09:18Z",
  "updatedAt": "2025-12-03T19:34:32Z",
  "customerId": "V56R2CDR6R4Q85KE6KV4NRGXD0",
  "locationId": "LT4ZHFBQQYB2N",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "V56R2CDR6R4Q85KE6KV4NRGXD0",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMe-bT5XxKxmk0nw",
      "anyTeamMember": false,
      "durationMinutes": 140,
      "serviceVariationId": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1763586786564"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Yawen Mackey
‚ÑπÔ∏è Customer V56R2CDR6R4Q85KE6KV4NRGXD0 already received signup bonus, not first booking
{"ts":"2025-12-05T00:05:12.532Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"212cda37-4d54-4e29-b73a-137e7f3899d6","stage":"booking","correlationId":"booking-created:1233fd25560073697098acfb"}
{"ts":"2025-12-05T00:05:12.751Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"ccfb867e-b69d-476b-b908-84d0a530ce5c","stage":"booking","correlationId":"booking-created:976e6528c99e3764e84f4df7","attempts":1}
üìÖ Processing booking created for customer: 8QZMQK99PZH7D9DBY4KM639NGM
Full booking data: {
  "id": "85iy7mda4thql1",
  "allDay": false,
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "startAt": "2025-12-03T17:30:00Z",
  "version": 2,
  "createdAt": "2025-12-02T23:02:27Z",
  "updatedAt": "2025-12-03T20:42:36Z",
  "customerId": "8QZMQK99PZH7D9DBY4KM639NGM",
  "locationId": "LNQKVBTQZN3EZ",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "creatorType": "TEAM_MEMBER",
    "teamMemberId": "TMWAtQTYmZpwwxii"
  },
  "appointmentSegments": [
    {
      "resourceIds": [
        "F2MBRCC42VNNDWXNA3PAMHEU"
      ],
      "teamMemberId": "TM-zXe9fXe4axYWn",
      "anyTeamMember": false,
      "durationMinutes": 90,
      "serviceVariationId": "ZEAKNB35I37RMXNUBGWDZQIM",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1760895536505"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Cauteaux Vrakelos
üéâ First booking detected for customer: 8QZMQK99PZH7D9DBY4KM639NGM
   Name: Cauteaux Vrakelos
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 8QZMQK99PZH7D9DBY4KM639NGM...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-12-02T05:57:44.586Z",
      "createdAt": "2025-12-02T05:57:44.586Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 8QZMQK99PZH7D9DBY4KM639NGM
{"ts":"2025-12-05T00:05:13.524Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"ccfb867e-b69d-476b-b908-84d0a530ce5c","stage":"booking","correlationId":"booking-created:976e6528c99e3764e84f4df7"}
{"ts":"2025-12-05T00:05:14.014Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"a5c4bfb9-e892-42c7-84d1-64d06edf0e5b","stage":"booking","correlationId":"booking-created:31890042e8b8d5a5c378c50a","attempts":1}
üìÖ Processing booking created for customer: 8QZMQK99PZH7D9DBY4KM639NGM
Full booking data: {
  "id": "nlit6bzcgdph0b",
  "allDay": false,
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "startAt": "2025-12-03T17:30:00Z",
  "version": 4,
  "createdAt": "2025-12-02T23:01:40Z",
  "updatedAt": "2025-12-03T20:42:15Z",
  "customerId": "8QZMQK99PZH7D9DBY4KM639NGM",
  "locationId": "LNQKVBTQZN3EZ",
  "sellerNote": "–°–ª–µ–¥—É—é—â–∏–π —Ä–∞–∑ $15 off",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "creatorType": "TEAM_MEMBER",
    "teamMemberId": "TMWAtQTYmZpwwxii"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMSt73bSp59caRzt",
      "anyTeamMember": false,
      "durationMinutes": 140,
      "serviceVariationId": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1763586786564"
    },
    {
      "teamMemberId": "TMSt73bSp59caRzt",
      "anyTeamMember": false,
      "durationMinutes": 5,
      "serviceVariationId": "DBRXEHQPCF7V4APTHDQTZW62",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1762374620368"
    },
    {
      "teamMemberId": "TMSt73bSp59caRzt",
      "anyTeamMember": false,
      "durationMinutes": 20,
      "serviceVariationId": "HAJX45W3U2WUCCXM5MI24UEE",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1763586786564"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Cauteaux Vrakelos
üéâ First booking detected for customer: 8QZMQK99PZH7D9DBY4KM639NGM
   Name: Cauteaux Vrakelos
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 8QZMQK99PZH7D9DBY4KM639NGM...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-12-02T05:57:44.586Z",
      "createdAt": "2025-12-02T05:57:44.586Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 8QZMQK99PZH7D9DBY4KM639NGM
{"ts":"2025-12-05T00:05:14.888Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"a5c4bfb9-e892-42c7-84d1-64d06edf0e5b","stage":"booking","correlationId":"booking-created:31890042e8b8d5a5c378c50a"}
{"ts":"2025-12-05T00:05:15.415Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"9e38e472-9678-4a1a-8456-4702f970a04a","stage":"booking","correlationId":"booking-created:202b255e1b50a3e2b1cfe345","attempts":1}
üìÖ Processing booking created for customer: 8QZMQK99PZH7D9DBY4KM639NGM
Full booking data: {
  "id": "07w90ovpomp911",
  "allDay": false,
  "source": "FIRST_PARTY_BUYER",
  "status": "CANCELLED_BY_SELLER",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94133-4608",
    "addressLine1": "550 Pacific Ave",
    "addressLine2": "",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-03T18:00:00Z",
  "version": 2,
  "createdAt": "2025-12-02T05:57:44Z",
  "updatedAt": "2025-12-02T23:02:41Z",
  "customerId": "8QZMQK99PZH7D9DBY4KM639NGM",
  "locationId": "LNQKVBTQZN3EZ",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "8QZMQK99PZH7D9DBY4KM639NGM",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMMCVDJoKh3ZkfFo",
      "anyTeamMember": false,
      "durationMinutes": 120,
      "serviceVariationId": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1764609601083"
    },
    {
      "resourceIds": [
        "F2MBRCC42VNNDWXNA3PAMHEU"
      ],
      "teamMemberId": "TMMCVDJoKh3ZkfFo",
      "anyTeamMember": false,
      "durationMinutes": 90,
      "serviceVariationId": "ZEAKNB35I37RMXNUBGWDZQIM",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1760895536505"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Cauteaux Vrakelos
üéâ First booking detected for customer: 8QZMQK99PZH7D9DBY4KM639NGM
   Name: Cauteaux Vrakelos
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 8QZMQK99PZH7D9DBY4KM639NGM...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-12-02T05:57:44.586Z",
      "createdAt": "2025-12-02T05:57:44.586Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 8QZMQK99PZH7D9DBY4KM639NGM
{"ts":"2025-12-05T00:05:15.998Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"9e38e472-9678-4a1a-8456-4702f970a04a","stage":"booking","correlationId":"booking-created:202b255e1b50a3e2b1cfe345"}
{"ts":"2025-12-05T00:05:16.297Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"d1b11740-2a71-4907-87c0-c65c206b1947","stage":"booking","correlationId":"booking-created:8d22e4de7ec49fe9e74c9dfc","attempts":1}
üìÖ Processing booking created for customer: VK76GYDZ8DNJ4GQTWATAD2SAGM
Full booking data: {
  "id": "433fn341ayaitm",
  "allDay": false,
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "startAt": "2025-12-03T18:00:00Z",
  "version": 4,
  "createdAt": "2025-12-01T18:31:54Z",
  "updatedAt": "2025-12-03T18:55:18Z",
  "customerId": "VK76GYDZ8DNJ4GQTWATAD2SAGM",
  "locationId": "LNQKVBTQZN3EZ",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "creatorType": "TEAM_MEMBER",
    "teamMemberId": "TMWAtQTYmZpwwxii"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMVwAQUdLz6no-cB",
      "anyTeamMember": false,
      "durationMinutes": 45,
      "serviceVariationId": "VVA7G2UN7N2HUFMCW5LQOVHB",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1763579781183"
    },
    {
      "teamMemberId": "TMVwAQUdLz6no-cB",
      "anyTeamMember": false,
      "durationMinutes": 5,
      "serviceVariationId": "DBRXEHQPCF7V4APTHDQTZW62",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1762374620368"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Alina Arzamassky
üéâ First booking detected for customer: VK76GYDZ8DNJ4GQTWATAD2SAGM
   Name: Alina Arzamassky
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer VK76GYDZ8DNJ4GQTWATAD2SAGM...
   Full custom attributes response: {}
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: VK76GYDZ8DNJ4GQTWATAD2SAGM
{"ts":"2025-12-05T00:05:16.796Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"d1b11740-2a71-4907-87c0-c65c206b1947","stage":"booking","correlationId":"booking-created:8d22e4de7ec49fe9e74c9dfc"}
{"ts":"2025-12-05T00:05:16.954Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"8d46f1d0-7e58-4022-8e92-119317635068","stage":"booking","correlationId":"booking-created:63aac8cfa8b36213b2ab8f43","attempts":1}
üìÖ Processing booking created for customer: YA705HZ4ESSA290WH24XTTKR8C
Full booking data: {
  "id": "jeabhldj4vro1a",
  "allDay": false,
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94133-4608",
    "addressLine1": "550 Pacific Ave",
    "addressLine2": "",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-03T18:00:00Z",
  "version": 2,
  "createdAt": "2025-11-24T19:14:10Z",
  "updatedAt": "2025-12-03T19:51:52Z",
  "customerId": "YA705HZ4ESSA290WH24XTTKR8C",
  "locationId": "LNQKVBTQZN3EZ",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "YA705HZ4ESSA290WH24XTTKR8C",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMgsjtuk5cfKnstq",
      "anyTeamMember": false,
      "durationMinutes": 110,
      "serviceVariationId": "6TYOE67IDYTKHW2ZG6HKVZER",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1762893947284"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Paige Sapiro
üéâ First booking detected for customer: YA705HZ4ESSA290WH24XTTKR8C
   Name: Paige Sapiro
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer YA705HZ4ESSA290WH24XTTKR8C...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "af5791f8-348a-422e-98d1-5e865121bb19"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-03-20T19:41:58.513Z",
      "createdAt": "2025-03-20T19:41:58.513Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="af5791f8-348a-422e-98d1-5e865121bb19"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "af5791f8-348a-422e-98d1-5e865121bb19"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: YA705HZ4ESSA290WH24XTTKR8C
{"ts":"2025-12-05T00:05:17.352Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"8d46f1d0-7e58-4022-8e92-119317635068","stage":"booking","correlationId":"booking-created:63aac8cfa8b36213b2ab8f43"}
{"ts":"2025-12-05T00:05:17.510Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"9af6b156-eb28-40cf-a128-7b4a77adcfe4","stage":"booking","correlationId":"booking-created:577ee936bbaa2dd47954c520","attempts":1}
üìÖ Processing booking created for customer: VK76GYDZ8DNJ4GQTWATAD2SAGM
Full booking data: {
  "id": "jwhms7kv5tu6p9",
  "allDay": false,
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "startAt": "2025-12-03T18:00:00Z",
  "version": 2,
  "createdAt": "2025-12-01T18:32:31Z",
  "updatedAt": "2025-12-03T18:55:37Z",
  "customerId": "VK76GYDZ8DNJ4GQTWATAD2SAGM",
  "locationId": "LNQKVBTQZN3EZ",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "creatorType": "TEAM_MEMBER",
    "teamMemberId": "TMWAtQTYmZpwwxii"
  },
  "appointmentSegments": [
    {
      "resourceIds": [
        "5OVIQ6GSSUXORACP6T7WBAQ7"
      ],
      "teamMemberId": "TMXiw38Bbb7XQUWI",
      "anyTeamMember": false,
      "durationMinutes": 60,
      "serviceVariationId": "SBE5XUATXRM76CBTT25HL2NZ",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1760895536505"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Alina Arzamassky
üéâ First booking detected for customer: VK76GYDZ8DNJ4GQTWATAD2SAGM
   Name: Alina Arzamassky
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer VK76GYDZ8DNJ4GQTWATAD2SAGM...
   Full custom attributes response: {}
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: VK76GYDZ8DNJ4GQTWATAD2SAGM
{"ts":"2025-12-05T00:05:17.864Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"9af6b156-eb28-40cf-a128-7b4a77adcfe4","stage":"booking","correlationId":"booking-created:577ee936bbaa2dd47954c520"}
{"ts":"2025-12-05T00:05:18.021Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"07b44a7d-1ca4-4cc5-8f40-59c629193c2b","stage":"booking","correlationId":"booking-created:5435914e07ae4f399167aefc","attempts":1}
üìÖ Processing booking created for customer: K54SN5QMHBJRR7D4B2K0716V24
Full booking data: {
  "id": "hs1dacbv1l4t2i",
  "allDay": false,
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94123-3940",
    "addressLine1": "2266 Union St",
    "addressLine2": "",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-03T18:30:00Z",
  "version": 2,
  "createdAt": "2025-12-01T22:13:19Z",
  "updatedAt": "2025-12-03T20:08:41Z",
  "customerId": "K54SN5QMHBJRR7D4B2K0716V24",
  "locationId": "LT4ZHFBQQYB2N",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "K54SN5QMHBJRR7D4B2K0716V24",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMyUMvTJIj2HrHSg",
      "anyTeamMember": false,
      "durationMinutes": 90,
      "serviceVariationId": "JMTK5M2CY2W7WEXSTAJKAJ35",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1764609577793"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Meredith Bergman
üéâ First booking detected for customer: K54SN5QMHBJRR7D4B2K0716V24
   Name: Meredith Bergman
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer K54SN5QMHBJRR7D4B2K0716V24...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-07-26T17:00:19.578Z",
      "createdAt": "2025-07-26T17:00:19.578Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: K54SN5QMHBJRR7D4B2K0716V24
{"ts":"2025-12-05T00:05:18.382Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"07b44a7d-1ca4-4cc5-8f40-59c629193c2b","stage":"booking","correlationId":"booking-created:5435914e07ae4f399167aefc"}
{"ts":"2025-12-05T00:05:18.551Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"f55ea996-9dfb-4b49-a1d1-ce17924e0412","stage":"booking","correlationId":"booking-created:68632b513e9524b0b4e1e1f8","attempts":1}
üìÖ Processing booking created for customer: CVSW0VNTSBP8R4SWGBN05SXXJ0
Full booking data: {
  "id": "cs2tygsvar8z83",
  "allDay": false,
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "startAt": "2025-12-03T19:00:00Z",
  "version": 3,
  "createdAt": "2025-11-19T17:37:26Z",
  "updatedAt": "2025-12-03T20:24:36Z",
  "customerId": "CVSW0VNTSBP8R4SWGBN05SXXJ0",
  "locationId": "LNQKVBTQZN3EZ",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "creatorType": "TEAM_MEMBER",
    "teamMemberId": "TMWAtQTYmZpwwxii"
  },
  "appointmentSegments": [
    {
      "resourceIds": [
        "5OVIQ6GSSUXORACP6T7WBAQ7"
      ],
      "teamMemberId": "TM-zXe9fXe4axYWn",
      "anyTeamMember": false,
      "durationMinutes": 90,
      "serviceVariationId": "ZEAKNB35I37RMXNUBGWDZQIM",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1760895536505"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Kristin Smith
üéâ First booking detected for customer: CVSW0VNTSBP8R4SWGBN05SXXJ0
   Name: Kristin Smith
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer CVSW0VNTSBP8R4SWGBN05SXXJ0...
   Full custom attributes response: {}
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: CVSW0VNTSBP8R4SWGBN05SXXJ0
{"ts":"2025-12-05T00:05:18.920Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"f55ea996-9dfb-4b49-a1d1-ce17924e0412","stage":"booking","correlationId":"booking-created:68632b513e9524b0b4e1e1f8"}
{"ts":"2025-12-05T00:05:19.077Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"4068229d-ec11-47a9-a980-0c05e9127a09","stage":"booking","correlationId":"booking-created:bfc9e138f1ce04bfc6a43fc8","attempts":1}
üìÖ Processing booking created for customer: CVSW0VNTSBP8R4SWGBN05SXXJ0
Full booking data: {
  "id": "kx0wb3rm2xx2lx",
  "allDay": false,
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "startAt": "2025-12-03T19:00:00Z",
  "version": 4,
  "createdAt": "2025-11-19T17:38:33Z",
  "updatedAt": "2025-12-03T20:23:52Z",
  "customerId": "CVSW0VNTSBP8R4SWGBN05SXXJ0",
  "locationId": "LNQKVBTQZN3EZ",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "creatorType": "TEAM_MEMBER",
    "teamMemberId": "TMWAtQTYmZpwwxii"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMVwAQUdLz6no-cB",
      "anyTeamMember": false,
      "durationMinutes": 90,
      "serviceVariationId": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1758921239397"
    },
    {
      "teamMemberId": "TMVwAQUdLz6no-cB",
      "anyTeamMember": false,
      "durationMinutes": 5,
      "serviceVariationId": "DBRXEHQPCF7V4APTHDQTZW62",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1762374620368"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Kristin Smith
üéâ First booking detected for customer: CVSW0VNTSBP8R4SWGBN05SXXJ0
   Name: Kristin Smith
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer CVSW0VNTSBP8R4SWGBN05SXXJ0...
   Full custom attributes response: {}
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: CVSW0VNTSBP8R4SWGBN05SXXJ0
{"ts":"2025-12-05T00:05:19.454Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"4068229d-ec11-47a9-a980-0c05e9127a09","stage":"booking","correlationId":"booking-created:bfc9e138f1ce04bfc6a43fc8"}
{"ts":"2025-12-05T00:05:19.613Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"ee7a5d5f-61ef-4acf-880f-157a3648973e","stage":"booking","correlationId":"booking-created:d69fa30ee98b8ae05e4384d3","attempts":1}
üìÖ Processing booking created for customer: 0QM3FB1M39C6YTTNCYFDEC3A8M
Full booking data: {
  "id": "n0dckd223kawgo",
  "allDay": false,
  "source": "FIRST_PARTY_BUYER",
  "status": "CANCELLED_BY_SELLER",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94123-3940",
    "addressLine1": "2266 Union St",
    "addressLine2": "",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-03T19:00:00Z",
  "version": 2,
  "createdAt": "2025-11-18T19:52:54Z",
  "updatedAt": "2025-12-03T17:23:38Z",
  "customerId": "0QM3FB1M39C6YTTNCYFDEC3A8M",
  "locationId": "LT4ZHFBQQYB2N",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "0QM3FB1M39C6YTTNCYFDEC3A8M",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMMHlgFBIFbMTRap",
      "anyTeamMember": false,
      "durationMinutes": 100,
      "serviceVariationId": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1758921239397"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Kirsten Hong
‚ÑπÔ∏è Customer 0QM3FB1M39C6YTTNCYFDEC3A8M already received signup bonus, not first booking
{"ts":"2025-12-05T00:05:19.739Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"ee7a5d5f-61ef-4acf-880f-157a3648973e","stage":"booking","correlationId":"booking-created:d69fa30ee98b8ae05e4384d3"}
{"ts":"2025-12-05T00:05:19.898Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"80f0054c-7ed1-4b46-968d-4f8b6cfdbb8d","stage":"booking","correlationId":"booking-created:401ef2b87138a027aac19b67","attempts":1}
üìÖ Processing booking created for customer: GKSQC7GCXB3BJ7A3QXC9WYSZVG
Full booking data: {
  "id": "ndajgiitwhw8wx",
  "allDay": false,
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "startAt": "2025-12-03T19:00:00Z",
  "version": 6,
  "createdAt": "2025-11-12T22:20:59Z",
  "updatedAt": "2025-12-03T20:15:31Z",
  "customerId": "GKSQC7GCXB3BJ7A3QXC9WYSZVG",
  "locationId": "LT4ZHFBQQYB2N",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "creatorType": "TEAM_MEMBER",
    "teamMemberId": "TMQPbDVvvOCLwqsy"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMMHlgFBIFbMTRap",
      "anyTeamMember": false,
      "durationMinutes": 90,
      "serviceVariationId": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1758921239397"
    },
    {
      "teamMemberId": "TMMHlgFBIFbMTRap",
      "anyTeamMember": false,
      "durationMinutes": 20,
      "serviceVariationId": "HAJX45W3U2WUCCXM5MI24UEE",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1763586786564"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Paulette Funa
‚ÑπÔ∏è Customer GKSQC7GCXB3BJ7A3QXC9WYSZVG already received signup bonus, not first booking
{"ts":"2025-12-05T00:05:20.027Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"80f0054c-7ed1-4b46-968d-4f8b6cfdbb8d","stage":"booking","correlationId":"booking-created:401ef2b87138a027aac19b67"}
{"ts":"2025-12-05T00:05:20.184Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"4a84e898-a6e3-4c83-94e1-80bd0aca9434","stage":"booking","correlationId":"booking-created:f1df0b11465026a7b93f3751","attempts":1}
üìÖ Processing booking created for customer: C5SY3G1H41TSQBT0HS5QV64DY4
Full booking data: {
  "id": "p5bg3uwxonwfxh",
  "allDay": false,
  "source": "THIRD_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94133-4608",
    "addressLine1": "550 Pacific Ave",
    "addressLine2": "",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-03T19:00:00Z",
  "version": 2,
  "createdAt": "2025-12-02T20:24:43Z",
  "updatedAt": "2025-12-03T21:04:17Z",
  "customerId": "C5SY3G1H41TSQBT0HS5QV64DY4",
  "locationId": "LNQKVBTQZN3EZ",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "C5SY3G1H41TSQBT0HS5QV64DY4",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMXiw38Bbb7XQUWI",
      "anyTeamMember": false,
      "durationMinutes": 120,
      "serviceVariationId": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1764609601083"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: null null
üéâ First booking detected for customer: C5SY3G1H41TSQBT0HS5QV64DY4
   Name: null null
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer C5SY3G1H41TSQBT0HS5QV64DY4...
   Full custom attributes response: {}
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: C5SY3G1H41TSQBT0HS5QV64DY4
{"ts":"2025-12-05T00:05:21.056Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"4a84e898-a6e3-4c83-94e1-80bd0aca9434","stage":"booking","correlationId":"booking-created:f1df0b11465026a7b93f3751"}
{"ts":"2025-12-05T00:05:21.216Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"26a404ca-a29b-4dfc-9b7a-df52ccfba840","stage":"booking","correlationId":"booking-created:b5c9b261ee0741d9544e3ad2","attempts":1}
üìÖ Processing booking created for customer: 82K003M730Q31BH8JCWDHFRDYC
Full booking data: {
  "id": "becyko0obw1o4q",
  "allDay": false,
  "source": "THIRD_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94123-3940",
    "addressLine1": "2266 Union St",
    "addressLine2": "",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-03T19:20:00Z",
  "version": 2,
  "createdAt": "2025-12-01T07:06:31Z",
  "updatedAt": "2025-12-03T21:41:32Z",
  "customerId": "82K003M730Q31BH8JCWDHFRDYC",
  "locationId": "LT4ZHFBQQYB2N",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "82K003M730Q31BH8JCWDHFRDYC",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMe-bT5XxKxmk0nw",
      "anyTeamMember": false,
      "durationMinutes": 140,
      "serviceVariationId": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1763586786564"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Alexis Friedman
‚ÑπÔ∏è Customer 82K003M730Q31BH8JCWDHFRDYC already received signup bonus, not first booking
{"ts":"2025-12-05T00:05:21.350Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"26a404ca-a29b-4dfc-9b7a-df52ccfba840","stage":"booking","correlationId":"booking-created:b5c9b261ee0741d9544e3ad2"}
{"ts":"2025-12-05T00:05:21.512Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"b5d5bd51-1aec-4895-9ba5-aec4f1cc9870","stage":"booking","correlationId":"booking-created:4c034c899e17952f9ec8e356","attempts":1}
üìÖ Processing booking created for customer: HPGX3PGJ1FTZ83Z76H1ZDC14JW
Full booking data: {
  "id": "d6yx3nbyeb3p1y",
  "allDay": false,
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94123-3940",
    "addressLine1": "2266 Union St",
    "addressLine2": "",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-03T19:20:00Z",
  "version": 2,
  "createdAt": "2025-11-30T17:24:36Z",
  "updatedAt": "2025-12-03T22:16:06Z",
  "customerId": "HPGX3PGJ1FTZ83Z76H1ZDC14JW",
  "locationId": "LT4ZHFBQQYB2N",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "HPGX3PGJ1FTZ83Z76H1ZDC14JW",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMOscywuGXO2VURY",
      "anyTeamMember": false,
      "durationMinutes": 140,
      "serviceVariationId": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1763586786564"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Kristen Witte
üéâ First booking detected for customer: HPGX3PGJ1FTZ83Z76H1ZDC14JW
   Name: Kristen Witte
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer HPGX3PGJ1FTZ83Z76H1ZDC14JW...
   Full custom attributes response: {}
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: HPGX3PGJ1FTZ83Z76H1ZDC14JW
{"ts":"2025-12-05T00:05:21.877Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"b5d5bd51-1aec-4895-9ba5-aec4f1cc9870","stage":"booking","correlationId":"booking-created:4c034c899e17952f9ec8e356"}
{"ts":"2025-12-05T00:05:22.038Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"e4a0a0cb-b1e0-4904-9359-133b1c5e3d85","stage":"booking","correlationId":"booking-created:ff8e7bb69e22ce8d6a4324ee","attempts":1}
üìÖ Processing booking created for customer: E5ZQZ7E7RHZKRW11G2HAVCN60M
Full booking data: {
  "id": "kjybljxglwkjeo",
  "allDay": false,
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94123-3940",
    "addressLine1": "2266 Union St",
    "addressLine2": "",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-03T19:30:00Z",
  "version": 3,
  "createdAt": "2025-12-01T23:56:26Z",
  "updatedAt": "2025-12-03T20:56:16Z",
  "customerId": "E5ZQZ7E7RHZKRW11G2HAVCN60M",
  "locationId": "LT4ZHFBQQYB2N",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "E5ZQZ7E7RHZKRW11G2HAVCN60M",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TM9jDlRr_Hl4rdBB",
      "anyTeamMember": false,
      "durationMinutes": 120,
      "serviceVariationId": "HXLBKQC3DRE57DB7IK5RBYOB",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1758654327496"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Angelina Yilmaz
üéâ First booking detected for customer: E5ZQZ7E7RHZKRW11G2HAVCN60M
   Name: Angelina Yilmaz
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer E5ZQZ7E7RHZKRW11G2HAVCN60M...
   Full custom attributes response: {}
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: E5ZQZ7E7RHZKRW11G2HAVCN60M
{"ts":"2025-12-05T00:05:22.397Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"e4a0a0cb-b1e0-4904-9359-133b1c5e3d85","stage":"booking","correlationId":"booking-created:ff8e7bb69e22ce8d6a4324ee"}
{"ts":"2025-12-05T00:05:22.557Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"242c9c74-17c1-45fb-9894-a2f638f81030","stage":"booking","correlationId":"booking-created:55678d4cec2d8b4e8310137c","attempts":1}
üìÖ Processing booking created for customer: 6XW971FQS4D8Y01EHA23YGV3PW
Full booking data: {
  "id": "duk14jahgvsauj",
  "allDay": false,
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "startAt": "2025-12-03T19:45:00Z",
  "version": 3,
  "createdAt": "2025-12-02T23:11:10Z",
  "updatedAt": "2025-12-03T21:44:21Z",
  "customerId": "6XW971FQS4D8Y01EHA23YGV3PW",
  "locationId": "LNQKVBTQZN3EZ",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "creatorType": "TEAM_MEMBER",
    "teamMemberId": "TMWAtQTYmZpwwxii"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMgsjtuk5cfKnstq",
      "anyTeamMember": false,
      "durationMinutes": 150,
      "serviceVariationId": "FKVQUFGSG7BFA55SUPGKTCWF",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1760141204155"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Kelly Stavish
üéâ First booking detected for customer: 6XW971FQS4D8Y01EHA23YGV3PW
   Name: Kelly Stavish
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 6XW971FQS4D8Y01EHA23YGV3PW...
   Full custom attributes response: {}
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 6XW971FQS4D8Y01EHA23YGV3PW
{"ts":"2025-12-05T00:05:23.037Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"242c9c74-17c1-45fb-9894-a2f638f81030","stage":"booking","correlationId":"booking-created:55678d4cec2d8b4e8310137c"}
{"ts":"2025-12-05T00:05:23.201Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"4f590d95-3f4d-406a-a4c1-0454c3fdfb1d","stage":"booking","correlationId":"booking-created:c2ca4a2c734ed49f8e398bd6","attempts":1}
üìÖ Processing booking created for customer: 992FQZKFJWK2SH6P04Q1DK8Q0G
Full booking data: {
  "id": "kskmvkoc3z6g65",
  "allDay": false,
  "source": "FIRST_PARTY_BUYER",
  "status": "CANCELLED_BY_CUSTOMER",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94133-4608",
    "addressLine1": "550 Pacific Ave",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-03T19:50:00Z",
  "version": 1,
  "createdAt": "2025-11-28T19:23:28Z",
  "updatedAt": "2025-12-02T00:01:54Z",
  "customerId": "992FQZKFJWK2SH6P04Q1DK8Q0G",
  "locationId": "LNQKVBTQZN3EZ",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "992FQZKFJWK2SH6P04Q1DK8Q0G",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMgsjtuk5cfKnstq",
      "anyTeamMember": false,
      "durationMinutes": 110,
      "serviceVariationId": "6TYOE67IDYTKHW2ZG6HKVZER",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1764191999049"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Jacki Jones
üéâ First booking detected for customer: 992FQZKFJWK2SH6P04Q1DK8Q0G
   Name: Jacki Jones
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 992FQZKFJWK2SH6P04Q1DK8Q0G...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-11-06T17:17:28.792Z",
      "createdAt": "2025-11-06T17:17:28.792Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 992FQZKFJWK2SH6P04Q1DK8Q0G
{"ts":"2025-12-05T00:05:23.589Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"4f590d95-3f4d-406a-a4c1-0454c3fdfb1d","stage":"booking","correlationId":"booking-created:c2ca4a2c734ed49f8e398bd6"}
{"ts":"2025-12-05T00:05:23.757Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"391d7e39-346c-4dd7-9f70-f61246126164","stage":"booking","correlationId":"booking-created:d2f1e3d745b813b0bc4c057f","attempts":1}
üìÖ Processing booking created for customer: QKZ142XSZQKQMM4AKY35SKET3M
Full booking data: {
  "id": "ld6hq8ht0yors9",
  "allDay": false,
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "startAt": "2025-12-03T20:00:00Z",
  "version": 3,
  "createdAt": "2025-12-02T23:24:30Z",
  "updatedAt": "2025-12-03T21:43:07Z",
  "customerId": "QKZ142XSZQKQMM4AKY35SKET3M",
  "locationId": "LT4ZHFBQQYB2N",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "creatorType": "TEAM_MEMBER",
    "teamMemberId": "TMQPbDVvvOCLwqsy"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMyUMvTJIj2HrHSg",
      "anyTeamMember": false,
      "durationMinutes": 90,
      "serviceVariationId": "JMTK5M2CY2W7WEXSTAJKAJ35",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1762893947284"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Jereena Justin
üéâ First booking detected for customer: QKZ142XSZQKQMM4AKY35SKET3M
   Name: Jereena Justin
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer QKZ142XSZQKQMM4AKY35SKET3M...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-08-10T22:49:55.210Z",
      "createdAt": "2025-08-10T22:49:55.210Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: QKZ142XSZQKQMM4AKY35SKET3M
{"ts":"2025-12-05T00:05:24.127Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"391d7e39-346c-4dd7-9f70-f61246126164","stage":"booking","correlationId":"booking-created:d2f1e3d745b813b0bc4c057f"}
{"ts":"2025-12-05T00:05:24.286Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"91489382-3b8b-41f6-aa4c-c3e66043b8c7","stage":"booking","correlationId":"booking-created:46dd74c4939c9e68e4f0e93d","attempts":1}
üìÖ Processing booking created for customer: 6XW971FQS4D8Y01EHA23YGV3PW
Full booking data: {
  "id": "ribcik13c10enh",
  "allDay": false,
  "source": "FIRST_PARTY_MERCHANT",
  "status": "CANCELLED_BY_SELLER",
  "startAt": "2025-12-03T20:00:00Z",
  "version": 1,
  "createdAt": "2025-12-02T18:49:24Z",
  "updatedAt": "2025-12-02T23:11:46Z",
  "customerId": "6XW971FQS4D8Y01EHA23YGV3PW",
  "locationId": "LT4ZHFBQQYB2N",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "creatorType": "TEAM_MEMBER",
    "teamMemberId": "TMQPbDVvvOCLwqsy"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMyUMvTJIj2HrHSg",
      "anyTeamMember": false,
      "durationMinutes": 150,
      "serviceVariationId": "4QI3JWGEYQANKCGC36J3MYNB",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1758654327496"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Kelly Stavish
üéâ First booking detected for customer: 6XW971FQS4D8Y01EHA23YGV3PW
   Name: Kelly Stavish
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 6XW971FQS4D8Y01EHA23YGV3PW...
   Full custom attributes response: {}
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 6XW971FQS4D8Y01EHA23YGV3PW
{"ts":"2025-12-05T00:05:24.657Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"91489382-3b8b-41f6-aa4c-c3e66043b8c7","stage":"booking","correlationId":"booking-created:46dd74c4939c9e68e4f0e93d"}
{"ts":"2025-12-05T00:05:24.823Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"f3e58104-a53e-4086-8805-f22b8669747c","stage":"booking","correlationId":"booking-created:098d845f30ecc009fb390198","attempts":1}
üìÖ Processing booking created for customer: 8HB56VH0T0WP9HQCVVW38Q7X9M
Full booking data: {
  "id": "qbkui7kgqqhv2k",
  "allDay": false,
  "source": "FIRST_PARTY_BUYER",
  "status": "CANCELLED_BY_SELLER",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94133-4608",
    "addressLine1": "550 Pacific Ave",
    "addressLine2": "",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-03T20:20:00Z",
  "version": 3,
  "createdAt": "2025-11-05T22:44:00Z",
  "updatedAt": "2025-11-27T19:52:38Z",
  "customerId": "8HB56VH0T0WP9HQCVVW38Q7X9M",
  "locationId": "LNQKVBTQZN3EZ",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "8HB56VH0T0WP9HQCVVW38Q7X9M",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMgsjtuk5cfKnstq",
      "anyTeamMember": false,
      "durationMinutes": 100,
      "serviceVariationId": "GA7YNKBDLK4UQDBTG3AXQQG4",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1761597690235"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Jessica Moment
üéâ First booking detected for customer: 8HB56VH0T0WP9HQCVVW38Q7X9M
   Name: Jessica Moment
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 8HB56VH0T0WP9HQCVVW38Q7X9M...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-10-06T17:07:05.838Z",
      "createdAt": "2025-10-06T17:07:05.838Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 8HB56VH0T0WP9HQCVVW38Q7X9M
{"ts":"2025-12-05T00:05:25.227Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"f3e58104-a53e-4086-8805-f22b8669747c","stage":"booking","correlationId":"booking-created:098d845f30ecc009fb390198"}
{"ts":"2025-12-05T00:05:25.386Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"96055794-d0be-4529-b691-84a50f9e88e0","stage":"booking","correlationId":"booking-created:cba75862ae4de05e3c6eda73","attempts":1}
üìÖ Processing booking created for customer: 8HB56VH0T0WP9HQCVVW38Q7X9M
Full booking data: {
  "id": "gotu3oy1urhxgi",
  "allDay": false,
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "startAt": "2025-12-03T20:30:00Z",
  "version": 2,
  "createdAt": "2025-12-03T22:18:25Z",
  "updatedAt": "2025-12-03T22:18:37Z",
  "customerId": "8HB56VH0T0WP9HQCVVW38Q7X9M",
  "locationId": "LNQKVBTQZN3EZ",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "creatorType": "TEAM_MEMBER",
    "teamMemberId": "TMWAtQTYmZpwwxii"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TM-zXe9fXe4axYWn",
      "anyTeamMember": false,
      "durationMinutes": 140,
      "serviceVariationId": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1764783981722"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Jessica Moment
üéâ First booking detected for customer: 8HB56VH0T0WP9HQCVVW38Q7X9M
   Name: Jessica Moment
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 8HB56VH0T0WP9HQCVVW38Q7X9M...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-10-06T17:07:05.838Z",
      "createdAt": "2025-10-06T17:07:05.838Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 8HB56VH0T0WP9HQCVVW38Q7X9M
{"ts":"2025-12-05T00:05:25.803Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"96055794-d0be-4529-b691-84a50f9e88e0","stage":"booking","correlationId":"booking-created:cba75862ae4de05e3c6eda73"}
{"ts":"2025-12-05T00:05:25.962Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"86ac3cfb-0870-4f7a-946f-e8714bd6a41d","stage":"booking","correlationId":"booking-created:83327697aa74050a080c9ba9","attempts":1}
üìÖ Processing booking created for customer: Z68BCYF3VWJM0YYQ6S0MYMFCAR
Full booking data: {
  "id": "7ysq4qsawufo2m",
  "allDay": false,
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94123-3940",
    "addressLine1": "2266 Union St",
    "addressLine2": "",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-03T21:00:00Z",
  "version": 4,
  "createdAt": "2025-12-03T18:01:59Z",
  "updatedAt": "2025-12-03T22:32:51Z",
  "customerId": "Z68BCYF3VWJM0YYQ6S0MYMFCAR",
  "locationId": "LT4ZHFBQQYB2N",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "Z68BCYF3VWJM0YYQ6S0MYMFCAR",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMMHlgFBIFbMTRap",
      "anyTeamMember": false,
      "durationMinutes": 100,
      "serviceVariationId": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1764609601083"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Nicole Greene
‚ÑπÔ∏è Customer Z68BCYF3VWJM0YYQ6S0MYMFCAR already received signup bonus, not first booking
{"ts":"2025-12-05T00:05:26.097Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"86ac3cfb-0870-4f7a-946f-e8714bd6a41d","stage":"booking","correlationId":"booking-created:83327697aa74050a080c9ba9"}
{"ts":"2025-12-05T00:05:26.256Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"63ace19e-780b-45b1-98fd-01657af74cd9","stage":"booking","correlationId":"booking-created:bc3fec4a4d53ffc17284fcbe","attempts":1}
üìÖ Processing booking created for customer: WZNZMGRVY2E373BZJVV0DBDBNW
Full booking data: {
  "id": "chpdeo10c7zxm7",
  "allDay": false,
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94133-4608",
    "addressLine1": "550 Pacific Ave",
    "addressLine2": "",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-03T21:00:00Z",
  "version": 3,
  "createdAt": "2025-12-02T21:59:35Z",
  "updatedAt": "2025-12-03T22:30:07Z",
  "customerId": "WZNZMGRVY2E373BZJVV0DBDBNW",
  "locationId": "LNQKVBTQZN3EZ",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "WZNZMGRVY2E373BZJVV0DBDBNW",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMXiw38Bbb7XQUWI",
      "anyTeamMember": false,
      "durationMinutes": 120,
      "serviceVariationId": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1764609601083"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Corinna King-Brown
üéâ First booking detected for customer: WZNZMGRVY2E373BZJVV0DBDBNW
   Name: Corinna King-Brown
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer WZNZMGRVY2E373BZJVV0DBDBNW...
   Full custom attributes response: {}
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: WZNZMGRVY2E373BZJVV0DBDBNW
{"ts":"2025-12-05T00:05:26.637Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"63ace19e-780b-45b1-98fd-01657af74cd9","stage":"booking","correlationId":"booking-created:bc3fec4a4d53ffc17284fcbe"}
{"ts":"2025-12-05T00:05:26.799Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"c218e9d0-07d9-44d7-b525-a0ff9b898672","stage":"booking","correlationId":"booking-created:7bf6ceb8822cc7b5bcc4e0e5","attempts":1}
üìÖ Processing booking created for customer: M611SY0KHTSXWEKZPW2N0EXF30
Full booking data: {
  "id": "z1rpq7z5x0qgb4",
  "allDay": false,
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94133-4608",
    "addressLine1": "550 Pacific Ave",
    "addressLine2": "",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-03T21:10:00Z",
  "version": 5,
  "createdAt": "2025-11-25T18:26:11Z",
  "updatedAt": "2025-12-04T01:57:01Z",
  "customerId": "M611SY0KHTSXWEKZPW2N0EXF30",
  "locationId": "LNQKVBTQZN3EZ",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "M611SY0KHTSXWEKZPW2N0EXF30",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMVwAQUdLz6no-cB",
      "anyTeamMember": false,
      "durationMinutes": 90,
      "serviceVariationId": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1763586786564"
    },
    {
      "teamMemberId": "TMVwAQUdLz6no-cB",
      "anyTeamMember": false,
      "durationMinutes": 20,
      "serviceVariationId": "HAJX45W3U2WUCCXM5MI24UEE",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1763586786564"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Chelsea Pristach
üéâ First booking detected for customer: M611SY0KHTSXWEKZPW2N0EXF30
   Name: Chelsea Pristach
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer M611SY0KHTSXWEKZPW2N0EXF30...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "af5791f8-348a-422e-98d1-5e865121bb19"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-05-07T03:22:51.848Z",
      "createdAt": "2025-05-07T03:22:51.848Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="af5791f8-348a-422e-98d1-5e865121bb19"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "af5791f8-348a-422e-98d1-5e865121bb19"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: M611SY0KHTSXWEKZPW2N0EXF30
{"ts":"2025-12-05T00:05:27.156Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"c218e9d0-07d9-44d7-b525-a0ff9b898672","stage":"booking","correlationId":"booking-created:7bf6ceb8822cc7b5bcc4e0e5"}
{"ts":"2025-12-05T00:05:27.316Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"bf00693d-211c-4716-8901-2945c36da08d","stage":"booking","correlationId":"booking-created:ccbee471554e00e3866427bc","attempts":1}
üìÖ Processing booking created for customer: XPKBCE5813V0WC51C7AR66DRJ4
Full booking data: {
  "id": "2zfxgnjwcpmmvi",
  "allDay": false,
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "startAt": "2025-12-03T21:45:00Z",
  "version": 3,
  "createdAt": "2025-11-20T22:45:08Z",
  "updatedAt": "2025-12-04T00:39:57Z",
  "customerId": "XPKBCE5813V0WC51C7AR66DRJ4",
  "locationId": "LT4ZHFBQQYB2N",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "creatorType": "TEAM_MEMBER",
    "teamMemberId": "TMQPbDVvvOCLwqsy"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMe-bT5XxKxmk0nw",
      "anyTeamMember": false,
      "durationMinutes": 140,
      "serviceVariationId": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1763586786564"
    },
    {
      "teamMemberId": "TMe-bT5XxKxmk0nw",
      "anyTeamMember": false,
      "durationMinutes": 5,
      "serviceVariationId": "DBRXEHQPCF7V4APTHDQTZW62",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1762374620368"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Aileen Bailitz
üéâ First booking detected for customer: XPKBCE5813V0WC51C7AR66DRJ4
   Name: Aileen Bailitz
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer XPKBCE5813V0WC51C7AR66DRJ4...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
      ],
      "version": 2,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-09-26T16:30:09.231Z",
      "createdAt": "2025-09-10T00:36:47.034Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: XPKBCE5813V0WC51C7AR66DRJ4
{"ts":"2025-12-05T00:05:27.717Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"bf00693d-211c-4716-8901-2945c36da08d","stage":"booking","correlationId":"booking-created:ccbee471554e00e3866427bc"}
{"ts":"2025-12-05T00:05:27.878Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"f166da01-181d-45b7-b854-888adc7e72ba","stage":"booking","correlationId":"booking-created:eb45e671fd76a9c0ba53ed6e","attempts":1}
üìÖ Processing booking created for customer: XPKBCE5813V0WC51C7AR66DRJ4
Full booking data: {
  "id": "n1lut314gjr9qg",
  "allDay": false,
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "startAt": "2025-12-03T21:45:00Z",
  "version": 6,
  "createdAt": "2025-11-06T21:23:58Z",
  "updatedAt": "2025-12-04T01:05:21Z",
  "customerId": "XPKBCE5813V0WC51C7AR66DRJ4",
  "locationId": "LT4ZHFBQQYB2N",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "creatorType": "TEAM_MEMBER",
    "teamMemberId": "TMQPbDVvvOCLwqsy"
  },
  "appointmentSegments": [
    {
      "resourceIds": [
        "KAOXILA4CV7A23VRAACC4R66"
      ],
      "teamMemberId": "TM9jDlRr_Hl4rdBB",
      "anyTeamMember": false,
      "durationMinutes": 90,
      "serviceVariationId": "ZEAKNB35I37RMXNUBGWDZQIM",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1760895536505"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Aileen Bailitz
üéâ First booking detected for customer: XPKBCE5813V0WC51C7AR66DRJ4
   Name: Aileen Bailitz
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer XPKBCE5813V0WC51C7AR66DRJ4...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
      ],
      "version": 2,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-09-26T16:30:09.231Z",
      "createdAt": "2025-09-10T00:36:47.034Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: XPKBCE5813V0WC51C7AR66DRJ4
{"ts":"2025-12-05T00:05:28.504Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"f166da01-181d-45b7-b854-888adc7e72ba","stage":"booking","correlationId":"booking-created:eb45e671fd76a9c0ba53ed6e"}
{"ts":"2025-12-05T00:05:28.815Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"b6359166-acdd-4052-a8d7-03eafd9e12b0","stage":"booking","correlationId":"booking-created:c27e07e197a54d1a7299f3a9","attempts":1}
üìÖ Processing booking created for customer: Z4RBCQ7KPAJ4YE0C85EYGDNXA0
Full booking data: {
  "id": "t6rogdiwbusrl0",
  "allDay": false,
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94123-3940",
    "addressLine1": "2266 Union St",
    "addressLine2": "",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-03T21:50:00Z",
  "version": 3,
  "createdAt": "2025-11-27T15:20:17Z",
  "updatedAt": "2025-12-04T01:04:42Z",
  "customerId": "Z4RBCQ7KPAJ4YE0C85EYGDNXA0",
  "locationId": "LT4ZHFBQQYB2N",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "Z4RBCQ7KPAJ4YE0C85EYGDNXA0",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMOscywuGXO2VURY",
      "anyTeamMember": false,
      "durationMinutes": 140,
      "serviceVariationId": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1763586786564"
    },
    {
      "teamMemberId": "TMOscywuGXO2VURY",
      "anyTeamMember": false,
      "durationMinutes": 15,
      "serviceVariationId": "KBHPHVKLJNAF223GMYIRUUH3",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1760895536505"
    },
    {
      "teamMemberId": "TMOscywuGXO2VURY",
      "anyTeamMember": false,
      "durationMinutes": 15,
      "serviceVariationId": "KBHPHVKLJNAF223GMYIRUUH3",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1760895536505"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Sarah Engers
üéâ First booking detected for customer: Z4RBCQ7KPAJ4YE0C85EYGDNXA0
   Name: Sarah Engers
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer Z4RBCQ7KPAJ4YE0C85EYGDNXA0...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-06-17T16:20:53.371Z",
      "createdAt": "2025-06-17T16:20:53.371Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: Z4RBCQ7KPAJ4YE0C85EYGDNXA0
{"ts":"2025-12-05T00:05:29.523Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"b6359166-acdd-4052-a8d7-03eafd9e12b0","stage":"booking","correlationId":"booking-created:c27e07e197a54d1a7299f3a9"}
{"ts":"2025-12-05T00:05:29.866Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"590dcbf3-2656-4f8a-a6f6-b03095994586","stage":"booking","correlationId":"booking-created:847fc81b60888c0c06217e68","attempts":1}
üìÖ Processing booking created for customer: BX2SZCCDJQPF5E64QDE8MM534M
Full booking data: {
  "id": "50lltyvry038mu",
  "allDay": false,
  "source": "FIRST_PARTY_MERCHANT",
  "status": "CANCELLED_BY_SELLER",
  "startAt": "2025-12-03T22:00:00Z",
  "version": 2,
  "createdAt": "2025-12-03T20:32:19Z",
  "updatedAt": "2025-12-03T20:57:25Z",
  "customerId": "BX2SZCCDJQPF5E64QDE8MM534M",
  "locationId": "LNQKVBTQZN3EZ",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "creatorType": "TEAM_MEMBER",
    "teamMemberId": "TMWAtQTYmZpwwxii"
  },
  "appointmentSegments": [
    {
      "resourceIds": [
        "5OVIQ6GSSUXORACP6T7WBAQ7"
      ],
      "teamMemberId": "TM-zXe9fXe4axYWn",
      "anyTeamMember": false,
      "durationMinutes": 60,
      "serviceVariationId": "SBE5XUATXRM76CBTT25HL2NZ",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1760895536505"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Lynn Rosenzweig
üéâ First booking detected for customer: BX2SZCCDJQPF5E64QDE8MM534M
   Name: Lynn Rosenzweig
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer BX2SZCCDJQPF5E64QDE8MM534M...
   Full custom attributes response: {}
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: BX2SZCCDJQPF5E64QDE8MM534M
{"ts":"2025-12-05T00:05:30.577Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"590dcbf3-2656-4f8a-a6f6-b03095994586","stage":"booking","correlationId":"booking-created:847fc81b60888c0c06217e68"}
{"ts":"2025-12-05T00:05:30.932Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"97e2b59d-58bb-4ac1-ab6a-19c49465f863","stage":"booking","correlationId":"booking-created:2dc4ea1139e9ba4485e92562","attempts":1}
üìÖ Processing booking created for customer: PJX3SHBDZN6BZ0SP7KK2AH8YZR
Full booking data: {
  "id": "ruc299rxutbyu6",
  "allDay": false,
  "source": "FIRST_PARTY_BUYER",
  "status": "CANCELLED_BY_CUSTOMER",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94133-4608",
    "addressLine1": "550 Pacific Ave",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-03T22:00:00Z",
  "version": 1,
  "createdAt": "2025-11-20T21:22:01Z",
  "updatedAt": "2025-11-25T17:14:49Z",
  "customerId": "PJX3SHBDZN6BZ0SP7KK2AH8YZR",
  "locationId": "LNQKVBTQZN3EZ",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "PJX3SHBDZN6BZ0SP7KK2AH8YZR",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMMCVDJoKh3ZkfFo",
      "anyTeamMember": false,
      "durationMinutes": 120,
      "serviceVariationId": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1763586786564"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Ali Gonsman
üéâ First booking detected for customer: PJX3SHBDZN6BZ0SP7KK2AH8YZR
   Name: Ali Gonsman
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer PJX3SHBDZN6BZ0SP7KK2AH8YZR...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-10-14T00:08:29.893Z",
      "createdAt": "2025-10-14T00:08:29.893Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: PJX3SHBDZN6BZ0SP7KK2AH8YZR
{"ts":"2025-12-05T00:05:31.440Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"97e2b59d-58bb-4ac1-ab6a-19c49465f863","stage":"booking","correlationId":"booking-created:2dc4ea1139e9ba4485e92562"}
{"ts":"2025-12-05T00:05:31.606Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"a66809fd-e0c8-4592-9068-ba1bc91d3a5d","stage":"booking","correlationId":"booking-created:4263561e1a03b80667359697","attempts":1}
üìÖ Processing booking created for customer: 3HS2JX1W5VSDVDDSYYB788SP2W
Full booking data: {
  "id": "255z59jxn3zi8o",
  "allDay": false,
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94133-4608",
    "addressLine1": "550 Pacific Ave",
    "addressLine2": "",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-03T22:30:00Z",
  "version": 6,
  "createdAt": "2025-11-13T06:45:37Z",
  "updatedAt": "2025-12-04T00:25:26Z",
  "customerId": "3HS2JX1W5VSDVDDSYYB788SP2W",
  "locationId": "LNQKVBTQZN3EZ",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "3HS2JX1W5VSDVDDSYYB788SP2W",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMgsjtuk5cfKnstq",
      "anyTeamMember": false,
      "durationMinutes": 100,
      "serviceVariationId": "GA7YNKBDLK4UQDBTG3AXQQG4",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1762893947284"
    },
    {
      "teamMemberId": "TMgsjtuk5cfKnstq",
      "anyTeamMember": false,
      "durationMinutes": 20,
      "serviceVariationId": "HAJX45W3U2WUCCXM5MI24UEE",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1762374620368"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Megan Nishikawa
‚ÑπÔ∏è Customer 3HS2JX1W5VSDVDDSYYB788SP2W already received signup bonus, not first booking
{"ts":"2025-12-05T00:05:31.747Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"a66809fd-e0c8-4592-9068-ba1bc91d3a5d","stage":"booking","correlationId":"booking-created:4263561e1a03b80667359697"}
{"ts":"2025-12-05T00:05:31.911Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"83fcbb8c-abae-444d-8e26-f78e6a2a7114","stage":"booking","correlationId":"booking-created:86f535b6e34db8205dc50ffc","attempts":1}
üìÖ Processing booking created for customer: 9CKA0D9BXK4V7Q0F2SPRPX5JYM
Full booking data: {
  "id": "ldpr2pxnrjy0ma",
  "allDay": false,
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "startAt": "2025-12-03T22:30:00Z",
  "version": 2,
  "createdAt": "2025-12-02T21:45:59Z",
  "updatedAt": "2025-12-04T00:38:37Z",
  "customerId": "9CKA0D9BXK4V7Q0F2SPRPX5JYM",
  "locationId": "LT4ZHFBQQYB2N",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "creatorType": "TEAM_MEMBER",
    "teamMemberId": "TMQPbDVvvOCLwqsy"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMyUMvTJIj2HrHSg",
      "anyTeamMember": false,
      "durationMinutes": 90,
      "serviceVariationId": "JMTK5M2CY2W7WEXSTAJKAJ35",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1762893947284"
    },
    {
      "resourceIds": [
        "KAOXILA4CV7A23VRAACC4R66"
      ],
      "teamMemberId": "TMyUMvTJIj2HrHSg",
      "anyTeamMember": false,
      "durationMinutes": 90,
      "serviceVariationId": "ZEAKNB35I37RMXNUBGWDZQIM",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1760895536505"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Sienna Torney
üéâ First booking detected for customer: 9CKA0D9BXK4V7Q0F2SPRPX5JYM
   Name: Sienna Torney
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 9CKA0D9BXK4V7Q0F2SPRPX5JYM...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "0826aee4-d259-434d-be44-511ac61b3629"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-10-24T22:04:26.005Z",
      "createdAt": "2025-10-24T22:04:26.005Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="0826aee4-d259-434d-be44-511ac61b3629"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "0826aee4-d259-434d-be44-511ac61b3629"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 9CKA0D9BXK4V7Q0F2SPRPX5JYM
{"ts":"2025-12-05T00:05:32.580Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"83fcbb8c-abae-444d-8e26-f78e6a2a7114","stage":"booking","correlationId":"booking-created:86f535b6e34db8205dc50ffc"}
{"ts":"2025-12-05T00:05:32.885Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"886d5457-5a63-4795-bdf2-6ecb1973c841","stage":"booking","correlationId":"booking-created:7e352e9b6223f53aa95f98eb","attempts":1}
üìÖ Processing booking created for customer: 10F3BTV9CWE3BJ5XS5S7JVK7T4
Full booking data: {
  "id": "y3gelf772m70vh",
  "allDay": false,
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94133-4608",
    "addressLine1": "550 Pacific Ave",
    "addressLine2": "",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-03T22:50:00Z",
  "version": 3,
  "createdAt": "2025-12-01T02:16:28Z",
  "updatedAt": "2025-12-03T23:50:46Z",
  "customerId": "10F3BTV9CWE3BJ5XS5S7JVK7T4",
  "locationId": "LNQKVBTQZN3EZ",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "10F3BTV9CWE3BJ5XS5S7JVK7T4",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMVwAQUdLz6no-cB",
      "anyTeamMember": false,
      "durationMinutes": 90,
      "serviceVariationId": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1763586786564"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Rachel Salinas
üéâ First booking detected for customer: 10F3BTV9CWE3BJ5XS5S7JVK7T4
   Name: Rachel Salinas
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 10F3BTV9CWE3BJ5XS5S7JVK7T4...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "c0f2ee04-4762-42c6-a593-a4e745a81c92"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-04-03T22:53:45.349Z",
      "createdAt": "2025-04-03T22:53:45.349Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="c0f2ee04-4762-42c6-a593-a4e745a81c92"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "c0f2ee04-4762-42c6-a593-a4e745a81c92"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 10F3BTV9CWE3BJ5XS5S7JVK7T4
{"ts":"2025-12-05T00:05:33.416Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"886d5457-5a63-4795-bdf2-6ecb1973c841","stage":"booking","correlationId":"booking-created:7e352e9b6223f53aa95f98eb"}
{"ts":"2025-12-05T00:05:33.575Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"33fdab79-48af-4a49-a14b-62c5e1c9c162","stage":"booking","correlationId":"booking-created:ef0e1a01b516f72e05d8cabe","attempts":1}
üìÖ Processing booking created for customer: BX2SZCCDJQPF5E64QDE8MM534M
Full booking data: {
  "id": "840gidkdb6vreb",
  "allDay": false,
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "startAt": "2025-12-03T23:00:00Z",
  "version": 6,
  "createdAt": "2025-12-03T20:31:33Z",
  "updatedAt": "2025-12-04T01:34:06Z",
  "customerId": "BX2SZCCDJQPF5E64QDE8MM534M",
  "locationId": "LNQKVBTQZN3EZ",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "creatorType": "TEAM_MEMBER",
    "teamMemberId": "TMWAtQTYmZpwwxii"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMSt73bSp59caRzt",
      "anyTeamMember": false,
      "durationMinutes": 5,
      "serviceVariationId": "DBRXEHQPCF7V4APTHDQTZW62",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1762374620368"
    },
    {
      "teamMemberId": "TMSt73bSp59caRzt",
      "anyTeamMember": false,
      "durationMinutes": 140,
      "serviceVariationId": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1764783981722"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Lynn Rosenzweig
üéâ First booking detected for customer: BX2SZCCDJQPF5E64QDE8MM534M
   Name: Lynn Rosenzweig
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer BX2SZCCDJQPF5E64QDE8MM534M...
   Full custom attributes response: {}
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: BX2SZCCDJQPF5E64QDE8MM534M
{"ts":"2025-12-05T00:05:33.926Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"33fdab79-48af-4a49-a14b-62c5e1c9c162","stage":"booking","correlationId":"booking-created:ef0e1a01b516f72e05d8cabe"}
{"ts":"2025-12-05T00:05:34.108Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"e7215bd3-8bc9-4d29-bcf1-e7bc5e252c37","stage":"booking","correlationId":"booking-created:acf85977ec6676388c175e29","attempts":1}
üìÖ Processing booking created for customer: BX2SZCCDJQPF5E64QDE8MM534M
Full booking data: {
  "id": "bxzvvmfmm0vvu6",
  "allDay": false,
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "startAt": "2025-12-03T23:00:00Z",
  "version": 4,
  "createdAt": "2025-12-03T20:57:57Z",
  "updatedAt": "2025-12-04T01:33:37Z",
  "customerId": "BX2SZCCDJQPF5E64QDE8MM534M",
  "locationId": "LNQKVBTQZN3EZ",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "creatorType": "TEAM_MEMBER",
    "teamMemberId": "TMWAtQTYmZpwwxii"
  },
  "appointmentSegments": [
    {
      "resourceIds": [
        "5OVIQ6GSSUXORACP6T7WBAQ7"
      ],
      "teamMemberId": "TMXiw38Bbb7XQUWI",
      "anyTeamMember": false,
      "durationMinutes": 60,
      "serviceVariationId": "SBE5XUATXRM76CBTT25HL2NZ",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1760895536505"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Lynn Rosenzweig
üéâ First booking detected for customer: BX2SZCCDJQPF5E64QDE8MM534M
   Name: Lynn Rosenzweig
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer BX2SZCCDJQPF5E64QDE8MM534M...
   Full custom attributes response: {}
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: BX2SZCCDJQPF5E64QDE8MM534M
{"ts":"2025-12-05T00:05:34.479Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"e7215bd3-8bc9-4d29-bcf1-e7bc5e252c37","stage":"booking","correlationId":"booking-created:acf85977ec6676388c175e29"}
{"ts":"2025-12-05T00:05:34.643Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"66c6d763-6dc7-4aad-b8e9-475884fd268c","stage":"booking","correlationId":"booking-created:804aaa85afe4a154a34bcfb6","attempts":1}
üìÖ Processing booking created for customer: JMG703XHJEPBZNFYFH75H4C6S0
Full booking data: {
  "id": "dh158g76vwsqiu",
  "allDay": false,
  "source": "FIRST_PARTY_BUYER",
  "status": "CANCELLED_BY_SELLER",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94123-3940",
    "addressLine1": "2266 Union St",
    "addressLine2": "",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-03T23:00:00Z",
  "version": 2,
  "createdAt": "2025-11-04T14:56:39Z",
  "updatedAt": "2025-12-03T00:50:14Z",
  "customerId": "JMG703XHJEPBZNFYFH75H4C6S0",
  "locationId": "LT4ZHFBQQYB2N",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "JMG703XHJEPBZNFYFH75H4C6S0",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMMHlgFBIFbMTRap",
      "anyTeamMember": false,
      "durationMinutes": 100,
      "serviceVariationId": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1758921239397"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Sharini Balasuriya
üéâ First booking detected for customer: JMG703XHJEPBZNFYFH75H4C6S0
   Name: Sharini Balasuriya
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer JMG703XHJEPBZNFYFH75H4C6S0...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "cb289afd-ba17-4a65-a12b-b7bbae60a65e"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-08-06T20:17:59.455Z",
      "createdAt": "2025-08-06T20:17:59.455Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="cb289afd-ba17-4a65-a12b-b7bbae60a65e"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "cb289afd-ba17-4a65-a12b-b7bbae60a65e"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: JMG703XHJEPBZNFYFH75H4C6S0
{"ts":"2025-12-05T00:05:35.308Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"66c6d763-6dc7-4aad-b8e9-475884fd268c","stage":"booking","correlationId":"booking-created:804aaa85afe4a154a34bcfb6"}
{"ts":"2025-12-05T00:05:35.629Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"89841f82-a8d2-46cd-81aa-a241fe00ca79","stage":"booking","correlationId":"booking-created:da97f332c67f2cd6d77bdef2","attempts":1}
üìÖ Processing booking created for customer: VRC2G1PHS14ZBK37F5G5TZYT0M
Full booking data: {
  "id": "qzdzhn5mndzs3j",
  "allDay": false,
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "startAt": "2025-12-03T23:15:00Z",
  "version": 3,
  "createdAt": "2025-12-03T01:46:36Z",
  "updatedAt": "2025-12-04T01:14:32Z",
  "customerId": "VRC2G1PHS14ZBK37F5G5TZYT0M",
  "locationId": "LT4ZHFBQQYB2N",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "creatorType": "TEAM_MEMBER",
    "teamMemberId": "TMQPbDVvvOCLwqsy"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TM9jDlRr_Hl4rdBB",
      "anyTeamMember": false,
      "durationMinutes": 150,
      "serviceVariationId": "4QI3JWGEYQANKCGC36J3MYNB",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1758654327496"
    },
    {
      "teamMemberId": "TM9jDlRr_Hl4rdBB",
      "anyTeamMember": false,
      "durationMinutes": 10,
      "serviceVariationId": "6F6F3OAFJSOEN3X7HSXYIVQC",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1760895536505"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Suraksha Suresh Pai
üéâ First booking detected for customer: VRC2G1PHS14ZBK37F5G5TZYT0M
   Name: Suraksha Suresh Pai
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer VRC2G1PHS14ZBK37F5G5TZYT0M...
   Full custom attributes response: {}
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: VRC2G1PHS14ZBK37F5G5TZYT0M
{"ts":"2025-12-05T00:05:36.363Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"89841f82-a8d2-46cd-81aa-a241fe00ca79","stage":"booking","correlationId":"booking-created:da97f332c67f2cd6d77bdef2"}
{"ts":"2025-12-05T00:05:36.721Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"c42d10ed-aa96-4722-84da-96335bf23779","stage":"booking","correlationId":"booking-created:b1c1c144af5d546236eab2fa","attempts":1}
üìÖ Processing booking created for customer: 6PQ82YBVJ5G1WRQ46A1KR3KWBM
Full booking data: {
  "id": "24eooox1ydwwba",
  "allDay": false,
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "startAt": "2025-12-03T23:30:00Z",
  "version": 0,
  "createdAt": "2025-12-02T22:28:55Z",
  "updatedAt": "2025-12-03T20:51:13Z",
  "customerId": "6PQ82YBVJ5G1WRQ46A1KR3KWBM",
  "locationId": "LNQKVBTQZN3EZ",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "creatorType": "TEAM_MEMBER",
    "teamMemberId": "TMWAtQTYmZpwwxii"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMMBgVwykMnOlumA",
      "anyTeamMember": false,
      "durationMinutes": 30,
      "serviceVariationId": "SGSLS3INMK5YV637KUITCILL",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1760895536505"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Candice Adden
üéâ First booking detected for customer: 6PQ82YBVJ5G1WRQ46A1KR3KWBM
   Name: Candice Adden
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 6PQ82YBVJ5G1WRQ46A1KR3KWBM...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-11-02T20:59:34.231Z",
      "createdAt": "2025-11-02T20:59:34.231Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 6PQ82YBVJ5G1WRQ46A1KR3KWBM
{"ts":"2025-12-05T00:05:37.312Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"c42d10ed-aa96-4722-84da-96335bf23779","stage":"booking","correlationId":"booking-created:b1c1c144af5d546236eab2fa"}
{"ts":"2025-12-05T00:05:37.476Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"31207858-c486-40ed-92f2-ff8ccd83ef9b","stage":"booking","correlationId":"booking-created:c4221617b4db0981cc125262","attempts":1}
üìÖ Processing booking created for customer: 9346KFBJCMQM6441TJYVJK18H0
Full booking data: {
  "id": "cx9d8u1z32ah5l",
  "allDay": false,
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94133-4608",
    "addressLine1": "550 Pacific Ave",
    "addressLine2": "",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-04T00:00:00Z",
  "version": 4,
  "createdAt": "2025-11-29T23:09:53Z",
  "updatedAt": "2025-12-04T02:24:32Z",
  "customerId": "9346KFBJCMQM6441TJYVJK18H0",
  "locationId": "LNQKVBTQZN3EZ",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "9346KFBJCMQM6441TJYVJK18H0",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TM-zXe9fXe4axYWn",
      "anyTeamMember": false,
      "durationMinutes": 120,
      "serviceVariationId": "HXLBKQC3DRE57DB7IK5RBYOB",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1758654327496"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Adlon Adams
üéâ First booking detected for customer: 9346KFBJCMQM6441TJYVJK18H0
   Name: Adlon Adams
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 9346KFBJCMQM6441TJYVJK18H0...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "a7b40271-729a-41aa-801b-fb1fffb83650"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-06-04T11:41:45.313Z",
      "createdAt": "2025-06-04T11:41:45.313Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="a7b40271-729a-41aa-801b-fb1fffb83650"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "a7b40271-729a-41aa-801b-fb1fffb83650"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 9346KFBJCMQM6441TJYVJK18H0
{"ts":"2025-12-05T00:05:37.853Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"31207858-c486-40ed-92f2-ff8ccd83ef9b","stage":"booking","correlationId":"booking-created:c4221617b4db0981cc125262"}
{"ts":"2025-12-05T00:05:38.011Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"4cb6cbcb-d7f1-4612-8bb3-9c297ee5596f","stage":"booking","correlationId":"booking-created:7db7d06998209414b220044d","attempts":1}
üìÖ Processing booking created for customer: SF4S7AZ7H3QHYJKJMAEAR5A1QR
Full booking data: {
  "id": "p90rz99w8tcp6q",
  "allDay": false,
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94133-4608",
    "addressLine1": "550 Pacific Ave",
    "addressLine2": "",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-04T00:00:00Z",
  "version": 3,
  "createdAt": "2025-11-22T23:23:18Z",
  "updatedAt": "2025-12-04T01:35:01Z",
  "customerId": "SF4S7AZ7H3QHYJKJMAEAR5A1QR",
  "locationId": "LNQKVBTQZN3EZ",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "SF4S7AZ7H3QHYJKJMAEAR5A1QR",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMMBgVwykMnOlumA",
      "anyTeamMember": false,
      "durationMinutes": 140,
      "serviceVariationId": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1763586786564"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Sarah Dunn
üéâ First booking detected for customer: SF4S7AZ7H3QHYJKJMAEAR5A1QR
   Name: Sarah Dunn
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer SF4S7AZ7H3QHYJKJMAEAR5A1QR...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "af5791f8-348a-422e-98d1-5e865121bb19"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-09-16T16:20:22.548Z",
      "createdAt": "2025-09-16T16:20:22.548Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="af5791f8-348a-422e-98d1-5e865121bb19"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "af5791f8-348a-422e-98d1-5e865121bb19"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: SF4S7AZ7H3QHYJKJMAEAR5A1QR
{"ts":"2025-12-05T00:05:38.382Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"4cb6cbcb-d7f1-4612-8bb3-9c297ee5596f","stage":"booking","correlationId":"booking-created:7db7d06998209414b220044d"}
{"ts":"2025-12-05T00:05:38.543Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"52a8f4c3-28f3-45b6-8eae-469820aeeea0","stage":"booking","correlationId":"booking-created:956e8627f7556105d57ac885","attempts":1}
üìÖ Processing booking created for customer: 3TP2FH9DJ94C1ENRC8QK038430
Full booking data: {
  "id": "tnq8wow4ps6myf",
  "allDay": false,
  "source": "FIRST_PARTY_BUYER",
  "status": "CANCELLED_BY_CUSTOMER",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94133-4608",
    "addressLine1": "550 Pacific Ave",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-04T00:00:00Z",
  "version": 1,
  "createdAt": "2025-11-10T03:10:16Z",
  "updatedAt": "2025-11-24T22:02:43Z",
  "customerId": "3TP2FH9DJ94C1ENRC8QK038430",
  "locationId": "LNQKVBTQZN3EZ",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "3TP2FH9DJ94C1ENRC8QK038430",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMMCVDJoKh3ZkfFo",
      "anyTeamMember": false,
      "durationMinutes": 120,
      "serviceVariationId": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1758921239397"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Kate Sheridan
‚ÑπÔ∏è Customer 3TP2FH9DJ94C1ENRC8QK038430 already received signup bonus, not first booking
{"ts":"2025-12-05T00:05:38.676Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"52a8f4c3-28f3-45b6-8eae-469820aeeea0","stage":"booking","correlationId":"booking-created:956e8627f7556105d57ac885"}
{"ts":"2025-12-05T00:05:38.835Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"e7579d28-e925-4040-8dff-c9e5e7010a84","stage":"booking","correlationId":"booking-created:9c9d0db74ebb2a769382e2f8","attempts":1}
üìÖ Processing booking created for customer: D64SF6SGTAZKDT2CWC9BCQ5RD8
Full booking data: {
  "id": "w04thqtgdfxg6r",
  "allDay": false,
  "source": "FIRST_PARTY_BUYER",
  "status": "CANCELLED_BY_CUSTOMER",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94133-4608",
    "addressLine1": "550 Pacific Ave",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-04T00:00:00Z",
  "version": 1,
  "createdAt": "2025-11-29T02:52:50Z",
  "updatedAt": "2025-12-02T16:14:36Z",
  "customerId": "D64SF6SGTAZKDT2CWC9BCQ5RD8",
  "locationId": "LNQKVBTQZN3EZ",
  "customerNote": "Will add friend referral soon",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "D64SF6SGTAZKDT2CWC9BCQ5RD8",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMSt73bSp59caRzt",
      "anyTeamMember": true,
      "durationMinutes": 140,
      "serviceVariationId": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1763586786564"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Paulina Kaminski
üéâ First booking detected for customer: D64SF6SGTAZKDT2CWC9BCQ5RD8
   Name: Paulina Kaminski
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer D64SF6SGTAZKDT2CWC9BCQ5RD8...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "af5791f8-348a-422e-98d1-5e865121bb19"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-11-28T03:32:44.466Z",
      "createdAt": "2025-11-28T03:32:44.466Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="af5791f8-348a-422e-98d1-5e865121bb19"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "af5791f8-348a-422e-98d1-5e865121bb19"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: D64SF6SGTAZKDT2CWC9BCQ5RD8
{"ts":"2025-12-05T00:05:39.214Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"e7579d28-e925-4040-8dff-c9e5e7010a84","stage":"booking","correlationId":"booking-created:9c9d0db74ebb2a769382e2f8"}
{"ts":"2025-12-05T00:05:39.380Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"e3793cc1-aab6-455f-a7ae-0d9d16e088c9","stage":"booking","correlationId":"booking-created:7e443e2b88e5b9c1a357aef4","attempts":1}
üìÖ Processing booking created for customer: J6Q15M28PA893P6KGSHY59W2TR
Full booking data: {
  "id": "z8dxvzlz6mwvek",
  "allDay": false,
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94133-4608",
    "addressLine1": "550 Pacific Ave",
    "addressLine2": "",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-04T00:00:00Z",
  "version": 3,
  "createdAt": "2025-11-26T05:32:24Z",
  "updatedAt": "2025-12-04T02:23:48Z",
  "customerId": "J6Q15M28PA893P6KGSHY59W2TR",
  "locationId": "LNQKVBTQZN3EZ",
  "sellerNote": "$20 —Å–¥–µ–ª–∞—Ç—å —Å–∫–∏–¥–∫—É –Ω–∞ —Å–ª–µ–¥—É—é—â–µ–µ –ø–æ—Å–µ—â–µ–Ω–∏–µ",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "J6Q15M28PA893P6KGSHY59W2TR",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMXiw38Bbb7XQUWI",
      "anyTeamMember": false,
      "durationMinutes": 120,
      "serviceVariationId": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1763586786564"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Sara Moore
üéâ First booking detected for customer: J6Q15M28PA893P6KGSHY59W2TR
   Name: Sara Moore
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer J6Q15M28PA893P6KGSHY59W2TR...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "0826aee4-d259-434d-be44-511ac61b3629"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-11-06T14:43:43.398Z",
      "createdAt": "2025-11-06T14:43:43.398Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="0826aee4-d259-434d-be44-511ac61b3629"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "0826aee4-d259-434d-be44-511ac61b3629"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: J6Q15M28PA893P6KGSHY59W2TR
{"ts":"2025-12-05T00:05:39.830Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"e3793cc1-aab6-455f-a7ae-0d9d16e088c9","stage":"booking","correlationId":"booking-created:7e443e2b88e5b9c1a357aef4"}
{"ts":"2025-12-05T00:05:39.989Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"cf438348-76dc-43a7-95ca-f62d45396835","stage":"booking","correlationId":"booking-created:d0085783c2b365c7862e3b54","attempts":1}
üìÖ Processing booking created for customer: Q897VDD6EPK48359WWJNBN2YSW
Full booking data: {
  "id": "ouj6cu0m5wy9ih",
  "allDay": false,
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94123-3940",
    "addressLine1": "2266 Union St",
    "addressLine2": "",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-04T00:10:00Z",
  "version": 2,
  "createdAt": "2025-11-25T22:49:16Z",
  "updatedAt": "2025-12-04T02:27:46Z",
  "customerId": "Q897VDD6EPK48359WWJNBN2YSW",
  "locationId": "LT4ZHFBQQYB2N",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "Q897VDD6EPK48359WWJNBN2YSW",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMe-bT5XxKxmk0nw",
      "anyTeamMember": false,
      "durationMinutes": 140,
      "serviceVariationId": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1763586786564"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Anna Bausova
‚ÑπÔ∏è Customer Q897VDD6EPK48359WWJNBN2YSW already received signup bonus, not first booking
{"ts":"2025-12-05T00:05:40.134Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"cf438348-76dc-43a7-95ca-f62d45396835","stage":"booking","correlationId":"booking-created:d0085783c2b365c7862e3b54"}
{"ts":"2025-12-05T00:05:40.293Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"5eb33b46-0235-4382-b423-77581ef83e68","stage":"booking","correlationId":"booking-created:b05210d458d27b803323db89","attempts":1}
üìÖ Processing booking created for customer: MKJ6QJ202C3737YYZRZ4FNPH4R
Full booking data: {
  "id": "ze4ow747uzmrq5",
  "allDay": false,
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94123-3940",
    "addressLine1": "2266 Union St",
    "addressLine2": "",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-04T00:40:00Z",
  "version": 3,
  "createdAt": "2025-12-01T20:30:38Z",
  "updatedAt": "2025-12-04T03:42:06Z",
  "customerId": "MKJ6QJ202C3737YYZRZ4FNPH4R",
  "locationId": "LT4ZHFBQQYB2N",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "MKJ6QJ202C3737YYZRZ4FNPH4R",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMOscywuGXO2VURY",
      "anyTeamMember": false,
      "durationMinutes": 140,
      "serviceVariationId": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1763586786564"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Rachel Yetso
üéâ First booking detected for customer: MKJ6QJ202C3737YYZRZ4FNPH4R
   Name: Rachel Yetso
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer MKJ6QJ202C3737YYZRZ4FNPH4R...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
      ],
      "version": 2,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-12-01T20:30:38.560Z",
      "createdAt": "2025-08-31T19:21:55.895Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: MKJ6QJ202C3737YYZRZ4FNPH4R
{"ts":"2025-12-05T00:05:40.652Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"5eb33b46-0235-4382-b423-77581ef83e68","stage":"booking","correlationId":"booking-created:b05210d458d27b803323db89"}
{"ts":"2025-12-05T00:05:40.819Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"d3015535-914d-4be5-bf68-7129e1923a68","stage":"booking","correlationId":"booking-created:9dd2b2af2cb96cb4c6e986b9","attempts":1}
üìÖ Processing booking created for customer: 76VQ8AGX9Z2K1YBRSABJ5QJH4G
Full booking data: {
  "id": "hihtsb29m3vuqi",
  "allDay": false,
  "source": "FIRST_PARTY_BUYER",
  "status": "CANCELLED_BY_SELLER",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94123-3940",
    "addressLine1": "2266 Union St",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-04T01:00:00Z",
  "version": 1,
  "createdAt": "2025-11-17T03:55:04Z",
  "updatedAt": "2025-11-18T01:49:24Z",
  "customerId": "76VQ8AGX9Z2K1YBRSABJ5QJH4G",
  "locationId": "LT4ZHFBQQYB2N",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "76VQ8AGX9Z2K1YBRSABJ5QJH4G",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMew76L_w3bra6AH",
      "anyTeamMember": false,
      "durationMinutes": 100,
      "serviceVariationId": "3RGAKDF5FVT2CSEJTMKUSTG6",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1762893947284"
    },
    {
      "teamMemberId": "TMew76L_w3bra6AH",
      "anyTeamMember": false,
      "durationMinutes": 20,
      "serviceVariationId": "HAJX45W3U2WUCCXM5MI24UEE",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1762374620368"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Roe Simmons
üéâ First booking detected for customer: 76VQ8AGX9Z2K1YBRSABJ5QJH4G
   Name: Roe Simmons
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 76VQ8AGX9Z2K1YBRSABJ5QJH4G...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "af5791f8-348a-422e-98d1-5e865121bb19"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-09-21T03:59:50.466Z",
      "createdAt": "2025-09-21T03:59:50.466Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="af5791f8-348a-422e-98d1-5e865121bb19"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "af5791f8-348a-422e-98d1-5e865121bb19"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 76VQ8AGX9Z2K1YBRSABJ5QJH4G
{"ts":"2025-12-05T00:05:41.199Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"d3015535-914d-4be5-bf68-7129e1923a68","stage":"booking","correlationId":"booking-created:9dd2b2af2cb96cb4c6e986b9"}
{"ts":"2025-12-05T00:05:41.358Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"e5a0fc82-51fe-4df3-9017-bc4d9e4c9da5","stage":"booking","correlationId":"booking-created:ef79ef4c81b67cf15c0a8283","attempts":1}
üìÖ Processing booking created for customer: 2F7KF3BN3EKZ2HZK8K3GHHYNA4
Full booking data: {
  "id": "y2bo81a8hl6q4f",
  "allDay": false,
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "startAt": "2025-12-04T01:00:00Z",
  "version": 2,
  "createdAt": "2025-12-02T18:50:53Z",
  "updatedAt": "2025-12-04T04:08:22Z",
  "customerId": "2F7KF3BN3EKZ2HZK8K3GHHYNA4",
  "locationId": "LNQKVBTQZN3EZ",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "creatorType": "TEAM_MEMBER",
    "teamMemberId": "TMWAtQTYmZpwwxii"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMSt73bSp59caRzt",
      "anyTeamMember": false,
      "durationMinutes": 140,
      "serviceVariationId": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1763586786564"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Emily Nansen
üéâ First booking detected for customer: 2F7KF3BN3EKZ2HZK8K3GHHYNA4
   Name: Emily Nansen
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 2F7KF3BN3EKZ2HZK8K3GHHYNA4...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:a3dde506-f69e-48e4-a98a-004c1822d3ad",
      "value": "FriendZorina",
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-10-27T19:54:23.552Z",
      "createdAt": "2025-10-27T19:54:23.552Z"
    },
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-05-27T21:26:21.455Z",
      "createdAt": "2025-05-27T21:26:21.455Z"
    }
  ]
}
   üìã Custom attribute: key="square:a3dde506-f69e-48e4-a98a-004c1822d3ad", value="FriendZorina"
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
   Custom attributes from Square: {
  "square:a3dde506-f69e-48e4-a98a-004c1822d3ad": "FriendZorina",
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   üîç Checking custom attribute value: "FriendZorina" (key: square:a3dde506-f69e-48e4-a98a-004c1822d3ad)
   üîç Looking up referral code in database: "FRIENDZORINA" (original: "FriendZorina")
   ‚ùå No referrer found with code "FriendZorina" or "FRIENDZORINA"
   üîç Database lookup result for "FriendZorina": NOT FOUND
   ‚ö†Ô∏è Value "FriendZorina" is not a valid referral code in database
   ‚ö†Ô∏è This means either: 1) Code doesn't exist, or 2) Referrer hasn't completed first payment yet
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 2F7KF3BN3EKZ2HZK8K3GHHYNA4
{"ts":"2025-12-05T00:05:41.816Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"e5a0fc82-51fe-4df3-9017-bc4d9e4c9da5","stage":"booking","correlationId":"booking-created:ef79ef4c81b67cf15c0a8283"}
{"ts":"2025-12-05T00:05:41.978Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"ff521c99-6fc1-494d-8013-c44e4395f292","stage":"booking","correlationId":"booking-created:09a4ef1c3572b853a18dbb4d","attempts":1}
üìÖ Processing booking created for customer: 783E7QPK6P2ZDYFYE0AG616R8W
Full booking data: {
  "id": "jeaezsftepggfa",
  "allDay": false,
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94133-4608",
    "addressLine1": "550 Pacific Ave",
    "addressLine2": "",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-04T01:20:00Z",
  "version": 2,
  "createdAt": "2025-11-06T22:50:04Z",
  "updatedAt": "2025-12-04T02:45:26Z",
  "customerId": "783E7QPK6P2ZDYFYE0AG616R8W",
  "locationId": "LNQKVBTQZN3EZ",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "783E7QPK6P2ZDYFYE0AG616R8W",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMgsjtuk5cfKnstq",
      "anyTeamMember": false,
      "durationMinutes": 110,
      "serviceVariationId": "6TYOE67IDYTKHW2ZG6HKVZER",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1761597690235"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Courtney Coakley
üéâ First booking detected for customer: 783E7QPK6P2ZDYFYE0AG616R8W
   Name: Courtney Coakley
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 783E7QPK6P2ZDYFYE0AG616R8W...
   Full custom attributes response: {}
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 783E7QPK6P2ZDYFYE0AG616R8W
{"ts":"2025-12-05T00:05:42.348Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"ff521c99-6fc1-494d-8013-c44e4395f292","stage":"booking","correlationId":"booking-created:09a4ef1c3572b853a18dbb4d"}
{"ts":"2025-12-05T00:05:42.508Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"b92b2935-891b-4ff8-a7bc-abaf087a0842","stage":"booking","correlationId":"booking-created:4216f42caf8bfec4f018e13d","attempts":1}
üìÖ Processing booking created for customer: BXBTYQN9H36QD43PBT3Q0QPWJR
Full booking data: {
  "id": "fcrc1ttyk4ylz1",
  "allDay": false,
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "startAt": "2025-12-04T01:30:00Z",
  "version": 2,
  "createdAt": "2025-11-14T02:56:54Z",
  "updatedAt": "2025-12-04T02:41:16Z",
  "customerId": "BXBTYQN9H36QD43PBT3Q0QPWJR",
  "locationId": "LT4ZHFBQQYB2N",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "creatorType": "TEAM_MEMBER",
    "teamMemberId": "TMQPbDVvvOCLwqsy"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TM9jDlRr_Hl4rdBB",
      "anyTeamMember": false,
      "durationMinutes": 90,
      "serviceVariationId": "XBUDIMNKOPC2XVG5YLIQ4RYS",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1762893947284"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Ashley Chu
‚ÑπÔ∏è Customer BXBTYQN9H36QD43PBT3Q0QPWJR already received signup bonus, not first booking
{"ts":"2025-12-05T00:05:42.656Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"b92b2935-891b-4ff8-a7bc-abaf087a0842","stage":"booking","correlationId":"booking-created:4216f42caf8bfec4f018e13d"}
{"ts":"2025-12-05T00:05:42.837Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"424c768c-9f95-4f92-80ff-badf8fe4a498","stage":"booking","correlationId":"booking-created:9c5e5765958d0d78305c8bec","attempts":1}
üìÖ Processing booking created for customer: V9XW1F5VV01C0XFY7G65JC3XE8
Full booking data: {
  "id": "gf9em71e2v4qht",
  "allDay": false,
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94133-4608",
    "addressLine1": "550 Pacific Ave",
    "addressLine2": "",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-04T02:10:00Z",
  "version": 7,
  "createdAt": "2025-12-01T17:38:07Z",
  "updatedAt": "2025-12-04T03:32:41Z",
  "customerId": "V9XW1F5VV01C0XFY7G65JC3XE8",
  "locationId": "LNQKVBTQZN3EZ",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "V9XW1F5VV01C0XFY7G65JC3XE8",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMMBgVwykMnOlumA",
      "anyTeamMember": false,
      "durationMinutes": 140,
      "serviceVariationId": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1763586786564"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Charlotte Waechter
üéâ First booking detected for customer: V9XW1F5VV01C0XFY7G65JC3XE8
   Name: Charlotte Waechter
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer V9XW1F5VV01C0XFY7G65JC3XE8...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-08-18T20:06:30.627Z",
      "createdAt": "2025-08-18T20:06:30.627Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: V9XW1F5VV01C0XFY7G65JC3XE8
{"ts":"2025-12-05T00:05:43.237Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"424c768c-9f95-4f92-80ff-badf8fe4a498","stage":"booking","correlationId":"booking-created:9c5e5765958d0d78305c8bec"}
{"ts":"2025-12-05T00:05:43.400Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"91499c75-b9ff-4ddf-8e40-190612522678","stage":"booking","correlationId":"booking-created:43314a68f89db74deb767c07","attempts":1}
üìÖ Processing booking created for customer: S9R57Z7EC13A7Z42AVMH0NTCXR
Full booking data: {
  "id": "80fho8e389s0se",
  "allDay": false,
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94133-4608",
    "addressLine1": "550 Pacific Ave",
    "addressLine2": "",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-04T17:00:00Z",
  "version": 2,
  "createdAt": "2025-12-03T22:29:28Z",
  "updatedAt": "2025-12-04T19:02:27Z",
  "customerId": "S9R57Z7EC13A7Z42AVMH0NTCXR",
  "locationId": "LNQKVBTQZN3EZ",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "S9R57Z7EC13A7Z42AVMH0NTCXR",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMEWAZHdtaiRR_Zs",
      "anyTeamMember": false,
      "durationMinutes": 120,
      "serviceVariationId": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1764609601083"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Daria Kravchenko
üéâ First booking detected for customer: S9R57Z7EC13A7Z42AVMH0NTCXR
   Name: Daria Kravchenko
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer S9R57Z7EC13A7Z42AVMH0NTCXR...
   Full custom attributes response: {}
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: S9R57Z7EC13A7Z42AVMH0NTCXR
{"ts":"2025-12-05T00:05:43.759Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"91499c75-b9ff-4ddf-8e40-190612522678","stage":"booking","correlationId":"booking-created:43314a68f89db74deb767c07"}
{"ts":"2025-12-05T00:05:43.919Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"17d74885-e685-44d1-9977-f35354dd3bf2","stage":"booking","correlationId":"booking-created:f47c4e78813ddead705e300e","attempts":1}
üìÖ Processing booking created for customer: BRGH9TZKVSXSZ9ZQ8ZXVB4MREW
Full booking data: {
  "id": "8cct2upbyg62ay",
  "allDay": false,
  "source": "FIRST_PARTY_BUYER",
  "status": "CANCELLED_BY_CUSTOMER",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94123-3940",
    "addressLine1": "2266 Union St",
    "addressLine2": "",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-04T17:00:00Z",
  "version": 2,
  "createdAt": "2025-11-13T13:46:05Z",
  "updatedAt": "2025-11-19T20:16:28Z",
  "customerId": "BRGH9TZKVSXSZ9ZQ8ZXVB4MREW",
  "locationId": "LT4ZHFBQQYB2N",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "BRGH9TZKVSXSZ9ZQ8ZXVB4MREW",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMMHlgFBIFbMTRap",
      "anyTeamMember": false,
      "durationMinutes": 100,
      "serviceVariationId": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1758921239397"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Emma Tuttle
üéâ First booking detected for customer: BRGH9TZKVSXSZ9ZQ8ZXVB4MREW
   Name: Emma Tuttle
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer BRGH9TZKVSXSZ9ZQ8ZXVB4MREW...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-11-13T13:46:05.019Z",
      "createdAt": "2025-11-13T13:46:05.019Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: BRGH9TZKVSXSZ9ZQ8ZXVB4MREW
{"ts":"2025-12-05T00:05:44.281Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"17d74885-e685-44d1-9977-f35354dd3bf2","stage":"booking","correlationId":"booking-created:f47c4e78813ddead705e300e"}
{"ts":"2025-12-05T00:05:44.440Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"6cdda6da-8ee5-4f06-b30f-211e0b647783","stage":"booking","correlationId":"booking-created:2a60376aac935870813a5f4d","attempts":1}
üìÖ Processing booking created for customer: 28KVX7W71Q3N0YKFJ4MHA45SYC
Full booking data: {
  "id": "c28257zs9bds33",
  "allDay": false,
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "startAt": "2025-12-04T17:00:00Z",
  "version": 3,
  "createdAt": "2025-12-03T23:39:56Z",
  "updatedAt": "2025-12-04T18:48:01Z",
  "customerId": "28KVX7W71Q3N0YKFJ4MHA45SYC",
  "locationId": "LNQKVBTQZN3EZ",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "creatorType": "TEAM_MEMBER",
    "teamMemberId": "TMWAtQTYmZpwwxii"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TM-zXe9fXe4axYWn",
      "anyTeamMember": false,
      "durationMinutes": 140,
      "serviceVariationId": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1764783981722"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Desiree Santos
üéâ First booking detected for customer: 28KVX7W71Q3N0YKFJ4MHA45SYC
   Name: Desiree Santos
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 28KVX7W71Q3N0YKFJ4MHA45SYC...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "a7b40271-729a-41aa-801b-fb1fffb83650"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-09-05T19:12:55.485Z",
      "createdAt": "2025-09-05T19:12:55.485Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="a7b40271-729a-41aa-801b-fb1fffb83650"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "a7b40271-729a-41aa-801b-fb1fffb83650"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 28KVX7W71Q3N0YKFJ4MHA45SYC
{"ts":"2025-12-05T00:05:44.809Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"6cdda6da-8ee5-4f06-b30f-211e0b647783","stage":"booking","correlationId":"booking-created:2a60376aac935870813a5f4d"}
{"ts":"2025-12-05T00:05:44.989Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"ec366ce8-e116-4b40-bf36-36fc06d7df47","stage":"booking","correlationId":"booking-created:2e882dbacff5bceaa4fb7337","attempts":1}
üìÖ Processing booking created for customer: Y7B4GKDBYW9PP9E91TCBEPW7Y0
Full booking data: {
  "id": "cizbxfnk3cybzj",
  "allDay": false,
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "startAt": "2025-12-04T17:00:00Z",
  "version": 2,
  "createdAt": "2025-11-13T19:32:30Z",
  "updatedAt": "2025-12-04T19:44:47Z",
  "customerId": "Y7B4GKDBYW9PP9E91TCBEPW7Y0",
  "locationId": "LT4ZHFBQQYB2N",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "creatorType": "TEAM_MEMBER",
    "teamMemberId": "TMQPbDVvvOCLwqsy"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMyUMvTJIj2HrHSg",
      "anyTeamMember": false,
      "durationMinutes": 90,
      "serviceVariationId": "JMTK5M2CY2W7WEXSTAJKAJ35",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1762893947284"
    },
    {
      "resourceIds": [
        "KAOXILA4CV7A23VRAACC4R66"
      ],
      "teamMemberId": "TMyUMvTJIj2HrHSg",
      "anyTeamMember": false,
      "durationMinutes": 90,
      "serviceVariationId": "ZEAKNB35I37RMXNUBGWDZQIM",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1760895536505"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Taylor Herr
‚ÑπÔ∏è Customer Y7B4GKDBYW9PP9E91TCBEPW7Y0 already received signup bonus, not first booking
{"ts":"2025-12-05T00:05:45.122Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"ec366ce8-e116-4b40-bf36-36fc06d7df47","stage":"booking","correlationId":"booking-created:2e882dbacff5bceaa4fb7337"}
{"ts":"2025-12-05T00:05:45.284Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"6f557991-3b90-4c7e-bba4-48d394775cf8","stage":"booking","correlationId":"booking-created:0318d33640291e3c76b500cd","attempts":1}
üìÖ Processing booking created for customer: 494KD02DD99MYHNCT5BYK0ZNZ8
Full booking data: {
  "id": "odx8qkhlnw3h0i",
  "allDay": false,
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94123-3940",
    "addressLine1": "2266 Union St",
    "addressLine2": "",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-04T17:00:00Z",
  "version": 7,
  "createdAt": "2025-11-06T21:16:05Z",
  "updatedAt": "2025-12-04T19:23:27Z",
  "customerId": "494KD02DD99MYHNCT5BYK0ZNZ8",
  "locationId": "LT4ZHFBQQYB2N",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "494KD02DD99MYHNCT5BYK0ZNZ8",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TM1L5yPC-yKx6CyO",
      "anyTeamMember": false,
      "durationMinutes": 120,
      "serviceVariationId": "NCOIL6ZGDTCC7SO3IJHENCQ2",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1761597690235"
    },
    {
      "teamMemberId": "TM1L5yPC-yKx6CyO",
      "anyTeamMember": false,
      "durationMinutes": 20,
      "serviceVariationId": "HAJX45W3U2WUCCXM5MI24UEE",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1762374620368"
    },
    {
      "teamMemberId": "TM1L5yPC-yKx6CyO",
      "anyTeamMember": false,
      "durationMinutes": 15,
      "serviceVariationId": "KBHPHVKLJNAF223GMYIRUUH3",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1760895536505"
    },
    {
      "teamMemberId": "TM1L5yPC-yKx6CyO",
      "anyTeamMember": false,
      "durationMinutes": 20,
      "serviceVariationId": "HAJX45W3U2WUCCXM5MI24UEE",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1763586786564"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Kelsey Kaplan
üéâ First booking detected for customer: 494KD02DD99MYHNCT5BYK0ZNZ8
   Name: Kelsey Kaplan
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 494KD02DD99MYHNCT5BYK0ZNZ8...
   Full custom attributes response: {}
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 494KD02DD99MYHNCT5BYK0ZNZ8
{"ts":"2025-12-05T00:05:45.652Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"6f557991-3b90-4c7e-bba4-48d394775cf8","stage":"booking","correlationId":"booking-created:0318d33640291e3c76b500cd"}
{"ts":"2025-12-05T00:05:45.813Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"e93b3ead-ed7f-4d63-b405-865766ec297b","stage":"booking","correlationId":"booking-created:d887c52d7eaa8e363b41c8c4","attempts":1}
üìÖ Processing booking created for customer: XPKBCE5813V0WC51C7AR66DRJ4
Full booking data: {
  "id": "st8lxb9scgu8pl",
  "allDay": false,
  "source": "FIRST_PARTY_MERCHANT",
  "status": "CANCELLED_BY_SELLER",
  "startAt": "2025-12-04T17:00:00Z",
  "version": 1,
  "createdAt": "2025-11-06T21:24:24Z",
  "updatedAt": "2025-11-20T22:39:57Z",
  "customerId": "XPKBCE5813V0WC51C7AR66DRJ4",
  "locationId": "LT4ZHFBQQYB2N",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "creatorType": "TEAM_MEMBER",
    "teamMemberId": "TMQPbDVvvOCLwqsy"
  },
  "appointmentSegments": [
    {
      "resourceIds": [
        "KAOXILA4CV7A23VRAACC4R66"
      ],
      "teamMemberId": "TMew76L_w3bra6AH",
      "anyTeamMember": false,
      "durationMinutes": 90,
      "serviceVariationId": "ZEAKNB35I37RMXNUBGWDZQIM",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1760895536505"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Aileen Bailitz
üéâ First booking detected for customer: XPKBCE5813V0WC51C7AR66DRJ4
   Name: Aileen Bailitz
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer XPKBCE5813V0WC51C7AR66DRJ4...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
      ],
      "version": 2,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-09-26T16:30:09.231Z",
      "createdAt": "2025-09-10T00:36:47.034Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: XPKBCE5813V0WC51C7AR66DRJ4
{"ts":"2025-12-05T00:05:46.180Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"e93b3ead-ed7f-4d63-b405-865766ec297b","stage":"booking","correlationId":"booking-created:d887c52d7eaa8e363b41c8c4"}
{"ts":"2025-12-05T00:05:46.357Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"398b88a2-31e5-4d7d-9da9-c1dfb5c2ac7a","stage":"booking","correlationId":"booking-created:831bbb675c0d1a7214ff6e1c","attempts":1}
üìÖ Processing booking created for customer: D723A57SXXCJV27DN1BY3WDFQR
Full booking data: {
  "id": "gls70jlvkhudgo",
  "allDay": false,
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "startAt": "2025-12-04T18:00:00Z",
  "version": 2,
  "createdAt": "2025-11-06T00:59:03Z",
  "updatedAt": "2025-12-04T21:26:26Z",
  "customerId": "D723A57SXXCJV27DN1BY3WDFQR",
  "locationId": "LNQKVBTQZN3EZ",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "creatorType": "TEAM_MEMBER",
    "teamMemberId": "TMWAtQTYmZpwwxii"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMgsjtuk5cfKnstq",
      "anyTeamMember": false,
      "durationMinutes": 175,
      "serviceVariationId": "6TYOE67IDYTKHW2ZG6HKVZER",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1757963765505"
    },
    {
      "resourceIds": [
        "5OVIQ6GSSUXORACP6T7WBAQ7"
      ],
      "teamMemberId": "TMgsjtuk5cfKnstq",
      "anyTeamMember": false,
      "durationMinutes": 90,
      "serviceVariationId": "63PG6RLS2NHWRD5JRXEC74HN",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1760895536505"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Marina Jacobs
üéâ First booking detected for customer: D723A57SXXCJV27DN1BY3WDFQR
   Name: Marina Jacobs
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer D723A57SXXCJV27DN1BY3WDFQR...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "sq0idp-0WpGrONcXfCcfav3Lkd9Jg:appointments-online-booking-blocking",
      "value": true,
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-06-30T21:50:39.425Z",
      "createdAt": "2025-06-30T21:50:39.425Z"
    },
    {
      "key": "square:a3dde506-f69e-48e4-a98a-004c1822d3ad",
      "value": "227469",
      "version": 2,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-10-30T21:03:28.390Z",
      "createdAt": "2025-10-30T21:02:43.780Z"
    },
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "0826aee4-d259-434d-be44-511ac61b3629"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-08-14T00:48:07.925Z",
      "createdAt": "2025-08-14T00:48:07.925Z"
    }
  ]
}
   üìã Custom attribute: key="sq0idp-0WpGrONcXfCcfav3Lkd9Jg:appointments-online-booking-blocking", value="true"
   üìã Custom attribute: key="square:a3dde506-f69e-48e4-a98a-004c1822d3ad", value="227469"
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="0826aee4-d259-434d-be44-511ac61b3629"
   Custom attributes from Square: {
  "sq0idp-0WpGrONcXfCcfav3Lkd9Jg:appointments-online-booking-blocking": true,
  "square:a3dde506-f69e-48e4-a98a-004c1822d3ad": "227469",
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "0826aee4-d259-434d-be44-511ac61b3629"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   üîç Checking custom attribute value: "227469" (key: square:a3dde506-f69e-48e4-a98a-004c1822d3ad)
   üîç Looking up referral code in database: "227469" (original: "227469")
   ‚ùå No referrer found with code "227469" or "227469"
   üîç Database lookup result for "227469": NOT FOUND
   ‚ö†Ô∏è Value "227469" is not a valid referral code in database
   ‚ö†Ô∏è This means either: 1) Code doesn't exist, or 2) Referrer hasn't completed first payment yet
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: D723A57SXXCJV27DN1BY3WDFQR
{"ts":"2025-12-05T00:05:46.804Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"398b88a2-31e5-4d7d-9da9-c1dfb5c2ac7a","stage":"booking","correlationId":"booking-created:831bbb675c0d1a7214ff6e1c"}
{"ts":"2025-12-05T00:05:46.963Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"cade6ede-7aec-401a-9f89-91bcdb71fc41","stage":"booking","correlationId":"booking-created:3c275adde90f63ace034f0ab","attempts":1}
üìÖ Processing booking created for customer: QZ117BT4YFEZ2V8HHK456YY5TR
Full booking data: {
  "id": "k63g93z5qk9oge",
  "allDay": false,
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "startAt": "2025-12-04T18:00:00Z",
  "version": 3,
  "createdAt": "2025-11-03T22:07:37Z",
  "updatedAt": "2025-12-04T19:57:07Z",
  "customerId": "QZ117BT4YFEZ2V8HHK456YY5TR",
  "locationId": "LNQKVBTQZN3EZ",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "creatorType": "TEAM_MEMBER",
    "teamMemberId": "TMWAtQTYmZpwwxii"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMILsQUVwLkLzbVo",
      "anyTeamMember": false,
      "durationMinutes": 90,
      "serviceVariationId": "BM556FTNFOTEHYVG4GPXAXFM",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1760895536505"
    },
    {
      "teamMemberId": "TMILsQUVwLkLzbVo",
      "anyTeamMember": false,
      "durationMinutes": 20,
      "serviceVariationId": "HAJX45W3U2WUCCXM5MI24UEE",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1760895536505"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Heather Buman
üéâ First booking detected for customer: QZ117BT4YFEZ2V8HHK456YY5TR
   Name: Heather Buman
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer QZ117BT4YFEZ2V8HHK456YY5TR...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-08-18T22:42:16.842Z",
      "createdAt": "2025-08-18T22:42:16.842Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: QZ117BT4YFEZ2V8HHK456YY5TR
{"ts":"2025-12-05T00:05:47.345Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"cade6ede-7aec-401a-9f89-91bcdb71fc41","stage":"booking","correlationId":"booking-created:3c275adde90f63ace034f0ab"}
{"ts":"2025-12-05T00:05:47.507Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"ded251c4-e327-44da-a0f5-17308f468cfc","stage":"booking","correlationId":"booking-created:ed46914f27cebc39281d4e61","attempts":1}
üìÖ Processing booking created for customer: KC2Q9C3SD6Q7RVFRDG70ZZYE4G
Full booking data: {
  "id": "g4qz08s01vpfwx",
  "allDay": false,
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94123-3940",
    "addressLine1": "2266 Union St",
    "addressLine2": "",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-04T18:40:00Z",
  "version": 5,
  "createdAt": "2025-11-18T19:05:11Z",
  "updatedAt": "2025-12-04T20:19:55Z",
  "customerId": "KC2Q9C3SD6Q7RVFRDG70ZZYE4G",
  "locationId": "LT4ZHFBQQYB2N",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "KC2Q9C3SD6Q7RVFRDG70ZZYE4G",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMMHlgFBIFbMTRap",
      "anyTeamMember": false,
      "durationMinutes": 90,
      "serviceVariationId": "EN2GXPXFPBKRAK7MK3ZB6YRW",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1762374620368"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Lea Inbody
üéâ First booking detected for customer: KC2Q9C3SD6Q7RVFRDG70ZZYE4G
   Name: Lea Inbody
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer KC2Q9C3SD6Q7RVFRDG70ZZYE4G...
   Full custom attributes response: {}
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: KC2Q9C3SD6Q7RVFRDG70ZZYE4G
{"ts":"2025-12-05T00:05:47.908Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"ded251c4-e327-44da-a0f5-17308f468cfc","stage":"booking","correlationId":"booking-created:ed46914f27cebc39281d4e61"}
{"ts":"2025-12-05T00:05:48.081Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"4ac08aa5-dc0b-4394-9ed8-baad88a7523b","stage":"booking","correlationId":"booking-created:8d178e20f5911314a8f67189","attempts":1}
üìÖ Processing booking created for customer: YXZV1Y70R4WWW0K67B6JXBR37W
Full booking data: {
  "id": "0bimfog75zhmkp",
  "allDay": false,
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "startAt": "2025-12-04T19:30:00Z",
  "version": 4,
  "createdAt": "2025-11-04T17:17:22Z",
  "updatedAt": "2025-12-04T21:29:37Z",
  "customerId": "YXZV1Y70R4WWW0K67B6JXBR37W",
  "locationId": "LT4ZHFBQQYB2N",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "creatorType": "TEAM_MEMBER",
    "teamMemberId": "TMQPbDVvvOCLwqsy"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TM1L5yPC-yKx6CyO",
      "anyTeamMember": false,
      "durationMinutes": 120,
      "serviceVariationId": "NCOIL6ZGDTCC7SO3IJHENCQ2",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1761597690235"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Deana Chan
‚ÑπÔ∏è Customer YXZV1Y70R4WWW0K67B6JXBR37W already received signup bonus, not first booking
{"ts":"2025-12-05T00:05:48.228Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"4ac08aa5-dc0b-4394-9ed8-baad88a7523b","stage":"booking","correlationId":"booking-created:8d178e20f5911314a8f67189"}
{"ts":"2025-12-05T00:05:48.395Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"9f647988-418b-4bbc-853b-2188c23a117d","stage":"booking","correlationId":"booking-created:9b58a9c030d9237ab38f52f7","attempts":1}
üìÖ Processing booking created for customer: XTA6WFN33E8PDJ6W462ZJA21WG
Full booking data: {
  "id": "m348kfhhqg0jlz",
  "allDay": false,
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "startAt": "2025-12-04T19:50:00Z",
  "version": 2,
  "createdAt": "2025-11-06T20:16:50Z",
  "updatedAt": "2025-12-04T23:00:22Z",
  "customerId": "XTA6WFN33E8PDJ6W462ZJA21WG",
  "locationId": "LNQKVBTQZN3EZ",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "creatorType": "TEAM_MEMBER",
    "teamMemberId": "TMWAtQTYmZpwwxii"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMILsQUVwLkLzbVo",
      "anyTeamMember": false,
      "durationMinutes": 35,
      "serviceVariationId": "XVYD33PWUOIDOBJYERR7FNXT",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1756836949305"
    },
    {
      "teamMemberId": "TMILsQUVwLkLzbVo",
      "anyTeamMember": false,
      "durationMinutes": 90,
      "serviceVariationId": "BM556FTNFOTEHYVG4GPXAXFM",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1761597690235"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Bailey Pippen
üéâ First booking detected for customer: XTA6WFN33E8PDJ6W462ZJA21WG
   Name: Bailey Pippen
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer XTA6WFN33E8PDJ6W462ZJA21WG...
   Full custom attributes response: {}
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: XTA6WFN33E8PDJ6W462ZJA21WG
{"ts":"2025-12-05T00:05:49.087Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"9f647988-418b-4bbc-853b-2188c23a117d","stage":"booking","correlationId":"booking-created:9b58a9c030d9237ab38f52f7"}
{"ts":"2025-12-05T00:05:49.398Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"3f38d28c-2489-4d92-bea8-cef98ae09e28","stage":"booking","correlationId":"booking-created:58d93ef564973023bd4a16c3","attempts":1}
üìÖ Processing booking created for customer: NRMZQZFG5FQF4T6QAPDD1GD0T0
Full booking data: {
  "id": "1c2kfjr5bog5cz",
  "allDay": false,
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94133-4608",
    "addressLine1": "550 Pacific Ave",
    "addressLine2": "",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-04T20:00:00Z",
  "version": 4,
  "createdAt": "2025-11-28T23:06:14Z",
  "updatedAt": "2025-12-04T21:29:06Z",
  "customerId": "NRMZQZFG5FQF4T6QAPDD1GD0T0",
  "locationId": "LNQKVBTQZN3EZ",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "NRMZQZFG5FQF4T6QAPDD1GD0T0",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMEWAZHdtaiRR_Zs",
      "anyTeamMember": false,
      "durationMinutes": 120,
      "serviceVariationId": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1763586786564"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: SEDEF CEYLAN
üéâ First booking detected for customer: NRMZQZFG5FQF4T6QAPDD1GD0T0
   Name: SEDEF CEYLAN
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer NRMZQZFG5FQF4T6QAPDD1GD0T0...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "af5791f8-348a-422e-98d1-5e865121bb19"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-10-14T18:54:39.293Z",
      "createdAt": "2025-10-14T18:54:39.293Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="af5791f8-348a-422e-98d1-5e865121bb19"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "af5791f8-348a-422e-98d1-5e865121bb19"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: NRMZQZFG5FQF4T6QAPDD1GD0T0
{"ts":"2025-12-05T00:05:50.108Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"3f38d28c-2489-4d92-bea8-cef98ae09e28","stage":"booking","correlationId":"booking-created:58d93ef564973023bd4a16c3"}
{"ts":"2025-12-05T00:05:50.448Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"3a0ec691-04e7-4620-b7dd-7dc4b8dc3fab","stage":"booking","correlationId":"booking-created:82c0b5ff9787bc193959383d","attempts":1}
üìÖ Processing booking created for customer: 1Q3ST6S62D41V6TGPXV6J2FAN8
Full booking data: {
  "id": "6g78pjps1hkh2e",
  "allDay": false,
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "startAt": "2025-12-04T20:00:00Z",
  "version": 0,
  "createdAt": "2025-12-04T00:25:55Z",
  "updatedAt": "2025-12-04T00:25:56Z",
  "customerId": "1Q3ST6S62D41V6TGPXV6J2FAN8",
  "locationId": "LT4ZHFBQQYB2N",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "creatorType": "TEAM_MEMBER",
    "teamMemberId": "TMQPbDVvvOCLwqsy"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TM9jDlRr_Hl4rdBB",
      "anyTeamMember": false,
      "durationMinutes": 15,
      "serviceVariationId": "KBHPHVKLJNAF223GMYIRUUH3",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1760895536505"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Carla Betteo
üéâ First booking detected for customer: 1Q3ST6S62D41V6TGPXV6J2FAN8
   Name: Carla Betteo
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 1Q3ST6S62D41V6TGPXV6J2FAN8...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "af5791f8-348a-422e-98d1-5e865121bb19"
      ],
      "version": 2,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-09-22T03:57:35.919Z",
      "createdAt": "2025-09-22T03:57:35.268Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="af5791f8-348a-422e-98d1-5e865121bb19"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "af5791f8-348a-422e-98d1-5e865121bb19"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 1Q3ST6S62D41V6TGPXV6J2FAN8
{"ts":"2025-12-05T00:05:51.215Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"3a0ec691-04e7-4620-b7dd-7dc4b8dc3fab","stage":"booking","correlationId":"booking-created:82c0b5ff9787bc193959383d"}
{"ts":"2025-12-05T00:05:51.564Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"c9ca5f68-72e4-4028-896c-ab2b8deaaeb3","stage":"booking","correlationId":"booking-created:e0fe066a552715fcf1754aa8","attempts":1}
üìÖ Processing booking created for customer: D3DY5V4MY6KJK47R1N60YZSE58
Full booking data: {
  "id": "c3doou2vy7c1kw",
  "allDay": false,
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94123-3940",
    "addressLine1": "2266 Union St",
    "addressLine2": "",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-04T20:00:00Z",
  "version": 2,
  "createdAt": "2025-11-20T09:12:14Z",
  "updatedAt": "2025-12-04T21:17:12Z",
  "customerId": "D3DY5V4MY6KJK47R1N60YZSE58",
  "locationId": "LT4ZHFBQQYB2N",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "D3DY5V4MY6KJK47R1N60YZSE58",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "resourceIds": [
        "KAOXILA4CV7A23VRAACC4R66"
      ],
      "teamMemberId": "TMyUMvTJIj2HrHSg",
      "anyTeamMember": false,
      "durationMinutes": 90,
      "serviceVariationId": "ZEAKNB35I37RMXNUBGWDZQIM",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1760895536505"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Sydney Howell
‚ÑπÔ∏è Customer D3DY5V4MY6KJK47R1N60YZSE58 already received signup bonus, not first booking
{"ts":"2025-12-05T00:05:51.920Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"c9ca5f68-72e4-4028-896c-ab2b8deaaeb3","stage":"booking","correlationId":"booking-created:e0fe066a552715fcf1754aa8"}
{"ts":"2025-12-05T00:05:52.111Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"03489b4f-642d-463b-a12f-b515c7724615","stage":"booking","correlationId":"booking-created:b31ecca7d06d74455de35c78","attempts":1}
üìÖ Processing booking created for customer: 9AE6KEDQPWVW8SW9RQ4BBNTHK8
Full booking data: {
  "id": "wxyhbu68ik1phx",
  "allDay": false,
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94133-4608",
    "addressLine1": "550 Pacific Ave",
    "addressLine2": "",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-04T20:00:00Z",
  "version": 0,
  "createdAt": "2025-11-17T18:29:35Z",
  "updatedAt": "2025-12-03T19:51:25Z",
  "customerId": "9AE6KEDQPWVW8SW9RQ4BBNTHK8",
  "locationId": "LNQKVBTQZN3EZ",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "creatorType": "TEAM_MEMBER",
    "teamMemberId": "TMWAtQTYmZpwwxii"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMVwAQUdLz6no-cB",
      "anyTeamMember": false,
      "durationMinutes": 90,
      "serviceVariationId": "EN2GXPXFPBKRAK7MK3ZB6YRW",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1762374620368"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Kinga Golabek
üéâ First booking detected for customer: 9AE6KEDQPWVW8SW9RQ4BBNTHK8
   Name: Kinga Golabek
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 9AE6KEDQPWVW8SW9RQ4BBNTHK8...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "0826aee4-d259-434d-be44-511ac61b3629"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-10-13T01:44:18.164Z",
      "createdAt": "2025-10-13T01:44:18.164Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="0826aee4-d259-434d-be44-511ac61b3629"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "0826aee4-d259-434d-be44-511ac61b3629"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 9AE6KEDQPWVW8SW9RQ4BBNTHK8
{"ts":"2025-12-05T00:05:52.478Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"03489b4f-642d-463b-a12f-b515c7724615","stage":"booking","correlationId":"booking-created:b31ecca7d06d74455de35c78"}
{"ts":"2025-12-05T00:05:52.644Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"d39a8131-c262-4071-b858-0e57b5b0ffe9","stage":"booking","correlationId":"booking-created:942c92082a153add4e36ff5e","attempts":1}
üìÖ Processing booking created for customer: 4CQQSXSF1N0XCVC1GGK8XDZZW4
Full booking data: {
  "id": "8gs2gw2eovxy1z",
  "allDay": false,
  "source": "FIRST_PARTY_BUYER",
  "status": "CANCELLED_BY_SELLER",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94123-3940",
    "addressLine1": "2266 Union St",
    "addressLine2": "",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-04T20:40:00Z",
  "version": 2,
  "createdAt": "2025-11-16T14:34:56Z",
  "updatedAt": "2025-11-24T01:04:18Z",
  "customerId": "4CQQSXSF1N0XCVC1GGK8XDZZW4",
  "locationId": "LT4ZHFBQQYB2N",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "4CQQSXSF1N0XCVC1GGK8XDZZW4",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMMHlgFBIFbMTRap",
      "anyTeamMember": false,
      "durationMinutes": 100,
      "serviceVariationId": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1758921239397"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Isabel Markl
üéâ First booking detected for customer: 4CQQSXSF1N0XCVC1GGK8XDZZW4
   Name: Isabel Markl
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 4CQQSXSF1N0XCVC1GGK8XDZZW4...
   Full custom attributes response: {}
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 4CQQSXSF1N0XCVC1GGK8XDZZW4
{"ts":"2025-12-05T00:05:53.278Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"d39a8131-c262-4071-b858-0e57b5b0ffe9","stage":"booking","correlationId":"booking-created:942c92082a153add4e36ff5e"}
{"ts":"2025-12-05T00:05:53.518Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"a290851b-7f61-4314-968f-949c65f4d959","stage":"booking","correlationId":"booking-created:73b3592da2047860b964e37a","attempts":1}
üìÖ Processing booking created for customer: B0GJFR8WR9H20EN067QT7RVMHM
Full booking data: {
  "id": "e5hvh2ev1kg6au",
  "allDay": false,
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94123-3940",
    "addressLine1": "2266 Union St",
    "addressLine2": "",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-04T20:40:00Z",
  "version": 2,
  "createdAt": "2025-12-01T22:11:22Z",
  "updatedAt": "2025-12-04T22:32:07Z",
  "customerId": "B0GJFR8WR9H20EN067QT7RVMHM",
  "locationId": "LT4ZHFBQQYB2N",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "B0GJFR8WR9H20EN067QT7RVMHM",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TM9jDlRr_Hl4rdBB",
      "anyTeamMember": false,
      "durationMinutes": 90,
      "serviceVariationId": "XBUDIMNKOPC2XVG5YLIQ4RYS",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1764609577793"
    },
    {
      "teamMemberId": "TM9jDlRr_Hl4rdBB",
      "anyTeamMember": false,
      "durationMinutes": 20,
      "serviceVariationId": "HAJX45W3U2WUCCXM5MI24UEE",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1763586786564"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Anne Murdoch
üéâ First booking detected for customer: B0GJFR8WR9H20EN067QT7RVMHM
   Name: Anne Murdoch
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer B0GJFR8WR9H20EN067QT7RVMHM...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "af5791f8-348a-422e-98d1-5e865121bb19"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-02-27T11:09:48.684Z",
      "createdAt": "2025-02-27T11:09:48.684Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="af5791f8-348a-422e-98d1-5e865121bb19"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "af5791f8-348a-422e-98d1-5e865121bb19"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: B0GJFR8WR9H20EN067QT7RVMHM
{"ts":"2025-12-05T00:05:54.103Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"a290851b-7f61-4314-968f-949c65f4d959","stage":"booking","correlationId":"booking-created:73b3592da2047860b964e37a"}
{"ts":"2025-12-05T00:05:54.382Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"c6611a05-6cd3-4b08-9415-bea48c83fd5f","stage":"booking","correlationId":"booking-created:34160946711b9c5f3b886d73","attempts":1}
üìÖ Processing booking created for customer: DHZ1B7SHTA4V6DPX92VZMA5JXC
Full booking data: {
  "id": "mmx9jhxqb621qe",
  "allDay": false,
  "source": "THIRD_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94123-3940",
    "addressLine1": "2266 Union St",
    "addressLine2": "",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-04T20:40:00Z",
  "version": 4,
  "createdAt": "2025-11-25T04:19:58Z",
  "updatedAt": "2025-12-04T22:04:31Z",
  "customerId": "DHZ1B7SHTA4V6DPX92VZMA5JXC",
  "locationId": "LT4ZHFBQQYB2N",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "DHZ1B7SHTA4V6DPX92VZMA5JXC",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMMHlgFBIFbMTRap",
      "anyTeamMember": false,
      "durationMinutes": 100,
      "serviceVariationId": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1763586786564"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Mary Raleigh
üéâ First booking detected for customer: DHZ1B7SHTA4V6DPX92VZMA5JXC
   Name: Mary Raleigh
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer DHZ1B7SHTA4V6DPX92VZMA5JXC...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-03-20T17:03:12.135Z",
      "createdAt": "2025-03-20T17:03:12.135Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: DHZ1B7SHTA4V6DPX92VZMA5JXC
{"ts":"2025-12-05T00:05:55.208Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"c6611a05-6cd3-4b08-9415-bea48c83fd5f","stage":"booking","correlationId":"booking-created:34160946711b9c5f3b886d73"}
{"ts":"2025-12-05T00:05:55.554Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"a70c19d8-e32e-4068-8fbf-50905aef632b","stage":"booking","correlationId":"booking-created:4d22c24270da0ad844128bfa","attempts":1}
üìÖ Processing booking created for customer: NEK855Y9FDF81V4VCHQCTZK8N8
Full booking data: {
  "id": "2sjm7ucymnv0rg",
  "allDay": false,
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94133-4608",
    "addressLine1": "550 Pacific Ave",
    "addressLine2": "",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-04T21:30:00Z",
  "version": 3,
  "createdAt": "2025-11-20T18:26:22Z",
  "updatedAt": "2025-12-04T22:52:27Z",
  "customerId": "NEK855Y9FDF81V4VCHQCTZK8N8",
  "locationId": "LNQKVBTQZN3EZ",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "NEK855Y9FDF81V4VCHQCTZK8N8",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMVwAQUdLz6no-cB",
      "anyTeamMember": false,
      "durationMinutes": 90,
      "serviceVariationId": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1763586786564"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Kylee Self
üéâ First booking detected for customer: NEK855Y9FDF81V4VCHQCTZK8N8
   Name: Kylee Self
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer NEK855Y9FDF81V4VCHQCTZK8N8...
   Full custom attributes response: {}
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: NEK855Y9FDF81V4VCHQCTZK8N8
{"ts":"2025-12-05T00:05:56.197Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"a70c19d8-e32e-4068-8fbf-50905aef632b","stage":"booking","correlationId":"booking-created:4d22c24270da0ad844128bfa"}
{"ts":"2025-12-05T00:05:56.754Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"2f81f9d3-ee53-42b6-b434-588c167aa2f5","stage":"booking","correlationId":"booking-created:619b46f0430e05302e274876","attempts":1}
üìÖ Processing booking created for customer: 0QM3FB1M39C6YTTNCYFDEC3A8M
Full booking data: {
  "id": "2vtc51f6cy71te",
  "allDay": false,
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94123-3940",
    "addressLine1": "2266 Union St",
    "addressLine2": "",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-04T21:30:00Z",
  "version": 2,
  "createdAt": "2025-12-04T17:57:13Z",
  "updatedAt": "2025-12-04T23:08:16Z",
  "customerId": "0QM3FB1M39C6YTTNCYFDEC3A8M",
  "locationId": "LT4ZHFBQQYB2N",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "0QM3FB1M39C6YTTNCYFDEC3A8M",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMyUMvTJIj2HrHSg",
      "anyTeamMember": false,
      "durationMinutes": 90,
      "serviceVariationId": "JMTK5M2CY2W7WEXSTAJKAJ35",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1764801478862"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Kirsten Hong
‚ÑπÔ∏è Customer 0QM3FB1M39C6YTTNCYFDEC3A8M already received signup bonus, not first booking
{"ts":"2025-12-05T00:05:57.133Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"2f81f9d3-ee53-42b6-b434-588c167aa2f5","stage":"booking","correlationId":"booking-created:619b46f0430e05302e274876"}
{"ts":"2025-12-05T00:05:57.751Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"a4a42ec7-6b27-4c5e-934e-187be6ff08e4","stage":"booking","correlationId":"booking-created:55bacbce209d10bfda664a10","attempts":1}
üìÖ Processing booking created for customer: PDHZ3Q9EYX53K1RM10GKZRNY64
Full booking data: {
  "id": "rv9yhe5jgnvr6t",
  "allDay": false,
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "startAt": "2025-12-04T21:30:00Z",
  "version": 4,
  "createdAt": "2025-11-06T21:22:47Z",
  "updatedAt": "2025-12-04T23:33:37Z",
  "customerId": "PDHZ3Q9EYX53K1RM10GKZRNY64",
  "locationId": "LT4ZHFBQQYB2N",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "creatorType": "TEAM_MEMBER",
    "teamMemberId": "TMQPbDVvvOCLwqsy"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TM1L5yPC-yKx6CyO",
      "anyTeamMember": false,
      "durationMinutes": 120,
      "serviceVariationId": "NCOIL6ZGDTCC7SO3IJHENCQ2",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1761597690235"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: sue ko
üéâ First booking detected for customer: PDHZ3Q9EYX53K1RM10GKZRNY64
   Name: sue ko
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer PDHZ3Q9EYX53K1RM10GKZRNY64...
   Full custom attributes response: {}
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: PDHZ3Q9EYX53K1RM10GKZRNY64
{"ts":"2025-12-05T00:05:58.428Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"a4a42ec7-6b27-4c5e-934e-187be6ff08e4","stage":"booking","correlationId":"booking-created:55bacbce209d10bfda664a10"}
{"ts":"2025-12-05T00:05:58.590Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"82b897c9-ef29-48bb-9203-0e0343ce52c1","stage":"booking","correlationId":"booking-created:85a3fbdcb7b56367ecb60c71","attempts":1}
üìÖ Processing booking created for customer: Y48RCA72T404Q3MKNR208VB0G4
Full booking data: {
  "id": "hsmekkp0ii7qyw",
  "allDay": false,
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94133-4608",
    "addressLine1": "550 Pacific Ave",
    "addressLine2": "",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-04T21:55:00Z",
  "version": 0,
  "createdAt": "2025-11-06T22:16:02Z",
  "updatedAt": "2025-12-04T05:22:05Z",
  "customerId": "Y48RCA72T404Q3MKNR208VB0G4",
  "locationId": "LNQKVBTQZN3EZ",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "creatorType": "TEAM_MEMBER",
    "teamMemberId": "TMWAtQTYmZpwwxii"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMILsQUVwLkLzbVo",
      "anyTeamMember": false,
      "durationMinutes": 90,
      "serviceVariationId": "BM556FTNFOTEHYVG4GPXAXFM",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1761597690235"
    },
    {
      "teamMemberId": "TMILsQUVwLkLzbVo",
      "anyTeamMember": false,
      "durationMinutes": 30,
      "serviceVariationId": "LFLFEZO7L46URIM2OVZOJADI",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1762374620368"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Christine Ciszczon
üéâ First booking detected for customer: Y48RCA72T404Q3MKNR208VB0G4
   Name: Christine Ciszczon
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer Y48RCA72T404Q3MKNR208VB0G4...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "fd306114-9968-4fe0-9bde-53f9bf837f39"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-11-01T17:16:47.046Z",
      "createdAt": "2025-11-01T17:16:47.046Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="fd306114-9968-4fe0-9bde-53f9bf837f39"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "fd306114-9968-4fe0-9bde-53f9bf837f39"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: Y48RCA72T404Q3MKNR208VB0G4
{"ts":"2025-12-05T00:05:58.953Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"82b897c9-ef29-48bb-9203-0e0343ce52c1","stage":"booking","correlationId":"booking-created:85a3fbdcb7b56367ecb60c71"}
{"ts":"2025-12-05T00:05:59.115Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"1c7fe88d-babc-4b4e-b4c7-564ff43a7c2b","stage":"booking","correlationId":"booking-created:0543257eaf760d6fd6429738","attempts":1}
üìÖ Processing booking created for customer: Z8WQ0D379GAGBS621BEF9SYQN8
Full booking data: {
  "id": "j529pxxk34i8hz",
  "allDay": false,
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94133-4608",
    "addressLine1": "550 Pacific Ave",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-04T22:25:00Z",
  "version": 0,
  "createdAt": "2025-11-20T07:28:03Z",
  "updatedAt": "2025-12-03T22:05:24Z",
  "customerId": "Z8WQ0D379GAGBS621BEF9SYQN8",
  "locationId": "LNQKVBTQZN3EZ",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "Z8WQ0D379GAGBS621BEF9SYQN8",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMgsjtuk5cfKnstq",
      "anyTeamMember": false,
      "durationMinutes": 110,
      "serviceVariationId": "6TYOE67IDYTKHW2ZG6HKVZER",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1762893947284"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Nicole Chernev
üéâ First booking detected for customer: Z8WQ0D379GAGBS621BEF9SYQN8
   Name: Nicole Chernev
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer Z8WQ0D379GAGBS621BEF9SYQN8...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-03-11T02:17:10.192Z",
      "createdAt": "2025-03-11T02:17:10.192Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: Z8WQ0D379GAGBS621BEF9SYQN8
{"ts":"2025-12-05T00:05:59.525Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"1c7fe88d-babc-4b4e-b4c7-564ff43a7c2b","stage":"booking","correlationId":"booking-created:0543257eaf760d6fd6429738"}
{"ts":"2025-12-05T00:05:59.688Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"229e0852-87b0-4459-a006-0f46216f2760","stage":"booking","correlationId":"booking-created:bbdec31e99e25f815c176297","attempts":1}
üìÖ Processing booking created for customer: PHP1Q70HXKER5Y2EF1PJGYKRT0
Full booking data: {
  "id": "htzkqqroz3gfer",
  "allDay": false,
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "startAt": "2025-12-04T22:30:00Z",
  "version": 3,
  "createdAt": "2025-12-04T21:03:08Z",
  "updatedAt": "2025-12-04T23:44:21Z",
  "customerId": "PHP1Q70HXKER5Y2EF1PJGYKRT0",
  "locationId": "LT4ZHFBQQYB2N",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "creatorType": "TEAM_MEMBER",
    "teamMemberId": "TMQPbDVvvOCLwqsy"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMMHlgFBIFbMTRap",
      "anyTeamMember": false,
      "durationMinutes": 45,
      "serviceVariationId": "VVA7G2UN7N2HUFMCW5LQOVHB",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1764783981722"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Maren Vanderkolk
üéâ First booking detected for customer: PHP1Q70HXKER5Y2EF1PJGYKRT0
   Name: Maren Vanderkolk
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer PHP1Q70HXKER5Y2EF1PJGYKRT0...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "af5791f8-348a-422e-98d1-5e865121bb19"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-11-06T07:29:50.507Z",
      "createdAt": "2025-11-06T07:29:50.507Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="af5791f8-348a-422e-98d1-5e865121bb19"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "af5791f8-348a-422e-98d1-5e865121bb19"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: PHP1Q70HXKER5Y2EF1PJGYKRT0
{"ts":"2025-12-05T00:06:00.080Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"229e0852-87b0-4459-a006-0f46216f2760","stage":"booking","correlationId":"booking-created:bbdec31e99e25f815c176297"}
{"ts":"2025-12-05T00:06:00.241Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"15f30e1b-36b5-4d61-9c57-f74dadd3897f","stage":"booking","correlationId":"booking-created:36c45d9e65e04accc9da57a5","attempts":1}
üìÖ Processing booking created for customer: WS90HBE67QG5K5XCKFY9TK4B34
Full booking data: {
  "id": "nv7p71gzmgszup",
  "allDay": false,
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "startAt": "2025-12-04T22:30:00Z",
  "version": 2,
  "createdAt": "2025-12-04T21:38:36Z",
  "updatedAt": "2025-12-04T23:34:52Z",
  "customerId": "WS90HBE67QG5K5XCKFY9TK4B34",
  "locationId": "LT4ZHFBQQYB2N",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "creatorType": "TEAM_MEMBER",
    "teamMemberId": "TMQPbDVvvOCLwqsy"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TM9jDlRr_Hl4rdBB",
      "anyTeamMember": false,
      "durationMinutes": 90,
      "serviceVariationId": "XBUDIMNKOPC2XVG5YLIQ4RYS",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1764609577793"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: KC Maxwell
‚ÑπÔ∏è Customer WS90HBE67QG5K5XCKFY9TK4B34 already received signup bonus, not first booking
{"ts":"2025-12-05T00:06:00.381Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"15f30e1b-36b5-4d61-9c57-f74dadd3897f","stage":"booking","correlationId":"booking-created:36c45d9e65e04accc9da57a5"}
{"ts":"2025-12-05T00:06:00.540Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"1a0ef8b2-6241-46ec-8334-4040cb6db88a","stage":"booking","correlationId":"booking-created:307402d88566799530eca0a8","attempts":1}
üìÖ Processing booking created for customer: 4CQQSXSF1N0XCVC1GGK8XDZZW4
Full booking data: {
  "id": "9ta527d6gk6ces",
  "allDay": false,
  "source": "FIRST_PARTY_BUYER",
  "status": "CANCELLED_BY_SELLER",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94123-3940",
    "addressLine1": "2266 Union St",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-04T23:00:00Z",
  "version": 1,
  "createdAt": "2025-11-16T14:39:39Z",
  "updatedAt": "2025-11-24T01:02:56Z",
  "customerId": "4CQQSXSF1N0XCVC1GGK8XDZZW4",
  "locationId": "LT4ZHFBQQYB2N",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "4CQQSXSF1N0XCVC1GGK8XDZZW4",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "resourceIds": [
        "KAOXILA4CV7A23VRAACC4R66"
      ],
      "teamMemberId": "TMew76L_w3bra6AH",
      "anyTeamMember": true,
      "durationMinutes": 90,
      "serviceVariationId": "ZEAKNB35I37RMXNUBGWDZQIM",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1760895536505"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Isabel Markl
üéâ First booking detected for customer: 4CQQSXSF1N0XCVC1GGK8XDZZW4
   Name: Isabel Markl
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 4CQQSXSF1N0XCVC1GGK8XDZZW4...
   Full custom attributes response: {}
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 4CQQSXSF1N0XCVC1GGK8XDZZW4
{"ts":"2025-12-05T00:06:00.919Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"1a0ef8b2-6241-46ec-8334-4040cb6db88a","stage":"booking","correlationId":"booking-created:307402d88566799530eca0a8"}
{"ts":"2025-12-05T00:06:01.085Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"3f95c630-5bb0-48e8-b4d6-8ed06102641f","stage":"booking","correlationId":"booking-created:880a746e2cca7d851235f383","attempts":1}
üìÖ Processing booking created for customer: 0GZTYPV8F1QJZ55D9CYBX29RZ0
Full booking data: {
  "id": "byopqn7m4fwig6",
  "allDay": false,
  "source": "FIRST_PARTY_MERCHANT",
  "status": "CANCELLED_BY_SELLER",
  "startAt": "2025-12-04T23:00:00Z",
  "version": 1,
  "createdAt": "2025-12-02T02:37:33Z",
  "updatedAt": "2025-12-02T23:16:52Z",
  "customerId": "0GZTYPV8F1QJZ55D9CYBX29RZ0",
  "locationId": "LNQKVBTQZN3EZ",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "creatorType": "TEAM_MEMBER",
    "teamMemberId": "TMWAtQTYmZpwwxii"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMVwAQUdLz6no-cB",
      "anyTeamMember": false,
      "durationMinutes": 30,
      "serviceVariationId": "SGSLS3INMK5YV637KUITCILL",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1760895536505"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Victoria Huang
üéâ First booking detected for customer: 0GZTYPV8F1QJZ55D9CYBX29RZ0
   Name: Victoria Huang
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 0GZTYPV8F1QJZ55D9CYBX29RZ0...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "a7b40271-729a-41aa-801b-fb1fffb83650"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-11-07T23:26:34.956Z",
      "createdAt": "2025-11-07T23:26:34.956Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="a7b40271-729a-41aa-801b-fb1fffb83650"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "a7b40271-729a-41aa-801b-fb1fffb83650"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 0GZTYPV8F1QJZ55D9CYBX29RZ0
{"ts":"2025-12-05T00:06:01.467Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"3f95c630-5bb0-48e8-b4d6-8ed06102641f","stage":"booking","correlationId":"booking-created:880a746e2cca7d851235f383"}
{"ts":"2025-12-05T00:06:01.630Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"c99eb1b9-3ff1-464f-92ab-4bd9a6c52b0e","stage":"booking","correlationId":"booking-created:7159a1d501273b1c68e6db4c","attempts":1}
üìÖ Processing booking created for customer: B0GJFR8WR9H20EN067QT7RVMHM
Full booking data: {
  "id": "jumx3x8bvdsrjb",
  "allDay": false,
  "source": "FIRST_PARTY_BUYER",
  "status": "CANCELLED_BY_CUSTOMER",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94123-3940",
    "addressLine1": "2266 Union St",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-04T23:00:00Z",
  "version": 1,
  "createdAt": "2025-12-01T21:56:42Z",
  "updatedAt": "2025-12-01T21:57:15Z",
  "customerId": "B0GJFR8WR9H20EN067QT7RVMHM",
  "locationId": "LT4ZHFBQQYB2N",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "B0GJFR8WR9H20EN067QT7RVMHM",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TM9jDlRr_Hl4rdBB",
      "anyTeamMember": false,
      "durationMinutes": 20,
      "serviceVariationId": "HAJX45W3U2WUCCXM5MI24UEE",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1763586786564"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Anne Murdoch
üéâ First booking detected for customer: B0GJFR8WR9H20EN067QT7RVMHM
   Name: Anne Murdoch
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer B0GJFR8WR9H20EN067QT7RVMHM...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "af5791f8-348a-422e-98d1-5e865121bb19"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-02-27T11:09:48.684Z",
      "createdAt": "2025-02-27T11:09:48.684Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="af5791f8-348a-422e-98d1-5e865121bb19"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "af5791f8-348a-422e-98d1-5e865121bb19"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: B0GJFR8WR9H20EN067QT7RVMHM
{"ts":"2025-12-05T00:06:02.016Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"c99eb1b9-3ff1-464f-92ab-4bd9a6c52b0e","stage":"booking","correlationId":"booking-created:7159a1d501273b1c68e6db4c"}
{"ts":"2025-12-05T00:06:02.177Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"26ae8f43-91ec-4544-be0b-e50df940075b","stage":"booking","correlationId":"booking-created:83fd360fd8f993c06ecf6968","attempts":1}
üìÖ Processing booking created for customer: VQ40QAEXD3FTSMHEA8VTRRJS34
Full booking data: {
  "id": "p62oue7ol6zqxs",
  "allDay": false,
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "startAt": "2025-12-04T23:00:00Z",
  "version": 0,
  "createdAt": "2025-12-03T02:43:16Z",
  "updatedAt": "2025-12-03T22:42:44Z",
  "customerId": "VQ40QAEXD3FTSMHEA8VTRRJS34",
  "locationId": "LNQKVBTQZN3EZ",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "creatorType": "TEAM_MEMBER",
    "teamMemberId": "TMWAtQTYmZpwwxii"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMVwAQUdLz6no-cB",
      "anyTeamMember": false,
      "durationMinutes": 150,
      "serviceVariationId": "4QI3JWGEYQANKCGC36J3MYNB",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1758654327496"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Claire Saint-Donat
üéâ First booking detected for customer: VQ40QAEXD3FTSMHEA8VTRRJS34
   Name: Claire Saint-Donat
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer VQ40QAEXD3FTSMHEA8VTRRJS34...
   Full custom attributes response: {}
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: VQ40QAEXD3FTSMHEA8VTRRJS34
{"ts":"2025-12-05T00:06:02.542Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"26ae8f43-91ec-4544-be0b-e50df940075b","stage":"booking","correlationId":"booking-created:83fd360fd8f993c06ecf6968"}
{"ts":"2025-12-05T00:06:02.701Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"bd864015-f1b3-4a3c-9a53-1c8fd18e1592","stage":"booking","correlationId":"booking-created:db3b689aac094f46cc47c856","attempts":1}
üìÖ Processing booking created for customer: PFP8Z9H90WZVKCBD494JK13P2W
Full booking data: {
  "id": "1rc6i0wj83yg1j",
  "allDay": false,
  "source": "FIRST_PARTY_MERCHANT",
  "status": "CANCELLED_BY_SELLER",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94133-4608",
    "addressLine1": "550 Pacific Ave",
    "addressLine2": "",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-04T23:30:00Z",
  "version": 6,
  "createdAt": "2025-11-12T03:02:07Z",
  "updatedAt": "2025-12-02T23:30:11Z",
  "customerId": "PFP8Z9H90WZVKCBD494JK13P2W",
  "locationId": "LNQKVBTQZN3EZ",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "creatorType": "TEAM_MEMBER",
    "teamMemberId": "TMWAtQTYmZpwwxii"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TM-zXe9fXe4axYWn",
      "anyTeamMember": false,
      "durationMinutes": 140,
      "serviceVariationId": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1763586786564"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: null null
üéâ First booking detected for customer: PFP8Z9H90WZVKCBD494JK13P2W
   Name: null null
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer PFP8Z9H90WZVKCBD494JK13P2W...
   Full custom attributes response: {}
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: PFP8Z9H90WZVKCBD494JK13P2W
{"ts":"2025-12-05T00:06:03.465Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"bd864015-f1b3-4a3c-9a53-1c8fd18e1592","stage":"booking","correlationId":"booking-created:db3b689aac094f46cc47c856"}
{"ts":"2025-12-05T00:06:03.622Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"6608ae3a-a816-4a13-9986-daa01628077b","stage":"booking","correlationId":"booking-created:da104d37f1db3a7577b0670d","attempts":1}
üìÖ Processing booking created for customer: 4CQQSXSF1N0XCVC1GGK8XDZZW4
Full booking data: {
  "id": "8buvbkpf9liykv",
  "allDay": false,
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "startAt": "2025-12-04T23:30:00Z",
  "version": 0,
  "createdAt": "2025-11-24T01:03:23Z",
  "updatedAt": "2025-12-04T08:03:39Z",
  "customerId": "4CQQSXSF1N0XCVC1GGK8XDZZW4",
  "locationId": "LT4ZHFBQQYB2N",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "creatorType": "TEAM_MEMBER",
    "teamMemberId": "TMQPbDVvvOCLwqsy"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMyUMvTJIj2HrHSg",
      "anyTeamMember": false,
      "durationMinutes": 90,
      "serviceVariationId": "JMTK5M2CY2W7WEXSTAJKAJ35",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1762893947284"
    },
    {
      "teamMemberId": "TMyUMvTJIj2HrHSg",
      "anyTeamMember": false,
      "durationMinutes": 5,
      "serviceVariationId": "DBRXEHQPCF7V4APTHDQTZW62",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1762374620368"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Isabel Markl
üéâ First booking detected for customer: 4CQQSXSF1N0XCVC1GGK8XDZZW4
   Name: Isabel Markl
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 4CQQSXSF1N0XCVC1GGK8XDZZW4...
   Full custom attributes response: {}
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 4CQQSXSF1N0XCVC1GGK8XDZZW4
{"ts":"2025-12-05T00:06:04.098Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"6608ae3a-a816-4a13-9986-daa01628077b","stage":"booking","correlationId":"booking-created:da104d37f1db3a7577b0670d"}
{"ts":"2025-12-05T00:06:04.260Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"39db075e-1ff7-44c0-b91b-ca6f0b5c46ee","stage":"booking","correlationId":"booking-created:7ed23508a383bce8b0bfe544","attempts":1}
üìÖ Processing booking created for customer: YTSZ1P7GT9D1YCB5D278253TDW
Full booking data: {
  "id": "9qfdnr7rgsiveq",
  "allDay": false,
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "startAt": "2025-12-04T23:30:00Z",
  "version": 3,
  "createdAt": "2025-12-04T21:39:25Z",
  "updatedAt": "2025-12-05T00:00:26Z",
  "customerId": "YTSZ1P7GT9D1YCB5D278253TDW",
  "locationId": "LNQKVBTQZN3EZ",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "creatorType": "TEAM_MEMBER",
    "teamMemberId": "TMWAtQTYmZpwwxii"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMMCVDJoKh3ZkfFo",
      "anyTeamMember": false,
      "durationMinutes": 15,
      "serviceVariationId": "KBHPHVKLJNAF223GMYIRUUH3",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1760895536505"
    },
    {
      "teamMemberId": "TMMCVDJoKh3ZkfFo",
      "anyTeamMember": false,
      "durationMinutes": 15,
      "serviceVariationId": "KBHPHVKLJNAF223GMYIRUUH3",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1760895536505"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Kathrin Koz
‚ÑπÔ∏è Customer YTSZ1P7GT9D1YCB5D278253TDW already received signup bonus, not first booking
{"ts":"2025-12-05T00:06:04.396Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"39db075e-1ff7-44c0-b91b-ca6f0b5c46ee","stage":"booking","correlationId":"booking-created:7ed23508a383bce8b0bfe544"}
{"ts":"2025-12-05T00:06:04.580Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"481ce926-4270-4387-a5b3-8d87998fe77a","stage":"booking","correlationId":"booking-created:470a650727f4e0e269235d0d","attempts":1}
üìÖ Processing booking created for customer: AJ7SYMKPAJ0M4Z521WMYPRPV2C
Full booking data: {
  "id": "c4nhennwcdzvnz",
  "allDay": false,
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "startAt": "2025-12-04T23:30:00Z",
  "version": 0,
  "createdAt": "2025-11-11T19:22:03Z",
  "updatedAt": "2025-12-03T23:19:39Z",
  "customerId": "AJ7SYMKPAJ0M4Z521WMYPRPV2C",
  "locationId": "LT4ZHFBQQYB2N",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "creatorType": "TEAM_MEMBER",
    "teamMemberId": "TMQPbDVvvOCLwqsy"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TM9jDlRr_Hl4rdBB",
      "anyTeamMember": false,
      "durationMinutes": 90,
      "serviceVariationId": "XBUDIMNKOPC2XVG5YLIQ4RYS",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1758654511807"
    },
    {
      "teamMemberId": "TM9jDlRr_Hl4rdBB",
      "anyTeamMember": false,
      "durationMinutes": 20,
      "serviceVariationId": "HAJX45W3U2WUCCXM5MI24UEE",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1762374620368"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Elisabeth Ostrow
üéâ First booking detected for customer: AJ7SYMKPAJ0M4Z521WMYPRPV2C
   Name: Elisabeth Ostrow
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer AJ7SYMKPAJ0M4Z521WMYPRPV2C...
   Full custom attributes response: {}
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: AJ7SYMKPAJ0M4Z521WMYPRPV2C
{"ts":"2025-12-05T00:06:05.304Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"481ce926-4270-4387-a5b3-8d87998fe77a","stage":"booking","correlationId":"booking-created:470a650727f4e0e269235d0d"}
{"ts":"2025-12-05T00:06:05.463Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"07d0abf5-14bf-4aa1-9f40-2469f72f5b34","stage":"booking","correlationId":"booking-created:f55f558e31d673d93499f7db","attempts":1}
üìÖ Processing booking created for customer: PFP8Z9H90WZVKCBD494JK13P2W
Full booking data: {
  "id": "j7wg7i2gr4zrq3",
  "allDay": false,
  "source": "FIRST_PARTY_MERCHANT",
  "status": "CANCELLED_BY_SELLER",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94133-4608",
    "addressLine1": "550 Pacific Ave",
    "addressLine2": "",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-04T23:30:00Z",
  "version": 4,
  "createdAt": "2025-11-12T03:01:43Z",
  "updatedAt": "2025-12-02T23:30:04Z",
  "customerId": "PFP8Z9H90WZVKCBD494JK13P2W",
  "locationId": "LNQKVBTQZN3EZ",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "creatorType": "TEAM_MEMBER",
    "teamMemberId": "TMWAtQTYmZpwwxii"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMVwAQUdLz6no-cB",
      "anyTeamMember": false,
      "durationMinutes": 90,
      "serviceVariationId": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1758921239397"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Peyton .
üéâ First booking detected for customer: PFP8Z9H90WZVKCBD494JK13P2W
   Name: Peyton .
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer PFP8Z9H90WZVKCBD494JK13P2W...
   Full custom attributes response: {}
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: PFP8Z9H90WZVKCBD494JK13P2W
{"ts":"2025-12-05T00:06:05.826Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"07d0abf5-14bf-4aa1-9f40-2469f72f5b34","stage":"booking","correlationId":"booking-created:f55f558e31d673d93499f7db"}
{"ts":"2025-12-05T00:06:05.993Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"d71cdaf6-50af-462a-9287-8c7222bf8ba8","stage":"booking","correlationId":"booking-created:20fed6cfa5f189fc38b808a5","attempts":1}
üìÖ Processing booking created for customer: 4CQQSXSF1N0XCVC1GGK8XDZZW4
Full booking data: {
  "id": "wn512x7d8unbej",
  "allDay": false,
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "startAt": "2025-12-04T23:30:00Z",
  "version": 0,
  "createdAt": "2025-11-24T01:03:50Z",
  "updatedAt": "2025-12-04T08:03:31Z",
  "customerId": "4CQQSXSF1N0XCVC1GGK8XDZZW4",
  "locationId": "LT4ZHFBQQYB2N",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "creatorType": "TEAM_MEMBER",
    "teamMemberId": "TMQPbDVvvOCLwqsy"
  },
  "appointmentSegments": [
    {
      "resourceIds": [
        "KAOXILA4CV7A23VRAACC4R66"
      ],
      "teamMemberId": "TM1L5yPC-yKx6CyO",
      "anyTeamMember": false,
      "durationMinutes": 90,
      "serviceVariationId": "ZEAKNB35I37RMXNUBGWDZQIM",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1760895536505"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Isabel Markl
üéâ First booking detected for customer: 4CQQSXSF1N0XCVC1GGK8XDZZW4
   Name: Isabel Markl
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 4CQQSXSF1N0XCVC1GGK8XDZZW4...
   Full custom attributes response: {}
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 4CQQSXSF1N0XCVC1GGK8XDZZW4
{"ts":"2025-12-05T00:06:06.360Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"d71cdaf6-50af-462a-9287-8c7222bf8ba8","stage":"booking","correlationId":"booking-created:20fed6cfa5f189fc38b808a5"}
{"ts":"2025-12-05T00:06:06.519Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"0bf220a5-0ea3-4add-8127-b5907244226f","stage":"booking","correlationId":"booking-created:28b8caa547b7838745a83b32","attempts":1}
üìÖ Processing booking created for customer: AJ7SYMKPAJ0M4Z521WMYPRPV2C
Full booking data: {
  "id": "yvnkl47m4i3f81",
  "allDay": false,
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "startAt": "2025-12-04T23:30:00Z",
  "version": 1,
  "createdAt": "2025-11-11T19:22:54Z",
  "updatedAt": "2025-12-03T23:19:47Z",
  "customerId": "AJ7SYMKPAJ0M4Z521WMYPRPV2C",
  "locationId": "LT4ZHFBQQYB2N",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "creatorType": "TEAM_MEMBER",
    "teamMemberId": "TMQPbDVvvOCLwqsy"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMMHlgFBIFbMTRap",
      "anyTeamMember": false,
      "durationMinutes": 90,
      "serviceVariationId": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1758921239397"
    },
    {
      "teamMemberId": "TMMHlgFBIFbMTRap",
      "anyTeamMember": false,
      "durationMinutes": 20,
      "serviceVariationId": "HAJX45W3U2WUCCXM5MI24UEE",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1762374620368"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Elisabeth Ostrow
üéâ First booking detected for customer: AJ7SYMKPAJ0M4Z521WMYPRPV2C
   Name: Elisabeth Ostrow
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer AJ7SYMKPAJ0M4Z521WMYPRPV2C...
   Full custom attributes response: {}
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: AJ7SYMKPAJ0M4Z521WMYPRPV2C
{"ts":"2025-12-05T00:06:06.905Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"0bf220a5-0ea3-4add-8127-b5907244226f","stage":"booking","correlationId":"booking-created:28b8caa547b7838745a83b32"}
{"ts":"2025-12-05T00:06:07.067Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"be6552c1-4a38-4d32-b9e7-b59475de2588","stage":"booking","correlationId":"booking-created:52cf17a8fdfbe4dc0eb7b00c","attempts":1}
üìÖ Processing booking created for customer: 2SX68C3DRQJAE79NHJ12F75KKM
Full booking data: {
  "id": "3yagozy7jvcvow",
  "allDay": false,
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postalCode": "94133-4608",
    "addressLine1": "550 Pacific Ave",
    "addressLine2": "",
    "administrativeDistrictLevel1": "CA"
  },
  "startAt": "2025-12-04T23:50:00Z",
  "version": 8,
  "createdAt": "2025-11-30T21:37:38Z",
  "updatedAt": "2025-12-04T18:26:08Z",
  "customerId": "2SX68C3DRQJAE79NHJ12F75KKM",
  "locationId": "LNQKVBTQZN3EZ",
  "locationType": "BUSINESS_LOCATION",
  "creatorDetails": {
    "customerId": "2SX68C3DRQJAE79NHJ12F75KKM",
    "creatorType": "CUSTOMER"
  },
  "appointmentSegments": [
    {
      "teamMemberId": "TMMCVDJoKh3ZkfFo",
      "anyTeamMember": false,
      "durationMinutes": 120,
      "serviceVariationId": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "intermissionMinutes": 0,
      "serviceVariationVersion": "1764609601083"
    }
  ],
  "transitionTimeMinutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Michelle Onweller
üéâ First booking detected for customer: 2SX68C3DRQJAE79NHJ12F75KKM
   Name: Michelle Onweller
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 2SX68C3DRQJAE79NHJ12F75KKM...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "0826aee4-d259-434d-be44-511ac61b3629"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-06-05T23:37:59.962Z",
      "createdAt": "2025-06-05T23:37:59.962Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="0826aee4-d259-434d-be44-511ac61b3629"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "0826aee4-d259-434d-be44-511ac61b3629"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 2SX68C3DRQJAE79NHJ12F75KKM
{"ts":"2025-12-05T00:06:07.457Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"be6552c1-4a38-4d32-b9e7-b59475de2588","stage":"booking","correlationId":"booking-created:52cf17a8fdfbe4dc0eb7b00c"}
{"ts":"2025-12-05T00:06:07.617Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"749afdf6-0900-4b58-b87f-797379b581ed","stage":"payment","correlationId":"payment-updated:207a2363049208bd9d9d9697","attempts":6}
üí∞ Processing payment completion for customer: KJQXREZVBXEZX3BCR3FB4RFCPC
   Payment source_type: unknown
   Payment tender_types: []
Customer KJQXREZVBXEZX3BCR3FB4RFCPC already completed first payment
{"ts":"2025-12-05T00:06:07.754Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"749afdf6-0900-4b58-b87f-797379b581ed","stage":"payment","correlationId":"payment-updated:207a2363049208bd9d9d9697"}
{"ts":"2025-12-05T00:06:07.917Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"afae9972-5ee6-4cde-818c-9fed5617ff52","stage":"payment","correlationId":"payment-updated:953c84070c4bedb86b1fad93","attempts":1}
üí∞ Processing payment completion for customer: 3SRPVX1CXRGXHEZF1CFPEPKXXR
   Payment source_type: unknown
   Payment tender_types: []
Customer 3SRPVX1CXRGXHEZF1CFPEPKXXR already completed first payment
{"ts":"2025-12-05T00:06:08.051Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"afae9972-5ee6-4cde-818c-9fed5617ff52","stage":"payment","correlationId":"payment-updated:953c84070c4bedb86b1fad93"}
{"ts":"2025-12-05T00:06:08.211Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"fe3ee757-ac62-4755-b2e8-20aaeda1b79a","stage":"payment","correlationId":"payment-updated:40d64f2b0bb796c62475faf0","attempts":1}
üí∞ Processing payment completion for customer: 7H49SZHTYE9SKVTF7P60938FQM
   Payment source_type: unknown
   Payment tender_types: []
Customer 7H49SZHTYE9SKVTF7P60938FQM already completed first payment
{"ts":"2025-12-05T00:06:08.344Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"fe3ee757-ac62-4755-b2e8-20aaeda1b79a","stage":"payment","correlationId":"payment-updated:40d64f2b0bb796c62475faf0"}
{"ts":"2025-12-05T00:06:08.504Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"7e3da5e9-0064-46ee-bedf-2dc47333d5c5","stage":"payment","correlationId":"payment-updated:4a20702758917cb51065818e","attempts":1}
üí∞ Processing payment completion for customer: YDJY525GK5JNWTFA9AGQ4GXNTG
   Payment source_type: unknown
   Payment tender_types: []
Customer YDJY525GK5JNWTFA9AGQ4GXNTG already completed first payment
{"ts":"2025-12-05T00:06:08.647Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"7e3da5e9-0064-46ee-bedf-2dc47333d5c5","stage":"payment","correlationId":"payment-updated:4a20702758917cb51065818e"}
{"ts":"2025-12-05T00:06:08.823Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"11b9cbe3-070a-4d21-8554-68d5fcaf4ade","stage":"payment","correlationId":"payment-updated:f8d5e88d7328247ee2f014b5","attempts":1}
üí∞ Processing payment completion for customer: 5MWJCN21QJXECYJ8WTA4HH4EAC
   Payment source_type: unknown
   Payment tender_types: []
Customer 5MWJCN21QJXECYJ8WTA4HH4EAC already completed first payment
{"ts":"2025-12-05T00:06:08.957Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"11b9cbe3-070a-4d21-8554-68d5fcaf4ade","stage":"payment","correlationId":"payment-updated:f8d5e88d7328247ee2f014b5"}
{"ts":"2025-12-05T00:06:09.115Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"5beaaa37-7b5b-402a-a6ae-f05abb5e4ad4","stage":"payment","correlationId":"payment-updated:57b0fcf65834347519f750fb","attempts":1}
üí∞ Processing payment completion for customer: 4J2AQVT0C2MSKRERCT544P9SJG
   Payment source_type: unknown
   Payment tender_types: []
Customer 4J2AQVT0C2MSKRERCT544P9SJG already completed first payment
{"ts":"2025-12-05T00:06:09.259Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"5beaaa37-7b5b-402a-a6ae-f05abb5e4ad4","stage":"payment","correlationId":"payment-updated:57b0fcf65834347519f750fb"}
{"ts":"2025-12-05T00:06:09.427Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"0a334ca1-ed8e-4c9a-8555-dce2d7fcb361","stage":"payment","correlationId":"payment-updated:61aa5bbd9523bcd6accf8cc2","attempts":1}
üí∞ Processing payment completion for customer: 3D7DHB14SV52ZJ5NXY7D77FTKW
   Payment source_type: unknown
   Payment tender_types: []
Customer 3D7DHB14SV52ZJ5NXY7D77FTKW already completed first payment
{"ts":"2025-12-05T00:06:09.561Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"0a334ca1-ed8e-4c9a-8555-dce2d7fcb361","stage":"payment","correlationId":"payment-updated:61aa5bbd9523bcd6accf8cc2"}
{"ts":"2025-12-05T00:06:09.726Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"75da611d-c53a-472e-a87d-a6d1936c0208","stage":"payment","correlationId":"payment-updated:35fb37d4bf30bd0fec3fcc73","attempts":1}
üí∞ Processing payment completion for customer: 3D7DHB14SV52ZJ5NXY7D77FTKW
   Payment source_type: unknown
   Payment tender_types: []
Customer 3D7DHB14SV52ZJ5NXY7D77FTKW already completed first payment
{"ts":"2025-12-05T00:06:10.136Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"75da611d-c53a-472e-a87d-a6d1936c0208","stage":"payment","correlationId":"payment-updated:35fb37d4bf30bd0fec3fcc73"}
{"ts":"2025-12-05T00:06:10.453Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"eb3f9125-7335-4e68-a9fd-36ca43d752bb","stage":"payment","correlationId":"payment-updated:299ff249ecef149bc4ac07c2","attempts":1}
üí∞ Processing payment completion for customer: QAQPFCD6E28NPXV17DP00ZQ7AW
   Payment source_type: unknown
   Payment tender_types: []
Customer QAQPFCD6E28NPXV17DP00ZQ7AW already completed first payment
{"ts":"2025-12-05T00:06:10.728Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"eb3f9125-7335-4e68-a9fd-36ca43d752bb","stage":"payment","correlationId":"payment-updated:299ff249ecef149bc4ac07c2"}
{"ts":"2025-12-05T00:06:11.125Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"aca28552-e275-48e9-b290-cf748e40f189","stage":"payment","correlationId":"payment-updated:21dcc3de9dbf411395e71e7f","attempts":1}
üí∞ Processing payment completion for customer: FR7F2ZCF7HK608WY82RKRNFDTM
   Payment source_type: unknown
   Payment tender_types: []
Customer FR7F2ZCF7HK608WY82RKRNFDTM already completed first payment
{"ts":"2025-12-05T00:06:11.481Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"aca28552-e275-48e9-b290-cf748e40f189","stage":"payment","correlationId":"payment-updated:21dcc3de9dbf411395e71e7f"}
{"ts":"2025-12-05T00:06:11.889Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"d61547c1-0875-489d-b850-2bacf468d78b","stage":"payment","correlationId":"payment-updated:71c1d8860f3e673a93cd2e93","attempts":1}
üí∞ Processing payment completion for customer: 0SGEVF277DSY48W0JGXRPX8CPC
   Payment source_type: unknown
   Payment tender_types: []
Customer 0SGEVF277DSY48W0JGXRPX8CPC already completed first payment
{"ts":"2025-12-05T00:06:12.205Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"d61547c1-0875-489d-b850-2bacf468d78b","stage":"payment","correlationId":"payment-updated:71c1d8860f3e673a93cd2e93"}
{"ts":"2025-12-05T00:06:12.642Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"00c3cfdd-ec4d-4b33-a72f-bd5754c7f76f","stage":"payment","correlationId":"payment-updated:21d50f5a088b75074d779c59","attempts":1}
üí∞ Processing payment completion for customer: YWCV6F05G3GB8QT4WG83HA8HEG
   Payment source_type: unknown
   Payment tender_types: []
Customer YWCV6F05G3GB8QT4WG83HA8HEG already completed first payment
{"ts":"2025-12-05T00:06:12.897Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"00c3cfdd-ec4d-4b33-a72f-bd5754c7f76f","stage":"payment","correlationId":"payment-updated:21d50f5a088b75074d779c59"}
{"ts":"2025-12-05T00:06:13.218Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"82a8d488-d7cd-4910-ac6c-c0f911320daf","stage":"payment","correlationId":"payment-updated:496306323c847765debb95d1","attempts":1}
üí∞ Processing payment completion for customer: 6NX857RCQJH90TW3ZQYSY1NDCR
   Payment source_type: unknown
   Payment tender_types: []
Customer 6NX857RCQJH90TW3ZQYSY1NDCR already completed first payment
{"ts":"2025-12-05T00:06:13.366Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"82a8d488-d7cd-4910-ac6c-c0f911320daf","stage":"payment","correlationId":"payment-updated:496306323c847765debb95d1"}
{"ts":"2025-12-05T00:06:13.538Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"48b9e8f6-5301-4c3e-9823-3aa7e280be4a","stage":"payment","correlationId":"payment-updated:dea9ca70fe945c3274433c3b","attempts":1}
üí∞ Processing payment completion for customer: Q0Z1WXEJS56Z4TJPMEE4SDTDG4
   Payment source_type: unknown
   Payment tender_types: []
Customer Q0Z1WXEJS56Z4TJPMEE4SDTDG4 already completed first payment
{"ts":"2025-12-05T00:06:13.674Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"48b9e8f6-5301-4c3e-9823-3aa7e280be4a","stage":"payment","correlationId":"payment-updated:dea9ca70fe945c3274433c3b"}
{"ts":"2025-12-05T00:06:13.835Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"6bdeac23-c34a-4d0f-b718-8dae99bdb54d","stage":"payment","correlationId":"payment-updated:bc664073d8810561668692a0","attempts":1}
üí∞ Processing payment completion for customer: 09NWVGNMXN29FEN9GNN7CTA02R
   Payment source_type: unknown
   Payment tender_types: []
Customer 09NWVGNMXN29FEN9GNN7CTA02R already completed first payment
{"ts":"2025-12-05T00:06:14.182Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"6bdeac23-c34a-4d0f-b718-8dae99bdb54d","stage":"payment","correlationId":"payment-updated:bc664073d8810561668692a0"}
{"ts":"2025-12-05T00:06:14.618Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"6223e4b5-daa9-4709-b4f2-ef32d4ba657d","stage":"payment","correlationId":"payment-updated:195482c65a87e537ecfa932a","attempts":1}
üí∞ Processing payment completion for customer: DVEK203BNBCAJ9PTSE0GA1HGG4
   Payment source_type: unknown
   Payment tender_types: []
Customer DVEK203BNBCAJ9PTSE0GA1HGG4 already completed first payment
{"ts":"2025-12-05T00:06:14.895Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"6223e4b5-daa9-4709-b4f2-ef32d4ba657d","stage":"payment","correlationId":"payment-updated:195482c65a87e537ecfa932a"}
{"ts":"2025-12-05T00:06:15.188Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"5f2d09c6-1d9a-4146-aff7-0b653636f6b6","stage":"payment","correlationId":"payment-updated:8fc2069c9adbf7ea0937b17d","attempts":1}
üí∞ Processing payment completion for customer: 7QEECQDAJ7K1W0BM9HHFQ1NVCR
   Payment source_type: unknown
   Payment tender_types: []
Customer 7QEECQDAJ7K1W0BM9HHFQ1NVCR already completed first payment
{"ts":"2025-12-05T00:06:15.536Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"5f2d09c6-1d9a-4146-aff7-0b653636f6b6","stage":"payment","correlationId":"payment-updated:8fc2069c9adbf7ea0937b17d"}
{"ts":"2025-12-05T00:06:15.924Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"b2f4b54c-1eb3-42ec-9055-02a0ddeaedb9","stage":"payment","correlationId":"payment-updated:621be14be4ca85dccd2f595f","attempts":1}
üí∞ Processing payment completion for customer: N9PXK9D2TT4RR5GHPX5WTHCBE0
   Payment source_type: unknown
   Payment tender_types: []
Customer N9PXK9D2TT4RR5GHPX5WTHCBE0 already completed first payment
{"ts":"2025-12-05T00:06:16.354Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"b2f4b54c-1eb3-42ec-9055-02a0ddeaedb9","stage":"payment","correlationId":"payment-updated:621be14be4ca85dccd2f595f"}
{"ts":"2025-12-05T00:06:16.767Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"dd970f65-92c4-4217-9842-8626a1d7ec54","stage":"payment","correlationId":"payment-updated:2ef702bdee0608d642242b70","attempts":1}
üí∞ Processing payment completion for customer: CAGT4K6TVVA0CA83T6DYE2GVCM
   Payment source_type: unknown
   Payment tender_types: []
Customer CAGT4K6TVVA0CA83T6DYE2GVCM already completed first payment
{"ts":"2025-12-05T00:06:17.020Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"dd970f65-92c4-4217-9842-8626a1d7ec54","stage":"payment","correlationId":"payment-updated:2ef702bdee0608d642242b70"}
{"ts":"2025-12-05T00:06:17.344Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"fd25fd09-2a84-4c40-b497-b66e06afb36f","stage":"payment","correlationId":"payment-updated:0d6c1aa9512fc16c91204a08","attempts":1}
üí∞ Processing payment completion for customer: 96FWAQ72E0EMCPMRAF25FBHX78
   Payment source_type: unknown
   Payment tender_types: []
Customer 96FWAQ72E0EMCPMRAF25FBHX78 already completed first payment
{"ts":"2025-12-05T00:06:17.482Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"fd25fd09-2a84-4c40-b497-b66e06afb36f","stage":"payment","correlationId":"payment-updated:0d6c1aa9512fc16c91204a08"}
{"ts":"2025-12-05T00:06:17.640Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"b745c8c5-c150-4dff-b92b-2df35b7bf9ea","stage":"payment","correlationId":"payment-updated:0cbd69d0a853e13368540855","attempts":1}
üí∞ Processing payment completion for customer: GN4MCT7J7ZW2RFPF6NZYEE0AEC
   Payment source_type: unknown
   Payment tender_types: []
Customer GN4MCT7J7ZW2RFPF6NZYEE0AEC already completed first payment
{"ts":"2025-12-05T00:06:17.808Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"b745c8c5-c150-4dff-b92b-2df35b7bf9ea","stage":"payment","correlationId":"payment-updated:0cbd69d0a853e13368540855"}
{"ts":"2025-12-05T00:06:17.967Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"39685ba2-7806-4f4d-83ea-8b119b3554e3","stage":"payment","correlationId":"payment-updated:6348ca5914bab3d61fda88a3","attempts":1}
üí∞ Processing payment completion for customer: BYH6XBPGXBDJ6JS7P4GNBJS7M0
   Payment source_type: unknown
   Payment tender_types: []
Customer BYH6XBPGXBDJ6JS7P4GNBJS7M0 already completed first payment
{"ts":"2025-12-05T00:06:18.120Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"39685ba2-7806-4f4d-83ea-8b119b3554e3","stage":"payment","correlationId":"payment-updated:6348ca5914bab3d61fda88a3"}
{"ts":"2025-12-05T00:06:18.281Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"14fea4bf-ed0f-4b4d-84c6-cc493ca3229f","stage":"payment","correlationId":"payment-updated:a172f2c3e6a193a9b3f8a618","attempts":1}
üí∞ Processing payment completion for customer: ZMWFF70XE65P73J4ZHKW6862K4
   Payment source_type: unknown
   Payment tender_types: []
Customer ZMWFF70XE65P73J4ZHKW6862K4 already completed first payment
{"ts":"2025-12-05T00:06:18.416Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"14fea4bf-ed0f-4b4d-84c6-cc493ca3229f","stage":"payment","correlationId":"payment-updated:a172f2c3e6a193a9b3f8a618"}
{"ts":"2025-12-05T00:06:18.574Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"ec97b421-d974-4844-85df-9622f8314578","stage":"payment","correlationId":"payment-updated:cd429d651e9d15e0a31d2106","attempts":1}
üí∞ Processing payment completion for customer: GAQYPGFH1S596HTSQQQKKZDKV0
   Payment source_type: unknown
   Payment tender_types: []
Customer GAQYPGFH1S596HTSQQQKKZDKV0 already completed first payment
{"ts":"2025-12-05T00:06:18.708Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"ec97b421-d974-4844-85df-9622f8314578","stage":"payment","correlationId":"payment-updated:cd429d651e9d15e0a31d2106"}
{"ts":"2025-12-05T00:06:18.871Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"0d4e714b-e583-4aac-827b-3bb39ed0835b","stage":"payment","correlationId":"payment-updated:3d4b6a2b823be583ee875cff","attempts":1}
üí∞ Processing payment completion for customer: X9V7VBD7TKWHX75HY3J70PR5M0
   Payment source_type: unknown
   Payment tender_types: []
Customer X9V7VBD7TKWHX75HY3J70PR5M0 already completed first payment
{"ts":"2025-12-05T00:06:19.008Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"0d4e714b-e583-4aac-827b-3bb39ed0835b","stage":"payment","correlationId":"payment-updated:3d4b6a2b823be583ee875cff"}
{"ts":"2025-12-05T00:06:19.166Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"76b3ff20-f0b7-4ab6-bca9-1fa3d2eb8b8e","stage":"payment","correlationId":"payment-updated:5a6199122896b52b7395ba4e","attempts":1}
üí∞ Processing payment completion for customer: G6R9ZJ4JZ48QKCB9JRD8AM81VC
   Payment source_type: unknown
   Payment tender_types: []
Customer G6R9ZJ4JZ48QKCB9JRD8AM81VC already completed first payment
{"ts":"2025-12-05T00:06:19.319Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"76b3ff20-f0b7-4ab6-bca9-1fa3d2eb8b8e","stage":"payment","correlationId":"payment-updated:5a6199122896b52b7395ba4e"}
{"ts":"2025-12-05T00:06:19.480Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"07ca8f66-eca2-4ce6-bab2-49a97905c8f9","stage":"payment","correlationId":"payment-updated:d7e5c2fb3c6a619b953570e3","attempts":1}
üí∞ Processing payment completion for customer: 3J2GT9G70SC5TNK1E0RX03TEY8
   Payment source_type: unknown
   Payment tender_types: []
Customer 3J2GT9G70SC5TNK1E0RX03TEY8 already completed first payment
{"ts":"2025-12-05T00:06:19.612Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"07ca8f66-eca2-4ce6-bab2-49a97905c8f9","stage":"payment","correlationId":"payment-updated:d7e5c2fb3c6a619b953570e3"}
{"ts":"2025-12-05T00:06:19.783Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"c6de151b-6a9a-4988-b204-8b5ed7ec4bd9","stage":"payment","correlationId":"payment-updated:5eb1435576254bfa582f4a57","attempts":1}
üí∞ Processing payment completion for customer: H5WY5JZGN5YA92ENW2WJ60F830
   Payment source_type: unknown
   Payment tender_types: []
Customer H5WY5JZGN5YA92ENW2WJ60F830 already completed first payment
{"ts":"2025-12-05T00:06:19.916Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"c6de151b-6a9a-4988-b204-8b5ed7ec4bd9","stage":"payment","correlationId":"payment-updated:5eb1435576254bfa582f4a57"}
{"ts":"2025-12-05T00:06:20.075Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"831bdb46-ce75-4ea2-9982-3ddfd002c526","stage":"payment","correlationId":"payment-updated:52ef7c84cdb9ca3e5173be54","attempts":1}
üí∞ Processing payment completion for customer: JHMTMS2Q6CCQGNGKF6DBHGYDWR
   Payment source_type: unknown
   Payment tender_types: []
Customer JHMTMS2Q6CCQGNGKF6DBHGYDWR already completed first payment
{"ts":"2025-12-05T00:06:20.210Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"831bdb46-ce75-4ea2-9982-3ddfd002c526","stage":"payment","correlationId":"payment-updated:52ef7c84cdb9ca3e5173be54"}
{"ts":"2025-12-05T00:06:20.376Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"9042e899-f86a-461d-b61c-fef650ec2402","stage":"payment","correlationId":"payment-updated:b34addfe94bec162e3cdcea2","attempts":1}
üí∞ Processing payment completion for customer: 4QV9HBRD6SY5F3ESB848T3W9HC
   Payment source_type: unknown
   Payment tender_types: []
Customer 4QV9HBRD6SY5F3ESB848T3W9HC already completed first payment
{"ts":"2025-12-05T00:06:20.511Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"9042e899-f86a-461d-b61c-fef650ec2402","stage":"payment","correlationId":"payment-updated:b34addfe94bec162e3cdcea2"}
{"ts":"2025-12-05T00:06:20.671Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"693f7e07-2bb8-46ca-8a91-ba9ded9509ab","stage":"payment","correlationId":"payment-updated:a864a99bf3932347a75ff9c5","attempts":1}
üí∞ Processing payment completion for customer: 5T9XNDW68D7XSDMYRQAMVNXZCR
   Payment source_type: unknown
   Payment tender_types: []
Customer 5T9XNDW68D7XSDMYRQAMVNXZCR already completed first payment
{"ts":"2025-12-05T00:06:20.808Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"693f7e07-2bb8-46ca-8a91-ba9ded9509ab","stage":"payment","correlationId":"payment-updated:a864a99bf3932347a75ff9c5"}
{"ts":"2025-12-05T00:06:20.968Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"2d26e124-383c-43a1-93ea-430e30948545","stage":"payment","correlationId":"payment-updated:91bafbfd6fc1e63122db0f9a","attempts":1}
üí∞ Processing payment completion for customer: XAVABFB0ESQ7ATBN08FAQDPYAM
   Payment source_type: unknown
   Payment tender_types: []
Customer XAVABFB0ESQ7ATBN08FAQDPYAM already completed first payment
{"ts":"2025-12-05T00:06:21.118Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"2d26e124-383c-43a1-93ea-430e30948545","stage":"payment","correlationId":"payment-updated:91bafbfd6fc1e63122db0f9a"}
{"ts":"2025-12-05T00:06:21.287Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"abffe09e-205b-4fa3-847e-59ac6278489f","stage":"payment","correlationId":"payment-updated:d5542efb6d95d2924e7dcd64","attempts":1}
üí∞ Processing payment completion for customer: HNF0R9FVTTW27X2N2QT30YFQ9M
   Payment source_type: unknown
   Payment tender_types: []
Customer HNF0R9FVTTW27X2N2QT30YFQ9M already completed first payment
{"ts":"2025-12-05T00:06:21.419Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"abffe09e-205b-4fa3-847e-59ac6278489f","stage":"payment","correlationId":"payment-updated:d5542efb6d95d2924e7dcd64"}
{"ts":"2025-12-05T00:06:21.580Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"6fbba880-c35d-485e-b86c-6240e3fa5a4e","stage":"payment","correlationId":"payment-updated:2f1caaf280f421b52164b20d","attempts":1}
üí∞ Processing payment completion for customer: VX4W3SJ6RTFDRQNK1TZJC1T19G
   Payment source_type: unknown
   Payment tender_types: []
Customer VX4W3SJ6RTFDRQNK1TZJC1T19G already completed first payment
{"ts":"2025-12-05T00:06:21.713Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"6fbba880-c35d-485e-b86c-6240e3fa5a4e","stage":"payment","correlationId":"payment-updated:2f1caaf280f421b52164b20d"}
{"ts":"2025-12-05T00:06:21.875Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"30862027-e674-47dc-b45d-909f8adce80c","stage":"payment","correlationId":"payment-updated:b754c3c64297942ec0f22a51","attempts":1}
üí∞ Processing payment completion for customer: 8591EDHVQ1DAZNRPFPZ74KCNKW
   Payment source_type: unknown
   Payment tender_types: []
Customer 8591EDHVQ1DAZNRPFPZ74KCNKW already completed first payment
{"ts":"2025-12-05T00:06:22.009Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"30862027-e674-47dc-b45d-909f8adce80c","stage":"payment","correlationId":"payment-updated:b754c3c64297942ec0f22a51"}
{"ts":"2025-12-05T00:06:22.169Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"8677abc9-3694-42f1-bf3b-c7f1131d84b9","stage":"payment","correlationId":"payment-updated:17adf648015c0595e08be756","attempts":1}
üí∞ Processing payment completion for customer: 8591EDHVQ1DAZNRPFPZ74KCNKW
   Payment source_type: unknown
   Payment tender_types: []
Customer 8591EDHVQ1DAZNRPFPZ74KCNKW already completed first payment
{"ts":"2025-12-05T00:06:22.303Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"8677abc9-3694-42f1-bf3b-c7f1131d84b9","stage":"payment","correlationId":"payment-updated:17adf648015c0595e08be756"}
{"ts":"2025-12-05T00:06:22.464Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"2704865e-7b8a-486a-a246-f5001321a7f5","stage":"payment","correlationId":"payment-updated:4531b67a530141e386c50057","attempts":1}
üí∞ Processing payment completion for customer: 4WB9Q19C8VYKFXRK7G9VVXB10C
   Payment source_type: unknown
   Payment tender_types: []
Customer 4WB9Q19C8VYKFXRK7G9VVXB10C already completed first payment
{"ts":"2025-12-05T00:06:22.600Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"2704865e-7b8a-486a-a246-f5001321a7f5","stage":"payment","correlationId":"payment-updated:4531b67a530141e386c50057"}
{"ts":"2025-12-05T00:06:22.759Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"898a40c9-b5db-4295-b488-a154b2190a0c","stage":"payment","correlationId":"payment-updated:1b8f6da8b4160a73ba023862","attempts":1}
üí∞ Processing payment completion for customer: 06WSVCE31KD6K0VKWHS1X9N858
   Payment source_type: unknown
   Payment tender_types: []
Customer 06WSVCE31KD6K0VKWHS1X9N858 already completed first payment
{"ts":"2025-12-05T00:06:22.961Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"898a40c9-b5db-4295-b488-a154b2190a0c","stage":"payment","correlationId":"payment-updated:1b8f6da8b4160a73ba023862"}
{"ts":"2025-12-05T00:06:23.132Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"34e0aaac-7dda-4d86-8991-0fe427196223","stage":"payment","correlationId":"payment-updated:4c2d2eeed249cc94650f668b","attempts":1}
üí∞ Processing payment completion for customer: ZRKFNEJ0C02CBWWHVJWPYH1T6R
   Payment source_type: unknown
   Payment tender_types: []
Customer ZRKFNEJ0C02CBWWHVJWPYH1T6R already completed first payment
{"ts":"2025-12-05T00:06:23.262Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"34e0aaac-7dda-4d86-8991-0fe427196223","stage":"payment","correlationId":"payment-updated:4c2d2eeed249cc94650f668b"}
{"ts":"2025-12-05T00:06:23.421Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"43068924-2b3a-4173-9b48-fd1fa18d9fc2","stage":"payment","correlationId":"payment-updated:4b27a07208aaa5fd200babaa","attempts":1}
üí∞ Processing payment completion for customer: DVMAN54KJVGC981DAYJV0RFAV0
   Payment source_type: unknown
   Payment tender_types: []
Customer DVMAN54KJVGC981DAYJV0RFAV0 already completed first payment
{"ts":"2025-12-05T00:06:23.567Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"43068924-2b3a-4173-9b48-fd1fa18d9fc2","stage":"payment","correlationId":"payment-updated:4b27a07208aaa5fd200babaa"}
{"ts":"2025-12-05T00:06:23.728Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"af600320-90f5-44f6-927a-de370403f4e1","stage":"payment","correlationId":"payment-updated:ddb8a43adbf38701de94f63a","attempts":1}
üí∞ Processing payment completion for customer: QK0JEQ7Y7D3SK9VK8JA9KKZA7R
   Payment source_type: unknown
   Payment tender_types: []
Customer QK0JEQ7Y7D3SK9VK8JA9KKZA7R already completed first payment
{"ts":"2025-12-05T00:06:23.862Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"af600320-90f5-44f6-927a-de370403f4e1","stage":"payment","correlationId":"payment-updated:ddb8a43adbf38701de94f63a"}
{"ts":"2025-12-05T00:06:24.024Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"89f9b878-964e-48fa-9d34-abf932e9513b","stage":"payment","correlationId":"payment-updated:1ff5360af0d4bb721298ae93","attempts":1}
üí∞ Processing payment completion for customer: QK0JEQ7Y7D3SK9VK8JA9KKZA7R
   Payment source_type: unknown
   Payment tender_types: []
Customer QK0JEQ7Y7D3SK9VK8JA9KKZA7R already completed first payment
{"ts":"2025-12-05T00:06:24.159Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"89f9b878-964e-48fa-9d34-abf932e9513b","stage":"payment","correlationId":"payment-updated:1ff5360af0d4bb721298ae93"}
{"ts":"2025-12-05T00:06:24.323Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"9260969b-66f5-465a-a502-c209b9d809d6","stage":"payment","correlationId":"payment-updated:a112bdc01273e0ec184a254a","attempts":1}
üí∞ Processing payment completion for customer: 5J78047WQ76JWSX8467HNPNSM8
   Payment source_type: unknown
   Payment tender_types: []
Customer 5J78047WQ76JWSX8467HNPNSM8 already completed first payment
{"ts":"2025-12-05T00:06:24.463Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"9260969b-66f5-465a-a502-c209b9d809d6","stage":"payment","correlationId":"payment-updated:a112bdc01273e0ec184a254a"}
{"ts":"2025-12-05T00:06:24.622Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"752efd3c-a6da-46d8-b2be-957ff7d7dcbc","stage":"payment","correlationId":"payment-updated:bffd117d62fd557ad02e3f93","attempts":1}
üí∞ Processing payment completion for customer: B8PK45VWHFBG81H9R5322WYE3C
   Payment source_type: unknown
   Payment tender_types: []
Customer B8PK45VWHFBG81H9R5322WYE3C already completed first payment
{"ts":"2025-12-05T00:06:24.760Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"752efd3c-a6da-46d8-b2be-957ff7d7dcbc","stage":"payment","correlationId":"payment-updated:bffd117d62fd557ad02e3f93"}
{"ts":"2025-12-05T00:06:24.920Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"9d69ed00-3d99-4a08-a86d-ec8d951a1a80","stage":"payment","correlationId":"payment-updated:0f398fea6baa22d117879df5","attempts":1}
üí∞ Processing payment completion for customer: EDAP6Z012DMZHGTSXQMT56MKPM
   Payment source_type: unknown
   Payment tender_types: []
Customer EDAP6Z012DMZHGTSXQMT56MKPM already completed first payment
{"ts":"2025-12-05T00:06:25.053Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"9d69ed00-3d99-4a08-a86d-ec8d951a1a80","stage":"payment","correlationId":"payment-updated:0f398fea6baa22d117879df5"}
{"ts":"2025-12-05T00:06:25.215Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"29aa4734-7334-4f74-823a-437afc1566b8","stage":"payment","correlationId":"payment-updated:45f2867195e8b613d35e61e6","attempts":1}
üí∞ Processing payment completion for customer: 87TA83C64WXA2J0WWDSJ2ZG5S4
   Payment source_type: unknown
   Payment tender_types: []
Customer 87TA83C64WXA2J0WWDSJ2ZG5S4 already completed first payment
{"ts":"2025-12-05T00:06:25.350Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"29aa4734-7334-4f74-823a-437afc1566b8","stage":"payment","correlationId":"payment-updated:45f2867195e8b613d35e61e6"}
{"ts":"2025-12-05T00:06:25.511Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"91dbf7e6-86b3-485a-8c48-cc8d127e31c0","stage":"payment","correlationId":"payment-updated:08882b762a467cbb6aea4236","attempts":1}
üí∞ Processing payment completion for customer: BQM3PY1G4NZG57F6T5M2W05138
   Payment source_type: unknown
   Payment tender_types: []
Customer BQM3PY1G4NZG57F6T5M2W05138 already completed first payment
{"ts":"2025-12-05T00:06:25.645Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"91dbf7e6-86b3-485a-8c48-cc8d127e31c0","stage":"payment","correlationId":"payment-updated:08882b762a467cbb6aea4236"}
{"ts":"2025-12-05T00:06:25.828Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"7e6a80c0-cb47-4a0a-948f-64b82e5e21c4","stage":"payment","correlationId":"payment-updated:60e8596c62861d1c5ffd6cd3","attempts":1}
üí∞ Processing payment completion for customer: MT77A5DC58XX03KK4J3QDNCPQR
   Payment source_type: unknown
   Payment tender_types: []
Customer MT77A5DC58XX03KK4J3QDNCPQR already completed first payment
{"ts":"2025-12-05T00:06:25.961Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"7e6a80c0-cb47-4a0a-948f-64b82e5e21c4","stage":"payment","correlationId":"payment-updated:60e8596c62861d1c5ffd6cd3"}
{"ts":"2025-12-05T00:06:26.121Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"85da85cc-2f70-4bad-9915-67b77a20b61c","stage":"payment","correlationId":"payment-updated:449347b2ffddc726855ac38c","attempts":1}
üí∞ Processing payment completion for customer: SMR44PGNQGG3VZ831QS25TP17M
   Payment source_type: unknown
   Payment tender_types: []
Customer SMR44PGNQGG3VZ831QS25TP17M already completed first payment
{"ts":"2025-12-05T00:06:26.256Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"85da85cc-2f70-4bad-9915-67b77a20b61c","stage":"payment","correlationId":"payment-updated:449347b2ffddc726855ac38c"}
{"ts":"2025-12-05T00:06:26.414Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"3ed36064-f981-4fed-8362-ff306e08ac00","stage":"payment","correlationId":"payment-updated:d39a88547f6798609754a5a9","attempts":1}
üí∞ Processing payment completion for customer: YCVAFVPN1W5YDYW9T4AE3P2MHR
   Payment source_type: unknown
   Payment tender_types: []
Customer YCVAFVPN1W5YDYW9T4AE3P2MHR already completed first payment
{"ts":"2025-12-05T00:06:26.550Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"3ed36064-f981-4fed-8362-ff306e08ac00","stage":"payment","correlationId":"payment-updated:d39a88547f6798609754a5a9"}
{"ts":"2025-12-05T00:06:26.712Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"0bce4360-a8ed-4715-ad53-6f7f409b9d80","stage":"payment","correlationId":"payment-updated:ae5edc6589fd3e41f9cab1bb","attempts":1}
üí∞ Processing payment completion for customer: ZQYMGH6ZSSJ8VF7YB6J2TPBPK0
   Payment source_type: unknown
   Payment tender_types: []
Customer ZQYMGH6ZSSJ8VF7YB6J2TPBPK0 already completed first payment
{"ts":"2025-12-05T00:06:26.845Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"0bce4360-a8ed-4715-ad53-6f7f409b9d80","stage":"payment","correlationId":"payment-updated:ae5edc6589fd3e41f9cab1bb"}
{"ts":"2025-12-05T00:06:27.011Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"d8621f7e-2c17-4722-a2d1-1f8241dde0ad","stage":"payment","correlationId":"payment-updated:22dd4e3512f21723f7eedf5f","attempts":1}
üí∞ Processing payment completion for customer: 2C1VE5PYG1ZD8291E2P299G1XG
   Payment source_type: unknown
   Payment tender_types: []
Customer 2C1VE5PYG1ZD8291E2P299G1XG already completed first payment
{"ts":"2025-12-05T00:06:27.144Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"d8621f7e-2c17-4722-a2d1-1f8241dde0ad","stage":"payment","correlationId":"payment-updated:22dd4e3512f21723f7eedf5f"}
{"ts":"2025-12-05T00:06:27.305Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"b70ea80d-6636-4e62-81a3-63c36eb2efa3","stage":"payment","correlationId":"payment-updated:1a5196870960a5508e56eefb","attempts":1}
üí∞ Processing payment completion for customer: 15FD48HH5W155VQ8EP5VXK1VK4
   Payment source_type: unknown
   Payment tender_types: []
Customer 15FD48HH5W155VQ8EP5VXK1VK4 already completed first payment
{"ts":"2025-12-05T00:06:27.451Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"b70ea80d-6636-4e62-81a3-63c36eb2efa3","stage":"payment","correlationId":"payment-updated:1a5196870960a5508e56eefb"}
{"ts":"2025-12-05T00:06:27.622Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"be952f5e-e4fd-493b-910a-64b6079727d5","stage":"payment","correlationId":"payment-updated:2e139613b8b768e67051b645","attempts":1}
üí∞ Processing payment completion for customer: CVMPZMETADGKBNA919CVECKC9C
   Payment source_type: unknown
   Payment tender_types: []
Customer CVMPZMETADGKBNA919CVECKC9C already completed first payment
{"ts":"2025-12-05T00:06:27.756Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"be952f5e-e4fd-493b-910a-64b6079727d5","stage":"payment","correlationId":"payment-updated:2e139613b8b768e67051b645"}
{"ts":"2025-12-05T00:06:27.918Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"7dfab315-0f09-4a56-a2ee-585b35988171","stage":"payment","correlationId":"payment-updated:5e465faf82e4fd5cdc37871b","attempts":1}
üí∞ Processing payment completion for customer: TE85QP9QYNHGGQ19T137CMP9CG
   Payment source_type: unknown
   Payment tender_types: []
Customer TE85QP9QYNHGGQ19T137CMP9CG already completed first payment
{"ts":"2025-12-05T00:06:28.053Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"7dfab315-0f09-4a56-a2ee-585b35988171","stage":"payment","correlationId":"payment-updated:5e465faf82e4fd5cdc37871b"}
{"ts":"2025-12-05T00:06:28.213Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"0957baee-6a5d-4299-8660-cb916e818791","stage":"payment","correlationId":"payment-updated:b075f310a5ebd1c56a7c95bd","attempts":1}
üí∞ Processing payment completion for customer: D5CTPAWV3D133SK80DYQGZ0BW8
   Payment source_type: unknown
   Payment tender_types: []
Customer D5CTPAWV3D133SK80DYQGZ0BW8 already completed first payment
{"ts":"2025-12-05T00:06:28.355Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"0957baee-6a5d-4299-8660-cb916e818791","stage":"payment","correlationId":"payment-updated:b075f310a5ebd1c56a7c95bd"}
{"ts":"2025-12-05T00:06:28.538Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"0cc0b15d-a96d-494b-9faa-a5f413020e92","stage":"payment","correlationId":"payment-updated:f71948daac6447da99c78bc3","attempts":1}
üí∞ Processing payment completion for customer: 4W5KXZ7SXB2JTDA41N4APC9N0M
   Payment source_type: unknown
   Payment tender_types: []
Customer 4W5KXZ7SXB2JTDA41N4APC9N0M already completed first payment
{"ts":"2025-12-05T00:06:28.766Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"0cc0b15d-a96d-494b-9faa-a5f413020e92","stage":"payment","correlationId":"payment-updated:f71948daac6447da99c78bc3"}
{"ts":"2025-12-05T00:06:29.107Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"0c16b3e8-7696-4df5-ba12-decdd0baceef","stage":"payment","correlationId":"payment-updated:783fc8f08ad7e2f24e3b8cbb","attempts":1}
üí∞ Processing payment completion for customer: WVF9C9XMEP6DK635K4S061HPNG
   Payment source_type: unknown
   Payment tender_types: []
Customer WVF9C9XMEP6DK635K4S061HPNG already completed first payment
{"ts":"2025-12-05T00:06:29.407Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"0c16b3e8-7696-4df5-ba12-decdd0baceef","stage":"payment","correlationId":"payment-updated:783fc8f08ad7e2f24e3b8cbb"}
{"ts":"2025-12-05T00:06:29.813Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"47d51a05-5dde-464d-8e36-7a49a6e4f67f","stage":"payment","correlationId":"payment-updated:8e41f32e25895579299bad34","attempts":1}
üí∞ Processing payment completion for customer: MAMXBMH3GWRVZZKST07MZ8WD24
   Payment source_type: unknown
   Payment tender_types: []
Customer MAMXBMH3GWRVZZKST07MZ8WD24 already completed first payment
{"ts":"2025-12-05T00:06:30.099Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"47d51a05-5dde-464d-8e36-7a49a6e4f67f","stage":"payment","correlationId":"payment-updated:8e41f32e25895579299bad34"}
{"ts":"2025-12-05T00:06:30.513Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"5659fba7-bb28-4f63-aaf1-ba422e4c33fb","stage":"payment","correlationId":"payment-updated:0b9813accc6eaf04e2a42ae6","attempts":1}
üí∞ Processing payment completion for customer: YMMA4JNTGXQ44CC4STRMW9R46R
   Payment source_type: unknown
   Payment tender_types: []
Customer YMMA4JNTGXQ44CC4STRMW9R46R already completed first payment
{"ts":"2025-12-05T00:06:30.886Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"5659fba7-bb28-4f63-aaf1-ba422e4c33fb","stage":"payment","correlationId":"payment-updated:0b9813accc6eaf04e2a42ae6"}
{"ts":"2025-12-05T00:06:31.269Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"c97901dc-dff3-4557-ac30-44f6d05bf290","stage":"payment","correlationId":"payment-updated:3d4f7ff6baa510e800111a77","attempts":1}
üí∞ Processing payment completion for customer: W8X9W9RPZ3QX6KW4JBBFHBR63W
   Payment source_type: unknown
   Payment tender_types: []
Customer W8X9W9RPZ3QX6KW4JBBFHBR63W already completed first payment
{"ts":"2025-12-05T00:06:31.530Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"c97901dc-dff3-4557-ac30-44f6d05bf290","stage":"payment","correlationId":"payment-updated:3d4f7ff6baa510e800111a77"}
{"ts":"2025-12-05T00:06:31.887Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"43cdf9f0-1233-4b74-ab7c-93d71f39df47","stage":"payment","correlationId":"payment-updated:f6c20f7b60ee3e6ac17262c9","attempts":1}
üí∞ Processing payment completion for customer: W8X9W9RPZ3QX6KW4JBBFHBR63W
   Payment source_type: unknown
   Payment tender_types: []
Customer W8X9W9RPZ3QX6KW4JBBFHBR63W already completed first payment
{"ts":"2025-12-05T00:06:32.110Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"43cdf9f0-1233-4b74-ab7c-93d71f39df47","stage":"payment","correlationId":"payment-updated:f6c20f7b60ee3e6ac17262c9"}
{"ts":"2025-12-05T00:06:32.293Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"981b21c5-7e0b-40f9-8e88-72cdab0d2d4c","stage":"payment","correlationId":"payment-updated:a8b7cc981ba6690cf7480211","attempts":1}
üí∞ Processing payment completion for customer: NAPS7QWF3KY5E7P68X24SB606R
   Payment source_type: unknown
   Payment tender_types: []
Customer NAPS7QWF3KY5E7P68X24SB606R already completed first payment
{"ts":"2025-12-05T00:06:32.438Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"981b21c5-7e0b-40f9-8e88-72cdab0d2d4c","stage":"payment","correlationId":"payment-updated:a8b7cc981ba6690cf7480211"}
{"ts":"2025-12-05T00:06:32.602Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"babdd3e2-fe6f-4870-9740-7a760b002264","stage":"payment","correlationId":"payment-updated:e7868a14399de99a09b2b5b7","attempts":1}
üí∞ Processing payment completion for customer: 6XW971FQS4D8Y01EHA23YGV3PW
   Payment source_type: unknown
   Payment tender_types: []
Customer 6XW971FQS4D8Y01EHA23YGV3PW already completed first payment
{"ts":"2025-12-05T00:06:32.744Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"babdd3e2-fe6f-4870-9740-7a760b002264","stage":"payment","correlationId":"payment-updated:e7868a14399de99a09b2b5b7"}
{"ts":"2025-12-05T00:06:33.179Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"f4afd4ed-4190-4c71-9948-b3a189627a43","stage":"payment","correlationId":"payment-updated:5d2493f91796319f9e27ecb2","attempts":1}
üí∞ Processing payment completion for customer: ATF01XQWM5VT6FTF4ESV0RC3CG
   Payment source_type: unknown
   Payment tender_types: []
Customer ATF01XQWM5VT6FTF4ESV0RC3CG already completed first payment
{"ts":"2025-12-05T00:06:33.494Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"f4afd4ed-4190-4c71-9948-b3a189627a43","stage":"payment","correlationId":"payment-updated:5d2493f91796319f9e27ecb2"}
{"ts":"2025-12-05T00:06:33.910Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"e293240e-dd78-4725-abf0-7fa315a52b37","stage":"payment","correlationId":"payment-updated:798b235e0a64d334c8698fa1","attempts":1}
üí∞ Processing payment completion for customer: XERB3P3EVSTPSZVRMX379F28R8
   Payment source_type: unknown
   Payment tender_types: []
Customer XERB3P3EVSTPSZVRMX379F28R8 already completed first payment
{"ts":"2025-12-05T00:06:34.166Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"e293240e-dd78-4725-abf0-7fa315a52b37","stage":"payment","correlationId":"payment-updated:798b235e0a64d334c8698fa1"}
{"ts":"2025-12-05T00:06:34.554Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"75d86ae2-81bf-417b-9f54-3056e67502b6","stage":"payment","correlationId":"payment-updated:074f603b1f4d1d436fd0bfad","attempts":1}
üí∞ Processing payment completion for customer: 9CE709PP621PNJZVYGJFRS119C
   Payment source_type: unknown
   Payment tender_types: []
Customer 9CE709PP621PNJZVYGJFRS119C already completed first payment
{"ts":"2025-12-05T00:06:34.931Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"75d86ae2-81bf-417b-9f54-3056e67502b6","stage":"payment","correlationId":"payment-updated:074f603b1f4d1d436fd0bfad"}
{"ts":"2025-12-05T00:06:35.234Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"a5eb41a5-3925-4d0a-a881-6a218df24052","stage":"payment","correlationId":"payment-updated:db049a036811bfd023ce19aa","attempts":1}
üí∞ Processing payment completion for customer: N60CZP4T697J8CQ505T2FW07M4
   Payment source_type: unknown
   Payment tender_types: []
Customer N60CZP4T697J8CQ505T2FW07M4 already completed first payment
{"ts":"2025-12-05T00:06:35.647Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"a5eb41a5-3925-4d0a-a881-6a218df24052","stage":"payment","correlationId":"payment-updated:db049a036811bfd023ce19aa"}
{"ts":"2025-12-05T00:06:36.005Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"7930cf84-dbc2-4ede-9bdc-b97f573ad9ee","stage":"payment","correlationId":"payment-updated:1718d66d82746e99bddf14f7","attempts":1}
üí∞ Processing payment completion for customer: 9M72Y57P3VDWDHPYN8YGNRGB1R
   Payment source_type: unknown
   Payment tender_types: []
Customer 9M72Y57P3VDWDHPYN8YGNRGB1R already completed first payment
{"ts":"2025-12-05T00:06:36.226Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"7930cf84-dbc2-4ede-9bdc-b97f573ad9ee","stage":"payment","correlationId":"payment-updated:1718d66d82746e99bddf14f7"}
{"ts":"2025-12-05T00:06:36.399Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"442c33d5-e9f6-41c8-89d2-434fba00bc46","stage":"payment","correlationId":"payment-updated:a83c6d99e93694f3c9984b1a","attempts":1}
üí∞ Processing payment completion for customer: 9M72Y57P3VDWDHPYN8YGNRGB1R
   Payment source_type: unknown
   Payment tender_types: []
Customer 9M72Y57P3VDWDHPYN8YGNRGB1R already completed first payment
{"ts":"2025-12-05T00:06:36.530Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"442c33d5-e9f6-41c8-89d2-434fba00bc46","stage":"payment","correlationId":"payment-updated:a83c6d99e93694f3c9984b1a"}
{"ts":"2025-12-05T00:06:36.689Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"8a49ad9b-74e0-45ac-94a7-c5867be70113","stage":"payment","correlationId":"payment-updated:8b681b0c07876659b879f6ee","attempts":1}
üí∞ Processing payment completion for customer: B1SD31A26YCWNJT9V2B4HGJCB0
   Payment source_type: unknown
   Payment tender_types: []
Customer B1SD31A26YCWNJT9V2B4HGJCB0 already completed first payment
{"ts":"2025-12-05T00:06:36.825Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"8a49ad9b-74e0-45ac-94a7-c5867be70113","stage":"payment","correlationId":"payment-updated:8b681b0c07876659b879f6ee"}
{"ts":"2025-12-05T00:06:36.986Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"091635bd-68cf-4648-abd7-4aa6fc6a468e","stage":"payment","correlationId":"payment-updated:95fc17c6f8c2234271bbf1f4","attempts":1}
üí∞ Processing payment completion for customer: 1CS3MY35Y6G59MFHGY5V7W5C88
   Payment source_type: unknown
   Payment tender_types: []
Customer 1CS3MY35Y6G59MFHGY5V7W5C88 already completed first payment
{"ts":"2025-12-05T00:06:37.120Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"091635bd-68cf-4648-abd7-4aa6fc6a468e","stage":"payment","correlationId":"payment-updated:95fc17c6f8c2234271bbf1f4"}
{"ts":"2025-12-05T00:06:37.279Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"4df5d963-9bd4-46e8-bc47-01eae9637a40","stage":"payment","correlationId":"payment-updated:114ed7f1799f3a0e50512d54","attempts":1}
üí∞ Processing payment completion for customer: RZHSEFFD8PVJ11762PDMZNC8XM
   Payment source_type: unknown
   Payment tender_types: []
Customer RZHSEFFD8PVJ11762PDMZNC8XM already completed first payment
{"ts":"2025-12-05T00:06:37.413Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"4df5d963-9bd4-46e8-bc47-01eae9637a40","stage":"payment","correlationId":"payment-updated:114ed7f1799f3a0e50512d54"}
{"ts":"2025-12-05T00:06:37.573Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"68bf563f-cc8c-4f60-b78e-387a041fcf0f","stage":"payment","correlationId":"payment-updated:801c6224be9f407a879cd32f","attempts":1}
üí∞ Processing payment completion for customer: YTBM2Q2XV23WW25KR2W25CF934
   Payment source_type: unknown
   Payment tender_types: []
Customer YTBM2Q2XV23WW25KR2W25CF934 already completed first payment
{"ts":"2025-12-05T00:06:37.709Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"68bf563f-cc8c-4f60-b78e-387a041fcf0f","stage":"payment","correlationId":"payment-updated:801c6224be9f407a879cd32f"}
{"ts":"2025-12-05T00:06:37.880Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"d741c616-6575-4a77-a787-ec62866bb14f","stage":"payment","correlationId":"payment-updated:11ec96e28a6de9d151108fec","attempts":1}
üí∞ Processing payment completion for customer: 86AGBRF7HSX1METR7ZKN0C5JPR
   Payment source_type: unknown
   Payment tender_types: []
Customer 86AGBRF7HSX1METR7ZKN0C5JPR already completed first payment
{"ts":"2025-12-05T00:06:38.021Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"d741c616-6575-4a77-a787-ec62866bb14f","stage":"payment","correlationId":"payment-updated:11ec96e28a6de9d151108fec"}
{"ts":"2025-12-05T00:06:38.180Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"477ff37e-fbcc-4dbf-bf1c-d293e810016e","stage":"payment","correlationId":"payment-updated:6da6c4a96230a8c83a781e63","attempts":1}
üí∞ Processing payment completion for customer: Q18M3GTWMST22CEPJRJCVMVWNG
   Payment source_type: unknown
   Payment tender_types: []
Customer Q18M3GTWMST22CEPJRJCVMVWNG already completed first payment
{"ts":"2025-12-05T00:06:38.313Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"477ff37e-fbcc-4dbf-bf1c-d293e810016e","stage":"payment","correlationId":"payment-updated:6da6c4a96230a8c83a781e63"}
{"ts":"2025-12-05T00:06:38.473Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"d8f2f0db-6309-4686-a150-c0bb5039869d","stage":"payment","correlationId":"payment-updated:dd7850463d698ab97d00f9d0","attempts":1}
üí∞ Processing payment completion for customer: ZF5Z9M6KY4064HBJBVTDSNEM44
   Payment source_type: unknown
   Payment tender_types: []
Customer ZF5Z9M6KY4064HBJBVTDSNEM44 already completed first payment
{"ts":"2025-12-05T00:06:38.606Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"d8f2f0db-6309-4686-a150-c0bb5039869d","stage":"payment","correlationId":"payment-updated:dd7850463d698ab97d00f9d0"}
{"ts":"2025-12-05T00:06:38.771Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"770fa8b8-908a-434a-b0df-6a6b87429e35","stage":"payment","correlationId":"payment-updated:e56c584d8c9352a3b0121920","attempts":1}
üí∞ Processing payment completion for customer: SBTMN68GMH0AB3YFW7R3FQ7VPW
   Payment source_type: unknown
   Payment tender_types: []
Customer SBTMN68GMH0AB3YFW7R3FQ7VPW already completed first payment
{"ts":"2025-12-05T00:06:38.914Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"770fa8b8-908a-434a-b0df-6a6b87429e35","stage":"payment","correlationId":"payment-updated:e56c584d8c9352a3b0121920"}
{"ts":"2025-12-05T00:06:39.080Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"bd8eb84c-c86a-4f3b-a4c6-867e7cc4a690","stage":"payment","correlationId":"payment-updated:f11c4cdadf13908f9bbc5b91","attempts":1}
üí∞ Processing payment completion for customer: Q4WSB4NTNXWG9HSTJ5NEEWSMYW
   Payment source_type: unknown
   Payment tender_types: []
Customer Q4WSB4NTNXWG9HSTJ5NEEWSMYW already completed first payment
{"ts":"2025-12-05T00:06:39.216Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"bd8eb84c-c86a-4f3b-a4c6-867e7cc4a690","stage":"payment","correlationId":"payment-updated:f11c4cdadf13908f9bbc5b91"}
{"ts":"2025-12-05T00:06:39.376Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"3e548ed7-33ed-4564-8f22-e31c5851f554","stage":"payment","correlationId":"payment-updated:48a437300da46633f8ad8e95","attempts":1}
üí∞ Processing payment completion for customer: AQJM14K5E90BB90WSPPYEMEN1R
   Payment source_type: unknown
   Payment tender_types: []
Customer AQJM14K5E90BB90WSPPYEMEN1R already completed first payment
{"ts":"2025-12-05T00:06:39.512Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"3e548ed7-33ed-4564-8f22-e31c5851f554","stage":"payment","correlationId":"payment-updated:48a437300da46633f8ad8e95"}
{"ts":"2025-12-05T00:06:39.671Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"76464572-5ba4-472f-a7f6-f954b7406953","stage":"payment","correlationId":"payment-updated:5e500277f328e77c046bc06a","attempts":1}
üí∞ Processing payment completion for customer: HDBQDJ6MGJW3NVX4VJCR28VYSM
   Payment source_type: unknown
   Payment tender_types: []
Customer HDBQDJ6MGJW3NVX4VJCR28VYSM already completed first payment
{"ts":"2025-12-05T00:06:39.804Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"76464572-5ba4-472f-a7f6-f954b7406953","stage":"payment","correlationId":"payment-updated:5e500277f328e77c046bc06a"}
{"ts":"2025-12-05T00:06:39.964Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"219e997f-0bd0-456b-a9ae-3cfe46259797","stage":"payment","correlationId":"payment-updated:7335bfc6140df213cf3690f5","attempts":1}
üí∞ Processing payment completion for customer: 9TPS15NVHPNSTA8VG282P50QRM
   Payment source_type: unknown
   Payment tender_types: []
Customer 9TPS15NVHPNSTA8VG282P50QRM already completed first payment
{"ts":"2025-12-05T00:06:40.100Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"219e997f-0bd0-456b-a9ae-3cfe46259797","stage":"payment","correlationId":"payment-updated:7335bfc6140df213cf3690f5"}
{"ts":"2025-12-05T00:06:40.261Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"0f418246-237d-4555-887f-31e904f5c73f","stage":"payment","correlationId":"payment-updated:08c6c312495855a7f73dc626","attempts":1}
üí∞ Processing payment completion for customer: 1K5VSMKX25H36NP1MR7GREP8M4
   Payment source_type: unknown
   Payment tender_types: []
Customer 1K5VSMKX25H36NP1MR7GREP8M4 already completed first payment
{"ts":"2025-12-05T00:06:40.394Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"0f418246-237d-4555-887f-31e904f5c73f","stage":"payment","correlationId":"payment-updated:08c6c312495855a7f73dc626"}
{"ts":"2025-12-05T00:06:40.561Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"4eaa4805-6963-455f-8bcd-f15153f496a3","stage":"payment","correlationId":"payment-updated:870be74190d74ca14b76c990","attempts":1}
üí∞ Processing payment completion for customer: VX4W3SJ6RTFDRQNK1TZJC1T19G
   Payment source_type: unknown
   Payment tender_types: []
Customer VX4W3SJ6RTFDRQNK1TZJC1T19G already completed first payment
{"ts":"2025-12-05T00:06:40.694Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"4eaa4805-6963-455f-8bcd-f15153f496a3","stage":"payment","correlationId":"payment-updated:870be74190d74ca14b76c990"}
{"ts":"2025-12-05T00:06:40.853Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"19f90817-5e58-4141-b663-c250e2db2b18","stage":"payment","correlationId":"payment-updated:c60bf514e3f6d06fb7f54373","attempts":1}
üí∞ Processing payment completion for customer: 853SMKGAWCW44FNR7MZ23FZBH8
   Payment source_type: unknown
   Payment tender_types: []
Customer 853SMKGAWCW44FNR7MZ23FZBH8 already completed first payment
{"ts":"2025-12-05T00:06:40.986Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"19f90817-5e58-4141-b663-c250e2db2b18","stage":"payment","correlationId":"payment-updated:c60bf514e3f6d06fb7f54373"}
{"ts":"2025-12-05T00:06:41.159Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"2eb8c92d-0841-46ff-aefb-7fce5f65505b","stage":"payment","correlationId":"payment-updated:0681ade0dabdf65176ce747e","attempts":1}
üí∞ Processing payment completion for customer: XTA6WFN33E8PDJ6W462ZJA21WG
   Payment source_type: unknown
   Payment tender_types: []
Customer XTA6WFN33E8PDJ6W462ZJA21WG already completed first payment
{"ts":"2025-12-05T00:06:41.294Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"2eb8c92d-0841-46ff-aefb-7fce5f65505b","stage":"payment","correlationId":"payment-updated:0681ade0dabdf65176ce747e"}
{"ts":"2025-12-05T00:06:41.453Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"4981037d-979c-44c7-96c2-8af0418a979e","stage":"payment","correlationId":"payment-updated:37c862430864cbf9553fff6d","attempts":1}
üí∞ Processing payment completion for customer: J3F8Z4VQPY70DDXFHFDB98CCZ4
   Payment source_type: unknown
   Payment tender_types: []
Customer J3F8Z4VQPY70DDXFHFDB98CCZ4 already completed first payment
{"ts":"2025-12-05T00:06:41.587Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"4981037d-979c-44c7-96c2-8af0418a979e","stage":"payment","correlationId":"payment-updated:37c862430864cbf9553fff6d"}
{"ts":"2025-12-05T00:06:41.747Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"32d8ad0e-30cc-41ad-a7af-ff2a050bfd18","stage":"payment","correlationId":"payment-updated:7914f621997dec59f73be8a4","attempts":1}
üí∞ Processing payment completion for customer: CARHXXDE2RDXJHRM93Y83V750G
   Payment source_type: unknown
   Payment tender_types: []
Customer CARHXXDE2RDXJHRM93Y83V750G already completed first payment
{"ts":"2025-12-05T00:06:41.889Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"32d8ad0e-30cc-41ad-a7af-ff2a050bfd18","stage":"payment","correlationId":"payment-updated:7914f621997dec59f73be8a4"}
{"ts":"2025-12-05T00:06:42.053Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"21ebb9e7-0203-40de-a649-3e3a2f035ac3","stage":"payment","correlationId":"payment-updated:f2cd41523963483328b44c85","attempts":1}
üí∞ Processing payment completion for customer: 5TYM9H2R3CNGP5YFR3YE9Y74J8
   Payment source_type: unknown
   Payment tender_types: []
Customer 5TYM9H2R3CNGP5YFR3YE9Y74J8 already completed first payment
{"ts":"2025-12-05T00:06:42.191Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"21ebb9e7-0203-40de-a649-3e3a2f035ac3","stage":"payment","correlationId":"payment-updated:f2cd41523963483328b44c85"}
{"ts":"2025-12-05T00:06:42.351Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"07394760-6239-4450-9da3-ccd733d71064","stage":"payment","correlationId":"payment-updated:500920de1886663fc59a9e17","attempts":1}
üí∞ Processing payment completion for customer: 3CW345RHSCDCZXH8T32XA2FGS8
   Payment source_type: unknown
   Payment tender_types: []
Customer 3CW345RHSCDCZXH8T32XA2FGS8 already completed first payment
{"ts":"2025-12-05T00:06:42.484Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"07394760-6239-4450-9da3-ccd733d71064","stage":"payment","correlationId":"payment-updated:500920de1886663fc59a9e17"}
{"ts":"2025-12-05T00:06:42.652Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"8f239afd-ac7c-4ed7-8993-7af10366cb91","stage":"payment","correlationId":"payment-updated:36f350ff8a0555e7f4597f20","attempts":1}
üí∞ Processing payment completion for customer: N7G5C5798X7V927ZW29PZ3BCF4
   Payment source_type: unknown
   Payment tender_types: []
Customer N7G5C5798X7V927ZW29PZ3BCF4 already completed first payment
{"ts":"2025-12-05T00:06:42.786Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"8f239afd-ac7c-4ed7-8993-7af10366cb91","stage":"payment","correlationId":"payment-updated:36f350ff8a0555e7f4597f20"}
{"ts":"2025-12-05T00:06:42.946Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"2ee6b4e1-f693-4847-bff4-7172f12a64fe","stage":"payment","correlationId":"payment-updated:1fc0b4dac133b79d57306724","attempts":1}
üí∞ Processing payment completion for customer: GN2VNDAW4AWKRKAARXHXBM0Z4C
   Payment source_type: unknown
   Payment tender_types: []
Customer GN2VNDAW4AWKRKAARXHXBM0Z4C already completed first payment
{"ts":"2025-12-05T00:06:43.082Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"2ee6b4e1-f693-4847-bff4-7172f12a64fe","stage":"payment","correlationId":"payment-updated:1fc0b4dac133b79d57306724"}
{"ts":"2025-12-05T00:06:43.243Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"0f099c5d-638b-49e7-89bb-ec2f3482910c","stage":"payment","correlationId":"payment-updated:b365b65c0bed609fa979554f","attempts":1}
üí∞ Processing payment completion for customer: P8F14M0HPR5KYEM70AH708K69W
   Payment source_type: unknown
   Payment tender_types: []
Customer P8F14M0HPR5KYEM70AH708K69W already completed first payment
{"ts":"2025-12-05T00:06:43.378Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"0f099c5d-638b-49e7-89bb-ec2f3482910c","stage":"payment","correlationId":"payment-updated:b365b65c0bed609fa979554f"}
{"ts":"2025-12-05T00:06:43.539Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"fa390538-67bd-4259-817e-836bd44029dc","stage":"payment","correlationId":"payment-updated:78c3608e4fa37ace677f7704","attempts":1}
üí∞ Processing payment completion for customer: XERB3P3EVSTPSZVRMX379F28R8
   Payment source_type: unknown
   Payment tender_types: []
Customer XERB3P3EVSTPSZVRMX379F28R8 already completed first payment
{"ts":"2025-12-05T00:06:43.671Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"fa390538-67bd-4259-817e-836bd44029dc","stage":"payment","correlationId":"payment-updated:78c3608e4fa37ace677f7704"}
{"ts":"2025-12-05T00:06:43.839Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"f12bb40f-6611-42dc-8cd5-2a11c5412dc6","stage":"payment","correlationId":"payment-updated:997c00c04add6f8ba3a835bd","attempts":1}
üí∞ Processing payment completion for customer: 4S77B84J2X58S9PRGRPEPC8XBM
   Payment source_type: unknown
   Payment tender_types: []
Customer 4S77B84J2X58S9PRGRPEPC8XBM already completed first payment
{"ts":"2025-12-05T00:06:43.975Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"f12bb40f-6611-42dc-8cd5-2a11c5412dc6","stage":"payment","correlationId":"payment-updated:997c00c04add6f8ba3a835bd"}
{"ts":"2025-12-05T00:06:44.141Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"30129e56-350d-4814-a839-f2fec2e9fbcb","stage":"payment","correlationId":"payment-updated:2d912f23b55b54d9bf18b5b1","attempts":1}
üí∞ Processing payment completion for customer: 028EB4QW8W716GTDSZ5MNXG8NC
   Payment source_type: unknown
   Payment tender_types: []
Customer 028EB4QW8W716GTDSZ5MNXG8NC already completed first payment
{"ts":"2025-12-05T00:06:44.275Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"30129e56-350d-4814-a839-f2fec2e9fbcb","stage":"payment","correlationId":"payment-updated:2d912f23b55b54d9bf18b5b1"}
{"ts":"2025-12-05T00:06:44.440Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"03a027df-4d01-4296-806c-3cafa99d6d36","stage":"payment","correlationId":"payment-updated:855555405aba2e2a563f27c6","attempts":1}
üí∞ Processing payment completion for customer: AQJM14K5E90BB90WSPPYEMEN1R
   Payment source_type: unknown
   Payment tender_types: []
Customer AQJM14K5E90BB90WSPPYEMEN1R already completed first payment
{"ts":"2025-12-05T00:06:44.576Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"03a027df-4d01-4296-806c-3cafa99d6d36","stage":"payment","correlationId":"payment-updated:855555405aba2e2a563f27c6"}
{"ts":"2025-12-05T00:06:44.750Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"b066c90c-fd9b-40ff-8bd6-781b43ae6cce","stage":"payment","correlationId":"payment-updated:d4cd1af6081cc3f6e5fdd2d2","attempts":1}
üí∞ Processing payment completion for customer: ET5W3RZZ5RKFX9G93C7CQB7HV0
   Payment source_type: unknown
   Payment tender_types: []
Customer ET5W3RZZ5RKFX9G93C7CQB7HV0 already completed first payment
{"ts":"2025-12-05T00:06:44.885Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"b066c90c-fd9b-40ff-8bd6-781b43ae6cce","stage":"payment","correlationId":"payment-updated:d4cd1af6081cc3f6e5fdd2d2"}
{"ts":"2025-12-05T00:06:45.048Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"6f0613b3-ceba-44e8-b471-38e46c4a13dc","stage":"payment","correlationId":"payment-updated:3beb824d2321e02916b11868","attempts":1}
üí∞ Processing payment completion for customer: JBSSXD662STDAD89DZ5Z33VTT8
   Payment source_type: unknown
   Payment tender_types: []
Customer JBSSXD662STDAD89DZ5Z33VTT8 already completed first payment
{"ts":"2025-12-05T00:06:45.234Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"6f0613b3-ceba-44e8-b471-38e46c4a13dc","stage":"payment","correlationId":"payment-updated:3beb824d2321e02916b11868"}
{"ts":"2025-12-05T00:06:45.397Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"9f0b1e06-858b-48ce-85b6-7d3ada396c1b","stage":"payment","correlationId":"payment-updated:c0459173f2074c03925fafb0","attempts":1}
üí∞ Processing payment completion for customer: JBSSXD662STDAD89DZ5Z33VTT8
   Payment source_type: unknown
   Payment tender_types: []
Customer JBSSXD662STDAD89DZ5Z33VTT8 already completed first payment
{"ts":"2025-12-05T00:06:45.532Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"9f0b1e06-858b-48ce-85b6-7d3ada396c1b","stage":"payment","correlationId":"payment-updated:c0459173f2074c03925fafb0"}
{"ts":"2025-12-05T00:06:45.711Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"a8614f9d-b536-478a-b9de-a2e6df020f5a","stage":"payment","correlationId":"payment-updated:1c5a8503563ea4a3f8536a59","attempts":1}
üí∞ Processing payment completion for customer: JBSSXD662STDAD89DZ5Z33VTT8
   Payment source_type: unknown
   Payment tender_types: []
Customer JBSSXD662STDAD89DZ5Z33VTT8 already completed first payment
{"ts":"2025-12-05T00:06:45.846Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"a8614f9d-b536-478a-b9de-a2e6df020f5a","stage":"payment","correlationId":"payment-updated:1c5a8503563ea4a3f8536a59"}
{"ts":"2025-12-05T00:06:46.011Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"a41af787-8de3-417c-b58c-fc10901844aa","stage":"payment","correlationId":"payment-updated:bb8af81167333c9007ac176f","attempts":1}
üí∞ Processing payment completion for customer: JBJGE76DFEY21177TXB682M734
   Payment source_type: unknown
   Payment tender_types: []
Customer JBJGE76DFEY21177TXB682M734 already completed first payment
{"ts":"2025-12-05T00:06:46.148Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"a41af787-8de3-417c-b58c-fc10901844aa","stage":"payment","correlationId":"payment-updated:bb8af81167333c9007ac176f"}
{"ts":"2025-12-05T00:06:46.309Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"96f5d48c-1d9b-4049-83eb-18f0243c540d","stage":"payment","correlationId":"payment-updated:fb5aa8830701009c7ab1bcac","attempts":1}
üí∞ Processing payment completion for customer: CMNCWJKJ9FF1W8G6N8XHA7935M
   Payment source_type: unknown
   Payment tender_types: []
Customer CMNCWJKJ9FF1W8G6N8XHA7935M already completed first payment
{"ts":"2025-12-05T00:06:46.442Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"96f5d48c-1d9b-4049-83eb-18f0243c540d","stage":"payment","correlationId":"payment-updated:fb5aa8830701009c7ab1bcac"}
{"ts":"2025-12-05T00:06:46.602Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"41c5c9ac-4c8f-41c9-a245-070de9e0a535","stage":"payment","correlationId":"payment-updated:62b4d7a85bc7d12822566df1","attempts":1}
üí∞ Processing payment completion for customer: C7MX9AVCFA37SKB6D8XHB2S3SC
   Payment source_type: unknown
   Payment tender_types: []
Customer C7MX9AVCFA37SKB6D8XHB2S3SC already completed first payment
{"ts":"2025-12-05T00:06:46.741Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"41c5c9ac-4c8f-41c9-a245-070de9e0a535","stage":"payment","correlationId":"payment-updated:62b4d7a85bc7d12822566df1"}
{"ts":"2025-12-05T00:06:46.902Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"1add824c-e127-4afe-8072-522ed8b8df94","stage":"payment","correlationId":"payment-updated:e8dbdd07cffa13e6086fd7c0","attempts":1}
üí∞ Processing payment completion for customer: V56R2CDR6R4Q85KE6KV4NRGXD0
   Payment source_type: unknown
   Payment tender_types: []
Customer V56R2CDR6R4Q85KE6KV4NRGXD0 already completed first payment
{"ts":"2025-12-05T00:06:47.050Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"1add824c-e127-4afe-8072-522ed8b8df94","stage":"payment","correlationId":"payment-updated:e8dbdd07cffa13e6086fd7c0"}
{"ts":"2025-12-05T00:06:47.213Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"2ac42d19-ffe0-42ba-975d-4ac523e9a229","stage":"payment","correlationId":"payment-updated:c420196dec63c2a28dd41301","attempts":1}
üí∞ Processing payment completion for customer: K54SN5QMHBJRR7D4B2K0716V24
   Payment source_type: unknown
   Payment tender_types: []
Customer K54SN5QMHBJRR7D4B2K0716V24 already completed first payment
{"ts":"2025-12-05T00:06:47.356Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"2ac42d19-ffe0-42ba-975d-4ac523e9a229","stage":"payment","correlationId":"payment-updated:c420196dec63c2a28dd41301"}
{"ts":"2025-12-05T00:06:47.516Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"ea2e54ee-7abb-4c4d-b38c-2153e83ab529","stage":"payment","correlationId":"payment-updated:25829b9d8b47551b1fad561e","attempts":1}
üí∞ Processing payment completion for customer: GKSQC7GCXB3BJ7A3QXC9WYSZVG
   Payment source_type: unknown
   Payment tender_types: []
Customer GKSQC7GCXB3BJ7A3QXC9WYSZVG already completed first payment
{"ts":"2025-12-05T00:06:47.780Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"ea2e54ee-7abb-4c4d-b38c-2153e83ab529","stage":"payment","correlationId":"payment-updated:25829b9d8b47551b1fad561e"}
{"ts":"2025-12-05T00:06:48.102Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"a6519ae6-6eee-4faa-b1cf-7cd62a6f7f89","stage":"payment","correlationId":"payment-updated:555c9ef0bdb35ba617f92109","attempts":1}
üí∞ Processing payment completion for customer: E5ZQZ7E7RHZKRW11G2HAVCN60M
   Payment source_type: unknown
   Payment tender_types: []
Customer E5ZQZ7E7RHZKRW11G2HAVCN60M already completed first payment
{"ts":"2025-12-05T00:06:48.526Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"a6519ae6-6eee-4faa-b1cf-7cd62a6f7f89","stage":"payment","correlationId":"payment-updated:555c9ef0bdb35ba617f92109"}
{"ts":"2025-12-05T00:06:48.766Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"34117a9b-944b-4012-9e38-e836b5ff4d1f","stage":"payment","correlationId":"payment-updated:f8a31f7ee6d0dd3cd65bbdaa","attempts":1}
üí∞ Processing payment completion for customer: 82K003M730Q31BH8JCWDHFRDYC
   Payment source_type: unknown
   Payment tender_types: []
Customer 82K003M730Q31BH8JCWDHFRDYC already completed first payment
{"ts":"2025-12-05T00:06:49.120Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"34117a9b-944b-4012-9e38-e836b5ff4d1f","stage":"payment","correlationId":"payment-updated:f8a31f7ee6d0dd3cd65bbdaa"}
{"ts":"2025-12-05T00:06:49.537Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"e0390f21-9700-4a6b-948e-a7e7b8356cf5","stage":"payment","correlationId":"payment-updated:ffb301fa8e1b7d2a7ede0ae1","attempts":1}
üí∞ Processing payment completion for customer: QKZ142XSZQKQMM4AKY35SKET3M
   Payment source_type: unknown
   Payment tender_types: []
Customer QKZ142XSZQKQMM4AKY35SKET3M already completed first payment
{"ts":"2025-12-05T00:06:49.942Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"e0390f21-9700-4a6b-948e-a7e7b8356cf5","stage":"payment","correlationId":"payment-updated:ffb301fa8e1b7d2a7ede0ae1"}
{"ts":"2025-12-05T00:06:50.277Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"99ccf386-84f0-4e4a-b3d2-238c5c8d2a55","stage":"payment","correlationId":"payment-updated:4e4633df0df1c9e51630161b","attempts":1}
üí∞ Processing payment completion for customer: HPGX3PGJ1FTZ83Z76H1ZDC14JW
   Payment source_type: unknown
   Payment tender_types: []
Customer HPGX3PGJ1FTZ83Z76H1ZDC14JW already completed first payment
{"ts":"2025-12-05T00:06:50.546Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"99ccf386-84f0-4e4a-b3d2-238c5c8d2a55","stage":"payment","correlationId":"payment-updated:4e4633df0df1c9e51630161b"}
{"ts":"2025-12-05T00:06:50.901Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"c2b48881-9b3b-46ec-80c9-2a4d45e46b2e","stage":"payment","correlationId":"payment-updated:5ed7d85a46d67f0bf8d42c69","attempts":1}
üí∞ Processing payment completion for customer: Z68BCYF3VWJM0YYQ6S0MYMFCAR
   Payment source_type: unknown
   Payment tender_types: []
Customer Z68BCYF3VWJM0YYQ6S0MYMFCAR already completed first payment
{"ts":"2025-12-05T00:06:51.066Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"c2b48881-9b3b-46ec-80c9-2a4d45e46b2e","stage":"payment","correlationId":"payment-updated:5ed7d85a46d67f0bf8d42c69"}
{"ts":"2025-12-05T00:06:51.251Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"a94a9f9f-18ab-4cb9-ac2d-5668203077e8","stage":"payment","correlationId":"payment-updated:8e572666ffa9308be07b91e7","attempts":1}
üí∞ Processing payment completion for customer: 9CKA0D9BXK4V7Q0F2SPRPX5JYM
   Payment source_type: unknown
   Payment tender_types: []
Customer 9CKA0D9BXK4V7Q0F2SPRPX5JYM already completed first payment
{"ts":"2025-12-05T00:06:51.394Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"a94a9f9f-18ab-4cb9-ac2d-5668203077e8","stage":"payment","correlationId":"payment-updated:8e572666ffa9308be07b91e7"}
{"ts":"2025-12-05T00:06:51.557Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"81073d28-a110-4951-a634-fcec3ca6cd5c","stage":"payment","correlationId":"payment-updated:c2b08d524e3c7b2f566b7d57","attempts":1}
üí∞ Processing payment completion for customer: XPKBCE5813V0WC51C7AR66DRJ4
   Payment source_type: unknown
   Payment tender_types: []
Customer XPKBCE5813V0WC51C7AR66DRJ4 already completed first payment
{"ts":"2025-12-05T00:06:51.862Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"81073d28-a110-4951-a634-fcec3ca6cd5c","stage":"payment","correlationId":"payment-updated:c2b08d524e3c7b2f566b7d57"}
{"ts":"2025-12-05T00:06:52.232Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"35381634-f460-4307-89fa-f2729451628c","stage":"payment","correlationId":"payment-updated:afb35e2051e15748c1d9091c","attempts":1}
üí∞ Processing payment completion for customer: Z4RBCQ7KPAJ4YE0C85EYGDNXA0
   Payment source_type: unknown
   Payment tender_types: []
Customer Z4RBCQ7KPAJ4YE0C85EYGDNXA0 already completed first payment
{"ts":"2025-12-05T00:06:52.499Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"35381634-f460-4307-89fa-f2729451628c","stage":"payment","correlationId":"payment-updated:afb35e2051e15748c1d9091c"}
{"ts":"2025-12-05T00:06:52.815Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"89fc305b-a831-4275-b3a3-28001ed507c2","stage":"payment","correlationId":"payment-updated:86faa64a338258a1805cf6b9","attempts":1}
üí∞ Processing payment completion for customer: XPKBCE5813V0WC51C7AR66DRJ4
   Payment source_type: unknown
   Payment tender_types: []
Customer XPKBCE5813V0WC51C7AR66DRJ4 already completed first payment
{"ts":"2025-12-05T00:06:53.361Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"89fc305b-a831-4275-b3a3-28001ed507c2","stage":"payment","correlationId":"payment-updated:86faa64a338258a1805cf6b9"}
{"ts":"2025-12-05T00:06:53.748Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"d7c08502-a7f8-4e75-ab1a-6f2dcf909bd1","stage":"payment","correlationId":"payment-updated:2a637c5eab7b24afb7c1b4f2","attempts":1}
üí∞ Processing payment completion for customer: VRC2G1PHS14ZBK37F5G5TZYT0M
   Payment source_type: unknown
   Payment tender_types: []
Customer VRC2G1PHS14ZBK37F5G5TZYT0M already completed first payment
{"ts":"2025-12-05T00:06:54.038Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"d7c08502-a7f8-4e75-ab1a-6f2dcf909bd1","stage":"payment","correlationId":"payment-updated:2a637c5eab7b24afb7c1b4f2"}
{"ts":"2025-12-05T00:06:54.376Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"c23c29de-d239-461a-8a26-5ff0c6f0c8e3","stage":"payment","correlationId":"payment-updated:eb560f1bd7bf6b1761b092c2","attempts":1}
üí∞ Processing payment completion for customer: Q897VDD6EPK48359WWJNBN2YSW
   Payment source_type: unknown
   Payment tender_types: []
Customer Q897VDD6EPK48359WWJNBN2YSW already completed first payment
{"ts":"2025-12-05T00:06:54.731Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"c23c29de-d239-461a-8a26-5ff0c6f0c8e3","stage":"payment","correlationId":"payment-updated:eb560f1bd7bf6b1761b092c2"}
{"ts":"2025-12-05T00:06:55.057Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"971023dd-93e2-4575-9ef0-e8a6d71e836d","stage":"payment","correlationId":"payment-updated:11c4e86cdff84e1f89c8773e","attempts":1}
üí∞ Processing payment completion for customer: BXBTYQN9H36QD43PBT3Q0QPWJR
   Payment source_type: unknown
   Payment tender_types: []
Customer BXBTYQN9H36QD43PBT3Q0QPWJR already completed first payment
{"ts":"2025-12-05T00:06:55.195Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"971023dd-93e2-4575-9ef0-e8a6d71e836d","stage":"payment","correlationId":"payment-updated:11c4e86cdff84e1f89c8773e"}
{"ts":"2025-12-05T00:06:55.354Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"45580096-03bc-4b61-9500-5f4b8d59a611","stage":"payment","correlationId":"payment-updated:76fa950700e0a13a1356bcf2","attempts":1}
üí∞ Processing payment completion for customer: MKJ6QJ202C3737YYZRZ4FNPH4R
   Payment source_type: unknown
   Payment tender_types: []
Customer MKJ6QJ202C3737YYZRZ4FNPH4R already completed first payment
{"ts":"2025-12-05T00:06:55.489Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"45580096-03bc-4b61-9500-5f4b8d59a611","stage":"payment","correlationId":"payment-updated:76fa950700e0a13a1356bcf2"}
{"ts":"2025-12-05T00:06:55.650Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"ad84e70b-d129-4c2a-966f-5c7e7dd2265e","stage":"payment","correlationId":"payment-updated:4debb7f8b182fc1f60e5959c","attempts":1}
üí∞ Processing payment completion for customer: 494KD02DD99MYHNCT5BYK0ZNZ8
   Payment source_type: unknown
   Payment tender_types: []
Customer 494KD02DD99MYHNCT5BYK0ZNZ8 already completed first payment
{"ts":"2025-12-05T00:06:55.783Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"ad84e70b-d129-4c2a-966f-5c7e7dd2265e","stage":"payment","correlationId":"payment-updated:4debb7f8b182fc1f60e5959c"}
{"ts":"2025-12-05T00:06:55.945Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"71026093-35c5-418c-b5e3-ea92ac58dae1","stage":"payment","correlationId":"payment-updated:c1883f2b18509aab7a230528","attempts":1}
üí∞ Processing payment completion for customer: Y7B4GKDBYW9PP9E91TCBEPW7Y0
   Payment source_type: unknown
   Payment tender_types: []
Customer Y7B4GKDBYW9PP9E91TCBEPW7Y0 already completed first payment
{"ts":"2025-12-05T00:06:56.087Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"71026093-35c5-418c-b5e3-ea92ac58dae1","stage":"payment","correlationId":"payment-updated:c1883f2b18509aab7a230528"}
{"ts":"2025-12-05T00:06:56.245Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"10be9b2d-c6d4-4337-9c2f-3e5b57c331f8","stage":"payment","correlationId":"payment-updated:991435d4c50f474d0528caf0","attempts":1}
üí∞ Processing payment completion for customer: KC2Q9C3SD6Q7RVFRDG70ZZYE4G
   Payment source_type: unknown
   Payment tender_types: []
Customer KC2Q9C3SD6Q7RVFRDG70ZZYE4G already completed first payment
{"ts":"2025-12-05T00:06:56.409Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"10be9b2d-c6d4-4337-9c2f-3e5b57c331f8","stage":"payment","correlationId":"payment-updated:991435d4c50f474d0528caf0"}
{"ts":"2025-12-05T00:06:56.591Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"8324100a-a6fb-4a0d-9ddd-664b923ad117","stage":"payment","correlationId":"payment-updated:6704471301a809cbdea226e7","attempts":1}
üí∞ Processing payment completion for customer: D3DY5V4MY6KJK47R1N60YZSE58
   Payment source_type: unknown
   Payment tender_types: []
Customer D3DY5V4MY6KJK47R1N60YZSE58 already completed first payment
{"ts":"2025-12-05T00:06:56.737Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"8324100a-a6fb-4a0d-9ddd-664b923ad117","stage":"payment","correlationId":"payment-updated:6704471301a809cbdea226e7"}
{"ts":"2025-12-05T00:06:56.893Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"b7c4980e-c9c3-4fd5-a310-ad452d50f523","stage":"payment","correlationId":"payment-updated:ac399355c61dcb53bda34ecd","attempts":1}
üí∞ Processing payment completion for customer: YXZV1Y70R4WWW0K67B6JXBR37W
   Payment source_type: unknown
   Payment tender_types: []
Customer YXZV1Y70R4WWW0K67B6JXBR37W already completed first payment
{"ts":"2025-12-05T00:06:57.028Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"b7c4980e-c9c3-4fd5-a310-ad452d50f523","stage":"payment","correlationId":"payment-updated:ac399355c61dcb53bda34ecd"}
{"ts":"2025-12-05T00:06:57.182Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"7de09331-3466-4e6a-b11c-f94d2dd08f19","stage":"payment","correlationId":"payment-updated:3e3c7ce68b6833b08cf2b223","attempts":1}
üí∞ Processing payment completion for customer: DHZ1B7SHTA4V6DPX92VZMA5JXC
   Payment source_type: unknown
   Payment tender_types: []
Customer DHZ1B7SHTA4V6DPX92VZMA5JXC already completed first payment
{"ts":"2025-12-05T00:06:57.310Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"7de09331-3466-4e6a-b11c-f94d2dd08f19","stage":"payment","correlationId":"payment-updated:3e3c7ce68b6833b08cf2b223"}
{"ts":"2025-12-05T00:06:57.471Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"6595959c-9c47-49e5-9022-d14a0e7ea26a","stage":"payment","correlationId":"payment-updated:c90cc8ddd8ab544387fc7b34","attempts":1}
üí∞ Processing payment completion for customer: B0GJFR8WR9H20EN067QT7RVMHM
   Payment source_type: unknown
   Payment tender_types: []
Customer B0GJFR8WR9H20EN067QT7RVMHM already completed first payment
{"ts":"2025-12-05T00:06:57.600Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"6595959c-9c47-49e5-9022-d14a0e7ea26a","stage":"payment","correlationId":"payment-updated:c90cc8ddd8ab544387fc7b34"}
{"ts":"2025-12-05T00:06:57.768Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"ff1c639a-8ca6-4fcf-8375-6b80b6e3ee76","stage":"payment","correlationId":"payment-updated:93ae11fad5f036d7c682d0df","attempts":1}
üí∞ Processing payment completion for customer: 0QM3FB1M39C6YTTNCYFDEC3A8M
   Payment source_type: unknown
   Payment tender_types: []
Customer 0QM3FB1M39C6YTTNCYFDEC3A8M already completed first payment
{"ts":"2025-12-05T00:06:57.897Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"ff1c639a-8ca6-4fcf-8375-6b80b6e3ee76","stage":"payment","correlationId":"payment-updated:93ae11fad5f036d7c682d0df"}
{"ts":"2025-12-05T00:06:58.059Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"8d8e0923-8783-4f72-8890-ad62bd3f5328","stage":"payment","correlationId":"payment-updated:80b6d51712da64da7c535290","attempts":1}
üí∞ Processing payment completion for customer: PDHZ3Q9EYX53K1RM10GKZRNY64
   Payment source_type: unknown
   Payment tender_types: []
Customer PDHZ3Q9EYX53K1RM10GKZRNY64 already completed first payment
{"ts":"2025-12-05T00:06:58.201Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"8d8e0923-8783-4f72-8890-ad62bd3f5328","stage":"payment","correlationId":"payment-updated:80b6d51712da64da7c535290"}
{"ts":"2025-12-05T00:06:58.359Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"09f7fea7-a8ee-4ad7-b93b-4f8c6f150e2d","stage":"payment","correlationId":"payment-updated:ba8c84bc38d009735d40a88d","attempts":1}
üí∞ Processing payment completion for customer: WS90HBE67QG5K5XCKFY9TK4B34
   Payment source_type: unknown
   Payment tender_types: []
Customer WS90HBE67QG5K5XCKFY9TK4B34 already completed first payment
{"ts":"2025-12-05T00:06:58.495Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"09f7fea7-a8ee-4ad7-b93b-4f8c6f150e2d","stage":"payment","correlationId":"payment-updated:ba8c84bc38d009735d40a88d"}
{"ts":"2025-12-05T00:06:58.681Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"86b0e675-89a1-4779-b8ed-5a6609802e39","stage":"payment","correlationId":"payment-updated:b29a5ce0552f431db520d326","attempts":1}
üí∞ Processing payment completion for customer: PHP1Q70HXKER5Y2EF1PJGYKRT0
   Payment source_type: unknown
   Payment tender_types: []
Customer PHP1Q70HXKER5Y2EF1PJGYKRT0 already completed first payment
{"ts":"2025-12-05T00:06:58.875Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"86b0e675-89a1-4779-b8ed-5a6609802e39","stage":"payment","correlationId":"payment-updated:b29a5ce0552f431db520d326"}
{"ts":"2025-12-05T00:06:59.044Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"6336c216-bfad-4062-9fa0-3e0ad7408949","stage":"payment","correlationId":"payment-updated:ef4efc3f8b4bbc1cfe1b7c5a","attempts":1}
üí∞ Processing payment completion for customer: Z8WQ0D379GAGBS621BEF9SYQN8
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Nicole Chernev
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Nicole Chernev, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Nicole Chernev
   - Email: nsmahlik@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: Z8WQ0D379GAGBS621BEF9SYQN8
{"ts":"2025-12-05T00:06:59.365Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"6336c216-bfad-4062-9fa0-3e0ad7408949","stage":"payment","correlationId":"payment-updated:ef4efc3f8b4bbc1cfe1b7c5a"}
{"ts":"2025-12-05T00:06:59.524Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"36b39f11-09b0-431b-a03d-34056baf95cc","stage":"payment","correlationId":"payment-updated:a98a640cd9928992744a071e","attempts":1}
üí∞ Processing payment completion for customer: Z8WQ0D379GAGBS621BEF9SYQN8
   Payment source_type: CARD
   Payment tender_types: []
Customer Z8WQ0D379GAGBS621BEF9SYQN8 already completed first payment
{"ts":"2025-12-05T00:06:59.686Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"36b39f11-09b0-431b-a03d-34056baf95cc","stage":"payment","correlationId":"payment-updated:a98a640cd9928992744a071e"}
{"ts":"2025-12-05T00:06:59.853Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"119e5007-0644-40e1-ba5a-bcbd50a8a6e8","stage":"payment","correlationId":"payment-updated:dd324bf6742719344c7babd6","attempts":1}
üí∞ Processing payment completion for customer: 9AE6KEDQPWVW8SW9RQ4BBNTHK8
   Payment source_type: CASH
   Payment tender_types: []
üéâ First payment completed for customer: Kinga Golabek
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Kinga Golabek, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Kinga Golabek
   - Email: kmgolabek@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: 9AE6KEDQPWVW8SW9RQ4BBNTHK8
{"ts":"2025-12-05T00:07:00.143Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"119e5007-0644-40e1-ba5a-bcbd50a8a6e8","stage":"payment","correlationId":"payment-updated:dd324bf6742719344c7babd6"}
{"ts":"2025-12-05T00:11:10.350Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"bf3bf325-f7b7-4e0c-8554-51ee9a092169","stage":"customer_ingest","correlationId":"customer-created:c28edb20c5bdb4c2f1951445","attempts":1}
üì• Received customer data: {
  "id": "BSTA6G6NBRS1CAGHFVDAY5GGN4",
  "address": {
    "country": "US"
  },
  "version": 0,
  "group_ids": [
    "LT4ZHFBQQYB2N.APPOINTMENTS"
  ],
  "created_at": "2025-12-05T00:11:06.791Z",
  "given_name": "Gillian",
  "updated_at": "2025-12-05T00:11:06Z",
  "family_name": "Reid",
  "preferences": {
    "email_unsubscribed": false
  },
  "phone_number": "+19258768889",
  "email_address": "gillianreid92@gmail.com",
  "creation_source": "APPOINTMENTS"
}
üë§ Processing customer creation: BSTA6G6NBRS1CAGHFVDAY5GGN4
üìç IP Address: unknown
üìß Email: gillianreid92@gmail.com
üìû Phone: +19258768889
üë§ Name: Gillian Reid
‚ö†Ô∏è Suspicious IP activity detected: unknown used by 146 customers
‚ö†Ô∏è Suspicious activity detected for customer BSTA6G6NBRS1CAGHFVDAY5GGN4, flagging for review
üéâ New customer detected: BSTA6G6NBRS1CAGHFVDAY5GGN4
‚úÖ Customer added to database as NEW (temporary mark)
   - Will check for referral code when they book
   - Will give gift card on first booking if code found
‚úÖ Verification: Customer found in DB: true
{"ts":"2025-12-05T00:11:10.948Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"bf3bf325-f7b7-4e0c-8554-51ee9a092169","stage":"customer_ingest","correlationId":"customer-created:c28edb20c5bdb4c2f1951445"}
{"ts":"2025-12-05T00:11:13.369Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"3c8e9ce9-3c17-4d5e-b2b1-e4031f246af0","stage":"booking","correlationId":"booking-created:a23ce94fad29659f8f80fbec","attempts":1}
üìÖ Processing booking created for customer: BSTA6G6NBRS1CAGHFVDAY5GGN4
Full booking data: {
  "id": "xnlclk75al5bra",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-11T00:00:00Z",
  "created_at": "2025-12-05T00:11:10Z",
  "updated_at": "2025-12-05T00:11:10Z",
  "customer_id": "BSTA6G6NBRS1CAGHFVDAY5GGN4",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "BSTA6G6NBRS1CAGHFVDAY5GGN4",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMSt73bSp59caRzt",
      "any_team_member": true,
      "duration_minutes": 140,
      "intermission_minutes": 0,
      "service_variation_id": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "service_variation_version": 1764783981722,
      "service_variation_client_id": "CJI5WHOAKSFTASYPJ4MSYZLS"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Gillian Reid
üéâ First booking detected for customer: BSTA6G6NBRS1CAGHFVDAY5GGN4
   Name: Gillian Reid
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer BSTA6G6NBRS1CAGHFVDAY5GGN4...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "fd306114-9968-4fe0-9bde-53f9bf837f39"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-12-05T00:11:10.005Z",
      "createdAt": "2025-12-05T00:11:10.005Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="fd306114-9968-4fe0-9bde-53f9bf837f39"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "fd306114-9968-4fe0-9bde-53f9bf837f39"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: BSTA6G6NBRS1CAGHFVDAY5GGN4
{"ts":"2025-12-05T00:11:14.140Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"3c8e9ce9-3c17-4d5e-b2b1-e4031f246af0","stage":"booking","correlationId":"booking-created:a23ce94fad29659f8f80fbec"}
{"ts":"2025-12-05T00:26:58.091Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"18e9650d-641f-417f-b031-7e9c28e8f649","stage":"booking","correlationId":"booking-created:592db825100121fa4cdfef40","attempts":1}
üìÖ Processing booking created for customer: NR74ABD2W5PBXC46R41B9HPA4M
Full booking data: {
  "id": "v5rrbw3ucme4ji",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2026-01-03T18:00:00Z",
  "created_at": "2025-12-05T00:26:55Z",
  "updated_at": "2025-12-05T00:26:55Z",
  "customer_id": "NR74ABD2W5PBXC46R41B9HPA4M",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "NR74ABD2W5PBXC46R41B9HPA4M",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMNW4SIF7tjp4oM_",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "BRSIGZFOWC6F4ERPKX3CODLU",
      "service_variation_version": 1764801478862,
      "service_variation_client_id": "BRSIGZFOWC6F4ERPKX3CODLU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Umit Rakhimbekova
üéâ First booking detected for customer: NR74ABD2W5PBXC46R41B9HPA4M
   Name: Umit Rakhimbekova
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer NR74ABD2W5PBXC46R41B9HPA4M...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:a3dde506-f69e-48e4-a98a-004c1822d3ad",
      "value": "ABY9108",
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-12-05T00:26:55.631Z",
      "createdAt": "2025-12-05T00:26:55.631Z"
    }
  ]
}
   üìã Custom attribute: key="square:a3dde506-f69e-48e4-a98a-004c1822d3ad", value="ABY9108"
   Custom attributes from Square: {
  "square:a3dde506-f69e-48e4-a98a-004c1822d3ad": "ABY9108"
}
   üîç Checking all custom attribute values for valid referral codes...
   üîç Checking custom attribute value: "ABY9108" (key: square:a3dde506-f69e-48e4-a98a-004c1822d3ad)
   üîç Looking up referral code in database: "ABY9108" (original: "ABY9108")
   ‚úÖ Found referrer with code "ABY9108": Aby Az
   üîç Database lookup result for "ABY9108": FOUND - Aby Az
   ‚úÖ Found referral code in custom attribute: square:a3dde506-f69e-48e4-a98a-004c1822d3ad = ABY9108
   ‚úÖ Referrer: Aby Az (Y4BV3AGY3NXYCK63PA4ZA2ZJ14)
   ‚úÖ Referrer has personal_code: ABY9108
   Final referral code result: ABY9108
üéÅ Customer used referral code: ABY9108
   üîç Looking up referral code in database: "ABY9108" (original: "ABY9108")
   ‚úÖ Found referrer with code "ABY9108": Aby Az
üë§ Found referrer: Aby Az
‚úÖ Created gift card for Umit Rakhimbekova: gftc:677725195c6d4a1987258ef1944523de
‚úÖ Activated gift card for Umit Rakhimbekova
   Activity ID: gcact_ef0bf7d934d54b259a53bc17704d581e
   Balance after activation: $10
‚úÖ Linked gift card gftc:677725195c6d4a1987258ef1944523de to customer NR74ABD2W5PBXC46R41B9HPA4M
   Gift card will now appear in customer's profile in Square
üìã Verification:
   State: ACTIVE
   Balance: $10
üìù Added gift card 7783325144423836 to customer NR74ABD2W5PBXC46R41B9HPA4M notes
‚ùå Failed to initialize APNs provider: TypeError: apn.Provider is not a constructor
    at getApnProvider (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/wallet/push-service.js:100:19)
    at sendWalletPassUpdate (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/wallet/push-service.js:130:20)
    at queueWalletPassUpdate (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/wallet/push-service.js:214:3)
    at createGiftCard (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/webhooks/giftcard-processors.js:721:7)
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async processBookingCreated (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/webhooks/giftcard-processors.js:1933:32)
    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:116:9)
‚úÖ Friend received $10 gift card IMMEDIATELY: gftc:677725195c6d4a1987258ef1944523de
   - Customer: Umit Rakhimbekova
   - Referrer: Aby Az
   - Next: When customer pays, referrer gets $10
üîó Generating wallet URL: https://www.zorinastudio-referral.com/api/wallet/pass/7783325144423836
   Base URL: https://www.zorinastudio-referral.com
   GAN: 7783325144423836
‚úÖ Gift card email sent to umit0912@icloud.com
‚úÖ Booking processing completed for customer: NR74ABD2W5PBXC46R41B9HPA4M
{"ts":"2025-12-05T00:27:02.021Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"18e9650d-641f-417f-b031-7e9c28e8f649","stage":"booking","correlationId":"booking-created:592db825100121fa4cdfef40"}
{"ts":"2025-12-05T00:35:15.051Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"7a89269f-c050-47bf-8b6f-5fd442ff6775","stage":"payment","correlationId":"payment-updated:e8d02bcceb33a40513f5d3d6","attempts":1}
üí∞ Processing payment completion for customer: Y48RCA72T404Q3MKNR208VB0G4
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Christine Ciszczon
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Christine Ciszczon, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Christine Ciszczon
   - Email: chicitimage@yahoo.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: Y48RCA72T404Q3MKNR208VB0G4
{"ts":"2025-12-05T00:35:15.792Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"7a89269f-c050-47bf-8b6f-5fd442ff6775","stage":"payment","correlationId":"payment-updated:e8d02bcceb33a40513f5d3d6"}
{"ts":"2025-12-05T00:35:20.205Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"c9b2c8ec-216d-440a-8009-e702a5279418","stage":"payment","correlationId":"payment-updated:bf59a5c98c14480b76efa263","attempts":1}
üí∞ Processing payment completion for customer: Y48RCA72T404Q3MKNR208VB0G4
   Payment source_type: CARD
   Payment tender_types: []
Customer Y48RCA72T404Q3MKNR208VB0G4 already completed first payment
{"ts":"2025-12-05T00:35:20.341Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"c9b2c8ec-216d-440a-8009-e702a5279418","stage":"payment","correlationId":"payment-updated:bf59a5c98c14480b76efa263"}
{"ts":"2025-12-05T00:41:30.982Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"eb941412-7e3d-47f4-8663-ab0e3521aa87","stage":"booking","correlationId":"booking-created:0b727efa55511c85263fa783","attempts":1}
üìÖ Processing booking created for customer: 6TWWZDDKY2RP6NG6E7SE6PJQ24
Full booking data: {
  "id": "y1alwht9elalyz",
  "source": "THIRD_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-18T21:50:00Z",
  "created_at": "2025-12-05T00:41:27Z",
  "updated_at": "2025-12-05T00:41:27Z",
  "customer_id": "6TWWZDDKY2RP6NG6E7SE6PJQ24",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "6TWWZDDKY2RP6NG6E7SE6PJQ24",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMyUMvTJIj2HrHSg",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "JMTK5M2CY2W7WEXSTAJKAJ35",
      "service_variation_version": 1764801478862,
      "service_variation_client_id": "JMTK5M2CY2W7WEXSTAJKAJ35"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Anastasia Voevodin
üéâ First booking detected for customer: 6TWWZDDKY2RP6NG6E7SE6PJQ24
   Name: Anastasia Voevodin
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 6TWWZDDKY2RP6NG6E7SE6PJQ24...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "0826aee4-d259-434d-be44-511ac61b3629"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-09-27T12:50:32.490Z",
      "createdAt": "2025-09-27T12:50:32.490Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="0826aee4-d259-434d-be44-511ac61b3629"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "0826aee4-d259-434d-be44-511ac61b3629"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 6TWWZDDKY2RP6NG6E7SE6PJQ24
{"ts":"2025-12-05T00:41:32.701Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"eb941412-7e3d-47f4-8663-ab0e3521aa87","stage":"booking","correlationId":"booking-created:0b727efa55511c85263fa783"}
{"ts":"2025-12-05T00:45:36.487Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"a2d64e8e-71a1-4903-a7ea-fd4de89073ac","stage":"booking","correlationId":"booking-created:1f55c980913f762ddf0cba00","attempts":1}
üìÖ Processing booking created for customer: NR74ABD2W5PBXC46R41B9HPA4M
Full booking data: {
  "id": "t7kxxousxpxulz",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-30T21:00:00Z",
  "created_at": "2025-12-05T00:45:32Z",
  "updated_at": "2025-12-05T00:45:32Z",
  "customer_id": "NR74ABD2W5PBXC46R41B9HPA4M",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "NR74ABD2W5PBXC46R41B9HPA4M",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "resource_ids": [
        "KAOXILA4CV7A23VRAACC4R66"
      ],
      "team_member_id": "TM7_r-KmvY9xjnEU",
      "any_team_member": false,
      "duration_minutes": 60,
      "intermission_minutes": 0,
      "service_variation_id": "SBE5XUATXRM76CBTT25HL2NZ",
      "service_variation_version": 1760895536505,
      "service_variation_client_id": "SBE5XUATXRM76CBTT25HL2NZ"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Umit Rakhimbekova
‚ÑπÔ∏è Customer NR74ABD2W5PBXC46R41B9HPA4M already received signup bonus, not first booking
{"ts":"2025-12-05T00:45:37.518Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"a2d64e8e-71a1-4903-a7ea-fd4de89073ac","stage":"booking","correlationId":"booking-created:1f55c980913f762ddf0cba00"}
{"ts":"2025-12-05T00:47:33.325Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"40e54a4b-c6af-4471-bada-d8f64cad2ec8","stage":"booking","correlationId":"booking-created:38601006be45412656788911","attempts":1}
üìÖ Processing booking created for customer: Q6KK68EVJVT95BYTRA6MNRJCF4
Full booking data: {
  "id": "u950jzuhndsc0h",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2026-01-03T21:00:00Z",
  "created_at": "2025-12-05T00:47:30Z",
  "updated_at": "2025-12-05T00:47:30Z",
  "customer_id": "Q6KK68EVJVT95BYTRA6MNRJCF4",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "Q6KK68EVJVT95BYTRA6MNRJCF4",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "resource_ids": [
        "KAOXILA4CV7A23VRAACC4R66"
      ],
      "team_member_id": "TMNW4SIF7tjp4oM_",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "63PG6RLS2NHWRD5JRXEC74HN",
      "service_variation_version": 1760895536505,
      "service_variation_client_id": "VZLZVOWNIEIWAQ47FX67GQS4"
    },
    {
      "team_member_id": "TMNW4SIF7tjp4oM_",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "BRSIGZFOWC6F4ERPKX3CODLU",
      "service_variation_version": 1764801478862,
      "service_variation_client_id": "BRSIGZFOWC6F4ERPKX3CODLU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Elizabeth Wilson
üéâ First booking detected for customer: Q6KK68EVJVT95BYTRA6MNRJCF4
   Name: Elizabeth Wilson
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer Q6KK68EVJVT95BYTRA6MNRJCF4...
   Full custom attributes response: {}
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: Q6KK68EVJVT95BYTRA6MNRJCF4
{"ts":"2025-12-05T00:47:34.125Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"40e54a4b-c6af-4471-bada-d8f64cad2ec8","stage":"booking","correlationId":"booking-created:38601006be45412656788911"}
{"ts":"2025-12-05T01:01:13.797Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"a92e90c3-1e89-44da-a50f-edc79b7491b0","stage":"payment","correlationId":"payment-updated:bbfb09aba03dc6e950b88634","attempts":1}
üí∞ Processing payment completion for customer: VQ40QAEXD3FTSMHEA8VTRRJS34
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Claire Saint-Donat
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Claire Saint-Donat, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Claire Saint-Donat
   - Email: clairesaintdonat@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: VQ40QAEXD3FTSMHEA8VTRRJS34
{"ts":"2025-12-05T01:01:14.367Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"a92e90c3-1e89-44da-a50f-edc79b7491b0","stage":"payment","correlationId":"payment-updated:bbfb09aba03dc6e950b88634"}
{"ts":"2025-12-05T01:01:21.440Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"78abf178-fc8f-4ec0-acc1-d56c61eacfc9","stage":"payment","correlationId":"payment-updated:068a8e640d74704e2c5322f4","attempts":1}
üí∞ Processing payment completion for customer: VQ40QAEXD3FTSMHEA8VTRRJS34
   Payment source_type: CARD
   Payment tender_types: []
Customer VQ40QAEXD3FTSMHEA8VTRRJS34 already completed first payment
{"ts":"2025-12-05T01:01:21.732Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"78abf178-fc8f-4ec0-acc1-d56c61eacfc9","stage":"payment","correlationId":"payment-updated:068a8e640d74704e2c5322f4"}
{"ts":"2025-12-05T01:08:17.062Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"b90f8bee-8d6d-45c5-8359-afe496d2dfcb","stage":"payment","correlationId":"payment-updated:6c89c530193bddce7bc85e1d","attempts":1}
üí∞ Processing payment completion for customer: 595G2DQ37GHB99DDRADN67HPT8
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: null null
‚ùå Referrer not found for code: null
‚úÖ First payment processing completed for customer: 595G2DQ37GHB99DDRADN67HPT8
{"ts":"2025-12-05T01:08:17.559Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"b90f8bee-8d6d-45c5-8359-afe496d2dfcb","stage":"payment","correlationId":"payment-updated:6c89c530193bddce7bc85e1d"}
{"ts":"2025-12-05T01:08:21.990Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"b47c23b9-ea4f-41d1-9400-0f0810775c5f","stage":"payment","correlationId":"payment-updated:c71378debdc5a6481d1a72c4","attempts":1}
üí∞ Processing payment completion for customer: 595G2DQ37GHB99DDRADN67HPT8
   Payment source_type: CARD
   Payment tender_types: []
Customer 595G2DQ37GHB99DDRADN67HPT8 already completed first payment
{"ts":"2025-12-05T01:08:22.126Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"b47c23b9-ea4f-41d1-9400-0f0810775c5f","stage":"payment","correlationId":"payment-updated:c71378debdc5a6481d1a72c4"}
{"ts":"2025-12-05T01:10:42.484Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"d1d81d52-8400-4b0f-bd7a-b1cae7c6c5b6","stage":"payment","correlationId":"payment-updated:f1d5e53f4d2144d53c41c41b","attempts":1}
üí∞ Processing payment completion for customer: AJ7SYMKPAJ0M4Z521WMYPRPV2C
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Elisabeth Ostrow
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Elisabeth Ostrow, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Elisabeth Ostrow
   - Email: eostrow@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: AJ7SYMKPAJ0M4Z521WMYPRPV2C
{"ts":"2025-12-05T01:10:43.789Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"d1d81d52-8400-4b0f-bd7a-b1cae7c6c5b6","stage":"payment","correlationId":"payment-updated:f1d5e53f4d2144d53c41c41b"}
{"ts":"2025-12-05T01:10:46.294Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"80bd9522-9baf-4ad4-b5fa-b1aa212bf935","stage":"payment","correlationId":"payment-updated:87bfc510291c4c55d075a86a","attempts":1}
üí∞ Processing payment completion for customer: AJ7SYMKPAJ0M4Z521WMYPRPV2C
   Payment source_type: CARD
   Payment tender_types: []
Customer AJ7SYMKPAJ0M4Z521WMYPRPV2C already completed first payment
{"ts":"2025-12-05T01:10:46.433Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"80bd9522-9baf-4ad4-b5fa-b1aa212bf935","stage":"payment","correlationId":"payment-updated:87bfc510291c4c55d075a86a"}
{"ts":"2025-12-05T01:11:06.371Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"4a0be124-c8fd-40af-953b-9ec0a8db8467","stage":"payment","correlationId":"payment-updated:f7b1b65ee269dcb5bbe9f485","attempts":1}
üí∞ Processing payment completion for customer: AJ7SYMKPAJ0M4Z521WMYPRPV2C
   Payment source_type: CARD
   Payment tender_types: []
Customer AJ7SYMKPAJ0M4Z521WMYPRPV2C already completed first payment
{"ts":"2025-12-05T01:11:06.617Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"4a0be124-c8fd-40af-953b-9ec0a8db8467","stage":"payment","correlationId":"payment-updated:f7b1b65ee269dcb5bbe9f485"}
{"ts":"2025-12-05T01:11:11.068Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"79eb8482-7d15-49db-b771-064f0b6b111c","stage":"payment","correlationId":"payment-updated:33f34e87e5aaa22997627f7a","attempts":1}
üí∞ Processing payment completion for customer: AJ7SYMKPAJ0M4Z521WMYPRPV2C
   Payment source_type: CARD
   Payment tender_types: []
Customer AJ7SYMKPAJ0M4Z521WMYPRPV2C already completed first payment
{"ts":"2025-12-05T01:11:11.205Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"79eb8482-7d15-49db-b771-064f0b6b111c","stage":"payment","correlationId":"payment-updated:33f34e87e5aaa22997627f7a"}
{"ts":"2025-12-05T01:11:43.176Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"49e58f70-ef95-4cbe-8245-2a724db70373","stage":"payment","correlationId":"payment-updated:430e3707d76c921312704981","attempts":1}
üí∞ Processing payment completion for customer: 4CQQSXSF1N0XCVC1GGK8XDZZW4
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Isabel Markl
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Isabel Markl, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Isabel Markl
   - Email: idcmphd@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: 4CQQSXSF1N0XCVC1GGK8XDZZW4
{"ts":"2025-12-05T01:11:44.234Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"49e58f70-ef95-4cbe-8245-2a724db70373","stage":"payment","correlationId":"payment-updated:430e3707d76c921312704981"}
{"ts":"2025-12-05T01:11:48.984Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"093a91bf-71e0-4d73-ba42-6915383053ef","stage":"payment","correlationId":"payment-updated:0230b8bbea517f96f2499f05","attempts":1}
üí∞ Processing payment completion for customer: 4CQQSXSF1N0XCVC1GGK8XDZZW4
   Payment source_type: CARD
   Payment tender_types: []
Customer 4CQQSXSF1N0XCVC1GGK8XDZZW4 already completed first payment
{"ts":"2025-12-05T01:11:49.192Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"093a91bf-71e0-4d73-ba42-6915383053ef","stage":"payment","correlationId":"payment-updated:0230b8bbea517f96f2499f05"}
{"ts":"2025-12-05T01:12:04.733Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"c8c10381-fc8f-46e6-a2b5-a2654671b449","stage":"payment","correlationId":"payment-updated:cabfdd499d81d633f605a416","attempts":1}
üí∞ Processing payment completion for customer: 4CQQSXSF1N0XCVC1GGK8XDZZW4
   Payment source_type: CARD
   Payment tender_types: []
Customer 4CQQSXSF1N0XCVC1GGK8XDZZW4 already completed first payment
{"ts":"2025-12-05T01:12:05.075Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"c8c10381-fc8f-46e6-a2b5-a2654671b449","stage":"payment","correlationId":"payment-updated:cabfdd499d81d633f605a416"}
{"ts":"2025-12-05T01:12:07.378Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"01eac77f-b21f-4a68-bfe8-4a5c8d8dfd07","stage":"payment","correlationId":"payment-updated:b0580f9b8f344dcb140b532f","attempts":1}
üí∞ Processing payment completion for customer: 4CQQSXSF1N0XCVC1GGK8XDZZW4
   Payment source_type: CARD
   Payment tender_types: []
Customer 4CQQSXSF1N0XCVC1GGK8XDZZW4 already completed first payment
{"ts":"2025-12-05T01:12:07.642Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"01eac77f-b21f-4a68-bfe8-4a5c8d8dfd07","stage":"payment","correlationId":"payment-updated:b0580f9b8f344dcb140b532f"}
{"ts":"2025-12-05T01:44:51.575Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"66794536-6b9f-47e0-95a1-e757b32d90fc","stage":"payment","correlationId":"payment-updated:30eb9aa66898a0da13eb5c8f","attempts":1}
üí∞ Processing payment completion for customer: 2SX68C3DRQJAE79NHJ12F75KKM
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Michelle Onweller
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Michelle Onweller, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Michelle Onweller
   - Email: mlynnonweller@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: 2SX68C3DRQJAE79NHJ12F75KKM
{"ts":"2025-12-05T01:44:52.121Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"66794536-6b9f-47e0-95a1-e757b32d90fc","stage":"payment","correlationId":"payment-updated:30eb9aa66898a0da13eb5c8f"}
{"ts":"2025-12-05T01:44:56.531Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"f5b8d3f5-3bca-4d36-8515-8e91c44e2cfc","stage":"payment","correlationId":"payment-updated:458efd99a34c2e7f4265df70","attempts":1}
üí∞ Processing payment completion for customer: 2SX68C3DRQJAE79NHJ12F75KKM
   Payment source_type: CARD
   Payment tender_types: []
Customer 2SX68C3DRQJAE79NHJ12F75KKM already completed first payment
{"ts":"2025-12-05T01:44:56.662Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"f5b8d3f5-3bca-4d36-8515-8e91c44e2cfc","stage":"payment","correlationId":"payment-updated:458efd99a34c2e7f4265df70"}
{"ts":"2025-12-05T01:55:22.983Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"1e4ba08b-d6c4-4681-8458-b7a5babee0c8","stage":"payment","correlationId":"payment-updated:55c5480ecd052e4aaed11d96","attempts":1}
üí∞ Processing payment completion for customer: QKEAMK5KJ90Z758QGZMQH3VKVC
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Martine Zadno
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Martine Zadno, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Martine Zadno
   - Email: rzadno@yahoo.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: QKEAMK5KJ90Z758QGZMQH3VKVC
{"ts":"2025-12-05T01:55:23.692Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"1e4ba08b-d6c4-4681-8458-b7a5babee0c8","stage":"payment","correlationId":"payment-updated:55c5480ecd052e4aaed11d96"}
{"ts":"2025-12-05T01:55:28.503Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"49cb1cfd-7c6f-403d-8f3c-190ed7934db5","stage":"payment","correlationId":"payment-updated:97f09956580dbe5c92fd8aaa","attempts":1}
üí∞ Processing payment completion for customer: QKEAMK5KJ90Z758QGZMQH3VKVC
   Payment source_type: CARD
   Payment tender_types: []
Customer QKEAMK5KJ90Z758QGZMQH3VKVC already completed first payment
{"ts":"2025-12-05T01:55:28.641Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"49cb1cfd-7c6f-403d-8f3c-190ed7934db5","stage":"payment","correlationId":"payment-updated:97f09956580dbe5c92fd8aaa"}
{"ts":"2025-12-05T02:09:27.918Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"52cbe13e-5fb1-4e51-9cf8-25e9be74385d","stage":"payment","correlationId":"payment-updated:0ffc4e48868ba8eb4f2532e7","attempts":1}
üí∞ Processing payment completion for customer: HYZVWGZQCGRQTFNMAM46WZS7S4
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Claire Shorall
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Claire Shorall, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Claire Shorall
   - Email: cklshorall@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: HYZVWGZQCGRQTFNMAM46WZS7S4
{"ts":"2025-12-05T02:09:28.730Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"52cbe13e-5fb1-4e51-9cf8-25e9be74385d","stage":"payment","correlationId":"payment-updated:0ffc4e48868ba8eb4f2532e7"}
{"ts":"2025-12-05T02:09:33.167Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"6be1ece9-c6b0-49b3-9b67-c65b24c0f795","stage":"payment","correlationId":"payment-updated:cb90bae15fd338996872a908","attempts":1}
üí∞ Processing payment completion for customer: HYZVWGZQCGRQTFNMAM46WZS7S4
   Payment source_type: CARD
   Payment tender_types: []
Customer HYZVWGZQCGRQTFNMAM46WZS7S4 already completed first payment
{"ts":"2025-12-05T02:09:33.368Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"6be1ece9-c6b0-49b3-9b67-c65b24c0f795","stage":"payment","correlationId":"payment-updated:cb90bae15fd338996872a908"}
{"ts":"2025-12-05T02:15:21.916Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"a92cda7f-f389-4b61-b587-7069df39aecc","stage":"booking","correlationId":"booking-created:b78c5a48354a4cb6d8b3a34a","attempts":1}
üìÖ Processing booking created for customer: K7XJ2JVM64SNZC3GBPQB0RQ6MG
Full booking data: {
  "id": "92jjf1sat8e2tx",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-25T01:30:00Z",
  "created_at": "2025-12-05T02:15:18Z",
  "updated_at": "2025-12-05T02:15:18Z",
  "customer_id": "K7XJ2JVM64SNZC3GBPQB0RQ6MG",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMaVpirfZhWw5oM-"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMgsjtuk5cfKnstq",
      "any_team_member": false,
      "duration_minutes": 150,
      "intermission_minutes": 0,
      "service_variation_id": "FKVQUFGSG7BFA55SUPGKTCWF",
      "service_variation_version": 1760141204155,
      "service_variation_client_id": "FKVQUFGSG7BFA55SUPGKTCWF"
    },
    {
      "team_member_id": "TMgsjtuk5cfKnstq",
      "any_team_member": false,
      "duration_minutes": 20,
      "intermission_minutes": 0,
      "service_variation_id": "HAJX45W3U2WUCCXM5MI24UEE",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "HAJX45W3U2WUCCXM5MI24UEE"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Zlata sparrow
üéâ First booking detected for customer: K7XJ2JVM64SNZC3GBPQB0RQ6MG
   Name: Zlata sparrow
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer K7XJ2JVM64SNZC3GBPQB0RQ6MG...
   Full custom attributes response: {}
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: K7XJ2JVM64SNZC3GBPQB0RQ6MG
{"ts":"2025-12-05T02:15:22.928Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"a92cda7f-f389-4b61-b587-7069df39aecc","stage":"booking","correlationId":"booking-created:b78c5a48354a4cb6d8b3a34a"}
{"ts":"2025-12-05T02:15:44.927Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"40801f6a-121c-4037-b390-c0b810259181","stage":"payment","correlationId":"payment-updated:fc159617bce09beb24cc829b","attempts":1}
üí∞ Processing payment completion for customer: 3SSC4PMMKFM6V6676KKECKFZVG
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Alexandra Palatianos
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Alexandra Palatianos, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Alexandra Palatianos
   - Email: aspalatianos@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: 3SSC4PMMKFM6V6676KKECKFZVG
{"ts":"2025-12-05T02:15:45.821Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"40801f6a-121c-4037-b390-c0b810259181","stage":"payment","correlationId":"payment-updated:fc159617bce09beb24cc829b"}
{"ts":"2025-12-05T02:15:50.951Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"7b790fa1-3086-40a4-a5b6-1d0d38cf3a7d","stage":"payment","correlationId":"payment-updated:9b2b542d85797342616c510a","attempts":1}
üí∞ Processing payment completion for customer: 3SSC4PMMKFM6V6676KKECKFZVG
   Payment source_type: CARD
   Payment tender_types: []
Customer 3SSC4PMMKFM6V6676KKECKFZVG already completed first payment
{"ts":"2025-12-05T02:15:51.345Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"7b790fa1-3086-40a4-a5b6-1d0d38cf3a7d","stage":"payment","correlationId":"payment-updated:9b2b542d85797342616c510a"}
{"ts":"2025-12-05T02:17:54.826Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"a37ef691-236e-4149-bdd3-49b73dc84cf4","stage":"booking","correlationId":"booking-created:439b011a11960440a3534933","attempts":1}
üìÖ Processing booking created for customer: QT6MRRZ4H62DPHJ9369BBJ2VGC
Full booking data: {
  "id": "q06atjr16gs6ja",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-13T21:00:00Z",
  "created_at": "2025-12-05T02:17:50Z",
  "updated_at": "2025-12-05T02:17:50Z",
  "customer_id": "QT6MRRZ4H62DPHJ9369BBJ2VGC",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "QT6MRRZ4H62DPHJ9369BBJ2VGC",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMNW4SIF7tjp4oM_",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "BRSIGZFOWC6F4ERPKX3CODLU",
      "service_variation_version": 1764801478862,
      "service_variation_client_id": "BRSIGZFOWC6F4ERPKX3CODLU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Alex Elliott
üéâ First booking detected for customer: QT6MRRZ4H62DPHJ9369BBJ2VGC
   Name: Alex Elliott
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer QT6MRRZ4H62DPHJ9369BBJ2VGC...
   Full custom attributes response: {}
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: QT6MRRZ4H62DPHJ9369BBJ2VGC
{"ts":"2025-12-05T02:17:55.368Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"a37ef691-236e-4149-bdd3-49b73dc84cf4","stage":"booking","correlationId":"booking-created:439b011a11960440a3534933"}
{"ts":"2025-12-05T02:18:35.410Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"20554d78-cb8b-4969-b4bd-7500a78e37ea","stage":"booking","correlationId":"booking-created:d5680668b984c8cfc3cea046","attempts":1}
üìÖ Processing booking created for customer: QT6MRRZ4H62DPHJ9369BBJ2VGC
Full booking data: {
  "id": "mzv9lz1skwifx1",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2026-01-02T18:30:00Z",
  "created_at": "2025-12-05T02:18:32Z",
  "updated_at": "2025-12-05T02:18:32Z",
  "customer_id": "QT6MRRZ4H62DPHJ9369BBJ2VGC",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "QT6MRRZ4H62DPHJ9369BBJ2VGC",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMNW4SIF7tjp4oM_",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "BRSIGZFOWC6F4ERPKX3CODLU",
      "service_variation_version": 1764801478862,
      "service_variation_client_id": "BRSIGZFOWC6F4ERPKX3CODLU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Alex Elliott
üéâ First booking detected for customer: QT6MRRZ4H62DPHJ9369BBJ2VGC
   Name: Alex Elliott
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer QT6MRRZ4H62DPHJ9369BBJ2VGC...
   Full custom attributes response: {}
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: QT6MRRZ4H62DPHJ9369BBJ2VGC
{"ts":"2025-12-05T02:18:36.482Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"20554d78-cb8b-4969-b4bd-7500a78e37ea","stage":"booking","correlationId":"booking-created:d5680668b984c8cfc3cea046"}
{"ts":"2025-12-05T02:21:57.309Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"c1a37e85-2e2b-45c0-a9ed-6caa506620b3","stage":"booking","correlationId":"booking-created:e82f12da0fc770517a405126","attempts":1}
üìÖ Processing booking created for customer: 7GXDB012S89XNP8SFWC58T27AC
Full booking data: {
  "id": "6k9aaw2donorah",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-08T20:40:00Z",
  "created_at": "2025-12-05T02:21:55Z",
  "updated_at": "2025-12-05T02:21:55Z",
  "customer_id": "7GXDB012S89XNP8SFWC58T27AC",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "7GXDB012S89XNP8SFWC58T27AC",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMMHlgFBIFbMTRap",
      "any_team_member": false,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1758921239397,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Whitney McLaughlin
üéâ First booking detected for customer: 7GXDB012S89XNP8SFWC58T27AC
   Name: Whitney McLaughlin
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 7GXDB012S89XNP8SFWC58T27AC...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "a7b40271-729a-41aa-801b-fb1fffb83650"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-04-27T19:29:08.629Z",
      "createdAt": "2025-04-27T19:29:08.629Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="a7b40271-729a-41aa-801b-fb1fffb83650"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "a7b40271-729a-41aa-801b-fb1fffb83650"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 7GXDB012S89XNP8SFWC58T27AC
{"ts":"2025-12-05T02:21:57.941Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"c1a37e85-2e2b-45c0-a9ed-6caa506620b3","stage":"booking","correlationId":"booking-created:e82f12da0fc770517a405126"}
{"ts":"2025-12-05T02:25:42.971Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"e26bdba1-6653-44ca-bea5-d5d5fcd9cb45","stage":"booking","correlationId":"booking-created:01e8e1180413efd8fd7eeead","attempts":1}
üìÖ Processing booking created for customer: ZF2EJM26DMRS4ZN29MR8XGMVR0
Full booking data: {
  "id": "7xz6dpm2z9ofhh",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-05T19:00:00Z",
  "created_at": "2025-12-05T02:25:40Z",
  "updated_at": "2025-12-05T02:25:40Z",
  "customer_id": "ZF2EJM26DMRS4ZN29MR8XGMVR0",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMWAtQTYmZpwwxii"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMoZGdZlg-iKWTDu",
      "any_team_member": false,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1764609601083,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Olga Svatikova
üéâ First booking detected for customer: ZF2EJM26DMRS4ZN29MR8XGMVR0
   Name: Olga Svatikova
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer ZF2EJM26DMRS4ZN29MR8XGMVR0...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "sq0idp-0WpGrONcXfCcfav3Lkd9Jg:appointments-online-booking-blocking",
      "value": false,
      "version": 2,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-10-06T04:25:52.884Z",
      "createdAt": "2025-10-04T19:50:23.893Z"
    },
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "af5791f8-348a-422e-98d1-5e865121bb19"
      ],
      "version": 2,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-07-01T23:42:57.436Z",
      "createdAt": "2025-07-01T23:42:57.055Z"
    }
  ]
}
   üìã Custom attribute: key="sq0idp-0WpGrONcXfCcfav3Lkd9Jg:appointments-online-booking-blocking", value="false"
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="af5791f8-348a-422e-98d1-5e865121bb19"
   Custom attributes from Square: {
  "sq0idp-0WpGrONcXfCcfav3Lkd9Jg:appointments-online-booking-blocking": false,
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "af5791f8-348a-422e-98d1-5e865121bb19"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: ZF2EJM26DMRS4ZN29MR8XGMVR0
{"ts":"2025-12-05T02:25:43.894Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"e26bdba1-6653-44ca-bea5-d5d5fcd9cb45","stage":"booking","correlationId":"booking-created:01e8e1180413efd8fd7eeead"}
{"ts":"2025-12-05T02:31:46.463Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"c2f45267-9449-4d91-80fd-889ea33ce437","stage":"booking","correlationId":"booking-created:46060bc3643796194655b6e9","attempts":1}
üìÖ Processing booking created for customer: QT6MRRZ4H62DPHJ9369BBJ2VGC
Full booking data: {
  "id": "z9m1gorzyw0pb7",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2026-01-03T18:00:00Z",
  "created_at": "2025-12-05T02:31:43Z",
  "updated_at": "2025-12-05T02:31:43Z",
  "customer_id": "QT6MRRZ4H62DPHJ9369BBJ2VGC",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "QT6MRRZ4H62DPHJ9369BBJ2VGC",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMNW4SIF7tjp4oM_",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "BRSIGZFOWC6F4ERPKX3CODLU",
      "service_variation_version": 1764801478862,
      "service_variation_client_id": "BRSIGZFOWC6F4ERPKX3CODLU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Alex Elliott
üéâ First booking detected for customer: QT6MRRZ4H62DPHJ9369BBJ2VGC
   Name: Alex Elliott
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer QT6MRRZ4H62DPHJ9369BBJ2VGC...
   Full custom attributes response: {}
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: QT6MRRZ4H62DPHJ9369BBJ2VGC
{"ts":"2025-12-05T02:31:47.828Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"c2f45267-9449-4d91-80fd-889ea33ce437","stage":"booking","correlationId":"booking-created:46060bc3643796194655b6e9"}
{"ts":"2025-12-05T02:31:50.494Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"ab83fb99-f121-4b30-8198-fd426b4370a7","stage":"booking","correlationId":"booking-created:bec5dbda646979b31e3a26ef","attempts":1}
üìÖ Processing booking created for customer: B1SD31A26YCWNJT9V2B4HGJCB0
Full booking data: {
  "id": "2nkc2l0ginsi4n",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-29T20:00:00Z",
  "created_at": "2025-12-05T02:31:48Z",
  "updated_at": "2025-12-05T02:31:48Z",
  "customer_id": "B1SD31A26YCWNJT9V2B4HGJCB0",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "B1SD31A26YCWNJT9V2B4HGJCB0",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMNW4SIF7tjp4oM_",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "BRSIGZFOWC6F4ERPKX3CODLU",
      "service_variation_version": 1764801478862,
      "service_variation_client_id": "BRSIGZFOWC6F4ERPKX3CODLU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Emily Machado
üéâ First booking detected for customer: B1SD31A26YCWNJT9V2B4HGJCB0
   Name: Emily Machado
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer B1SD31A26YCWNJT9V2B4HGJCB0...
   Full custom attributes response: {}
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: B1SD31A26YCWNJT9V2B4HGJCB0
{"ts":"2025-12-05T02:31:51.267Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"ab83fb99-f121-4b30-8198-fd426b4370a7","stage":"booking","correlationId":"booking-created:bec5dbda646979b31e3a26ef"}
{"ts":"2025-12-05T02:44:50.748Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"13f16169-bb63-4ce2-b493-4aa76d4ffc10","stage":"payment","correlationId":"payment-updated:4f75df30949399274097f9f0","attempts":1}
üí∞ Processing payment completion for customer: BCDAEYDCS05SCKA1C291CKN3EW
   Payment source_type: CARD
   Payment tender_types: []
Customer BCDAEYDCS05SCKA1C291CKN3EW already completed first payment
{"ts":"2025-12-05T02:44:51.134Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"13f16169-bb63-4ce2-b493-4aa76d4ffc10","stage":"payment","correlationId":"payment-updated:4f75df30949399274097f9f0"}
{"ts":"2025-12-05T02:44:53.433Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"ab7b12e9-500d-4311-b816-d7d1c5f9177b","stage":"payment","correlationId":"payment-updated:ee8b4191b5c6978bb0ae911c","attempts":1}
üí∞ Processing payment completion for customer: BCDAEYDCS05SCKA1C291CKN3EW
   Payment source_type: CARD
   Payment tender_types: []
Customer BCDAEYDCS05SCKA1C291CKN3EW already completed first payment
{"ts":"2025-12-05T02:44:53.572Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"ab7b12e9-500d-4311-b816-d7d1c5f9177b","stage":"payment","correlationId":"payment-updated:ee8b4191b5c6978bb0ae911c"}
{"ts":"2025-12-05T02:51:36.866Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"64568f80-f0c1-4582-a25f-39a0796af642","stage":"booking","correlationId":"booking-created:d892cce35f4e366960b5e699","attempts":1}
üìÖ Processing booking created for customer: BCDAEYDCS05SCKA1C291CKN3EW
Full booking data: {
  "id": "7g7qu2x39pz1pf",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-23T02:00:00Z",
  "created_at": "2025-12-05T02:51:34Z",
  "updated_at": "2025-12-05T02:51:34Z",
  "customer_id": "BCDAEYDCS05SCKA1C291CKN3EW",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMWAtQTYmZpwwxii"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMoZGdZlg-iKWTDu",
      "any_team_member": false,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1764609601083,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    },
    {
      "team_member_id": "TMoZGdZlg-iKWTDu",
      "any_team_member": false,
      "duration_minutes": 20,
      "intermission_minutes": 0,
      "service_variation_id": "HAJX45W3U2WUCCXM5MI24UEE",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "HAJX45W3U2WUCCXM5MI24UEE"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Hannah Bagby
üéâ First booking detected for customer: BCDAEYDCS05SCKA1C291CKN3EW
   Name: Hannah Bagby
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer BCDAEYDCS05SCKA1C291CKN3EW...
   Full custom attributes response: {}
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: BCDAEYDCS05SCKA1C291CKN3EW
{"ts":"2025-12-05T02:51:38.995Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"64568f80-f0c1-4582-a25f-39a0796af642","stage":"booking","correlationId":"booking-created:d892cce35f4e366960b5e699"}
{"ts":"2025-12-05T02:51:41.345Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"b05731a1-4bf5-48c1-b915-69f18613c469","stage":"payment","correlationId":"payment-updated:399586edf62da5323251c20e","attempts":1}
üí∞ Processing payment completion for customer: QTADT64D12939DMDDAH5ZG1HAM
   Payment source_type: CARD
   Payment tender_types: []
Customer QTADT64D12939DMDDAH5ZG1HAM already completed first payment
{"ts":"2025-12-05T02:51:41.499Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"b05731a1-4bf5-48c1-b915-69f18613c469","stage":"payment","correlationId":"payment-updated:399586edf62da5323251c20e"}
{"ts":"2025-12-05T02:51:48.093Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"7979adc2-e633-4816-9a13-f07f387e29a5","stage":"payment","correlationId":"payment-updated:00ce9ef0d8961ecfa3be7692","attempts":1}
üí∞ Processing payment completion for customer: QTADT64D12939DMDDAH5ZG1HAM
   Payment source_type: CARD
   Payment tender_types: []
Customer QTADT64D12939DMDDAH5ZG1HAM already completed first payment
{"ts":"2025-12-05T02:51:48.228Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"7979adc2-e633-4816-9a13-f07f387e29a5","stage":"payment","correlationId":"payment-updated:00ce9ef0d8961ecfa3be7692"}
{"ts":"2025-12-05T02:57:40.179Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"d9efd0ef-8bca-43f0-b8f7-c28f6a7baff4","stage":"payment","correlationId":"payment-updated:e6f6b3364e88286d08016adb","attempts":1}
üí∞ Processing payment completion for customer: V9JZPYJF9R6DXBJJ6A97QQ8KCM
   Payment source_type: CARD
   Payment tender_types: []
Customer V9JZPYJF9R6DXBJJ6A97QQ8KCM already completed first payment
{"ts":"2025-12-05T02:57:40.587Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"d9efd0ef-8bca-43f0-b8f7-c28f6a7baff4","stage":"payment","correlationId":"payment-updated:e6f6b3364e88286d08016adb"}
{"ts":"2025-12-05T02:57:45.022Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"a9b0e9d3-e9ab-4a56-9fa0-982508a147b6","stage":"payment","correlationId":"payment-updated:2b401468a8bce3769f93f1af","attempts":1}
üí∞ Processing payment completion for customer: V9JZPYJF9R6DXBJJ6A97QQ8KCM
   Payment source_type: CARD
   Payment tender_types: []
Customer V9JZPYJF9R6DXBJJ6A97QQ8KCM already completed first payment
{"ts":"2025-12-05T02:57:45.163Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"a9b0e9d3-e9ab-4a56-9fa0-982508a147b6","stage":"payment","correlationId":"payment-updated:2b401468a8bce3769f93f1af"}
{"ts":"2025-12-05T02:57:56.526Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"96bed008-bd58-477e-b837-d40df033dee6","stage":"payment","correlationId":"payment-updated:76da2b16ceab12c674b8fef3","attempts":1}
üí∞ Processing payment completion for customer: V9JZPYJF9R6DXBJJ6A97QQ8KCM
   Payment source_type: CARD
   Payment tender_types: []
Customer V9JZPYJF9R6DXBJJ6A97QQ8KCM already completed first payment
{"ts":"2025-12-05T02:57:56.771Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"96bed008-bd58-477e-b837-d40df033dee6","stage":"payment","correlationId":"payment-updated:76da2b16ceab12c674b8fef3"}
{"ts":"2025-12-05T02:58:01.182Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"ea081162-9d59-42b1-9c34-8c3f058293ae","stage":"payment","correlationId":"payment-updated:96c3d8fc2fb0e4120241ecf7","attempts":1}
üí∞ Processing payment completion for customer: V9JZPYJF9R6DXBJJ6A97QQ8KCM
   Payment source_type: CARD
   Payment tender_types: []
Customer V9JZPYJF9R6DXBJJ6A97QQ8KCM already completed first payment
{"ts":"2025-12-05T02:58:01.317Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"ea081162-9d59-42b1-9c34-8c3f058293ae","stage":"payment","correlationId":"payment-updated:96c3d8fc2fb0e4120241ecf7"}
{"ts":"2025-12-05T03:03:10.965Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"af4c934d-b89b-4b16-a63c-6c3beff29db6","stage":"payment","correlationId":"payment-updated:690f0e4d064e379b20122ef4","attempts":1}
üí∞ Processing payment completion for customer: N19F8CFJY29DP6CSRJRKT4V76C
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Vesa Muriqi
‚ùå Referrer not found for code: null
‚úÖ Generated new personal_code in name+ID format: VESA6476
‚úÖ Created gift card for Vesa Muriqi: gftc:397d8484685e49a6975acec2a5482fa7
‚úÖ Linked gift card gftc:397d8484685e49a6975acec2a5482fa7 to customer N19F8CFJY29DP6CSRJRKT4V76C
   Gift card will now appear in customer's profile in Square
üìã Verification:
   State: PENDING
   Balance: $0
‚úÖ Created new referrer gift card: gftc:397d8484685e49a6975acec2a5482fa7
‚úÖ Upserted custom attribute "square:a3dde506-f69e-48e4-a98a-004c1822d3ad" for customer N19F8CFJY29DP6CSRJRKT4V76C
üìù Added referral code VESA6476 to customer N19F8CFJY29DP6CSRJRKT4V76C notes
‚úÖ Referral email sent to muriqi.vesa@gmail.com
‚úÖ Referral email sent successfully to muriqi.vesa@gmail.com
‚ùå Failed to send SMS to +41767297164: (0 , account_1.AccountListInstance) is not a function
‚ùå Failed to send SMS to +41767297164: (0 , account_1.AccountListInstance) is not a function
üìß Referral code generated and sent:
   - Customer: Vesa Muriqi
   - Email: muriqi.vesa@gmail.com
   - Referral Code: VESA6476
   - Referral URL: https://zorinastudio-referral.com/ref/VESA6476
   - Gift Card ID: gftc:397d8484685e49a6975acec2a5482fa7
   - Status: Customer is now a referrer
‚úÖ Referral code sent to new client:
   - Customer: Vesa Muriqi
   - Email: muriqi.vesa@gmail.com
   - Referral Code: VESA6476
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: N19F8CFJY29DP6CSRJRKT4V76C
{"ts":"2025-12-05T03:03:24.358Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"af4c934d-b89b-4b16-a63c-6c3beff29db6","stage":"payment","correlationId":"payment-updated:690f0e4d064e379b20122ef4"}
{"ts":"2025-12-05T03:03:24.512Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"922a661f-a4f1-4a53-bab2-98031f1516c5","stage":"payment","correlationId":"payment-updated:6997ee1af628fb6763e4ba73","attempts":1}
üí∞ Processing payment completion for customer: N19F8CFJY29DP6CSRJRKT4V76C
   Payment source_type: CARD
   Payment tender_types: []
Customer N19F8CFJY29DP6CSRJRKT4V76C already completed first payment
{"ts":"2025-12-05T03:03:24.660Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"922a661f-a4f1-4a53-bab2-98031f1516c5","stage":"payment","correlationId":"payment-updated:6997ee1af628fb6763e4ba73"}
{"ts":"2025-12-05T03:21:08.290Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"4d83307e-f0a6-450e-aa1e-795cf6480c41","stage":"booking","correlationId":"booking-created:d7db0de84833a323be8a2282","attempts":1}
üìÖ Processing booking created for customer: 27XDCJTCN4VFT5F20RMR81T150
Full booking data: {
  "id": "jc6x7ewjfn1rla",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-28T19:40:00Z",
  "created_at": "2025-12-05T03:21:05Z",
  "updated_at": "2025-12-05T03:21:05Z",
  "customer_id": "27XDCJTCN4VFT5F20RMR81T150",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "27XDCJTCN4VFT5F20RMR81T150",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMMHlgFBIFbMTRap",
      "any_team_member": false,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1764609601083,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Nathalie Bonajuto
üéâ First booking detected for customer: 27XDCJTCN4VFT5F20RMR81T150
   Name: Nathalie Bonajuto
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 27XDCJTCN4VFT5F20RMR81T150...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "0826aee4-d259-434d-be44-511ac61b3629"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-02-22T00:43:14.765Z",
      "createdAt": "2025-02-22T00:43:14.765Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="0826aee4-d259-434d-be44-511ac61b3629"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "0826aee4-d259-434d-be44-511ac61b3629"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 27XDCJTCN4VFT5F20RMR81T150
{"ts":"2025-12-05T03:21:09.411Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"4d83307e-f0a6-450e-aa1e-795cf6480c41","stage":"booking","correlationId":"booking-created:d7db0de84833a323be8a2282"}
{"ts":"2025-12-05T03:29:29.544Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"0d3e7772-7b7d-4110-a461-8eb2e253de75","stage":"customer_ingest","correlationId":"customer-created:4a496a5b49c1107a56f37dc2","attempts":1}
üì• Received customer data: {
  "id": "PBJMRSH1PMPNBZ8DNBCJAP8BB0",
  "address": {
    "country": "US"
  },
  "version": 0,
  "group_ids": [
    "LT4ZHFBQQYB2N.APPOINTMENTS"
  ],
  "created_at": "2025-12-05T03:29:23.497Z",
  "given_name": "Mikeya",
  "updated_at": "2025-12-05T03:29:23Z",
  "family_name": "Johnson",
  "preferences": {
    "email_unsubscribed": false
  },
  "phone_number": "+19166705857",
  "email_address": "mikeyaelizabeth@gmail.com",
  "creation_source": "APPOINTMENTS"
}
üë§ Processing customer creation: PBJMRSH1PMPNBZ8DNBCJAP8BB0
üìç IP Address: unknown
üìß Email: mikeyaelizabeth@gmail.com
üìû Phone: +19166705857
üë§ Name: Mikeya Johnson
‚ö†Ô∏è Suspicious IP activity detected: unknown used by 146 customers
‚ö†Ô∏è Suspicious activity detected for customer PBJMRSH1PMPNBZ8DNBCJAP8BB0, flagging for review
üéâ New customer detected: PBJMRSH1PMPNBZ8DNBCJAP8BB0
‚úÖ Customer added to database as NEW (temporary mark)
   - Will check for referral code when they book
   - Will give gift card on first booking if code found
‚úÖ Verification: Customer found in DB: true
{"ts":"2025-12-05T03:29:30.718Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"0d3e7772-7b7d-4110-a461-8eb2e253de75","stage":"customer_ingest","correlationId":"customer-created:4a496a5b49c1107a56f37dc2"}
{"ts":"2025-12-05T03:29:30.877Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"1701d288-883c-4c3a-b4c6-736fb3c5fda5","stage":"booking","correlationId":"booking-created:6f5bb05b5e206203419c7c80","attempts":1}
üìÖ Processing booking created for customer: PBJMRSH1PMPNBZ8DNBCJAP8BB0
Full booking data: {
  "id": "6vfmfvivmduwbm",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-06T01:30:00Z",
  "created_at": "2025-12-05T03:29:26Z",
  "updated_at": "2025-12-05T03:29:26Z",
  "customer_id": "PBJMRSH1PMPNBZ8DNBCJAP8BB0",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "PBJMRSH1PMPNBZ8DNBCJAP8BB0",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "resource_ids": [
        "5OVIQ6GSSUXORACP6T7WBAQ7"
      ],
      "team_member_id": "TMMCVDJoKh3ZkfFo",
      "any_team_member": true,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "ZEAKNB35I37RMXNUBGWDZQIM",
      "service_variation_version": 1760895536505,
      "service_variation_client_id": "ZEAKNB35I37RMXNUBGWDZQIM"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Mikeya Johnson
üéâ First booking detected for customer: PBJMRSH1PMPNBZ8DNBCJAP8BB0
   Name: Mikeya Johnson
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer PBJMRSH1PMPNBZ8DNBCJAP8BB0...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "fd306114-9968-4fe0-9bde-53f9bf837f39"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-12-05T03:29:26.462Z",
      "createdAt": "2025-12-05T03:29:26.462Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="fd306114-9968-4fe0-9bde-53f9bf837f39"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "fd306114-9968-4fe0-9bde-53f9bf837f39"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: PBJMRSH1PMPNBZ8DNBCJAP8BB0
{"ts":"2025-12-05T03:29:31.269Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"1701d288-883c-4c3a-b4c6-736fb3c5fda5","stage":"booking","correlationId":"booking-created:6f5bb05b5e206203419c7c80"}
{"ts":"2025-12-05T03:43:55.227Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"55659b8f-ff79-4b25-8155-93111e4c2dc2","stage":"booking","correlationId":"booking-created:d8bba546a451a14d68b0a53d","attempts":1}
üìÖ Processing booking created for customer: 1Q3ST6S62D41V6TGPXV6J2FAN8
Full booking data: {
  "id": "7kd63d6llznz0x",
  "source": "THIRD_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-09T17:00:00Z",
  "created_at": "2025-12-05T03:43:53Z",
  "updated_at": "2025-12-05T03:43:53Z",
  "customer_id": "1Q3ST6S62D41V6TGPXV6J2FAN8",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "1Q3ST6S62D41V6TGPXV6J2FAN8",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMMHlgFBIFbMTRap",
      "any_team_member": false,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1764609601083,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    },
    {
      "team_member_id": "TMMHlgFBIFbMTRap",
      "any_team_member": false,
      "duration_minutes": 15,
      "intermission_minutes": 0,
      "service_variation_id": "KBHPHVKLJNAF223GMYIRUUH3",
      "service_variation_version": 1760895536505,
      "service_variation_client_id": "WOKQXBYCDVX6LQACJMHZTH2Q"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Carla Betteo
üéâ First booking detected for customer: 1Q3ST6S62D41V6TGPXV6J2FAN8
   Name: Carla Betteo
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 1Q3ST6S62D41V6TGPXV6J2FAN8...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "af5791f8-348a-422e-98d1-5e865121bb19"
      ],
      "version": 2,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-09-22T03:57:35.919Z",
      "createdAt": "2025-09-22T03:57:35.268Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="af5791f8-348a-422e-98d1-5e865121bb19"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "af5791f8-348a-422e-98d1-5e865121bb19"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 1Q3ST6S62D41V6TGPXV6J2FAN8
{"ts":"2025-12-05T03:43:56.163Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"55659b8f-ff79-4b25-8155-93111e4c2dc2","stage":"booking","correlationId":"booking-created:d8bba546a451a14d68b0a53d"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Timed out fetching a new connection from the connection pool. More info: http://pris.ly/d/connection-pool (Current connection pool timeout: 10, connection limit: 21)
{"ts":"2025-12-05T21:14:23.256Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"296cc430-bcbe-4178-8f1d-a3d02ced7d13","stage":"booking","correlationId":"booking-created:1e8b89de022684f83e928298","attempts":1}
üìÖ Processing booking created for customer: FZ3YCXQMZN7458S05V314FE1E4
Full booking data: {
  "id": "yklbpw6bv3d7qm",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-20T21:30:00Z",
  "created_at": "2025-12-05T05:05:39Z",
  "updated_at": "2025-12-05T05:05:39Z",
  "customer_id": "FZ3YCXQMZN7458S05V314FE1E4",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "FZ3YCXQMZN7458S05V314FE1E4",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMVwAQUdLz6no-cB",
      "any_team_member": false,
      "duration_minutes": 100,
      "intermission_minutes": 0,
      "service_variation_id": "GSZZR45VJXB44NF4P4WXI5NB",
      "service_variation_version": 1764801478862,
      "service_variation_client_id": "GSZZR45VJXB44NF4P4WXI5NB"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Anna Johnson
üéâ First booking detected for customer: FZ3YCXQMZN7458S05V314FE1E4
   Name: Anna Johnson
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer FZ3YCXQMZN7458S05V314FE1E4...
   Full custom attributes response: {}
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: FZ3YCXQMZN7458S05V314FE1E4
{"ts":"2025-12-05T21:14:25.610Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"296cc430-bcbe-4178-8f1d-a3d02ced7d13","stage":"booking","correlationId":"booking-created:1e8b89de022684f83e928298"}
{"ts":"2025-12-05T21:14:26.109Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"c87931de-34ed-464e-845b-33ad04c8a1d9","stage":"booking","correlationId":"booking-created:e4df48832fd2c2dba4e3872a","attempts":1}
üìÖ Processing booking created for customer: PAWMX2Q6ZCDJJP6RMTAHKGJ7A4
Full booking data: {
  "id": "f743f74zhlremn",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-05T21:00:00Z",
  "created_at": "2025-12-05T05:17:33Z",
  "updated_at": "2025-12-05T05:17:33Z",
  "customer_id": "PAWMX2Q6ZCDJJP6RMTAHKGJ7A4",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "PAWMX2Q6ZCDJJP6RMTAHKGJ7A4",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMoZGdZlg-iKWTDu",
      "any_team_member": false,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1764609601083,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Meghan Brittain
üéâ First booking detected for customer: PAWMX2Q6ZCDJJP6RMTAHKGJ7A4
   Name: Meghan Brittain
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer PAWMX2Q6ZCDJJP6RMTAHKGJ7A4...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-05-27T03:50:19.260Z",
      "createdAt": "2025-05-27T03:50:19.260Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: PAWMX2Q6ZCDJJP6RMTAHKGJ7A4
{"ts":"2025-12-05T21:14:26.744Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"c87931de-34ed-464e-845b-33ad04c8a1d9","stage":"booking","correlationId":"booking-created:e4df48832fd2c2dba4e3872a"}
{"ts":"2025-12-05T21:14:27.115Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"d77aa311-080a-475d-b2f0-d84305d12876","stage":"booking","correlationId":"booking-created:58d376a8efef25583ec973e5","attempts":1}
üìÖ Processing booking created for customer: QY21PYNRYD2GFBGA4J7XCKZV8C
Full booking data: {
  "id": "7f9diqodsbxoti",
  "source": "THIRD_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-12T02:05:00Z",
  "created_at": "2025-12-05T06:54:37Z",
  "updated_at": "2025-12-05T06:54:37Z",
  "customer_id": "QY21PYNRYD2GFBGA4J7XCKZV8C",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "QY21PYNRYD2GFBGA4J7XCKZV8C",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMgsjtuk5cfKnstq",
      "any_team_member": false,
      "duration_minutes": 110,
      "intermission_minutes": 0,
      "service_variation_id": "6TYOE67IDYTKHW2ZG6HKVZER",
      "service_variation_version": 1764801478862,
      "service_variation_client_id": "6TYOE67IDYTKHW2ZG6HKVZER"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Aruzhan Tustikbayeva
üéâ First booking detected for customer: QY21PYNRYD2GFBGA4J7XCKZV8C
   Name: Aruzhan Tustikbayeva
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer QY21PYNRYD2GFBGA4J7XCKZV8C...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "fd306114-9968-4fe0-9bde-53f9bf837f39"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-11-10T04:48:46.281Z",
      "createdAt": "2025-11-10T04:48:46.281Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="fd306114-9968-4fe0-9bde-53f9bf837f39"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "fd306114-9968-4fe0-9bde-53f9bf837f39"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: QY21PYNRYD2GFBGA4J7XCKZV8C
{"ts":"2025-12-05T21:14:27.636Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"d77aa311-080a-475d-b2f0-d84305d12876","stage":"booking","correlationId":"booking-created:58d376a8efef25583ec973e5"}
{"ts":"2025-12-05T21:14:27.919Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"49e020c7-6f49-444e-a6e9-ca3ce3a776a2","stage":"booking","correlationId":"booking-created:47c6f351556aafda32282ec3","attempts":1}
üìÖ Processing booking created for customer: 7H46CEFPNKXRXCJBC3VHR0B2RG
Full booking data: {
  "id": "cbdxn9cxn2hpxx",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-08T18:50:00Z",
  "created_at": "2025-12-05T07:52:05Z",
  "updated_at": "2025-12-05T07:52:05Z",
  "customer_id": "7H46CEFPNKXRXCJBC3VHR0B2RG",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "7H46CEFPNKXRXCJBC3VHR0B2RG",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "resource_ids": [
        "KAOXILA4CV7A23VRAACC4R66"
      ],
      "team_member_id": "TMyUMvTJIj2HrHSg",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "ZEAKNB35I37RMXNUBGWDZQIM",
      "service_variation_version": 1760895536505,
      "service_variation_client_id": "ZEAKNB35I37RMXNUBGWDZQIM"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Alicia Dollaku
üéâ First booking detected for customer: 7H46CEFPNKXRXCJBC3VHR0B2RG
   Name: Alicia Dollaku
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 7H46CEFPNKXRXCJBC3VHR0B2RG...
   Full custom attributes response: {}
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 7H46CEFPNKXRXCJBC3VHR0B2RG
{"ts":"2025-12-05T21:14:29.420Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"49e020c7-6f49-444e-a6e9-ca3ce3a776a2","stage":"booking","correlationId":"booking-created:47c6f351556aafda32282ec3"}
{"ts":"2025-12-05T21:14:30.061Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"19c9ff93-d681-4ba8-ac24-a47983a521b8","stage":"booking","correlationId":"booking-created:574b2e4e6963a825651ef442","attempts":1}
üìÖ Processing booking created for customer: 7H46CEFPNKXRXCJBC3VHR0B2RG
Full booking data: {
  "id": "i0jnd313j88s92",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-15T20:55:00Z",
  "created_at": "2025-12-05T07:54:29Z",
  "updated_at": "2025-12-05T07:54:29Z",
  "customer_id": "7H46CEFPNKXRXCJBC3VHR0B2RG",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "7H46CEFPNKXRXCJBC3VHR0B2RG",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMyUMvTJIj2HrHSg",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "JMTK5M2CY2W7WEXSTAJKAJ35",
      "service_variation_version": 1764801478862,
      "service_variation_client_id": "JMTK5M2CY2W7WEXSTAJKAJ35"
    },
    {
      "team_member_id": "TMyUMvTJIj2HrHSg",
      "any_team_member": false,
      "duration_minutes": 20,
      "intermission_minutes": 0,
      "service_variation_id": "HAJX45W3U2WUCCXM5MI24UEE",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "HAJX45W3U2WUCCXM5MI24UEE"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Alicia Dollaku
üéâ First booking detected for customer: 7H46CEFPNKXRXCJBC3VHR0B2RG
   Name: Alicia Dollaku
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 7H46CEFPNKXRXCJBC3VHR0B2RG...
   Full custom attributes response: {}
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 7H46CEFPNKXRXCJBC3VHR0B2RG
{"ts":"2025-12-05T21:14:31.070Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"19c9ff93-d681-4ba8-ac24-a47983a521b8","stage":"booking","correlationId":"booking-created:574b2e4e6963a825651ef442"}
{"ts":"2025-12-05T21:14:31.592Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"ee97a018-f894-4b5c-986a-f157938dba42","stage":"booking","correlationId":"booking-created:10a12fa80b7587bcadcc35a4","attempts":1}
üìÖ Processing booking created for customer: KNRAWQBY3FJN060D7K6S1KKNRW
Full booking data: {
  "id": "zuee0tjh269w7h",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-08T19:20:00Z",
  "created_at": "2025-12-05T12:38:18Z",
  "updated_at": "2025-12-05T12:38:18Z",
  "customer_id": "KNRAWQBY3FJN060D7K6S1KKNRW",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "KNRAWQBY3FJN060D7K6S1KKNRW",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMMBgVwykMnOlumA",
      "any_team_member": true,
      "duration_minutes": 140,
      "intermission_minutes": 0,
      "service_variation_id": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "service_variation_version": 1764783981722,
      "service_variation_client_id": "CJI5WHOAKSFTASYPJ4MSYZLS"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Koren Alexander
üéâ First booking detected for customer: KNRAWQBY3FJN060D7K6S1KKNRW
   Name: Koren Alexander
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer KNRAWQBY3FJN060D7K6S1KKNRW...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "c0f2ee04-4762-42c6-a593-a4e745a81c92"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-12-05T12:38:18.601Z",
      "createdAt": "2025-12-05T12:38:18.601Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="c0f2ee04-4762-42c6-a593-a4e745a81c92"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "c0f2ee04-4762-42c6-a593-a4e745a81c92"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: KNRAWQBY3FJN060D7K6S1KKNRW
{"ts":"2025-12-05T21:14:32.728Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"ee97a018-f894-4b5c-986a-f157938dba42","stage":"booking","correlationId":"booking-created:10a12fa80b7587bcadcc35a4"}
{"ts":"2025-12-05T21:14:33.297Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"9088390a-3635-477c-b125-e664e6891f07","stage":"booking","correlationId":"booking-created:45a53e93b9fc0f92e99124c1","attempts":1}
üìÖ Processing booking created for customer: FQ2G3W14868B03D8H7M1H519S0
Full booking data: {
  "id": "mil1hcan55nfn0",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-09T23:00:00Z",
  "created_at": "2025-12-05T15:34:54Z",
  "updated_at": "2025-12-05T15:34:54Z",
  "customer_id": "FQ2G3W14868B03D8H7M1H519S0",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "FQ2G3W14868B03D8H7M1H519S0",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TM9jDlRr_Hl4rdBB",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "XBUDIMNKOPC2XVG5YLIQ4RYS",
      "service_variation_version": 1764801478862,
      "service_variation_client_id": "XBUDIMNKOPC2XVG5YLIQ4RYS"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Kelly Liebman
üéâ First booking detected for customer: FQ2G3W14868B03D8H7M1H519S0
   Name: Kelly Liebman
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer FQ2G3W14868B03D8H7M1H519S0...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "af5791f8-348a-422e-98d1-5e865121bb19"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-08-15T05:00:47.821Z",
      "createdAt": "2025-08-15T05:00:47.821Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="af5791f8-348a-422e-98d1-5e865121bb19"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "af5791f8-348a-422e-98d1-5e865121bb19"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: FQ2G3W14868B03D8H7M1H519S0
{"ts":"2025-12-05T21:14:34.116Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"9088390a-3635-477c-b125-e664e6891f07","stage":"booking","correlationId":"booking-created:45a53e93b9fc0f92e99124c1"}
{"ts":"2025-12-05T21:14:34.620Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"83301993-c2b4-4cb2-a422-944273cdf372","stage":"booking","correlationId":"booking-created:0fff909d095f3be8e3630653","attempts":1}
üìÖ Processing booking created for customer: ZM1QRE5T76E9EH26E31135V8G0
Full booking data: {
  "id": "1mkfm09aq25fui",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-14T23:40:00Z",
  "created_at": "2025-12-05T15:52:23Z",
  "updated_at": "2025-12-05T15:52:23Z",
  "customer_id": "ZM1QRE5T76E9EH26E31135V8G0",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "ZM1QRE5T76E9EH26E31135V8G0",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMSt73bSp59caRzt",
      "any_team_member": true,
      "duration_minutes": 140,
      "intermission_minutes": 0,
      "service_variation_id": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "service_variation_version": 1764783981722,
      "service_variation_client_id": "CJI5WHOAKSFTASYPJ4MSYZLS"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Ariana Nurisso
üéâ First booking detected for customer: ZM1QRE5T76E9EH26E31135V8G0
   Name: Ariana Nurisso
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer ZM1QRE5T76E9EH26E31135V8G0...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "af5791f8-348a-422e-98d1-5e865121bb19"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-11-05T21:32:05.822Z",
      "createdAt": "2025-11-05T21:32:05.822Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="af5791f8-348a-422e-98d1-5e865121bb19"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "af5791f8-348a-422e-98d1-5e865121bb19"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: ZM1QRE5T76E9EH26E31135V8G0
{"ts":"2025-12-05T21:14:35.379Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"83301993-c2b4-4cb2-a422-944273cdf372","stage":"booking","correlationId":"booking-created:0fff909d095f3be8e3630653"}
{"ts":"2025-12-05T21:14:35.626Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"3cbc7081-5d6f-4b49-be8a-b2463c216252","stage":"booking","correlationId":"booking-created:567d8694f9a81c73ad08b093","attempts":1}
üìÖ Processing booking created for customer: 0PM1F49715GF0FFV4MW6372AG8
Full booking data: {
  "id": "sm1iyhm4aqkf6t",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-26T20:00:00Z",
  "created_at": "2025-12-05T16:44:11Z",
  "updated_at": "2025-12-05T16:44:11Z",
  "customer_id": "0PM1F49715GF0FFV4MW6372AG8",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "0PM1F49715GF0FFV4MW6372AG8",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMyUMvTJIj2HrHSg",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "JMTK5M2CY2W7WEXSTAJKAJ35",
      "service_variation_version": 1764801478862,
      "service_variation_client_id": "JMTK5M2CY2W7WEXSTAJKAJ35"
    },
    {
      "resource_ids": [
        "VNDFB5HCSMOPZDVJ2ML6QOIJ"
      ],
      "team_member_id": "TMyUMvTJIj2HrHSg",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "ZEAKNB35I37RMXNUBGWDZQIM",
      "service_variation_version": 1760895536505,
      "service_variation_client_id": "ZEAKNB35I37RMXNUBGWDZQIM"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Reilly Parker
üéâ First booking detected for customer: 0PM1F49715GF0FFV4MW6372AG8
   Name: Reilly Parker
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 0PM1F49715GF0FFV4MW6372AG8...
   Full custom attributes response: {}
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 0PM1F49715GF0FFV4MW6372AG8
{"ts":"2025-12-05T21:14:36.490Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"3cbc7081-5d6f-4b49-be8a-b2463c216252","stage":"booking","correlationId":"booking-created:567d8694f9a81c73ad08b093"}
{"ts":"2025-12-05T21:14:37.155Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"a9345b27-be72-4545-8ca7-6a7647feb3ee","stage":"booking","correlationId":"booking-created:f7c6d332c8508f0bcb10a174","attempts":1}
üìÖ Processing booking created for customer: J3THW79E41CGEZSPW89CZWD0CC
Full booking data: {
  "id": "on849jt1gcffy7",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-10T23:30:00Z",
  "created_at": "2025-12-05T17:42:59Z",
  "updated_at": "2025-12-05T17:42:59Z",
  "customer_id": "J3THW79E41CGEZSPW89CZWD0CC",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMWAtQTYmZpwwxii"
  },
  "appointment_segments": [
    {
      "team_member_id": "TM-zXe9fXe4axYWn",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "63PG6RLS2NHWRD5JRXEC74HN",
      "service_variation_version": 1760895536505,
      "service_variation_client_id": "63PG6RLS2NHWRD5JRXEC74HN"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Anastasiya Ivanova
üéâ First booking detected for customer: J3THW79E41CGEZSPW89CZWD0CC
   Name: Anastasiya Ivanova
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer J3THW79E41CGEZSPW89CZWD0CC...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "0826aee4-d259-434d-be44-511ac61b3629"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-09-15T20:14:57.467Z",
      "createdAt": "2025-09-15T20:14:57.467Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="0826aee4-d259-434d-be44-511ac61b3629"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "0826aee4-d259-434d-be44-511ac61b3629"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: J3THW79E41CGEZSPW89CZWD0CC
{"ts":"2025-12-05T21:14:40.507Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"a9345b27-be72-4545-8ca7-6a7647feb3ee","stage":"booking","correlationId":"booking-created:f7c6d332c8508f0bcb10a174"}
{"ts":"2025-12-05T21:14:41.226Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"aa02c60b-5093-4fb3-8242-20f43813ea1c","stage":"booking","correlationId":"booking-created:76631287e467b802f0b3210e","attempts":1}
üìÖ Processing booking created for customer: 8Q8EGZ0GJMF6W6EQRYVEZBGV2M
Full booking data: {
  "id": "03zov3qd3uq3p1",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-09T23:00:00Z",
  "created_at": "2025-12-05T17:45:24Z",
  "updated_at": "2025-12-05T17:45:24Z",
  "customer_id": "8Q8EGZ0GJMF6W6EQRYVEZBGV2M",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMQPbDVvvOCLwqsy"
  },
  "appointment_segments": [
    {
      "team_member_id": "TM7_r-KmvY9xjnEU",
      "any_team_member": false,
      "duration_minutes": 110,
      "intermission_minutes": 0,
      "service_variation_id": "GJ5SRTYFV6ZCDI62TMSZP2OP",
      "service_variation_version": 1764609577793,
      "service_variation_client_id": "GJ5SRTYFV6ZCDI62TMSZP2OP"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Laura Krause
üéâ First booking detected for customer: 8Q8EGZ0GJMF6W6EQRYVEZBGV2M
   Name: Laura Krause
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 8Q8EGZ0GJMF6W6EQRYVEZBGV2M...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "0826aee4-d259-434d-be44-511ac61b3629"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-08-12T05:02:14.178Z",
      "createdAt": "2025-08-12T05:02:14.178Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="0826aee4-d259-434d-be44-511ac61b3629"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "0826aee4-d259-434d-be44-511ac61b3629"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 8Q8EGZ0GJMF6W6EQRYVEZBGV2M
{"ts":"2025-12-05T21:14:42.220Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"aa02c60b-5093-4fb3-8242-20f43813ea1c","stage":"booking","correlationId":"booking-created:76631287e467b802f0b3210e"}
{"ts":"2025-12-05T21:14:43.263Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"a62f4ef3-0e23-40d1-a15c-5ea5fc663e82","stage":"payment","correlationId":"payment-updated:45649735c1e26ba5b1a68d6e","attempts":1}
üí∞ Processing payment completion for customer: 38WVDN0W7AES0BZDQ3068DFV0W
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Katherine Philpot
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Katherine Philpot, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Katherine Philpot
   - Email: starmakerk@aol.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: 38WVDN0W7AES0BZDQ3068DFV0W
{"ts":"2025-12-05T21:14:44.315Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"a62f4ef3-0e23-40d1-a15c-5ea5fc663e82","stage":"payment","correlationId":"payment-updated:45649735c1e26ba5b1a68d6e"}
{"ts":"2025-12-05T21:14:44.596Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"71af3f32-0f83-428f-941c-1dcdcb27239f","stage":"payment","correlationId":"payment-updated:a572055d64821ab1c664ba4e","attempts":1}
üí∞ Processing payment completion for customer: 38WVDN0W7AES0BZDQ3068DFV0W
   Payment source_type: CARD
   Payment tender_types: []
Customer 38WVDN0W7AES0BZDQ3068DFV0W already completed first payment
{"ts":"2025-12-05T21:14:44.846Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"71af3f32-0f83-428f-941c-1dcdcb27239f","stage":"payment","correlationId":"payment-updated:a572055d64821ab1c664ba4e"}
{"ts":"2025-12-05T21:14:45.061Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"ba1fa9db-1951-46b0-b1bf-da4264d96fa4","stage":"booking","correlationId":"booking-created:5f04537a9be8ba28427091a5","attempts":1}
üìÖ Processing booking created for customer: 38WVDN0W7AES0BZDQ3068DFV0W
Full booking data: {
  "id": "70q1lfmjqmm3ef",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2026-01-03T22:40:00Z",
  "created_at": "2025-12-05T17:57:21Z",
  "updated_at": "2025-12-05T17:57:21Z",
  "customer_id": "38WVDN0W7AES0BZDQ3068DFV0W",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMWAtQTYmZpwwxii"
  },
  "appointment_segments": [
    {
      "team_member_id": "TM-zXe9fXe4axYWn",
      "any_team_member": false,
      "duration_minutes": 140,
      "intermission_minutes": 0,
      "service_variation_id": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "service_variation_version": 1764783981722,
      "service_variation_client_id": "CJI5WHOAKSFTASYPJ4MSYZLS"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Katherine Philpot
üéâ First booking detected for customer: 38WVDN0W7AES0BZDQ3068DFV0W
   Name: Katherine Philpot
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 38WVDN0W7AES0BZDQ3068DFV0W...
   Full custom attributes response: {}
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 38WVDN0W7AES0BZDQ3068DFV0W
{"ts":"2025-12-05T21:14:46.097Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"ba1fa9db-1951-46b0-b1bf-da4264d96fa4","stage":"booking","correlationId":"booking-created:5f04537a9be8ba28427091a5"}
{"ts":"2025-12-05T21:14:47.097Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"e53c9320-7ee1-4c0a-a752-70864475adbf","stage":"booking","correlationId":"booking-created:8648beb0f0482ade98808d43","attempts":1}
üìÖ Processing booking created for customer: WJ2E6GDJT97HFBKKA9NHH9TYSR
Full booking data: {
  "id": "uo9glskh3vjrs7",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-07T18:00:00Z",
  "created_at": "2025-12-05T18:12:27Z",
  "updated_at": "2025-12-05T18:12:27Z",
  "customer_id": "WJ2E6GDJT97HFBKKA9NHH9TYSR",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "WJ2E6GDJT97HFBKKA9NHH9TYSR",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMNW4SIF7tjp4oM_",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "BRSIGZFOWC6F4ERPKX3CODLU",
      "service_variation_version": 1764801478862,
      "service_variation_client_id": "BRSIGZFOWC6F4ERPKX3CODLU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Fangfei (old account) Yin
üéâ First booking detected for customer: WJ2E6GDJT97HFBKKA9NHH9TYSR
   Name: Fangfei (old account) Yin
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer WJ2E6GDJT97HFBKKA9NHH9TYSR...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "af5791f8-348a-422e-98d1-5e865121bb19"
      ],
      "version": 2,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-05-06T10:54:00.627Z",
      "createdAt": "2025-05-06T10:54:00.265Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="af5791f8-348a-422e-98d1-5e865121bb19"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "af5791f8-348a-422e-98d1-5e865121bb19"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: WJ2E6GDJT97HFBKKA9NHH9TYSR
{"ts":"2025-12-05T21:14:49.313Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"e53c9320-7ee1-4c0a-a752-70864475adbf","stage":"booking","correlationId":"booking-created:8648beb0f0482ade98808d43"}
{"ts":"2025-12-05T21:14:50.267Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"9ae83335-42a3-44e9-b745-8f3fffcaa3e6","stage":"booking","correlationId":"booking-created:cb3e5ed3622d0959934c9fcd","attempts":1}
üìÖ Processing booking created for customer: 26SJ38K5ZTAT81PD0PTS6ARC48
Full booking data: {
  "id": "8ezvdau0j0w6fu",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-15T17:00:00Z",
  "created_at": "2025-12-05T18:13:00Z",
  "updated_at": "2025-12-05T18:13:00Z",
  "customer_id": "26SJ38K5ZTAT81PD0PTS6ARC48",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "26SJ38K5ZTAT81PD0PTS6ARC48",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMVwAQUdLz6no-cB",
      "any_team_member": false,
      "duration_minutes": 100,
      "intermission_minutes": 0,
      "service_variation_id": "GSZZR45VJXB44NF4P4WXI5NB",
      "service_variation_version": 1764801478862,
      "service_variation_client_id": "GSZZR45VJXB44NF4P4WXI5NB"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Jaclyn Pereira
üéâ First booking detected for customer: 26SJ38K5ZTAT81PD0PTS6ARC48
   Name: Jaclyn Pereira
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 26SJ38K5ZTAT81PD0PTS6ARC48...
   Full custom attributes response: {}
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 26SJ38K5ZTAT81PD0PTS6ARC48
{"ts":"2025-12-05T21:14:51.724Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"9ae83335-42a3-44e9-b745-8f3fffcaa3e6","stage":"booking","correlationId":"booking-created:cb3e5ed3622d0959934c9fcd"}
{"ts":"2025-12-05T21:14:52.187Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"329f28b2-7f6a-4073-aba2-c98a7ea4526f","stage":"booking","correlationId":"booking-created:207ce5942f768e2ef2774ce1","attempts":1}
üìÖ Processing booking created for customer: 80MNW9JZWK2QCM623PAJYAJSY0
Full booking data: {
  "id": "cc9papufgo0i3l",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-16T00:30:00Z",
  "created_at": "2025-12-05T18:13:09Z",
  "updated_at": "2025-12-05T18:13:09Z",
  "customer_id": "80MNW9JZWK2QCM623PAJYAJSY0",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "80MNW9JZWK2QCM623PAJYAJSY0",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "resource_ids": [
        "KAOXILA4CV7A23VRAACC4R66"
      ],
      "team_member_id": "TMyUMvTJIj2HrHSg",
      "any_team_member": true,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "ZEAKNB35I37RMXNUBGWDZQIM",
      "service_variation_version": 1760895536505,
      "service_variation_client_id": "ZEAKNB35I37RMXNUBGWDZQIM"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Effie Ioannidou
üéâ First booking detected for customer: 80MNW9JZWK2QCM623PAJYAJSY0
   Name: Effie Ioannidou
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 80MNW9JZWK2QCM623PAJYAJSY0...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "a7b40271-729a-41aa-801b-fb1fffb83650"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-09-07T15:20:54.715Z",
      "createdAt": "2025-09-07T15:20:54.715Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="a7b40271-729a-41aa-801b-fb1fffb83650"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "a7b40271-729a-41aa-801b-fb1fffb83650"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 80MNW9JZWK2QCM623PAJYAJSY0
{"ts":"2025-12-05T21:14:52.668Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"329f28b2-7f6a-4073-aba2-c98a7ea4526f","stage":"booking","correlationId":"booking-created:207ce5942f768e2ef2774ce1"}
{"ts":"2025-12-05T21:14:53.198Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"9284efee-4a63-40c8-9ae2-6b02a66b1ed8","stage":"booking","correlationId":"booking-created:20a221fd5db4de2453b11b6c","attempts":1}
üìÖ Processing booking created for customer: 1CS3MY35Y6G59MFHGY5V7W5C88
Full booking data: {
  "id": "3xryo8vx2oxsw7",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-26T23:00:00Z",
  "created_at": "2025-12-05T18:21:10Z",
  "updated_at": "2025-12-05T18:21:10Z",
  "customer_id": "1CS3MY35Y6G59MFHGY5V7W5C88",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "1CS3MY35Y6G59MFHGY5V7W5C88",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMyUMvTJIj2HrHSg",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "JMTK5M2CY2W7WEXSTAJKAJ35",
      "service_variation_version": 1764801478862,
      "service_variation_client_id": "JMTK5M2CY2W7WEXSTAJKAJ35"
    },
    {
      "resource_ids": [
        "VNDFB5HCSMOPZDVJ2ML6QOIJ"
      ],
      "team_member_id": "TMyUMvTJIj2HrHSg",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "63PG6RLS2NHWRD5JRXEC74HN",
      "service_variation_version": 1760895536505,
      "service_variation_client_id": "VZLZVOWNIEIWAQ47FX67GQS4"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Kristen Juntunen
üéâ First booking detected for customer: 1CS3MY35Y6G59MFHGY5V7W5C88
   Name: Kristen Juntunen
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 1CS3MY35Y6G59MFHGY5V7W5C88...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
      ],
      "version": 2,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-04-28T04:22:31.821Z",
      "createdAt": "2025-02-18T23:18:07.936Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 1CS3MY35Y6G59MFHGY5V7W5C88
{"ts":"2025-12-05T21:14:53.725Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"9284efee-4a63-40c8-9ae2-6b02a66b1ed8","stage":"booking","correlationId":"booking-created:20a221fd5db4de2453b11b6c"}
{"ts":"2025-12-05T21:14:54.022Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"6c7bd982-e9e3-4104-8b69-2da72c030c4d","stage":"booking","correlationId":"booking-created:2d090bea4759dfd91b259755","attempts":1}
üìÖ Processing booking created for customer: BQQ4J2XN461B2WR4V1BGBB9ZRW
Full booking data: {
  "id": "hnyx5gqc1x2i3s",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-11T19:00:00Z",
  "created_at": "2025-12-05T18:25:26Z",
  "updated_at": "2025-12-05T18:25:26Z",
  "customer_id": "BQQ4J2XN461B2WR4V1BGBB9ZRW",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "BQQ4J2XN461B2WR4V1BGBB9ZRW",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TM1L5yPC-yKx6CyO",
      "any_team_member": false,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "NCOIL6ZGDTCC7SO3IJHENCQ2",
      "service_variation_version": 1764801478862,
      "service_variation_client_id": "NCOIL6ZGDTCC7SO3IJHENCQ2"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Jennifer Yen
üéâ First booking detected for customer: BQQ4J2XN461B2WR4V1BGBB9ZRW
   Name: Jennifer Yen
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer BQQ4J2XN461B2WR4V1BGBB9ZRW...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "af5791f8-348a-422e-98d1-5e865121bb19"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-10-07T21:56:36.354Z",
      "createdAt": "2025-10-07T21:56:36.354Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="af5791f8-348a-422e-98d1-5e865121bb19"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "af5791f8-348a-422e-98d1-5e865121bb19"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: BQQ4J2XN461B2WR4V1BGBB9ZRW
{"ts":"2025-12-05T21:14:56.547Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"6c7bd982-e9e3-4104-8b69-2da72c030c4d","stage":"booking","correlationId":"booking-created:2d090bea4759dfd91b259755"}
{"ts":"2025-12-05T21:14:57.045Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"d43b9444-3800-44bb-bf79-e187c3755f03","stage":"payment","correlationId":"payment-updated:d21ebaeeed83818fee86308c","attempts":1}
üí∞ Processing payment completion for customer: HZKGGHH8D1C9RJ11ZKMHZGYCPC
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Natalie Graf
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Natalie Graf, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Natalie Graf
   - Email: grafgirl25@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: HZKGGHH8D1C9RJ11ZKMHZGYCPC
{"ts":"2025-12-05T21:14:58.047Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"d43b9444-3800-44bb-bf79-e187c3755f03","stage":"payment","correlationId":"payment-updated:d21ebaeeed83818fee86308c"}
{"ts":"2025-12-05T21:14:58.686Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"83ad17b6-59f6-4562-9d5b-8f5d08a583a5","stage":"payment","correlationId":"payment-updated:1d509ab725db29c4a9857cc4","attempts":1}
üí∞ Processing payment completion for customer: HZKGGHH8D1C9RJ11ZKMHZGYCPC
   Payment source_type: CARD
   Payment tender_types: []
Customer HZKGGHH8D1C9RJ11ZKMHZGYCPC already completed first payment
{"ts":"2025-12-05T21:14:59.174Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"83ad17b6-59f6-4562-9d5b-8f5d08a583a5","stage":"payment","correlationId":"payment-updated:1d509ab725db29c4a9857cc4"}
{"ts":"2025-12-05T21:14:59.676Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"39c941a5-2806-411c-af07-ca9c987d5497","stage":"payment","correlationId":"payment-updated:ed112f5f27570a2b3ea4768d","attempts":1}
üí∞ Processing payment completion for customer: EPYG2Z8EMQS81CB6Y0R97NZ93G
   Payment source_type: CARD
   Payment tender_types: []
Customer EPYG2Z8EMQS81CB6Y0R97NZ93G already completed first payment
{"ts":"2025-12-05T21:15:00.485Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"39c941a5-2806-411c-af07-ca9c987d5497","stage":"payment","correlationId":"payment-updated:ed112f5f27570a2b3ea4768d"}
{"ts":"2025-12-05T21:15:01.209Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"22f797e8-493a-4c78-be4d-331c721ba861","stage":"payment","correlationId":"payment-updated:297bd6b3f80459ef9d8aceec","attempts":1}
üí∞ Processing payment completion for customer: EPYG2Z8EMQS81CB6Y0R97NZ93G
   Payment source_type: CARD
   Payment tender_types: []
Customer EPYG2Z8EMQS81CB6Y0R97NZ93G already completed first payment
{"ts":"2025-12-05T21:15:01.845Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"22f797e8-493a-4c78-be4d-331c721ba861","stage":"payment","correlationId":"payment-updated:297bd6b3f80459ef9d8aceec"}
{"ts":"2025-12-05T21:15:02.277Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"4e4de781-d4b8-4b88-b67c-dd1197fd1383","stage":"payment","correlationId":"payment-updated:e2e7b4b52fd2c050a62d8d2d","attempts":1}
üí∞ Processing payment completion for customer: 96FWAQ72E0EMCPMRAF25FBHX78
   Payment source_type: CARD
   Payment tender_types: []
Customer 96FWAQ72E0EMCPMRAF25FBHX78 already completed first payment
{"ts":"2025-12-05T21:15:02.671Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"4e4de781-d4b8-4b88-b67c-dd1197fd1383","stage":"payment","correlationId":"payment-updated:e2e7b4b52fd2c050a62d8d2d"}
{"ts":"2025-12-05T21:15:03.163Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"b6f8c1c4-a21c-4f1c-94e3-b683442bca9f","stage":"payment","correlationId":"payment-updated:ca97068663a67a81953b0fa8","attempts":1}
üí∞ Processing payment completion for customer: 96FWAQ72E0EMCPMRAF25FBHX78
   Payment source_type: CARD
   Payment tender_types: []
Customer 96FWAQ72E0EMCPMRAF25FBHX78 already completed first payment
{"ts":"2025-12-05T21:15:03.439Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"b6f8c1c4-a21c-4f1c-94e3-b683442bca9f","stage":"payment","correlationId":"payment-updated:ca97068663a67a81953b0fa8"}
{"ts":"2025-12-05T21:15:03.943Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"a3e9b1e7-b84a-457b-9f8a-68004b8abff4","stage":"booking","correlationId":"booking-created:12b06fb59afc4aa87c92ea04","attempts":1}
üìÖ Processing booking created for customer: PS3WVQHAJY53HC8A3BV5SRZWDG
Full booking data: {
  "id": "q14s3eoqv6w5wu",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2026-01-04T18:00:00Z",
  "created_at": "2025-12-05T18:49:58Z",
  "updated_at": "2025-12-05T18:49:58Z",
  "customer_id": "PS3WVQHAJY53HC8A3BV5SRZWDG",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "PS3WVQHAJY53HC8A3BV5SRZWDG",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMMHlgFBIFbMTRap",
      "any_team_member": false,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1764609601083,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Kaitlyn S
üéâ First booking detected for customer: PS3WVQHAJY53HC8A3BV5SRZWDG
   Name: Kaitlyn S
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer PS3WVQHAJY53HC8A3BV5SRZWDG...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "c0f2ee04-4762-42c6-a593-a4e745a81c92"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-07-07T19:04:58.383Z",
      "createdAt": "2025-07-07T19:04:58.383Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="c0f2ee04-4762-42c6-a593-a4e745a81c92"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "c0f2ee04-4762-42c6-a593-a4e745a81c92"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: PS3WVQHAJY53HC8A3BV5SRZWDG
{"ts":"2025-12-05T21:15:06.572Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"a3e9b1e7-b84a-457b-9f8a-68004b8abff4","stage":"booking","correlationId":"booking-created:12b06fb59afc4aa87c92ea04"}
{"ts":"2025-12-05T21:15:07.530Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"1b9d6271-ca63-465c-bb2f-c5b47cd84c5c","stage":"payment","correlationId":"payment-updated:c913bce2c2fe3002957f8727","attempts":1}
üí∞ Processing payment completion for customer: G7W0RZF1KE5MS4FSDJP2RPGKMG
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Sandy Scaife
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Sandy Scaife, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Sandy Scaife
   - Email: sdario15@hotmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: G7W0RZF1KE5MS4FSDJP2RPGKMG
{"ts":"2025-12-05T21:15:08.723Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"1b9d6271-ca63-465c-bb2f-c5b47cd84c5c","stage":"payment","correlationId":"payment-updated:c913bce2c2fe3002957f8727"}
{"ts":"2025-12-05T21:15:09.206Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"18fdb366-d479-4c38-8f72-1fa4331f2a79","stage":"payment","correlationId":"payment-updated:264918c4a2bef8516545f5f4","attempts":1}
üí∞ Processing payment completion for customer: G7W0RZF1KE5MS4FSDJP2RPGKMG
   Payment source_type: CARD
   Payment tender_types: []
Customer G7W0RZF1KE5MS4FSDJP2RPGKMG already completed first payment
{"ts":"2025-12-05T21:15:09.655Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"18fdb366-d479-4c38-8f72-1fa4331f2a79","stage":"payment","correlationId":"payment-updated:264918c4a2bef8516545f5f4"}
{"ts":"2025-12-05T21:15:09.961Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"9a765d50-e198-4eb3-8d99-bd9850fc03c9","stage":"booking","correlationId":"booking-created:bf27683f70f4817066286063","attempts":1}
üìÖ Processing booking created for customer: 2BAY720M8WKCHMHN4SPR69BR5C
Full booking data: {
  "id": "mcjpriarepcgcv",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-14T19:30:00Z",
  "created_at": "2025-12-05T19:02:19Z",
  "updated_at": "2025-12-05T19:02:19Z",
  "customer_id": "2BAY720M8WKCHMHN4SPR69BR5C",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMQPbDVvvOCLwqsy"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMNW4SIF7tjp4oM_",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "BRSIGZFOWC6F4ERPKX3CODLU",
      "service_variation_version": 1762893947284,
      "service_variation_client_id": "BRSIGZFOWC6F4ERPKX3CODLU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Erica Coria
üéâ First booking detected for customer: 2BAY720M8WKCHMHN4SPR69BR5C
   Name: Erica Coria
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 2BAY720M8WKCHMHN4SPR69BR5C...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "sq0idp-0WpGrONcXfCcfav3Lkd9Jg:appointments-online-booking-blocking",
      "value": false,
      "version": 2,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-08-26T21:01:43.084Z",
      "createdAt": "2025-06-29T22:07:49.237Z"
    }
  ]
}
   üìã Custom attribute: key="sq0idp-0WpGrONcXfCcfav3Lkd9Jg:appointments-online-booking-blocking", value="false"
   Custom attributes from Square: {
  "sq0idp-0WpGrONcXfCcfav3Lkd9Jg:appointments-online-booking-blocking": false
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 2BAY720M8WKCHMHN4SPR69BR5C
{"ts":"2025-12-05T21:15:10.514Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"9a765d50-e198-4eb3-8d99-bd9850fc03c9","stage":"booking","correlationId":"booking-created:bf27683f70f4817066286063"}
{"ts":"2025-12-05T21:15:12.238Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"0f17b4dc-8212-44ef-86b4-2d7376c1ebf9","stage":"booking","correlationId":"booking-created:79b86b0a9c1c4fb8421cbaf2","attempts":1}
üìÖ Processing booking created for customer: 4Z5G94C9A8B928F5119FYQ1A3C
Full booking data: {
  "id": "lzg4s37uu4st1k",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-14T22:40:00Z",
  "created_at": "2025-12-05T19:02:53Z",
  "updated_at": "2025-12-05T19:02:53Z",
  "customer_id": "4Z5G94C9A8B928F5119FYQ1A3C",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "4Z5G94C9A8B928F5119FYQ1A3C",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMQ7SBwevl5z1-JE",
      "any_team_member": true,
      "duration_minutes": 140,
      "intermission_minutes": 0,
      "service_variation_id": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "service_variation_version": 1764783981722,
      "service_variation_client_id": "CJI5WHOAKSFTASYPJ4MSYZLS"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Callie Ramsey
üéâ First booking detected for customer: 4Z5G94C9A8B928F5119FYQ1A3C
   Name: Callie Ramsey
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 4Z5G94C9A8B928F5119FYQ1A3C...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "0826aee4-d259-434d-be44-511ac61b3629"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-06-06T00:15:03.648Z",
      "createdAt": "2025-06-06T00:15:03.648Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="0826aee4-d259-434d-be44-511ac61b3629"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "0826aee4-d259-434d-be44-511ac61b3629"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 4Z5G94C9A8B928F5119FYQ1A3C
{"ts":"2025-12-05T21:15:13.160Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"0f17b4dc-8212-44ef-86b4-2d7376c1ebf9","stage":"booking","correlationId":"booking-created:79b86b0a9c1c4fb8421cbaf2"}
{"ts":"2025-12-05T21:15:13.377Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"5a87322a-cc24-43bb-92bd-59b899abb651","stage":"booking","correlationId":"booking-created:f74427530be07e8bf7fcf117","attempts":1}
üìÖ Processing booking created for customer: KJGBEX5K1CCHMD0CP9XE89WRJ4
Full booking data: {
  "id": "9a0g0ipzik0xp6",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-08T17:00:00Z",
  "created_at": "2025-12-05T19:05:28Z",
  "updated_at": "2025-12-05T19:05:28Z",
  "customer_id": "KJGBEX5K1CCHMD0CP9XE89WRJ4",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "KJGBEX5K1CCHMD0CP9XE89WRJ4",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMNW4SIF7tjp4oM_",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "BRSIGZFOWC6F4ERPKX3CODLU",
      "service_variation_version": 1764801478862,
      "service_variation_client_id": "BRSIGZFOWC6F4ERPKX3CODLU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Ashley Monk
üéâ First booking detected for customer: KJGBEX5K1CCHMD0CP9XE89WRJ4
   Name: Ashley Monk
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer KJGBEX5K1CCHMD0CP9XE89WRJ4...
   Full custom attributes response: {}
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: KJGBEX5K1CCHMD0CP9XE89WRJ4
{"ts":"2025-12-05T21:15:14.670Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"5a87322a-cc24-43bb-92bd-59b899abb651","stage":"booking","correlationId":"booking-created:f74427530be07e8bf7fcf117"}
{"ts":"2025-12-05T21:15:15.112Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"5944bf21-caa3-4799-9c4a-159e694d38d7","stage":"booking","correlationId":"booking-created:1ac287754f016817052d01e0","attempts":1}
üìÖ Processing booking created for customer: 8TK0HXKWX4QRT2V30XVY647414
Full booking data: {
  "id": "pig9m5kpzdq63f",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-13T23:50:00Z",
  "created_at": "2025-12-05T19:17:10Z",
  "updated_at": "2025-12-05T19:17:10Z",
  "customer_id": "8TK0HXKWX4QRT2V30XVY647414",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "8TK0HXKWX4QRT2V30XVY647414",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMMBgVwykMnOlumA",
      "any_team_member": true,
      "duration_minutes": 140,
      "intermission_minutes": 0,
      "service_variation_id": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "service_variation_version": 1764783981722,
      "service_variation_client_id": "CJI5WHOAKSFTASYPJ4MSYZLS"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Noelle Urciuoli
üéâ First booking detected for customer: 8TK0HXKWX4QRT2V30XVY647414
   Name: Noelle Urciuoli
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 8TK0HXKWX4QRT2V30XVY647414...
   Full custom attributes response: {}
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 8TK0HXKWX4QRT2V30XVY647414
{"ts":"2025-12-05T21:15:15.748Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"5944bf21-caa3-4799-9c4a-159e694d38d7","stage":"booking","correlationId":"booking-created:1ac287754f016817052d01e0"}
{"ts":"2025-12-05T21:15:16.206Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"64e4e4fd-d78e-430b-9408-d53b18841857","stage":"booking","correlationId":"booking-created:f6396b4afd87a51b204b79e2","attempts":1}
üìÖ Processing booking created for customer: TW2JEF01FA528FW9B11ZV58YF8
Full booking data: {
  "id": "tywqeo79xgeukv",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-07T18:00:00Z",
  "created_at": "2025-12-05T19:17:32Z",
  "updated_at": "2025-12-05T19:17:32Z",
  "customer_id": "TW2JEF01FA528FW9B11ZV58YF8",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "TW2JEF01FA528FW9B11ZV58YF8",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "resource_ids": [
        "5OVIQ6GSSUXORACP6T7WBAQ7"
      ],
      "team_member_id": "TMXiw38Bbb7XQUWI",
      "any_team_member": true,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "63PG6RLS2NHWRD5JRXEC74HN",
      "service_variation_version": 1760895536505,
      "service_variation_client_id": "63PG6RLS2NHWRD5JRXEC74HN"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Brittany Helm
üéâ First booking detected for customer: TW2JEF01FA528FW9B11ZV58YF8
   Name: Brittany Helm
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer TW2JEF01FA528FW9B11ZV58YF8...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "af5791f8-348a-422e-98d1-5e865121bb19"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-07-15T16:34:41.333Z",
      "createdAt": "2025-07-15T16:34:41.333Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="af5791f8-348a-422e-98d1-5e865121bb19"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "af5791f8-348a-422e-98d1-5e865121bb19"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: TW2JEF01FA528FW9B11ZV58YF8
{"ts":"2025-12-05T21:15:16.871Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"64e4e4fd-d78e-430b-9408-d53b18841857","stage":"booking","correlationId":"booking-created:f6396b4afd87a51b204b79e2"}
{"ts":"2025-12-05T21:15:18.540Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"7c49e85d-55d1-48fc-88fc-30b394ef81a0","stage":"booking","correlationId":"booking-created:041e8be9a72a35048a8e6e25","attempts":1}
üìÖ Processing booking created for customer: C99T28BPVFXTPNZWJ68ZSXJ5MW
Full booking data: {
  "id": "szadtfw5h7lzty",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-07T22:40:00Z",
  "created_at": "2025-12-05T19:20:37Z",
  "updated_at": "2025-12-05T19:20:37Z",
  "customer_id": "C99T28BPVFXTPNZWJ68ZSXJ5MW",
  "location_id": "LNQKVBTQZN3EZ",
  "customer_note": "I will want a matte top coat, please advise if not available ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "C99T28BPVFXTPNZWJ68ZSXJ5MW",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMMBgVwykMnOlumA",
      "any_team_member": false,
      "duration_minutes": 140,
      "intermission_minutes": 0,
      "service_variation_id": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "service_variation_version": 1764783981722,
      "service_variation_client_id": "CJI5WHOAKSFTASYPJ4MSYZLS"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Noreen Mayer
üéâ First booking detected for customer: C99T28BPVFXTPNZWJ68ZSXJ5MW
   Name: Noreen Mayer
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer C99T28BPVFXTPNZWJ68ZSXJ5MW...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "a7b40271-729a-41aa-801b-fb1fffb83650"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-08-22T18:22:35.997Z",
      "createdAt": "2025-08-22T18:22:35.997Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="a7b40271-729a-41aa-801b-fb1fffb83650"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "a7b40271-729a-41aa-801b-fb1fffb83650"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: C99T28BPVFXTPNZWJ68ZSXJ5MW
{"ts":"2025-12-05T21:15:19.862Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"7c49e85d-55d1-48fc-88fc-30b394ef81a0","stage":"booking","correlationId":"booking-created:041e8be9a72a35048a8e6e25"}
{"ts":"2025-12-05T21:15:20.122Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"07c87fa1-b14d-4b8a-b410-48661da95584","stage":"booking","correlationId":"booking-created:cce81ebf83b436e0fa6e04be","attempts":1}
üìÖ Processing booking created for customer: TBMN0G3EB44FVK99TP38YQFVM0
Full booking data: {
  "id": "rku0b7qc2r1ci3",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-08T21:50:00Z",
  "created_at": "2025-12-05T19:23:11Z",
  "updated_at": "2025-12-05T19:23:11Z",
  "customer_id": "TBMN0G3EB44FVK99TP38YQFVM0",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "TBMN0G3EB44FVK99TP38YQFVM0",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMOscywuGXO2VURY",
      "any_team_member": true,
      "duration_minutes": 140,
      "intermission_minutes": 0,
      "service_variation_id": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "service_variation_version": 1764783981722,
      "service_variation_client_id": "CJI5WHOAKSFTASYPJ4MSYZLS"
    },
    {
      "team_member_id": "TMOscywuGXO2VURY",
      "any_team_member": true,
      "duration_minutes": 10,
      "intermission_minutes": 0,
      "service_variation_id": "6F6F3OAFJSOEN3X7HSXYIVQC",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "WLFVHCXMEWOWRD7UWA5YHD4X"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Emily Richmond
üéâ First booking detected for customer: TBMN0G3EB44FVK99TP38YQFVM0
   Name: Emily Richmond
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer TBMN0G3EB44FVK99TP38YQFVM0...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "c0f2ee04-4762-42c6-a593-a4e745a81c92"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-02-28T17:07:23.435Z",
      "createdAt": "2025-02-28T17:07:23.435Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="c0f2ee04-4762-42c6-a593-a4e745a81c92"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "c0f2ee04-4762-42c6-a593-a4e745a81c92"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: TBMN0G3EB44FVK99TP38YQFVM0
{"ts":"2025-12-05T21:15:21.813Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"07c87fa1-b14d-4b8a-b410-48661da95584","stage":"booking","correlationId":"booking-created:cce81ebf83b436e0fa6e04be"}
{"ts":"2025-12-05T21:15:22.502Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"5bd23098-80c2-49ee-acc4-ccc1d2be74a7","stage":"booking","correlationId":"booking-created:17ca52ab67e8b759ccaae488","attempts":1}
üìÖ Processing booking created for customer: HHC5Z538ZN92RNXH5HP7ADTEDM
Full booking data: {
  "id": "gl9w5cxxtbjcsu",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-27T18:00:00Z",
  "created_at": "2025-12-05T19:28:28Z",
  "updated_at": "2025-12-05T19:28:28Z",
  "customer_id": "HHC5Z538ZN92RNXH5HP7ADTEDM",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "HHC5Z538ZN92RNXH5HP7ADTEDM",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMNW4SIF7tjp4oM_",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "BRSIGZFOWC6F4ERPKX3CODLU",
      "service_variation_version": 1764801478862,
      "service_variation_client_id": "BRSIGZFOWC6F4ERPKX3CODLU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Taylor Pilossoph
üéâ First booking detected for customer: HHC5Z538ZN92RNXH5HP7ADTEDM
   Name: Taylor Pilossoph
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer HHC5Z538ZN92RNXH5HP7ADTEDM...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-07-28T19:04:54.258Z",
      "createdAt": "2025-07-28T19:04:54.258Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: HHC5Z538ZN92RNXH5HP7ADTEDM
{"ts":"2025-12-05T21:15:23.246Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"5bd23098-80c2-49ee-acc4-ccc1d2be74a7","stage":"booking","correlationId":"booking-created:17ca52ab67e8b759ccaae488"}
{"ts":"2025-12-05T21:15:23.546Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"d8f043d8-24dc-4420-9b96-86be811712f0","stage":"booking","correlationId":"booking-created:f23ae60c1ac941a639128900","attempts":1}
üìÖ Processing booking created for customer: WD7E6W81DWP4ZH6JZY2GD6C02R
Full booking data: {
  "id": "6dbuk9m03vxn1j",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-20T18:00:00Z",
  "created_at": "2025-12-05T19:28:41Z",
  "updated_at": "2025-12-05T19:28:41Z",
  "customer_id": "WD7E6W81DWP4ZH6JZY2GD6C02R",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "WD7E6W81DWP4ZH6JZY2GD6C02R",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMXiw38Bbb7XQUWI",
      "any_team_member": true,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1764609601083,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Victoria Lopez
üéâ First booking detected for customer: WD7E6W81DWP4ZH6JZY2GD6C02R
   Name: Victoria Lopez
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer WD7E6W81DWP4ZH6JZY2GD6C02R...
   Full custom attributes response: {}
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: WD7E6W81DWP4ZH6JZY2GD6C02R
{"ts":"2025-12-05T21:15:24.701Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"d8f043d8-24dc-4420-9b96-86be811712f0","stage":"booking","correlationId":"booking-created:f23ae60c1ac941a639128900"}
{"ts":"2025-12-05T21:15:25.445Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"7fa8cbaa-af09-4788-a894-f95c01ba24c1","stage":"customer_ingest","correlationId":"customer-created:be3a2993185d2c97a0dda7bd","attempts":1}
üì• Received customer data: {
  "id": "09CZCTWN6X1S0MDF91DBMDDDHG",
  "version": 0,
  "created_at": "2025-12-05T19:37:14.235Z",
  "given_name": "Yvonne",
  "updated_at": "2025-12-05T19:37:14Z",
  "family_name": "Powless",
  "preferences": {
    "email_unsubscribed": false
  },
  "phone_number": "+17187029052",
  "email_address": "ypowless@gmail.com",
  "creation_source": "THIRD_PARTY"
}
üë§ Processing customer creation: 09CZCTWN6X1S0MDF91DBMDDDHG
üìç IP Address: unknown
üìß Email: ypowless@gmail.com
üìû Phone: +17187029052
üë§ Name: Yvonne Powless
‚ö†Ô∏è Suspicious IP activity detected: unknown used by 147 customers
‚ö†Ô∏è Suspicious activity detected for customer 09CZCTWN6X1S0MDF91DBMDDDHG, flagging for review
üéâ New customer detected: 09CZCTWN6X1S0MDF91DBMDDDHG
‚úÖ Customer added to database as NEW (temporary mark)
   - Will check for referral code when they book
   - Will give gift card on first booking if code found
‚úÖ Verification: Customer found in DB: true
{"ts":"2025-12-05T21:15:27.475Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"7fa8cbaa-af09-4788-a894-f95c01ba24c1","stage":"customer_ingest","correlationId":"customer-created:be3a2993185d2c97a0dda7bd"}
{"ts":"2025-12-05T21:15:28.512Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"f553baec-626e-4a02-9bce-321c4136bc56","stage":"payment","correlationId":"payment-updated:ef77a86999985412e38c5fe7","attempts":1}
üí∞ Processing payment completion for customer: 2920R4JFG1X2F43FSWJV8B3F9W
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Kaprice Simmons
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Kaprice Simmons, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Kaprice Simmons
   - Email: Kaprice.simmons@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: 2920R4JFG1X2F43FSWJV8B3F9W
{"ts":"2025-12-05T21:15:31.747Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"f553baec-626e-4a02-9bce-321c4136bc56","stage":"payment","correlationId":"payment-updated:ef77a86999985412e38c5fe7"}
{"ts":"2025-12-05T21:15:32.330Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"3f9fe7c2-f87f-495a-bf34-093da4b85f58","stage":"booking","correlationId":"booking-created:46360b4353492b01b6068357","attempts":1}
üìÖ Processing booking created for customer: 6PQ82YBVJ5G1WRQ46A1KR3KWBM
Full booking data: {
  "id": "8iw2wj97br7b4n",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-06T22:20:00Z",
  "created_at": "2025-12-05T19:43:07Z",
  "updated_at": "2025-12-05T19:43:07Z",
  "customer_id": "6PQ82YBVJ5G1WRQ46A1KR3KWBM",
  "location_id": "LNQKVBTQZN3EZ",
  "seller_note": "–±–µ—Å–ø–ª–∞—Ç–Ω–æ –∑–∞ —Å—á–µ—Ç –¥–∞—Ä–∏–º—ã, –≤–æ–∑–º–æ–∂–Ω–æ —ç—Ç–æ —Ñ–∏–∫—Å –ø–∞—Ä—É –Ω–æ–≥—Ç–µ–π - –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É–∑–Ω–∞—Ç—å",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMaVpirfZhWw5oM-"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMdagA6g0F03A7_w",
      "any_team_member": false,
      "duration_minutes": 140,
      "intermission_minutes": 0,
      "service_variation_id": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "service_variation_version": 1764783981722,
      "service_variation_client_id": "CJI5WHOAKSFTASYPJ4MSYZLS"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Candice Adden
üéâ First booking detected for customer: 6PQ82YBVJ5G1WRQ46A1KR3KWBM
   Name: Candice Adden
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 6PQ82YBVJ5G1WRQ46A1KR3KWBM...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-11-02T20:59:34.231Z",
      "createdAt": "2025-11-02T20:59:34.231Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 6PQ82YBVJ5G1WRQ46A1KR3KWBM
{"ts":"2025-12-05T21:15:33.466Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"3f9fe7c2-f87f-495a-bf34-093da4b85f58","stage":"booking","correlationId":"booking-created:46360b4353492b01b6068357"}
{"ts":"2025-12-05T21:15:33.826Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"94b19c8d-9368-413e-8108-d4dd9f99a32e","stage":"payment","correlationId":"payment-updated:b1e40eaa751ba3e3629479b1","attempts":1}
üí∞ Processing payment completion for customer: 2920R4JFG1X2F43FSWJV8B3F9W
   Payment source_type: CARD
   Payment tender_types: []
Customer 2920R4JFG1X2F43FSWJV8B3F9W already completed first payment
{"ts":"2025-12-05T21:15:34.290Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"94b19c8d-9368-413e-8108-d4dd9f99a32e","stage":"payment","correlationId":"payment-updated:b1e40eaa751ba3e3629479b1"}
{"ts":"2025-12-05T21:15:34.612Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"cc7cf747-fd90-498e-879b-2a397db27369","stage":"payment","correlationId":"payment-updated:0f607551ed35856bcea246a1","attempts":1}
üí∞ Processing payment completion for customer: 45X70Y0FDJT4DP33NVCW32NEM8
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Katie Kang
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Katie Kang, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Katie Kang
   - Email: Katiekanggg@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: 45X70Y0FDJT4DP33NVCW32NEM8
{"ts":"2025-12-05T21:15:35.138Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"cc7cf747-fd90-498e-879b-2a397db27369","stage":"payment","correlationId":"payment-updated:0f607551ed35856bcea246a1"}
{"ts":"2025-12-05T21:15:35.412Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"c7e3c419-c1ab-4db7-a6fa-3dba5cb0ea65","stage":"payment","correlationId":"payment-updated:899a920f32980600c3a1925a","attempts":1}
üí∞ Processing payment completion for customer: 45X70Y0FDJT4DP33NVCW32NEM8
   Payment source_type: CARD
   Payment tender_types: []
Customer 45X70Y0FDJT4DP33NVCW32NEM8 already completed first payment
{"ts":"2025-12-05T21:15:36.337Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"c7e3c419-c1ab-4db7-a6fa-3dba5cb0ea65","stage":"payment","correlationId":"payment-updated:899a920f32980600c3a1925a"}
{"ts":"2025-12-05T21:15:36.693Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"e26731c3-5774-463c-b9a8-54864b00431b","stage":"booking","correlationId":"booking-created:719e2c853f9b2a66bbee8c85","attempts":1}
üìÖ Processing booking created for customer: 2920R4JFG1X2F43FSWJV8B3F9W
Full booking data: {
  "id": "gf42pyjfvvsatx",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-19T21:40:00Z",
  "created_at": "2025-12-05T19:43:55Z",
  "updated_at": "2025-12-05T19:43:55Z",
  "customer_id": "2920R4JFG1X2F43FSWJV8B3F9W",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMWAtQTYmZpwwxii"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMEWAZHdtaiRR_Zs",
      "any_team_member": false,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1764609601083,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Kaprice Simmons
üéâ First booking detected for customer: 2920R4JFG1X2F43FSWJV8B3F9W
   Name: Kaprice Simmons
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 2920R4JFG1X2F43FSWJV8B3F9W...
   Full custom attributes response: {}
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 2920R4JFG1X2F43FSWJV8B3F9W
{"ts":"2025-12-05T21:15:37.528Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"e26731c3-5774-463c-b9a8-54864b00431b","stage":"booking","correlationId":"booking-created:719e2c853f9b2a66bbee8c85"}
{"ts":"2025-12-05T21:15:38.213Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"926c8239-e887-4ba9-94d9-0a526538de3d","stage":"payment","correlationId":"payment-updated:db562a3a1f1bf1ff7c895daf","attempts":1}
üí∞ Processing payment completion for customer: XDD5BBZKVEEGX6PKFS2F56XY8C
   Payment source_type: CARD
   Payment tender_types: []
Customer XDD5BBZKVEEGX6PKFS2F56XY8C already completed first payment
{"ts":"2025-12-05T21:15:38.438Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"926c8239-e887-4ba9-94d9-0a526538de3d","stage":"payment","correlationId":"payment-updated:db562a3a1f1bf1ff7c895daf"}
{"ts":"2025-12-05T21:15:38.714Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"9e87080b-6e15-44ed-99a2-680029cdbab0","stage":"payment","correlationId":"payment-updated:70ec188f86ca455118068675","attempts":1}
üí∞ Processing payment completion for customer: XDD5BBZKVEEGX6PKFS2F56XY8C
   Payment source_type: CARD
   Payment tender_types: []
Customer XDD5BBZKVEEGX6PKFS2F56XY8C already completed first payment
{"ts":"2025-12-05T21:15:38.931Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"9e87080b-6e15-44ed-99a2-680029cdbab0","stage":"payment","correlationId":"payment-updated:70ec188f86ca455118068675"}
{"ts":"2025-12-05T21:15:39.251Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"0af6102d-b897-45b6-a791-b653a132c0b4","stage":"payment","correlationId":"payment-updated:e6a7f8d898a4b8dfa8c93b13","attempts":1}
üí∞ Processing payment completion for customer: 02KFRKP8HZ6YSJ8A14F3CPAGN4
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Lindsey Fenner
‚ùå Referrer not found for code: null
‚úÖ Generated new personal_code in name+ID format: LINDSEY1434
‚úÖ Created gift card for Lindsey Fenner: gftc:2f32bdd66ea44641873221c0e01c2744
‚úÖ Linked gift card gftc:2f32bdd66ea44641873221c0e01c2744 to customer 02KFRKP8HZ6YSJ8A14F3CPAGN4
   Gift card will now appear in customer's profile in Square
üìã Verification:
   State: PENDING
   Balance: $0
‚úÖ Created new referrer gift card: gftc:2f32bdd66ea44641873221c0e01c2744
‚úÖ Upserted custom attribute "square:a3dde506-f69e-48e4-a98a-004c1822d3ad" for customer 02KFRKP8HZ6YSJ8A14F3CPAGN4
üìù Added referral code LINDSEY1434 to customer 02KFRKP8HZ6YSJ8A14F3CPAGN4 notes
‚úÖ Referral email sent to Lindseyfenner@yahoo.com
‚úÖ Referral email sent successfully to Lindseyfenner@yahoo.com
‚ùå Failed to send SMS to +18156009303: (0 , account_1.AccountListInstance) is not a function
‚ùå Failed to send SMS to +18156009303: (0 , account_1.AccountListInstance) is not a function
üìß Referral code generated and sent:
   - Customer: Lindsey Fenner
   - Email: Lindseyfenner@yahoo.com
   - Referral Code: LINDSEY1434
   - Referral URL: https://zorinastudio-referral.com/ref/LINDSEY1434
   - Gift Card ID: gftc:2f32bdd66ea44641873221c0e01c2744
   - Status: Customer is now a referrer
‚úÖ Referral code sent to new client:
   - Customer: Lindsey Fenner
   - Email: Lindseyfenner@yahoo.com
   - Referral Code: LINDSEY1434
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: 02KFRKP8HZ6YSJ8A14F3CPAGN4
{"ts":"2025-12-05T21:15:44.117Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"0af6102d-b897-45b6-a791-b653a132c0b4","stage":"payment","correlationId":"payment-updated:e6a7f8d898a4b8dfa8c93b13"}
{"ts":"2025-12-05T21:15:44.369Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"fc34756e-6c6e-4249-b5b4-51d2d8e76b00","stage":"payment","correlationId":"payment-updated:3abff8eaa9c89bb45f24ca71","attempts":1}
üí∞ Processing payment completion for customer: 02KFRKP8HZ6YSJ8A14F3CPAGN4
   Payment source_type: CARD
   Payment tender_types: []
Customer 02KFRKP8HZ6YSJ8A14F3CPAGN4 already completed first payment
{"ts":"2025-12-05T21:15:45.144Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"fc34756e-6c6e-4249-b5b4-51d2d8e76b00","stage":"payment","correlationId":"payment-updated:3abff8eaa9c89bb45f24ca71"}
{"ts":"2025-12-05T21:15:45.580Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"6f255977-291e-4765-b1aa-f5d3993fc8b3","stage":"booking","correlationId":"booking-created:b971c8e68633577dd3974009","attempts":1}
üìÖ Processing booking created for customer: H97D7444TYA9TVZQGN0MYRC14G
Full booking data: {
  "id": "q1rqv385kx3ize",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-06T21:05:00Z",
  "created_at": "2025-12-05T20:23:54Z",
  "updated_at": "2025-12-05T20:23:54Z",
  "customer_id": "H97D7444TYA9TVZQGN0MYRC14G",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "H97D7444TYA9TVZQGN0MYRC14G",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMOscywuGXO2VURY",
      "any_team_member": true,
      "duration_minutes": 45,
      "intermission_minutes": 0,
      "service_variation_id": "VVA7G2UN7N2HUFMCW5LQOVHB",
      "service_variation_version": 1764783981722,
      "service_variation_client_id": "VVA7G2UN7N2HUFMCW5LQOVHB"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Elizabeth Bradburn
üéâ First booking detected for customer: H97D7444TYA9TVZQGN0MYRC14G
   Name: Elizabeth Bradburn
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer H97D7444TYA9TVZQGN0MYRC14G...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-11-18T00:01:57.736Z",
      "createdAt": "2025-11-18T00:01:57.736Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: H97D7444TYA9TVZQGN0MYRC14G
{"ts":"2025-12-05T21:15:46.331Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"6f255977-291e-4765-b1aa-f5d3993fc8b3","stage":"booking","correlationId":"booking-created:b971c8e68633577dd3974009"}
{"ts":"2025-12-05T21:15:46.798Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"57822fd3-0656-40d5-b660-0d6c5daf4101","stage":"booking","correlationId":"booking-created:a102a3fd0eb1135b84ca0be9","attempts":1}
üìÖ Processing booking created for customer: 51Q2FNTC3C9BCS0FB3PYWC16XW
Full booking data: {
  "id": "cx8sqcyfdr88mt",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-08T21:40:00Z",
  "created_at": "2025-12-05T20:30:21Z",
  "updated_at": "2025-12-05T20:30:21Z",
  "customer_id": "51Q2FNTC3C9BCS0FB3PYWC16XW",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "51Q2FNTC3C9BCS0FB3PYWC16XW",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMEWAZHdtaiRR_Zs",
      "any_team_member": true,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1764609601083,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    },
    {
      "team_member_id": "TMEWAZHdtaiRR_Zs",
      "any_team_member": true,
      "duration_minutes": 20,
      "intermission_minutes": 0,
      "service_variation_id": "HAJX45W3U2WUCCXM5MI24UEE",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "HAJX45W3U2WUCCXM5MI24UEE"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Alyssa Carl
üéâ First booking detected for customer: 51Q2FNTC3C9BCS0FB3PYWC16XW
   Name: Alyssa Carl
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 51Q2FNTC3C9BCS0FB3PYWC16XW...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "af5791f8-348a-422e-98d1-5e865121bb19"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-10-25T05:11:15.796Z",
      "createdAt": "2025-10-25T05:11:15.796Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="af5791f8-348a-422e-98d1-5e865121bb19"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "af5791f8-348a-422e-98d1-5e865121bb19"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 51Q2FNTC3C9BCS0FB3PYWC16XW
{"ts":"2025-12-05T21:15:47.632Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"57822fd3-0656-40d5-b660-0d6c5daf4101","stage":"booking","correlationId":"booking-created:a102a3fd0eb1135b84ca0be9"}
{"ts":"2025-12-05T21:15:48.192Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"b45e7576-6e6b-493d-93a8-c5f30d2a39fb","stage":"booking","correlationId":"booking-created:bb6b518c3e2db597478e788d","attempts":1}
üìÖ Processing booking created for customer: Q4WSB4NTNXWG9HSTJ5NEEWSMYW
Full booking data: {
  "id": "k4i7amnleug3ff",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2026-01-03T19:30:00Z",
  "created_at": "2025-12-05T20:31:34Z",
  "updated_at": "2025-12-05T20:31:34Z",
  "customer_id": "Q4WSB4NTNXWG9HSTJ5NEEWSMYW",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "Q4WSB4NTNXWG9HSTJ5NEEWSMYW",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMNW4SIF7tjp4oM_",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "BRSIGZFOWC6F4ERPKX3CODLU",
      "service_variation_version": 1764801478862,
      "service_variation_client_id": "BRSIGZFOWC6F4ERPKX3CODLU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Neda Nguyen
üéâ First booking detected for customer: Q4WSB4NTNXWG9HSTJ5NEEWSMYW
   Name: Neda Nguyen
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer Q4WSB4NTNXWG9HSTJ5NEEWSMYW...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-11-17T04:17:27.670Z",
      "createdAt": "2025-11-17T04:17:27.670Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: Q4WSB4NTNXWG9HSTJ5NEEWSMYW
{"ts":"2025-12-05T21:15:49.030Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"b45e7576-6e6b-493d-93a8-c5f30d2a39fb","stage":"booking","correlationId":"booking-created:bb6b518c3e2db597478e788d"}
{"ts":"2025-12-05T21:15:49.503Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"7a342bdd-2301-4cee-8233-124a793d11fe","stage":"booking","correlationId":"booking-created:8fae84118301c0fee312a09f","attempts":1}
üìÖ Processing booking created for customer: 09CZCTWN6X1S0MDF91DBMDDDHG
Full booking data: {
  "id": "azyiwe844f0e3s",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-05T23:15:00Z",
  "created_at": "2025-12-05T20:45:13Z",
  "updated_at": "2025-12-05T20:45:13Z",
  "customer_id": "09CZCTWN6X1S0MDF91DBMDDDHG",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMQPbDVvvOCLwqsy"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMkdrQsxG5tlf-c_",
      "any_team_member": false,
      "duration_minutes": 140,
      "intermission_minutes": 0,
      "service_variation_id": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "service_variation_version": 1764783981722,
      "service_variation_client_id": "CJI5WHOAKSFTASYPJ4MSYZLS"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Yvonne Powless
üéâ First booking detected for customer: 09CZCTWN6X1S0MDF91DBMDDDHG
   Name: Yvonne Powless
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 09CZCTWN6X1S0MDF91DBMDDDHG...
   Full custom attributes response: {}
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 09CZCTWN6X1S0MDF91DBMDDDHG
{"ts":"2025-12-05T21:15:50.249Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"7a342bdd-2301-4cee-8233-124a793d11fe","stage":"booking","correlationId":"booking-created:8fae84118301c0fee312a09f"}
{"ts":"2025-12-05T21:15:50.679Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"896f85d1-ae08-4d3b-85d7-3bf90eb9e534","stage":"customer_ingest","correlationId":"customer-created:b35f4f6f6f086a5b23e80e6a","attempts":1}
üì• Received customer data: {
  "id": "JEFY4FW7GVJDJX0SMPMT7FSAWC",
  "version": 0,
  "created_at": "2025-12-05T20:45:29.284Z",
  "given_name": "Louise",
  "updated_at": "2025-12-05T20:45:29Z",
  "family_name": "Aiello",
  "preferences": {
    "email_unsubscribed": false
  },
  "phone_number": "+16502231662",
  "email_address": "louise.laughlin@gmail.com",
  "creation_source": "THIRD_PARTY"
}
üë§ Processing customer creation: JEFY4FW7GVJDJX0SMPMT7FSAWC
üìç IP Address: unknown
üìß Email: louise.laughlin@gmail.com
üìû Phone: +16502231662
üë§ Name: Louise Aiello
‚ö†Ô∏è Suspicious IP activity detected: unknown used by 148 customers
‚ö†Ô∏è Suspicious activity detected for customer JEFY4FW7GVJDJX0SMPMT7FSAWC, flagging for review
üéâ New customer detected: JEFY4FW7GVJDJX0SMPMT7FSAWC
‚úÖ Customer added to database as NEW (temporary mark)
   - Will check for referral code when they book
   - Will give gift card on first booking if code found
‚úÖ Verification: Customer found in DB: true
{"ts":"2025-12-05T21:15:51.556Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"896f85d1-ae08-4d3b-85d7-3bf90eb9e534","stage":"customer_ingest","correlationId":"customer-created:b35f4f6f6f086a5b23e80e6a"}
{"ts":"2025-12-05T21:15:51.949Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"8caa2f30-4058-4f3b-a993-d1b4de432ab0","stage":"booking","correlationId":"booking-created:e73e23d2596d915fae06e65b","attempts":1}
üìÖ Processing booking created for customer: JEFY4FW7GVJDJX0SMPMT7FSAWC
Full booking data: {
  "id": "efqpjrlrfe0fzz",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-06T18:00:00Z",
  "created_at": "2025-12-05T20:49:19Z",
  "updated_at": "2025-12-05T20:49:19Z",
  "customer_id": "JEFY4FW7GVJDJX0SMPMT7FSAWC",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMWAtQTYmZpwwxii"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMdagA6g0F03A7_w",
      "any_team_member": false,
      "duration_minutes": 140,
      "intermission_minutes": 0,
      "service_variation_id": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "service_variation_version": 1764783981722,
      "service_variation_client_id": "CJI5WHOAKSFTASYPJ4MSYZLS"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Louise Aiello
üéâ First booking detected for customer: JEFY4FW7GVJDJX0SMPMT7FSAWC
   Name: Louise Aiello
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer JEFY4FW7GVJDJX0SMPMT7FSAWC...
   Full custom attributes response: {}
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: JEFY4FW7GVJDJX0SMPMT7FSAWC
{"ts":"2025-12-05T21:15:52.441Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"8caa2f30-4058-4f3b-a993-d1b4de432ab0","stage":"booking","correlationId":"booking-created:e73e23d2596d915fae06e65b"}
{"ts":"2025-12-05T21:15:52.662Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"2fd88fb9-4579-4b2c-a75c-c24ed65b1152","stage":"payment","correlationId":"payment-updated:cbd40610c25fcd07fa26f235","attempts":1}
üí∞ Processing payment completion for customer: ZF2EJM26DMRS4ZN29MR8XGMVR0
   Payment source_type: CASH
   Payment tender_types: []
üéâ First payment completed for customer: Olga Svatikova
‚ùå Referrer not found for code: null
‚úÖ First payment processing completed for customer: ZF2EJM26DMRS4ZN29MR8XGMVR0
{"ts":"2025-12-05T21:15:53.538Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"2fd88fb9-4579-4b2c-a75c-c24ed65b1152","stage":"payment","correlationId":"payment-updated:cbd40610c25fcd07fa26f235"}
{"ts":"2025-12-05T21:15:53.961Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"24525224-fb30-4592-9b14-f47fd4628e64","stage":"payment","correlationId":"payment-updated:32a40126256e1a9f0384a6fa","attempts":1}
üí∞ Processing payment completion for customer: FZRAFVTE75MNN3KTQM1KZN6P4W
   Payment source_type: CARD
   Payment tender_types: []
Customer FZRAFVTE75MNN3KTQM1KZN6P4W already completed first payment
{"ts":"2025-12-05T21:15:54.339Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"24525224-fb30-4592-9b14-f47fd4628e64","stage":"payment","correlationId":"payment-updated:32a40126256e1a9f0384a6fa"}
{"ts":"2025-12-05T21:15:54.687Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"bc06d059-6d92-4996-8aa5-df7e209a0471","stage":"payment","correlationId":"payment-updated:8cf038cf36df0c7a6618dc43","attempts":1}
üí∞ Processing payment completion for customer: FZRAFVTE75MNN3KTQM1KZN6P4W
   Payment source_type: CARD
   Payment tender_types: []
Customer FZRAFVTE75MNN3KTQM1KZN6P4W already completed first payment
{"ts":"2025-12-05T21:15:54.871Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"bc06d059-6d92-4996-8aa5-df7e209a0471","stage":"payment","correlationId":"payment-updated:8cf038cf36df0c7a6618dc43"}
{"ts":"2025-12-05T21:15:55.491Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"a94716d2-3afe-439f-b91b-5c23cd82e2a8","stage":"customer_ingest","correlationId":"customer-created:8decdd0cf046e45f8df20d8b","attempts":1}
üì• Received customer data: {
  "id": "NXFMKX4220MJVTX6E31VTA3Q3R",
  "version": 0,
  "created_at": "2025-12-05T21:03:45.817Z",
  "given_name": "Sarah",
  "updated_at": "2025-12-05T21:03:45Z",
  "family_name": "Kefayati",
  "preferences": {
    "email_unsubscribed": false
  },
  "phone_number": "+14158159264",
  "email_address": "sara61@gmail.com",
  "creation_source": "THIRD_PARTY"
}
üë§ Processing customer creation: NXFMKX4220MJVTX6E31VTA3Q3R
üìç IP Address: unknown
üìß Email: sara61@gmail.com
üìû Phone: +14158159264
üë§ Name: Sarah Kefayati
‚ö†Ô∏è Suspicious IP activity detected: unknown used by 149 customers
‚ö†Ô∏è Suspicious activity detected for customer NXFMKX4220MJVTX6E31VTA3Q3R, flagging for review
üéâ New customer detected: NXFMKX4220MJVTX6E31VTA3Q3R
‚úÖ Customer added to database as NEW (temporary mark)
   - Will check for referral code when they book
   - Will give gift card on first booking if code found
‚úÖ Verification: Customer found in DB: true
{"ts":"2025-12-05T21:15:56.059Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"a94716d2-3afe-439f-b91b-5c23cd82e2a8","stage":"customer_ingest","correlationId":"customer-created:8decdd0cf046e45f8df20d8b"}
{"ts":"2025-12-05T21:15:56.848Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"b5c490f4-db67-4353-812d-6756a62c98f4","stage":"payment","correlationId":"payment-updated:0d4a74a31f8d6c9e0be174cb","attempts":1}
üí∞ Processing payment completion for customer: HHC5Z538ZN92RNXH5HP7ADTEDM
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Taylor Pilossoph
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Taylor Pilossoph, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Taylor Pilossoph
   - Email: taylorjuliep@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: HHC5Z538ZN92RNXH5HP7ADTEDM
{"ts":"2025-12-05T21:15:57.898Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"b5c490f4-db67-4353-812d-6756a62c98f4","stage":"payment","correlationId":"payment-updated:0d4a74a31f8d6c9e0be174cb"}
{"ts":"2025-12-05T21:15:58.370Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"fe912b2f-88a8-48ed-9527-497e6565254c","stage":"payment","correlationId":"payment-updated:bc98f9decda8ce34d6eddc3e","attempts":1}
üí∞ Processing payment completion for customer: HHC5Z538ZN92RNXH5HP7ADTEDM
   Payment source_type: CARD
   Payment tender_types: []
Customer HHC5Z538ZN92RNXH5HP7ADTEDM already completed first payment
{"ts":"2025-12-05T21:15:58.639Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"fe912b2f-88a8-48ed-9527-497e6565254c","stage":"payment","correlationId":"payment-updated:bc98f9decda8ce34d6eddc3e"}
{"ts":"2025-12-05T21:15:58.856Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"dbd6a802-3d95-4776-b7c6-bb190165a939","stage":"payment","correlationId":"payment-updated:cc06e0a68b9aaa994113b002","attempts":1}
üí∞ Processing payment completion for customer: HHC5Z538ZN92RNXH5HP7ADTEDM
   Payment source_type: CARD
   Payment tender_types: []
Customer HHC5Z538ZN92RNXH5HP7ADTEDM already completed first payment
{"ts":"2025-12-05T21:15:59.264Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"dbd6a802-3d95-4776-b7c6-bb190165a939","stage":"payment","correlationId":"payment-updated:cc06e0a68b9aaa994113b002"}
{"ts":"2025-12-05T21:15:59.478Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"aebc20cd-cf8c-498d-892c-b5ca7e7f4bfa","stage":"payment","correlationId":"payment-updated:1f93817baec7cfd2fac2d7ab","attempts":1}
üí∞ Processing payment completion for customer: HHC5Z538ZN92RNXH5HP7ADTEDM
   Payment source_type: CARD
   Payment tender_types: []
Customer HHC5Z538ZN92RNXH5HP7ADTEDM already completed first payment
{"ts":"2025-12-05T21:15:59.730Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"aebc20cd-cf8c-498d-892c-b5ca7e7f4bfa","stage":"payment","correlationId":"payment-updated:1f93817baec7cfd2fac2d7ab"}
{"ts":"2025-12-05T21:23:41.810Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"20c89e4f-c4ae-4a60-b416-f919f533836c","stage":"payment","correlationId":"payment-updated:d117436c8aafaa1d52ce4853","attempts":1}
üí∞ Processing payment completion for customer: QVE4HKZ24YCPJRS18R77W80XTG
   Payment source_type: CARD
   Payment tender_types: []
Customer QVE4HKZ24YCPJRS18R77W80XTG already completed first payment
{"ts":"2025-12-05T21:23:44.954Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"20c89e4f-c4ae-4a60-b416-f919f533836c","stage":"payment","correlationId":"payment-updated:d117436c8aafaa1d52ce4853"}
{"ts":"2025-12-05T21:23:49.154Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"b062d411-e331-45d8-9e01-857e9870fec9","stage":"payment","correlationId":"payment-updated:846a4e4199ce1352e5019f50","attempts":1}
üí∞ Processing payment completion for customer: QVE4HKZ24YCPJRS18R77W80XTG
   Payment source_type: CARD
   Payment tender_types: []
Customer QVE4HKZ24YCPJRS18R77W80XTG already completed first payment
{"ts":"2025-12-05T21:23:50.200Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"b062d411-e331-45d8-9e01-857e9870fec9","stage":"payment","correlationId":"payment-updated:846a4e4199ce1352e5019f50"}
{"ts":"2025-12-05T21:24:23.360Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"50acc81b-3b20-44a4-bc06-929b2a858304","stage":"payment","correlationId":"payment-updated:8eb708c74b1f2e6f88e4bbd3","attempts":1}
üí∞ Processing payment completion for customer: GG297W5VQ17G3EFP15GZQ47YE8
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Davita Lesch
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Davita Lesch, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Davita Lesch
   - Email: davitalesch18@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: GG297W5VQ17G3EFP15GZQ47YE8
{"ts":"2025-12-05T21:24:29.826Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"50acc81b-3b20-44a4-bc06-929b2a858304","stage":"payment","correlationId":"payment-updated:8eb708c74b1f2e6f88e4bbd3"}
{"ts":"2025-12-05T21:24:31.625Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"b258a3b0-6c15-4568-aa80-8645c37c2a4a","stage":"payment","correlationId":"payment-updated:4dee6592e2cfd6c5fe642ff9","attempts":1}
üí∞ Processing payment completion for customer: GG297W5VQ17G3EFP15GZQ47YE8
   Payment source_type: CARD
   Payment tender_types: []
Customer GG297W5VQ17G3EFP15GZQ47YE8 already completed first payment
{"ts":"2025-12-05T21:24:32.673Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"b258a3b0-6c15-4568-aa80-8645c37c2a4a","stage":"payment","correlationId":"payment-updated:4dee6592e2cfd6c5fe642ff9"}
{"ts":"2025-12-05T21:38:49.278Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"8f79d886-f92d-4e21-875a-44d6fc8fd2fb","stage":"payment","correlationId":"payment-updated:5fb7c82e76def628e9e74e58","attempts":1}
üí∞ Processing payment completion for customer: V9EEXWBNGTBG998HJPHB80WS7W
   Payment source_type: CARD
   Payment tender_types: []
Customer V9EEXWBNGTBG998HJPHB80WS7W already completed first payment
{"ts":"2025-12-05T21:38:53.158Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"8f79d886-f92d-4e21-875a-44d6fc8fd2fb","stage":"payment","correlationId":"payment-updated:5fb7c82e76def628e9e74e58"}
{"ts":"2025-12-05T21:38:54.310Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"1e04fe7c-b042-4b0c-aca0-88cb34a40609","stage":"payment","correlationId":"payment-updated:e522b4f24286dc8d8437463c","attempts":1}
üí∞ Processing payment completion for customer: V9EEXWBNGTBG998HJPHB80WS7W
   Payment source_type: CARD
   Payment tender_types: []
Customer V9EEXWBNGTBG998HJPHB80WS7W already completed first payment
{"ts":"2025-12-05T21:38:55.221Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"1e04fe7c-b042-4b0c-aca0-88cb34a40609","stage":"payment","correlationId":"payment-updated:e522b4f24286dc8d8437463c"}
{"ts":"2025-12-05T21:39:40.981Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"2d3ac832-da87-49af-bea9-9d154293b7fd","stage":"payment","correlationId":"payment-updated:8e76a507f8e7abb05dc7352d","attempts":1}
üí∞ Processing payment completion for customer: V9EEXWBNGTBG998HJPHB80WS7W
   Payment source_type: CARD
   Payment tender_types: []
Customer V9EEXWBNGTBG998HJPHB80WS7W already completed first payment
{"ts":"2025-12-05T21:39:42.960Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"2d3ac832-da87-49af-bea9-9d154293b7fd","stage":"payment","correlationId":"payment-updated:8e76a507f8e7abb05dc7352d"}
{"ts":"2025-12-05T21:39:44.044Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"0012f602-774e-4e3e-ac51-3db9063c653f","stage":"payment","correlationId":"payment-updated:16c3c25bc836890b75093cd2","attempts":1}
üí∞ Processing payment completion for customer: V9EEXWBNGTBG998HJPHB80WS7W
   Payment source_type: CARD
   Payment tender_types: []
Customer V9EEXWBNGTBG998HJPHB80WS7W already completed first payment
{"ts":"2025-12-05T21:39:45.256Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"0012f602-774e-4e3e-ac51-3db9063c653f","stage":"payment","correlationId":"payment-updated:16c3c25bc836890b75093cd2"}
{"ts":"2025-12-05T21:49:45.784Z","level":"error","event":"giftcard.worker.loop_error","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-05T21:50:52.835Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"bb489cc7-e527-4aac-a373-e1524dbd1332","stage":"booking","correlationId":"booking-created:e45afe93338e7627eadc7d3e","attempts":1}
üìÖ Processing booking created for customer: 6NR3S25JYN40YN952KH04SSPEC
Full booking data: {
  "id": "m226quujpvnxzo",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-13T19:30:00Z",
  "created_at": "2025-12-05T21:50:50Z",
  "updated_at": "2025-12-05T21:50:50Z",
  "customer_id": "6NR3S25JYN40YN952KH04SSPEC",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "6NR3S25JYN40YN952KH04SSPEC",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TM9jDlRr_Hl4rdBB",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "XBUDIMNKOPC2XVG5YLIQ4RYS",
      "service_variation_version": 1764801478862,
      "service_variation_client_id": "XBUDIMNKOPC2XVG5YLIQ4RYS"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Revathi Anilkumar
üéâ First booking detected for customer: 6NR3S25JYN40YN952KH04SSPEC
   Name: Revathi Anilkumar
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 6NR3S25JYN40YN952KH04SSPEC...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-11-05T05:42:05.569Z",
      "createdAt": "2025-11-05T05:42:05.569Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 6NR3S25JYN40YN952KH04SSPEC
{"ts":"2025-12-05T21:50:56.626Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"bb489cc7-e527-4aac-a373-e1524dbd1332","stage":"booking","correlationId":"booking-created:e45afe93338e7627eadc7d3e"}
{"ts":"2025-12-05T21:59:26.535Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"337c5bb5-5603-4be0-806c-c977a40fb517","stage":"booking","correlationId":"booking-created:16d283fcc8a64eaedf46ce5f","attempts":1}
üìÖ Processing booking created for customer: A03SZBP1TQJJV8KBKQ7MTSR5H8
Full booking data: {
  "id": "r6yyvsx8jznjb9",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-12T21:50:00Z",
  "created_at": "2025-12-05T21:59:22Z",
  "updated_at": "2025-12-05T21:59:22Z",
  "customer_id": "A03SZBP1TQJJV8KBKQ7MTSR5H8",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "A03SZBP1TQJJV8KBKQ7MTSR5H8",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMOscywuGXO2VURY",
      "any_team_member": true,
      "duration_minutes": 140,
      "intermission_minutes": 0,
      "service_variation_id": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "service_variation_version": 1764783981722,
      "service_variation_client_id": "CJI5WHOAKSFTASYPJ4MSYZLS"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Sarah Gorman
üéâ First booking detected for customer: A03SZBP1TQJJV8KBKQ7MTSR5H8
   Name: Sarah Gorman
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer A03SZBP1TQJJV8KBKQ7MTSR5H8...
   Full custom attributes response: {}
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: A03SZBP1TQJJV8KBKQ7MTSR5H8
{"ts":"2025-12-05T21:59:30.840Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"337c5bb5-5603-4be0-806c-c977a40fb517","stage":"booking","correlationId":"booking-created:16d283fcc8a64eaedf46ce5f"}
{"ts":"2025-12-05T22:00:58.983Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"db8b84ad-f84e-4f11-a5b8-e97d430879f4","stage":"booking","correlationId":"booking-created:2ecb79518da8b9c14e95cd6c","attempts":1}
üìÖ Processing booking created for customer: XRZEGMAX6JP6RRW8R8NFA1MV3W
Full booking data: {
  "id": "3fec4e8t5f1pfj",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-18T18:30:00Z",
  "created_at": "2025-12-05T22:00:55Z",
  "updated_at": "2025-12-05T22:00:55Z",
  "customer_id": "XRZEGMAX6JP6RRW8R8NFA1MV3W",
  "location_id": "LT4ZHFBQQYB2N",
  "seller_note": "–≤–Ω–µ—Å–∏ –≤ –æ—Ç—á–µ—Ç ! –±–µ—Å–ø–ª–∞—Ç–Ω–æ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMaVpirfZhWw5oM-"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMyUMvTJIj2HrHSg",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "BRSIGZFOWC6F4ERPKX3CODLU",
      "service_variation_version": 1762893947284,
      "service_variation_client_id": "BRSIGZFOWC6F4ERPKX3CODLU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Isabelle BLOGGER
üéâ First booking detected for customer: XRZEGMAX6JP6RRW8R8NFA1MV3W
   Name: Isabelle BLOGGER
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer XRZEGMAX6JP6RRW8R8NFA1MV3W...
   Full custom attributes response: {}
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: XRZEGMAX6JP6RRW8R8NFA1MV3W
{"ts":"2025-12-05T22:01:05.281Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"db8b84ad-f84e-4f11-a5b8-e97d430879f4","stage":"booking","correlationId":"booking-created:2ecb79518da8b9c14e95cd6c"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-12-05T22:37:13.218Z","level":"error","event":"giftcard.worker.loop_error","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`

Please make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.
{"ts":"2025-12-05T22:37:22.231Z","level":"error","event":"giftcard.worker.loop_error","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-05T22:37:29.122Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"6a3b189c-3e34-45f6-8b5c-e4c8a670f065","stage":"payment","correlationId":"payment-updated:04ddb2da305dd68fcc42eaaf","attempts":1}
üí∞ Processing payment completion for customer: J0D5E143AS7DG5716AY0SMXX10
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Ana Cardoso
‚ùå Referrer not found for code: null
‚úÖ Generated new personal_code in name+ID format: ANA6010
‚úÖ Created gift card for Ana Cardoso: gftc:5b2365cdbfc54b168681ac56f09d1871
‚úÖ Linked gift card gftc:5b2365cdbfc54b168681ac56f09d1871 to customer J0D5E143AS7DG5716AY0SMXX10
   Gift card will now appear in customer's profile in Square
üìã Verification:
   State: PENDING
   Balance: $0
‚úÖ Created new referrer gift card: gftc:5b2365cdbfc54b168681ac56f09d1871
‚úÖ Upserted custom attribute "square:a3dde506-f69e-48e4-a98a-004c1822d3ad" for customer J0D5E143AS7DG5716AY0SMXX10
üìù Added referral code ANA6010 to customer J0D5E143AS7DG5716AY0SMXX10 notes
‚ùå Error sending referral email to cardosanaz@gmail.com: Unauthorized
SendGrid error details: {
  errors: [
    {
      message: "The requestor's IP Address is not whitelisted",
      field: null,
      help: null
    }
  ]
}
‚ö†Ô∏è Analytics operation "notification_event" failed: 
Invalid `prisma.notificationEvent.create()` invocation:

{
  data: {
    channel: "EMAIL",
    templateType: "REFERRAL_INVITE",
    status: "failed",
    createdAt: new Date("2025-12-05T22:37:37.197Z"),
    errorCode: 401,
               ~~~
    errorMessage: "Unauthorized",
    metadata: {
      email: "cardosanaz@gmail.com",
      referralCode: "ANA6010",
      referralUrl: "https://zorinastudio-referral.com/ref/ANA6010",
      suppressionGroupId: 28008
    }
  }
}

Argument `errorCode`: Invalid value provided. Expected String or Null, provided Int.
‚ùå Failed to send email: Unauthorized
‚ùå Failed to send SMS to +12093230064: (0 , account_1.AccountListInstance) is not a function
‚ùå Failed to send SMS to +12093230064: (0 , account_1.AccountListInstance) is not a function
üìß Referral code generated and sent:
   - Customer: Ana Cardoso
   - Email: cardosanaz@gmail.com
   - Referral Code: ANA6010
   - Referral URL: https://zorinastudio-referral.com/ref/ANA6010
   - Gift Card ID: gftc:5b2365cdbfc54b168681ac56f09d1871
   - Status: Customer is now a referrer
‚úÖ Referral code sent to new client:
   - Customer: Ana Cardoso
   - Email: cardosanaz@gmail.com
   - Referral Code: ANA6010
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: J0D5E143AS7DG5716AY0SMXX10
{"ts":"2025-12-05T22:37:38.845Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"6a3b189c-3e34-45f6-8b5c-e4c8a670f065","stage":"payment","correlationId":"payment-updated:04ddb2da305dd68fcc42eaaf"}
{"ts":"2025-12-05T22:37:39.961Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"9df48f56-c4c0-4f8a-965d-6e88694f63c0","stage":"payment","correlationId":"payment-updated:9e54625ca933b90234c609ac","attempts":1}
üí∞ Processing payment completion for customer: J0D5E143AS7DG5716AY0SMXX10
   Payment source_type: CARD
   Payment tender_types: []
Customer J0D5E143AS7DG5716AY0SMXX10 already completed first payment
{"ts":"2025-12-05T22:37:40.863Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"9df48f56-c4c0-4f8a-965d-6e88694f63c0","stage":"payment","correlationId":"payment-updated:9e54625ca933b90234c609ac"}
{"ts":"2025-12-05T22:37:41.977Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"e9481da0-fcca-4162-99bb-810768a0e9bf","stage":"booking","correlationId":"booking-created:10ea26622fdf5ab07d3337c9","attempts":1}
üìÖ Processing booking created for customer: XNYK8NRHTP09F994620J3R878C
Full booking data: {
  "id": "jb4to7nhfbo1t0",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-09T00:00:00Z",
  "created_at": "2025-12-05T22:18:50Z",
  "updated_at": "2025-12-05T22:18:50Z",
  "customer_id": "XNYK8NRHTP09F994620J3R878C",
  "location_id": "LNQKVBTQZN3EZ",
  "seller_note": "Milana‚Äôs fault",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMWAtQTYmZpwwxii"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMEWAZHdtaiRR_Zs",
      "any_team_member": false,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "SGSLS3INMK5YV637KUITCILL",
      "service_variation_version": 1760895536505,
      "service_variation_client_id": "SGSLS3INMK5YV637KUITCILL"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Houda Nait el barj
üéâ First booking detected for customer: XNYK8NRHTP09F994620J3R878C
   Name: Houda Nait el barj
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer XNYK8NRHTP09F994620J3R878C...
   Full custom attributes response: {}
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: XNYK8NRHTP09F994620J3R878C
{"ts":"2025-12-05T22:37:43.993Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"e9481da0-fcca-4162-99bb-810768a0e9bf","stage":"booking","correlationId":"booking-created:10ea26622fdf5ab07d3337c9"}
{"ts":"2025-12-05T22:37:45.578Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"0dead458-3133-4105-8c46-592b381e1142","stage":"booking","correlationId":"booking-created:2c3e495d832aa22894a44d38","attempts":1}
üìÖ Processing booking created for customer: 3YX4P831WF0YA5YE5G8ZKK0TC0
Full booking data: {
  "id": "yam6f0eev4eris",
  "source": "THIRD_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-09T18:45:00Z",
  "created_at": "2025-12-05T22:36:22Z",
  "updated_at": "2025-12-05T22:36:22Z",
  "customer_id": "3YX4P831WF0YA5YE5G8ZKK0TC0",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "3YX4P831WF0YA5YE5G8ZKK0TC0",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMMHlgFBIFbMTRap",
      "any_team_member": false,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1764609601083,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Claire Fahey
üéâ First booking detected for customer: 3YX4P831WF0YA5YE5G8ZKK0TC0
   Name: Claire Fahey
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 3YX4P831WF0YA5YE5G8ZKK0TC0...
   Full custom attributes response: {}
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 3YX4P831WF0YA5YE5G8ZKK0TC0
{"ts":"2025-12-05T22:37:47.062Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"0dead458-3133-4105-8c46-592b381e1142","stage":"booking","correlationId":"booking-created:2c3e495d832aa22894a44d38"}
{"ts":"2025-12-05T22:56:44.961Z","level":"error","event":"giftcard.worker.loop_error","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","error":"Server has closed the connection.","stack":"PrismaClientKnownRequestError: Server has closed the connection.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-05T22:56:51.140Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"ca2f3fa3-fb95-4eba-b11b-10a2b1f51b24","stage":"payment","correlationId":"payment-updated:4488fc424edcb8653a5a8094","attempts":1}
üí∞ Processing payment completion for customer: C5PN9MTWSARSYXQWHAMM3PNGK8
   Payment source_type: CARD
   Payment tender_types: []
Customer C5PN9MTWSARSYXQWHAMM3PNGK8 already completed first payment
{"ts":"2025-12-05T22:56:53.845Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"ca2f3fa3-fb95-4eba-b11b-10a2b1f51b24","stage":"payment","correlationId":"payment-updated:4488fc424edcb8653a5a8094"}
{"ts":"2025-12-05T22:56:55.016Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"d20ae62a-fe82-4825-bd05-f78832ad8e5d","stage":"payment","correlationId":"payment-updated:e3eb862e58de92e4368f78b8","attempts":1}
üí∞ Processing payment completion for customer: C5PN9MTWSARSYXQWHAMM3PNGK8
   Payment source_type: CARD
   Payment tender_types: []
Customer C5PN9MTWSARSYXQWHAMM3PNGK8 already completed first payment
{"ts":"2025-12-05T22:56:55.942Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"d20ae62a-fe82-4825-bd05-f78832ad8e5d","stage":"payment","correlationId":"payment-updated:e3eb862e58de92e4368f78b8"}
{"ts":"2025-12-05T23:27:30.011Z","level":"error","event":"giftcard.worker.loop_error","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","error":"Transaction API error: Transaction already closed: A commit cannot be executed on an expired transaction. The timeout for this transaction was 5000 ms, however 22679 ms passed since the start of the transaction. Consider increasing the interactive transaction timeout or doing less work in the transaction.","stack":"PrismaClientKnownRequestError: Transaction API error: Transaction already closed: A commit cannot be executed on an expired transaction. The timeout for this transaction was 5000 ms, however 22679 ms passed since the start of the transaction. Consider increasing the interactive transaction timeout or doing less work in the transaction.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:8034)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`

Please make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.
{"ts":"2025-12-05T23:27:37.961Z","level":"error","event":"giftcard.worker.loop_error","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","error":"Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.","stack":"PrismaClientKnownRequestError: Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`\n\nPlease make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-05T23:27:41.971Z","level":"error","event":"giftcard.worker.loop_error","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-05T23:27:47.888Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"7e9f542f-eab3-41da-adba-e024fc3b58c5","stage":"payment","correlationId":"payment-updated:f2c29e4f8f20bc7059d1af31","attempts":1}
üí∞ Processing payment completion for customer: TV2AY3B5SV44WQR4092FQA02Q8
   Payment source_type: CASH
   Payment tender_types: []
üéâ First payment completed for customer: Amanda Sweeney
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Amanda Sweeney, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Amanda Sweeney
   - Email: amandasweeney3@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: TV2AY3B5SV44WQR4092FQA02Q8
{"ts":"2025-12-05T23:28:25.742Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"7e9f542f-eab3-41da-adba-e024fc3b58c5","stage":"payment","correlationId":"payment-updated:f2c29e4f8f20bc7059d1af31"}
{"ts":"2025-12-05T23:28:26.829Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"ad9d26f7-83b8-4e42-8a55-77b9372a93cb","stage":"payment","correlationId":"payment-updated:9cee4fe28a47722b446d45c4","attempts":1}
üí∞ Processing payment completion for customer: TV2AY3B5SV44WQR4092FQA02Q8
   Payment source_type: CARD
   Payment tender_types: []
Customer TV2AY3B5SV44WQR4092FQA02Q8 already completed first payment
{"ts":"2025-12-05T23:28:27.716Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"ad9d26f7-83b8-4e42-8a55-77b9372a93cb","stage":"payment","correlationId":"payment-updated:9cee4fe28a47722b446d45c4"}
{"ts":"2025-12-05T23:28:28.801Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"b6c01b3e-c1df-41a0-87a0-139539391e86","stage":"payment","correlationId":"payment-updated:bf28edb060fb42387cf60b0c","attempts":1}
üí∞ Processing payment completion for customer: TV2AY3B5SV44WQR4092FQA02Q8
   Payment source_type: CARD
   Payment tender_types: []
Customer TV2AY3B5SV44WQR4092FQA02Q8 already completed first payment
{"ts":"2025-12-05T23:28:29.693Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"b6c01b3e-c1df-41a0-87a0-139539391e86","stage":"payment","correlationId":"payment-updated:bf28edb060fb42387cf60b0c"}
{"ts":"2025-12-05T23:28:30.865Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"214dedf1-a95f-47b5-a3d0-36b5c9c2a2be","stage":"payment","correlationId":"payment-updated:fad939d362f2bf4988fcecae","attempts":1}
üí∞ Processing payment completion for customer: 6EZ4S6RVW94JY6ZDAHGN9VDYZ8
   Payment source_type: CARD
   Payment tender_types: []
Customer 6EZ4S6RVW94JY6ZDAHGN9VDYZ8 already completed first payment
{"ts":"2025-12-05T23:28:31.757Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"214dedf1-a95f-47b5-a3d0-36b5c9c2a2be","stage":"payment","correlationId":"payment-updated:fad939d362f2bf4988fcecae"}
{"ts":"2025-12-05T23:28:32.845Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"74e6df8c-7d67-4595-b28d-1d99075980ba","stage":"payment","correlationId":"payment-updated:4b15423a88ebc1c53086c883","attempts":1}
üí∞ Processing payment completion for customer: 6EZ4S6RVW94JY6ZDAHGN9VDYZ8
   Payment source_type: CARD
   Payment tender_types: []
Customer 6EZ4S6RVW94JY6ZDAHGN9VDYZ8 already completed first payment
{"ts":"2025-12-05T23:28:34.167Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"74e6df8c-7d67-4595-b28d-1d99075980ba","stage":"payment","correlationId":"payment-updated:4b15423a88ebc1c53086c883"}
{"ts":"2025-12-05T23:28:35.514Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"2abc7490-ca02-4e7d-87f7-dbce9e9e77af","stage":"payment","correlationId":"payment-updated:ffbe0d8668ae0f1f363d81ca","attempts":1}
üí∞ Processing payment completion for customer: PAWMX2Q6ZCDJJP6RMTAHKGJ7A4
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Meghan Brittain
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Meghan Brittain, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Meghan Brittain
   - Email: meg.brittain@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: PAWMX2Q6ZCDJJP6RMTAHKGJ7A4
{"ts":"2025-12-05T23:28:37.899Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"2abc7490-ca02-4e7d-87f7-dbce9e9e77af","stage":"payment","correlationId":"payment-updated:ffbe0d8668ae0f1f363d81ca"}
{"ts":"2025-12-05T23:28:39.076Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"9abbff1e-b0ba-4b30-b3f9-8f25ac3c8a2e","stage":"payment","correlationId":"payment-updated:3f9aa25945374f243b2bcb87","attempts":1}
üí∞ Processing payment completion for customer: PAWMX2Q6ZCDJJP6RMTAHKGJ7A4
   Payment source_type: CARD
   Payment tender_types: []
Customer PAWMX2Q6ZCDJJP6RMTAHKGJ7A4 already completed first payment
{"ts":"2025-12-05T23:28:40.087Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"9abbff1e-b0ba-4b30-b3f9-8f25ac3c8a2e","stage":"payment","correlationId":"payment-updated:3f9aa25945374f243b2bcb87"}
{"ts":"2025-12-05T23:28:41.505Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"861d1e66-e9f3-45ab-a6d6-074a9490dab9","stage":"booking","correlationId":"booking-created:13201e88a62d53f832799092","attempts":1}
üìÖ Processing booking created for customer: PAWMX2Q6ZCDJJP6RMTAHKGJ7A4
Full booking data: {
  "id": "98tlexg7xbvujj",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2026-01-05T23:00:00Z",
  "created_at": "2025-12-05T22:51:27Z",
  "updated_at": "2025-12-05T22:51:27Z",
  "customer_id": "PAWMX2Q6ZCDJJP6RMTAHKGJ7A4",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMWAtQTYmZpwwxii"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMoZGdZlg-iKWTDu",
      "any_team_member": false,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1764609601083,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Meghan Brittain
üéâ First booking detected for customer: PAWMX2Q6ZCDJJP6RMTAHKGJ7A4
   Name: Meghan Brittain
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer PAWMX2Q6ZCDJJP6RMTAHKGJ7A4...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-05-27T03:50:19.260Z",
      "createdAt": "2025-05-27T03:50:19.260Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: PAWMX2Q6ZCDJJP6RMTAHKGJ7A4
{"ts":"2025-12-05T23:28:43.611Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"861d1e66-e9f3-45ab-a6d6-074a9490dab9","stage":"booking","correlationId":"booking-created:13201e88a62d53f832799092"}
{"ts":"2025-12-05T23:28:44.742Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"bc4210f5-bb39-410b-8baa-741b5edc1359","stage":"booking","correlationId":"booking-created:dabc27207c660bb5ed0a0ea5","attempts":1}
üìÖ Processing booking created for customer: FS5QJJVFN51K78QMTMZY5K68ZC
Full booking data: {
  "id": "ljq0rna47rlt6b",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-16T17:00:00Z",
  "created_at": "2025-12-05T23:06:45Z",
  "updated_at": "2025-12-05T23:06:45Z",
  "customer_id": "FS5QJJVFN51K78QMTMZY5K68ZC",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "FS5QJJVFN51K78QMTMZY5K68ZC",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMVwAQUdLz6no-cB",
      "any_team_member": false,
      "duration_minutes": 100,
      "intermission_minutes": 0,
      "service_variation_id": "GSZZR45VJXB44NF4P4WXI5NB",
      "service_variation_version": 1764801478862,
      "service_variation_client_id": "GSZZR45VJXB44NF4P4WXI5NB"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Rachel Christenson
üéâ First booking detected for customer: FS5QJJVFN51K78QMTMZY5K68ZC
   Name: Rachel Christenson
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer FS5QJJVFN51K78QMTMZY5K68ZC...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "af5791f8-348a-422e-98d1-5e865121bb19"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-07-28T00:27:27.206Z",
      "createdAt": "2025-07-28T00:27:27.206Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="af5791f8-348a-422e-98d1-5e865121bb19"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "af5791f8-348a-422e-98d1-5e865121bb19"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: FS5QJJVFN51K78QMTMZY5K68ZC
{"ts":"2025-12-05T23:28:46.306Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"bc4210f5-bb39-410b-8baa-741b5edc1359","stage":"booking","correlationId":"booking-created:dabc27207c660bb5ed0a0ea5"}
{"ts":"2025-12-05T23:28:47.441Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"ff4ad2c6-3574-42f3-948a-3d3fea14c021","stage":"booking","correlationId":"booking-created:a0d34afda48649ca7868a7f2","attempts":1}
üìÖ Processing booking created for customer: 9FZHMC4P6XPMS9XSKAKRN9CNYC
Full booking data: {
  "id": "vol9ur4n2o9uuc",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-13T20:00:00Z",
  "created_at": "2025-12-05T23:08:40Z",
  "updated_at": "2025-12-05T23:08:40Z",
  "customer_id": "9FZHMC4P6XPMS9XSKAKRN9CNYC",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "9FZHMC4P6XPMS9XSKAKRN9CNYC",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMXiw38Bbb7XQUWI",
      "any_team_member": true,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1764609601083,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Vivian Zhang
üéâ First booking detected for customer: 9FZHMC4P6XPMS9XSKAKRN9CNYC
   Name: Vivian Zhang
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 9FZHMC4P6XPMS9XSKAKRN9CNYC...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-07-25T16:28:05.860Z",
      "createdAt": "2025-07-25T16:28:05.860Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 9FZHMC4P6XPMS9XSKAKRN9CNYC
{"ts":"2025-12-05T23:28:49.137Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"ff4ad2c6-3574-42f3-948a-3d3fea14c021","stage":"booking","correlationId":"booking-created:a0d34afda48649ca7868a7f2"}
{"ts":"2025-12-05T23:28:50.223Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"5467d019-8688-4e2c-80a8-e07445713dab","stage":"payment","correlationId":"payment-updated:349ee69edddb80f45953cc72","attempts":1}
üí∞ Processing payment completion for customer: CT009ZPNPMA60WXFYEBAEBGWPG
   Payment source_type: CARD
   Payment tender_types: []
Customer CT009ZPNPMA60WXFYEBAEBGWPG already completed first payment
{"ts":"2025-12-05T23:28:51.109Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"5467d019-8688-4e2c-80a8-e07445713dab","stage":"payment","correlationId":"payment-updated:349ee69edddb80f45953cc72"}
{"ts":"2025-12-05T23:28:52.192Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"8283dc59-c24e-4ba6-8cce-e2223492a851","stage":"payment","correlationId":"payment-updated:882a86705d8ca727275914e0","attempts":1}
üí∞ Processing payment completion for customer: CT009ZPNPMA60WXFYEBAEBGWPG
   Payment source_type: CARD
   Payment tender_types: []
Customer CT009ZPNPMA60WXFYEBAEBGWPG already completed first payment
{"ts":"2025-12-05T23:28:53.110Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"8283dc59-c24e-4ba6-8cce-e2223492a851","stage":"payment","correlationId":"payment-updated:882a86705d8ca727275914e0"}
{"ts":"2025-12-05T23:28:54.209Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"ef1d7c19-d3c2-490a-8833-2df01a1d727b","stage":"booking","correlationId":"booking-created:ce58fec2827b92a752401ef4","attempts":1}
üìÖ Processing booking created for customer: CT009ZPNPMA60WXFYEBAEBGWPG
Full booking data: {
  "id": "ttnz0w64tpm1kk",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-26T23:00:00Z",
  "created_at": "2025-12-05T23:13:12Z",
  "updated_at": "2025-12-05T23:13:12Z",
  "customer_id": "CT009ZPNPMA60WXFYEBAEBGWPG",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMWAtQTYmZpwwxii"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMMCVDJoKh3ZkfFo",
      "any_team_member": false,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1764609601083,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Miri Alper
üéâ First booking detected for customer: CT009ZPNPMA60WXFYEBAEBGWPG
   Name: Miri Alper
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer CT009ZPNPMA60WXFYEBAEBGWPG...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-03-11T00:09:52.695Z",
      "createdAt": "2025-03-11T00:09:52.695Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: CT009ZPNPMA60WXFYEBAEBGWPG
{"ts":"2025-12-05T23:28:56.357Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"ef1d7c19-d3c2-490a-8833-2df01a1d727b","stage":"booking","correlationId":"booking-created:ce58fec2827b92a752401ef4"}
{"ts":"2025-12-06T00:05:19.285Z","level":"error","event":"giftcard.worker.loop_error","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","error":"Server has closed the connection.","stack":"PrismaClientKnownRequestError: Server has closed the connection.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`

Please make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.
{"ts":"2025-12-06T00:05:28.299Z","level":"error","event":"giftcard.worker.loop_error","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-06T00:05:32.304Z","level":"error","event":"giftcard.worker.loop_error","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-06T00:22:55.358Z","level":"error","event":"giftcard.worker.loop_error","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`

Please make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.
{"ts":"2025-12-06T00:23:04.371Z","level":"error","event":"giftcard.worker.loop_error","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-06T00:23:08.377Z","level":"error","event":"giftcard.worker.loop_error","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-06T00:23:12.383Z","level":"error","event":"giftcard.worker.loop_error","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-06T00:23:16.390Z","level":"error","event":"giftcard.worker.loop_error","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-06T00:23:22.199Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"72eb48b8-066c-43b6-9c96-b751b9b39d2f","stage":"payment","correlationId":"payment-updated:1fd3395eaec1bdccd4303760","attempts":1}
üí∞ Processing payment completion for customer: F75RWEJBQJNGMPQNYM01XKK9TC
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: null null
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to null null, skipping...
‚úÖ Referral code sent to new client:
   - Customer: null null
   - Email: alisonbaumann@comcast.net
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: F75RWEJBQJNGMPQNYM01XKK9TC
{"ts":"2025-12-06T00:23:26.181Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"72eb48b8-066c-43b6-9c96-b751b9b39d2f","stage":"payment","correlationId":"payment-updated:1fd3395eaec1bdccd4303760"}
{"ts":"2025-12-06T00:23:27.503Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"b4837bf2-8d90-40fb-93c8-674496138da9","stage":"payment","correlationId":"payment-updated:14b64cb2f094d657fb74a417","attempts":1}
üí∞ Processing payment completion for customer: F75RWEJBQJNGMPQNYM01XKK9TC
   Payment source_type: CARD
   Payment tender_types: []
Customer F75RWEJBQJNGMPQNYM01XKK9TC already completed first payment
{"ts":"2025-12-06T00:23:28.482Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"b4837bf2-8d90-40fb-93c8-674496138da9","stage":"payment","correlationId":"payment-updated:14b64cb2f094d657fb74a417"}
{"ts":"2025-12-06T00:23:29.681Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"39b1bb88-c92a-4a54-b3c0-586b3d71e068","stage":"payment","correlationId":"payment-updated:94cac75a6fbe7fbe00aed073","attempts":1}
üí∞ Processing payment completion for customer: F75RWEJBQJNGMPQNYM01XKK9TC
   Payment source_type: CARD
   Payment tender_types: []
Customer F75RWEJBQJNGMPQNYM01XKK9TC already completed first payment
{"ts":"2025-12-06T00:23:30.764Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"39b1bb88-c92a-4a54-b3c0-586b3d71e068","stage":"payment","correlationId":"payment-updated:94cac75a6fbe7fbe00aed073"}
{"ts":"2025-12-06T00:23:32.082Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"59af929b-12af-474f-8a44-e728c073c01f","stage":"booking","correlationId":"booking-created:1f7e2fbd9d5c47a6f64a8274","attempts":1}
üìÖ Processing booking created for customer: S6K4JWVN24EDMY0BYVP41FNTEG
Full booking data: {
  "id": "g6pmnditj17sqx",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-20T18:00:00Z",
  "created_at": "2025-12-05T23:16:35Z",
  "updated_at": "2025-12-05T23:16:35Z",
  "customer_id": "S6K4JWVN24EDMY0BYVP41FNTEG",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "S6K4JWVN24EDMY0BYVP41FNTEG",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMe-bT5XxKxmk0nw",
      "any_team_member": true,
      "duration_minutes": 140,
      "intermission_minutes": 0,
      "service_variation_id": "CJI5WHOAKSFTASYPJ4MSYZLS",
      "service_variation_version": 1764783981722,
      "service_variation_client_id": "CJI5WHOAKSFTASYPJ4MSYZLS"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Carly Winger
üéâ First booking detected for customer: S6K4JWVN24EDMY0BYVP41FNTEG
   Name: Carly Winger
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer S6K4JWVN24EDMY0BYVP41FNTEG...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "a7b40271-729a-41aa-801b-fb1fffb83650"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-08-31T23:44:21.423Z",
      "createdAt": "2025-08-31T23:44:21.423Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="a7b40271-729a-41aa-801b-fb1fffb83650"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "a7b40271-729a-41aa-801b-fb1fffb83650"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: S6K4JWVN24EDMY0BYVP41FNTEG
{"ts":"2025-12-06T00:23:34.003Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"59af929b-12af-474f-8a44-e728c073c01f","stage":"booking","correlationId":"booking-created:1f7e2fbd9d5c47a6f64a8274"}
{"ts":"2025-12-06T00:23:35.109Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"d1f6099f-034f-4e4e-b8bf-35825dc6188b","stage":"payment","correlationId":"payment-updated:6002dfda522790c0509a3c85","attempts":1}
üí∞ Processing payment completion for customer: PZJXFB903YVE1ZWPJQW5KVH6QG
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Stephanie Baladi
‚ùå Referrer not found for code: null
‚úÖ Generated new personal_code in name+ID format: STEPHANIE3156
‚úÖ Created gift card for Stephanie Baladi: gftc:0404f26ebf744ecf88135e84ade42c4f
‚úÖ Linked gift card gftc:0404f26ebf744ecf88135e84ade42c4f to customer PZJXFB903YVE1ZWPJQW5KVH6QG
   Gift card will now appear in customer's profile in Square
üìã Verification:
   State: PENDING
   Balance: $0
‚úÖ Created new referrer gift card: gftc:0404f26ebf744ecf88135e84ade42c4f
Error upserting custom attribute "square:a3dde506-f69e-48e4-a98a-004c1822d3ad" for customer PZJXFB903YVE1ZWPJQW5KVH6QG: timeout of 60000ms exceeded
Error appending referral note for customer PZJXFB903YVE1ZWPJQW5KVH6QG: Error
Square API errors: [
  {
    "errno": -65,
    "code": "EHOSTUNREACH",
    "syscall": "connect",
    "address": "162.159.140.47",
    "port": 443
  },
  {
    "errno": -65,
    "code": "EHOSTUNREACH",
    "syscall": "connect",
    "address": "172.66.0.47",
    "port": 443
  }
]
Error sending referral code to new client: 
‚ö†Ô∏è GiftCardRun availability check error - assuming available: 
Error processing payment completion: ErrorEvent {
  clientVersion: '5.22.0',
  Symbol(kTarget): WebSocket {
    _events: [Object: null prototype] {
      error: [Function],
      message: [Function],
      close: [Function],
      open: [Function]
    },
    _eventsCount: 4,
    _maxListeners: undefined,
    _binaryType: 'arraybuffer',
    _closeCode: 1006,
    _closeFrameReceived: false,
    _closeFrameSent: false,
    _closeMessage: <Buffer >,
    _closeTimer: null,
    _errorEmitted: true,
    _extensions: {},
    _paused: false,
    _protocol: '',
    _readyState: 3,
    _receiver: null,
    _sender: null,
    _socket: null,
    _bufferedAmount: 0,
    _isServer: false,
    _redirects: 0,
    _autoPong: true,
    _url: 'wss://ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech/v2',
    _req: null,
    Symbol(shapeMode): false,
    Symbol(kCapture): false
  },
  Symbol(kType): 'error',
  Symbol(kError): AggregateError [EHOSTUNREACH]: 
      at internalConnectMultiple (node:net:1134:18)
      at internalConnectMultiple (node:net:1210:5)
      at internalConnectMultiple (node:net:1210:5)
      at internalConnectMultiple (node:net:1210:5)
      at defaultTriggerAsyncIdScope (node:internal/async_hooks:472:18)
      at GetAddrInfoReqWrap.emitLookup [as callback] (node:net:1552:7)
      at GetAddrInfoReqWrap.onlookupall [as oncomplete] (node:dns:134:8) {
    code: 'EHOSTUNREACH',
    [errors]: [ [Error], [Error], [Error] ]
  },
  Symbol(kMessage): ''
}
{"ts":"2025-12-06T00:39:11.010Z","level":"error","event":"giftcard.worker.job.failed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"d1f6099f-034f-4e4e-b8bf-35825dc6188b","stage":"payment","correlationId":"payment-updated:6002dfda522790c0509a3c85","attempts":1,"error":"[object Object]"}
{"ts":"2025-12-06T00:39:21.028Z","level":"error","event":"giftcard.worker.loop_error","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","error":"\nInvalid `prisma.$queryRaw()` invocation:\n\n\nTimed out fetching a new connection from the connection pool. More info: http://pris.ly/d/connection-pool (Current connection pool timeout: 10, connection limit: 21)","stack":"PrismaClientKnownRequestError: \nInvalid `prisma.$queryRaw()` invocation:\n\n\nTimed out fetching a new connection from the connection pool. More info: http://pris.ly/d/connection-pool (Current connection pool timeout: 10, connection limit: 21)\n    at $n.handleRequestError (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:121:7315)\n    at $n.handleAndLogRequestError (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:121:6623)\n    at $n.request (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:121:6307)\n    at async l (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:9633)\n    at async updateGiftCardRunStage (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/runs/giftcard-run-tracker.js:330:18)\n    at async markGiftCardRunError (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/runs/giftcard-run-tracker.js:364:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:133:9)"}
{"ts":"2025-12-06T00:39:28.105Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"48005600-815e-47d0-aee2-d2d881616ac3","stage":"payment","correlationId":"payment-updated:edb32693bc6dce806081aa44","attempts":1}
üí∞ Processing payment completion for customer: PZJXFB903YVE1ZWPJQW5KVH6QG
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Stephanie Baladi
‚ùå Referrer not found for code: null
‚úÖ Generated new personal_code in name+ID format: STEPHANIE3156
‚úÖ Created gift card for Stephanie Baladi: gftc:0404f26ebf744ecf88135e84ade42c4f
‚úÖ Linked gift card gftc:0404f26ebf744ecf88135e84ade42c4f to customer PZJXFB903YVE1ZWPJQW5KVH6QG
   Gift card will now appear in customer's profile in Square
üìã Verification:
   State: PENDING
   Balance: $0
‚úÖ Created new referrer gift card: gftc:0404f26ebf744ecf88135e84ade42c4f
‚úÖ Upserted custom attribute "square:a3dde506-f69e-48e4-a98a-004c1822d3ad" for customer PZJXFB903YVE1ZWPJQW5KVH6QG
üìù Added referral code STEPHANIE3156 to customer PZJXFB903YVE1ZWPJQW5KVH6QG notes
‚ùå Error sending referral email to sbaladi@gmail.com: Unauthorized
SendGrid error details: {
  errors: [
    {
      message: "The requestor's IP Address is not whitelisted",
      field: null,
      help: null
    }
  ]
}
‚ö†Ô∏è Analytics operation "notification_event" failed: 
Invalid `prisma.notificationEvent.create()` invocation:

{
  data: {
    channel: "EMAIL",
    templateType: "REFERRAL_INVITE",
    status: "failed",
    createdAt: new Date("2025-12-06T00:39:34.947Z"),
    errorCode: 401,
               ~~~
    errorMessage: "Unauthorized",
    metadata: {
      email: "sbaladi@gmail.com",
      referralCode: "STEPHANIE3156",
      referralUrl: "https://zorinastudio-referral.com/ref/STEPHANIE3156",
      suppressionGroupId: 28008
    }
  }
}

Argument `errorCode`: Invalid value provided. Expected String or Null, provided Int.
‚ùå Failed to send email: Unauthorized
‚ùå Failed to send SMS to +16508632345: (0 , account_1.AccountListInstance) is not a function
‚ùå Failed to send SMS to +16508632345: (0 , account_1.AccountListInstance) is not a function
üìß Referral code generated and sent:
   - Customer: Stephanie Baladi
   - Email: sbaladi@gmail.com
   - Referral Code: STEPHANIE3156
   - Referral URL: https://zorinastudio-referral.com/ref/STEPHANIE3156
   - Gift Card ID: gftc:0404f26ebf744ecf88135e84ade42c4f
   - Status: Customer is now a referrer
‚úÖ Referral code sent to new client:
   - Customer: Stephanie Baladi
   - Email: sbaladi@gmail.com
   - Referral Code: STEPHANIE3156
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: PZJXFB903YVE1ZWPJQW5KVH6QG
{"ts":"2025-12-06T00:39:36.675Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"48005600-815e-47d0-aee2-d2d881616ac3","stage":"payment","correlationId":"payment-updated:edb32693bc6dce806081aa44"}
{"ts":"2025-12-06T00:39:37.760Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"4292c63c-16a7-4b31-bf7b-80aa09fac6ac","stage":"payment","correlationId":"payment-updated:cfe03d0be4239a6c12dd45d2","attempts":1}
üí∞ Processing payment completion for customer: PKTHKW7PZNJK8K46R6GB4J24VW
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Ariel Jelsma
‚ùå Referrer not found for code: null
‚úÖ Generated new personal_code in name+ID format: ARIEL6424
‚úÖ Created gift card for Ariel Jelsma: gftc:15b437edaab24d60bd46cc0ab6ba79d6
‚úÖ Linked gift card gftc:15b437edaab24d60bd46cc0ab6ba79d6 to customer PKTHKW7PZNJK8K46R6GB4J24VW
   Gift card will now appear in customer's profile in Square
üìã Verification:
   State: PENDING
   Balance: $0
‚úÖ Created new referrer gift card: gftc:15b437edaab24d60bd46cc0ab6ba79d6
‚úÖ Upserted custom attribute "square:a3dde506-f69e-48e4-a98a-004c1822d3ad" for customer PKTHKW7PZNJK8K46R6GB4J24VW
üìù Added referral code ARIEL6424 to customer PKTHKW7PZNJK8K46R6GB4J24VW notes
‚ùå Error sending referral email to premix-34.viral@icloud.com: Unauthorized
SendGrid error details: {
  errors: [
    {
      message: "The requestor's IP Address is not whitelisted",
      field: null,
      help: null
    }
  ]
}
‚ö†Ô∏è Analytics operation "notification_event" failed: 
Invalid `prisma.notificationEvent.create()` invocation:

{
  data: {
    channel: "EMAIL",
    templateType: "REFERRAL_INVITE",
    status: "failed",
    createdAt: new Date("2025-12-06T00:39:43.330Z"),
    errorCode: 401,
               ~~~
    errorMessage: "Unauthorized",
    metadata: {
      email: "premix-34.viral@icloud.com",
      referralCode: "ARIEL6424",
      referralUrl: "https://zorinastudio-referral.com/ref/ARIEL6424",
      suppressionGroupId: 28008
    }
  }
}

Argument `errorCode`: Invalid value provided. Expected String or Null, provided Int.
‚ùå Failed to send email: Unauthorized
‚ùå Failed to send SMS to +14246347325: (0 , account_1.AccountListInstance) is not a function
‚ùå Failed to send SMS to +14246347325: (0 , account_1.AccountListInstance) is not a function
üìß Referral code generated and sent:
   - Customer: Ariel Jelsma
   - Email: premix-34.viral@icloud.com
   - Referral Code: ARIEL6424
   - Referral URL: https://zorinastudio-referral.com/ref/ARIEL6424
   - Gift Card ID: gftc:15b437edaab24d60bd46cc0ab6ba79d6
   - Status: Customer is now a referrer
‚úÖ Referral code sent to new client:
   - Customer: Ariel Jelsma
   - Email: premix-34.viral@icloud.com
   - Referral Code: ARIEL6424
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: PKTHKW7PZNJK8K46R6GB4J24VW
{"ts":"2025-12-06T00:39:45.383Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"4292c63c-16a7-4b31-bf7b-80aa09fac6ac","stage":"payment","correlationId":"payment-updated:cfe03d0be4239a6c12dd45d2"}
{"ts":"2025-12-06T00:39:46.654Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"95f266ee-35e1-4e3e-8b79-6c8e4e8d73f3","stage":"payment","correlationId":"payment-updated:a3d9d74a5e9b2e5efd097ad5","attempts":1}
üí∞ Processing payment completion for customer: PKTHKW7PZNJK8K46R6GB4J24VW
   Payment source_type: CARD
   Payment tender_types: []
Customer PKTHKW7PZNJK8K46R6GB4J24VW already completed first payment
{"ts":"2025-12-06T00:39:47.621Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"95f266ee-35e1-4e3e-8b79-6c8e4e8d73f3","stage":"payment","correlationId":"payment-updated:a3d9d74a5e9b2e5efd097ad5"}
{"ts":"2025-12-06T00:39:48.713Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"c1a4963a-5cbf-4271-bd0c-175df12b69ac","stage":"booking","correlationId":"booking-created:a9db0c1eb074b3f51bf6570b","attempts":1}
üìÖ Processing booking created for customer: Y1SKR308S924B4D9JGS2TM6BF4
Full booking data: {
  "id": "fh08z27ntz4zf8",
  "source": "THIRD_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-10T22:05:00Z",
  "created_at": "2025-12-05T23:51:30Z",
  "updated_at": "2025-12-05T23:51:30Z",
  "customer_id": "Y1SKR308S924B4D9JGS2TM6BF4",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "Y1SKR308S924B4D9JGS2TM6BF4",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMMCVDJoKh3ZkfFo",
      "any_team_member": false,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1764609601083,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Michelle Xu
üéâ First booking detected for customer: Y1SKR308S924B4D9JGS2TM6BF4
   Name: Michelle Xu
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer Y1SKR308S924B4D9JGS2TM6BF4...
   Full custom attributes response: {}
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: Y1SKR308S924B4D9JGS2TM6BF4
{"ts":"2025-12-06T00:39:50.434Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"c1a4963a-5cbf-4271-bd0c-175df12b69ac","stage":"booking","correlationId":"booking-created:a9db0c1eb074b3f51bf6570b"}
{"ts":"2025-12-06T00:39:51.525Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"87952bf7-eb71-44aa-9cdc-9c1b102614be","stage":"payment","correlationId":"payment-updated:d8c5459be92eadd7d4055dd9","attempts":1}
üí∞ Processing payment completion for customer: CYGEZJ39X96P36CRZ87XBG5EWR
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Angela Estepa
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Angela Estepa, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Angela Estepa
   - Email: angela.estepa@yahoo.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: CYGEZJ39X96P36CRZ87XBG5EWR
{"ts":"2025-12-06T00:39:53.707Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"87952bf7-eb71-44aa-9cdc-9c1b102614be","stage":"payment","correlationId":"payment-updated:d8c5459be92eadd7d4055dd9"}
{"ts":"2025-12-06T00:39:54.888Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"46477c20-969e-4656-8eea-38294389e6a1","stage":"payment","correlationId":"payment-updated:77c2a313f2ac218b9899f889","attempts":1}
üí∞ Processing payment completion for customer: CYGEZJ39X96P36CRZ87XBG5EWR
   Payment source_type: CARD
   Payment tender_types: []
Customer CYGEZJ39X96P36CRZ87XBG5EWR already completed first payment
{"ts":"2025-12-06T00:39:55.824Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"46477c20-969e-4656-8eea-38294389e6a1","stage":"payment","correlationId":"payment-updated:77c2a313f2ac218b9899f889"}
{"ts":"2025-12-06T00:39:56.962Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"a8b3daea-85ef-4963-a242-871da1e7c2e7","stage":"booking","correlationId":"booking-created:4826f79236835657fb61958b","attempts":1}
üìÖ Processing booking created for customer: 6ZTKSSK7B7VBWDJ409D7E06J5R
Full booking data: {
  "id": "tczs51bkj8gvnk",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-11T22:00:00Z",
  "created_at": "2025-12-06T00:23:22Z",
  "updated_at": "2025-12-06T00:23:22Z",
  "customer_id": "6ZTKSSK7B7VBWDJ409D7E06J5R",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMWAtQTYmZpwwxii"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMMCVDJoKh3ZkfFo",
      "any_team_member": false,
      "duration_minutes": 100,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1764609601083,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    },
    {
      "team_member_id": "TMMCVDJoKh3ZkfFo",
      "any_team_member": false,
      "duration_minutes": 20,
      "intermission_minutes": 0,
      "service_variation_id": "HAJX45W3U2WUCCXM5MI24UEE",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "HAJX45W3U2WUCCXM5MI24UEE"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Viola Schritter
üéâ First booking detected for customer: 6ZTKSSK7B7VBWDJ409D7E06J5R
   Name: Viola Schritter
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 6ZTKSSK7B7VBWDJ409D7E06J5R...
   Full custom attributes response: {}
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 6ZTKSSK7B7VBWDJ409D7E06J5R
{"ts":"2025-12-06T00:39:58.716Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"a8b3daea-85ef-4963-a242-871da1e7c2e7","stage":"booking","correlationId":"booking-created:4826f79236835657fb61958b"}
{"ts":"2025-12-06T00:40:00.170Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"6040afff-3983-48e1-a8f1-efa48a6d9082","stage":"payment","correlationId":"payment-updated:5bc395914129e9c392329f90","attempts":1}
üí∞ Processing payment completion for customer: EREWJ7Y5JPPZMM2GZF599AX89W
   Payment source_type: CARD
   Payment tender_types: []
Customer EREWJ7Y5JPPZMM2GZF599AX89W already completed first payment
{"ts":"2025-12-06T00:40:02.281Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"6040afff-3983-48e1-a8f1-efa48a6d9082","stage":"payment","correlationId":"payment-updated:5bc395914129e9c392329f90"}
{"ts":"2025-12-06T00:40:03.483Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"6c0a41a0-6305-4b77-99bb-79e24a90a281","stage":"payment","correlationId":"payment-updated:fccb6e3724e7feed8164448a","attempts":1}
üí∞ Processing payment completion for customer: EREWJ7Y5JPPZMM2GZF599AX89W
   Payment source_type: CARD
   Payment tender_types: []
Customer EREWJ7Y5JPPZMM2GZF599AX89W already completed first payment
{"ts":"2025-12-06T00:40:04.603Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"6c0a41a0-6305-4b77-99bb-79e24a90a281","stage":"payment","correlationId":"payment-updated:fccb6e3724e7feed8164448a"}
{"ts":"2025-12-06T00:40:05.889Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"8b6a0415-45d3-439a-8d61-c01ff6166db1","stage":"payment","correlationId":"payment-updated:b22c59e4cccb27aa7edfbf70","attempts":1}
üí∞ Processing payment completion for customer: AAMRRB8R8E1FWV04DNRAYCBKE4
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Irma Acosta
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Irma Acosta, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Irma Acosta
   - Email: irma.acosta68@yahoo.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: AAMRRB8R8E1FWV04DNRAYCBKE4
{"ts":"2025-12-06T00:40:07.959Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"8b6a0415-45d3-439a-8d61-c01ff6166db1","stage":"payment","correlationId":"payment-updated:b22c59e4cccb27aa7edfbf70"}
{"ts":"2025-12-06T00:40:09.135Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"523114c8-0b78-4c3d-b9d3-e31dc5a7b8c9","stage":"payment","correlationId":"payment-updated:be3f204e7f862f09efcb8e34","attempts":1}
üí∞ Processing payment completion for customer: AAMRRB8R8E1FWV04DNRAYCBKE4
   Payment source_type: CARD
   Payment tender_types: []
Customer AAMRRB8R8E1FWV04DNRAYCBKE4 already completed first payment
{"ts":"2025-12-06T00:40:10.022Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"523114c8-0b78-4c3d-b9d3-e31dc5a7b8c9","stage":"payment","correlationId":"payment-updated:be3f204e7f862f09efcb8e34"}
{"ts":"2025-12-06T00:40:11.209Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"4901d54b-006b-4360-ad90-569b03cacdff","stage":"payment","correlationId":"payment-updated:9edce5d00626f3525b84e5b8","attempts":1}
üí∞ Processing payment completion for customer: A79E6S1EKPTZSKM4WYPJ6AQRA0
   Payment source_type: CARD
   Payment tender_types: []
Customer A79E6S1EKPTZSKM4WYPJ6AQRA0 already completed first payment
{"ts":"2025-12-06T00:40:12.526Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"4901d54b-006b-4360-ad90-569b03cacdff","stage":"payment","correlationId":"payment-updated:9edce5d00626f3525b84e5b8"}
{"ts":"2025-12-06T00:40:13.680Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"1e43d206-83e4-46b2-82be-d86c7ecb1af4","stage":"payment","correlationId":"payment-updated:8fa7c67f980d6742660fe5fe","attempts":1}
üí∞ Processing payment completion for customer: A79E6S1EKPTZSKM4WYPJ6AQRA0
   Payment source_type: CARD
   Payment tender_types: []
Customer A79E6S1EKPTZSKM4WYPJ6AQRA0 already completed first payment
{"ts":"2025-12-06T00:40:14.755Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"1e43d206-83e4-46b2-82be-d86c7ecb1af4","stage":"payment","correlationId":"payment-updated:8fa7c67f980d6742660fe5fe"}
{"ts":"2025-12-06T00:40:16.018Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"32076cff-b1ac-456a-897c-7a7131c3f5db","stage":"booking","correlationId":"booking-created:7768fde597a381715c6427f8","attempts":1}
üìÖ Processing booking created for customer: A79E6S1EKPTZSKM4WYPJ6AQRA0
Full booking data: {
  "id": "no1g4mq1gq0c8g",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-29T21:15:00Z",
  "created_at": "2025-12-06T00:39:37Z",
  "updated_at": "2025-12-06T00:39:37Z",
  "customer_id": "A79E6S1EKPTZSKM4WYPJ6AQRA0",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMWAtQTYmZpwwxii"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMILsQUVwLkLzbVo",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "BM556FTNFOTEHYVG4GPXAXFM",
      "service_variation_version": 1762893947284,
      "service_variation_client_id": "BM556FTNFOTEHYVG4GPXAXFM"
    },
    {
      "team_member_id": "TMILsQUVwLkLzbVo",
      "any_team_member": false,
      "duration_minutes": 20,
      "intermission_minutes": 0,
      "service_variation_id": "HAJX45W3U2WUCCXM5MI24UEE",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "HAJX45W3U2WUCCXM5MI24UEE"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Heather Dennis
üéâ First booking detected for customer: A79E6S1EKPTZSKM4WYPJ6AQRA0
   Name: Heather Dennis
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer A79E6S1EKPTZSKM4WYPJ6AQRA0...
   Full custom attributes response: {}
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: A79E6S1EKPTZSKM4WYPJ6AQRA0
{"ts":"2025-12-06T00:40:18.074Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"32076cff-b1ac-456a-897c-7a7131c3f5db","stage":"booking","correlationId":"booking-created:7768fde597a381715c6427f8"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-12-06T00:52:26.505Z","level":"error","event":"giftcard.worker.loop_error","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Timed out fetching a new connection from the connection pool. More info: http://pris.ly/d/connection-pool (Current connection pool timeout: 10, connection limit: 21)
{"ts":"2025-12-06T01:06:25.756Z","level":"error","event":"giftcard.worker.loop_error","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-06T01:14:24.524Z","level":"error","event":"giftcard.worker.loop_error","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","error":"Transaction API error: Transaction already closed: A commit cannot be executed on an expired transaction. The timeout for this transaction was 5000 ms, however 14879 ms passed since the start of the transaction. Consider increasing the interactive transaction timeout or doing less work in the transaction.","stack":"PrismaClientKnownRequestError: Transaction API error: Transaction already closed: A commit cannot be executed on an expired transaction. The timeout for this transaction was 5000 ms, however 14879 ms passed since the start of the transaction. Consider increasing the interactive transaction timeout or doing less work in the transaction.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:8034)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-06T01:14:31.046Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"886785ee-58fa-4301-a988-bfebf9b8029b","stage":"payment","correlationId":"payment-updated:0e79925d8b444a87073c7f80","attempts":1}
üí∞ Processing payment completion for customer: 09CZCTWN6X1S0MDF91DBMDDDHG
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Yvonne Powless
‚ùå Referrer not found for code: null
‚úÖ Generated new personal_code in name+ID format: YVONNE1091
‚úÖ Created gift card for Yvonne Powless: gftc:1fd95bf16c424bdabf7dd58e71596b5c
‚úÖ Linked gift card gftc:1fd95bf16c424bdabf7dd58e71596b5c to customer 09CZCTWN6X1S0MDF91DBMDDDHG
   Gift card will now appear in customer's profile in Square
üìã Verification:
   State: PENDING
   Balance: $0
‚úÖ Created new referrer gift card: gftc:1fd95bf16c424bdabf7dd58e71596b5c
‚úÖ Upserted custom attribute "square:a3dde506-f69e-48e4-a98a-004c1822d3ad" for customer 09CZCTWN6X1S0MDF91DBMDDDHG
üìù Added referral code YVONNE1091 to customer 09CZCTWN6X1S0MDF91DBMDDDHG notes
‚ùå Error sending referral email to ypowless@gmail.com: Unauthorized
SendGrid error details: {
  errors: [
    {
      message: "The requestor's IP Address is not whitelisted",
      field: null,
      help: null
    }
  ]
}
‚ö†Ô∏è Analytics operation "notification_event" failed: 
Invalid `prisma.notificationEvent.create()` invocation:

{
  data: {
    channel: "EMAIL",
    templateType: "REFERRAL_INVITE",
    status: "failed",
    createdAt: new Date("2025-12-06T01:14:37.886Z"),
    errorCode: 401,
               ~~~
    errorMessage: "Unauthorized",
    metadata: {
      email: "ypowless@gmail.com",
      referralCode: "YVONNE1091",
      referralUrl: "https://zorinastudio-referral.com/ref/YVONNE1091",
      suppressionGroupId: 28008
    }
  }
}

Argument `errorCode`: Invalid value provided. Expected String or Null, provided Int.
‚ùå Failed to send email: Unauthorized
‚ùå Failed to send SMS to +17187029052: (0 , account_1.AccountListInstance) is not a function
‚ùå Failed to send SMS to +17187029052: (0 , account_1.AccountListInstance) is not a function
üìß Referral code generated and sent:
   - Customer: Yvonne Powless
   - Email: ypowless@gmail.com
   - Referral Code: YVONNE1091
   - Referral URL: https://zorinastudio-referral.com/ref/YVONNE1091
   - Gift Card ID: gftc:1fd95bf16c424bdabf7dd58e71596b5c
   - Status: Customer is now a referrer
‚úÖ Referral code sent to new client:
   - Customer: Yvonne Powless
   - Email: ypowless@gmail.com
   - Referral Code: YVONNE1091
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: 09CZCTWN6X1S0MDF91DBMDDDHG
{"ts":"2025-12-06T01:14:39.453Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"886785ee-58fa-4301-a988-bfebf9b8029b","stage":"payment","correlationId":"payment-updated:0e79925d8b444a87073c7f80"}
{"ts":"2025-12-06T01:14:40.554Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"6140f4fc-b6ee-467f-b3e6-bee8058c35fa","stage":"booking","correlationId":"booking-created:8080ca5453349587b3910394","attempts":1}
üìÖ Processing booking created for customer: XJ3B3142WGZBDYTSNV4HDD9MA0
Full booking data: {
  "id": "dkcihqxw1xv3ea",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-27T18:00:00Z",
  "created_at": "2025-12-06T00:56:18Z",
  "updated_at": "2025-12-06T00:56:18Z",
  "customer_id": "XJ3B3142WGZBDYTSNV4HDD9MA0",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "XJ3B3142WGZBDYTSNV4HDD9MA0",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMVwAQUdLz6no-cB",
      "any_team_member": false,
      "duration_minutes": 100,
      "intermission_minutes": 0,
      "service_variation_id": "GSZZR45VJXB44NF4P4WXI5NB",
      "service_variation_version": 1764801478862,
      "service_variation_client_id": "GSZZR45VJXB44NF4P4WXI5NB"
    },
    {
      "team_member_id": "TMVwAQUdLz6no-cB",
      "any_team_member": false,
      "duration_minutes": 30,
      "intermission_minutes": 0,
      "service_variation_id": "LFLFEZO7L46URIM2OVZOJADI",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "LFLFEZO7L46URIM2OVZOJADI"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Maria Virskaia
üéâ First booking detected for customer: XJ3B3142WGZBDYTSNV4HDD9MA0
   Name: Maria Virskaia
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer XJ3B3142WGZBDYTSNV4HDD9MA0...
   Full custom attributes response: {}
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: XJ3B3142WGZBDYTSNV4HDD9MA0
{"ts":"2025-12-06T01:14:42.251Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"6140f4fc-b6ee-467f-b3e6-bee8058c35fa","stage":"booking","correlationId":"booking-created:8080ca5453349587b3910394"}
{"ts":"2025-12-06T01:14:43.769Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"6e380473-bbdb-4b00-b147-b0d088faa0a1","stage":"payment","correlationId":"payment-updated:9bb91e7a6574bb71f2340810","attempts":1}
üí∞ Processing payment completion for customer: NQ2XM2FWWZP2YM25XWCZGTM0HR
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Alondra Flores
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Alondra Flores, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Alondra Flores
   - Email: af.alondraflores@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: NQ2XM2FWWZP2YM25XWCZGTM0HR
{"ts":"2025-12-06T01:14:46.426Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"6e380473-bbdb-4b00-b147-b0d088faa0a1","stage":"payment","correlationId":"payment-updated:9bb91e7a6574bb71f2340810"}
{"ts":"2025-12-06T01:14:47.765Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"409c1aa8-3b72-47ba-9eb6-329461bc31e7","stage":"payment","correlationId":"payment-updated:90f8dc5cb5f176927a0b2a0c","attempts":1}
üí∞ Processing payment completion for customer: NQ2XM2FWWZP2YM25XWCZGTM0HR
   Payment source_type: CARD
   Payment tender_types: []
Customer NQ2XM2FWWZP2YM25XWCZGTM0HR already completed first payment
{"ts":"2025-12-06T01:14:48.899Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"409c1aa8-3b72-47ba-9eb6-329461bc31e7","stage":"payment","correlationId":"payment-updated:90f8dc5cb5f176927a0b2a0c"}
{"ts":"2025-12-06T01:14:50.094Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"2b7a8363-fad0-4a4e-8524-f27fb5f29f25","stage":"booking","correlationId":"booking-created:c5b891ea0a98bb51b867fe25","attempts":1}
üìÖ Processing booking created for customer: T7MSY3AJW9XWPCTQXQ446A4N14
Full booking data: {
  "id": "islw5fn15qeqrq",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-08T00:05:00Z",
  "created_at": "2025-12-06T01:03:46Z",
  "updated_at": "2025-12-06T01:03:46Z",
  "customer_id": "T7MSY3AJW9XWPCTQXQ446A4N14",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "T7MSY3AJW9XWPCTQXQ446A4N14",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMoZGdZlg-iKWTDu",
      "any_team_member": true,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1764609601083,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    },
    {
      "team_member_id": "TMoZGdZlg-iKWTDu",
      "any_team_member": true,
      "duration_minutes": 30,
      "intermission_minutes": 0,
      "service_variation_id": "LFLFEZO7L46URIM2OVZOJADI",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "LFLFEZO7L46URIM2OVZOJADI"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Erica Harrison
üéâ First booking detected for customer: T7MSY3AJW9XWPCTQXQ446A4N14
   Name: Erica Harrison
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer T7MSY3AJW9XWPCTQXQ446A4N14...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-04-20T20:53:21.158Z",
      "createdAt": "2025-04-20T20:53:21.158Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: T7MSY3AJW9XWPCTQXQ446A4N14
{"ts":"2025-12-06T01:14:52.122Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"2b7a8363-fad0-4a4e-8524-f27fb5f29f25","stage":"booking","correlationId":"booking-created:c5b891ea0a98bb51b867fe25"}
{"ts":"2025-12-06T01:14:53.493Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"34743fcb-e653-48df-957c-d6b81a82fcea","stage":"payment","correlationId":"payment-updated:acc351bba80585503dddbcbf","attempts":1}
üí∞ Processing payment completion for customer: PES86DFJEV7MR5NBPQ8W2BBCMG
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Julie Steele
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Julie Steele, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Julie Steele
   - Email: julie.lyn.steele@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: PES86DFJEV7MR5NBPQ8W2BBCMG
{"ts":"2025-12-06T01:14:55.844Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"34743fcb-e653-48df-957c-d6b81a82fcea","stage":"payment","correlationId":"payment-updated:acc351bba80585503dddbcbf"}
{"ts":"2025-12-06T01:14:57.339Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"a82038c6-9b3d-4492-81f9-0aaad13cf8e0","stage":"payment","correlationId":"payment-updated:dc3c33f1271f5b2abba6c2ee","attempts":1}
üí∞ Processing payment completion for customer: PES86DFJEV7MR5NBPQ8W2BBCMG
   Payment source_type: CARD
   Payment tender_types: []
Customer PES86DFJEV7MR5NBPQ8W2BBCMG already completed first payment
{"ts":"2025-12-06T01:14:58.220Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"a82038c6-9b3d-4492-81f9-0aaad13cf8e0","stage":"payment","correlationId":"payment-updated:dc3c33f1271f5b2abba6c2ee"}
{"ts":"2025-12-06T01:14:59.309Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"70cdb730-e63d-4c8a-8e72-4a8860109c02","stage":"booking","correlationId":"booking-created:0b9a75017b82822eeb47e749","attempts":1}
üìÖ Processing booking created for customer: PES86DFJEV7MR5NBPQ8W2BBCMG
Full booking data: {
  "id": "6qai2zfhxm5yaf",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2026-01-03T00:00:00Z",
  "created_at": "2025-12-06T01:11:34Z",
  "updated_at": "2025-12-06T01:11:34Z",
  "customer_id": "PES86DFJEV7MR5NBPQ8W2BBCMG",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMQPbDVvvOCLwqsy"
  },
  "appointment_segments": [
    {
      "team_member_id": "TM9jDlRr_Hl4rdBB",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "XBUDIMNKOPC2XVG5YLIQ4RYS",
      "service_variation_version": 1764609577793,
      "service_variation_client_id": "XBUDIMNKOPC2XVG5YLIQ4RYS"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Julie Steele
üéâ First booking detected for customer: PES86DFJEV7MR5NBPQ8W2BBCMG
   Name: Julie Steele
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer PES86DFJEV7MR5NBPQ8W2BBCMG...
   Full custom attributes response: {}
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: PES86DFJEV7MR5NBPQ8W2BBCMG
{"ts":"2025-12-06T01:15:01.234Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"70cdb730-e63d-4c8a-8e72-4a8860109c02","stage":"booking","correlationId":"booking-created:0b9a75017b82822eeb47e749"}
{"ts":"2025-12-06T01:42:29.980Z","level":"error","event":"giftcard.worker.loop_error","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","error":"\nInvalid `prisma.$queryRaw()` invocation:\n\n\nTransaction API error: Transaction already closed: A query cannot be executed on an expired transaction. The timeout for this transaction was 5000 ms, however 130605 ms passed since the start of the transaction. Consider increasing the interactive transaction timeout or doing less work in the transaction.","stack":"PrismaClientKnownRequestError: \nInvalid `prisma.$queryRaw()` invocation:\n\n\nTransaction API error: Transaction already closed: A query cannot be executed on an expired transaction. The timeout for this transaction was 5000 ms, however 130605 ms passed since the start of the transaction. Consider increasing the interactive transaction timeout or doing less work in the transaction.\n    at $n.handleRequestError (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:121:7315)\n    at $n.handleAndLogRequestError (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:121:6623)\n    at $n.request (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:121:6307)\n    at async l (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:9633)\n    at async prisma.$transaction.isolationLevel (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:239:26)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:8000)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-06T01:42:36.538Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"9ac62ced-da00-4dc9-86a9-a6a58d745fab","stage":"payment","correlationId":"payment-updated:e25090ddd47369a1d3a31d00","attempts":1}
üí∞ Processing payment completion for customer: NCRQRN5BTS4RDEKE2NKFXQQCHR
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Zoe RusselHapp
‚ùå Referrer not found for code: null
‚úÖ First payment processing completed for customer: NCRQRN5BTS4RDEKE2NKFXQQCHR
{"ts":"2025-12-06T01:42:40.288Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"9ac62ced-da00-4dc9-86a9-a6a58d745fab","stage":"payment","correlationId":"payment-updated:e25090ddd47369a1d3a31d00"}
{"ts":"2025-12-06T01:42:41.795Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"dcaa8464-cd0e-4987-884c-ce6119ebdc46","stage":"payment","correlationId":"payment-updated:a7275d08c4016af5e96247a3","attempts":1}
üí∞ Processing payment completion for customer: NCRQRN5BTS4RDEKE2NKFXQQCHR
   Payment source_type: CARD
   Payment tender_types: []
Customer NCRQRN5BTS4RDEKE2NKFXQQCHR already completed first payment
{"ts":"2025-12-06T01:42:42.919Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"dcaa8464-cd0e-4987-884c-ce6119ebdc46","stage":"payment","correlationId":"payment-updated:a7275d08c4016af5e96247a3"}
{"ts":"2025-12-06T01:42:44.336Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"7c952773-18ee-4cf1-9cc2-b1773323aa87","stage":"payment","correlationId":"payment-updated:c8a26e4494095be18766cb05","attempts":1}
üí∞ Processing payment completion for customer: XYVBSD2DKD6AX5QW0RKP0R4XN8
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: lee hnetinka
‚ùå Referrer not found for code: null
‚úÖ First payment processing completed for customer: XYVBSD2DKD6AX5QW0RKP0R4XN8
{"ts":"2025-12-06T01:42:45.678Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"7c952773-18ee-4cf1-9cc2-b1773323aa87","stage":"payment","correlationId":"payment-updated:c8a26e4494095be18766cb05"}
{"ts":"2025-12-06T01:42:46.842Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"294118a9-d844-4f39-ba4d-09f0736db53a","stage":"payment","correlationId":"payment-updated:9c84cf2a4112c0ee15d2e568","attempts":1}
üí∞ Processing payment completion for customer: XYVBSD2DKD6AX5QW0RKP0R4XN8
   Payment source_type: CARD
   Payment tender_types: []
Customer XYVBSD2DKD6AX5QW0RKP0R4XN8 already completed first payment
{"ts":"2025-12-06T01:42:47.727Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"294118a9-d844-4f39-ba4d-09f0736db53a","stage":"payment","correlationId":"payment-updated:9c84cf2a4112c0ee15d2e568"}
{"ts":"2025-12-06T01:42:49.005Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"a5f50962-9474-4f6f-8eaa-9cfd0c3e09a8","stage":"customer_ingest","correlationId":"customer-created:c2e3e848dd3ed5e5c17317f9","attempts":1}
üì• Received customer data: {
  "id": "SKAEQ88WZP75RJWPWB6R0RP25G",
  "address": {
    "country": "US"
  },
  "version": 0,
  "group_ids": [
    "LT4ZHFBQQYB2N.APPOINTMENTS"
  ],
  "created_at": "2025-12-06T01:31:53.739Z",
  "given_name": "Minji",
  "updated_at": "2025-12-06T01:31:53Z",
  "family_name": "Park",
  "preferences": {
    "email_unsubscribed": false
  },
  "phone_number": "+19179729209",
  "email_address": "mpark2390@gmail.com",
  "creation_source": "APPOINTMENTS"
}
üë§ Processing customer creation: SKAEQ88WZP75RJWPWB6R0RP25G
üìç IP Address: unknown
üìß Email: mpark2390@gmail.com
üìû Phone: +19179729209
üë§ Name: Minji Park
‚ö†Ô∏è Suspicious IP activity detected: unknown used by 150 customers
‚ö†Ô∏è Suspicious activity detected for customer SKAEQ88WZP75RJWPWB6R0RP25G, flagging for review
üéâ New customer detected: SKAEQ88WZP75RJWPWB6R0RP25G
‚úÖ Customer added to database as NEW (temporary mark)
   - Will check for referral code when they book
   - Will give gift card on first booking if code found
‚úÖ Verification: Customer found in DB: true
{"ts":"2025-12-06T01:42:51.121Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"a5f50962-9474-4f6f-8eaa-9cfd0c3e09a8","stage":"customer_ingest","correlationId":"customer-created:c2e3e848dd3ed5e5c17317f9"}
{"ts":"2025-12-06T01:42:52.225Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"00df8885-44e6-47d8-81d0-5559de90143b","stage":"booking","correlationId":"booking-created:9248aac6bcdcf1517c6f45a5","attempts":1}
üìÖ Processing booking created for customer: SKAEQ88WZP75RJWPWB6R0RP25G
Full booking data: {
  "id": "jhw5w3hlikeq8b",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-18T20:00:00Z",
  "created_at": "2025-12-06T01:31:58Z",
  "updated_at": "2025-12-06T01:31:58Z",
  "customer_id": "SKAEQ88WZP75RJWPWB6R0RP25G",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "SKAEQ88WZP75RJWPWB6R0RP25G",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMMCVDJoKh3ZkfFo",
      "any_team_member": true,
      "duration_minutes": 30,
      "intermission_minutes": 0,
      "service_variation_id": "LFLFEZO7L46URIM2OVZOJADI",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "LFLFEZO7L46URIM2OVZOJADI"
    },
    {
      "team_member_id": "TMMCVDJoKh3ZkfFo",
      "any_team_member": true,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1764609601083,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Minji Park
üéâ First booking detected for customer: SKAEQ88WZP75RJWPWB6R0RP25G
   Name: Minji Park
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer SKAEQ88WZP75RJWPWB6R0RP25G...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "0826aee4-d259-434d-be44-511ac61b3629"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-12-06T01:31:58.202Z",
      "createdAt": "2025-12-06T01:31:58.202Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="0826aee4-d259-434d-be44-511ac61b3629"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "0826aee4-d259-434d-be44-511ac61b3629"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: SKAEQ88WZP75RJWPWB6R0RP25G
{"ts":"2025-12-06T01:42:54.112Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"00df8885-44e6-47d8-81d0-5559de90143b","stage":"booking","correlationId":"booking-created:9248aac6bcdcf1517c6f45a5"}
{"ts":"2025-12-06T02:01:48.447Z","level":"error","event":"giftcard.worker.loop_error","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","error":"Transaction API error: Transaction already closed: A commit cannot be executed on an expired transaction. The timeout for this transaction was 5000 ms, however 23046 ms passed since the start of the transaction. Consider increasing the interactive transaction timeout or doing less work in the transaction.","stack":"PrismaClientKnownRequestError: Transaction API error: Transaction already closed: A commit cannot be executed on an expired transaction. The timeout for this transaction was 5000 ms, however 23046 ms passed since the start of the transaction. Consider increasing the interactive transaction timeout or doing less work in the transaction.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:8034)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-06T02:01:54.628Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"b5ee3df2-f351-455b-bf48-33c81f481c84","stage":"payment","correlationId":"payment-updated:469607a4941e19423f100838","attempts":1}
üí∞ Processing payment completion for customer: Q6KK68EVJVT95BYTRA6MNRJCF4
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Elizabeth Wilson
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Elizabeth Wilson, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Elizabeth Wilson
   - Email: wilson.elizabeth1@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: Q6KK68EVJVT95BYTRA6MNRJCF4
{"ts":"2025-12-06T02:01:58.929Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"b5ee3df2-f351-455b-bf48-33c81f481c84","stage":"payment","correlationId":"payment-updated:469607a4941e19423f100838"}
{"ts":"2025-12-06T02:02:00.110Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"e2875a7b-978d-43ea-8f39-340006274b37","stage":"payment","correlationId":"payment-updated:4f4379f2e311d7fe102c2b36","attempts":1}
üí∞ Processing payment completion for customer: Q6KK68EVJVT95BYTRA6MNRJCF4
   Payment source_type: CARD
   Payment tender_types: []
Customer Q6KK68EVJVT95BYTRA6MNRJCF4 already completed first payment
{"ts":"2025-12-06T02:02:01.069Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"e2875a7b-978d-43ea-8f39-340006274b37","stage":"payment","correlationId":"payment-updated:4f4379f2e311d7fe102c2b36"}
{"ts":"2025-12-06T02:02:02.454Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"07236a04-c987-4d25-9ab6-c1aa9c2a44ec","stage":"booking","correlationId":"booking-created:4f4230a4f17035355074d6dc","attempts":1}
üìÖ Processing booking created for customer: BX2SZCCDJQPF5E64QDE8MM534M
Full booking data: {
  "id": "5aaemx35spo4c6",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-12T23:00:00Z",
  "created_at": "2025-12-06T02:01:15Z",
  "updated_at": "2025-12-06T02:01:15Z",
  "customer_id": "BX2SZCCDJQPF5E64QDE8MM534M",
  "location_id": "LNQKVBTQZN3EZ",
  "seller_note": "ONLY CAT EYE CHANGE",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMWAtQTYmZpwwxii"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMMCVDJoKh3ZkfFo",
      "any_team_member": false,
      "duration_minutes": 60,
      "intermission_minutes": 0,
      "service_variation_id": "SGSLS3INMK5YV637KUITCILL",
      "service_variation_version": 1760895536505,
      "service_variation_client_id": "SGSLS3INMK5YV637KUITCILL"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Lynn Rosenzweig
üéâ First booking detected for customer: BX2SZCCDJQPF5E64QDE8MM534M
   Name: Lynn Rosenzweig
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer BX2SZCCDJQPF5E64QDE8MM534M...
   Full custom attributes response: {}
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: BX2SZCCDJQPF5E64QDE8MM534M
{"ts":"2025-12-06T02:02:04.661Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"07236a04-c987-4d25-9ab6-c1aa9c2a44ec","stage":"booking","correlationId":"booking-created:4f4230a4f17035355074d6dc"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Server has closed the connection.
{"ts":"2025-12-06T02:25:00.420Z","level":"error","event":"giftcard.worker.loop_error","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
‚ö†Ô∏è GiftCardJob availability check error - assuming available: 
Invalid `prisma.$queryRaw()` invocation:


Can't reach database server at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`

Please make sure your database server is running at `ep-cool-math-ad2tyq7d-pooler.c-2.us-east-1.aws.neon.tech:5432`.
{"ts":"2025-12-06T02:25:09.431Z","level":"error","event":"giftcard.worker.loop_error","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-06T02:25:13.433Z","level":"error","event":"giftcard.worker.loop_error","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","error":"Transaction API error: Unable to start a transaction in the given time.","stack":"PrismaClientKnownRequestError: Transaction API error: Unable to start a transaction in the given time.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:7924)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-06T02:25:19.175Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"e89039bf-5d90-4fbf-b24a-2974771ab119","stage":"booking","correlationId":"booking-created:d8150db5ce506b2244e0fa13","attempts":1}
üìÖ Processing booking created for customer: FBSZKFKQW1P40HWZKJ0K0ZESZG
Full booking data: {
  "id": "pv4m5z63njxyob",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94123-3940",
    "address_line_1": "2266 Union St",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-11T18:50:00Z",
  "created_at": "2025-12-06T02:04:06Z",
  "updated_at": "2025-12-06T02:04:06Z",
  "customer_id": "FBSZKFKQW1P40HWZKJ0K0ZESZG",
  "location_id": "LT4ZHFBQQYB2N",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "FBSZKFKQW1P40HWZKJ0K0ZESZG",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TM9jDlRr_Hl4rdBB",
      "any_team_member": false,
      "duration_minutes": 90,
      "intermission_minutes": 0,
      "service_variation_id": "XBUDIMNKOPC2XVG5YLIQ4RYS",
      "service_variation_version": 1764801478862,
      "service_variation_client_id": "XBUDIMNKOPC2XVG5YLIQ4RYS"
    },
    {
      "team_member_id": "TM9jDlRr_Hl4rdBB",
      "any_team_member": false,
      "duration_minutes": 20,
      "intermission_minutes": 0,
      "service_variation_id": "HAJX45W3U2WUCCXM5MI24UEE",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "HAJX45W3U2WUCCXM5MI24UEE"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Leslie Zepeda
üéâ First booking detected for customer: FBSZKFKQW1P40HWZKJ0K0ZESZG
   Name: Leslie Zepeda
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer FBSZKFKQW1P40HWZKJ0K0ZESZG...
   Full custom attributes response: {}
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: FBSZKFKQW1P40HWZKJ0K0ZESZG
{"ts":"2025-12-06T02:25:23.853Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"e89039bf-5d90-4fbf-b24a-2974771ab119","stage":"booking","correlationId":"booking-created:d8150db5ce506b2244e0fa13"}
{"ts":"2025-12-06T02:25:25.267Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"f648b72a-5c4c-47d0-b99d-fe49b62d419c","stage":"booking","correlationId":"booking-created:e07a1a45e357630f01887f54","attempts":1}
üìÖ Processing booking created for customer: 8Q3BMCYJG52J740XJMEEP5PHS8
Full booking data: {
  "id": "z8kckn19ug8yyi",
  "source": "FIRST_PARTY_MERCHANT",
  "status": "ACCEPTED",
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-15T23:40:00Z",
  "created_at": "2025-12-06T02:05:52Z",
  "updated_at": "2025-12-06T02:05:52Z",
  "customer_id": "8Q3BMCYJG52J740XJMEEP5PHS8",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "creator_type": "TEAM_MEMBER",
    "team_member_id": "TMWAtQTYmZpwwxii"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMEWAZHdtaiRR_Zs",
      "any_team_member": false,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1764609601083,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    },
    {
      "team_member_id": "TMEWAZHdtaiRR_Zs",
      "any_team_member": false,
      "duration_minutes": 20,
      "intermission_minutes": 0,
      "service_variation_id": "HAJX45W3U2WUCCXM5MI24UEE",
      "service_variation_version": 1763586786564,
      "service_variation_client_id": "HAJX45W3U2WUCCXM5MI24UEE"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Sade Fonseca
üéâ First booking detected for customer: 8Q3BMCYJG52J740XJMEEP5PHS8
   Name: Sade Fonseca
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 8Q3BMCYJG52J740XJMEEP5PHS8...
   Full custom attributes response: {
  "customAttributes": [
    {
      "key": "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1",
      "value": [
        "ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
      ],
      "version": 1,
      "visibility": "VISIBILITY_READ_WRITE_VALUES",
      "updatedAt": "2025-03-20T08:38:32.852Z",
      "createdAt": "2025-03-20T08:38:32.852Z"
    }
  ]
}
   üìã Custom attribute: key="square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1", value="ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
   Custom attributes from Square: {
  "square:c11dd5ac-8382-4570-9c7b-2bdcb1c781f1": [
    "ea55658e-be3e-4b86-a64a-9d499c3b4b8c"
  ]
}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 8Q3BMCYJG52J740XJMEEP5PHS8
{"ts":"2025-12-06T02:25:27.193Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"f648b72a-5c4c-47d0-b99d-fe49b62d419c","stage":"booking","correlationId":"booking-created:e07a1a45e357630f01887f54"}
{"ts":"2025-12-06T02:25:28.282Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"caa8103e-505d-425b-9b4e-34ca6b77a87e","stage":"payment","correlationId":"payment-updated:bef58bb664d5ceac7cae2a30","attempts":1}
üí∞ Processing payment completion for customer: MEKRQ4CYGX6Z38NKXMB92XTQNR
   Payment source_type: CARD
   Payment tender_types: []
üéâ First payment completed for customer: Jules Ross
‚ùå Referrer not found for code: null
‚ö†Ô∏è Referral email already sent to Jules Ross, skipping...
‚úÖ Referral code sent to new client:
   - Customer: Jules Ross
   - Email: ross.julesann@gmail.com
   - Referral Code: undefined
   - Status: Customer is now a referrer
‚úÖ First payment processing completed for customer: MEKRQ4CYGX6Z38NKXMB92XTQNR
{"ts":"2025-12-06T02:25:30.273Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"caa8103e-505d-425b-9b4e-34ca6b77a87e","stage":"payment","correlationId":"payment-updated:bef58bb664d5ceac7cae2a30"}
{"ts":"2025-12-06T02:54:50.588Z","level":"error","event":"giftcard.worker.loop_error","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","error":"Transaction API error: Transaction already closed: A commit cannot be executed on an expired transaction. The timeout for this transaction was 5000 ms, however 82458 ms passed since the start of the transaction. Consider increasing the interactive transaction timeout or doing less work in the transaction.","stack":"PrismaClientKnownRequestError: Transaction API error: Transaction already closed: A commit cannot be executed on an expired transaction. The timeout for this transaction was 5000 ms, however 82458 ms passed since the start of the transaction. Consider increasing the interactive transaction timeout or doing less work in the transaction.\n    at _r.transaction (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:111:12319)\n    at async Proxy._transactionWithCallback (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/node_modules/@prisma/client/runtime/library.js:130:8034)\n    at async lockNextGiftCardJob (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/lib/workflows/giftcard-job-queue.js:217:12)\n    at async workLoop (/Users/umitrakhimbekova/Documents/Zorina/10$GiftCard_story/scripts/giftcard-worker.js:100:19)"}
{"ts":"2025-12-06T02:54:58.173Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"0781fc5f-6b68-4b5b-a102-5ed958f7f182","stage":"booking","correlationId":"booking-created:078e7696f5643ec1bc332749","attempts":1}
üìÖ Processing booking created for customer: 10QNWX6Z7R1ZCTGJK9DJ3Q8Z90
Full booking data: {
  "id": "k6n0h6f2yyltwu",
  "source": "FIRST_PARTY_BUYER",
  "status": "ACCEPTED",
  "address": {
    "locality": "San Francisco",
    "postal_code": "94133-4608",
    "address_line_1": "550 Pacific Ave",
    "administrative_district_level_1": "CA"
  },
  "all_day": false,
  "version": 0,
  "start_at": "2025-12-08T19:00:00Z",
  "created_at": "2025-12-06T02:09:43Z",
  "updated_at": "2025-12-06T02:09:43Z",
  "customer_id": "10QNWX6Z7R1ZCTGJK9DJ3Q8Z90",
  "location_id": "LNQKVBTQZN3EZ",
  "location_type": "BUSINESS_LOCATION",
  "creator_details": {
    "customer_id": "10QNWX6Z7R1ZCTGJK9DJ3Q8Z90",
    "creator_type": "CUSTOMER"
  },
  "appointment_segments": [
    {
      "team_member_id": "TMEWAZHdtaiRR_Zs",
      "any_team_member": true,
      "duration_minutes": 120,
      "intermission_minutes": 0,
      "service_variation_id": "5KMEQ27BJSRQ4HEIXM3BEVCU",
      "service_variation_version": 1764609601083,
      "service_variation_client_id": "5KMEQ27BJSRQ4HEIXM3BEVCU"
    }
  ],
  "transition_time_minutes": 0
}
üîç Step 1: Checking if customer exists in database...
   Found 1 customer(s) in database
üîç Step 2: Getting customer record...
   Customer: Celia peachey
üéâ First booking detected for customer: 10QNWX6Z7R1ZCTGJK9DJ3Q8Z90
   Name: Celia peachey
üîç Step 3: Checking for referral code...
   üîç Checking appointment segment custom fields for referral code...
   No referral code in booking, checking custom attributes...
   Fetching custom attributes for customer 10QNWX6Z7R1ZCTGJK9DJ3Q8Z90...
   Full custom attributes response: {}
   Custom attributes from Square: {}
   üîç Checking all custom attribute values for valid referral codes...
   Final referral code result: None
‚ÑπÔ∏è Customer booked without referral code
   - Will receive referral code after first payment
   - No gift card given
‚úÖ Booking processing completed for customer: 10QNWX6Z7R1ZCTGJK9DJ3Q8Z90
{"ts":"2025-12-06T02:55:02.671Z","level":"info","event":"giftcard.worker.job.completed","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"0781fc5f-6b68-4b5b-a102-5ed958f7f182","stage":"booking","correlationId":"booking-created:078e7696f5643ec1bc332749"}
{"ts":"2025-12-06T02:55:04.130Z","level":"info","event":"giftcard.worker.job.start","workerId":"23b8c303-22ed-41f9-8ddd-7bb41bc5346a","jobId":"865dfafe-b12b-409d-a8d3-48e7c36a11a8","stage":"payment","correlationId":"payment-updated:770c48a53c4fe0e6d5f3054f","attempts":1}
