# –û—Ç—á–µ—Ç –æ–± –∞–Ω–∞–ª–∏–∑–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

**–î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞:** 2025-01-27

## üìä –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

- **–í—Å–µ–≥–æ —Ç–∞–±–ª–∏—Ü:** 20
- **–¢–∞–±–ª–∏—Ü—ã —Å –¥–∞–Ω–Ω—ã–º–∏:** 12 (60%)
- **–ü—É—Å—Ç—ã–µ —Ç–∞–±–ª–∏—Ü—ã:** 8 (40%)

---

## ‚úÖ –¢–∞–±–ª–∏—Ü—ã —Å –¥–∞–Ω–Ω—ã–º–∏ (–≤–∞–∂–Ω—ã–µ)

### 1. **square_existing_clients** - 7,265 –∑–∞–ø–∏—Å–µ–π
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –û—Å–Ω–æ–≤–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤ –∏–∑ Square (legacy —Å–∏—Å—Ç–µ–º–∞)
- **–ü–æ—á–µ–º—É –≤–∞–∂–Ω–∞:** –°–æ–¥–µ—Ä–∂–∏—Ç –æ—Å–Ω–æ–≤–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–ª–∏–µ–Ω—Ç–∞—Ö
- **–ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö:** Webhooks –æ—Ç Square (customer.created, booking.created)
- **–°—Ç–∞—Ç—É—Å:** –ê–∫—Ç–∏–≤–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è

### 2. **giftcard_jobs** - 4,921 –∑–∞–ø–∏—Å–µ–π
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –û—á–µ—Ä–µ–¥—å –∑–∞–¥–∞—á –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–æ–¥–∞—Ä–æ—á–Ω—ã—Ö –∫–∞—Ä—Ç
- **–ü–æ—á–µ–º—É –≤–∞–∂–Ω–∞:** –£–ø—Ä–∞–≤–ª—è–µ—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π webhook'–æ–≤
- **–ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö:** `lib/workflows/giftcard-job-queue.js`
- **–°—Ç–∞—Ç—É—Å:** –ê–∫—Ç–∏–≤–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è

### 3. **giftcard_runs** - 4,919 –∑–∞–ø–∏—Å–µ–π
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–æ–¥–∞—Ä–æ—á–Ω—ã—Ö –∫–∞—Ä—Ç
- **–ü–æ—á–µ–º—É –≤–∞–∂–Ω–∞:** –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —ç—Ç–∞–ø–æ–≤ –æ–±—Ä–∞–±–æ—Ç–∫–∏
- **–ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö:** `lib/runs/giftcard-run-tracker.js`
- **–°—Ç–∞—Ç—É—Å:** –ê–∫—Ç–∏–≤–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è

### 4. **ref_clicks** - 431 –∑–∞–ø–∏—Å–µ–π
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ö–ª–∏–∫–∏ –ø–æ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–º —Å—Å—ã–ª–∫–∞–º
- **–ü–æ—á–µ–º—É –≤–∞–∂–Ω–∞:** –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π –ø—Ä–æ–≥—Ä–∞–º–º—ã
- **–ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö:** `app/api/track-referral-click/route.js`
- **–°—Ç–∞—Ç—É—Å:** –ê–∫—Ç–∏–≤–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è

### 5. **processed_events** - 180 –∑–∞–ø–∏—Å–µ–π
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–±—ã—Ç–∏–π
- **–ü–æ—á–µ–º—É –≤–∞–∂–Ω–∞:** –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏
- **–ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö:** `app/api/webhooks/square/referrals/route.js` (processPaymentCompletion, processBookingCreated)
- **–°—Ç–∞—Ç—É—Å:** –ê–∫—Ç–∏–≤–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è

### 6. **notification_events** - 80 –∑–∞–ø–∏—Å–µ–π
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –°–æ–±—ã—Ç–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (SMS/Email)
- **–ü–æ—á–µ–º—É –≤–∞–∂–Ω–∞:** –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –¥–æ—Å—Ç–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- **–ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö:** –ö–æ–¥ –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- **–°—Ç–∞—Ç—É—Å:** –ê–∫—Ç–∏–≤–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è

### 7. **customers** - 23 –∑–∞–ø–∏—Å–µ–π
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –û—Å–Ω–æ–≤–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤ (–Ω–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞)
- **–ü–æ—á–µ–º—É –≤–∞–∂–Ω–∞:** –°–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤
- **–ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö:** –ú–∏–≥—Ä–∞—Ü–∏—è –∏–∑ square_existing_clients –∏–ª–∏ —Å–æ–∑–¥–∞–Ω–∏–µ —á–µ—Ä–µ–∑ API
- **–°—Ç–∞—Ç—É—Å:** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, –Ω–æ –¥–∞–Ω–Ω—ã—Ö –º–∞–ª–æ (–≤–æ–∑–º–æ–∂–Ω–æ, –Ω–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞)

### 8. **ref_links** - 23 –∑–∞–ø–∏—Å–µ–π
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –†–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–µ —Å—Å—ã–ª–∫–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤
- **–ü–æ—á–µ–º—É –≤–∞–∂–Ω–∞:** –•—Ä–∞–Ω–∏—Ç —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–µ –∫–æ–¥—ã –∏ URL
- **–ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö:** `scripts/generate-referral-links-for-all-customers.js`
- **–°—Ç–∞—Ç—É—Å:** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è

### 9. **square_gift_card_gan_audit** - 68 –∑–∞–ø–∏—Å–µ–π
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ê—É–¥–∏—Ç GAN (Gift Account Number) –ø–æ–¥–∞—Ä–æ—á–Ω—ã—Ö –∫–∞—Ä—Ç
- **–ü–æ—á–µ–º—É –≤–∞–∂–Ω–∞:** –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø–æ–¥–∞—Ä–æ—á–Ω—ã—Ö –∫–∞—Ä—Ç
- **–ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö:** –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏/–∞—É–¥–∏—Ç
- **–°—Ç–∞—Ç—É—Å:** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è

### 10. **ref_matches** - 4 –∑–∞–ø–∏—Å–µ–π
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –°–æ–≤–ø–∞–¥–µ–Ω–∏—è —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤ —Å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è–º–∏
- **–ü–æ—á–µ–º—É –≤–∞–∂–Ω–∞:** –°–≤—è–∑—ã–≤–∞–µ—Ç –∫–ª–∏–∫–∏ —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è–º–∏
- **–ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö:** `app/api/webhooks/square/referrals/route.js` (processBookingCreated)
- **–°—Ç–∞—Ç—É—Å:** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è

### 11. **ref_rewards** - 2 –∑–∞–ø–∏—Å–µ–π
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ù–∞–≥—Ä–∞–¥—ã –∑–∞ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤
- **–ü–æ—á–µ–º—É –≤–∞–∂–Ω–∞:** –•—Ä–∞–Ω–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –Ω–∞–≥—Ä–∞–¥–∞—Ö
- **–ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö:** Webhook –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–ª–∞—Ç–µ–∂–µ–π
- **–°—Ç–∞—Ç—É—Å:** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è

### 12. **analytics_dead_letter** - 4 –∑–∞–ø–∏—Å–µ–π
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ù–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ —Å–æ–±—ã—Ç–∏—è
- **–ü–æ—á–µ–º—É –≤–∞–∂–Ω–∞:** –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
- **–ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö:** –û—à–∏–±–∫–∏ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Å–æ–±—ã—Ç–∏–π
- **–°—Ç–∞—Ç—É—Å:** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è (–Ω–∞–ª–∏—á–∏–µ –∑–∞–ø–∏—Å–µ–π –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –±—ã–ª–∏ –æ—à–∏–±–∫–∏)

---

## ‚ö™ –ü—É—Å—Ç—ã–µ —Ç–∞–±–ª–∏—Ü—ã (–∞–Ω–∞–ª–∏–∑ –ø—Ä–∏—á–∏–Ω)

### 1. **idempotency** - 0 –∑–∞–ø–∏—Å–µ–π
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–π (—Å—Ç–∞—Ä–∞—è —Å–∏—Å—Ç–µ–º–∞)
- **–ü–æ—á–µ–º—É –ø—É—Å—Ç–∞:** 
  - –ó–∞–º–µ–Ω–µ–Ω–∞ –Ω–∞ `processed_events` —Ç–∞–±–ª–∏—Ü—É
  - –°—Ç–∞—Ä–∞—è —Ç–∞–±–ª–∏—Ü–∞, –±–æ–ª—å—à–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
- **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ú–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å, –µ—Å–ª–∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è

### 2. **gift_card_cache** - 0 –∑–∞–ø–∏—Å–µ–π
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ö—ç—à –ø–æ–¥–∞—Ä–æ—á–Ω—ã—Ö –∫–∞—Ä—Ç
- **–ü–æ—á–µ–º—É –ø—É—Å—Ç–∞:**
  - –¢–∞–±–ª–∏—Ü–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –≤ —Å—Ö–µ–º–µ, –Ω–æ –Ω–µ—Ç –∫–æ–¥–∞, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–∑–¥–∞–µ—Ç –∑–∞–ø–∏—Å–∏
  - –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞
  - –í –∫–æ–¥–µ –µ—Å—Ç—å —Ç–æ–ª—å–∫–æ —á—Ç–µ–Ω–∏–µ: `app/api/wallet/v1/passes/[passTypeIdentifier]/[serialNumber]/route.js`
- **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** 
  - –õ–∏–±–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
  - –õ–∏–±–æ —É–¥–∞–ª–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É, –µ—Å–ª–∏ –Ω–µ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

### 3. **referral_process_runs** - 0 –∑–∞–ø–∏—Å–µ–π
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ó–∞–ø—É—Å–∫–∏ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤
- **–ü–æ—á–µ–º—É –ø—É—Å—Ç–∞:**
  - –¢–∞–±–ª–∏—Ü–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –≤ —Å—Ö–µ–º–µ, –Ω–æ –Ω–µ—Ç –∫–æ–¥–∞, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–∑–¥–∞–µ—Ç –∑–∞–ø–∏—Å–∏
  - –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞
  - –°–≤—è–∑–∞–Ω–∞ —Å `referral_events` (—Ç–æ–∂–µ –ø—É—Å—Ç–∞—è)
- **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
  - –≠—Ç–æ —á–∞—Å—Ç—å –ø–ª–∞–Ω–∏—Ä—É–µ–º–æ–π —Å–∏—Å—Ç–µ–º—ã —Å–æ–±—ã—Ç–∏–π —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤
  - –õ–∏–±–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å, –ª–∏–±–æ —É–¥–∞–ª–∏—Ç—å, –µ—Å–ª–∏ –Ω–µ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è

### 4. **referral_events** - 0 –∑–∞–ø–∏—Å–µ–π
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –°–æ–±—ã—Ç–∏—è —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã
- **–ü–æ—á–µ–º—É –ø—É—Å—Ç–∞:**
  - –¢–∞–±–ª–∏—Ü–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –≤ —Å—Ö–µ–º–µ, –Ω–æ –Ω–µ—Ç –∫–æ–¥–∞, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–∑–¥–∞–µ—Ç –∑–∞–ø–∏—Å–∏
  - –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞
  - –°–≤—è–∑–∞–Ω–∞ —Å–æ –º–Ω–æ–≥–∏–º–∏ —Ç–∞–±–ª–∏—Ü–∞–º–∏ (RefLink, RefMatch, RefReward, RevenueAttribution)
  - –£–ø–æ–º–∏–Ω–∞–µ—Ç—Å—è –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ (`REFERRAL_CODE_VALIDATION_IMPROVEMENTS.md`), –Ω–æ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞
- **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
  - –≠—Ç–æ —á–∞—Å—Ç—å –ø–ª–∞–Ω–∏—Ä—É–µ–º–æ–π —Å–∏—Å—Ç–µ–º—ã –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤
  - –õ–∏–±–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å, –ª–∏–±–æ —É–¥–∞–ª–∏—Ç—å, –µ—Å–ª–∏ –Ω–µ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è

### 5. **referrer_stats** - 0 –∑–∞–ø–∏—Å–µ–π
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–µ—Ñ–µ—Ä–µ—Ä–æ–≤
- **–ü–æ—á–µ–º—É –ø—É—Å—Ç–∞:**
  - –¢–∞–±–ª–∏—Ü–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –≤ —Å—Ö–µ–º–µ, –Ω–æ –Ω–µ—Ç –∫–æ–¥–∞, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–∑–¥–∞–µ—Ç –∑–∞–ø–∏—Å–∏
  - –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞
  - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ `square_existing_clients` (total_referrals, total_rewards)
- **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
  - –õ–∏–±–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∞–≥—Ä–µ–≥–∞—Ü–∏—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –≤ —ç—Ç—É —Ç–∞–±–ª–∏—Ü—É
  - –õ–∏–±–æ —É–¥–∞–ª–∏—Ç—å, –µ—Å–ª–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞ –≤ square_existing_clients

### 6. **revenue_attribution** - 0 –∑–∞–ø–∏—Å–µ–π
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ê—Ç—Ä–∏–±—É—Ü–∏—è –¥–æ—Ö–æ–¥–∞ –æ—Ç —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤
- **–ü–æ—á–µ–º—É –ø—É—Å—Ç–∞:**
  - –¢–∞–±–ª–∏—Ü–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –≤ —Å—Ö–µ–º–µ, –Ω–æ –Ω–µ—Ç –∫–æ–¥–∞, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–∑–¥–∞–µ—Ç –∑–∞–ø–∏—Å–∏
  - –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞
  - –°–≤—è–∑–∞–Ω–∞ —Å `referral_events` (—Ç–æ–∂–µ –ø—É—Å—Ç–∞—è)
- **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
  - –≠—Ç–æ —á–∞—Å—Ç—å –ø–ª–∞–Ω–∏—Ä—É–µ–º–æ–π —Å–∏—Å—Ç–µ–º—ã –∞—Ç—Ä–∏–±—É—Ü–∏–∏ –¥–æ—Ö–æ–¥–∞
  - –õ–∏–±–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å, –ª–∏–±–æ —É–¥–∞–ª–∏—Ç—å, –µ—Å–ª–∏ –Ω–µ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è

### 7. **device_pass_registrations** - 0 –∑–∞–ø–∏—Å–µ–π
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –¥–ª—è Apple Wallet
- **–ü–æ—á–µ–º—É –ø—É—Å—Ç–∞:**
  - –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É—é—Ç —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –¥–ª—è Apple Wallet
  - –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ, –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç Apple Wallet
- **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
  - –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ, –µ—Å–ª–∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å Apple Wallet –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∞–∫—Ç–∏–≤–Ω–æ
  - –¢–∞–±–ª–∏—Ü–∞ –±—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω—è—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏

### 8. **analytics_events** - 0 –∑–∞–ø–∏—Å–µ–π
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ —Å–æ–±—ã—Ç–∏—è
- **–ü–æ—á–µ–º—É –ø—É—Å—Ç–∞:**
  - –¢–∞–±–ª–∏—Ü–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –≤ —Å—Ö–µ–º–µ, –Ω–æ –Ω–µ—Ç –∫–æ–¥–∞, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–∑–¥–∞–µ—Ç –∑–∞–ø–∏—Å–∏
  - –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞
  - –£–ø–æ–º–∏–Ω–∞–µ—Ç—Å—è –≤ `scripts/check-webhook-customers.js`, –Ω–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
- **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
  - –õ–∏–±–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
  - –õ–∏–±–æ —É–¥–∞–ª–∏—Ç—å, –µ—Å–ª–∏ –Ω–µ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è

---

## üîç –ö–ª—é—á–µ–≤—ã–µ –≤—ã–≤–æ–¥—ã

### –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
1. **–î–≤–µ —Å–∏—Å—Ç–µ–º—ã –∫–ª–∏–µ–Ω—Ç–æ–≤:**
   - `square_existing_clients` (7,265 –∑–∞–ø–∏—Å–µ–π) - legacy —Å–∏—Å—Ç–µ–º–∞
   - `customers` (23 –∑–∞–ø–∏—Å–∏) - –Ω–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞
   - **–ü—Ä–æ–±–ª–µ–º–∞:** –î–∞–Ω–Ω—ã–µ –Ω–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã
   - **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –º–∏–≥—Ä–∞—Ü–∏–∏ –∏–ª–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

### –ù–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ç–∞–±–ª–∏—Ü—ã
–°–ª–µ–¥—É—é—â–∏–µ —Ç–∞–±–ª–∏—Ü—ã –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –≤ —Å—Ö–µ–º–µ, –Ω–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ –∫–æ–¥–µ:
1. `gift_card_cache`
2. `referral_process_runs`
3. `referral_events`
4. `referrer_stats`
5. `revenue_attribution`
6. `analytics_events`
7. `idempotency` (–∑–∞–º–µ–Ω–µ–Ω–∞ –Ω–∞ `processed_events`)

### –ü–ª–∞–Ω–∏—Ä—É–µ–º—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
–ù–µ–∫–æ—Ç–æ—Ä—ã–µ –ø—É—Å—Ç—ã–µ —Ç–∞–±–ª–∏—Ü—ã —Å–≤—è–∑–∞–Ω—ã —Å –ø–ª–∞–Ω–∏—Ä—É–µ–º—ã–º–∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏:
- –°–∏—Å—Ç–µ–º–∞ —Å–æ–±—ã—Ç–∏–π —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤ (`referral_events`, `referral_process_runs`)
- –ê—Ç—Ä–∏–±—É—Ü–∏—è –¥–æ—Ö–æ–¥–∞ (`revenue_attribution`)
- –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ (`analytics_events`)
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–µ—Ñ–µ—Ä–µ—Ä–æ–≤ (`referrer_stats`)

---

## üìã –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –ù–µ–º–µ–¥–ª–µ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è
1. **–†–µ—à–∏—Ç—å —Å—É–¥—å–±—É –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö —Ç–∞–±–ª–∏—Ü:**
   - –£–¥–∞–ª–∏—Ç—å, –µ—Å–ª–∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –Ω–µ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è
   - –ò–ª–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

2. **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤:**
   - –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –º–∏–≥—Ä–∞—Ü–∏–∏ –∏–∑ `square_existing_clients` –≤ `customers`
   - –ò–ª–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏

### –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è
1. **–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É —Å–æ–±—ã—Ç–∏–π —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤:**
   - –ó–∞–ø–æ–ª–Ω—è—Ç—å `referral_events` –ø—Ä–∏ –≤–∞–∂–Ω—ã—Ö —Å–æ–±—ã—Ç–∏—è—Ö
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –∏ –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç–∏

2. **–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∞—Ç—Ä–∏–±—É—Ü–∏—é –¥–æ—Ö–æ–¥–∞:**
   - –ó–∞–ø–æ–ª–Ω—è—Ç—å `revenue_attribution` –ø—Ä–∏ –ø–ª–∞—Ç–µ–∂–∞—Ö
   - –°–≤—è–∑—ã–≤–∞—Ç—å –¥–æ—Ö–æ–¥ —Å —Ä–µ—Ñ–µ—Ä–∞–ª–∞–º–∏

3. **–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —Ä–µ—Ñ–µ—Ä–µ—Ä–æ–≤:**
   - –ê–≥—Ä–µ–≥–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ `referrer_stats`
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –¥–∞—à–±–æ—Ä–¥–æ–≤

---

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü

| –¢–∞–±–ª–∏—Ü–∞ | –ó–∞–ø–∏—Å–µ–π | –°—Ç–∞—Ç—É—Å | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ |
|---------|---------|--------|----------------|
| square_existing_clients | 7,265 | ‚úÖ –ê–∫—Ç–∏–≤–Ω–∞ | Legacy —Å–∏—Å—Ç–µ–º–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤ |
| giftcard_jobs | 4,921 | ‚úÖ –ê–∫—Ç–∏–≤–Ω–∞ | –û—á–µ—Ä–µ–¥—å –∑–∞–¥–∞—á |
| giftcard_runs | 4,919 | ‚úÖ –ê–∫—Ç–∏–≤–Ω–∞ | –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è |
| ref_clicks | 431 | ‚úÖ –ê–∫—Ç–∏–≤–Ω–∞ | –ö–ª–∏–∫–∏ –ø–æ —Å—Å—ã–ª–∫–∞–º |
| processed_events | 180 | ‚úÖ –ê–∫—Ç–∏–≤–Ω–∞ | –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å |
| notification_events | 80 | ‚úÖ –ê–∫—Ç–∏–≤–Ω–∞ | –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è |
| square_gift_card_gan_audit | 68 | ‚úÖ –ê–∫—Ç–∏–≤–Ω–∞ | –ê—É–¥–∏—Ç –∫–∞—Ä—Ç |
| customers | 23 | ‚ö†Ô∏è –ú–∞–ª–æ –¥–∞–Ω–Ω—ã—Ö | –ù–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ |
| ref_links | 23 | ‚úÖ –ê–∫—Ç–∏–≤–Ω–∞ | –†–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–µ —Å—Å—ã–ª–∫–∏ |
| ref_matches | 4 | ‚úÖ –ê–∫—Ç–∏–≤–Ω–∞ | –°–æ–≤–ø–∞–¥–µ–Ω–∏—è |
| analytics_dead_letter | 4 | ‚úÖ –ê–∫—Ç–∏–≤–Ω–∞ | –û—à–∏–±–∫–∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ |
| ref_rewards | 2 | ‚úÖ –ê–∫—Ç–∏–≤–Ω–∞ | –ù–∞–≥—Ä–∞–¥—ã |
| idempotency | 0 | ‚ùå –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è | –ó–∞–º–µ–Ω–µ–Ω–∞ |
| gift_card_cache | 0 | ‚ùå –ù–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ | –ù–µ—Ç –∫–æ–¥–∞ |
| referral_process_runs | 0 | ‚ùå –ù–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ | –ù–µ—Ç –∫–æ–¥–∞ |
| referral_events | 0 | ‚ùå –ù–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ | –ù–µ—Ç –∫–æ–¥–∞ |
| referrer_stats | 0 | ‚ùå –ù–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ | –ù–µ—Ç –∫–æ–¥–∞ |
| revenue_attribution | 0 | ‚ùå –ù–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ | –ù–µ—Ç –∫–æ–¥–∞ |
| device_pass_registrations | 0 | ‚ö™ –ù–æ—Ä–º–∞–ª—å–Ω–æ | –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è |
| analytics_events | 0 | ‚ùå –ù–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ | –ù–µ—Ç –∫–æ–¥–∞ |

---

## üîó –°–≤—è–∑–∏ –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏

### –ê–∫—Ç–∏–≤–Ω—ã–µ —Å–≤—è–∑–∏
- `customers` ‚Üî `ref_links` (1:1)
- `customers` ‚Üî `ref_clicks` (1:N)
- `customers` ‚Üî `ref_matches` (1:N)
- `customers` ‚Üî `ref_rewards` (1:N)
- `ref_matches` ‚Üî `ref_rewards` (1:N)
- `notification_events` ‚Üî `referral_events` (N:1) - –Ω–æ referral_events –ø—É—Å—Ç–∞

### –ù–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å–≤—è–∑–∏
- `referral_events` —Å–≤—è–∑–∞–Ω–∞ —Å–æ –º–Ω–æ–≥–∏–º–∏ —Ç–∞–±–ª–∏—Ü–∞–º–∏, –Ω–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
- `revenue_attribution` —Å–≤—è–∑–∞–Ω–∞ —Å `ref_matches` –∏ `referral_events`, –Ω–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è

---

**–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ —Å–∫—Ä–∏–ø—Ç–æ–º:** `scripts/analyze-database-tables.js`



