# Apple Wallet Updates - Summary

## ‚úÖ –ß—Ç–æ –±—ã–ª–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ

### 1. –û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –±–µ–π–¥–∂ "Add to Wallet" ‚úÖ

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ `lib/email-service-simple.js`**:
- –ó–∞–º–µ–Ω–µ–Ω–∞ –∫–∞—Å—Ç–æ–º–Ω–∞—è –∫–Ω–æ–ø–∫–∞ –Ω–∞ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –±–µ–π–¥–∂ Apple Wallet
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ—Ç Apple
- –ë–µ–π–¥–∂ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º Apple –¥–ª—è email-—Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è

**–ö–∞–∫ —ç—Ç–æ –≤—ã–≥–ª—è–¥–∏—Ç**:
```html
<a href="{walletUrl}">
  <img src="https://developer.apple.com/wallet/images/add-to-wallet-button.png" 
       alt="Add to Apple Wallet" 
       style="height:44px;width:auto;display:block;border:none;"
       width="120" 
       height="44" />
</a>
```

### 2. Web Service API –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π pass ‚úÖ

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ endpoints —Å–æ–≥–ª–∞—Å–Ω–æ [Apple PassKit Web Service Reference](https://developer.apple.com/documentation/passkit/pkwebservice):

#### Endpoints:

1. **GET `/api/wallet/v1/passes/{passTypeIdentifier}/{serialNumber}`**
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é pass
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è pull-to-refresh –≤ Wallet
   - –¢—Ä–µ–±—É–µ—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ `Authorization: ApplePass {token}`

2. **GET `/api/wallet/v1/devices/{deviceLibraryIdentifier}/registrations/{passTypeIdentifier}`**
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö passes, –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ
   - JSON –º–∞—Å—Å–∏–≤ serial numbers

3. **POST `/api/wallet/v1/devices/{deviceLibraryIdentifier}/registrations/{passTypeIdentifier}/{serialNumber}`**
   - –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
   - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç push token (–¥–ª—è –±—É–¥—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π)

4. **DELETE `/api/wallet/v1/devices/{deviceLibraryIdentifier}/registrations/{passTypeIdentifier}/{serialNumber}`**
   - –û—Ç–º–µ–Ω—è–µ—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞

5. **POST `/api/wallet/v1/log`**
   - –ü—Ä–∏–Ω–∏–º–∞–µ—Ç –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–µ –ª–æ–≥–∏ –æ—Ç —É—Å—Ç—Ä–æ–π—Å—Ç–≤

### 3. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö ‚úÖ

**–ù–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞ `device_pass_registrations`**:
- –•—Ä–∞–Ω–∏—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
- –°–æ—Å—Ç–∞–≤–Ω–æ–π –ø–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á: `(deviceLibraryIdentifier, passTypeIdentifier, serialNumber)`
- –ü–æ–ª–µ `pushToken` –¥–ª—è –±—É–¥—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

**–ú–∏–≥—Ä–∞—Ü–∏—è**: `prisma/migrations/20251124163444_add_device_pass_registrations/migration.sql`

### 4. Web Service URL ‚úÖ

**–û–±–Ω–æ–≤–ª–µ–Ω–æ –≤**:
- `app/api/wallet/pass/[gan]/route.js` - –æ—Å–Ω–æ–≤–Ω–æ–π endpoint –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ pass
- `app/api/wallet/v1/passes/[passTypeIdentifier]/[serialNumber]/route.js` - endpoint –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π

**Web Service URL**: `https://zorinastudio-referral.com/api/wallet/v1`

–≠—Ç–æ—Ç URL —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –≤ –∫–∞–∂–¥—ã–π pass, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç Apple Wallet –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±—Ä–∞—â–∞—Ç—å—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π.

## üîÑ –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ (pull-to-refresh):

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç pass –≤ Apple Wallet
2. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ç—è–Ω–µ—Ç –≤–Ω–∏–∑ –Ω–∞ –æ–±—Ä–∞—Ç–Ω–æ–π —Å—Ç–æ—Ä–æ–Ω–µ pass
3. Apple Wallet –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å –Ω–∞ `/api/wallet/v1/passes/{passTypeIdentifier}/{serialNumber}`
4. –°–µ—Ä–≤–µ—Ä –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π pass —Å –∞–∫—Ç—É–∞–ª—å–Ω—ã–º –±–∞–ª–∞–Ω—Å–æ–º –∏–∑ Square
5. Pass –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ

### Push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (—Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ):

1. –ë–∞–ª–∞–Ω—Å –º–µ–Ω—è–µ—Ç—Å—è (–ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ, –≤—ã–¥–∞—á–∞ –±–æ–Ω—É—Å–∞, —Å–ø–∏—Å–∞–Ω–∏–µ –ø–æ–¥–∞—Ä–æ—á–Ω–æ–≥–æ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞)
2. –°–µ—Ä–≤–µ—Ä —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç push —á–µ—Ä–µ–∑ APNs –Ω–∞ –≤—Å–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ —Å —ç—Ç–∏–º —Å–µ—Ä–∏–π–Ω—ã–º –Ω–æ–º–µ—Ä–æ–º
3. Apple Wallet –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±—Ä–∞—â–∞–µ—Ç—Å—è –∫ `/api/wallet/v1/passes/{passTypeIdentifier}/{serialNumber}`
4. –í–æ–∑–≤—Ä–∞—â–∞–µ–º –Ω–æ–≤—ã–π `.pkpass`, –∏ –±–∞–ª–∞–Ω—Å –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –±–µ–∑ –¥–µ–π—Å—Ç–≤–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

> –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è: `APPLE_PASS_CERTIFICATE_PEM_BASE64` + `APPLE_PASS_KEY_PEM_BASE64` (–∏–ª–∏ p12-—ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç) –∏ –≤–∞–ª–∏–¥–Ω—ã–π Pass Type ID. –û—Ç–∫–ª—é—á–∏—Ç—å –º–æ–∂–Ω–æ, –∑–∞–¥–∞–≤ `APPLE_WALLET_PUSH_ENABLED=false`.

## üìã –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö**:
   ```bash
   npx prisma migrate deploy
   ```

2. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è**:
   - –î–æ–±–∞–≤–∏—Ç—å pass –≤ Apple Wallet
   - –ò–∑–º–µ–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å –≤ Square
   - –ü–æ—Ç—è–Ω—É—Ç—å –≤–Ω–∏–∑ –Ω–∞ –æ–±—Ä–∞—Ç–Ω–æ–π —Å—Ç–æ—Ä–æ–Ω–µ pass (pull-to-refresh)
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –±–∞–ª–∞–Ω—Å –æ–±–Ω–æ–≤–∏–ª—Å—è

3. **(–£–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ) Push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è**:
   - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã PassKit –∑–∞–¥–∞–Ω—ã –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
   - –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∑–∞–¥–∞–π—Ç–µ `APPLE_WALLET_PUSH_ENABLED=false`, —á—Ç–æ–±—ã –≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- `APPLE_WALLET_COMPLIANCE.md` - –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º Apple
- `APPLE_WALLET_WEB_SERVICE.md` - –î–µ—Ç–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ Web Service API
- [Apple PassKit Web Service Reference](https://developer.apple.com/documentation/passkit/pkwebservice)

## ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

–í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∑–∞–∫–æ–º–º–∏—á–µ–Ω—ã –∏ –∑–∞–ø—É—à–µ–Ω—ã. –ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –Ω–∞ Vercel –∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö, —Å–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!

